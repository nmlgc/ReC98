;
; +-------------------------------------------------------------------------+
; |   This file has been generated by The Interactive Disassembler (IDA)    |
; |        Copyright (c) 2009 by Hex-Rays, <support@hex-rays.com>           |
; +-------------------------------------------------------------------------+
;
; Input	MD5   :	06D74719B6F72B11014A392FD34D5F57

; File Name   :	th04/MAIN.EXE
; Format      :	MS-DOS executable (EXE)
; Base Address:	0h Range: 0h-2D180h Loaded length: 24A62h
; Entry	Point :	0:0
; OS type	  :  MS	DOS
; Application type:  Executable	16bit

		.286 ; Force the .model directive to create 16-bit default segments...
		.model large
		.386 ; ... then switch to what we actually need.
		; And yes, we can't move this to an include file for some reason.

BINARY = 'M'

include ReC98.inc
include th04/th04.inc
include th04/sprites/main_pat.inc
include th04/phase.inc
include th04/bullet/pattypes.inc

	extern SCOPY@:proc
	extern _execl:proc
	extern _memcpy:proc
	extern _strlen:proc
	extern _tolower:proc

	.seq
main_01 group main_01_TEXT, main_011_TEXT

; ===========================================================================

; Segment type:	Pure code
_TEXT		segment	word public 'CODE' use16
		assume cs:_TEXT
		assume es:nothing, ds:_DATA, fs:nothing, gs:nothing

include libs/master.lib/bfnt_entry_pat.asm
include libs/master.lib/bfnt_extend_header_skip.asm
include libs/master.lib/bfnt_header_read.asm
include libs/master.lib/bfnt_header_analysis.asm
include libs/master.lib/atrtcmod.asm
include libs/master.lib/bcloser.asm
include libs/master.lib/bfill.asm
include libs/master.lib/bfnt_palette_set.asm
include libs/master.lib/bgetc.asm
include libs/master.lib/palette_black_in.asm
include libs/master.lib/palette_black_out.asm
include libs/master.lib/bopenr.asm
include libs/master.lib/bread.asm
include libs/master.lib/bseek.asm
include libs/master.lib/bseek_.asm
include libs/master.lib/cutline.asm
include libs/master.lib/dos_axdx.asm
include libs/master.lib/dos_filesize.asm
include libs/master.lib/dos_keyclear.asm
include libs/master.lib/dos_read.asm
include libs/master.lib/dos_seek.asm
include libs/master.lib/dos_setvect.asm
include libs/master.lib/egc.asm
include libs/master.lib/egc_shift_down.asm
include libs/master.lib/egc_shift_left.asm
include libs/master.lib/egc_shift_right.asm
include libs/master.lib/egc_shift_up.asm
include libs/master.lib/file_append.asm
include libs/master.lib/file_close.asm
include libs/master.lib/file_create.asm
include libs/master.lib/file_exist.asm
include libs/master.lib/file_read.asm
include libs/master.lib/file_ropen.asm
include libs/master.lib/file_seek.asm
include libs/master.lib/file_size.asm
include libs/master.lib/file_write.asm
include libs/master.lib/dos_close.asm
include libs/master.lib/dos_ropen.asm
include libs/master.lib/grcg_boxfill.asm
include libs/master.lib/grcg_circlefill.asm
include libs/master.lib/grcg_circle.asm
include libs/master.lib/grcg_circle_x.asm
include libs/master.lib/grc_setclip.asm
include libs/master.lib/grcg_hline.asm
include libs/master.lib/grcg_line.asm
include libs/master.lib/grcg_pset.asm
include libs/master.lib/grcg_setcolor.asm
include libs/master.lib/grcg_vline.asm
include libs/master.lib/gdc_outpw.asm
include libs/master.lib/get_machine_98.asm
include libs/master.lib/get_machine_at.asm
include libs/master.lib/get_machine_dosbox.asm
include libs/master.lib/check_machine_fmr.asm
include libs/master.lib/get_machine.asm
include libs/master.lib/gaiji_backup.asm
include libs/master.lib/gaiji_entry_bfnt.asm
include libs/master.lib/gaiji_putca.asm
include libs/master.lib/gaiji_putsa.asm
include libs/master.lib/gaiji_read.asm
include libs/master.lib/gaiji_write.asm
include libs/master.lib/graph_400line.asm
include libs/master.lib/graph_clear.asm
include libs/master.lib/graph_extmode.asm
include libs/master.lib/graph_hide.asm
include libs/master.lib/graph_scrollup.asm
include libs/master.lib/iatan2.asm
include libs/master.lib/js_end.asm
include libs/master.lib/large_byte.asm
include libs/master.lib/super_large_put.asm
include libs/master.lib/palette_show.asm
include libs/master.lib/pfclose.asm
include libs/master.lib/pfgetc.asm
include libs/master.lib/pfread.asm
include libs/master.lib/pfrewind.asm
include libs/master.lib/pfseek.asm
include libs/master.lib/random.asm
include libs/master.lib/palette_entry_rgb.asm
include libs/master.lib/smem_release.asm
include libs/master.lib/smem_wget.asm
include libs/master.lib/soundio.asm
include libs/master.lib/text_clear.asm
include libs/master.lib/text_fillca.asm
include libs/master.lib/text_putca.asm
include libs/master.lib/text_putsa.asm
include libs/master.lib/vsync.asm
include libs/master.lib/vsync_wait.asm
include libs/master.lib/palette_white_in.asm
include libs/master.lib/palette_white_out.asm
include libs/master.lib/mem_assign_dos.asm
include libs/master.lib/mem_assign.asm
include libs/master.lib/memheap.asm
include libs/master.lib/mem_unassign.asm
include libs/master.lib/super_free.asm
include libs/master.lib/super_entry_pat.asm
include libs/master.lib/super_put_1plane.asm
include libs/master.lib/super_entry_at.asm
include libs/master.lib/super_entry_bfnt.asm
include libs/master.lib/super_cancel_pat.asm
include libs/master.lib/super_clean.asm
include libs/master.lib/super_roll_put_1plane.asm
include libs/master.lib/super_roll_put.asm
include libs/master.lib/super_put.asm
include libs/master.lib/super_convert_tiny.asm
include libs/master.lib/super_zoom.asm
include libs/master.lib/pfint21.asm
		db    0
include libs/master.lib/js_start.asm
include th03/formats/pfopen.asm
include libs/master.lib/pf_str_ieq.asm
include libs/master.lib/js_sense.asm
		db    0

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_3680	proc far

arg_0		= word ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah
arg_6		= word ptr  0Ch

		push	bp
		mov	bp, sp
		push	si
		push	di
		push	ds
		mov	ax, [bp+arg_6]
		sar	ax, 3
		mov	dx, [bp+arg_4]
		shl	dx, 6
		add	ax, dx
		shr	dx, 2
		add	ax, dx
		mov	di, ax
		mov	bx, [bp+arg_2]
		shl	bx, 6
		mov	ax, [bp+arg_0]
		cmp	ax, [bx+345Eh]
		ja	short loc_36EE
		shl	ax, 7
		mov	si, ax
		add	si, 40h
		mov	dx, [bx+345Ch]
		mov	ds, dx
		mov	ax, 0A800h
		mov	fs, ax
		assume fs:nothing
		mov	ax, 0B000h
		mov	gs, ax
		assume gs:nothing
		mov	ax, 0B800h
		mov	es, ax
		assume es:nothing
		mov	cx, 10h

loc_36CA:
		mov	ax, [si-40h]
		mov	fs:[di], ax
		mov	ax, [si-20h]
		mov	gs:[di], ax
		movsw
		add	di, 4Eh	; 'N'
		loop	loc_36CA
		sub	di, 500h
		mov	ax, 0E000h
		mov	es, ax
		assume es:nothing
		mov	cx, 10h

loc_36E8:
		movsw
		add	di, 4Eh	; 'N'
		loop	loc_36E8

loc_36EE:
		pop	ds
		pop	di
		pop	si
		pop	bp
		retf	8
sub_3680	endp

include libs/master.lib/bgm_bell_org.asm
include libs/master.lib/bgm_mget.asm
include libs/master.lib/bgm_read_sdata.asm
include libs/master.lib/bgm_timer.asm
include libs/master.lib/bgm_pinit.asm
include libs/master.lib/bgm_timerhook.asm
include libs/master.lib/bgm_play.asm
include libs/master.lib/bgm_sound.asm
include libs/master.lib/bgm_effect_sound.asm
include libs/master.lib/bgm_stop_play.asm
include libs/master.lib/bgm_set_tempo.asm
include libs/master.lib/bgm_init_finish.asm
include libs/master.lib/bgm_stop_sound.asm
include libs/master.lib/super_wave_put.asm
include libs/master.lib/ems_read.asm
include libs/master.lib/ems_allocate.asm
include libs/master.lib/ems_enablepageframe.asm
include libs/master.lib/ems_exist.asm
include libs/master.lib/ems_free.asm
include libs/master.lib/ems_movememoryregion.asm
include libs/master.lib/ems_setname.asm
include libs/master.lib/ems_write.asm
include libs/master.lib/ems_space.asm
_TEXT		ends

; ===========================================================================

; Segment type:	Pure code
main_01_TEXT	segment	word public 'CODE' use16
		assume cs:main_01
		;org 1
		assume es:nothing, ss:nothing, ds:_DATA, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_AAF2	proc near
		push	bp
		mov	bp, sp

loc_AAF5:
		mov	ax, vsync_Count1
		cmp	ax, word_266D0
		jb	short loc_AAF5
		mov	vsync_Count1, 0
		mov	word_266D0, 1
		pop	bp
		retn
sub_AAF2	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

; int __cdecl main(int argc, const char	**argv,	const char **envp)
public _main
_main		proc far

_argc		= word ptr  6
_argv		= dword	ptr  8
_envp		= dword	ptr  0Ch

		push	bp
		mov	bp, sp
		call	main_01:cfg_load_resident
		or	ax, ax
		jz	short loc_AB86
		mov	_mem_assign_paras, MEM_ASSIGN_PARAS_MAIN
		call	game_init_main pascal, ds, offset aUmx
		les	bx, _resident
		mov	eax, es:[bx+resident_t.rand]
		mov	random_seed, eax
		call	main_01:EmsSetup
		call	text_clear
		call	gaiji_backup
		push	ds
		push	offset aGameft_bft ; "GAMEFT.bft"
		call	gaiji_entry_bfnt
		les	bx, _resident
		mov	al, es:[bx+resident_t.bgm_mode]
		mov	ah, 0
		push	ax
		mov	al, es:[bx+resident_t.se_mode]
		mov	ah, 0
		push	ax
		call	snd_determine_modes
		call	snd_load pascal, ds, offset aMiko, SND_LOAD_SE

loc_AB6B:
		call	main_01:sub_AED0
		call	main_01:sub_AB88
		cmp	byte_266D2, 2
		jnz	short loc_AB7D
		call	main_01:sub_B29E
		jmp	short loc_AB6B
; ---------------------------------------------------------------------------

loc_AB7D:
		push	ds
		push	offset arg0	; "op"
		nopcall	main_01:GameCore

loc_AB86:
		pop	bp
		retf
_main		endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_AB88	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	word_266D0, 1
		push	1
		call	frame_delay
		call	main_01:far ptr	_input_reset_sense

loc_AB9E:
		call	_input_sense
		call	fp_23D90
		test	_key_det.hi, high INPUT_CANCEL
		jz	short loc_ABBA
		call	main_01:_pause
		or	ax, ax
		jz	short loc_ABBA
		mov	byte_266D2, 1

loc_ABBA:
		call	fp_255CA
		call	sub_19EE4
		call	_stage_vm
		cmp	byte_256A8, 0
		jnz	short loc_ABD4
		call	_boss_bg_render
		jmp	short loc_ABD8
; ---------------------------------------------------------------------------

loc_ABD4:
		call	fp_255AA

loc_ABD8:
		call	main_01:sub_BCF4
		call	main_01:circles_update
		call	sparks_update
		call	main_01:sub_10ABF
		call	main_01:sub_104B6
		call	bullets_update
		call	sub_17E59
		call	_midboss_update
		call	_boss_update
		call	items_update
		call	sub_13BCE
		call	_stage_render
		call	main_01:sub_1020A
		call	_boss_fg_render
		call	_midboss_render
		call	main_01:sub_10713
		call	main_01:sub_10552
		call	main_01:player_render
		call	main_01:grcg_setmode_rmw_1
		call	sub_13C5C
		call	main_01:sparks_render
		call	main_01:items_render
		call	main_01:loc_BD64
		call	main_01:bullets_render
		call	main_01:circles_render
		GRCG_OFF_CLOBBERING dx
		call	_overlay_text_fp
		call	_popup_fp
		call	main_01:sub_CD36
		call	main_01:far ptr	_input_reset_sense
		mov	ax, vsync_Count1
		cmp	ax, word_266D0
		jb	short loc_AC56
		mov	ax, 1
		jmp	short loc_AC58
; ---------------------------------------------------------------------------

loc_AC56:
		xor	ax, ax

loc_AC58:
		cwde
		add	_total_slow_frames, eax
		inc	_total_frames
		call	main_01:sub_AAF2
		cmp	_palette_changed, 0
		jz	short loc_AC7A
		call	far ptr	palette_show
		mov	_palette_changed, 0
		jmp	short $+2

loc_AC7A:
		call	main_01:sub_CCD6
		graph_accesspage _page_front
		graph_showpage _page_back
		mov	_page_front, al
		xor	_page_back, 1
		call	snd_se_update
		inc	_frames_unused
		mov	ax, _stage_frame
		mov	dx, ax
		inc	ax
		mov	_stage_frame, ax
		and	ax, 0Fh
		mov	_stage_frame_mod16, al
		and	al, 7
		mov	_stage_frame_mod8, al
		and	al, 3
		mov	_stage_frame_mod4, al
		and	al, 1
		mov	_stage_frame_mod2, al
		les	bx, _resident
		mov	al, es:[bx+resident_t.rem_lives]
		mov	ah, 0
		mov	si, ax
		cmp	si, 10
		jl	short loc_ACD1
		mov	ax, 3E8h
		jmp	short loc_ACDE
; ---------------------------------------------------------------------------

loc_ACD1:
		mov	ax, si
		imul	ax, 1F4h
		push	ax
		mov	ax, 1770h
		pop	dx
		sub	ax, dx

loc_ACDE:
		mov	si, ax
		mov	ax, _stage_frame
		xor	dx, dx
		div	si
		or	dx, dx
		jnz	short loc_ACF4
		push	1
		nopcall	_playperf_raise
		jmp	short $+2

loc_ACF4:
		call	main_01:score_update_and_render
		cmp	byte_266D2, 0
		jz	loc_AB9E
		pop	si
		pop	bp
		retn
sub_AB88	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_AD03	proc near
		push	bp
		mov	bp, sp
		push	si
		les	bx, _resident
		mov	es:[bx+resident_t.graze], 0
		mov	es:[bx+resident_t.miss_count], 0
		mov	es:[bx+resident_t.bombs_used], 0
		mov	es:[bx+resident_t.end_sequence], ES_INGAME
		cmp	es:[bx+resident_t.playchar_ascii], '0' + PLAYCHAR_MARISA
		jnz	short loc_AD2C
		mov	ax, PLAYCHAR_MARISA
		jmp	short loc_AD2E
; ---------------------------------------------------------------------------

loc_AD2C:
		xor	ax, ax

loc_AD2E:
		mov	_playchar, al
		xor	si, si
		jmp	short loc_AD3B
; ---------------------------------------------------------------------------

loc_AD35:
		mov	_score_lebcd[si], 0
		inc	si

loc_AD3B:
		cmp	si, SCORE_DIGITS
		jl	short loc_AD35
		mov	_power, 1
		les	bx, _resident
		mov	al, es:[bx+resident_t.credit_bombs]
		mov	es:[bx+resident_t.rem_bombs], al
		mov	al, es:[bx+resident_t.credit_lives]
		mov	es:[bx+resident_t.rem_lives], al
		call	main_01:bb_txt_load
		cmp	_playchar, PLAYCHAR_REIMU
		jnz	short loc_AD90
		mov	_player_option_patnum, PAT_OPTION_REIMU
		les	bx, _resident
		cmp	es:[bx+resident_t.shottype], SHOTTYPE_A
		jnz	short loc_AD7C
		mov	playchar_shot_funcs, offset SHOT_FUNCS_REIMU_A
		jmp	short loc_AD82
; ---------------------------------------------------------------------------

loc_AD7C:
		mov	playchar_shot_funcs, offset SHOT_FUNCS_REIMU_B

loc_AD82:
		mov	fp_256AA, offset sub_FFB4
		mov	fp_256AC, offset sub_1004D
		jmp	short loc_ADBB
; ---------------------------------------------------------------------------

loc_AD90:
		mov	_player_option_patnum, PAT_OPTION_MARISA
		les	bx, _resident
		cmp	es:[bx+resident_t.shottype], SHOTTYPE_A
		jnz	short loc_ADA9
		mov	playchar_shot_funcs, offset SHOT_FUNCS_MARISA_A
		jmp	short loc_ADAF
; ---------------------------------------------------------------------------

loc_ADA9:
		mov	playchar_shot_funcs, offset SHOT_FUNCS_MARISA_B

loc_ADAF:
		mov	fp_256AA, offset sub_FFB4
		mov	fp_256AC, offset sub_10113

loc_ADBB:
		les	bx, _resident
		cmp	es:[bx+resident_t.demo_num], 0
		jz	short loc_ADD7
		mov	_playperf, 28
		mov	_rank, RANK_HARD

loc_ADD0:
		mov	_turbo_mode, 1
		jmp	short loc_ADFC
; ---------------------------------------------------------------------------

loc_ADD7:
		mov	_playperf, 16
		cmp	stage_id, 6
		jnz	short loc_ADEA
		mov	_rank, RANK_EXTRA
		jmp	short loc_ADD0
; ---------------------------------------------------------------------------

loc_ADEA:
		les	bx, _resident
		mov	al, es:[bx+resident_t.rank]
		mov	_rank, al
		mov	al, es:[bx+resident_t.turbo_mode]
		mov	_turbo_mode, al

loc_ADFC:
		call	main_01:sub_EEB0
		call	main_01:sub_12CC7
		mov	al, _rank
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 4
		ja	loc_AEC2
		add	bx, bx
		jmp	cs:off_AEC6[bx]

loc_AE17:
		mov	score_2CFFE, 100
		mov	_playperf_min, 4
		mov	_playperf_max, 16
		mov	fp_2D000, offset sub_1CEEE
		mov	fp_2D002, offset sub_1CF4E
		mov	fp_2D004, offset sub_1CEC5
		jmp	loc_AEC2
; ---------------------------------------------------------------------------

loc_AE3C:
		mov	score_2CFFE, 250
		mov	_playperf_min, 11
		mov	_playperf_max, 24
		jmp	short loc_AEB0
; ---------------------------------------------------------------------------

loc_AE4E:
		mov	_playperf, 20
		mov	score_2CFFE, 400
		mov	_playperf_min, 20
		mov	_playperf_max, 32
		mov	fp_2D000, offset sub_1CF32
		mov	fp_2D002, offset sub_1CF86
		mov	fp_2D004, offset sub_1CED8
		jmp	short loc_AEC2
; ---------------------------------------------------------------------------

loc_AE77:
		mov	score_2CFFE, 500
		mov	_playperf, 22
		mov	_playperf_min, 22
		mov	_playperf_max, 34
		mov	fp_2D000, offset sub_1CF32
		mov	fp_2D002, offset sub_1CF86
		mov	fp_2D004, offset sub_1CEE3
		jmp	short loc_AEC2
; ---------------------------------------------------------------------------

loc_AEA0:
		mov	score_2CFFE, 2560
		mov	_playperf_min, 16
		mov	_playperf_max, 20

loc_AEB0:
		mov	fp_2D000, offset sub_1CF16
		mov	fp_2D002, offset sub_1CF6A
		mov	fp_2D004, offset sub_1CED0

loc_AEC2:
		pop	si
		pop	bp
		retn
sub_AD03	endp

; ---------------------------------------------------------------------------
		db 0
off_AEC6	dw offset loc_AE17
		dw offset loc_AE3C
		dw offset loc_AE4E
		dw offset loc_AE77
		dw offset loc_AEA0

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_AED0	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	word_213DE, 0
		mov	vsync_Count2, 0
		les	bx, _resident
		mov	al, es:[bx+resident_t.stage]
		mov	stage_id, al
		cmp	stage_id, 0
		jz	short loc_AEF9
		cmp	stage_id, 6
		jnz	short loc_AF4A

loc_AEF9:
		mov	word_213DE, 1
		call	text_fillca pascal, (' ' shl 16) + TX_BLACK + TX_REVERSE
		mov	fp_23D90, offset nullfunc_near
		call	main_01:sub_AD03
		les	bx, _resident
		cmp	es:[bx+resident_t.demo_num], 0
		jz	short loc_AF4A
		call	main_01:demo_load
		les	bx, _resident
		mov	al, es:[bx+resident_t.demo_stage]
		mov	es:[bx+resident_t.stage], al
		mov	stage_id, al
		mov	_power, 128
		add	al, '0'
		mov	es:[bx+resident_t.stage_ascii], al
		mov	fp_23D90, offset DemoPlay
		mov	random_seed, 13Eh

loc_AF4A:
		call	main_01:sub_12024
		graph_accesspage 0
		graph_showpage al
		push	ds
		push	offset aEye_rgb	; "eye.rgb"
		call	palette_entry_rgb
		call	far ptr	palette_show
		mov	PaletteTone, 0
		call	far ptr	palette_show
		call	main_01:sub_12024
		call	main_01:sub_10D4B
		call	main_01:sub_B1D0
		nopcall	main_01:hud_put
		call	main_01:sub_B616
		call	sub_19EBC
		cmp	word_213DE, 0
		jz	short loc_AFD5
		call	main_01:EmsLoad
		call	main_01:bb_playchar_load
		cmp	_playchar, PLAYCHAR_REIMU
		jnz	short loc_AFA0
		push	ds
		push	offset aMiko_bft ; "miko.bft"
		jmp	short loc_AFA4
; ---------------------------------------------------------------------------

loc_AFA0:
		push	ds
		push	offset aMari_bft ; "mari.bft"

loc_AFA4:
		call	super_entry_bfnt
		call	super_entry_bfnt pascal, ds, offset aMikod_bft ; "mikod.bft"
		call	super_entry_bfnt pascal, ds, offset aMiko32_bft ; "miko32.bft"
		call	super_entry_bfnt pascal, ds, offset aMiko16_bft ; "miko16.bft"
		mov	si, 20
		jmp	short loc_AFD0
; ---------------------------------------------------------------------------

loc_AFC9:
		call	super_convert_tiny pascal, si
		inc	si

loc_AFD0:
		cmp	si, 120
		jl	short loc_AFC9

loc_AFD5:
		les	bx, off_213E0
		mov	byte ptr es:[bx+2], '0'
		les	bx, _resident
		mov	al, es:[bx+resident_t.stage_ascii]
		les	bx, off_213E0
		mov	es:[bx+3], al
		mov	al, stage_id
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 6
		ja	loc_B144
		add	bx, bx
		jmp	cs:off_B1C2[bx]

loc_B003:
		mov	word_2CFF4, 9
		call	cdg_load_all pascal, 8, ds, offset aBss0_cd2
		les	bx, _resident
		mov	al, es:[bx+resident_t.playchar_ascii]
		les	bx, off_213E0
		mov	es:[bx+2], al
		call	super_entry_bfnt pascal, ds, offset aSt00_bft ; "st00.bft"
		call	stage1_setup
		les	bx, _resident
		cmp	es:[bx+resident_t.playchar_ascii], '0' + PLAYCHAR_REIMU
		jnz	short loc_B044
		push	ds
		push	offset aSt00_mpn ; "st00.mpn"
		jmp	loc_B141
; ---------------------------------------------------------------------------

loc_B044:
		push	ds
		push	offset aSt10_mpn ; "st10.mpn"
		jmp	loc_B141
; ---------------------------------------------------------------------------

loc_B04B:
		mov	word_2CFF4, 9
		call	cdg_load_all pascal, 8, ds, offset aBss1_cd2
		call	super_entry_bfnt pascal, ds, offset aSt01_bft ; "st01.bft"
		call	stage2_setup
		push	ds
		push	offset aSt01_mpn ; "st01.mpn"
		jmp	loc_B141
; ---------------------------------------------------------------------------

loc_B071:
		mov	word_2CFF4, 9
		call	cdg_load_all pascal, 8, ds, offset aBss2_cd2
		call	super_entry_bfnt pascal, ds, offset aSt02_bft ; "st02.bft"
		call	stage3_setup
		push	ds
		push	offset aSt02_mpn ; "st02.mpn"
		jmp	loc_B141
; ---------------------------------------------------------------------------

loc_B097:
		mov	word_2CFF4, 9
		cmp	_playchar, PLAYCHAR_REIMU
		jnz	short loc_B0AC
		push	8
		push	ds
		push	offset aKao3_cd2 ; "KAO3.CD2"
		jmp	short loc_B0B2
; ---------------------------------------------------------------------------

loc_B0AC:
		push	8
		push	ds
		push	offset aKao2_cd2 ; "KAO2.CD2"

loc_B0B2:
		call	cdg_load_all
		call	super_entry_bfnt pascal, ds, offset aSt03_bft ; "st03.bft"
		call	stage4_setup
		push	ds
		push	offset aSt03_mpn ; "st03.mpn"
		call	main_01:mptn_load
		mov	_stage_render, offset stage4_render
		jmp	short loc_B144
; ---------------------------------------------------------------------------

loc_B0D4:
		mov	word_2CFF4, 9
		call	cdg_load_all pascal, 8, ds, offset aBss4_cd2
		call	super_entry_bfnt pascal, ds, offset aSt04_bft ; "st04.bft"
		call	stage5_setup
		push	ds
		push	offset aSt04_mpn ; "st04.mpn"
		jmp	short loc_B141
; ---------------------------------------------------------------------------

loc_B0F9:
		mov	word_2CFF4, 9
		call	super_entry_bfnt pascal, ds, offset aSt05_bft ; "st05.bft"
		call	cdg_load_all pascal, 8, ds, offset aBss5_cd2
		call	stage6_setup
		push	ds
		push	offset aSt05_mpn ; "st05.mpn"
		jmp	short loc_B141
; ---------------------------------------------------------------------------

loc_B11E:
		mov	word_2CFF4, 9
		call	super_entry_bfnt pascal, ds, offset aSt06_bft ; "st06.bft"
		call	cdg_load_all pascal, 8, ds, offset aBss6_cd2
		call	stagex_setup
		push	ds
		push	offset aSt06_mpn ; "st06.mpn"

loc_B141:
		call	main_01:mptn_load

loc_B144:
		call	main_01:map_load
		call	main_01:std_load
		call	main_01:sub_CED4
		call	main_01:sub_BAA2
		graph_accesspage 0

loc_B156:
		cmp	vsync_Count2, 80h
		jb	short loc_B156
		push	1
		call	palette_black_out
		mov	PaletteTone, 100
		call	far ptr	palette_show
		call	main_01:sub_10D77
		call	main_01:tiles_render_all
		mov	_page_back, 1
		mov	_page_front, 0
		graph_accesspage 1
		graph_showpage 0
		call	main_01:tiles_render_all
		les	bx, _resident
		cmp	es:[bx+resident_t.demo_num], 0
		jnz	short loc_B1AE
		call	snd_load pascal, [off_213E0], SND_LOAD_SONG
		kajacall	KAJA_SONG_PLAY

loc_B1AE:
		nopcall	main_01:sub_CB99
		mov	_overlay_text_fp, offset sub_10DA3
		mov	_popup_fp, offset nullfunc_near
		pop	si
		pop	bp
		retn
sub_AED0	endp

; ---------------------------------------------------------------------------
off_B1C2	dw offset loc_B003
		dw offset loc_B04B
		dw offset loc_B071
		dw offset loc_B097
		dw offset loc_B0D4
		dw offset loc_B0F9
		dw offset loc_B11E

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_B1D0	proc near
		push	bp
		mov	bp, sp
		call	main_01:sub_11ECB
		mov	_stage_frame, 0
		mov	byte_2D00A, 0
		mov	_scroll_line, 0
		mov	word_25100, 0
		mov	_scroll_line_on_plane[0 * 2], 0
		mov	_scroll_line_on_plane[1 * 2], 0
		mov	_scroll_subpixel_line, 0
		mov	byte_25104, 0
		mov	byte_250FE, 0
		mov	word_255BE, 0
		mov	word_255C0, 0
		mov	_player_pos.cur.x, 192 * 16
		mov	_player_pos.cur.y, 320 * 16
		mov	_player_pos.prev.x, 192 * 16
		mov	_player_pos.prev.y, 320 * 16
		mov	word_2599A, 40h
		mov	word_2599C, 40h
		mov	word_2599E, 30h	; '0'
		mov	word_259A0, 30h	; '0'
		mov	byte_259A3, 0
		mov	_miss_time, 0
		mov	byte_259A9, 0
		mov	_player_invincibility_time, STAGE_START_INVINCIBILITY_FRAMES
		mov	_stage_point_items_collected, 0
		mov	_dream_items_collected, 0
		mov	fp_255CA, offset sub_CF44
		mov	_scroll_active, 1
		call	main_01:sub_1042A
		nopcall	main_01:sub_11DE6
		call	main_01:randring_fill
		call	sub_1DA1B
		call	main_01:sub_FFA4
		call	sparks_init
		call	hud_score_put
		call	sub_15D74
		call	main_01:sub_BCB2
		nopcall	main_01:hud_put
		mov	fp_255AC, offset tiles_render_all
		call	main_01:tiles_invalidate_reset
		pop	bp
		retn
sub_B1D0	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_B29E	proc near
		push	bp
		mov	bp, sp
		push	si
		call	bb_stage_free
		call	main_01:sub_CF1E
		call	main_01:std_free
		call	main_01:map_free
		call	super_clean pascal, (128 shl 16) or 256
		mov	si, 8
		jmp	short loc_B2C7
; ---------------------------------------------------------------------------

loc_B2C0:
		call	cdg_free pascal, si
		inc	si

loc_B2C7:
		cmp	si, 31
		jl	short loc_B2C0
		pop	si
		pop	bp
		retn
sub_B29E	endp

include th04/pause.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public demo_load
demo_load	proc near

var_4		= dword	ptr -4

		enter	4, 0
		call	hmem_allocbyte pascal, DEMO_N * 2
		mov	word ptr _DemoBuf+2, ax
		mov	word ptr _DemoBuf, 0
		mov	word ptr [bp+var_4+2], ds
		mov	word ptr [bp+var_4], 1EDh
		les	bx, _resident
		mov	al, es:[bx+resident_t.demo_num]
		add	al, '0'
		les	bx, [bp+var_4]
		mov	es:[bx+4], al
		push	word ptr [bp+var_4+2]
		push	bx
		call	file_ropen
		call	file_read pascal, large [_DemoBuf], DEMO_N * 2
		call	file_close
		leave
		retn
demo_load	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public DEMOPLAY
DemoPlay	proc near
		push	bp
		mov	bp, sp
		cmp	_key_det, INPUT_NONE
		jnz	short @@demo_end
		les	bx, _DemoBuf
		add	bx, _stage_frame
		mov	al, es:[bx]
		mov	ah, 0
		mov	_key_det, ax
		mov	ax, _stage_frame
		add	ax, DEMO_N
		mov	bx, word ptr _DemoBuf
		add	bx, ax
		mov	al, es:[bx]
		mov	_shiftkey, al
		cmp	_stage_frame, DEMO_N - 4
		jb	short @@demo_not_end

@@demo_end:
		push	word ptr _DemoBuf+2
		call	hmem_free
		push	10
		call	palette_black_out
		push	ds
		push	offset aOp_0	; "op"
		nopcall	main_01:GameCore

@@demo_not_end:
		pop	bp
		retn
DemoPlay	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public EMSSETUP
EmsSetup	proc near ; ZUN symbol [MAGNet2010]
		push	bp
		mov	bp, sp
		les	bx, _resident
		mov	al, es:[bx+resident_t.stage]
		mov	stage_id, al
		cmp	stage_id, 6
		jnz	short @@game_is_not_extra
		mov	_rank, RANK_EXTRA
		jmp	short loc_B4AF
; ---------------------------------------------------------------------------

@@game_is_not_extra:
		les	bx, _resident
		mov	al, es:[bx+resident_t.rank]
		mov	_rank, al

loc_B4AF:
		les	bx, eyename
		mov	al, _rank
		add	al, 30h	; '0'
		mov	es:[bx+3], al
		mov	_Ems, 0
		call	ems_exist
		or	ax, ax
		jz	short @@ret
		call	ems_space
		push	dx
		push	ax
		pop	eax
		cmp	eax, EMSSIZE
		jb	short @@ret
		call	ems_allocate pascal, EMSSIZE
		mov	_Ems, ax
		cmp	_Ems, 0
		jz	short @@ret
		push	ax
		push	ds
		push	offset aGensoems ; "GENSOEMS"
		call	ems_setname
		call	cdg_load_single_noalpha pascal, 31, [eyename], 0
		push	_Ems
		pushd	0
		push	_cdg_slots.sgm_colors + (size CDGSlot * 31)
		push	0
		mov	ax, _cdg_slots.bitplane_size + (size CDGSlot * 31)
		shl	ax, 2
		movzx	eax, ax
		push	eax
		call	ems_write
		call	cdg_free pascal, 31

@@ret:
		pop	bp
		retn
EmsSetup	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public EMSLOAD
EmsLoad	proc near ; ZUN symbol [MAGNet2010]

@@size		= dword	ptr -4 ; ZUN symbol [MAGNet2010]

		enter	4, 0
		push	si
		push	di
		les	bx, _resident
		mov	al, es:[bx+resident_t.playchar_ascii]
		les	bx, bbname
		mov	es:[bx+2], al
		call	cdg_load_single_noalpha pascal, 0, word ptr bbname+2, bx, 0
		cmp	_Ems, 0
		jz	@@ret
		push	_Ems
		pushd	34000
		push	_cdg_slots.sgm_colors + (size CDGSlot * 0)
		push	0
		mov	ax, _cdg_slots.bitplane_size + (size CDGSlot * 0)
		shl	ax, 2
		movzx	eax, ax
		push	eax
		call	ems_write
		cmp	_playchar, PLAYCHAR_REIMU
		jnz	short @@not_reimu
		push	2
		push	ds
		push	offset aKao0_cd2 ; "KAO0.cd2"
		jmp	short loc_B593
; ---------------------------------------------------------------------------

@@not_reimu:
		push	2
		push	ds
		push	offset aKao1_cd2 ; "KAO1.cd2"

loc_B593:
		call	cdg_load_all
		mov	si, 2
		mov	[bp+@@size], 94000
		mov	di, _cdg_slots.bitplane_size + (size CDGSlot * 2)
		jmp	short loc_B606
; ---------------------------------------------------------------------------

loc_B5A9:
		push	_Ems
		pushd	[bp+@@size]
		mov	bx, si
		shl	bx, 4
		push	_cdg_slots.sgm_alpha[bx]
		push	0
		movzx	eax, di
		push	eax
		call	ems_write
		movzx	eax, di
		add	[bp+@@size], eax
		push	_Ems
		pushd	[bp+@@size]
		mov	bx, si
		shl	bx, 4
		push	_cdg_slots.sgm_colors[bx]
		push	0
		mov	ax, di
		shl	ax, 2
		movzx	eax, ax
		push	eax
		call	ems_write
		mov	ax, di
		shl	ax, 2
		movzx	eax, ax
		add	[bp+@@size], eax
		call	cdg_free pascal, si
		inc	si

loc_B606:
		mov	bx, si
		shl	bx, 4
		cmp	_cdg_slots.sgm_alpha[bx], 0
		jnz	short loc_B5A9

@@ret:
		pop	di
		pop	si
		leave
		retn
EmsLoad	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_B616	proc near
		push	bp
		mov	bp, sp
		cmp	_Ems, 0
		jz	short loc_B64C
		mov	ax, _cdg_slots.bitplane_size + (size CDGSlot * 31)
		shl	ax, 2
		push	ax
		call	hmem_allocbyte
		mov	_cdg_slots.sgm_colors + (size CDGSlot * 31), ax
		push	_Ems
		pushd	0
		push	ax
		push	0
		mov	ax, _cdg_slots.bitplane_size + (size CDGSlot * 31)
		shl	ax, 2
		movzx	eax, ax
		push	eax
		call	ems_read
		jmp	short loc_B65A
; ---------------------------------------------------------------------------

loc_B64C:
		call	cdg_load_single_noalpha pascal, 31, [eyename], 0

loc_B65A:
		mov	PaletteTone, 0
		call	far ptr	palette_show
		push	(32 shl 16) or 112
		push	31
		call	cdg_put_noalpha
		call	cdg_free pascal, 31
		push	1
		call	palette_black_in
		pop	bp
		retn
sub_B616	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_B682	proc far

var_1		= byte ptr -1
arg_0		= word ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah

		enter	2, 0
		push	si
		push	di
		mov	si, [bp+arg_4]
		mov	di, [bp+arg_2]
		mov	ax, si
		sar	ax, 4
		mov	si, ax
		mov	al, _scroll_active
		mov	[bp+var_1], al
		mov	_scroll_active, 1
		lea	ax, [di+(16 shl 4)]
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, ax
		mov	di, ax
		mov	bx, 10h
		cwd
		idiv	bx
		shl	ax, 6
		push	ax
		mov	ax, si
		cwd
		idiv	bx
		add	ax, ax
		pop	bx
		add	bx, ax
		mov	ax, [bp+arg_0]
		mov	_tile_ring[bx], ax
		mov	al, [bp+var_1]
		mov	_scroll_active, al
		pop	di
		pop	si
		leave
		retf	6
sub_B682	endp

include th04/formats/std.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public END_GAME_GOOD
end_game_good	proc far
		push	bp
		mov	bp, sp
		les	bx, _resident
		mov	es:[bx+resident_t.end_sequence], ES_1CC
		mov	es:[bx+resident_t.end_type_ascii], '0'
		kajacall	KAJA_SONG_FADE, 4
		push	10h
		call	palette_black_out
		push	ds
		push	offset aMaine	; "maine"
		nopcall	main_01:GameCore
		pop	bp
		retf
end_game_good	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public END_GAME_BAD
end_game_bad	proc far
		push	bp
		mov	bp, sp
		les	bx, _resident
		mov	es:[bx+resident_t.end_sequence], ES_CONTINUED
		mov	es:[bx+resident_t.end_type_ascii], '1'
		kajacall	KAJA_SONG_FADE, 4
		push	10h
		call	palette_black_out
		push	ds
		push	offset aMaine_0	; "maine"
		nopcall	main_01:GameCore
		pop	bp
		retf
end_game_bad	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public END_EXTRA
end_extra	proc far
		push	bp
		mov	bp, sp
		les	bx, _resident
		mov	es:[bx+resident_t.end_sequence], ES_EXTRA
		kajacall	KAJA_SONG_FADE, 4
		push	10h
		call	palette_black_out
		push	ds
		push	offset aMaine_1	; "maine"
		nopcall	main_01:GameCore
		pop	bp
		retf
end_extra	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_B835	proc near

var_1		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		cmp	byte_25104, 0
		jnz	short loc_B84B
		cmp	byte_250FE, 0
		jz	loc_B8F8

loc_B84B:
		cmp	_scroll_speed, 0
		jz	loc_B8F8
		mov	ax, _scroll_line
		shr	ax, 4
		cmp	ax, word_25100
		jz	short loc_B8CE
		mov	word_25100, ax
		mov	bx, _std_seg
		mov	es, bx
		dec	_tile_row_in_section
		jns	short loc_B89D
		mov	_tile_row_in_section, 4
		inc	_tile_section
		inc	_tile_scrollspeed_ptr
		mov	bx, _tile_scrollspeed_ptr
		mov	dl, es:[bx]
		mov	_scroll_speed, dl
		or	dl, dl
		jnz	short loc_B89D
		mov	_scroll_line, 0
		mov	byte_250FE, 0

loc_B896:
		mov	byte_25104, 0
		jmp	short loc_B8F8
; ---------------------------------------------------------------------------

loc_B89D:
		shl	ax, 6
		add	ax, offset _tile_ring
		mov	di, ax
		xor	ax, ax
		mov	al, _tile_row_in_section
		shl	ax, 6
		mov	bx, _tile_section
		mov	bl, es:[bx]
		xor	bh, bh
		add	bl, bl
		mov	bx, [bx+93Ah]
		mov	si, ax
		add	si, bx
		push	ds
		pop	es
		assume es:_DATA
		push	ds
		mov	ax, map_seg
		mov	ds, ax
		mov	cx, TILES_X
		rep movsw
		pop	ds

loc_B8CE:
		mov	al, byte_250FE
		mov	[bp+var_1], al
		mov	al, byte_25104
		mov	byte_250FE, al
		mov	al, [bp+var_1]
		add	byte_25104, al
		cmp	_scroll_active, 0
		jz	short loc_B896
		call	main_01:egc_start_copy_inlined_noframe
		call	main_01:sub_BAEE
		mov	byte_25104, 0
		call	egc_off

loc_B8F8:
		pop	di
		pop	si
		leave
		retn
sub_B835	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public MPTN_LOAD
mptn_load	proc near

var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2
arg_0		= dword	ptr  4

		enter	6, 0
		push	si
		push	di
		push	0
		pushd	[bp+arg_0]
		call	mptn_load_inner
		mov	[bp+var_6], 0
		mov	[bp+var_2], 0
		mov	si, 240h
		jmp	short loc_B95E
; ---------------------------------------------------------------------------

loc_B91C:
		mov	[bp+var_4], 0
		xor	di, di
		jmp	short loc_B952
; ---------------------------------------------------------------------------

loc_B925:
		graph_accesspage 1
		push	si
		push	di
		push	0
		push	[bp+var_6]
		call	sub_3680
		graph_accesspage 0
		push	si
		push	di
		push	0
		push	[bp+var_6]
		call	sub_3680
		inc	[bp+var_6]
		inc	[bp+var_4]
		add	di, 10h

loc_B952:
		cmp	[bp+var_4], 19h
		jl	short loc_B925
		inc	[bp+var_2]
		add	si, 10h

loc_B95E:
		cmp	[bp+var_2], 4
		jl	short loc_B91C
		push	0
		call	mptn_free
		pop	di
		pop	si
		leave
		retn	4
mptn_load	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

map_load	proc near

@@mh		= map_header_t ptr -(size map_header_t)

		enter	size map_header_t, 0
		les	bx, _resident
		assume es:nothing
		mov	al, es:[bx+resident_t.stage_ascii]
		les	bx, off_21CBA
		mov	es:[bx+3], al
		push	word ptr off_21CBA+2
		push	bx
		call	file_ropen
		push	ss
		lea	ax, [bp+@@mh]
		push	ax
		push	size map_header_t
		call	file_read
		call	main_01:map_free
		push	[bp+@@mh.map_size]
		call	hmem_allocbyte
		mov	map_seg, ax
		push	ax
		push	0
		push	[bp+@@mh.map_size]
		call	file_read
		call	file_close
		leave
		retn
map_load	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

map_free	proc near
		push	bp
		mov	bp, sp
		cmp	map_seg, 0
		jz	short loc_B9D4
		push	map_seg
		call	hmem_free
		mov	map_seg, 0

loc_B9D4:
		pop	bp
		retn
map_free	endp

include th04/tiles_invalidate.asm

; =============== S U B	R O U T	I N E =======================================


sub_BAA2	proc near
		push	di
		push	si
		push	ds
		xor	bx, bx
		mov	di, offset _tile_ring
		add	di, TILES_MEMORY_X * (TILES_Y - 1) * 2
		xor	dx, dx
		mov	ax, ds
		mov	es, ax
		mov	ax, _std_seg
		mov	fs, ax
		mov	ax, map_seg
		mov	ds, ax
		mov	al, 5

loc_BAC0:
		xor	dx, dx
		mov	dl, fs:[bx]
		mov	si, dx
		add	si, si
		mov	si, es:[si+93Ah]
		add	si, 100h
		mov	ah, 5

loc_BAD4:
		mov	cx, TILES_X / 2
		rep movsd
		sub	di, (TILES_MEMORY_X + TILES_X) * 2
		sub	si, (TILES_MEMORY_X + TILES_X) * 2
		dec	ah
		jnz	short loc_BAD4
		inc	bx
		dec	al
		jnz	short loc_BAC0
		pop	ds
		pop	si
		pop	di
		retn
sub_BAA2	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================


sub_BAEE	proc near
		push	bp
		push	si
		push	di
		mov	ax, GRAM_400
		mov	es, ax
		assume es:nothing
		mov	dx, _scroll_line
		mov	ax, 4
		mov	cx, dx
		shl	cx, 6
		add	ax, cx
		shr	cx, 2
		add	ax, cx
		mov	word_25107, ax
		mov	ax, dx
		shr	ax, 4
		shl	ax, 6
		mov	bx, ax
		mov	si, _tile_ring[bx]
		mov	bx, dx
		and	bx, 0Fh
		mov	cx, bx
		shl	cx, 6
		mov	dx, cx
		shr	cx, 2
		add	dx, cx
		mov	word_25105, dx
		xor	ch, ch
		mov	cl, byte_25104
		mov	bh, bl
		add	bl, cl
		cmp	bl, 10h
		jbe	short loc_BB49
		sub	bl, 10h
		mov	cl, 10h
		sub	cl, bh
		mov	dh, bl
		jmp	short loc_BB4B
; ---------------------------------------------------------------------------

loc_BB49:
		xor	dh, dh

loc_BB4B:
		mov	dl, TILES_X
		mov	word_25109, cx

loc_BB51:
		mov	di, word_25107
		add	si, word_25105
		add	word_25107, 2
		mov	bl, dh

loc_BB60:
		mov	bp, es:[si]
		mov	es:[di], bp
		add	si, ROW_SIZE
		add	di, ROW_SIZE
		loop	loc_BB60
		or	bl, bl
		jz	short loc_BB8F
		mov	cl, bl
		mov	bx, ax
		add	bx, 40h
		cmp	di, 7D00h
		jb	short loc_BB87
		sub	di, 7D00h
		sub	bx, 640h

loc_BB87:
		mov	si, _tile_ring[bx]
		xor	bx, bx
		jmp	short loc_BB60
; ---------------------------------------------------------------------------

loc_BB8F:
		mov	cx, word_25109
		add	ax, 2
		mov	bx, ax
		mov	si, _tile_ring[bx]
		dec	dl
		jnz	short loc_BB51
		pop	di
		pop	si
		pop	bp
		retn
sub_BAEE	endp

include th04/tiles_redraw.asm
include th04/scroll_y_1.asm
MOTION_UPDATE_DEF 1
include th03/math/randring_fill.asm
RANDRING_NEXT_DEF 1
	nop

; =============== S U B	R O U T	I N E =======================================

public NULLFUNC_NEAR
nullfunc_near	proc near
		retn
nullfunc_near	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================


nullsub_2	proc far
		retf
nullsub_2	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================


sub_BCB2	proc near
		mov	byte_2520E, 0
		mov	byte_2520F, 0
		retn
sub_BCB2	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================


sub_BCBE	proc near
		push	si
		push	di
		mov	_tile_invalidate_box.y, 8
		mov	si, 9634h
		mov	di, 190h

loc_BCCC:
		cmp	byte ptr [si], 0
		jz	short loc_BCEA
		mov	ax, [si+0Ch]
		mov	_tile_invalidate_box.x, ax
		mov	ax, [si+2]
		cmp	byte ptr [si+0Eh], 0
		jz	short loc_BCE3
		add	ax, (8 shl 4)

loc_BCE3:
		call	main_01:tiles_invalidate_around pascal, word ptr [si+6], ax

loc_BCEA:
		add	si, 10h
		dec	di
		jnz	short loc_BCCC
		pop	di
		pop	si
		retn
sub_BCBE	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================


sub_BCF4	proc near
		push	si
		push	di
		mov	word_25532, 0
		mov	bx, 3ED0h
		mov	si, 9634h
		mov	di, 190h

loc_BD05:
		cmp	byte ptr [si], 0
		jz	short loc_BD57
		cmp	byte ptr [si], 2
		jnz	short loc_BD14
		mov	byte ptr [si], 0
		jmp	short loc_BD57
; ---------------------------------------------------------------------------

loc_BD14:
		mov	cl, [si+1]
		mov	ax, [si+4]
		mov	[si+6],	ax
		cmp	cl, 18h
		jb	short loc_BD25
		sub	ax, 8

loc_BD25:
		mov	[si+4],	ax
		cmp	ax, 0FFC0h
		jg	short loc_BD32
		mov	byte ptr [si], 2
		jmp	short loc_BD57
; ---------------------------------------------------------------------------

loc_BD32:
		inc	cl
		mov	[si+1],	cl
		cmp	cl, 24h	; '$'
		jbe	short loc_BD41
		mov	byte ptr [si], 2
		jmp	short loc_BD57
; ---------------------------------------------------------------------------

loc_BD41:
		mov	[bx], si
		cmp	di, 0C8h
		ja	short loc_BD54
		cmp	word_25532, 0
		jnz	short loc_BD54
		mov	word_25532, si

loc_BD54:
		add	bx, 2

loc_BD57:
		add	si, 10h
		dec	di
		jnz	short loc_BD05
		mov	word ptr [bx], 0
		pop	di
		pop	si
		retn
sub_BCF4	endp

; ---------------------------------------------------------------------------

loc_BD64:
		push	bp
		push	si
		push	di
		mov	dx, 7Eh	; '~'
		mov	al, 0FFh
		cli
		out	dx, al
		out	dx, al
		out	dx, al
		out	dx, al
		sti
		mov	ax, GRAM_400
		mov	es, ax
		mov	di, 3ED0h
		mov	si, [di]
		cmp	si, 0
		jz	short loc_BDFA

loc_BD81:
		cmp	si, word_25532
		jnz	short loc_BD96
		mov	dx, 7Eh	; '~'
		mov	al, 0FFh
		cli
		out	dx, al
		out	dx, al
		xor	al, al
		out	dx, al
		mov	al, 0FFh
		out	dx, al
		sti

loc_BD96:
		mov	dx, [si+2]
		sar	dx, 4
		add	dx, 0Ch
		mov	ax, [si+4]
		add	ax, (12 shl 4)
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, ax
		mov	bp, 4
		add	si, 0Bh

loc_BDAF:
		cmp	byte ptr [si], 0
		jnz	short loc_BDBB
		add	dx, 4
		dec	si
		dec	bp
		jnz	short loc_BDAF

loc_BDBB:
		mov	cx, bp
		inc	cx
		shl	cx, 3
		mov	word ptr cs:loc_BDD6+3, cx

loc_BDC6:
		xor	cx, cx
		mov	cl, [si]
		call	main_01:numerals_draw
		dec	si
		dec	bp
		jnz	short loc_BDC6
		xor	cx, cx
		call	main_01:numerals_draw

loc_BDD6:
		mov	word ptr [si+5], 28h
		cmp	byte ptr [si+7], 0
		jz	short loc_BDF1
		add	word ptr [si+5], 10h
		mov	cx, 0Ah
		call	main_01:numerals_draw
		mov	cx, 0Bh
		call	main_01:numerals_draw

loc_BDF1:
		add	di, 2
		mov	si, [di]
		or	si, si
		jnz	short loc_BD81

loc_BDFA:
		pop	di
		pop	si
		pop	bp
		retn

; =============== S U B	R O U T	I N E =======================================

; (identical to the th05 version)

numerals_draw	proc near
		push	si
		push	di
		push	ax
		push	dx
		mov	si, dx
		mov	bx, ax
		sar	dx, 3
		shl	ax, 6
		add	dx, ax
		shr	ax, 2
		add	dx, ax
		mov	di, dx
		and	si, 7
		mov	ax, si
		shl	si, 4
		add	si, offset NUMERALS
		shl	cx, 7
		add	si, cx
		cmp	bx, 188h
		ja	short loc_BE33
		mov	cx, 8
		xor	bx, bx
		jmp	short loc_BE3E
; ---------------------------------------------------------------------------

loc_BE33:
		mov	cx, 190h	; value	table for switch statement
		sub	cx, bx
		mov	bx, 8
		sub	bx, cx		; jump table for switch	statement
		nop

loc_BE3E:
		lodsw
		or	ah, ah
		jz	short loc_BE48
		mov	es:[di], ax
		jmp	short loc_BE4F
; ---------------------------------------------------------------------------

loc_BE48:
		or	al, al
		jz	short loc_BE4F
		mov	es:[di], al

loc_BE4F:
		add	di, 50h	; 'P'
		loop	loc_BE3E
		or	bx, bx
		jz	short loc_BE60
		sub	di, 7D00h
		xchg	cx, bx
		jmp	short loc_BE3E
; ---------------------------------------------------------------------------

loc_BE60:
		pop	dx
		pop	ax
		add	dx, 8
		pop	di
		pop	si
		retn
numerals_draw	endp


; =============== S U B	R O U T	I N E =======================================


sub_BE68	proc near
		push	si
		push	di
		mov	cx, ax
		sar	ax, 3
		mov	di, ax
		and	cl, 7
		xor	ah, ah
		mov	al, [bx+0F8Ah]
		ror	ax, cl
		mov	bx, dx
		shl	dx, 6
		add	di, dx
		shr	dx, 2
		add	di, dx
		mov	dx, GRAM_400
		mov	es, dx
		shr	si, 4
		mov	cx, si
		add	cx, bx
		cmp	cx, 190h
		ja	short loc_BEA0
		mov	cx, si
		xor	dx, dx
		jmp	short loc_BEA9
; ---------------------------------------------------------------------------

loc_BEA0:
		mov	cx, 190h
		sub	cx, bx
		mov	dx, si
		sub	dx, cx

loc_BEA9:
		or	ah, ah
		jz	short loc_BEB6
		nop

loc_BEAE:
		stosw
		add	di, 4Eh	; 'N'
		loop	loc_BEAE
		jmp	short loc_BEBC
; ---------------------------------------------------------------------------

loc_BEB6:
		stosb
		add	di, 4Fh	; 'O'
		loop	loc_BEB6

loc_BEBC:
		or	dx, dx
		jz	short loc_BEC8
		sub	di, 7D00h
		xchg	cx, dx
		jmp	short loc_BEA9
; ---------------------------------------------------------------------------

loc_BEC8:
		pop	di
		pop	si
		retn
sub_BE68	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================


playfield_fillm_0_0_384_112	proc near
		push	di
		GRCG_FILL_PLAYFIELD_ROWS	112, 256
		pop	di
		retn
playfield_fillm_0_0_384_112	endp

include th04/hardware/fillm64-56_256-256.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_BF16	proc near

var_6		= word ptr -6
var_4		= word ptr -4
var_2		= byte ptr -2
var_1		= byte ptr -1
arg_0		= word ptr  4

		enter	6, 0
		push	di
		push	GC_TDW
		mov	al, byte_2CDCA
		mov	ah, 0
		push	ax
		call	grcg_setcolor
		mov	ax, word_2CDCE
		mov	fs, ax
		mov	di, [bp+arg_0]
		shl	di, 7
		mov	[bp+var_6], 10h

loc_BF39:
		mov	[bp+var_4], 20h	; ' '
		mov	[bp+var_2], 18h

loc_BF42:
		mov	al, fs:[di]
		mov	[bp+var_1], al

loc_BF48:
		test	[bp+var_1], 80h
		jz	short loc_BF65
		mov	ax, [bp+var_4]
		mov	dx, [bp+var_6]
		add	dx, _scroll_line
		cmp	dx, RES_Y
		jl	short loc_BF62
		sub	dx, RES_Y

loc_BF62:
		call	main_01:sub_11FC8

loc_BF65:
		shl	[bp+var_1], 1
		add	[bp+var_4], 10h
		dec	[bp+var_2]
		jz	short loc_BF7A
		test	[bp+var_2], 7
		jnz	short loc_BF48
		inc	di
		jmp	short loc_BF42
; ---------------------------------------------------------------------------

loc_BF7A:
		add	di, 2
		add	[bp+var_6], 10h
		cmp	[bp+var_6], 180h
		jb	short loc_BF39
		GRCG_OFF_CLOBBERING dx
		pop	di
		leave
		retn	2
sub_BF16	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_BF94	proc near

var_6		= dword	ptr -6
var_2		= byte ptr -2
var_1		= byte ptr -1
arg_0		= word ptr  4

		enter	6, 0
		push	di
		mov	_tile_invalidate_box, (2 shl 16) or 2
		mov	ax, _bb_stage_seg
		mov	fs, ax
		mov	di, [bp+arg_0]
		shl	di, 7
		mov	word ptr [bp+var_6+2], (8 shl 4)

loc_BFB2:
		mov	word ptr [bp+var_6], (8 shl 4)
		mov	[bp+var_2], 18h

loc_BFBB:
		mov	al, fs:[di]
		mov	[bp+var_1], al

loc_BFC1:
		test	[bp+var_1], 80h
		jnz	short loc_BFCE
		call	main_01:tiles_invalidate_around pascal, large [bp+var_6]

loc_BFCE:
		shl	[bp+var_1], 1
		add	word ptr [bp+var_6], (16 shl 4)
		dec	[bp+var_2]
		jz	short loc_BFE4
		test	[bp+var_2], 7
		jnz	short loc_BFC1
		inc	di
		jmp	short loc_BFBB
; ---------------------------------------------------------------------------

loc_BFE4:
		add	di, 2
		add	word ptr [bp+var_6+2], (16 shl 4)
		cmp	word ptr [bp+var_6+2], (PLAYFIELD_H shl 4)
		jb	short loc_BFB2
		pop	di
		leave
		retn	2
sub_BF94	endp


; =============== S U B	R O U T	I N E =======================================


playfield_fillm_96_112_288_256	proc near
		push	di
		mov	ax, GRAM_400 + ((112 + PLAYFIELD_Y) * ROW_SIZE) shr 4
		mov	es, ax
		assume es:nothing
		mov	di, (255 * ROW_SIZE) + PLAYFIELD_VRAM_X
		nop

@@left_rect:
		stosd
		stosd
		stosd
		sub	di, ROW_SIZE + 12
		jge	short @@left_rect
		GRCG_FILL_PLAYFIELD_ROWS	0, 112
		pop	di
		retn
playfield_fillm_96_112_288_256	endp


; =============== S U B	R O U T	I N E =======================================


sub_C01A	proc near
		mov	bx, sp
		push	ds
		push	si
		push	di
		mov	di, ax
		shl	ax, 2
		add	di, ax
		shl	di, 4
		mov	ax, cx
		and	cx, 7
		shr	ax, 3
		add	di, ax
		mov	bx, ss:[bx+2]
		shl	bx, 1
		mov	ds, word ptr [bx+2AC4h]
		xor	si, si
		mov	ch, 10h
		jcxz	short loc_C088
		mov	dx, 0FFFFh
		shr	dl, cl
		mov	dh, dl
		not	dh
		test	di, 1
		jnz	short loc_C06C

loc_C052:
		lodsw
		ror	ax, cl
		mov	bl, al
		and	al, dl
		and	bl, dh
		mov	es:[di], ax
		mov	es:[di+2], bl
		add	di, 50h	; 'P'
		dec	ch
		jnz	short loc_C052
		jmp	short loc_C093
; ---------------------------------------------------------------------------
		nop

loc_C06C:
		lodsw
		ror	ax, cl
		mov	bh, al
		and	al, dl
		and	bh, dh
		mov	bl, ah
		mov	es:[di], al
		mov	es:[di+1], bx
		add	di, 50h	; 'P'
		dec	ch
		jnz	short loc_C06C
		jmp	short loc_C093
; ---------------------------------------------------------------------------
		nop

loc_C088:
		lodsw
		mov	es:[di], ax
		add	di, 50h	; 'P'
		dec	ch
		jnz	short loc_C088

loc_C093:
		pop	di
		pop	si
		pop	ds
		retn	2
sub_C01A	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================


sub_C09A	proc near
		push	si
		push	di
		push	ds
		mov	bx, dx
		sar	ax, 3
		shl	dx, 6
		add	ax, dx
		shr	dx, 2
		add	ax, dx
		mov	di, ax
		shl	cx, 7
		mov	si, cx
		mov	ax, _bb_txt_seg
		mov	ds, ax
		cmp	bx, 170h
		ja	short loc_C0D9
		mov	cx, 20h	; ' '
		nop

loc_C0C2:
		lodsd
		or	eax, eax
		jz	short loc_C0D2
		stosd
		add	di, 4Ch	; 'L'
		loop	loc_C0C2
		jmp	short loc_C0F7
; ---------------------------------------------------------------------------

loc_C0D2:
		add	di, 50h	; 'P'
		loop	loc_C0C2
		jmp	short loc_C0F7
; ---------------------------------------------------------------------------

loc_C0D9:
		mov	ax, 20h	; ' '
		mov	cx, 190h
		sub	cx, bx
		sub	ax, cx

loc_C0E3:
		movsd
		add	di, 4Ch	; 'L'
		loop	loc_C0E3
		sub	di, 7D00h
		mov	cx, ax

loc_C0F0:
		movsd
		add	di, 4Ch	; 'L'
		loop	loc_C0F0

loc_C0F7:
		pop	ds
		pop	di
		pop	si
		retn
sub_C09A	endp

; ---------------------------------------------------------------------------
		nop
include th04/item/invalidate.asm

; =============== S U B	R O U T	I N E =======================================


playfield_fillm_0_0_384_192	proc near
		push	di
		GRCG_FILL_PLAYFIELD_ROWS	192, 176
		pop	di
		retn
playfield_fillm_0_0_384_192	endp

include th04/hardware/grcg_modecol.asm
include th04/item/splashes_render.asm
		db    0
include th04/spark_render.asm
include th04/sparks.asm
include th04/item/splash_dot_render.asm

; =============== S U B	R O U T	I N E =======================================


sub_C34E	proc near
		mov	bx, sp
		push	di
		mov	di, ss:[bx+4]
		mov	cx, ss:[bx+2]
		push	ds
		pop	es
		assume es:_DATA
		xor	ax, ax
		rep stosd
		pop	di
		retn	4
sub_C34E	endp

include th04/playperf.asm
include th04/select_for_rank.asm
include th04/formats/scoredat_code_asm.asm
include th04/formats/z_super_roll_put_tiny.asm
include th04/circles.asm
		db    0

; =============== S U B	R O U T	I N E =======================================


sub_C74C	proc near
		push	si
		push	di
		mov	_tile_invalidate_box, (32 shl 16) or 32
		mov	si, 8A92h
		mov	di, 20h	; ' '

loc_C75D:
		cmp	byte ptr [si], 0
		jz	short loc_C76E
		cmp	byte ptr [si], 3
		jz	short loc_C76E
		call	main_01:tiles_invalidate_around pascal, large dword ptr [si+6]

loc_C76E:
		add	si, 40h
		dec	di
		jnz	short loc_C75D
		pop	di
		pop	si
		retn
sub_C74C	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

midboss1_render	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		cmp	_midboss_phase, 1
		jnz	short loc_C7A1
		mov	ax, _midboss_pos.cur.x
		sar	ax, 4
		add	ax, 16
		mov	di, ax
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, _midboss_pos.cur.y
		mov	si, ax
		push	di
		push	ax
		mov	al, _midboss_sprite
		mov	ah, 0
		jmp	short loc_C7DD
; ---------------------------------------------------------------------------

loc_C7A1:
		cmp	_midboss_phase, 2
		jnz	short loc_C7E6
		mov	ax, _midboss_pos.cur.x
		sar	ax, 4
		mov	di, ax
		mov	ax, _midboss_pos.cur.y
		add	ax, (-16 shl 4)
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, ax
		mov	si, ax
		push	di
		push	ax
		mov	al, _midboss_sprite
		mov	ah, 0
		push	ax
		call	super_roll_put
		mov	ax, _midboss_pos.cur.y
		add	ax, (16 shl 4)
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, ax
		mov	si, ax
		push	di
		push	ax
		mov	al, _midboss_sprite
		mov	ah, 0
		inc	ax

loc_C7DD:
		push	ax

loc_C7DE:
		call	super_roll_put
		jmp	loc_C881
; ---------------------------------------------------------------------------

loc_C7E6:
		cmp	_midboss_phase, 3
		jnz	loc_C877
		mov	ax, _midboss_pos.cur.x
		sar	ax, 4
		mov	di, ax
		mov	ax, _midboss_pos.cur.y
		add	ax, (-16 shl 4)
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, ax
		mov	si, ax
		cmp	_midboss_damage_this_frame, 0
		jnz	short loc_C836
		push	di
		push	ax
		mov	ax, _stage_frame
		shr	ax, 3
		mov	bx, 5
		xor	dx, dx
		div	bx
		add	dx, 147
		push	dx
		call	super_roll_put
		mov	ax, _midboss_pos.cur.y
		add	ax, (16 shl 4)
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, ax
		mov	si, ax
		push	di
		push	ax
		push	146
		jmp	short loc_C7DE
; ---------------------------------------------------------------------------

loc_C836:
		push	di
		push	si
		mov	ax, _stage_frame
		shr	ax, 3
		mov	bx, 5
		xor	dx, dx
		div	bx
		add	dx, 147
		push	dx
		pushd	PLANE_PUT or GC_BRGI
		call	super_roll_put_1plane
		mov	ax, _midboss_pos.cur.y
		add	ax, (16 shl 4)
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, ax
		mov	si, ax
		call	super_roll_put_1plane pascal, di, ax, (146 shl 16) or 0, PLANE_PUT or GC_BRGI
		mov	_midboss_damage_this_frame, 0
		jmp	short loc_C881
; ---------------------------------------------------------------------------

loc_C877:
		cmp	_midboss_phase, PHASE_EXPLODE_BIG
		jnz	short loc_C881
		call	main_01:sub_11A9A

loc_C881:
		pop	di
		pop	si
		pop	bp
		retn
midboss1_render	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

midboss3_render	proc near

@@y		= word ptr -2

		enter	2, 0
		push	si
		push	di
		cmp	_midboss_pos.cur.y, 0
		jle	loc_C946
		cmp	_midboss_pos.cur.y, (368 shl 4)
		jge	loc_C946
		cmp	_midboss_pos.cur.x, 0
		jle	loc_C946
		cmp	_midboss_pos.cur.x, (384 shl 4)
		jge	loc_C946
		mov	ax, _midboss_pos.cur.x
		sar	ax, 4
		mov	di, ax
		mov	ax, _midboss_pos.cur.y
		add	ax, (-16 shl 4)
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, ax
		mov	[bp+@@y], ax
		cmp	_midboss_phase, PHASE_EXPLODE_BIG
		jnz	short loc_C8D2
		call	main_01:sub_11A9A
		jmp	short loc_C946
; ---------------------------------------------------------------------------

loc_C8D2:
		cmp	_midboss_phase, 2
		ja	short loc_C946
		mov	si, 144
		cmp	_midboss_sprite, 1
		jnz	short loc_C91E
		mov	ax, _midboss_phase_frame
		mov	bx, 32
		cwd
		idiv	bx
		cmp	dx, 16
		jge	short loc_C906
		mov	ax, _midboss_phase_frame
		mov	bx, 16
		cwd
		idiv	bx
		mov	bx, 4
		mov	ax, dx
		cwd
		idiv	bx
		add	si, ax
		jmp	short loc_C91E
; ---------------------------------------------------------------------------

loc_C906:
		mov	ax, _midboss_phase_frame
		mov	bx, 16
		cwd
		idiv	bx
		mov	bx, 4
		mov	ax, dx
		cwd
		idiv	bx
		mov	dx, 3
		sub	dx, ax
		add	si, dx

loc_C91E:
		cmp	_midboss_damage_this_frame, 0
		jnz	short loc_C931
		call	super_roll_put pascal, di, [bp+@@y], si
		jmp	short loc_C946
; ---------------------------------------------------------------------------

loc_C931:
		call	super_roll_put_1plane pascal, di, [bp+@@y], si, large PLANE_PUT or GC_BRGI
		mov	_midboss_damage_this_frame, 0

loc_C946:
		pop	di
		pop	si
		leave
		retn
midboss3_render	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

midbossx_render	proc near

@@patnum		= word ptr -6
@@y		= word ptr -4
@@x		= word ptr -2

		enter	6, 0
		cmp	_midboss_pos.cur.y, (-16 shl 4)
		jle	short locret_C999
		cmp	_midboss_pos.cur.x, (-16 shl 4)
		jle	short locret_C999
		cmp	_midboss_pos.cur.x, (392 shl 4)
		jge	short locret_C999
		mov	ax, _midboss_pos.cur.x
		sar	ax, 4
		add	ax, 16
		mov	[bp+@@x], ax
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, _midboss_pos.cur.y
		mov	[bp+@@y], ax
		mov	al, _stage_frame_mod16
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		add	ax, 148
		mov	[bp+@@patnum], ax
		call	super_roll_put pascal, [bp+@@x], [bp+@@y], ax

locret_C999:
		leave
		retn
midbossx_render	endp

; ---------------------------------------------------------------------------
		db    0

; =============== S U B	R O U T	I N E =======================================


sub_C99C	proc near
		mov	ax, word_2D006
		or	ax, ax
		jnz	short loc_C9A4
		retn
; ---------------------------------------------------------------------------

loc_C9A4:
		push	bp
		push	si
		push	di
		mov	bp, ax
		mov	bx, 86D2h

loc_C9AC:
		mov	di, [bx]
		mov	ax, di
		sar	di, 3
		mov	cx, [bx+2]
		shl	cx, 6
		add	di, cx
		shr	cx, 2
		add	di, cx
		and	ax, 7
		mov	si, ax
		shl	si, 4
		add	si, 179Ch
		shl	ax, 3
		mov	cx, 6
		or	ax, ax
		jz	short loc_C9F4
		cmp	di, 7B70h
		jb	short loc_C9EB

loc_C9DC:
		movsw
		add	di, 4Eh	; 'N'
		dec	cx
		cmp	di, 7D00h
		jb	short loc_C9DC
		sub	di, 7D00h

loc_C9EB:
		movsw
		add	di, 4Eh	; 'N'
		loop	loc_C9EB
		jmp	short loc_CA11
; ---------------------------------------------------------------------------
		nop

loc_C9F4:
		cmp	di, 7B70h
		jb	short loc_CA0A

loc_C9FA:
		movsb
		inc	si
		add	di, 4Fh	; 'O'
		dec	cx
		cmp	di, 7D00h
		jb	short loc_C9FA
		sub	di, 7D00h

loc_CA0A:
		movsb
		inc	si
		add	di, 4Fh	; 'O'
		loop	loc_CA0A

loc_CA11:
		sub	di, 0F0h
		jns	short loc_CA1B
		add	di, 7D00h

loc_CA1B:
		add	ax, 181Ch
		mov	[bx], di
		mov	[bx+2],	ax
		add	bx, 4
		dec	bp
		jnz	short loc_C9AC
		pop	di
		pop	si
		pop	bp
		retn
sub_C99C	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================


sub_CA2E	proc near
		mov	ax, word_2D006
		or	ax, ax
		jnz	short loc_CA36
		retn
; ---------------------------------------------------------------------------

loc_CA36:
		push	bp
		push	si
		push	di
		mov	bp, ax
		mov	bx, 86D2h

loc_CA3E:
		mov	di, [bx]
		mov	si, [bx+2]
		xor	dx, dx
		cmp	di, 7B70h
		jnb	short loc_CA51
		nop
		mov	cx, 5
		jmp	short loc_CA62
; ---------------------------------------------------------------------------

loc_CA51:
		mov	ax, 7D4Fh
		sub	ax, di
		mov	cx, 50h	; 'P'
		div	cx
		mov	cx, ax
		mov	dx, 5
		sub	dx, cx

loc_CA62:
		mov	ax, [si]
		jmp	short loc_CA67
; ---------------------------------------------------------------------------

loc_CA66:
		lodsw

loc_CA67:
		or	al, al
		jz	short loc_CA79
		or	ah, ah
		jz	short loc_CA74
		mov	es:[di], ax
		jmp	short loc_CA7D
; ---------------------------------------------------------------------------

loc_CA74:
		mov	es:[di], al
		jmp	short loc_CA7D
; ---------------------------------------------------------------------------

loc_CA79:
		mov	es:[di+1], ah

loc_CA7D:
		add	di, 50h	; 'P'
		loop	loc_CA66
		or	dx, dx
		jz	short loc_CA8E
		sub	di, 7D00h
		xchg	cx, dx
		jmp	short loc_CA66
; ---------------------------------------------------------------------------

loc_CA8E:
		add	bx, 4
		dec	bp
		jnz	short loc_CA3E
		pop	di
		pop	si
		pop	bp
		retn
sub_CA2E	endp


; =============== S U B	R O U T	I N E =======================================


sub_CA98	proc near
		push	si
		push	di
		mov	si, offset _bullets
		mov	di, BULLET_COUNT
		cmp	_bullet_clear_trigger, 0
		jnz	short loc_CACF
		cmp	_bullet_clear_time, 0
		jnz	short loc_CACF
		mov	_tile_invalidate_box, (PELLET_W shl 16) or PELLET_H
		mov	di, PELLET_COUNT

loc_CABA:
		cmp	[si+bullet_t.flag], 0
		jz	short loc_CAC6
		call	main_01:tiles_invalidate_around pascal, large dword ptr [si+bullet_t.pos.prev]

loc_CAC6:
		add	si, size bullet_t
		dec	di
		jnz	short loc_CABA
		mov	di, BULLET16_COUNT

loc_CACF:
		mov	_tile_invalidate_box, (BULLET16_W shl 16) or BULLET16_H

loc_CAD8:
		cmp	[si+bullet_t.flag], 0
		jz	short loc_CAFD
		cmp	[si+bullet_t.spawn_state], BSS_GRAZED
		jbe	short loc_CAF6
		shl	_tile_invalidate_box, 1
		call	main_01:tiles_invalidate_around pascal, large dword ptr [si+bullet_t.pos.prev]
		shr	_tile_invalidate_box, 1
		jmp	short loc_CAFD
; ---------------------------------------------------------------------------

loc_CAF6:
		call	main_01:tiles_invalidate_around pascal, large dword ptr [si+bullet_t.pos.prev]

loc_CAFD:
		add	si, size bullet_t
		dec	di
		jnz	short loc_CAD8
		mov	si, 9292h
		mov	di, 10h

loc_CB09:
		cmp	byte ptr [si], 0
		jz	short loc_CB24
		mov	ax, [si+0Eh]
		shr	ax, 3
		add	ax, 16
		mov	_tile_invalidate_box.x, ax
		mov	_tile_invalidate_box.y, ax
		call	main_01:tiles_invalidate_around pascal, large dword ptr [si+6]

loc_CB24:
		add	si, 2Ah	; '*'
		dec	di
		jnz	short loc_CB09
		pop	di
		pop	si
		retn
sub_CA98	endp

; ---------------------------------------------------------------------------
		nop
include th04/tiles_invalidate_all.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CB58	proc near
		push	bp
		mov	bp, sp
		call	main_01:sub_10EED
		call	main_01:player_invalidate
		call	main_01:sub_10444
		call	main_01:sub_C74C
		call	main_01:sub_CA98
		call	items_invalidate
		call	sparks_invalidate
		call	main_01:sub_BCBE
		call	_midboss_invalidate?
		call	_stage_invalidate
		call	main_01:tiles_redraw_invalidated
		pop	bp
		retn
sub_CB58	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CB80	proc near
		push	bp
		mov	bp, sp
		call	main_01:tiles_render_all
		dec	byte_255B0
		cmp	byte_255B0, 0
		jnz	short loc_CB97
		mov	_boss_bg_render, offset sub_CB58

loc_CB97:
		pop	bp
		retn
sub_CB80	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CB99	proc far
		push	bp
		mov	bp, sp
		mov	_boss_bg_render, offset sub_CB58
		pop	bp
		retf
sub_CB99	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CBA4	proc far

arg_0		= byte ptr  6

		push	bp
		mov	bp, sp
		mov	al, [bp+arg_0]
		mov	byte_255B0, al
		mov	_boss_bg_render, offset sub_CB80
		pop	bp
		retf	2
sub_CBA4	endp

; ---------------------------------------------------------------------------
		db    0
include th04/tiles_render_all.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

midboss2_render	proc near

@@y		= word ptr -2

		enter	2, 0
		push	si
		push	di
		cmp	_midboss_pos.cur.y, 0
		jle	loc_CCD2
		mov	ax, _midboss_pos.cur.x
		sar	ax, 4
		mov	di, ax
		mov	ax, _midboss_pos.cur.y
		add	ax, (-16 shl 4)
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, ax
		mov	[bp+@@y], ax
		cmp	_midboss_phase, 2
		ja	short loc_CCD2
		cmp	_midboss_sprite, 0
		jnz	short loc_CC7C
		mov	al, _stage_frame_mod16
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		add	ax, 146
		jmp	short loc_CCA8
; ---------------------------------------------------------------------------

loc_CC7C:
		cmp	_midboss_sprite, 1
		jnz	short loc_CC93
		mov	al, _stage_frame_mod8
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		add	ax, 150
		jmp	short loc_CCA8
; ---------------------------------------------------------------------------

loc_CC93:
		cmp	_midboss_sprite, 2
		jnz	short loc_CCAA
		mov	al, _stage_frame_mod8
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		add	ax, 152

loc_CCA8:
		mov	si, ax

loc_CCAA:
		cmp	_midboss_damage_this_frame, 0
		jnz	short loc_CCBD
		call	super_roll_put pascal, di, [bp+@@y], si
		jmp	short loc_CCD2
; ---------------------------------------------------------------------------

loc_CCBD:
		call	super_roll_put_1plane pascal, di, [bp+@@y], si, large PLANE_PUT or GC_BRGI
		mov	_midboss_damage_this_frame, 0

loc_CCD2:
		pop	di
		pop	si
		leave
		retn
midboss2_render	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CCD6	proc near
		push	bp
		mov	bp, sp
		mov	al, _page_back
		mov	ah, 0
		add	ax, ax
		mov	dx, _scroll_line
		mov	bx, ax
		mov	_scroll_line_on_plane[bx], dx
		cmp	byte_250FE, 0
		jz	short loc_CCFE
		cmp	_scroll_active, 0
		jz	short loc_CCFE
		call	graph_scrollup pascal, dx

loc_CCFE:
		mov	_scroll_last_delta, 0
		mov	al, _scroll_subpixel_line
		add	al, _scroll_speed
		mov	_scroll_subpixel_line, al
		cmp	al, 16
		jb	short loc_CD31
		mov	ah, 0
		shr	ax, 4
		sub	_scroll_line, ax
		jns	short loc_CD23
		add	_scroll_line, RES_Y

loc_CD23:
		mov	byte_25104, al
		and	_scroll_subpixel_line, 0Fh
		shl	ax, 4
		mov	_scroll_last_delta, ax

loc_CD31:
		call	main_01:sub_B835
		pop	bp
		retn
sub_CCD6	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CD36	proc near
		push	bp
		mov	bp, sp
		cmp	word_255C2, 0
		jz	short loc_CD68
		cmp	_stage_frame_mod2, 0
		jnz	short loc_CD4C
		mov	ax, 0FFFEh
		jmp	short loc_CD4F
; ---------------------------------------------------------------------------

loc_CD4C:
		mov	ax, 2

loc_CD4F:
		mov	word_255BE, ax
		cmp	_stage_frame_mod4, 1
		ja	short loc_CD5E
		mov	ax, 0FFFEh
		jmp	short loc_CD61
; ---------------------------------------------------------------------------

loc_CD5E:
		mov	ax, 2

loc_CD61:
		mov	word_255C0, ax
		dec	word_255C2

loc_CD68:
		cmp	word_255BE, 0
		jge	short loc_CD88
		push	(PLAYFIELD_X shl 16) or 0
		push	((PLAYFIELD_RIGHT - 1) shl 16) or (RES_Y - 1)
		mov	ax, word_255BE
		neg	ax
		push	ax
		call	egc_shift_left
		jmp	short loc_CDA4
; ---------------------------------------------------------------------------

loc_CD88:
		cmp	word_255BE, 0
		jle	short loc_CDA9
		push	(PLAYFIELD_X shl 16) or 0
		push	((PLAYFIELD_RIGHT - 1) shl 16) or (RES_Y - 1)
		push	word_255BE
		call	egc_shift_right

loc_CDA4:
		mov	byte_22B9C, 2

loc_CDA9:
		cmp	word_255C0, 0
		jge	short loc_CDC9
		push	(PLAYFIELD_X shl 16) or 0
		push	((PLAYFIELD_RIGHT - 1) shl 16) or (RES_Y - 1)
		mov	ax, word_255C0
		neg	ax
		push	ax
		call	egc_shift_up
		jmp	short loc_CDE5
; ---------------------------------------------------------------------------

loc_CDC9:
		cmp	word_255C0, 0
		jle	short loc_CDEA
		push	(PLAYFIELD_X shl 16) or 0
		push	((PLAYFIELD_RIGHT - 1) shl 16) or (RES_Y - 1)
		push	word_255C0
		call	egc_shift_down

loc_CDE5:
		mov	byte_22B9C, 2

loc_CDEA:
		cmp	byte_22B9C, 0	; value	table for switch statement
		jz	short loc_CE04
		dec	byte_22B9C
		call	main_01:tiles_invalidate_all
		mov	word_255BE, 0
		mov	word_255C0, 0	; jump table for switch	statement

loc_CE04:
		pop	bp
		retn
sub_CD36	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

midboss4_render	proc near

@@y		= word ptr -2

		enter	2, 0
		push	si
		push	di
		cmp	_midboss_pos.cur.y, 0
		jle	short loc_CE8F
		cmp	_midboss_pos.cur.y, (368 shl 4)
		jge	short loc_CE8F
		cmp	_midboss_pos.cur.x, 0
		jle	short loc_CE8F
		cmp	_midboss_pos.cur.x, (384 shl 4)
		jge	short loc_CE8F
		mov	ax, _midboss_pos.cur.x
		sar	ax, 4
		mov	di, ax
		mov	ax, _midboss_pos.cur.y
		add	ax, (-16 shl 4)
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, ax
		mov	[bp+@@y], ax
		cmp	_midboss_phase, 2
		ja	short loc_CE85
		mov	al, _midboss_sprite
		mov	ah, 0
		add	ax, 9Ch
		mov	si, ax
		cmp	_midboss_pos.cur.x, (192 shl 4)
		jl	short loc_CE5B
		add	si, 4

loc_CE5B:
		cmp	_midboss_damage_this_frame, 0
		jnz	short loc_CE6E
		call	super_roll_put pascal, di, [bp+@@y], si
		jmp	short loc_CE8F
; ---------------------------------------------------------------------------

loc_CE6E:
		call	super_roll_put_1plane pascal, di, [bp+@@y], si, large PLANE_PUT or GC_BRGI
		mov	_midboss_damage_this_frame, 0
		jmp	short loc_CE8F
; ---------------------------------------------------------------------------

loc_CE85:
		cmp	_midboss_phase, PHASE_EXPLODE_BIG
		jnz	short loc_CE8F
		call	main_01:sub_11A9A

loc_CE8F:
		pop	di
		pop	si
		leave
		retn
midboss4_render	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CE93	proc near

arg_0		= dword	ptr  4

		push	bp
		mov	bp, sp
		push	si
		push	word ptr dword_255CC+2
		call	hmem_free
		pushd	[bp+arg_0]
		call	file_ropen
		call	file_size
		mov	si, ax
		push	ax
		call	hmem_allocbyte
		mov	word ptr dword_255CC+2,	ax
		mov	word ptr dword_255CC, 0
		push	ax
		push	word ptr dword_255CC
		push	si
		call	file_read
		call	file_close
		pop	si
		pop	bp
		retn	4
sub_CE93	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CED4	proc near
		push	bp
		mov	bp, sp
		les	bx, _resident
		assume es:nothing
		mov	al, es:[bx+resident_t.playchar_ascii]
		les	bx, off_22BAA
		mov	es:[bx+3], al
		les	bx, _resident
		mov	al, es:[bx+resident_t.stage_ascii]
		les	bx, off_22BAA
		mov	es:[bx+4], al
		push	word ptr off_22BAA+2
		push	bx
		call	main_01:sub_CE93
		pop	bp
		retn
sub_CED4	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CF01	proc far
		push	bp
		mov	bp, sp
		les	bx, _resident
		mov	al, es:[bx+resident_t.playchar_ascii]
		les	bx, off_22BAE
		mov	es:[bx+3], al
		push	word ptr off_22BAE+2
		push	bx
		call	main_01:sub_CE93
		pop	bp
		retf
sub_CF01	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CF1E	proc near
		push	bp
		mov	bp, sp
		cmp	dword_255CC, 0
		jz	short loc_CF3B
		push	word ptr dword_255CC+2
		call	hmem_free
		mov	dword_255CC, 0

loc_CF3B:
		pop	bp
		retn
sub_CF1E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CF3D	proc near
		push	bp
		mov	bp, sp
		mov	al, 0
		pop	bp
		retn
sub_CF3D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CF44	proc near
		push	bp
		mov	bp, sp
		cmp	_scroll_speed, 0
		jnz	short loc_CFB6
		cmp	_page_back, 1
		jnz	short loc_CFB6
		cmp	stage_id, 5
		jz	short loc_CF63
		cmp	stage_id, 6
		jnz	short loc_CF70

loc_CF63:
		call	cdg_free pascal, 31
		call	main_01:std_free
		call	main_01:map_free

loc_CF70:
		nopcall	main_01:sub_D6EB
		mov	fp_255CA, offset sub_CF3D
		mov	ax, _boss_bg_render_func
		mov	_boss_bg_render, ax
		mov	eax, _boss_update_func
		mov	_boss_update, eax
		mov	ax, _boss_fg_render_func
		mov	_boss_fg_render, ax
		mov	al, stage_id
		add	al, al
		add	al, 2
		mov	_bgm_title_id, al
		cmp	stage_id, 3
		jnz	short loc_CFAC
		cmp	_playchar, PLAYCHAR_REIMU
		jz	short loc_CFAC
		mov	_bgm_title_id, 10h

loc_CFAC:
		mov	_overlay_text_fp, offset sub_11195
		mov	al, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_CFB6:
		inc	_total_std_frames
		mov	al, 0
		pop	bp
		retn
sub_CF44	endp

include th04/formats/dialog_box_put.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D016	proc near
		push	bp
		mov	bp, sp
		push	di
		call	main_01:egc_start_copy_inlined_noframe
		mov	ax, GRAM_400 + (PLAYFIELD_Y * ROW_SIZE) shr 4
		mov	es, ax
		assume es:nothing
		mov	di, (PLAYFIELD_H - 1) * ROW_SIZE + PLAYFIELD_VRAM_X
		mov	dx, 0A6h
		mov	al, _page_front

loc_D02B:
		mov	cx, 18h

loc_D02E:
		out	dx, al
		xor	al, 1
		mov	bx, es:[di]
		out	dx, al
		xor	al, 1
		mov	es:[di], bx
		add	di, 2
		loop	loc_D02E
		sub	di, ROW_SIZE + PLAYFIELD_VRAM_W
		jge	short loc_D02B
		out	dx, al
		call	egc_off
		pop	di
		pop	bp
		retn
sub_D016	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D04E	proc near

arg_0		= word ptr  4
arg_2		= word ptr  6

		push	bp
		mov	bp, sp
		push	di
		call	main_01:egc_start_copy_inlined_noframe
		mov	ax, [bp+arg_0]
		mov	bx, ax
		shl	ax, 2
		add	ax, bx
		add	ax, GRAM_400
		mov	es, ax
		assume es:nothing
		mov	di, 127 * ROW_SIZE
		mov	ax, [bp+arg_2]
		shr	ax, 3
		add	di, ax
		mov	dx, 0A6h
		mov	al, _page_back

loc_D075:
		mov	cx, 8

loc_D078:
		out	dx, al
		xor	al, 1
		mov	bx, es:[di]
		out	dx, al
		xor	al, 1
		mov	es:[di], bx
		add	di, 2
		loop	loc_D078
		sub	di, ROW_SIZE + 16
		jge	short loc_D075
		call	egc_off
		pop	di
		pop	bp
		retn	4
sub_D04E	endp

include th04/formats/dialog_box_fade_in.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D0CA	proc near

var_2		= byte ptr -2
var_1		= byte ptr -1
arg_0		= dword	ptr  4

		enter	2, 0
		les	bx, dword_255CC
		mov	cl, es:[bx]
		inc	word ptr dword_255CC
		les	bx, dword_255CC
		mov	al, es:[bx]
		mov	[bp+var_1], al
		inc	word ptr dword_255CC
		les	bx, dword_255CC
		mov	al, es:[bx]
		mov	[bp+var_2], al
		inc	word ptr dword_255CC
		mov	al, cl
		mov	ah, 0
		mov	bx, ax
		test	byte ptr [bx+2719h], 2
		jnz	short loc_D114
		les	bx, [bp+arg_0]
		mov	ax, word_255D6
		mov	es:[bx], ax
		sub	word ptr dword_255CC, 3
		leave
		retn	4
; ---------------------------------------------------------------------------

loc_D114:
		mov	al, [bp+var_1]
		mov	ah, 0
		mov	bx, ax
		test	byte ptr [bx+2719h], 2
		jnz	short loc_D138
		mov	al, cl
		mov	ah, 0
		add	ax, 0FFD0h
		les	bx, [bp+arg_0]
		mov	es:[bx], ax
		sub	word ptr dword_255CC, 2
		leave
		retn	4
; ---------------------------------------------------------------------------

loc_D138:
		mov	al, [bp+var_2]
		mov	ah, 0
		mov	bx, ax
		test	byte ptr [bx+2719h], 2
		jnz	short loc_D168
		mov	al, cl
		mov	ah, 0
		add	ax, 0FFD0h
		imul	ax, 0Ah
		mov	dl, [bp+var_1]
		mov	dh, 0
		add	ax, dx
		add	ax, 0FFD0h
		les	bx, [bp+arg_0]
		mov	es:[bx], ax
		dec	word ptr dword_255CC
		leave
		retn	4
; ---------------------------------------------------------------------------

loc_D168:
		mov	al, cl
		mov	ah, 0
		add	ax, 0FFD0h
		imul	ax, 64h
		mov	dl, [bp+var_1]
		mov	dh, 0
		add	dx, 0FFD0h
		imul	dx, 0Ah
		add	ax, dx
		mov	dl, [bp+var_2]
		mov	dh, 0
		add	ax, dx
		add	ax, 0FFD0h
		les	bx, [bp+arg_0]
		mov	es:[bx], ax
		leave
		retn	4
sub_D0CA	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D193	proc near

arg_0		= dword	ptr  4

		push	bp
		mov	bp, sp
		les	bx, dword_255CC
		cmp	byte ptr es:[bx], 2Ch ;	','
		jnz	short loc_D1AF
		inc	word ptr dword_255CC
		pushd	[bp+arg_0]
		call	main_01:sub_D0CA
		pop	bp
		retn	4
; ---------------------------------------------------------------------------

loc_D1AF:
		les	bx, [bp+arg_0]
		mov	ax, word_255D6
		mov	es:[bx], ax
		pop	bp
		retn	4
sub_D193	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D1BC	proc near

var_18		= byte ptr -18h
var_8		= word ptr -8
@@y		= word ptr -6
@@x		= word ptr -4
var_2		= word ptr -2
arg_0		= byte ptr  4

		enter	18h, 0
		push	si
		push	di
		mov	al, [bp+arg_0]
		mov	ah, 0
		push	ax		; ch
		call	_tolower
		pop	cx
		mov	[bp+arg_0], al
		mov	ah, 0
		mov	[bp+var_8], ax
		mov	cx, 0Fh		; switch 15 cases
		mov	bx, offset word_D530

loc_D1DC:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_8]
		jz	short loc_D1EC
		add	bx, 2
		loop	loc_D1DC
		jmp	loc_D528	; default
; ---------------------------------------------------------------------------

loc_D1EC:
		jmp	word ptr cs:[bx+1Eh] ; switch jump

loc_D1F0:
		add	word_255D2, 10h	; jumptable 0000D1EC case 110
		cmp	word_255D4, 0
		jnz	short loc_D201
		mov	ax, 0A0h
		jmp	short loc_D204
; ---------------------------------------------------------------------------

loc_D201:
		mov	ax, 30h	; '0'

loc_D204:
		mov	word_255D0, ax
		jmp	loc_D528	; default
; ---------------------------------------------------------------------------

loc_D20A:
		mov	word_255D6, 64h	; 'd' ; jumptable 0000D1EC case 116
		push	ss
		lea	ax, [bp+var_2]
		push	ax
		call	main_01:sub_D0CA
		push	1
		call	frame_delay
		mov	ax, [bp+var_2]
		mov	PaletteTone, ax
		call	far ptr	palette_show
		jmp	loc_D528	; default
; ---------------------------------------------------------------------------

loc_D22D:
		les	bx, dword_255CC	; jumptable 0000D1EC case 102
		mov	al, es:[bx]
		mov	[bp+arg_0], al
		cmp	[bp+arg_0], 69h	; 'i'
		jz	short loc_D245
		cmp	[bp+arg_0], 6Fh	; 'o'
		jnz	loc_D528	; default

loc_D245:
		inc	word ptr dword_255CC
		mov	word_255D6, 1
		push	ss
		lea	ax, [bp+var_2]
		push	ax
		call	main_01:sub_D0CA
		cmp	[bp+arg_0], 69h	; 'i'
		jnz	short loc_D268
		push	[bp+var_2]
		call	palette_black_in
		jmp	loc_D528	; default
; ---------------------------------------------------------------------------

loc_D268:
		push	[bp+var_2]
		call	palette_black_out
		jmp	loc_D528	; default
; ---------------------------------------------------------------------------

loc_D273:
		les	bx, dword_255CC	; jumptable 0000D1EC case 119
		mov	al, es:[bx]
		mov	[bp+arg_0], al
		cmp	[bp+arg_0], 69h	; 'i'
		jz	short loc_D28B
		cmp	[bp+arg_0], 6Fh	; 'o'
		jnz	loc_D528	; default

loc_D28B:
		inc	word ptr dword_255CC
		mov	word_255D6, 1
		push	ss
		lea	ax, [bp+var_2]
		push	ax
		call	main_01:sub_D0CA
		cmp	[bp+arg_0], 69h	; 'i'
		jnz	short loc_D2AE
		push	[bp+var_2]
		call	palette_white_in
		jmp	loc_D528	; default
; ---------------------------------------------------------------------------

loc_D2AE:
		push	[bp+var_2]
		call	palette_white_out
		jmp	loc_D528	; default
; ---------------------------------------------------------------------------

loc_D2B9:
		les	bx, dword_255CC	; jumptable 0000D1EC case 103
		cmp	byte ptr es:[bx], 61h ;	'a'
		jz	short loc_D2FE
		mov	word_255D6, 8
		push	ss
		lea	ax, [bp+var_2]
		push	ax
		call	main_01:sub_D0CA
		xor	si, si
		jmp	short loc_D2EF
; ---------------------------------------------------------------------------

loc_D2D5:
		test	si, 1
		jz	short loc_D2DF
		push	4
		jmp	short loc_D2E2
; ---------------------------------------------------------------------------

loc_D2DF:
		push	RES_Y - 4

loc_D2E2:
		call	graph_scrollup
		push	1
		call	frame_delay
		inc	si

loc_D2EF:
		cmp	si, [bp+var_2]
		jle	short loc_D2D5
		call	graph_scrollup pascal, 0
		jmp	loc_D528	; default
; ---------------------------------------------------------------------------

loc_D2FE:
		inc	word ptr dword_255CC
		mov	word_255D6, 0
		push	ss
		lea	ax, [bp+var_2]
		push	ax
		call	main_01:sub_D0CA
		mov	ax, word_255D0
		mov	bx, 8
		cwd
		idiv	bx
		push	ax
		mov	ax, word_255D2
		mov	bx, 10h
		cwd
		idiv	bx
		push	ax
		push	[bp+var_2]
		push	TX_WHITE
		call	gaiji_putca
		add	word_255D0, 10h
		jmp	loc_D528	; default
; ---------------------------------------------------------------------------

loc_D337:
		mov	word_255D6, 0	; jumptable 0000D1EC case 107
		push	ss
		lea	ax, [bp+var_2]
		push	ax
		call	main_01:sub_D0CA
		call	input_wait_for_change pascal, [bp+var_2]
		jmp	loc_D478
; ---------------------------------------------------------------------------

loc_D350:
		mov	word_255D6, 1	; jumptable 0000D1EC case 61
		push	ss
		lea	ax, [bp+var_2]
		push	ax
		call	main_01:sub_D0CA
		push	1
		call	frame_delay
		cmp	word_255D4, 0
		jnz	short loc_D38A
		push	2000F0h
		call	main_01:sub_D04E
		cmp	[bp+var_2], 0FFh
		jz	loc_D528	; default
		add	[bp+var_2], 2
		push	2000F0h
		jmp	short loc_D3A6
; ---------------------------------------------------------------------------

loc_D38A:
		push	1200070h
		call	main_01:sub_D04E
		cmp	[bp+var_2], 0FFh
		jz	loc_D528	; default
		add	[bp+var_2], 8
		push	1200070h

loc_D3A6:
		push	[bp+var_2]
		call	cdg_put
		jmp	short loc_D3E3
; ---------------------------------------------------------------------------

loc_D3B0:
		mov	word_255D6, 0	; jumptable 0000D1EC case 98
		push	ss
		lea	ax, [bp+@@x]
		push	ax
		call	main_01:sub_D0CA
		push	ss
		lea	ax, [bp+@@y]
		push	ax
		call	main_01:sub_D193
		push	ss
		lea	ax, [bp+var_2]
		push	ax
		call	main_01:sub_D193
		push	1
		call	frame_delay
		call	super_roll_put pascal, [bp+@@x], [bp+@@y], [bp+var_2]

loc_D3E3:
		jmp	loc_D528	; default
; ---------------------------------------------------------------------------

loc_D3E6:
		les	bx, dword_255CC	; jumptable 0000D1EC case 109
		mov	al, es:[bx]
		mov	[bp+arg_0], al
		cmp	[bp+arg_0], 24h	; '$'
		jnz	short loc_D3FF
		inc	word ptr dword_255CC
		push	(KAJA_SONG_STOP shl 8)
		jmp	short loc_D40B
; ---------------------------------------------------------------------------

loc_D3FF:
		cmp	[bp+arg_0], 2Ah	; '*'
		jnz	short loc_D413
		inc	word ptr dword_255CC
		push	(KAJA_SONG_PLAY shl 8)

loc_D40B:
		call	snd_kaja_interrupt
		jmp	loc_D528	; default
; ---------------------------------------------------------------------------

loc_D413:
		cmp	[bp+arg_0], 2Ch	; ','
		jnz	loc_D528	; default
		inc	word ptr dword_255CC
		mov	[bp+var_2], 0
		jmp	short loc_D454
; ---------------------------------------------------------------------------

loc_D426:
		les	bx, dword_255CC
		mov	al, es:[bx]
		mov	[bp+arg_0], al
		inc	word ptr dword_255CC
		mov	ah, 0
		mov	bx, ax
		test	byte ptr [bx+2719h], 20h
		jnz	short loc_D45A
		cmp	[bp+arg_0], 20h	; ' '
		jz	short loc_D45A
		lea	bx, [bp+var_18]
		add	bx, [bp+var_2]
		mov	al, [bp+arg_0]
		mov	ss:[bx], al
		inc	[bp+var_2]

loc_D454:
		cmp	[bp+var_2], 0Ch
		jl	short loc_D426

loc_D45A:
		lea	bx, [bp+var_18]
		add	bx, [bp+var_2]
		mov	byte ptr ss:[bx], 0
		push	ss
		lea	ax, [bp+var_18]
		push	ax
		push	SND_LOAD_SONG
		call	snd_load
		kajacall	KAJA_SONG_PLAY

loc_D478:
		jmp	loc_D528	; default
; ---------------------------------------------------------------------------

loc_D47B:
		push	ss		; jumptable 0000D1EC case 101
		lea	ax, [bp+var_2]
		push	ax
		call	main_01:sub_D0CA
		call	snd_se_reset
		call	snd_se_play pascal, [bp+var_2]
		call	snd_se_update
		jmp	loc_D528	; default
; ---------------------------------------------------------------------------

loc_D498:
		call	super_clean pascal, (128 shl 16) or 256	; jumptable 0000D1EC case 99
		jmp	short loc_D508
; ---------------------------------------------------------------------------

loc_D4A5:
		les	bx, dword_255CC	; jumptable 0000D1EC case 108
		mov	al, es:[bx]
		mov	[bp+arg_0], al
		cmp	[bp+arg_0], 2Ch	; ','
		jnz	short loc_D528	; default
		inc	word ptr dword_255CC
		mov	[bp+var_2], 0
		jmp	short loc_D4EE
; ---------------------------------------------------------------------------

loc_D4C0:
		les	bx, dword_255CC
		mov	al, es:[bx]
		mov	[bp+arg_0], al
		inc	word ptr dword_255CC
		mov	ah, 0
		mov	bx, ax
		test	byte ptr [bx+2719h], 20h
		jnz	short loc_D4F4
		cmp	[bp+arg_0], 20h	; ' '
		jz	short loc_D4F4
		lea	bx, [bp+var_18]
		add	bx, [bp+var_2]
		mov	al, [bp+arg_0]
		mov	ss:[bx], al
		inc	[bp+var_2]

loc_D4EE:
		cmp	[bp+var_2], 0Ch
		jl	short loc_D4C0

loc_D4F4:
		lea	bx, [bp+var_18]
		add	bx, [bp+var_2]
		mov	byte ptr ss:[bx], 0
		push	ss
		lea	ax, [bp+var_18]
		push	ax
		call	super_entry_bfnt

loc_D508:
		jmp	short loc_D528	; default
; ---------------------------------------------------------------------------

loc_D50A:
		mov	di, 1		; jumptable 0000D1EC case 100
		jmp	short loc_D516
; ---------------------------------------------------------------------------

loc_D50F:
		call	cdg_free pascal, di
		inc	di

loc_D516:
		cmp	di, 32
		jl	short loc_D50F
		jmp	short loc_D528	; default
; ---------------------------------------------------------------------------

loc_D51D:
		call	input_wait_for_change pascal, 0		; jumptable 0000D1EC case 36

loc_D524:
		mov	al, 0FFh	; jumptable 0000D1EC case 35
		jmp	short loc_D52A
; ---------------------------------------------------------------------------

loc_D528:
		mov	al, 0		; default

loc_D52A:
		pop	di
		pop	si
		leave
		retn	2
sub_D1BC	endp

; ---------------------------------------------------------------------------
word_D530	dw    23h,   24h,   3Dh,   62h
		dw    63h,   64h,   65h,   66h ; value table for switch	statement
		dw    67h,   6Bh,   6Ch,   6Dh
		dw    6Eh,   74h,   77h
		dw offset loc_D524	; jump table for switch	statement
		dw offset loc_D51D
		dw offset loc_D350
		dw offset loc_D3B0
		dw offset loc_D498
		dw offset loc_D50A
		dw offset loc_D47B
		dw offset loc_D22D
		dw offset loc_D2B9
		dw offset loc_D337
		dw offset loc_D4A5
		dw offset loc_D3E6
		dw offset loc_D1F0
		dw offset loc_D20A
		dw offset loc_D273

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D56C	proc near

var_6		= dword	ptr -6
var_2		= byte ptr -2
var_1		= byte ptr -1

		enter	6, 0
		push	si
		push	di
		mov	word ptr [bp+var_6+2], ds
		mov	word ptr [bp+var_6], 18A0h

loc_D57A:
		les	bx, dword_255CC
		mov	al, es:[bx]
		mov	[bp+var_1], al
		inc	word ptr dword_255CC
		mov	ah, 0
		mov	bx, ax
		test	byte ptr [bx+2719h], 20h
		jnz	short loc_D57A
		cmp	[bp+var_1], 20h	; ' '
		jz	short loc_D57A
		cmp	[bp+var_1], 5Ch
		jnz	short loc_D5BA
		les	bx, dword_255CC
		mov	al, es:[bx]
		mov	[bp+var_1], al
		inc	word ptr dword_255CC
		push	word ptr [bp+var_1]
		call	main_01:sub_D1BC
		cmp	al, 0FFh
		jnz	short loc_D57A
		jmp	loc_D6E4
; ---------------------------------------------------------------------------

loc_D5BA:
		cmp	[bp+var_1], 30h	; '0'
		jz	short loc_D5C6
		cmp	[bp+var_1], 31h	; '1'
		jnz	short loc_D57A

loc_D5C6:
		cmp	[bp+var_1], 30h	; '0'
		jnz	short loc_D5E0
		mov	word_255D0, 0A0h
		mov	word_255D2, 140h
		mov	word_255D4, 0
		jmp	short loc_D5F2
; ---------------------------------------------------------------------------

loc_D5E0:
		mov	word_255D0, 30h	; '0'
		mov	word_255D2, 0C0h
		mov	word_255D4, 1

loc_D5F2:
		mov	ax, word_255D2
		mov	bx, 10h
		cwd
		idiv	bx
		mov	si, ax
		jmp	short loc_D62B
; ---------------------------------------------------------------------------

loc_D5FF:
		mov	ax, word_255D0
		mov	bx, 8
		cwd
		idiv	bx
		mov	di, ax
		jmp	short loc_D61A
; ---------------------------------------------------------------------------

loc_D60C:
		call	text_putca pascal, di, si, (' ' shl 16) + TX_WHITE
		inc	di

loc_D61A:
		mov	ax, word_255D0
		mov	bx, 8
		cwd
		idiv	bx
		add	ax, 1Eh
		cmp	ax, di
		jg	short loc_D60C
		inc	si

loc_D62B:
		mov	ax, word_255D2
		mov	bx, 10h
		cwd
		idiv	bx
		add	ax, 3
		cmp	ax, si
		jg	short loc_D5FF
		mov	[bp+var_2], 0

loc_D63F:
		call	main_01:far ptr	_input_reset_sense
		les	bx, dword_255CC
		mov	al, es:[bx]
		mov	[bp+var_1], al
		inc	word ptr dword_255CC
		mov	ah, 0
		mov	bx, ax
		test	byte ptr [bx+2719h], 20h
		jnz	short loc_D63F
		cmp	[bp+var_1], 20h	; ' '
		jz	short loc_D63F
		cmp	[bp+var_1], 5Ch
		jnz	short loc_D684
		les	bx, dword_255CC
		mov	al, es:[bx]
		mov	[bp+var_1], al
		inc	word ptr dword_255CC
		push	word ptr [bp+var_1]
		call	main_01:sub_D1BC
		cmp	al, 0FFh
		jnz	short loc_D63F
		jmp	loc_D57A
; ---------------------------------------------------------------------------

loc_D684:
		les	bx, [bp+var_6]
		mov	al, [bp+var_1]
		mov	es:[bx], al
		les	bx, dword_255CC
		mov	al, es:[bx]
		mov	[bp+var_1], al
		les	bx, [bp+var_6]
		mov	es:[bx+1], al
		inc	word ptr dword_255CC
		mov	ax, word_255D0
		mov	bx, 8
		cwd
		idiv	bx
		push	ax
		mov	ax, word_255D2
		mov	bx, 10h
		cwd
		idiv	bx
		push	ax
		pushd	[bp+var_6]
		push	TX_WHITE
		call	text_putsa
		add	word_255D0, 10h
		cmp	_key_det, INPUT_NONE
		jnz	short loc_D6D2
		push	2
		jmp	short loc_D6DC
; ---------------------------------------------------------------------------

loc_D6D2:
		test	[bp+var_2], 1
		jz	loc_D63F
		push	1

loc_D6DC:
		call	frame_delay
		jmp	loc_D63F
; ---------------------------------------------------------------------------

loc_D6E4:
		call	main_01:sub_10D4B
		pop	di
		pop	si
		leave
		retn
sub_D56C	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D6EB	proc far
		push	bp
		mov	bp, sp
		call	main_01:sub_D729
		call	main_01:sub_10D4B
		mov	PaletteTone, 100
		call	far ptr	palette_show
		graph_accesspage _page_front
		call	main_01:dialog_box_fade_in
		call	main_01:sub_D016
		call	main_01:sub_D56C
		push	2
		nopcall	main_01:sub_CBA4
		call	main_01:sub_D7EE
		graph_accesspage _page_back
		push	1
		call	frame_delay
		pop	bp
		retf
sub_D6EB	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D729	proc near

var_4		= dword	ptr -4

		enter	4, 0
		push	si
		push	di
		call	cdg_free pascal, 0
		cmp	_Ems, 0
		jz	loc_D7D0
		mov	[bp+var_4], 16F30h
		mov	si, _cdg_slots.bitplane_size + (size CDGSlot * 2)
		mov	di, 2
		jmp	short loc_D7C9
; ---------------------------------------------------------------------------

loc_D750:
		push	si
		call	hmem_allocbyte
		mov	bx, di
		shl	bx, 4
		mov	_cdg_slots.sgm_alpha[bx], ax
		push	_Ems
		pushd	[bp+var_4]
		mov	bx, di
		shl	bx, 4
		push	_cdg_slots.sgm_alpha[bx]
		push	0
		movzx	eax, si
		push	eax
		call	ems_read
		movzx	eax, si
		add	[bp+var_4], eax
		mov	ax, 4
		imul	si
		mov	si, ax
		push	si
		call	hmem_allocbyte
		mov	bx, di
		shl	bx, 4
		mov	_cdg_slots.sgm_colors[bx], ax
		push	_Ems
		pushd	[bp+var_4]
		mov	bx, di
		shl	bx, 4
		push	_cdg_slots.sgm_colors[bx]
		push	0
		movzx	eax, si
		push	eax
		call	ems_read
		movzx	eax, si
		add	[bp+var_4], eax
		mov	ax, si
		shr	ax, 2
		mov	si, ax
		inc	di

loc_D7C9:
		cmp	di, 8
		jl	short loc_D750
		jmp	short loc_D7EA
; ---------------------------------------------------------------------------

loc_D7D0:
		cmp	_playchar, PLAYCHAR_REIMU
		jnz	short loc_D7DF
		push	2
		push	ds
		push	offset aKao0_cd2_0 ; "KAO0.cd2"
		jmp	short loc_D7E5
; ---------------------------------------------------------------------------

loc_D7DF:
		push	2
		push	ds
		push	offset aKao1_cd2_0 ; "KAO1.cd2"

loc_D7E5:
		call	cdg_load_all

loc_D7EA:
		pop	di
		pop	si
		leave
		retn
sub_D729	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D7EE	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	si, 2
		jmp	short loc_D7FF
; ---------------------------------------------------------------------------

loc_D7F8:
		call	cdg_free pascal, si
		inc	si

loc_D7FF:
		cmp	si, 8
		jl	short loc_D7F8
		cmp	stage_id, 6
		jnz	short loc_D83A
		mov	si, 8
		jmp	short loc_D817
; ---------------------------------------------------------------------------

loc_D810:
		call	cdg_free pascal, si
		inc	si

loc_D817:
		cmp	si, 11
		jl	short loc_D810
		mov	al, byte_22BCA
		inc	byte_22BCA
		or	al, al
		jnz	short loc_D82F
		push	8
		push	ds
		push	offset aBss7_cd2 ; "bss7.cd2"
		jmp	short loc_D835
; ---------------------------------------------------------------------------

loc_D82F:
		push	8
		push	ds
		push	offset aBss8_cd2 ; "bss8.cd2"

loc_D835:
		call	cdg_load_all

loc_D83A:
		cmp	_Ems, 0
		jz	short loc_D86C
		mov	ax, _cdg_slots.bitplane_size + (size CDGSlot * 0)
		shl	ax, 2
		mov	di, ax
		push	ax
		call	hmem_allocbyte
		mov	_cdg_slots.sgm_colors + (size CDGSlot * 0), ax
		push	_Ems
		pushd	84D0h
		push	ax
		push	0
		movzx	eax, di
		push	eax
		call	ems_read
		jmp	short loc_D888
; ---------------------------------------------------------------------------

loc_D86C:
		cmp	_playchar, PLAYCHAR_REIMU
		jnz	short loc_D87B
		push	0
		push	ds
		push	offset aBb0_cdg	; "bb0.cdg"
		jmp	short loc_D881
; ---------------------------------------------------------------------------

loc_D87B:
		push	0
		push	ds
		push	offset aBb1_cdg	; "bb1.cdg"

loc_D881:
		push	0
		call	cdg_load_single_noalpha

loc_D888:
		pop	di
		pop	si
		pop	bp
		retn
sub_D7EE	endp

include th04/boss/explosions_small.asm
include th04/boss/explosions_big.asm

; ---------------------------------------------------------------------------

shot_marisa_l0	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jz	short loc_DA70
		mov	word ptr [si+0Eh], 22h ; '"'
		mov	byte ptr [si+10h], 0Ah

loc_DA70:
		pop	si
		pop	bp
		retn
shot_marisa_l0	endp

; ---------------------------------------------------------------------------

shot_marisa_l1	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jz	short loc_DAA3
		add	ax, 0Ah
		push	ax
		push	7
		call	main_01:randring1_next16_and
		add	al, 0BCh
		push	ax
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 22h ; '"'
		mov	byte ptr [si+10h], 0Ah

loc_DAA3:
		pop	si
		pop	bp
		retn
shot_marisa_l1	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_DAA6	proc near

arg_0		= byte ptr  4
arg_2		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		cmp	word_25608, 0
		jnz	short loc_DADA
		mov	ax, [bp+arg_2]
		mov	word_25608, ax
		mov	al, [bp+arg_0]
		mov	byte_2560A, al
		mov	ax, _player_option_pos_cur.x
		mov	word ptr dword_2560C, ax
		mov	ax, _player_option_pos_cur.y
		mov	word ptr dword_2560C+2,	ax
		mov	ax, _player_option_pos_cur.x
		mov	word ptr dword_25610, ax
		mov	ax, _player_option_pos_cur.y
		mov	word ptr dword_25610+2,	ax
		mov	byte_22C1A, 0

loc_DADA:
		cmp	word_25608, 30h	; '0'
		jb	short loc_DB45
		inc	byte_22C1A
		cmp	byte_22C1A, 4
		ja	short loc_DB39
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jz	short loc_DB17
		mov	word ptr [si+0Eh], 46h ; 'F'
		mov	byte ptr [si+10h], 9
		mov	word ptr [si+0Ch], 0FEE0h
		mov	ax, _player_option_pos_cur.x
		add	ax, (-24 shl 4)
		mov	[si+2],	ax

loc_DB17:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jz	short loc_DB45
		mov	word ptr [si+0Eh], 46h ; 'F'
		mov	byte ptr [si+10h], 9
		mov	word ptr [si+0Ch], 0FEE0h
		mov	ax, _player_option_pos_cur.x
		add	ax, (24 shl 4)
		mov	[si+2],	ax
		jmp	short loc_DB45
; ---------------------------------------------------------------------------

loc_DB39:
		cmp	byte_22C1A, 8
		jb	short loc_DB45
		mov	byte_22C1A, 0

loc_DB45:
		pop	si
		pop	bp
		retn	4
sub_DAA6	endp

; ---------------------------------------------------------------------------

shot_marisa_a_l2	proc near
		push	bp
		mov	bp, sp
		push	si
		push	40h
		push	0
		call	main_01:sub_DAA6
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_DB7C
; ---------------------------------------------------------------------------

loc_DB62:
		lea	ax, [si+0Ah]
		push	ax
		push	7
		call	main_01:randring1_next16_and
		add	al, 0BCh
		push	ax
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 22h ; '"'
		mov	byte ptr [si+10h], 9
		jmp	short loc_DB85
; ---------------------------------------------------------------------------

loc_DB7C:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_DB62

loc_DB85:
		pop	si
		pop	bp
		retn
shot_marisa_a_l2	endp

; ---------------------------------------------------------------------------

shot_marisa_a_l3	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	di, 2
		push	48h ; 'H'
		push	0
		call	main_01:sub_DAA6
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_DBC1
; ---------------------------------------------------------------------------

loc_DBA4:
		cmp	di, 2
		jnz	short loc_DBB0
		sub	word ptr [si+2], 80h
		jmp	short loc_DBB5
; ---------------------------------------------------------------------------

loc_DBB0:
		add	word ptr [si+2], 80h

loc_DBB5:
		mov	word ptr [si+0Eh], 22h ; '"'
		mov	byte ptr [si+10h], 9
		dec	di
		jle	short loc_DBCA

loc_DBC1:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_DBA4

loc_DBCA:
		pop	di
		pop	si
		pop	bp
		retn
shot_marisa_a_l3	endp

; ---------------------------------------------------------------------------

shot_marisa_a_l4	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	di, 2
		push	58h ; 'X'
		push	1
		call	main_01:sub_DAA6
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_DC07
; ---------------------------------------------------------------------------

loc_DBEA:
		cmp	di, 2
		jnz	short loc_DBF6
		sub	word ptr [si+2], 80h
		jmp	short loc_DBFB
; ---------------------------------------------------------------------------

loc_DBF6:
		add	word ptr [si+2], 80h

loc_DBFB:
		mov	word ptr [si+0Eh], 22h ; '"'
		mov	byte ptr [si+10h], 9
		dec	di
		jle	short loc_DC10

loc_DC07:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_DBEA

loc_DC10:
		pop	di
		pop	si
		pop	bp
		retn
shot_marisa_a_l4	endp

; ---------------------------------------------------------------------------

shot_marisa_a_l5	proc near
		enter	2, 0
		push	si
		push	di
		mov	di, 3
		push	68h ; 'h'
		push	1
		call	main_01:sub_DAA6
		mov	byte ptr [bp-1], 0B8h
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_DC53
; ---------------------------------------------------------------------------

loc_DC35:
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-1]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 22h ; '"'
		mov	byte ptr [si+10h], 8
		mov	al, [bp-1]
		add	al, 8
		mov	[bp-1],	al
		dec	di
		jle	short loc_DC5C

loc_DC53:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_DC35

loc_DC5C:
		pop	di
		pop	si
		leave
		retn
shot_marisa_a_l5	endp

; ---------------------------------------------------------------------------

shot_marisa_a_l6	proc near
		enter	2, 0
		push	si
		push	di
		mov	di, 3
		push	80h
		push	2
		call	main_01:sub_DAA6
		mov	byte ptr [bp-1], 0B8h
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_DCA0
; ---------------------------------------------------------------------------

loc_DC82:
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-1]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 22h ; '"'
		mov	byte ptr [si+10h], 8
		mov	al, [bp-1]
		add	al, 8
		mov	[bp-1],	al
		dec	di
		jle	short loc_DCA9

loc_DCA0:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_DC82

loc_DCA9:
		pop	di
		pop	si
		leave
		retn
shot_marisa_a_l6	endp

; ---------------------------------------------------------------------------

shot_marisa_a_l7	proc near
		enter	2, 0
		push	si
		push	di
		mov	di, 3
		push	90h
		push	3
		call	main_01:sub_DAA6
		mov	byte ptr [bp-1], 0B8h
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_DCED
; ---------------------------------------------------------------------------

loc_DCCF:
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-1]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 22h ; '"'
		mov	byte ptr [si+10h], 8
		mov	al, [bp-1]
		add	al, 8
		mov	[bp-1],	al
		dec	di
		jle	short loc_DCF6

loc_DCED:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_DCCF

loc_DCF6:
		pop	di
		pop	si
		leave
		retn
shot_marisa_a_l7	endp

; ---------------------------------------------------------------------------

shot_marisa_a_l8	proc near
		enter	2, 0
		push	si
		push	di
		mov	di, 5
		push	0A8h ; ''
		push	3
		call	main_01:sub_DAA6
		mov	byte ptr [bp-1], 0B4h
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_DD3A
; ---------------------------------------------------------------------------

loc_DD1C:
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-1]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 22h ; '"'
		mov	byte ptr [si+10h], 7
		mov	al, [bp-1]
		add	al, 6
		mov	[bp-1],	al
		dec	di
		jle	short loc_DD43

loc_DD3A:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_DD1C

loc_DD43:
		pop	di
		pop	si
		leave
		retn
shot_marisa_a_l8	endp

; ---------------------------------------------------------------------------

shot_marisa_a_l9	proc near
		enter	2, 0
		push	si
		push	di
		mov	di, 5
		push	0C0h
		push	4
		call	main_01:sub_DAA6
		mov	byte ptr [bp-1], 0B4h
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_DD87
; ---------------------------------------------------------------------------

loc_DD69:
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-1]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 22h ; '"'
		mov	byte ptr [si+10h], 7
		mov	al, [bp-1]
		add	al, 6
		mov	[bp-1],	al
		dec	di
		jle	short loc_DD90

loc_DD87:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_DD69

loc_DD90:
		pop	di
		pop	si
		leave
		retn
shot_marisa_a_l9	endp

; ---------------------------------------------------------------------------

shot_marisa_b_l2	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	di, 3
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_DDEA
; ---------------------------------------------------------------------------

loc_DDA9:
		cmp	di, 1
		jg	short loc_DDC8
		mov	word ptr [si+0Eh], 22h ; '"'
		lea	ax, [si+0Ah]
		push	ax
		push	7
		call	main_01:randring1_next16_and
		add	al, 0BCh
		push	ax
		call	main_01:shot_velocity_set
		mov	byte ptr [si+10h], 0Ah
		jmp	short loc_DDE7
; ---------------------------------------------------------------------------

loc_DDC8:
		cmp	di, 3
		jnz	short loc_DDD4
		sub	word ptr [si+2], 180h
		jmp	short loc_DDD9
; ---------------------------------------------------------------------------

loc_DDD4:
		add	word ptr [si+2], 180h

loc_DDD9:
		mov	word ptr [si+0Eh], 24h ; '$'
		mov	word ptr [si+0Ch], 0FF00h
		mov	byte ptr [si+10h], 6

loc_DDE7:
		dec	di
		jle	short loc_DDF3

loc_DDEA:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_DDA9

loc_DDF3:
		pop	di
		pop	si
		pop	bp
		retn
shot_marisa_b_l2	endp

; ---------------------------------------------------------------------------

shot_marisa_b_l3	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	di, 4
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_DE4F
; ---------------------------------------------------------------------------

loc_DE0C:
		cmp	di, 2
		jg	short loc_DE2D
		cmp	di, 2
		jnz	short loc_DE1D
		sub	word ptr [si+2], 80h
		jmp	short loc_DE22
; ---------------------------------------------------------------------------

loc_DE1D:
		add	word ptr [si+2], 80h

loc_DE22:
		mov	word ptr [si+0Eh], 22h ; '"'
		mov	byte ptr [si+10h], 9
		jmp	short loc_DE4C
; ---------------------------------------------------------------------------

loc_DE2D:
		cmp	di, 4
		jnz	short loc_DE39
		sub	word ptr [si+2], 180h
		jmp	short loc_DE3E
; ---------------------------------------------------------------------------

loc_DE39:
		add	word ptr [si+2], 180h

loc_DE3E:
		mov	word ptr [si+0Eh], 24h ; '$'
		mov	word ptr [si+0Ch], 0FF00h
		mov	byte ptr [si+10h], 6

loc_DE4C:
		dec	di
		jle	short loc_DE58

loc_DE4F:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_DE0C

loc_DE58:
		pop	di
		pop	si
		pop	bp
		retn
shot_marisa_b_l3	endp

; ---------------------------------------------------------------------------

shot_marisa_b_l4	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	di, 4
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_DEC9
; ---------------------------------------------------------------------------

loc_DE71:
		cmp	di, 2
		jg	short loc_DE92
		cmp	di, 2
		jnz	short loc_DE82
		sub	word ptr [si+2], 80h
		jmp	short loc_DE87
; ---------------------------------------------------------------------------

loc_DE82:
		add	word ptr [si+2], 80h

loc_DE87:
		mov	word ptr [si+0Eh], 22h ; '"'
		mov	byte ptr [si+10h], 9
		jmp	short loc_DEC6
; ---------------------------------------------------------------------------

loc_DE92:
		cmp	di, 4
		jnz	short loc_DE9E
		sub	word ptr [si+2], 180h
		jmp	short loc_DEA3
; ---------------------------------------------------------------------------

loc_DE9E:
		add	word ptr [si+2], 180h

loc_DEA3:
		mov	word ptr [si+0Eh], 24h ; '$'
		push	ds
		lea	ax, [si+0Ah]
		push	ax
		push	ds
		lea	ax, [si+0Ch]
		push	ax
		push	7
		call	main_01:randring1_next16_and
		add	al, 188
		push	ax
		push	(16 shl 4)
		call	vector2
		mov	byte ptr [si+10h], 6

loc_DEC6:
		dec	di
		jle	short loc_DED2

loc_DEC9:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_DE71

loc_DED2:
		pop	di
		pop	si
		pop	bp
		retn
shot_marisa_b_l4	endp

; ---------------------------------------------------------------------------

shot_marisa_b_l5	proc near
		enter	2, 0
		push	si
		push	di
		mov	di, 5
		mov	byte ptr [bp-1], 0B8h
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_DF49
; ---------------------------------------------------------------------------

loc_DEF0:
		cmp	di, 3
		jg	short loc_DF12
		mov	word ptr [si+0Eh], 22h ; '"'
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-1]
		call	main_01:shot_velocity_set
		mov	byte ptr [si+10h], 9
		mov	al, [bp-1]
		add	al, 8
		mov	[bp-1],	al
		jmp	short loc_DF46
; ---------------------------------------------------------------------------

loc_DF12:
		cmp	di, 5
		jnz	short loc_DF1E
		sub	word ptr [si+2], 180h
		jmp	short loc_DF23
; ---------------------------------------------------------------------------

loc_DF1E:
		add	word ptr [si+2], 180h

loc_DF23:
		push	ds
		lea	ax, [si+0Ah]
		push	ax
		push	ds
		lea	ax, [si+0Ch]
		push	ax
		push	7
		call	main_01:randring1_next16_and
		add	al, 188
		push	ax
		push	(16 shl 4)
		call	vector2
		mov	word ptr [si+0Eh], 24h ; '$'
		mov	byte ptr [si+10h], 5

loc_DF46:
		dec	di
		jle	short loc_DF52

loc_DF49:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_DEF0

loc_DF52:
		pop	di
		pop	si
		leave
		retn
shot_marisa_b_l5	endp

; ---------------------------------------------------------------------------

shot_marisa_b_l6	proc near
		enter	4, 0
		push	si
		push	di
		mov	di, 7
		mov	byte ptr [bp-3], 0B8h
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_DFD4
; ---------------------------------------------------------------------------

loc_DF70:
		cmp	di, 3
		jg	short loc_DF92
		mov	word ptr [si+0Eh], 22h ; '"'
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-3]
		call	main_01:shot_velocity_set
		mov	byte ptr [si+10h], 9
		mov	al, [bp-3]
		add	al, 8
		mov	[bp-3],	al
		jmp	short loc_DFD1
; ---------------------------------------------------------------------------

loc_DF92:
		mov	bx, di
		sub	bx, 4
		cmp	bx, 3
		ja	short loc_DFBD
		add	bx, bx
		jmp	cs:off_DFE2[bx]

loc_DFA3:
		mov	word ptr [bp-2], 0FE00h
		jmp	short loc_DFBD
; ---------------------------------------------------------------------------

loc_DFAA:
		mov	word ptr [bp-2], 0FF00h
		jmp	short loc_DFBD
; ---------------------------------------------------------------------------

loc_DFB1:
		mov	word ptr [bp-2], 200h
		jmp	short loc_DFBD
; ---------------------------------------------------------------------------

loc_DFB8:
		mov	word ptr [bp-2], 100h

loc_DFBD:
		mov	ax, [bp-2]
		sub	[si+2],	ax
		mov	word ptr [si+0Eh], 24h ; '$'
		mov	word ptr [si+0Ch], 0FF00h
		mov	byte ptr [si+10h], 5

loc_DFD1:
		dec	di
		jle	short loc_DFDD

loc_DFD4:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_DF70

loc_DFDD:
		pop	di
		pop	si
		leave
		retn
shot_marisa_b_l6	endp

; ---------------------------------------------------------------------------
		db    0
off_DFE2	dw offset loc_DFB8
		dw offset loc_DFB1
		dw offset loc_DFAA
		dw offset loc_DFA3

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

shot_marisa_b_l7	proc near

var_3		= word ptr -3

		enter	4, 0
		push	si
		push	di
		mov	di, 7
		mov	byte ptr [bp+var_3], 0B6h
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_E068
; ---------------------------------------------------------------------------

loc_E004:
		cmp	di, 3
		jg	short loc_E026
		mov	word ptr [si+0Eh], 22h ; '"'
		lea	ax, [si+0Ah]
		push	ax
		push	[bp+var_3]
		call	main_01:shot_velocity_set
		mov	byte ptr [si+10h], 8
		mov	al, byte ptr [bp+var_3]
		add	al, 0Ah
		mov	byte ptr [bp+var_3], al
		jmp	short loc_E065
; ---------------------------------------------------------------------------

loc_E026:
		mov	bx, di
		sub	bx, 4
		cmp	bx, 3
		ja	short loc_E051
		add	bx, bx
		jmp	cs:off_E076[bx]

loc_E037:
		mov	[bp+var_3+1], 0FE00h
		jmp	short loc_E051
; ---------------------------------------------------------------------------

loc_E03E:
		mov	[bp+var_3+1], 0FF00h
		jmp	short loc_E051
; ---------------------------------------------------------------------------

loc_E045:
		mov	[bp+var_3+1], 200h
		jmp	short loc_E051
; ---------------------------------------------------------------------------

loc_E04C:
		mov	[bp+var_3+1], 100h

loc_E051:
		mov	ax, [bp+var_3+1]
		sub	[si+2],	ax
		mov	word ptr [si+0Eh], 24h ; '$'
		mov	word ptr [si+0Ch], 0FF00h
		mov	byte ptr [si+10h], 5

loc_E065:
		dec	di
		jle	short loc_E071

loc_E068:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_E004

loc_E071:
		pop	di
		pop	si
		leave
		retn
shot_marisa_b_l7	endp

; ---------------------------------------------------------------------------
		db    0
off_E076	dw offset loc_E04C
		dw offset loc_E045
		dw offset loc_E03E
		dw offset loc_E037

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

shot_marisa_b_l8	proc near

var_3		= word ptr -3

		enter	4, 0
		push	si
		push	di
		mov	di, 8
		mov	byte ptr [bp+var_3], 0B6h
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	loc_E118
; ---------------------------------------------------------------------------

loc_E099:
		cmp	di, 4
		jg	short loc_E0D6
		cmp	di, 3
		jnz	short loc_E0AA
		sub	word ptr [si+2], 80h
		jmp	short loc_E0B4
; ---------------------------------------------------------------------------

loc_E0AA:
		cmp	di, 2
		jnz	short loc_E0B4
		add	word ptr [si+2], 80h

loc_E0B4:
		mov	word ptr [si+0Eh], 22h ; '"'
		lea	ax, [si+0Ah]
		push	ax
		push	[bp+var_3]
		call	main_01:shot_velocity_set
		mov	byte ptr [si+10h], 8
		cmp	di, 3
		jz	short loc_E115
		mov	al, byte ptr [bp+var_3]
		add	al, 0Ah
		mov	byte ptr [bp+var_3], al
		jmp	short loc_E115
; ---------------------------------------------------------------------------

loc_E0D6:
		mov	bx, di
		sub	bx, 5
		cmp	bx, 3
		ja	short loc_E101
		add	bx, bx
		jmp	cs:off_E128[bx]

loc_E0E7:
		mov	[bp+var_3+1], 0FE00h
		jmp	short loc_E101
; ---------------------------------------------------------------------------

loc_E0EE:
		mov	[bp+var_3+1], 0FF00h
		jmp	short loc_E101
; ---------------------------------------------------------------------------

loc_E0F5:
		mov	[bp+var_3+1], 200h
		jmp	short loc_E101
; ---------------------------------------------------------------------------

loc_E0FC:
		mov	[bp+var_3+1], 100h

loc_E101:
		mov	ax, [bp+var_3+1]
		sub	[si+2],	ax
		mov	word ptr [si+0Eh], 24h ; '$'
		mov	word ptr [si+0Ch], 0FF00h
		mov	byte ptr [si+10h], 5

loc_E115:
		dec	di
		jle	short loc_E123

loc_E118:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	loc_E099

loc_E123:
		pop	di
		pop	si
		leave
		retn
shot_marisa_b_l8	endp

; ---------------------------------------------------------------------------
		db    0
off_E128	dw offset loc_E0FC
		dw offset loc_E0F5
		dw offset loc_E0EE
		dw offset loc_E0E7

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

shot_marisa_b_l9	proc near

var_3		= word ptr -3

		enter	4, 0
		push	si
		push	di
		mov	di, 0Ah
		mov	byte ptr [bp+var_3], 0B6h
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	loc_E1D8
; ---------------------------------------------------------------------------

loc_E14B:
		cmp	di, 4
		jg	short loc_E188
		cmp	di, 3
		jnz	short loc_E15C
		sub	word ptr [si+2], 80h
		jmp	short loc_E166
; ---------------------------------------------------------------------------

loc_E15C:
		cmp	di, 2
		jnz	short loc_E166
		add	word ptr [si+2], 80h

loc_E166:
		mov	word ptr [si+0Eh], 22h ; '"'
		lea	ax, [si+0Ah]
		push	ax
		push	[bp+var_3]
		call	main_01:shot_velocity_set
		mov	byte ptr [si+10h], 8
		cmp	di, 3
		jz	short loc_E1D5
		mov	al, byte ptr [bp+var_3]
		add	al, 0Ah
		mov	byte ptr [bp+var_3], al
		jmp	short loc_E1D5
; ---------------------------------------------------------------------------

loc_E188:
		mov	bx, di
		sub	bx, 5
		cmp	bx, 5
		ja	short loc_E1C1
		add	bx, bx
		jmp	cs:off_E1E8[bx]

loc_E199:
		mov	[bp+var_3+1], 0FD00h
		jmp	short loc_E1C1
; ---------------------------------------------------------------------------

loc_E1A0:
		mov	[bp+var_3+1], 0FE00h
		jmp	short loc_E1C1
; ---------------------------------------------------------------------------

loc_E1A7:
		mov	[bp+var_3+1], 0FF00h
		jmp	short loc_E1C1
; ---------------------------------------------------------------------------

loc_E1AE:
		mov	[bp+var_3+1], 300h
		jmp	short loc_E1C1
; ---------------------------------------------------------------------------

loc_E1B5:
		mov	[bp+var_3+1], 200h
		jmp	short loc_E1C1
; ---------------------------------------------------------------------------

loc_E1BC:
		mov	[bp+var_3+1], 100h

loc_E1C1:
		mov	ax, [bp+var_3+1]
		sub	[si+2],	ax
		mov	word ptr [si+0Eh], 24h ; '$'
		mov	word ptr [si+0Ch], 0FF00h
		mov	byte ptr [si+10h], 4

loc_E1D5:
		dec	di
		jle	short loc_E1E3

loc_E1D8:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	loc_E14B

loc_E1E3:
		pop	di
		pop	si
		leave
		retn
shot_marisa_b_l9	endp

; ---------------------------------------------------------------------------
		db    0
off_E1E8	dw offset loc_E1BC
		dw offset loc_E1B5
		dw offset loc_E1AE
		dw offset loc_E1A7
		dw offset loc_E1A0
		dw offset loc_E199

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_E1F4	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		cmp	word_25608, 20h	; ' '
		jbe	loc_E2B4
		mov	al, byte_2560A
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 4
		ja	short loc_E276
		add	bx, bx
		jmp	cs:off_E2B9[bx]

loc_E215:
		cmp	word_25608, 28h	; '('
		ja	short loc_E262
		jmp	short loc_E257
; ---------------------------------------------------------------------------

loc_E21E:
		cmp	word_25608, 28h	; '('
		ja	short loc_E227
		jmp	short loc_E257
; ---------------------------------------------------------------------------

loc_E227:
		cmp	word_25608, 30h	; '0'
		ja	short loc_E26E
		jmp	short loc_E262
; ---------------------------------------------------------------------------

loc_E230:
		cmp	word_25608, 28h	; '('
		ja	short loc_E239
		jmp	short loc_E257
; ---------------------------------------------------------------------------

loc_E239:
		cmp	word_25608, 30h	; '0'
		ja	short loc_E242
		jmp	short loc_E262
; ---------------------------------------------------------------------------

loc_E242:
		cmp	word_25608, 38h	; '8'
		ja	short loc_E24B
		jmp	short loc_E26E
; ---------------------------------------------------------------------------

loc_E24B:
		mov	di, 3
		jmp	short loc_E276
; ---------------------------------------------------------------------------

loc_E250:
		cmp	word_25608, 28h	; '('
		ja	short loc_E25B

loc_E257:
		xor	di, di
		jmp	short loc_E276
; ---------------------------------------------------------------------------

loc_E25B:
		cmp	word_25608, 30h	; '0'
		ja	short loc_E267

loc_E262:
		mov	di, 1
		jmp	short loc_E276
; ---------------------------------------------------------------------------

loc_E267:
		cmp	word_25608, 38h	; '8'
		ja	short loc_E273

loc_E26E:
		mov	di, 2
		jmp	short loc_E276
; ---------------------------------------------------------------------------

loc_E273:
		mov	di, 4

loc_E276:
		mov	al, _stage_frame_mod2
		add	al, 8
		mov	ah, al
		call	main_01:grcg_setcolor_direct_noint_1
		mov	si, word ptr dword_2560C+2
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, (16 shl 4)
		mov	dx, ax
		mov	ax, word ptr dword_2560C
		sar	ax, 4
		add	ax, 4
		mov	bx, di
		call	main_01:sub_BE68
		mov	si, word ptr dword_2560C+2
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, (16 shl 4)
		mov	dx, ax
		mov	ax, word ptr dword_2560C
		sar	ax, 4
		add	ax, 34h	; '4'
		mov	bx, di
		call	main_01:sub_BE68

loc_E2B4:
		pop	di
		pop	si
		pop	bp
		retn
sub_E1F4	endp

; ---------------------------------------------------------------------------
		db 0
off_E2B9	dw offset loc_E257
		dw offset loc_E215
		dw offset loc_E21E
		dw offset loc_E230
		dw offset loc_E250

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_E2C3	proc near

var_A		= word ptr -0Ah
var_8		= word ptr -8
var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2

		push	bp
		mov	bp, sp
		sub	sp, 0Ah
		push	si
		push	di
		mov	si, 42F0h
		mov	[bp+var_2], 0
		jmp	loc_E44F
; ---------------------------------------------------------------------------

loc_E2D6:
		cmp	byte ptr [si], 0
		jz	loc_E449
		cmp	byte ptr [si], 1
		jnz	short loc_E316
		mov	ax, [si+2]
		sar	ax, 4
		add	ax, 20h	; ' '
		mov	[bp+var_4], ax
		mov	ax, [si+4]
		sar	ax, 4
		add	ax, 10h
		mov	[bp+var_6], ax
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 15
		call	grcg_vline pascal, [bp+var_4], [bp+var_6], PLAYFIELD_BOTTOM -1
		jmp	loc_E449
; ---------------------------------------------------------------------------

loc_E316:
		mov	ax, [si+2]
		sar	ax, 4
		add	ax, 20h	; ' '
		mov	[bp+var_4], ax
		mov	ax, [si+4]
		sar	ax, 4
		add	ax, [si+14h]
		add	ax, 10h
		mov	[bp+var_6], ax
		mov	ax, [bp+var_4]
		sub	ax, [si+14h]
		mov	[bp+var_8], ax
		mov	ax, [si+14h]
		add	ax, [bp+var_4]
		mov	[bp+var_A], ax
		mov	ax, [si+14h]
		mov	bx, 4
		cwd
		idiv	bx
		mov	di, ax
		cmp	di, 10h
		jle	short loc_E356
		mov	di, 10h

loc_E356:
		mov	ax, di
		cwd
		sub	ax, dx
		sar	ax, 1
		or	ax, ax
		jz	short loc_E3B1
		push	GC_RMW
		mov	al, [si+10h]
		mov	ah, 0
		push	ax
		call	grcg_setcolor
		call	grcg_circlefill pascal, [bp+var_4], [bp+var_6], word ptr [si+14h]
		push	[bp+var_8]
		push	[bp+var_6]
		mov	ax, di
		cwd
		sub	ax, dx
		sar	ax, 1
		add	ax, [bp+var_8]
		push	ax
		push	(PLAYFIELD_BOTTOM - 1)
		call	grcg_boxfill
		mov	ax, di
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	dx, [bp+var_A]
		sub	dx, ax
		push	dx
		push	[bp+var_6]
		push	[bp+var_A]
		push	(PLAYFIELD_BOTTOM - 1)
		call	grcg_boxfill

loc_E3B1:
		or	di, di
		jz	short loc_E416
		push	GC_RMW
		mov	al, [si+10h]
		mov	ah, 0
		inc	ax
		push	ax
		call	grcg_setcolor
		push	[bp+var_4]
		push	[bp+var_6]
		mov	ax, di
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	dx, [si+14h]
		sub	dx, ax
		push	dx
		call	grcg_circlefill
		mov	ax, di
		cwd
		sub	ax, dx
		sar	ax, 1
		add	ax, [bp+var_8]
		push	ax
		push	[bp+var_6]
		mov	ax, [bp+var_8]
		add	ax, di
		push	ax
		push	(PLAYFIELD_BOTTOM - 1)
		call	grcg_boxfill
		mov	ax, [bp+var_A]
		sub	ax, di
		push	ax
		push	[bp+var_6]
		mov	ax, di
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	dx, [bp+var_A]
		sub	dx, ax
		push	dx
		push	(PLAYFIELD_BOTTOM - 1)
		call	grcg_boxfill

loc_E416:
		add	[bp+var_8], di
		sub	[bp+var_A], di
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 15
		push	[bp+var_4]
		push	[bp+var_6]
		mov	ax, [si+14h]
		sub	ax, di
		push	ax
		call	grcg_circlefill
		call	grcg_boxfill pascal, [bp+var_8], [bp+var_6], [bp+var_A], (PLAYFIELD_BOTTOM - 1)

loc_E449:
		inc	[bp+var_2]
		add	si, 18h

loc_E44F:
		cmp	[bp+var_2], 2
		jl	loc_E2D6
		GRCG_OFF_CLOBBERING dx
		pop	di
		pop	si
		leave
		retn
sub_E2C3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_E461	proc near

var_1		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		cmp	byte_25660, 24h	; '$'
		jb	short loc_E47B
		call	main_01:sub_10D4B
		mov	_overlay_text_fp, offset nullfunc_near
		mov	al, 1
		jmp	short loc_E4CD
; ---------------------------------------------------------------------------

loc_E47B:
		mov	al, byte_25660
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_E4C7
		mov	al, byte_25660
		mov	ah, 0
		cwd
		idiv	bx
		mov	[bp+var_1], al
		cmp	[bp+var_1], 0
		jz	short loc_E4C7
		mov	si, 1
		jmp	short loc_E4C2
; ---------------------------------------------------------------------------

loc_E4A0:
		mov	di, 4
		jmp	short loc_E4BC
; ---------------------------------------------------------------------------

loc_E4A5:
		push	di
		push	si
		mov	al, [bp+var_1]
		mov	ah, 0
		mov	dx, 40h
		sub	dx, ax
		push	dx
		push	TX_BLACK
		call	gaiji_putca
		add	di, 2

loc_E4BC:
		cmp	di, 52
		jl	short loc_E4A5
		inc	si

loc_E4C2:
		cmp	si, 24
		jl	short loc_E4A0

loc_E4C7:
		inc	byte_25660
		mov	al, 0

loc_E4CD:
		pop	di
		pop	si
		leave
		retn
sub_E461	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_E4D1	proc near

var_1		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		cmp	byte_25660, 0
		jnz	short loc_E4EB
		call	main_01:sub_10D77
		mov	_overlay_text_fp, offset nullfunc_near
		mov	al, 1
		jmp	short loc_E53D
; ---------------------------------------------------------------------------

loc_E4EB:
		dec	byte_25660
		mov	al, byte_25660
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_E53B
		mov	al, byte_25660
		mov	ah, 0
		cwd
		idiv	bx
		mov	[bp+var_1], al
		cmp	[bp+var_1], 0
		jz	short loc_E53B
		mov	si, 1
		jmp	short loc_E536
; ---------------------------------------------------------------------------

loc_E514:
		mov	di, 4
		jmp	short loc_E530
; ---------------------------------------------------------------------------

loc_E519:
		push	di
		push	si
		mov	al, [bp+var_1]
		mov	ah, 0
		mov	dx, 40h
		sub	dx, ax
		push	dx
		push	TX_BLACK
		call	gaiji_putca
		add	di, 2

loc_E530:
		cmp	di, 52
		jl	short loc_E519
		inc	si

loc_E536:
		cmp	si, 24
		jl	short loc_E514

loc_E53B:
		mov	al, 0

loc_E53D:
		pop	di
		pop	si
		leave
		retn
sub_E4D1	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_E541	proc near

var_2		= word ptr -2

		enter	2, 0
		cmp	stage_id, 5
		jnz	short loc_E551
		nopcall	main_01:end_game_bad

loc_E551:
		mov	byte_25660, 20h	; ' '

loc_E556:
		call	main_01:sub_E4D1
		or	al, al
		jnz	short loc_E566
		push	1
		call	frame_delay
		jmp	short loc_E556
; ---------------------------------------------------------------------------

loc_E566:
		mov	PaletteTone, 50
		call	far ptr	palette_show

loc_E571:
		call	main_01:sub_E461
		or	al, al
		jnz	short loc_E581
		push	1
		call	frame_delay
		jmp	short loc_E571
; ---------------------------------------------------------------------------

loc_E581:
		mov	[bp+var_2], 32h	; '2'
		jmp	short loc_E5B5
; ---------------------------------------------------------------------------

loc_E588:
		call	gaiji_putca pascal, [bp+var_2], (12 shl 16) + 0B0h, TX_WHITE
		push	1
		call	frame_delay
		call	text_putsa pascal, [bp+var_2], 12, ds, offset asc_22C3F, TX_WHITE
		sub	[bp+var_2], 2

loc_E5B5:
		cmp	[bp+var_2], 8
		jg	short loc_E588
		mov	[bp+var_2], 8
		jmp	short loc_E5EF
; ---------------------------------------------------------------------------

loc_E5C2:
		call	gaiji_putca pascal, [bp+var_2], (12 shl 16) + 0B0h, TX_WHITE
		push	1
		call	frame_delay
		call	text_putsa pascal, [bp+var_2], 12, ds, offset asc_22C42, TX_WHITE
		add	[bp+var_2], 2

loc_E5EF:
		cmp	[bp+var_2], 14h
		jl	short loc_E5C2
		call	gaiji_putsa pascal, (20 shl 16) + 12, ds, offset gGAMEOVER, TX_WHITE
		call	input_wait_for_change pascal, 0
		call	main_01:sub_10D4B
		call	main_01:sub_E67A
		mov	ah, 0
		mov	[bp+var_2], ax
		mov	byte_25660, 20h	; ' '

loc_E61E:
		call	main_01:sub_E4D1
		or	al, al
		jnz	short loc_E62E
		push	1
		call	frame_delay
		jmp	short loc_E61E
; ---------------------------------------------------------------------------

loc_E62E:
		cmp	[bp+var_2], 0
		jnz	short loc_E654
		mov	PaletteTone, 100
		call	far ptr	palette_show

loc_E63F:
		call	main_01:sub_E461
		or	al, al
		jnz	short loc_E64F
		push	1
		call	frame_delay
		jmp	short loc_E63F
; ---------------------------------------------------------------------------

loc_E64F:
		call	main_01:sub_10D4B
		jmp	short loc_E675
; ---------------------------------------------------------------------------

loc_E654:
		les	bx, _resident
		assume es:nothing
		mov	es:[bx+resident_t.end_sequence], ES_SCORE
		kajacall	KAJA_SONG_FADE, 4
		push	4
		call	palette_black_out
		push	ds
		push	offset aMaine_2	; "maine"
		nopcall	main_01:GameCore

loc_E675:
		mov	al, byte ptr [bp+var_2]
		leave
		retn
sub_E541	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_E67A	proc near

var_2		= byte ptr -2
var_1		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		cmp	stage_id, 6
		jz	loc_E7D8
		xor	di, di
		mov	si, 1
		mov	al, 3
		sub	al, _continues_used
		mov	[bp+var_2], al
		cmp	[bp+var_2], 0
		jz	loc_E7D8
		call	gaiji_putsa pascal, (19 shl 16) + 10, ds, offset gCONTINUE?, TX_WHITE
		call	gaiji_putsa pascal, (24 shl 16) + 13, ds, offset gYES, TX_GREEN + TX_REVERSE
		call	gaiji_putsa pascal, (25 shl 16) + 15, ds, offset gNO, TX_WHITE
		call	gaiji_putsa pascal, (19 shl 16) + 22, ds, offset gCREDIT, TX_GREEN
		push	(33 shl 16) + 22
		mov	al, [bp+var_2]
		mov	ah, 0
		add	ax, 0A0h
		push	ax
		push	TX_GREEN
		call	gaiji_putca
		call	main_01:far ptr	_input_reset_sense

loc_E703:
		call	_input_sense
		or	si, si
		jnz	short loc_E783
		mov	si, _key_det
		test	si, INPUT_UP
		jnz	short loc_E71C
		test	si, INPUT_DOWN
		jz	short loc_E76A

loc_E71C:
		mov	ax, 1
		sub	ax, di
		mov	di, ax
		or	di, di
		jnz	short loc_E72D
		mov	[bp+var_1], TX_GREEN + TX_REVERSE
		jmp	short loc_E731
; ---------------------------------------------------------------------------

loc_E72D:
		mov	[bp+var_1], TX_WHITE

loc_E731:
		push	(24 shl 16) + 13
		push	ds
		push	offset gYES
		mov	al, [bp+var_1]
		mov	ah, 0
		push	ax
		call	gaiji_putsa
		cmp	di, 1
		jnz	short loc_E751
		mov	[bp+var_1], TX_GREEN + TX_REVERSE
		jmp	short loc_E755
; ---------------------------------------------------------------------------

loc_E751:
		mov	[bp+var_1], TX_WHITE

loc_E755:
		push	(25 shl 16) + 15
		push	ds
		push	offset gNO
		mov	al, [bp+var_1]
		mov	ah, 0
		push	ax
		call	gaiji_putsa

loc_E76A:
		test	si, INPUT_CANCEL
		jz	short loc_E775
		mov	di, 1
		jmp	short loc_E796
; ---------------------------------------------------------------------------

loc_E775:
		test	si, INPUT_OK
		jnz	short loc_E796
		test	si, INPUT_SHOT
		jz	short loc_E787
		jmp	short loc_E796
; ---------------------------------------------------------------------------

loc_E783:
		mov	si, _key_det

loc_E787:
		call	main_01:far ptr	_input_reset_sense
		push	1
		call	frame_delay
		jmp	loc_E703
; ---------------------------------------------------------------------------

loc_E796:
		or	di, di
		jnz	short loc_E7D8
		call	main_01:sub_12CB5
		mov	_power, 1
		mov	_dream_items_collected, 0
		les	bx, _resident
		mov	al, es:[bx+resident_t.credit_bombs]
		mov	es:[bx+resident_t.rem_bombs], al
		mov	al, es:[bx+resident_t.credit_lives]
		mov	es:[bx+resident_t.rem_lives], al
		nopcall	main_01:sub_11DE6
		nopcall	main_01:sub_EEE8
		nopcall	main_01:sub_EFA1
		inc	_continues_used
		call	sub_EEB0
		call	hud_score_put
		mov	al, 0
		jmp	short loc_E7DA
; ---------------------------------------------------------------------------

loc_E7D8:
		mov	al, 1

loc_E7DA:
		pop	di
		pop	si
		leave
		retn
sub_E67A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_E7DE	proc near
		push	bp
		mov	bp, sp
		push	si
		xor	si, si
		jmp	short loc_E7F5
; ---------------------------------------------------------------------------

loc_E7E6:
		mov	al, _score_lebcd[si]
		les	bx, _resident
		add	bx, si
		mov	es:[bx+resident_t.score_last], al
		inc	si

loc_E7F5:
		cmp	si, SCORE_DIGITS
		jl	short loc_E7E6
		pop	si
		pop	bp
		retn
sub_E7DE	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

; int pascal far GameCore(char *arg0);
public GAMECORE
GameCore	proc far ; ZUN symbol [MAGNet2010]

_arg0		= dword	ptr  6

		push	bp
		mov	bp, sp
		call	main_01:sub_E7DE
		cmp	_Ems, 0
		jz	short loc_E813
		push	_Ems
		call	ems_free

loc_E813:
		les	bx, _resident
		mov	ax, _total_std_frames
		mov	es:[bx+resident_t.std_frames], ax
		mov	ax, _items_spawned
		mov	es:[bx+resident_t.items_spawned], ax
		mov	ax, _items_collected
		mov	es:[bx+resident_t.items_collected], ax
		mov	ax, _total_point_items_collected
		mov	es:[bx+resident_t.point_items_collected], ax
		mov	ax, _total_max_valued_point_items_collected
		mov	es:[bx+resident_t.max_valued_point_items_collected], ax
		mov	ax, _enemies_gone
		mov	es:[bx+resident_t.enemies_gone], ax
		mov	ax, _enemies_killed
		mov	es:[bx+resident_t.enemies_killed], ax
		mov	eax, _total_slow_frames
		mov	es:[bx+resident_t.slow_frames], eax
		mov	eax, _total_frames
		mov	es:[bx+resident_t.frames], eax
		call	main_01:bb_txt_free
		call	cdg_freeall
		call	bb_stage_free
		call	main_01:sub_CF1E
		call	main_01:bb_playchar_free
		call	main_01:std_free
		call	main_01:map_free
		call	super_free
		call	graph_hide
		call	text_clear
		call	gaiji_restore
		call	game_exit
		pushd	0
		pushd	[bp+_arg0]	; arg0
		pushd	[bp+_arg0]	; path
		call	_execl
		add	sp, 0Ch
		pop	bp
		retf	4
GameCore	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

yuuka5_fg_render	proc near

var_2		= word ptr -2

		enter	2, 0
		push	si
		push	di
		mov	ax, _boss_pos.cur.x
		sar	ax, 4
		add	ax, -16
		mov	si, ax
		mov	ax, _boss_pos.cur.y
		sar	ax, 4
		add	ax, -32
		mov	di, ax
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnz	short loc_E8D8
		push	si
		push	ax
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		push	3
		call	super_zoom
		jmp	loc_EA5B
; ---------------------------------------------------------------------------

loc_E8D8:
		cmp	_boss_phase, 1
		ja	short loc_E91D
		mov	ax, _boss_pos.cur.x
		sar	ax, 4
		mov	si, ax
		mov	ax, _boss_pos.cur.y
		sar	ax, 4
		add	ax, -16
		mov	di, ax
		cmp	_boss_damage_this_frame, 0
		jnz	short loc_E906
		call	super_put pascal, si, ax, 128
		jmp	loc_EA5B
; ---------------------------------------------------------------------------

loc_E906:
		call	super_put_1plane pascal, si, di, (128 shl 16) or 0, PLANE_PUT or GC_BRGI
		mov	_boss_damage_this_frame, 0
		jmp	loc_EA5B
; ---------------------------------------------------------------------------

loc_E91D:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnb	loc_EA5B
		cmp	byte_25667, 0
		jnz	short loc_E98E
		mov	al, _stage_frame_mod16
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		add	ax, ax
		add	ax, 129
		mov	[bp+var_2], ax
		cmp	_boss_damage_this_frame, 0
		jnz	short loc_E961
		call	super_put pascal, si, di, ax
		lea	ax, [si+48]
		push	ax
		push	di
		mov	ax, [bp+var_2]
		inc	ax
		push	ax
		call	super_put
		jmp	loc_EA5B
; ---------------------------------------------------------------------------

loc_E961:
		push	si
		push	di
		push	[bp+var_2]
		pushd	PLANE_PUT or GC_BRGI
		call	super_put_1plane
		lea	ax, [si+48]
		push	ax
		push	di
		mov	ax, [bp+var_2]
		inc	ax
		push	ax
		pushd	PLANE_PUT or GC_BRGI
		call	super_put_1plane
		mov	_boss_damage_this_frame, 0
		jmp	loc_EA5B
; ---------------------------------------------------------------------------

loc_E98E:
		cmp	byte_25667, 1
		jnz	short loc_E9DD
		mov	ax, _boss_pos.cur.x
		sar	ax, 4
		mov	si, ax
		mov	ax, _boss_pos.cur.y
		sar	ax, 4
		add	ax, -16
		mov	di, ax
		call	main_01:grcg_setmode_rmw_1
		mov	ah, 0Fh
		call	main_01:grcg_setcolor_direct_noint_1
		mov	ax, _boss_phase_frame
		add	ax, ax
		mov	dx, 80
		sub	dx, ax
		mov	[bp+var_2], dx
		lea	ax, [si+32]
		push	ax
		lea	ax, [di+32]
		push	ax
		push	dx
		call	grcg_circlefill
		GRCG_OFF_CLOBBERING dx
		call	super_put pascal, si, di, 128
		jmp	short loc_EA5B
; ---------------------------------------------------------------------------

loc_E9DD:
		cmp	byte_25667, 2
		jnz	short loc_EA0D
		mov	ax, _boss_pos.cur.x
		sar	ax, 4
		add	ax, 32
		mov	si, ax
		mov	ax, _boss_pos.cur.y
		sar	ax, 4
		add	ax, 16
		mov	di, ax
		call	main_01:grcg_setmode_rmw_1
		mov	ah, 0Fh
		call	main_01:grcg_setcolor_direct_noint_1
		call	grcg_circlefill pascal, si, di, 16
		jmp	short loc_EA55
; ---------------------------------------------------------------------------

loc_EA0D:
		cmp	byte_25667, 3
		jnz	short loc_EA5B
		mov	ax, _boss_pos.cur.x
		sar	ax, 4
		mov	si, ax
		mov	ax, _boss_pos.cur.y
		sar	ax, 4
		add	ax, -16
		mov	di, ax
		call	main_01:grcg_setmode_rmw_1
		mov	ah, 0Fh
		call	main_01:grcg_setcolor_direct_noint_1
		mov	ax, _boss_phase_frame
		shl	ax, 3
		add	ax, 16
		mov	[bp+var_2], ax
		lea	ax, [si+32]
		push	ax
		lea	ax, [di+32]
		push	ax
		push	[bp+var_2]
		call	grcg_circlefill
		call	super_put pascal, si, di, 128

loc_EA55:
		GRCG_OFF_CLOBBERING dx

loc_EA5B:
		call	explosions_small_update_and_render
		call	explosions_big_update_and_render
		cmp	_boss_phase, PHASE_NONE
		jnb	short loc_EA6B
		call	main_01:sub_E2C3

loc_EA6B:
		pop	di
		pop	si
		leave
		retn
yuuka5_fg_render	endp

; ---------------------------------------------------------------------------
		db    0

; =============== S U B	R O U T	I N E =======================================


playfield_fillm_0_80_384_112	proc near
		push	di
		GRCG_FILL_PLAYFIELD_ROWS	192, 192
		GRCG_FILL_PLAYFIELD_ROWS	  0,  80
		pop	di
		retn
playfield_fillm_0_80_384_112	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_EA8A	proc near

arg_0		= word ptr  4
arg_2		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		push	di
		push	ds
		pop	es
		assume es:_DATA
		mov	bx, 18h
		mov	ax, [bp+arg_2]
		mul	bx
		mov	si, ax
		add	si, 199Ch
		mov	ax, [bp+arg_0]
		add	bx, bx
		mul	bx
		add	ax, 190Ch
		mov	bx, ax
		xor	dx, dx
		mov	cx, TILES_X

loc_EAB0:
		lodsb
		cmp	al, 1
		jnz	short loc_EAD8
		mov	di, dx
		shl	di, 1
		mov	ax, [bx]

loc_EABB:
		mov	_tile_ring[di], ax
		add	di, (TILES_MEMORY_X * 2)
		cmp	di, (TILES_MEMORY_X * 2) * TILES_Y
		jb	short loc_EABB
		mov	di, dx

loc_EACA:
		mov	_halftiles_dirty[di], 1
		add	di, 20h	; ' '
		cmp	di, 640h
		jb	short loc_EACA

loc_EAD8:
		inc	dx
		add	bx, 2
		loop	loc_EAB0
		pop	di
		pop	si
		pop	bp
		retn	4
sub_EA8A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

stage4_render	proc near

var_2		= word ptr -2

		enter	2, 0
		push	si
		push	di
		mov	_tile_invalidate_box.x, PLAYFIELD_W
		mov	_tile_invalidate_box.y, 2
		call	main_01:tiles_invalidate_around pascal, large ((PLAYFIELD_W / 2) shl 4)
		mov	ax, _scroll_line
		mov	bx, 10h
		cwd
		idiv	bx
		mov	[bp+var_2], ax
		xor	di, di
		jmp	short loc_EB42
; ---------------------------------------------------------------------------

loc_EB0F:
		mov	bx, word_22D9C
		imul	bx, TILES_X
		cmp	byte ptr [bx+di+199Ch],	2
		jnz	short loc_EB41
		mov	al, byte_25668	; jump table for switch	statement
		mov	ah, 0
		imul	ax, 30h
		mov	dx, di
		add	dx, dx
		add	ax, dx
		mov	bx, ax
		mov	ax, [bx+190Ch]
		mov	bx, [bp+var_2]
		shl	bx, 6
		mov	dx, di
		add	dx, dx
		add	bx, dx
		mov	_tile_ring[bx], ax

loc_EB41:
		inc	di

loc_EB42:
		cmp	di, TILES_X
		jl	short loc_EB0F
		cmp	_stage_frame, 1
		ja	short loc_EB8A
		mov	[bp+var_2], 0
		jmp	short loc_EB7A
; ---------------------------------------------------------------------------

loc_EB55:
		xor	di, di
		jmp	short loc_EB72
; ---------------------------------------------------------------------------

loc_EB59:
		mov	bx, [bp+var_2]
		shl	bx, 6
		mov	ax, di
		add	ax, ax
		add	bx, ax
		mov	si, di
		add	si, si
		mov	ax, [si+190Ch]
		mov	_tile_ring[bx], ax
		inc	di

loc_EB72:
		cmp	di, TILES_X
		jl	short loc_EB59
		inc	[bp+var_2]

loc_EB7A:
		cmp	[bp+var_2], 19h
		jl	short loc_EB55
		call	main_01:tiles_invalidate_all
		mov	byte_25668, 0
		jmp	short loc_EBEA
; ---------------------------------------------------------------------------

loc_EB8A:
		cmp	byte_25668, 0
		jnz	short loc_EBB6
		cmp	_stage_frame, 1664
		jb	short loc_EBEA
		push	word_22D9C
		push	1
		call	main_01:sub_EA8A
		cmp	_stage_frame_mod4, 0
		jnz	short loc_EBEA
		inc	word_22D9C
		cmp	word_22D9C, 7
		jle	short loc_EBEA
		jmp	short loc_EBD8
; ---------------------------------------------------------------------------

loc_EBB6:
		cmp	byte_25668, 1
		jnz	short loc_EBE4
		push	word_22D9C
		push	2
		call	main_01:sub_EA8A
		cmp	_stage_frame_mod4, 0
		jnz	short loc_EBEA
		inc	word_22D9C
		cmp	word_22D9C, 7
		jle	short loc_EBEA

loc_EBD8:
		inc	byte_25668
		mov	word_22D9C, 0
		jmp	short loc_EBEA
; ---------------------------------------------------------------------------

loc_EBE4:
		mov	_stage_render, offset nullfunc_near

loc_EBEA:
		pop	di
		pop	si
		leave
		retn
stage4_render	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

stage5_render	proc near

var_2		= word ptr -2

		enter	2, 0
		push	si
		cmp	_boss_phase, 1
		jb	short loc_EC01
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jb	short loc_EC56

loc_EC01:
		xor	si, si
		jmp	short loc_EC51
; ---------------------------------------------------------------------------

loc_EC05:
		mov	bx, si
		add	bx, bx
		add	word ptr [bx-430Ch], 40h
		mov	bx, si
		add	bx, bx
		cmp	word ptr [bx-430Ch], 1900h
		jl	short loc_EC24
		mov	bx, si
		add	bx, bx
		sub	word ptr [bx-430Ch], 1900h

loc_EC24:
		mov	bx, si
		add	bx, bx
		mov	ax, [bx-430Ch]
		add	ax, (-24 shl 4)
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, ax
		mov	[bp+var_2], ax
		mov	ax, si
		shl	ax, 7
		add	ax, 30h	; '0'
		push	ax
		push	[bp+var_2]
		push	110000h
		push	0E000h
		call	cdg_put_plane_roll
		inc	si

loc_EC51:
		cmp	si, 3
		jl	short loc_EC05

loc_EC56:
		pop	si
		leave
		retn
stage5_render	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

stage5_invalidate	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	_tile_invalidate_box.x, 96
		mov	_tile_invalidate_box.y, 80
		xor	si, si
		jmp	short loc_EC86
; ---------------------------------------------------------------------------

loc_EC6D:
		mov	bx, si
		add	bx, bx
		mov	ax, [bx-430Ch]
		add	ax, (-4 shl 4)
		push	ax
		mov	ax, si
		shl	ax, 0Bh
		add	ax, (64 shl 4)
		push	ax
		call	main_01:tiles_invalidate_around
		inc	si

loc_EC86:
		cmp	si, 3
		jl	short loc_EC6D
		pop	si
		pop	bp
		retn
stage5_invalidate	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_EC8E	proc near

var_4		= word ptr -4
var_2		= word ptr -2

		enter	4, 0
		push	si
		push	di
		call	main_01:grcg_setmode_rmw_1
		mov	ah, GC_RG
		call	main_01:grcg_setcolor_direct_noint_1
		mov	di, 1
		jmp	short loc_ECC7
; ---------------------------------------------------------------------------

loc_ECA1:
		mov	bx, di
		add	bx, bx
		push	word ptr [bx+4336h]
		mov	bx, di
		add	bx, bx
		push	word ptr [bx+433Eh]
		mov	bx, di
		add	bx, bx
		push	word ptr [bx+4338h]
		mov	bx, di
		add	bx, bx
		push	word ptr [bx+4340h]
		call	grcg_line
		inc	di

loc_ECC7:
		mov	al, byte_25672
		mov	ah, 0
		cmp	ax, di
		jg	short loc_ECA1
		cmp	byte_25672, 3
		jb	short loc_ECF4
		mov	bx, di
		add	bx, bx
		push	word ptr [bx+4336h]
		mov	bx, di
		add	bx, bx
		push	word ptr [bx+433Eh]
		push	word_25678
		push	word_25680
		call	grcg_line

loc_ECF4:
		GRCG_OFF_CLOBBERING dx
		mov	si, 0B204h
		xor	di, di
		jmp	short loc_ED68
; ---------------------------------------------------------------------------

loc_ED01:
		cmp	byte ptr [si], 0
		jz	short loc_ED64
		cmp	word ptr [si+2], 0FF00h
		jle	short loc_ED64
		cmp	word ptr [si+2], 1800h
		jge	short loc_ED64
		cmp	word ptr [si+4], 0FF00h
		jle	short loc_ED64
		cmp	word ptr [si+4], 1700h
		jge	short loc_ED64
		mov	ax, [si+2]
		sar	ax, 4
		add	ax, 10h
		mov	[bp+var_2], ax
		mov	ax, [si+4]
		sar	ax, 4
		mov	[bp+var_4], ax
		cmp	word ptr [si+16h], 0
		jnz	short loc_ED4B
		call	super_roll_put pascal, [bp+var_2], ax, word ptr [si+6]
		jmp	short loc_ED64
; ---------------------------------------------------------------------------

loc_ED4B:
		call	super_roll_put_1plane pascal, [bp+var_2], [bp+var_4], word ptr [si+6], large PLANE_PUT or GC_BRGI
		mov	word ptr [si+16h], 0

loc_ED64:
		inc	di
		add	si, 1Ah

loc_ED68:
		cmp	di, 4
		jl	short loc_ED01
		pop	di
		pop	si
		leave
		retn
sub_EC8E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

marisa_fg_render	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	ax, _boss_pos.cur.x
		sar	ax, 4
		mov	si, ax
		mov	ax, _boss_pos.cur.y
		sar	ax, 4
		add	ax, -16
		mov	di, ax
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnb	short loc_EDC3
		cmp	_boss_damage_this_frame, 0
		jnz	short loc_EDA6
		push	si
		push	ax
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		call	super_put
		jmp	short loc_EDBE
; ---------------------------------------------------------------------------

loc_EDA6:
		push	si
		push	di
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		pushd	PLANE_PUT or GC_BRGI
		call	super_put_1plane
		mov	_boss_damage_this_frame, 0

loc_EDBE:
		call	main_01:sub_EC8E
		jmp	short loc_EDD7
; ---------------------------------------------------------------------------

loc_EDC3:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnz	short loc_EDD7
		push	si
		push	di
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		call	super_large_put

loc_EDD7:
		call	explosions_small_update_and_render
		call	explosions_big_update_and_render
		pop	di
		pop	si
		pop	bp
		retn
marisa_fg_render	endp

; ---------------------------------------------------------------------------
		db    0

; =============== S U B	R O U T	I N E =======================================


playfield_fillm_0_120_384_128	proc near
		push	di
		GRCG_FILL_PLAYFIELD_ROWS	  0, 120, dx
		cli
		mov	dx, 7Eh	; '~'
		xor	al, al
		out	dx, al
		out	dx, al
		out	dx, al
		out	dx, al
		sti
		GRCG_FILL_PLAYFIELD_ROWS	248, 120
		pop	di
		retn
playfield_fillm_0_120_384_128	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public SCORE_EXTEND_UPDATE
score_extend_update	proc near

var_1		= byte ptr -1

		push	bp
		mov	bp, sp
		sub	sp, 2
		mov	[bp+var_1], 0
		mov	al, _extends_gained
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 4
		ja	short loc_EE60
		add	bx, bx
		jmp	cs:off_EEA6[bx]

loc_EE23:
		cmp	_score_lebcd[6], 3
		jb	short loc_EE60
		jmp	short loc_EE5C
; ---------------------------------------------------------------------------

loc_EE2C:
		cmp	_score_lebcd[6], 8
		jb	short loc_EE60
		jmp	short loc_EE5C
; ---------------------------------------------------------------------------

loc_EE35:
		cmp	_score_lebcd[7], 1
		jb	short loc_EE60
		cmp	_score_lebcd[6], 5
		jb	short loc_EE60
		jmp	short loc_EE5C
; ---------------------------------------------------------------------------

loc_EE45:
		cmp	_score_lebcd[7], 2
		jb	short loc_EE60
		cmp	_score_lebcd[6], 2
		jb	short loc_EE60
		jmp	short loc_EE5C
; ---------------------------------------------------------------------------

loc_EE55:
		cmp	_score_lebcd[7], 3
		jb	short loc_EE60

loc_EE5C:
		mov	[bp+var_1], 1

loc_EE60:
		cmp	[bp+var_1], 0
		jz	short locret_EEA3
		push	4
		nopcall	_playperf_raise
		inc	_extends_gained
		les	bx, _resident
		assume es:nothing
		cmp	es:[bx+resident_t.rem_lives], 99
		ja	short locret_EEA3
		inc	es:[bx+resident_t.rem_lives]
		cmp	_bullet_clear_time, 20
		jnb	short loc_EE8C
		mov	_bullet_clear_time, 20

loc_EE8C:
		nopcall	main_01:sub_EEE8
		mov	_popup_id_new, POPUP_ID_EXTEND
		mov	_popup_fp, offset popup_update_and_render
		call	snd_se_play pascal, 7

locret_EEA3:
		leave
		retn
score_extend_update	endp

; ---------------------------------------------------------------------------
		db    0
off_EEA6	dw offset loc_EE23
		dw offset loc_EE2C
		dw offset loc_EE35
		dw offset loc_EE45
		dw offset loc_EE55

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_EEB0	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	si, 1
		jmp	short loc_EEBF
; ---------------------------------------------------------------------------

loc_EEB9:
		mov	_score_lebcd[si], 0
		inc	si

loc_EEBF:
		cmp	si, SCORE_DIGITS
		jl	short loc_EEB9
		mov	_score_delta, 0
		mov	_score_delta_frame, 0
		mov	_score_unused, 0
		mov	_extends_gained, 0
		mov	_hiscore_popup_shown, 0
		pop	si
		pop	bp
		retn
sub_EEB0	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_EEE8	proc far

var_2		= byte ptr -2
var_1		= byte ptr -1

		push	bp
		mov	bp, sp
		sub	sp, 2
		push	si
		les	bx, _resident
		mov	al, es:[bx+resident_t.rem_lives]
		dec	al
		mov	[bp+var_1], al
		cmp	[bp+var_1], 6
		jge	short loc_EF47
		mov	[bp+var_2], 0
		mov	si, 3Eh	; '>'
		jmp	short loc_EF20
; ---------------------------------------------------------------------------

loc_EF0B:
		call	gaiji_putca pascal, si, (13 shl 16) + 0D4h, TX_WHITE
		add	si, 2
		inc	[bp+var_2]

loc_EF20:
		mov	al, [bp+var_2]
		cmp	al, [bp+var_1]
		jl	short loc_EF0B
		jmp	short loc_EF3F
; ---------------------------------------------------------------------------

loc_EF2A:
		call	gaiji_putca pascal, si, (13 shl 16) + 2, TX_WHITE
		add	si, 2
		inc	[bp+var_2]

loc_EF3F:
		cmp	[bp+var_2], 5
		jl	short loc_EF2A
		jmp	short loc_EF9E
; ---------------------------------------------------------------------------

loc_EF47:
		call	text_putsa pascal, (62 shl 16) + 13, ds, offset aB@b@bB@b@, TX_WHITE
		cmp	[bp+var_1], 0Ah
		jl	short loc_EF88
		push	(68 shl 16) + 13
		mov	al, [bp+var_1]
		cbw
		mov	bx, 0Ah
		cwd
		idiv	bx
		add	ax, 0A0h
		push	ax
		push	TX_WHITE
		call	gaiji_putca
		mov	al, [bp+var_1]
		cbw
		mov	bx, 0Ah
		cwd
		idiv	bx
		mov	[bp+var_1], dl

loc_EF88:
		push	(70 shl 16) + 13
		mov	al, [bp+var_1]
		cbw
		add	ax, 0A0h
		push	ax
		push	TX_WHITE
		call	gaiji_putca

loc_EF9E:
		pop	si
		leave
		retf
sub_EEE8	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_EFA1	proc far

var_2		= byte ptr -2
var_1		= byte ptr -1

		push	bp
		mov	bp, sp
		sub	sp, 2
		push	si
		mov	[bp+var_2], 0
		les	bx, _resident
		cmp	es:[bx+resident_t.rem_bombs], 5
		ja	short loc_EFFF
		mov	si, 3Eh	; '>'
		mov	al, es:[bx+resident_t.rem_bombs]
		mov	[bp+var_1], al
		jmp	short loc_EFD8
; ---------------------------------------------------------------------------

loc_EFC3:
		call	gaiji_putca pascal, si, (11 shl 16) + 0D3h, TX_WHITE
		add	si, 2
		inc	[bp+var_2]

loc_EFD8:
		mov	al, [bp+var_2]
		cmp	al, [bp+var_1]
		jl	short loc_EFC3
		jmp	short loc_EFF7
; ---------------------------------------------------------------------------

loc_EFE2:
		call	gaiji_putca pascal, si, (11 shl 16) + 2, TX_WHITE
		add	si, 2
		inc	[bp+var_2]

loc_EFF7:
		cmp	[bp+var_2], 5
		jl	short loc_EFE2
		jmp	short loc_F061
; ---------------------------------------------------------------------------

loc_EFFF:
		les	bx, _resident
		mov	al, es:[bx+resident_t.rem_bombs]
		mov	[bp+var_1], al
		call	text_putsa pascal, (62 shl 16) + 11, ds, offset aB@b@bB@b@_0, TX_WHITE
		cmp	[bp+var_1], 0Ah
		jl	short loc_F04B
		push	(68 shl 16) + 11
		mov	al, [bp+var_1]
		cbw
		mov	bx, 0Ah
		cwd
		idiv	bx
		add	ax, 0A0h
		push	ax
		push	TX_WHITE
		call	gaiji_putca
		mov	al, [bp+var_1]
		cbw
		mov	bx, 0Ah
		cwd
		idiv	bx
		mov	[bp+var_1], dl

loc_F04B:
		push	(70 shl 16) + 11
		mov	al, [bp+var_1]
		cbw
		add	ax, 0A0h
		push	ax
		push	TX_WHITE
		call	gaiji_putca

loc_F061:
		pop	si
		leave
		retf
sub_EFA1	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public HUD_POINT_ITEMS_PUT
hud_point_items_put	proc far
		push	bp
		mov	bp, sp
		push	3E000Fh
		mov	al, _stage_point_items_collected
		mov	ah, 0
		push	ax
		call	sub_1D519
		pop	bp
		retf
hud_point_items_put	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public HUD_DREAM_PUT
hud_dream_put	proc far
		push	bp
		mov	bp, sp
		push	3E0011h
		mov	ax, _dream_score
		imul	ax, 0Ah
		push	ax
		call	sub_1D519
		pop	bp
		retf
hud_dream_put	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public HUD_GRAZE_PUT
hud_graze_put	proc far
		push	bp
		mov	bp, sp
		push	3E0013h
		push	_stage_graze
		call	sub_1D519
		pop	bp
		retf
hud_graze_put	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public HUD_POWER_PUT
hud_power_put	proc far

var_A		= byte ptr -0Ah

		push	bp
		mov	bp, sp
		sub	sp, 0Ah
		push	si
		push	di
		mov	si, 1ABDh
		lea	di, [bp+var_A]
		push	ss
		pop	es
		mov	cx, 5
		rep movsw
		push	16h
		mov	al, _power
		mov	ah, 0
		push	ax
		mov	al, _shot_level
		mov	ah, 0
		lea	dx, [bp+var_A]
		add	ax, dx
		mov	bx, ax
		mov	al, ss:[bx]
		mov	ah, 0
		push	ax
		nopcall	main_01:hud_bar_put
		pop	di
		pop	si
		leave
		retf
hud_power_put	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_F0DD	proc far

var_10		= word ptr -10h
var_E		= word ptr -0Eh
var_C		= byte ptr -0Ch
var_A		= word ptr -0Ah
var_8		= word ptr -8
var_6		= word ptr -6
var_4		= word ptr -4
var_2		= byte ptr -2
arg_0		= word ptr  6

		push	bp
		mov	bp, sp
		sub	sp, 10h
		push	si
		mov	si, [bp+arg_0]
		mov	ax, word_22E07
		mov	[bp+var_A], ax
		mov	ax, word_22E09
		mov	[bp+var_8], ax
		mov	ax, word_22E0B
		mov	[bp+var_6], ax
		mov	ax, word_22E0D
		mov	[bp+var_4], ax
		mov	al, byte_22E0F
		mov	[bp+var_2], al
		mov	ax, word_22E10
		mov	[bp+var_10], ax
		mov	ax, word_22E12
		mov	[bp+var_E], ax
		mov	al, byte_22E14
		mov	[bp+var_C], al
		or	si, si
		jz	short loc_F14C
		call	gaiji_putsa pascal, (61 shl 16) + 8, ds, offset gsENEMY, TX_YELLOW
		push	9
		push	si
		mov	ax, si
		mov	bx, 20h	; ' '
		cwd
		idiv	bx
		lea	dx, [bp+var_10]
		add	ax, dx
		mov	bx, ax
		mov	al, ss:[bx]
		mov	ah, 0
		push	ax
		nopcall	main_01:hud_bar_put
		jmp	short loc_F172
; ---------------------------------------------------------------------------

loc_F14C:
		push	(61 shl 16) + 8
		push	ss
		lea	ax, [bp+var_6+1]
		push	ax
		push	TX_WHITE
		call	gaiji_putsa
		push	(56 shl 16) + 9
		push	ss
		lea	ax, [bp+var_A]
		push	ax
		push	TX_WHITE
		call	gaiji_putsa

loc_F172:
		pop	si
		leave
		retf	2
sub_F0DD	endp

include th04/hud/bar_put.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public HUD_PUT
hud_put	proc far
		push	bp
		mov	bp, sp
		call	gaiji_putsa pascal, (60 shl 16) + 3, ds offset gsHISCORE, TX_YELLOW
		call	gaiji_putsa pascal, (61 shl 16) + 5, ds offset gsSCORE, TX_YELLOW
		call	hud_score_put
		les	bx, _resident
		cmp	es:[bx+resident_t.playchar_ascii], '0' + PLAYCHAR_REIMU
		jnz	short loc_F245
		push	(57 shl 16) + 11
		push	ds
		push	offset gsREIGEKI
		jmp	short loc_F24F
; ---------------------------------------------------------------------------

loc_F245:
		push	(57 shl 16) + 11
		push	ds
		push	offset gsBOMB

loc_F24F:
		push	TX_YELLOW
		call	gaiji_putsa
		call	main_01:sub_EFA1
		call	main_01:sub_EEE8
		les	bx, _resident
		cmp	es:[bx+resident_t.playchar_ascii], '0' + PLAYCHAR_REIMU
		jnz	short loc_F276
		push	(57 shl 16) + 13
		push	ds
		push	offset gsREIMU
		jmp	short loc_F280
; ---------------------------------------------------------------------------

loc_F276:
		push	(57 shl 16) + 13
		push	ds
		push	offset gsPLAYER

loc_F280:
		push	TX_YELLOW
		call	gaiji_putsa
		call	gaiji_putca pascal, (58 shl 16) + 15, (0E6h shl 16) + TX_YELLOW
		call	main_01:hud_point_items_put
		call	gaiji_putca pascal, (58 shl 16) + 17, (0E7h shl 16) + TX_YELLOW
		call	main_01:hud_dream_put
		call	gaiji_putca pascal, (58 shl 16) + 19, (0E8h shl 16) + TX_YELLOW
		call	main_01:hud_graze_put
		les	bx, _resident
		cmp	es:[bx+resident_t.playchar_ascii], '0' + PLAYCHAR_REIMU
		jnz	short loc_F2DE
		push	(62 shl 16) + 21
		push	ds
		push	offset gsREIRYOKU
		jmp	short loc_F2E8
; ---------------------------------------------------------------------------

loc_F2DE:
		push	(62 shl 16) + 21
		push	ds
		push	offset gsPOWER

loc_F2E8:
		push	TX_YELLOW
		call	gaiji_putsa
		call	main_01:hud_power_put
		push	(57 shl 16) + 23
		push	ds
		mov	al, _rank
		mov	ah, 0
		shl	ax, 3
		add	ax, offset glEASY
		push	ax
		cmp	_rank, RANK_EASY
		jnz	short loc_F313
		mov	ax, TX_GREEN
		jmp	short loc_F32E
; ---------------------------------------------------------------------------

loc_F313:
		cmp	_rank, RANK_NORMAL
		jnz	short loc_F31F
		mov	ax, TX_CYAN
		jmp	short loc_F32E
; ---------------------------------------------------------------------------

loc_F31F:
		cmp	_rank, RANK_HARD
		jnz	short loc_F32B
		mov	ax, TX_MAGENTA
		jmp	short loc_F32E
; ---------------------------------------------------------------------------

loc_F32B:
		mov	ax, TX_RED

loc_F32E:
		push	ax
		call	gaiji_putsa
		push	0
		call	main_01:sub_F0DD
		pop	bp
		retf
hud_put	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_F33C	proc near

arg_0		= word ptr  4
arg_2		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_2]
		mov	ax, _homing_target.y
		sub	ax, _player_pos.cur.y
		push	ax
		mov	ax, _homing_target.x
		sub	ax, [si+2]
		push	ax
		call	iatan2
		add	al, byte ptr [bp+arg_0]
		mov	byte ptr [bp+arg_0], al
		lea	ax, [si+0Ah]
		push	ax
		push	[bp+arg_0]
		call	main_01:shot_velocity_set
		pop	si
		pop	bp
		retn	4
sub_F33C	endp

; ---------------------------------------------------------------------------

shot_reimu_l0	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jz	short loc_F38D
		mov	word ptr [si+0Eh], 1Ch
		mov	byte ptr [si+10h], 0Ah

loc_F38D:
		pop	si
		pop	bp
		retn
shot_reimu_l0	endp

; ---------------------------------------------------------------------------

shot_reimu_l1	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jz	short loc_F3C0
		add	ax, 0Ah
		push	ax
		push	7
		call	main_01:randring1_next16_and
		add	al, 0BCh
		push	ax
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 1Ch
		mov	byte ptr [si+10h], 0Ah

loc_F3C0:
		pop	si
		pop	bp
		retn
shot_reimu_l1	endp

; ---------------------------------------------------------------------------

shot_reimu_a_l2	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	di, 1
		cmp	_shot_time, SHOT_CYCLE_FRAMES
		jnz	short loc_F3D7
		mov	byte_256A2, 0

loc_F3D7:
		mov	al, byte_256A2
		mov	ah, 0
		mov	bx, 3
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_F3E9
		add	di, 2

loc_F3E9:
		inc	byte_256A2
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_F446
; ---------------------------------------------------------------------------

loc_F3FA:
		cmp	di, 1
		jnz	short loc_F415
		lea	ax, [si+0Ah]
		push	ax
		push	0Fh
		call	main_01:randring1_next16_and
		add	al, 0B8h
		push	ax
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 1Ch
		jmp	short loc_F43F
; ---------------------------------------------------------------------------

loc_F415:
		cmp	di, 3
		jnz	short loc_F421
		sub	word ptr [si+2], 180h
		jmp	short loc_F426
; ---------------------------------------------------------------------------

loc_F421:
		add	word ptr [si+2], 180h

loc_F426:
		cmp	_homing_target.y, HOMING_TARGET_NONE
		jz	short loc_F43A
		push	si
		push	7
		call	main_01:randring1_next16_and
		sub	al, 4
		push	ax
		call	main_01:sub_F33C

loc_F43A:
		mov	word ptr [si+0Eh], 1Eh

loc_F43F:
		mov	byte ptr [si+10h], 0Ah
		dec	di
		jle	short loc_F44F

loc_F446:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_F3FA

loc_F44F:
		pop	di
		pop	si
		pop	bp
		retn
shot_reimu_a_l2	endp

; ---------------------------------------------------------------------------

shot_reimu_a_l3	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	di, 2
		cmp	_shot_time, SHOT_CYCLE_FRAMES
		jnz	short loc_F467
		mov	byte_256A2, 0

loc_F467:
		mov	al, byte_256A2
		mov	ah, 0
		mov	bx, 3
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_F479
		add	di, 2

loc_F479:
		inc	byte_256A2
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_F4DC
; ---------------------------------------------------------------------------

loc_F48A:
		cmp	di, 2
		jg	short loc_F4AB
		cmp	di, 2
		jnz	short loc_F49B
		sub	word ptr [si+2], 80h
		jmp	short loc_F4A0
; ---------------------------------------------------------------------------

loc_F49B:
		add	word ptr [si+2], 80h

loc_F4A0:
		mov	word ptr [si+0Eh], 1Ch
		mov	byte ptr [si+10h], 9
		jmp	short loc_F4D9
; ---------------------------------------------------------------------------

loc_F4AB:
		cmp	di, 4
		jnz	short loc_F4B7
		sub	word ptr [si+2], 180h
		jmp	short loc_F4BC
; ---------------------------------------------------------------------------

loc_F4B7:
		add	word ptr [si+2], 180h

loc_F4BC:
		cmp	_homing_target.y, HOMING_TARGET_NONE
		jz	short loc_F4D0
		push	si
		push	7
		call	main_01:randring1_next16_and
		sub	al, 4
		push	ax
		call	main_01:sub_F33C

loc_F4D0:
		mov	word ptr [si+0Eh], 1Eh
		mov	byte ptr [si+10h], 0Ah

loc_F4D9:
		dec	di
		jle	short loc_F4E5

loc_F4DC:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_F48A

loc_F4E5:
		pop	di
		pop	si
		pop	bp
		retn
shot_reimu_a_l3	endp

; ---------------------------------------------------------------------------

shot_reimu_a_l4	proc near
		enter	2, 0
		push	si
		push	di
		mov	di, 3
		cmp	_shot_time, SHOT_CYCLE_FRAMES
		jnz	short loc_F4FE
		mov	byte_256A2, 0

loc_F4FE:
		mov	al, byte_256A2
		mov	ah, 0
		mov	bx, 3
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_F510
		add	di, 2

loc_F510:
		inc	byte_256A2
		mov	byte ptr [bp-1], 0BAh
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_F578
; ---------------------------------------------------------------------------

loc_F525:
		cmp	di, 3
		jg	short loc_F547
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-1]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 1Ch
		mov	byte ptr [si+10h], 8
		mov	al, [bp-1]
		add	al, 6
		mov	[bp-1],	al
		jmp	short loc_F575
; ---------------------------------------------------------------------------

loc_F547:
		cmp	di, 5
		jnz	short loc_F553
		sub	word ptr [si+2], 180h
		jmp	short loc_F558
; ---------------------------------------------------------------------------

loc_F553:
		add	word ptr [si+2], 180h

loc_F558:
		cmp	_homing_target.y, HOMING_TARGET_NONE
		jz	short loc_F56C
		push	si
		push	7
		call	main_01:randring1_next16_and
		sub	al, 4
		push	ax
		call	main_01:sub_F33C

loc_F56C:
		mov	word ptr [si+0Eh], 1Eh
		mov	byte ptr [si+10h], 9

loc_F575:
		dec	di
		jle	short loc_F581

loc_F578:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_F525

loc_F581:
		pop	di
		pop	si
		leave
		retn
shot_reimu_a_l4	endp

; ---------------------------------------------------------------------------

shot_reimu_a_l5	proc near
		enter	2, 0
		push	si
		push	di
		mov	di, 3
		cmp	_shot_time, SHOT_CYCLE_FRAMES
		jnz	short loc_F59A
		mov	byte_256A2, 0

loc_F59A:
		mov	al, byte_256A2
		mov	ah, 0
		mov	bx, 2
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_F5AC
		add	di, 2

loc_F5AC:
		inc	byte_256A2
		mov	byte ptr [bp-1], 0B8h
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_F614
; ---------------------------------------------------------------------------

loc_F5C1:
		cmp	di, 3
		jg	short loc_F5E3
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-1]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 1Ch
		mov	byte ptr [si+10h], 8
		mov	al, [bp-1]
		add	al, 8
		mov	[bp-1],	al
		jmp	short loc_F611
; ---------------------------------------------------------------------------

loc_F5E3:
		cmp	di, 5
		jnz	short loc_F5EF
		sub	word ptr [si+2], 180h
		jmp	short loc_F5F4
; ---------------------------------------------------------------------------

loc_F5EF:
		add	word ptr [si+2], 180h

loc_F5F4:
		cmp	_homing_target.y, HOMING_TARGET_NONE
		jz	short loc_F608
		push	si
		push	7
		call	main_01:randring1_next16_and
		sub	al, 4
		push	ax
		call	main_01:sub_F33C

loc_F608:
		mov	word ptr [si+0Eh], 1Eh
		mov	byte ptr [si+10h], 9

loc_F611:
		dec	di
		jle	short loc_F61D

loc_F614:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_F5C1

loc_F61D:
		pop	di
		pop	si
		leave
		retn
shot_reimu_a_l5	endp

; ---------------------------------------------------------------------------

shot_reimu_a_l6	proc near
		enter	2, 0
		push	si
		push	di
		mov	di, 3
		cmp	_shot_time, SHOT_CYCLE_FRAMES
		jnz	short loc_F636
		mov	byte_256A2, 0

loc_F636:
		mov	al, byte_256A2
		mov	ah, 0
		mov	bx, 2
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_F648
		add	di, 2

loc_F648:
		inc	byte_256A2
		mov	byte ptr [bp-1], 0B8h
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_F6B0
; ---------------------------------------------------------------------------

loc_F65D:
		cmp	di, 3
		jg	short loc_F67F
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-1]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 1Ch
		mov	byte ptr [si+10h], 7
		mov	al, [bp-1]
		add	al, 8
		mov	[bp-1],	al
		jmp	short loc_F6AD
; ---------------------------------------------------------------------------

loc_F67F:
		cmp	di, 5
		jnz	short loc_F68B
		sub	word ptr [si+2], 180h
		jmp	short loc_F690
; ---------------------------------------------------------------------------

loc_F68B:
		add	word ptr [si+2], 180h

loc_F690:
		cmp	_homing_target.y, HOMING_TARGET_NONE
		jz	short loc_F6A4
		push	si
		push	7
		call	main_01:randring1_next16_and
		sub	al, 4
		push	ax
		call	main_01:sub_F33C

loc_F6A4:
		mov	word ptr [si+0Eh], 1Eh
		mov	byte ptr [si+10h], 8

loc_F6AD:
		dec	di
		jle	short loc_F6B9

loc_F6B0:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_F65D

loc_F6B9:
		pop	di
		pop	si
		leave
		retn
shot_reimu_a_l6 endp

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

shot_reimu_a_l7	proc near

var_2		= word ptr -2

		enter	2, 0
		push	si
		push	di
		mov	di, 5
		cmp	_shot_time, SHOT_CYCLE_FRAMES
		jnz	short loc_F6D2
		mov	byte_256A2, 0

loc_F6D2:
		mov	al, byte_256A2
		mov	ah, 0
		mov	bx, 2
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_F6E4
		add	di, 2

loc_F6E4:
		inc	byte_256A2
		mov	byte ptr [bp+var_2+1], 0BAh
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	loc_F780
; ---------------------------------------------------------------------------

loc_F6FA:
		cmp	di, 3
		jg	short loc_F720
		lea	ax, [si+0Ah]
		push	ax
		push	[bp+var_2+1]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 1Ch
		mov	byte ptr [si+10h], 4
		mov	byte ptr [si+10h], 7
		mov	al, byte ptr [bp+var_2+1]
		add	al, 6
		mov	byte ptr [bp+var_2+1], al
		jmp	short loc_F77D
; ---------------------------------------------------------------------------

loc_F720:
		cmp	di, 5
		jg	short loc_F74F
		cmp	di, 5
		jnz	short loc_F735
		sub	word ptr [si+2], 180h
		mov	byte ptr [bp+var_2], 0B8h
		jmp	short loc_F73E
; ---------------------------------------------------------------------------

loc_F735:
		add	word ptr [si+2], 180h
		mov	byte ptr [bp+var_2], 0C8h

loc_F73E:
		lea	ax, [si+0Ah]
		push	ax
		push	[bp+var_2]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 1Ch
		jmp	short loc_F779
; ---------------------------------------------------------------------------

loc_F74F:
		cmp	di, 7
		jnz	short loc_F75B
		sub	word ptr [si+2], 180h
		jmp	short loc_F760
; ---------------------------------------------------------------------------

loc_F75B:
		add	word ptr [si+2], 180h

loc_F760:
		cmp	_homing_target.y, HOMING_TARGET_NONE
		jz	short loc_F774
		push	si
		push	7
		call	main_01:randring1_next16_and
		sub	al, 4
		push	ax
		call	main_01:sub_F33C

loc_F774:
		mov	word ptr [si+0Eh], 1Eh

loc_F779:
		mov	byte ptr [si+10h], 7

loc_F77D:
		dec	di
		jle	short loc_F78B

loc_F780:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	loc_F6FA

loc_F78B:
		pop	di
		pop	si
		leave
		retn
shot_reimu_a_l7	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

shot_reimu_a_l8	proc near

var_2		= word ptr -2

		enter	2, 0
		push	si
		push	di
		mov	di, 5
		add	di, 2
		inc	byte_256A2
		mov	byte ptr [bp+var_2+1], 0BAh
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	loc_F833
; ---------------------------------------------------------------------------

loc_F7B1:
		cmp	di, 3
		jg	short loc_F7D3
		lea	ax, [si+0Ah]
		push	ax
		push	[bp+var_2+1]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 1Ch
		mov	byte ptr [si+10h], 7
		mov	al, byte ptr [bp+var_2+1]
		add	al, 6
		mov	byte ptr [bp+var_2+1], al
		jmp	short loc_F830
; ---------------------------------------------------------------------------

loc_F7D3:
		cmp	di, 5
		jg	short loc_F802
		cmp	di, 5
		jnz	short loc_F7E8
		sub	word ptr [si+2], 180h
		mov	byte ptr [bp+var_2], 0B8h
		jmp	short loc_F7F1
; ---------------------------------------------------------------------------

loc_F7E8:
		add	word ptr [si+2], 180h
		mov	byte ptr [bp+var_2], 0C8h

loc_F7F1:
		lea	ax, [si+0Ah]
		push	ax
		push	[bp+var_2]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 1Ch
		jmp	short loc_F82C
; ---------------------------------------------------------------------------

loc_F802:
		cmp	di, 7
		jnz	short loc_F80E
		sub	word ptr [si+2], 180h
		jmp	short loc_F813
; ---------------------------------------------------------------------------

loc_F80E:
		add	word ptr [si+2], 180h

loc_F813:
		cmp	_homing_target.y, HOMING_TARGET_NONE
		jz	short loc_F827
		push	si
		push	7
		call	main_01:randring1_next16_and
		sub	al, 4
		push	ax
		call	main_01:sub_F33C

loc_F827:
		mov	word ptr [si+0Eh], 1Eh

loc_F82C:
		mov	byte ptr [si+10h], 7

loc_F830:
		dec	di
		jle	short loc_F83E

loc_F833:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	loc_F7B1

loc_F83E:
		pop	di
		pop	si
		leave
		retn
shot_reimu_a_l8	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

shot_reimu_a_l9	proc near

var_2		= word ptr -2

		enter	2, 0
		push	si
		push	di
		mov	di, 5
		add	di, 2
		cmp	_shot_time, SHOT_CYCLE_FRAMES
		jnz	short loc_F85A
		mov	byte_256A2, 0

loc_F85A:
		mov	al, byte_256A2
		mov	ah, 0
		mov	bx, 2
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_F86C
		add	di, 2

loc_F86C:
		inc	byte_256A2
		mov	byte ptr [bp-1], 0BAh
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	loc_F948
; ---------------------------------------------------------------------------

loc_F882:
		cmp	di, 3
		jg	short loc_F8A5
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-1]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 1Ch
		mov	byte ptr [si+10h], 6
		mov	al, [bp-1]
		add	al, 6
		mov	[bp-1],	al
		jmp	loc_F945
; ---------------------------------------------------------------------------

loc_F8A5:
		cmp	di, 5
		jg	short loc_F8D4
		cmp	di, 5
		jnz	short loc_F8BA
		sub	word ptr [si+2], 180h
		mov	byte ptr [bp-2], 0B8h
		jmp	short loc_F8C3
; ---------------------------------------------------------------------------

loc_F8BA:
		add	word ptr [si+2], 180h
		mov	byte ptr [bp+var_2], 0C8h

loc_F8C3:
		lea	ax, [si+0Ah]
		push	ax
		push	[bp+var_2]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 1Ch
		jmp	short loc_F941
; ---------------------------------------------------------------------------

loc_F8D4:
		cmp	di, 7
		jg	short loc_F91D
		cmp	di, 7
		jnz	short loc_F8E9
		sub	word ptr [si+2], 180h
		mov	byte ptr [bp-2], 0B4h
		jmp	short loc_F8F2
; ---------------------------------------------------------------------------

loc_F8E9:
		add	word ptr [si+2], 180h
		mov	byte ptr [bp-2], 0CCh

loc_F8F2:
		cmp	_homing_target.y, HOMING_TARGET_NONE
		jz	short loc_F908
		push	si
		push	7
		call	main_01:randring1_next16_and
		sub	al, 4
		push	ax
		call	main_01:sub_F33C
		jmp	short loc_F912
; ---------------------------------------------------------------------------

loc_F908:
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-2]
		call	main_01:shot_velocity_set

loc_F912:
		mov	word ptr [si+0Eh], 1Eh
		mov	byte ptr [si+10h], 5
		jmp	short loc_F945
; ---------------------------------------------------------------------------

loc_F91D:
		cmp	di, 9
		jnz	short loc_F929
		sub	word ptr [si+2], 180h
		jmp	short loc_F92E
; ---------------------------------------------------------------------------

loc_F929:
		add	word ptr [si+2], 180h

loc_F92E:
		cmp	_homing_target.y, HOMING_TARGET_NONE
		jz	short loc_F93C
		push	si
		push	0
		call	main_01:sub_F33C

loc_F93C:
		mov	word ptr [si+0Eh], 1Eh

loc_F941:
		mov	byte ptr [si+10h], 7

loc_F945:
		dec	di
		jle	short loc_F953

loc_F948:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	loc_F882

loc_F953:
		pop	di
		pop	si
		leave
		retn
shot_reimu_a_l9	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

shot_reimu_b_l2	proc near

var_1		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		mov	di, 1
		cmp	_shot_time, SHOT_CYCLE_FRAMES
		jnz	short loc_F96C
		mov	byte_256A2, 0

loc_F96C:
		mov	al, byte_256A2
		mov	ah, 0
		mov	bx, 3
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_F97E
		add	di, 2

loc_F97E:
		inc	byte_256A2
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_F9D9
; ---------------------------------------------------------------------------

loc_F98F:
		cmp	di, 1
		jnz	short loc_F9AA
		lea	ax, [si+0Ah]
		push	ax
		push	0Fh
		call	main_01:randring1_next16_and
		add	al, 0B8h
		push	ax
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 1Ch
		jmp	short loc_F9D2
; ---------------------------------------------------------------------------

loc_F9AA:
		cmp	di, 3
		jnz	short loc_F9BA
		sub	word ptr [si+2], 180h
		mov	[bp+var_1], 0B8h
		jmp	short loc_F9C3
; ---------------------------------------------------------------------------

loc_F9BA:
		add	word ptr [si+2], 180h
		mov	[bp+var_1], 0C8h

loc_F9C3:
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp+var_1]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 20h ; ' '

loc_F9D2:
		mov	byte ptr [si+10h], 0Ah
		dec	di
		jle	short loc_F9E2

loc_F9D9:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_F98F

loc_F9E2:
		pop	di
		pop	si
		leave
		retn
shot_reimu_b_l2	endp

; ---------------------------------------------------------------------------

shot_reimu_b_l3	proc near
		enter	4, 0
		push	si
		push	di
		mov	di, 2
		cmp	_shot_time, SHOT_CYCLE_FRAMES
		jnz	short loc_F9FB
		mov	byte_256A2, 0

loc_F9FB:
		mov	al, byte_256A2
		mov	ah, 0
		mov	bx, 3
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_FA0D
		add	di, 2

loc_FA0D:
		inc	byte_256A2
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_FA70
; ---------------------------------------------------------------------------

loc_FA1E:
		cmp	di, 2
		jg	short loc_FA3B
		cmp	di, 2
		jnz	short loc_FA2F
		mov	word ptr [bp-2], 0FF80h
		jmp	short loc_FA34
; ---------------------------------------------------------------------------

loc_FA2F:
		mov	word ptr [bp-2], 80h

loc_FA34:
		mov	word ptr [si+0Eh], 1Ch
		jmp	short loc_FA63
; ---------------------------------------------------------------------------

loc_FA3B:
		cmp	di, 4
		jnz	short loc_FA4B
		mov	word ptr [bp-2], 0FE80h
		mov	byte ptr [bp-3], 0B8h
		jmp	short loc_FA54
; ---------------------------------------------------------------------------

loc_FA4B:
		mov	word ptr [bp-2], 180h
		mov	byte ptr [bp-3], 0C8h

loc_FA54:
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-3]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 20h ; ' '

loc_FA63:
		mov	byte ptr [si+10h], 9
		mov	ax, [bp-2]
		add	[si+2],	ax
		dec	di
		jle	short loc_FA79

loc_FA70:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_FA1E

loc_FA79:
		pop	di
		pop	si
		leave
		retn
shot_reimu_b_l3 endp

; ---------------------------------------------------------------------------

shot_reimu_b_l4	proc near
		enter	4, 0
		push	si
		push	di
		mov	di, 3
		cmp	_shot_time, SHOT_CYCLE_FRAMES
		jnz	short loc_FA92
		mov	byte_256A2, 0

loc_FA92:
		mov	al, byte_256A2
		mov	ah, 0
		mov	bx, 2
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_FAA4
		add	di, 2

loc_FAA4:
		inc	byte_256A2
		mov	byte ptr [bp-3], 0BAh
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_FB15
; ---------------------------------------------------------------------------

loc_FAB9:
		cmp	di, 3
		jg	short loc_FAE0
		mov	word ptr [bp-2], 0
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-3]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 1Ch
		mov	byte ptr [si+10h], 9
		mov	al, [bp-3]
		add	al, 6
		mov	[bp-3],	al
		jmp	short loc_FB0C
; ---------------------------------------------------------------------------

loc_FAE0:
		cmp	di, 5
		jnz	short loc_FAF0
		mov	word ptr [bp-2], 0FE80h
		mov	byte ptr [bp-4], 0B8h
		jmp	short loc_FAF9
; ---------------------------------------------------------------------------

loc_FAF0:
		mov	word ptr [bp-2], 180h
		mov	byte ptr [bp-4], 0C8h

loc_FAF9:
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-4]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 20h ; ' '
		mov	byte ptr [si+10h], 9

loc_FB0C:
		mov	ax, [bp-2]
		add	[si+2],	ax
		dec	di
		jle	short loc_FB1E

loc_FB15:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	short loc_FAB9

loc_FB1E:
		pop	di
		pop	si
		leave
		retn
shot_reimu_b_l4 endp

; ---------------------------------------------------------------------------

shot_reimu_b_l5	proc near
		enter	4, 0
		push	si
		push	di
		mov	di, 3
		cmp	_shot_time, SHOT_CYCLE_FRAMES
		jnz	short loc_FB37
		mov	byte_256A2, 0

loc_FB37:
		mov	al, byte_256A2
		mov	ah, 0
		mov	bx, 2
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_FB49
		add	di, 4

loc_FB49:
		inc	byte_256A2
		mov	byte ptr [bp-3], 0BAh
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_FBD9
; ---------------------------------------------------------------------------

loc_FB5E:
		cmp	di, 3
		jg	short loc_FB85
		mov	word ptr [bp-2], 0
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-3]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 1Ch
		mov	byte ptr [si+10h], 8
		mov	al, [bp-3]
		add	al, 7
		mov	[bp-3],	al
		jmp	short loc_FBD0
; ---------------------------------------------------------------------------

loc_FB85:
		cmp	di, 6
		jl	short loc_FB91
		mov	word ptr [bp-2], 0FE80h
		jmp	short loc_FB96
; ---------------------------------------------------------------------------

loc_FB91:
		mov	word ptr [bp-2], 180h

loc_FB96:
		mov	bx, di
		sub	bx, 4
		cmp	bx, 3
		ja	short loc_FBBD
		add	bx, bx
		jmp	cs:off_FBE8[bx]

loc_FBA7:
		mov	byte ptr [bp-4], 0B2h
		jmp	short loc_FBBD
; ---------------------------------------------------------------------------

loc_FBAD:
		mov	byte ptr [bp-4], 0B9h
		jmp	short loc_FBBD
; ---------------------------------------------------------------------------

loc_FBB3:
		mov	byte ptr [bp-4], 0CEh
		jmp	short loc_FBBD
; ---------------------------------------------------------------------------

loc_FBB9:
		mov	byte ptr [bp-4], 0C7h

loc_FBBD:
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-4]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 20h ; ' '
		mov	byte ptr [si+10h], 9

loc_FBD0:
		mov	ax, [bp-2]
		add	[si+2],	ax
		dec	di
		jle	short loc_FBE4

loc_FBD9:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	loc_FB5E

loc_FBE4:
		pop	di
		pop	si
		leave
		retn
shot_reimu_b_l5 endp

; ---------------------------------------------------------------------------
off_FBE8	dw offset loc_FBB9
		dw offset loc_FBB3
		dw offset loc_FBAD
		dw offset loc_FBA7
; ---------------------------------------------------------------------------

shot_reimu_b_l6	proc near
		enter	4, 0
		push	si
		push	di
		mov	di, 3
		cmp	_shot_time, SHOT_CYCLE_FRAMES
		jnz	short loc_FC05
		mov	byte_256A2, 0

loc_FC05:
		mov	al, byte_256A2
		mov	ah, 0
		mov	bx, 2
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_FC17
		add	di, 4

loc_FC17:
		inc	byte_256A2
		mov	byte ptr [bp-3], 0BAh
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_FCA7
; ---------------------------------------------------------------------------

loc_FC2C:
		cmp	di, 3
		jg	short loc_FC53
		mov	word ptr [bp-2], 0
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-3]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 1Ch
		mov	byte ptr [si+10h], 8
		mov	al, [bp-3]
		add	al, 6
		mov	[bp-3],	al
		jmp	short loc_FC9E
; ---------------------------------------------------------------------------

loc_FC53:
		cmp	di, 6
		jl	short loc_FC5F
		mov	word ptr [bp-2], 0FE80h
		jmp	short loc_FC64
; ---------------------------------------------------------------------------

loc_FC5F:
		mov	word ptr [bp-2], 180h

loc_FC64:
		mov	bx, di
		sub	bx, 4
		cmp	bx, 3
		ja	short loc_FC8B
		add	bx, bx
		jmp	cs:off_FCB6[bx]

loc_FC75:
		mov	byte ptr [bp-4], 0B2h
		jmp	short loc_FC8B
; ---------------------------------------------------------------------------

loc_FC7B:
		mov	byte ptr [bp-4], 0B9h
		jmp	short loc_FC8B
; ---------------------------------------------------------------------------

loc_FC81:
		mov	byte ptr [bp-4], 0CEh
		jmp	short loc_FC8B
; ---------------------------------------------------------------------------

loc_FC87:
		mov	byte ptr [bp-4], 0C7h

loc_FC8B:
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-4]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 20h ; ' '
		mov	byte ptr [si+10h], 9

loc_FC9E:
		mov	ax, [bp-2]
		add	[si+2],	ax
		dec	di
		jle	short loc_FCB2

loc_FCA7:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	loc_FC2C

loc_FCB2:
		pop	di
		pop	si
		leave
		retn
shot_reimu_b_l6 endp

; ---------------------------------------------------------------------------
off_FCB6	dw offset loc_FC87
		dw offset loc_FC81
		dw offset loc_FC7B
		dw offset loc_FC75
; ---------------------------------------------------------------------------

shot_reimu_b_l7	proc near
		enter	4, 0
		push	si
		push	di
		mov	di, 3
		cmp	_shot_time, SHOT_CYCLE_FRAMES
		jnz	short loc_FCD3
		mov	byte_256A2, 0

loc_FCD3:
		mov	al, byte_256A2
		mov	ah, 0
		mov	bx, 2
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_FCE5
		add	di, 4

loc_FCE5:
		inc	byte_256A2
		mov	byte ptr [bp-3], 0BAh
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_FD75
; ---------------------------------------------------------------------------

loc_FCFA:
		cmp	di, 3
		jg	short loc_FD21
		mov	word ptr [bp-2], 0
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-3]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 1Ch
		mov	byte ptr [si+10h], 8
		mov	al, [bp-3]
		add	al, 6
		mov	[bp-3],	al
		jmp	short loc_FD6C
; ---------------------------------------------------------------------------

loc_FD21:
		cmp	di, 6
		jl	short loc_FD2D
		mov	word ptr [bp-2], 0FE80h
		jmp	short loc_FD32
; ---------------------------------------------------------------------------

loc_FD2D:
		mov	word ptr [bp-2], 180h

loc_FD32:
		mov	bx, di
		sub	bx, 4
		cmp	bx, 3
		ja	short loc_FD59
		add	bx, bx
		jmp	cs:off_FD84[bx]

loc_FD43:
		mov	byte ptr [bp-4], 0B2h
		jmp	short loc_FD59
; ---------------------------------------------------------------------------

loc_FD49:
		mov	byte ptr [bp-4], 0B9h
		jmp	short loc_FD59
; ---------------------------------------------------------------------------

loc_FD4F:
		mov	byte ptr [bp-4], 0CEh
		jmp	short loc_FD59
; ---------------------------------------------------------------------------

loc_FD55:
		mov	byte ptr [bp-4], 0C7h

loc_FD59:
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-4]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 20h ; ' '
		mov	byte ptr [si+10h], 9

loc_FD6C:
		mov	ax, [bp-2]
		add	[si+2],	ax
		dec	di
		jle	short loc_FD80

loc_FD75:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	loc_FCFA

loc_FD80:
		pop	di
		pop	si
		leave
		retn
shot_reimu_b_l7 endp

; ---------------------------------------------------------------------------
off_FD84	dw offset loc_FD55
		dw offset loc_FD4F
		dw offset loc_FD49
		dw offset loc_FD43
; ---------------------------------------------------------------------------

shot_reimu_b_l8	proc near
		enter	4, 0
		push	si
		push	di
		mov	di, 5
		cmp	_shot_time, SHOT_CYCLE_FRAMES
		jnz	short loc_FDA1
		mov	byte_256A2, 0

loc_FDA1:
		mov	al, byte_256A2
		mov	ah, 0
		mov	bx, 2
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_FDB3
		add	di, 4

loc_FDB3:
		inc	byte_256A2
		mov	byte ptr [bp-3], 0B8h
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	short loc_FE43
; ---------------------------------------------------------------------------

loc_FDC8:
		cmp	di, 5
		jg	short loc_FDEF
		mov	word ptr [bp-2], 0
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-3]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 1Ch
		mov	byte ptr [si+10h], 8
		mov	al, [bp-3]
		add	al, 4
		mov	[bp-3],	al
		jmp	short loc_FE3A
; ---------------------------------------------------------------------------

loc_FDEF:
		cmp	di, 8
		jl	short loc_FDFB
		mov	word ptr [bp-2], 0FE80h
		jmp	short loc_FE00
; ---------------------------------------------------------------------------

loc_FDFB:
		mov	word ptr [bp-2], 180h

loc_FE00:
		mov	bx, di
		sub	bx, 6
		cmp	bx, 3
		ja	short loc_FE27
		add	bx, bx
		jmp	cs:off_FE52[bx]

loc_FE11:
		mov	byte ptr [bp-4], 0B2h
		jmp	short loc_FE27
; ---------------------------------------------------------------------------

loc_FE17:
		mov	byte ptr [bp-4], 0B9h
		jmp	short loc_FE27
; ---------------------------------------------------------------------------

loc_FE1D:
		mov	byte ptr [bp-4], 0CEh
		jmp	short loc_FE27
; ---------------------------------------------------------------------------

loc_FE23:
		mov	byte ptr [bp-4], 0C7h

loc_FE27:
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-4]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 20h ; ' '
		mov	byte ptr [si+10h], 9

loc_FE3A:
		mov	ax, [bp-2]
		add	[si+2],	ax
		dec	di
		jle	short loc_FE4E

loc_FE43:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	loc_FDC8

loc_FE4E:
		pop	di
		pop	si
		leave
		retn
shot_reimu_b_l8 endp

; ---------------------------------------------------------------------------
off_FE52	dw offset loc_FE23
		dw offset loc_FE1D
		dw offset loc_FE17
		dw offset loc_FE11
; ---------------------------------------------------------------------------

shot_reimu_b_l9	proc near
		enter	4, 0
		push	si
		push	di
		mov	di, 7
		cmp	_shot_time, SHOT_CYCLE_FRAMES
		jnz	short loc_FE6F
		mov	byte_256A2, 0

loc_FE6F:
		mov	al, byte_256A2
		mov	ah, 0
		mov	bx, 2
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_FE81
		add	di, 4

loc_FE81:
		inc	byte_256A2
		mov	byte ptr [bp-3], 0B8h
		mov	_shot_ptr, offset _shots
		mov	_shot_last_id, 0
		jmp	loc_FF19
; ---------------------------------------------------------------------------

loc_FE97:
		cmp	di, 5
		jg	short loc_FEBE
		mov	word ptr [bp-2], 0
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-3]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 1Ch
		mov	byte ptr [si+10h], 8
		mov	al, [bp-3]
		add	al, 4
		mov	[bp-3],	al
		jmp	short loc_FF10
; ---------------------------------------------------------------------------

loc_FEBE:
		mov	bx, di
		sub	bx, 6
		cmp	bx, 5
		ja	short loc_FEEB
		add	bx, bx
		jmp	cs:off_FF28[bx]

loc_FECF:
		mov	byte ptr [bp-4], 0C0h
		jmp	short loc_FEEB
; ---------------------------------------------------------------------------

loc_FED5:
		mov	byte ptr [bp-4], 0ACh ;	''
		jmp	short loc_FEEB
; ---------------------------------------------------------------------------

loc_FEDB:
		mov	byte ptr [bp-4], 0D4h
		jmp	short loc_FEEB
; ---------------------------------------------------------------------------

loc_FEE1:
		mov	byte ptr [bp-4], 0B6h
		jmp	short loc_FEEB
; ---------------------------------------------------------------------------

loc_FEE7:
		mov	byte ptr [bp-4], 0CAh

loc_FEEB:
		test	di, 1
		jz	short loc_FEF8
		mov	word ptr [bp-2], 0FE80h
		jmp	short loc_FEFD
; ---------------------------------------------------------------------------

loc_FEF8:
		mov	word ptr [bp-2], 180h

loc_FEFD:
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [bp-4]
		call	main_01:shot_velocity_set
		mov	word ptr [si+0Eh], 20h ; ' '
		mov	byte ptr [si+10h], 9

loc_FF10:
		mov	ax, [bp-2]
		add	[si+2],	ax
		dec	di
		jle	short loc_FF24

loc_FF19:
		call	main_01:shots_add
		mov	si, ax
		or	ax, ax
		jnz	loc_FE97

loc_FF24:
		pop	di
		pop	si
		leave
		retn
shot_reimu_b_l9 endp

; ---------------------------------------------------------------------------
off_FF28	dw offset loc_FEE7
		dw offset loc_FEE1
		dw offset loc_FEDB
		dw offset loc_FED5
		dw offset loc_FECF
		dw offset loc_FECF

include th04/formats/bb_playchar.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_FFA4	proc near
		push	bp
		mov	bp, sp
		mov	byte_256A8, 0
		mov	fp_255AA, offset nullfunc_near
		pop	bp
		retn
sub_FFA4	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_FFB4	proc near
		push	bp
		mov	bp, sp
		cmp	byte_256A8, 0
		jnz	short loc_10028
		les	bx, _resident
		cmp	es:[bx+resident_t.rem_bombs], 0
		jz	short loc_10028
		cmp	byte_2D00A, 0
		jnz	short loc_10028
		cmp	_miss_time, 0
		jz	short loc_FFED
		cmp	_miss_time, MISS_ANIM_FRAMES
		jbe	short loc_10028
		mov	_miss_time, 0
		mov	byte_259A9, 0
		mov	byte_259A3, 0

loc_FFED:
		les	bx, _resident
		dec	es:[bx+resident_t.rem_bombs]
		nopcall	main_01:sub_EFA1
		mov	byte_256A8, 1
		mov	byte_256A9, 0
		mov	_player_invincibility_time, BOMB_INVINCIBILITY_FRAMES
		mov	ax, fp_255AC
		mov	fp_255AA, ax
		mov	_bullet_clear_time, 192
		call	snd_se_play pascal, 13
		mov	byte_236E0, 1
		les	bx, _resident
		inc	es:[bx+resident_t.bombs_used]

loc_10028:
		pop	bp
		retn
sub_FFB4	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1002A	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		cmp	_playchar, PLAYCHAR_REIMU
		jnz	short loc_10038
		mov	al, 0Fh
		jmp	short loc_1003A
; ---------------------------------------------------------------------------

loc_10038:
		mov	al, 2

loc_1003A:
		mov	byte_2CDCA, al
		mov	ax, _bb_playchar_seg
		mov	word_2CDCE, ax
		push	[bp+arg_0]
		call	main_01:sub_BF16
		pop	bp
		retn	2
sub_1002A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1004D	proc near

var_1		= byte ptr -1

		enter	2, 0
		call	main_01:grcg_setmode_tdw
		mov	ah, 0Fh
		call	main_01:grcg_setcolor_direct_noint_1
		call	main_01:playfield_fillm_0_40_384_274
		GRCG_OFF_CLOBBERING dx
		push	(32 shl 16) or 56
		push	0
		call	cdg_put_noalpha
		cmp	byte_256A9, 50h	; 'P'
		ja	short loc_10096
		mov	_circles_color, GC_RG
		mov	al, byte_256A9
		mov	ah, 0
		add	ax, 0FFD0h
		imul	ax, 3
		mov	dx, 196
		sub	dx, ax
		mov	PaletteTone, dx
		mov	_palette_changed, 1
		jmp	short loc_100FE
; ---------------------------------------------------------------------------

loc_10096:
		cmp	byte_256A9, 0A0h
		ja	short loc_100FE
		cmp	_stage_frame_mod4, 0
		jnz	short loc_100FE
		mov	al, byte ptr _stage_frame
		shl	al, 2
		mov	[bp+var_1], al
		push	offset _drawpoint
		push	(((PLAYFIELD_W / 2) shl 4) shl 16) or ((PLAYFIELD_H / 2) shl 4)
		push	(128 shl 4)
		mov	ah, 0
		push	ax
		call	vector2_at
		push	_drawpoint.x
		push	_drawpoint.y
		nopcall	main_01:circles_add_growing
		mov	al, 80h
		sub	al, [bp+var_1]
		mov	[bp+var_1], al
		push	offset _drawpoint
		push	(((PLAYFIELD_W / 2) shl 4) shl 16) or ((PLAYFIELD_H / 2) shl 4)
		push	(128 shl 4)
		mov	ah, 0
		push	ax
		call	vector2_at
		push	_drawpoint.x
		push	_drawpoint.y
		nopcall	main_01:circles_add_growing
		call	snd_se_play pascal, 9

loc_100FE:
		call	main_01:grcg_setmode_rmw_1
		mov	ah, GC_B
		call	main_01:grcg_setcolor_direct_noint_1
		push	0
		call	main_01:sub_1030D
		GRCG_OFF_CLOBBERING dx
		leave
		retn
sub_1004D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10113	proc near

var_2		= word ptr -2

		enter	2, 0
		push	si
		call	main_01:grcg_setmode_tdw
		mov	ah, GC_RGI
		call	main_01:grcg_setcolor_direct_noint_1
		call	main_01:playfield_fillm_0_40_384_274
		GRCG_OFF_CLOBBERING dx
		push	(32 shl 16) or 56
		push	0
		call	cdg_put_noalpha
		cmp	byte_256A9, 50h	; 'P'
		ja	short loc_1015E
		mov	_circles_color, 0Fh
		mov	al, byte_256A9
		mov	ah, 0
		add	ax, 0FFD0h
		imul	ax, 3
		mov	dx, 196
		sub	dx, ax
		mov	PaletteTone, dx
		mov	_palette_changed, 1
		jmp	loc_101F4
; ---------------------------------------------------------------------------

loc_1015E:
		cmp	byte_256A9, 0A0h
		ja	loc_101F4
		cmp	_stage_frame_mod4, 0
		jnz	loc_101F4
		mov	al, byte_256A9
		mov	ah, 0
		add	ax, 0FFB0h
		shl	ax, 2
		mov	si, ax
		mov	al, byte_256A9
		mov	ah, 0
		mov	dx, 0A1h
		sub	dx, ax
		imul	dx, 3
		add	dx, 28h	; '('
		mov	[bp-2],	dx
		cmp	byte_256A9, 78h	; 'x'
		jnb	short loc_101B6
		mov	al, byte_256A9
		mov	ah, 0
		add	ax, 0FFB0h
		shl	ax, 3
		push	ax
		call	main_01:randring1_next16_mod
		mov	dl, byte_256A9
		mov	dh, 0
		add	dx, 0FFC0h
		shl	dx, 2
		sub	ax, dx
		jmp	short loc_101D7
; ---------------------------------------------------------------------------

loc_101B6:
		mov	al, byte_256A9
		mov	ah, 0
		mov	dx, 0A1h
		sub	dx, ax
		shl	dx, 3
		push	dx
		call	main_01:randring1_next16_mod
		mov	dl, byte_256A9
		mov	dh, 0
		mov	bx, 0A1h
		sub	bx, dx
		shl	bx, 2
		sub	ax, bx

loc_101D7:
		add	ax, si
		mov	si, ax
		mov	ax, si
		shl	ax, 4
		push	ax
		mov	ax, [bp+var_2]
		shl	ax, 4
		push	ax
		nopcall	main_01:circles_add_growing
		call	snd_se_play pascal, 9

loc_101F4:
		call	main_01:grcg_setmode_rmw_1
		mov	ah, GC_BRG
		call	main_01:grcg_setcolor_direct_noint_1
		push	1
		call	main_01:sub_1030D
		GRCG_OFF_CLOBBERING dx
		pop	si
		leave
		retn
sub_10113	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1020A	proc near
		push	bp
		mov	bp, sp
		cmp	byte_256A8, 0
		jz	loc_1030B
		cmp	byte_256A9, 20h	; ' '
		jnb	short loc_1022A
		mov	al, byte_256A9
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		jmp	short loc_1023E
; ---------------------------------------------------------------------------

loc_1022A:
		cmp	byte_256A9, 30h	; '0'
		jnb	short loc_10245
		mov	al, byte_256A9
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	ax, 0FFF8h

loc_1023E:
		push	ax
		call	main_01:sub_1002A

loc_10242:
		jmp	loc_10307
; ---------------------------------------------------------------------------

loc_10245:
		cmp	byte_256A9, 30h	; '0'
		jnz	short loc_10281
		mov	_scroll_active, 0
		call	graph_scrollup pascal, 0
		mov	fp_255AA, offset nullfunc_near
		mov	al, Palettes+42
		mov	byte_257D6, al
		mov	al, Palettes+43
		mov	byte_257D7, al
		mov	al, Palettes+44
		mov	byte_257D8, al
		mov	Palettes+42, 0F0h
		mov	Palettes+43, 0B0h ; ''
		mov	Palettes+44, 0C0h
		jmp	short loc_10288
; ---------------------------------------------------------------------------

loc_10281:
		cmp	byte_256A9, 0B0h ; ''
		jnb	short loc_1028E

loc_10288:
		call	fp_256AC
		jmp	short loc_10307
; ---------------------------------------------------------------------------

loc_1028E:
		cmp	byte_256A9, 0B0h ; ''
		jnz	short loc_102A8
		call	snd_se_play pascal, 15
		mov	_scroll_active, 1
		mov	byte_236E0, 0
		jmp	short loc_102AF
; ---------------------------------------------------------------------------

loc_102A8:
		cmp	byte_256A9, 0E2h
		jnb	short loc_102F2

loc_102AF:
		mov	al, byte_257D6
		mov	Palettes+42, al
		mov	al, byte_257D7
		mov	Palettes+43, al
		mov	al, byte_257D8
		mov	Palettes+44, al
		mov	ax, fp_255AC
		mov	fp_255AA, ax
		mov	al, byte_256A9
		mov	ah, 0
		add	ax, 0FF50h
		add	ax, ax
		mov	dx, 200
		sub	dx, ax
		mov	PaletteTone, dx
		mov	_palette_changed, 1
		cmp	byte_256A9, 0B1h
		jnz	short loc_10307
		call	graph_scrollup pascal, _scroll_line
		jmp	loc_10242
; ---------------------------------------------------------------------------

loc_102F2:
		mov	byte_256A8, 0
		mov	PaletteTone, 100
		mov	_palette_changed, 1
		mov	_circles_color, GC_R

loc_10307:
		inc	byte_256A9

loc_1030B:
		pop	bp
		retn
sub_1020A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1030D	proc near

var_4		= word ptr -4
var_2		= word ptr -2
arg_0		= word ptr  4

		enter	4, 0
		push	si
		push	di
		cmp	byte_256A9, 30h	; '0'
		jnz	short loc_10386
		mov	si, 4370h
		xor	di, di
		jmp	short loc_10381
; ---------------------------------------------------------------------------

loc_10321:
		push	1800h
		call	main_01:randring1_next16_mod
		mov	[si], ax
		push	1700h
		call	main_01:randring1_next16_mod
		mov	[si+2],	ax
		cmp	[bp+arg_0], 0
		jnz	short loc_1036F
		mov	byte ptr [si+4], 0C0h
		jmp	short loc_10346
; ---------------------------------------------------------------------------

loc_1033E:
		push	1800h
		call	main_01:randring1_next16_mod
		mov	[si], ax

loc_10346:
		cmp	word ptr [si], 800h
		jl	short loc_10352
		cmp	word ptr [si], 1000h
		jle	short loc_1033E

loc_10352:
		cmp	word ptr [si], 0C00h
		jg	short loc_1035F
		mov	ax, 820h
		sub	ax, [si]
		jmp	short loc_10364
; ---------------------------------------------------------------------------

loc_1035F:
		mov	ax, [si]
		add	ax, 0F020h

loc_10364:
		mov	[bp+var_2], ax
		mov	bx, 9
		cwd
		idiv	bx
		jmp	short loc_1037A
; ---------------------------------------------------------------------------

loc_1036F:
		mov	byte ptr [si+4], 0E0h
		push	7Fh
		call	main_01:randring1_next16_and
		add	al, 0A0h

loc_1037A:
		mov	[si+5],	al
		inc	di
		add	si, 6

loc_10381:
		cmp	di, 30h	; '0'
		jl	short loc_10321

loc_10386:
		mov	si, 4370h
		xor	di, di
		jmp	loc_1041D
; ---------------------------------------------------------------------------

loc_1038E:
		push	ss
		lea	ax, [bp+var_2]
		push	ax
		push	ss
		lea	ax, [bp+var_4]
		push	ax
		push	word ptr [si+4]
		mov	al, [si+5]
		mov	ah, 0
		push	ax
		call	vector2
		mov	ax, [bp+var_2]
		add	[si], ax
		mov	ax, [bp+var_4]
		add	[si+2],	ax
		cmp	word ptr [si], 0FF80h
		jle	short loc_103C9
		cmp	word ptr [si], 1880h
		jge	short loc_103C9
		cmp	word ptr [si+2], 0FF80h
		jle	short loc_103C9
		cmp	word ptr [si+2], 1800h
		jl	short loc_103F8

loc_103C9:
		cmp	[bp+arg_0], 0
		jnz	short loc_103D6
		mov	word ptr [si+2], 1800h
		jmp	short loc_103F8
; ---------------------------------------------------------------------------

loc_103D6:
		test	di, 1
		jz	short loc_103EB
		mov	word ptr [si], 0FF80h
		push	1700h
		call	main_01:randring1_next16_mod
		mov	[si+2],	ax
		jmp	short loc_103F8
; ---------------------------------------------------------------------------

loc_103EB:
		push	1800h
		call	main_01:randring1_next16_mod
		mov	[si], ax
		mov	word ptr [si+2], 1780h

loc_103F8:
		mov	ax, GRAM_400
		mov	es, ax
		assume es:nothing
		mov	ax, [si]
		sar	ax, 4
		add	ax, 18h
		mov	[bp+var_2], ax
		mov	ax, [si+2]
		sar	ax, 4
		add	ax, 8
		mov	cx, [bp+var_2]
		push	78h ; 'x'
		call	main_01:sub_C01A
		inc	di
		add	si, 6

loc_1041D:
		cmp	di, 30h	; '0'
		jl	loc_1038E
		pop	di
		pop	si
		leave
		retn	2
sub_1030D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1042A	proc near
		push	bp
		mov	bp, sp
		mov	word_25608, 0
		mov	byte_2560A, 0
		mov	_shot_time, 0
		mov	_player_is_hit, 0
		pop	bp
		retn
sub_1042A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10444	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	_tile_invalidate_box.x, 16
		mov	_tile_invalidate_box.y, 16
		mov	si, offset _shots
		xor	di, di
		jmp	short loc_1046E
; ---------------------------------------------------------------------------

loc_1045C:
		cmp	[si+shot_t.flag], 0
		jz	short loc_1046A
		call	main_01:tiles_invalidate_around pascal, [si+shot_t.pos.prev.y], [si+shot_t.pos.prev.x]

loc_1046A:
		inc	di
		add	si, size shot_t

loc_1046E:
		cmp	di, SHOT_COUNT
		jl	short loc_1045C
		cmp	word_25608, 20h	; ' '
		jb	short loc_104B2
		mov	_tile_invalidate_box.x, 8
		mov	ax, word ptr dword_25610+2
		mov	bx, 10h
		cwd
		idiv	bx
		mov	_tile_invalidate_box.y, ax
		mov	ax, word ptr dword_25610+2
		cwd
		sub	ax, dx
		sar	ax, 1
		push	ax
		mov	ax, word ptr dword_25610
		add	ax, (-24 shl 4)
		push	ax
		call	main_01:tiles_invalidate_around
		mov	ax, word ptr dword_25610+2
		cwd
		sub	ax, dx
		sar	ax, 1
		push	ax
		mov	ax, word ptr dword_25610
		add	ax, (24 shl 4)
		push	ax
		call	main_01:tiles_invalidate_around

loc_104B2:
		pop	di
		pop	si
		pop	bp
		retn
sub_10444	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_104B6	proc near

@@i		= word ptr -2

		enter	2, 0
		push	si
		push	di
		mov	word_2597E, 0
		mov	si, offset _shots
		mov	di, 44A6h
		mov	[bp+@@i], 0
		jmp	short loc_1052D
; ---------------------------------------------------------------------------

loc_104CF:
		cmp	byte ptr [si], 12h
		jb	short loc_104D7
		mov	byte ptr [si], 0

loc_104D7:
		cmp	byte ptr [si], 0
		jz	short loc_10527
		lea	ax, [si+2]
		call	_motion_update_1 pascal, ax
		cmp	ax, (-(SHOT_W / 2) shl 4)
		jle	short loc_104F8
		cmp	ax, ((PLAYFIELD_W + (SHOT_W / 2)) shl 4)
		jge	short loc_104F8
		cmp	dx, (-(SHOT_H / 2) shl 4)
		jle	short loc_104F8
		cmp	dx, ((PLAYFIELD_H + (SHOT_H / 2)) shl 4)
		jl	short loc_104FD

loc_104F8:
		mov	byte ptr [si], 12h
		jmp	short loc_10527
; ---------------------------------------------------------------------------

loc_104FD:
		cmp	byte ptr [si], 1
		jbe	short loc_10515
		inc	byte ptr [si]
		mov	al, [si]
		mov	ah, 0
		and	ax, 3
		cmp	ax, 2
		jnz	short loc_10527
		inc	word ptr [si+0Eh]
		jmp	short loc_10527
; ---------------------------------------------------------------------------

loc_10515:
		mov	[di], ax
		mov	[di+2],	dx
		mov	[di+4],	si
		add	di, 6
		inc	word_2597E
		inc	byte ptr [si+1]

loc_10527:
		inc	[bp+@@i]
		add	si, size shot_t

loc_1052D:
		cmp	[bp+@@i], SHOT_COUNT
		jl	short loc_104CF
		cmp	word_25608, 0
		jz	short loc_1054E
		mov	eax, dword_2560C
		mov	dword_25610, eax
		mov	eax, _player_option_pos_cur
		mov	dword_2560C, eax
		dec	word_25608

loc_1054E:
		pop	di
		pop	si
		leave
		retn
sub_104B6	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10552	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	ax, GRAM_400
		mov	es, ax
		call	main_01:grcg_setmode_rmw_1
		cmp	word_25608, 20h	; ' '
		jbe	short loc_10569
		call	main_01:sub_E1F4

loc_10569:
		mov	si, offset _shots[(SHOT_COUNT - 1) * size shot_t]
		xor	di, di
		jmp	short loc_105AA
; ---------------------------------------------------------------------------

loc_10570:
		cmp	byte ptr [si], 0
		jz	short loc_105A6
		cmp	byte ptr [si], 12h
		jnb	short loc_105A6
		mov	ch, 0
		mov	cl, [si+0Eh]
		cmp	byte ptr [si], 1
		jnz	short loc_1058D
		mov	al, [si+1]
		and	al, 1
		add	al, cl
		mov	cl, al

loc_1058D:
		mov	ax, [si+4]
		add	ax, (8 shl 4)
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, ax
		mov	dx, ax
		mov	ax, [si+2]
		sar	ax, 4
		add	ax, 24
		call	main_01:z_super_roll_put_tiny_16x16_raw pascal, cx

loc_105A6:
		inc	di
		sub	si, 12h

loc_105AA:
		cmp	di, SHOT_COUNT
		jl	short loc_10570
		GRCG_OFF_CLOBBERING dx
		pop	di
		pop	si
		pop	bp
		retn
sub_10552	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_105B9	proc far

var_F		= byte ptr -0Fh
var_E		= word ptr -0Eh
var_C		= word ptr -0Ch
var_A		= word ptr -0Ah
var_8		= word ptr -8
var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2

		enter	10h, 0
		push	si
		push	di
		mov	ax, word ptr dword_257DE
		sub	ax, word_257E2
		mov	[bp+var_6], ax
		mov	ax, word ptr dword_257DE+2
		sub	ax, word_257E4
		mov	[bp+var_8], ax
		mov	ax, word_257E2
		add	ax, ax
		mov	[bp+var_A], ax
		mov	ax, word_257E4
		add	ax, ax
		mov	[bp+var_C], ax
		xor	di, di
		mov	[bp+var_F], 0
		mov	[bp+var_4], 44A6h
		mov	[bp+var_2], 0
		jmp	short loc_10664
; ---------------------------------------------------------------------------

loc_105F5:
		mov	bx, [bp+var_4]
		mov	ax, [bx]
		sub	ax, [bp+var_6]
		cmp	ax, [bp+var_A]
		ja	short loc_1065D
		mov	ax, [bx+2]
		sub	ax, [bp+var_8]
		cmp	ax, [bp+var_C]
		ja	short loc_1065D
		mov	si, [bx+4]
		mov	byte ptr [si], 2
		mov	ax, [si+0Ah]
		mov	bx, 6
		cwd
		idiv	bx
		mov	[si+0Ah], ax
		mov	ax, [si+0Ch]
		cwd
		idiv	bx
		mov	[si+0Ch], ax
		mov	word ptr [si+0Eh], 28h ; '('
		inc	[bp+var_F]
		mov	al, [si+10h]
		mov	ah, 0
		mov	dl, [bp+var_F]
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		add	di, ax
		inc	byte_25980
		test	byte_25980, 1
		jz	short loc_1065D
		call	sparks_add_random pascal, word ptr [si+2], word ptr [si+4], large (((8 shl 4) shl 16) or 1)

loc_1065D:
		inc	[bp+var_2]
		add	[bp+var_4], 6

loc_10664:
		mov	ax, [bp+var_2]
		cmp	ax, word_2597E
		jb	short loc_105F5
		cmp	byte_256A8, 0
		jz	short loc_1068C
		cmp	_stage_frame_mod4, 0
		jnz	short loc_1067E
		add	di, 5

loc_1067E:
		cmp	byte_22E9C, 0
		jz	short loc_1068C
		mov	ax, di
		shr	ax, 2
		mov	di, ax

loc_1068C:
		cmp	_stage_frame_mod2, 0
		jz	short loc_10704
		cmp	word_25608, 20h	; ' '
		jbe	short loc_10704
		mov	ax, [bp+var_8]
		cmp	ax, word ptr dword_2560C+2
		ja	short loc_10704
		mov	ax, word ptr dword_2560C
		add	ax, 0FE80h
		mov	[bp+var_E], ax
		sub	ax, [bp+var_6]
		cmp	ax, [bp+var_A]
		ja	short loc_106D4
		add	di, 3
		inc	byte_25980
		test	byte_25980, 3
		jnz	short loc_106D4
		call	sparks_add_random pascal, [bp+var_E], word ptr dword_257DE+2, large (((8 shl 4) shl 16) or 1)

loc_106D4:
		add	[bp+var_E], 300h
		mov	ax, [bp+var_E]
		sub	ax, [bp+var_6]
		cmp	ax, [bp+var_A]
		ja	short loc_10704
		add	di, 3
		inc	byte_25980
		test	byte_25980, 3
		jnz	short loc_10704
		call	sparks_add_random pascal, [bp+var_E], word ptr dword_257DE+2, large (((8 shl 4) shl 16) or 1)

loc_10704:
		movzx	eax, di
		add	_score_delta, eax
		mov	ax, di
		pop	di
		pop	si
		leave
		retf
sub_105B9	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10713	proc near

@@patnum		= byte ptr -5
var_4		= word ptr -4
var_2		= word ptr -2

		enter	6, 0
		push	si
		push	di
		mov	si, 8A92h
		mov	[bp+var_2], 0
		jmp	loc_107D6
; ---------------------------------------------------------------------------

loc_10724:
		cmp	byte ptr [si], 1
		jz	short loc_10730
		cmp	byte ptr [si], 80h
		jb	loc_107D0

loc_10730:
		cmp	word ptr [si+8], 0FF00h
		jle	loc_107D0
		cmp	word ptr [si+8], 1800h
		jge	loc_107D0
		mov	al, [si+0Eh]
		mov	[bp+@@patnum], al
		cmp	byte ptr [si+25h], 1
		jbe	short loc_10776
		mov	al, [si+1]
		mov	ah, 0
		mov	dl, [si+26h]
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		or	dx, dx
		jnz	short loc_10770
		inc	byte ptr [si+27h]
		mov	al, [si+27h]
		cmp	al, [si+25h]
		jb	short loc_10770
		mov	byte ptr [si+27h], 0

loc_10770:
		mov	al, [si+27h]
		add	[bp+@@patnum], al

loc_10776:
		mov	ax, [si+2]
		sar	ax, 4
		add	ax, 10h
		mov	di, ax
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, word ptr [si+4]
		mov	[bp+var_4], ax
		or	di, di
		jle	short loc_107D0
		cmp	di, 1A0h
		jge	short loc_107D0
		cmp	word ptr [si+4], 0FF00h
		jle	short loc_107D0
		cmp	word ptr [si+4], 1800h
		jge	short loc_107D0
		cmp	byte ptr [si+24h], 0
		jnz	short loc_107B7
		push	di
		push	ax
		mov	al, [bp+@@patnum]
		mov	ah, 0
		push	ax
		call	super_roll_put
		jmp	short loc_107D0
; ---------------------------------------------------------------------------

loc_107B7:
		push	di
		push	[bp+var_4]
		mov	al, [bp+@@patnum]
		mov	ah, 0
		push	ax
		pushd	PLANE_PUT or GC_BRGI
		call	super_roll_put_1plane
		mov	byte ptr [si+24h], 0

loc_107D0:
		inc	[bp+var_2]
		add	si, 40h

loc_107D6:
		cmp	[bp+var_2], 20h	; ' '
		jl	loc_10724
		pop	di
		pop	si
		leave
		retn
sub_10713	endp

include th04/player/invalidate.asm
include th04/player/move.asm
include th04/player/pos_update_and_clamp.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10988	proc near

var_1		= byte ptr -1

		enter	2, 0
		dec	_miss_time
		cmp	_miss_time, MISS_ANIM_FRAMES
		ja	locret_10ABD
		cmp	_miss_time, MISS_ANIM_FRAMES
		jnz	loc_10A25
		mov	_player_pos.velocity.x, 0
		mov	_player_pos.velocity.y, 0
		mov	_power_overflow_level, 0
		mov	_miss_explosion_radius, 0
		call	items_miss_add
		mov	al, _power
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		mov	[bp+var_1], al
		cmp	[bp+var_1], 10h
		jbe	short loc_109D7
		mov	[bp+var_1], 10h

loc_109D7:
		mov	al, [bp+var_1]
		sub	_power, al
		cmp	_dream_items_collected, 0
		jz	short loc_109E9
		dec	_dream_items_collected

loc_109E9:
		mov	al, _dream_items_collected
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	ax, _DREAM_SCORE_PER_ITEMS[bx]
		mov	_dream_score, ax
		nopcall	main_01:hud_dream_put
		nopcall	main_01:sub_11DE6
		call	snd_se_play pascal, 2
		cmp	_playperf, 22
		jb	short loc_10A16
		mov	_playperf, 21

loc_10A16:
		push	4
		nopcall	_playperf_lower
		les	bx, _resident
		assume es:nothing
		inc	es:[bx+resident_t.miss_count]

loc_10A25:
		add	_miss_explosion_radius, MISS_EXPLOSION_RADIUS_VELOCITY
		mov	al, _miss_explosion_angle
		add	al, MISS_EXPLOSION_ANGLE_VELOCITY
		mov	_miss_explosion_angle, al
		cmp	_miss_time, MISS_ANIM_FRAMES - MISS_ANIM_FLASH_AT
		jnb	locret_10ABD
		les	bx, _resident
		cmp	es:[bx+resident_t.rem_lives], 1
		jbe	short loc_10A60
		test	_miss_time, 1
		jz	short loc_10A55
		mov	PaletteTone, 150
		jmp	short loc_10A5B
; ---------------------------------------------------------------------------

loc_10A55:
		mov	PaletteTone, 100

loc_10A5B:
		mov	_palette_changed, 1

loc_10A60:
		cmp	_miss_time, 0
		jnz	short locret_10ABD
		mov	_player_pos.cur.x, 192 * 16
		mov	_player_pos.prev.x, 192 * 16
		mov	_player_pos.cur.y, 368 * 16
		mov	_player_pos.prev.y, 368 * 16
		mov	_player_pos.velocity.x, 0
		mov	_player_pos.velocity.y, -32
		les	bx, _resident
		cmp	es:[bx+resident_t.rem_lives], 1
		jbe	short loc_10AB7
		dec	es:[bx+resident_t.rem_lives]
		nopcall	main_01:sub_EEE8
		les	bx, _resident
		mov	al, es:[bx+resident_t.credit_bombs]
		mov	es:[bx+resident_t.rem_bombs], al
		nopcall	main_01:sub_EFA1
		mov	_bullet_clear_time, 32
		leave
		retn
; ---------------------------------------------------------------------------

loc_10AB7:
		call	main_01:sub_E541
		mov	byte_266D2, al

locret_10ABD:
		leave
		retn
sub_10988	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10ABF	proc near

@@move_ret	= byte ptr -2
var_1     	= byte ptr -1

		enter	2, 0
		push	si
		cmp	_player_invincibility_time, 0
		jz	short loc_10ACF
		dec	_player_invincibility_time

loc_10ACF:
		cmp	byte_259A9, 0
		jz	short loc_10B11
		cmp	_player_invincibility_time, 0
		jz	short loc_10AE4
		mov	byte_259A9, 0
		jmp	short loc_10B11
; ---------------------------------------------------------------------------

loc_10AE4:
		cmp	word_25608, 21h	; '!'
		jbe	short loc_10AF1
		mov	word_25608, 21h	; '!'

loc_10AF1:
		mov	_miss_time, MISS_ANIM_FRAMES + DEATHBOMB_WINDOW
		mov	byte_259A9, 0
		mov	_player_invincibility_time, MISS_INVINCIBILITY_FRAMES
		mov	byte_259A3, 48h	; 'H'
		mov	_player_pos.velocity.x, 0
		mov	_player_pos.velocity.y, 0

loc_10B11:
		cmp	byte_259A3, 0
		jnz	loc_10BBD
		mov	_player_pos.velocity.x, 0
		mov	_player_pos.velocity.y, 0
		mov	ax, _key_det
		and	ax, INPUT_MOVEMENT
		mov	si, ax
		mov	[bp+var_1], 1

loc_10B32:
		call	main_01:player_move pascal, si
		mov	[bp+@@move_ret], al
		cmp	[bp+@@move_ret], 0
		jnz	short loc_10B58
		cmp	[bp+var_1], 0
		jz	short loc_10B58
		cmp	word_2598C, si
		jz	short loc_10B58
		mov	ax, word_2598C
		not	ax
		and	si, ax
		mov	[bp+var_1], 0
		jmp	short loc_10B32
; ---------------------------------------------------------------------------

loc_10B58:
		cmp	_shiftkey, 0
		jz	short loc_10B75
		mov	ax, _player_pos.velocity.x
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	_player_pos.velocity.x, ax
		mov	ax, _player_pos.velocity.y
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	_player_pos.velocity.y, ax

loc_10B75:
		call	main_01:player_pos_update_and_clamp
		cmp	[bp+var_1], 0
		jz	short loc_10B82
		mov	word_2598C, si

loc_10B82:
		test	_key_det.lo, low INPUT_SHOT
		jz	short loc_10B97
		cmp	_shot_time, 1
		ja	short loc_10B97
		mov	_shot_time, SHOT_CYCLE_FRAMES
		jmp	short loc_10BB0
; ---------------------------------------------------------------------------

loc_10B97:
		cmp	_shot_time, 0
		jz	short loc_10BC7
		dec	_shot_time
		cmp	_shot_time, (SHOT_CYCLE_FRAMES / 3) * 1
		jz	short loc_10BB0
		cmp	_shot_time, (SHOT_CYCLE_FRAMES / 3) * 2
		jnz	short loc_10BC7

loc_10BB0:
		call	playchar_shot_func
		call	snd_se_play pascal, 1
		jmp	short loc_10BC7
; ---------------------------------------------------------------------------

loc_10BBD:
		call	_motion_update_1 pascal, offset _player_pos
		dec	byte_259A3

loc_10BC7:
		mov	eax, _player_option_pos_cur
		mov	_player_option_pos_prev, eax
		mov	eax, _player_pos.cur
		mov	_player_option_pos_cur, eax
		mov	ax, _player_pos.velocity.x
		sub	_player_option_pos_cur.x, ax
		mov	ax, _player_pos.velocity.y
		sub	_player_option_pos_cur.y, ax
		test	_key_det.lo, low INPUT_BOMB
		jz	short loc_10BF0
		call	fp_256AA

loc_10BF0:
		cmp	_miss_time, 0
		jz	short loc_10BFA
		call	main_01:sub_10988

loc_10BFA:
		pop	si
		leave
		retn
sub_10ABF	endp

include th04/player/render.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10D4B	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	si, 1
		jmp	short loc_10D6E
; ---------------------------------------------------------------------------

loc_10D55:
		mov	di, 4
		jmp	short loc_10D68
; ---------------------------------------------------------------------------

loc_10D5A:
		call	text_putca pascal, di, si, (' ' shl 16) + TX_WHITE
		inc	di

loc_10D68:
		cmp	di, 52
		jl	short loc_10D5A
		inc	si

loc_10D6E:
		cmp	si, 24
		jl	short loc_10D55
		pop	di
		pop	si
		pop	bp
		retn
sub_10D4B	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10D77	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	si, 1
		jmp	short loc_10D9A
; ---------------------------------------------------------------------------

loc_10D81:
		mov	di, 4
		jmp	short loc_10D94
; ---------------------------------------------------------------------------

loc_10D86:
		call	text_putca pascal, di, si, (' ' shl 16) + TX_BLACK + TX_REVERSE
		inc	di

loc_10D94:
		cmp	di, 52
		jl	short loc_10D86
		inc	si

loc_10D9A:
		cmp	si, 24
		jl	short loc_10D81
		pop	di
		pop	si
		pop	bp
		retn
sub_10D77	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10DA3	proc near

var_1		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		cmp	byte_22EA2, 48h	; 'H'
		jb	short loc_10DE5
		call	main_01:sub_10D4B
		les	bx, _resident
		cmp	es:[bx+resident_t.demo_num], 0
		jnz	short loc_10DC6
		mov	_overlay_text_fp, offset sub_10F36
		jmp	short loc_10DDE
; ---------------------------------------------------------------------------

loc_10DC6:
		mov	_overlay_text_fp, offset nullfunc_near
		call	gaiji_putsa pascal, (18 shl 16) + 12, ds, offset gDEMO_PLAY, TX_YELLOW + TX_BLINK

loc_10DDE:
		mov	_popup_byte_unknown, 0
		jmp	short loc_10E35
; ---------------------------------------------------------------------------

loc_10DE5:
		mov	al, byte_22EA2
		mov	ah, 0
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_10E31
		mov	al, byte_22EA2
		mov	ah, 0
		cwd
		idiv	bx
		mov	[bp+var_1], al
		cmp	[bp+var_1], 0
		jz	short loc_10E31
		mov	si, 1
		jmp	short loc_10E2C
; ---------------------------------------------------------------------------

loc_10E0A:
		mov	di, 4
		jmp	short loc_10E26
; ---------------------------------------------------------------------------

loc_10E0F:
		push	di
		push	si
		mov	al, [bp+var_1]
		mov	ah, 0
		mov	dx, 40h
		sub	dx, ax
		push	dx
		push	TX_BLACK
		call	gaiji_putca
		add	di, 2

loc_10E26:
		cmp	di, 52
		jl	short loc_10E0F
		inc	si

loc_10E2C:
		cmp	si, 24
		jl	short loc_10E0A

loc_10E31:
		inc	byte_22EA2

loc_10E35:
		pop	di
		pop	si
		leave
		retn
sub_10DA3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10E39	proc near

var_1		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		cmp	byte_22EA2, 0
		jnz	short loc_10E51
		call	main_01:sub_10D77
		mov	_overlay_text_fp, offset nullfunc_near
		jmp	short loc_10EA1
; ---------------------------------------------------------------------------

loc_10E51:
		dec	byte_22EA2
		mov	al, byte_22EA2
		mov	ah, 0
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_10EA1
		mov	al, byte_22EA2
		mov	ah, 0
		cwd
		idiv	bx
		mov	[bp+var_1], al
		cmp	[bp+var_1], 0
		jz	short loc_10EA1
		mov	si, 1
		jmp	short loc_10E9C
; ---------------------------------------------------------------------------

loc_10E7A:
		mov	di, 4
		jmp	short loc_10E96
; ---------------------------------------------------------------------------

loc_10E7F:
		push	di
		push	si
		mov	al, [bp+var_1]
		mov	ah, 0
		mov	dx, 40h
		sub	dx, ax
		push	dx
		push	TX_BLACK
		call	gaiji_putca
		add	di, 2

loc_10E96:
		cmp	di, 52
		jl	short loc_10E7F
		inc	si

loc_10E9C:
		cmp	si, 24
		jl	short loc_10E7A

loc_10EA1:
		pop	di
		pop	si
		leave
		retn
sub_10E39	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10EA5	proc near

arg_0		= word ptr  4
@@y		= word ptr  6
arg_4		= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	si, [bp+arg_4]
		mov	di, [bp+arg_0]
		dec	si
		add	di, si
		mov	ax, 8
		imul	di
		mov	di, ax
		mov	ax, 8
		imul	si
		mov	si, ax
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, [bp+@@y]
		mov	[bp+@@y], ax
		mov	ax, GRAM_400
		mov	es, ax
		assume es:nothing
		jmp	short loc_10EE3
; ---------------------------------------------------------------------------

loc_10ED1:
		mov	al, byte_22EF6
		mov	ah, 0
		mov	cx, ax
		mov	dx, [bp+@@y]
		mov	ax, si
		call	main_01:sub_C09A
		add	si, 10h

loc_10EE3:
		cmp	si, di
		jl	short loc_10ED1
		pop	di
		pop	si
		pop	bp
		retn	6
sub_10EA5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10EED	proc near

var_1		= byte ptr -1

		enter	2, 0
		mov	al, _popup_byte_unknown
		add	al, byte_22EA3
		mov	[bp+var_1], al
		cmp	[bp+var_1], 0
		jz	short locret_10F34
		cmp	[bp+var_1], 0C0h
		jnb	short loc_10F0D
		cmp	[bp+var_1], 22h	; '"'
		ja	short locret_10F34

loc_10F0D:
		mov	_tile_invalidate_box.x, PLAYFIELD_W
		mov	_tile_invalidate_box.y, 32
		call	main_01:tiles_invalidate_around pascal, large ((168 shl 4) shl 16) or (192 shl 4)
		call	main_01:tiles_invalidate_around pascal, large ((200 shl 4) shl 16) or (192 shl 4)
		call	main_01:tiles_invalidate_around pascal, large ((360 shl 4) shl 16) or (192 shl 4)

locret_10F34:
		leave
		retn
sub_10EED	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10F36	proc near
		push	bp
		mov	bp, sp
		cmp	_popup_byte_unknown, 0C0h
		jb	loc_10FED
		cmp	_popup_byte_unknown, 0C0h
		jnz	short loc_10F53
		call	main_01:sub_10D4B
		mov	byte_22EF6, 0
		jmp	short loc_10F5E
; ---------------------------------------------------------------------------

loc_10F53:
		test	_popup_byte_unknown, 1
		jnz	short loc_10F5E
		inc	byte_22EF6

loc_10F5E:
		cmp	byte_22EF6, 10h
		jb	short loc_10F80
		test	_popup_byte_unknown, 1
		jz	loc_1118F
		mov	_overlay_text_fp, offset nullfunc_near
		mov	_popup_byte_unknown, 0
		mov	byte_22EF6, 0
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_10F80:
		call	main_01:grcg_setmode_rmw_1
		mov	ah, GC_G
		call	main_01:grcg_setcolor_direct_noint_1
		cmp	stage_id, 5
		jnb	short loc_10F99
		push	150A80h
		push	0Eh
		jmp	short loc_10FA1
; ---------------------------------------------------------------------------

loc_10F99:
		push	110A80h
		push	16h

loc_10FA1:
		call	main_01:sub_10EA5
		mov	ax, 30h	; '0'
		sub	ax, bgm_title_len
		push	ax
		push	16800002h
		call	main_01:sub_10EA5
		mov	ah, 0Fh
		call	main_01:grcg_setcolor_direct_noint_1
		mov	ax, 33h	; '3'
		sub	ax, bgm_title_len
		push	ax
		push	1680h
		push	bgm_title_len
		call	main_01:sub_10EA5
		mov	ax, stage_title_len
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	dx, 1Ch
		sub	dx, ax
		push	dx
		push	0C80h
		push	stage_title_len
		call	main_01:sub_10EA5
		GRCG_OFF_CLOBBERING dx
		jmp	loc_1118F
; ---------------------------------------------------------------------------

loc_10FED:
		cmp	_popup_byte_unknown, 0
		jnz	short loc_11057
		mov	byte_22EF6, 10h
		mov	al, stage_id
		inc	al
		mov	stage_title_id, al
		mov	al, stage_id
		add	al, al
		inc	al
		mov	_bgm_title_id, al
		cmp	stage_id, 0
		jnz	short loc_11023
		cmp	_playchar, PLAYCHAR_REIMU
		jnz	short loc_11023
		mov	stage_title_id, 0
		mov	_bgm_title_id, 0

loc_11023:
		mov	al, stage_title_id
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		pushd	STAGE_TITLE[bx]
		call	_strlen
		add	sp, 4
		mov	stage_title_len, ax
		mov	al, _bgm_title_id
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		pushd	BGM_TITLE[bx]
		call	_strlen
		add	sp, 4
		mov	bgm_title_len, ax

loc_11057:
		cmp	byte_22EF6, 10h
		jb	loc_1118F
		cmp	byte_22EF6, 16h
		jnz	loc_11107
		mov	al, stage_id
		add	al, 0A1h
		mov	gStage_1+6, al
		cmp	stage_id, 5
		jnz	short loc_11084
		push	(17 shl 16) + 11
		push	ds
		push	offset gFINAL_STAGE
		jmp	short loc_110A1
; ---------------------------------------------------------------------------

loc_11084:
		cmp	stage_id, 6
		jnz	short loc_11097
		push	(17 shl 16) + 11
		push	ds
		push	offset gEXTRA_STAGE
		jmp	short loc_110A1
; ---------------------------------------------------------------------------

loc_11097:
		push	(21 shl 16) + 11
		push	ds
		push	offset gStage_1

loc_110A1:
		push	TX_YELLOW
		call	gaiji_putsa
		mov	ax, stage_title_len
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	dx, 1Ch
		sub	dx, ax
		push	dx
		push	13
		mov	al, stage_title_id
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		pushd	STAGE_TITLE[bx]
		push	TX_WHITE
		call	text_putsa
		mov	ax, 30h	; '0'
		sub	ax, bgm_title_len
		call	gaiji_putca pascal, ax, (23 shl 16) + 3, TX_YELLOW
		mov	ax, 33h	; '3'
		sub	ax, bgm_title_len
		push	ax
		push	23
		mov	al, _bgm_title_id
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		pushd	BGM_TITLE[bx]
		push	TX_WHITE
		call	text_putsa

loc_11107:
		call	main_01:grcg_setmode_rmw_1
		mov	ah, GC_G
		call	main_01:grcg_setcolor_direct_noint_1
		cmp	stage_id, 5
		jnb	short loc_11120
		push	150A80h
		push	0Eh
		jmp	short loc_11128
; ---------------------------------------------------------------------------

loc_11120:
		push	110A80h
		push	16h

loc_11128:
		call	main_01:sub_10EA5
		mov	ax, 30h	; '0'
		sub	ax, bgm_title_len
		push	ax
		push	16800002h
		call	main_01:sub_10EA5
		mov	ah, 0Fh
		call	main_01:grcg_setcolor_direct_noint_1
		mov	ax, 33h	; '3'
		sub	ax, bgm_title_len
		push	ax
		push	1680h
		push	bgm_title_len
		call	main_01:sub_10EA5
		mov	ax, stage_title_len
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	dx, 1Ch
		sub	dx, ax
		push	dx
		push	0C80h
		push	stage_title_len
		call	main_01:sub_10EA5
		GRCG_OFF_CLOBBERING dx
		test	_popup_byte_unknown, 3
		jnz	short loc_1118F
		cmp	_popup_byte_unknown, 0
		jz	short loc_1118F
		inc	byte_22EF6
		cmp	byte_22EF6, 18h
		jb	short loc_1118F
		mov	byte_22EF6, 0

loc_1118F:
		inc	_popup_byte_unknown
		pop	bp
		retn
sub_10F36	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_11195	proc near
		push	bp
		mov	bp, sp
		cmp	byte_22EA3, 0C0h
		jb	short loc_11211
		cmp	byte_22EA3, 0C0h
		jnz	short loc_111B0
		call	main_01:sub_10D4B
		mov	byte_22EF6, 0
		jmp	short loc_111BB
; ---------------------------------------------------------------------------

loc_111B0:
		test	byte_22EA3, 1
		jnz	short loc_111BB
		inc	byte_22EF6

loc_111BB:
		cmp	byte_22EF6, 10h
		jb	short loc_111D8
		test	byte_22EA3, 1
		jz	loc_112D2
		mov	_overlay_text_fp, offset nullfunc_near
		mov	byte_22EA3, 0
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_111D8:
		call	main_01:grcg_setmode_rmw_1
		mov	ah, GC_G
		call	main_01:grcg_setcolor_direct_noint_1
		mov	ax, 30h	; '0'
		sub	ax, word_259C6
		push	ax
		push	16800002h
		call	main_01:sub_10EA5
		mov	ah, 0Fh
		call	main_01:grcg_setcolor_direct_noint_1
		mov	ax, 33h	; '3'
		sub	ax, word_259C6
		push	ax
		push	1680h
		push	word_259C6
		call	main_01:sub_10EA5
		GRCG_OFF_CLOBBERING dx
		jmp	loc_112D2
; ---------------------------------------------------------------------------

loc_11211:
		cmp	byte_22EA3, 0
		jnz	short loc_11237
		mov	byte_22EF6, 10h
		mov	al, _bgm_title_id
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		pushd	BGM_TITLE[bx]
		call	_strlen
		add	sp, 4
		mov	word_259C6, ax

loc_11237:
		cmp	byte_22EF6, 10h
		jb	loc_112D2
		cmp	byte_22EF6, 16h
		jnz	short loc_1127E
		mov	ax, 30h	; '0'
		sub	ax, word_259C6
		call	gaiji_putca pascal, ax, (23 shl 16) + 3, TX_YELLOW
		mov	ax, 33h	; '3'
		sub	ax, word_259C6
		push	ax
		push	23
		mov	al, _bgm_title_id
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		pushd	BGM_TITLE[bx]
		push	TX_WHITE
		call	text_putsa

loc_1127E:
		call	main_01:grcg_setmode_rmw_1
		mov	ah, GC_G
		call	main_01:grcg_setcolor_direct_noint_1
		mov	ax, 30h	; '0'
		sub	ax, word_259C6
		push	ax
		push	16800002h
		call	main_01:sub_10EA5
		mov	ah, 0Fh
		call	main_01:grcg_setcolor_direct_noint_1
		mov	ax, 33h	; '3'
		sub	ax, word_259C6
		push	ax
		push	1680h
		push	word_259C6
		call	main_01:sub_10EA5
		GRCG_OFF_CLOBBERING dx
		test	byte_22EA3, 3
		jnz	short loc_112D2
		cmp	byte_22EA3, 0
		jz	short loc_112D2
		inc	byte_22EF6
		cmp	byte_22EF6, 18h
		jb	short loc_112D2
		mov	byte_22EF6, 0

loc_112D2:
		inc	byte_22EA3
		pop	bp
		retn
sub_11195	endp

include th04/hud/popup.asm
include th04/formats/bb_txt_load.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

mugetsu_fg_render	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		cmp	_boss_sprite, 0
		jz	short loc_1163D
		mov	ax, _boss_pos.cur.x
		sar	ax, 4
		mov	si, ax
		mov	ax, _boss_pos.cur.y
		sar	ax, 4
		add	ax, -32
		mov	di, ax
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnb	short loc_11629
		cmp	_boss_damage_this_frame, 0
		jnz	short loc_115F5
		push	si
		push	ax
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		call	super_put
		call	main_01:sub_11647
		jmp	short loc_1163D
; ---------------------------------------------------------------------------

loc_115F5:
		inc	byte_259E6
		test	byte_259E6, 1
		jz	short loc_1160F
		push	si
		push	di
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		call	super_put
		jmp	short loc_11622
; ---------------------------------------------------------------------------

loc_1160F:
		push	si
		push	di
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		pushd	PLANE_PUT or GC_BRGI
		call	super_put_1plane

loc_11622:
		mov	_boss_damage_this_frame, 0
		jmp	short loc_1163D
; ---------------------------------------------------------------------------

loc_11629:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnz	short loc_1163D
		push	si
		push	di
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		call	super_large_put

loc_1163D:
		call	explosions_small_update_and_render
		call	explosions_big_update_and_render
		pop	di
		pop	si
		pop	bp
		retn
mugetsu_fg_render	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_11647	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		cmp	byte_259EF, 0
		jz	short loc_1168E
		cmp	byte_259EF, 20h	; ' '
		jnb	short loc_11661
		test	byte_259EF, 1
		jz	short loc_1168E

loc_11661:
		mov	ax, _boss_pos.cur.x
		sar	ax, 4
		add	ax, -15
		mov	si, ax
		mov	ax, _boss_pos.cur.y
		sar	ax, 4
		add	ax, -32
		mov	di, ax
		call	super_put pascal, si, ax, 136
		lea	ax, [si+48]
		call	super_put pascal, ax, di, 137

loc_1168E:
		pop	di
		pop	si
		pop	bp
		retn
sub_11647	endp
main_01_TEXT	ends

	HUD_SCORE_PUT procdesc near
	SCORE_UPDATE_AND_RENDER procdesc near

main_011_TEXT	segment	byte public 'CODE' use16
		assume cs:main_01

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kurumi_fg_render	proc near

var_A		= word ptr -0Ah
var_8		= word ptr -8
var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2

		enter	0Ah, 0
		push	si
		push	di
		cmp	_boss_phase, 2
		jnb	loc_1183C
		mov	ax, _boss_pos.cur.x
		sar	ax, 4
		mov	si, ax
		mov	ax, _boss_pos.cur.y
		sar	ax, 4
		add	ax, -16
		mov	di, ax
		mov	al, _boss_sprite
		mov	ah, 0
		mov	dl, _stage_frame_mod16
		mov	dh, 0
		mov	bx, 4
		push	ax
		mov	ax, dx
		cwd
		idiv	bx
		pop	dx
		add	dx, ax
		add	dx, 146
		mov	[bp+var_2], dx
		call	super_put pascal, si, di, dx
		cmp	_boss_phase, 0
		jnz	loc_11961
		cmp	_boss_phase_frame, 128
		jle	loc_11961
		mov	ax, 320
		sub	ax, _boss_phase_frame
		add	ax, ax
		mov	[bp+var_2], ax
		add	si, 20h	; ' '
		add	di, 18h
		call	main_01:grcg_setmode_rmw_1
		mov	ah, GC_I
		call	main_01:grcg_setcolor_direct_noint_1
		call	grcg_circle pascal, si, di, [bp+var_2]
		mov	ah, GC_BI
		call	main_01:grcg_setcolor_direct_noint_1
		push	si
		push	di
		mov	ax, [bp+var_2]
		add	ax, 6
		push	ax
		call	grcg_circle
		push	si
		push	di
		mov	ax, [bp+var_2]
		add	ax, 12
		push	ax
		call	grcg_circle
		GRCG_OFF_CLOBBERING dx
		jmp	loc_11961
; ---------------------------------------------------------------------------

loc_1183C:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnb	loc_1193A
		mov	ax, _boss_pos.cur.x
		sar	ax, 4
		mov	si, ax
		mov	ax, _boss_pos.cur.y
		sar	ax, 4
		add	ax, -16
		mov	di, ax
		mov	al, _boss_sprite
		mov	ah, 0
		add	ax, 146
		mov	[bp+var_2], ax
		cmp	_boss_sprite, 0
		jz	short loc_11871
		cmp	_boss_sprite, 12
		jnz	short loc_1187F

loc_11871:
		mov	al, _stage_frame_mod16
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		add	[bp+var_2], ax

loc_1187F:
		cmp	_boss_sprite, 4
		jz	short loc_1188D
		cmp	_boss_sprite, 6
		jnz	short loc_1189B

loc_1188D:
		mov	al, _stage_frame_mod8
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		add	[bp+var_2], ax

loc_1189B:
		cmp	_boss_damage_this_frame, 0
		jnz	short loc_118AE
		call	super_put pascal, si, di, [bp+var_2]
		jmp	short loc_118BE
; ---------------------------------------------------------------------------

loc_118AE:
		call	super_put_1plane pascal, si, di, [bp+var_2], large PLANE_PUT or GC_BRGI

loc_118BE:
		call	main_01:grcg_setmode_rmw_1
		mov	ah, GC_RG
		call	main_01:grcg_setcolor_direct_noint_1
		mov	[bp+var_A], 0B204h
		mov	[bp+var_4], 0
		jmp	short loc_11932
; ---------------------------------------------------------------------------

loc_118D2:
		mov	bx, [bp+var_A]
		cmp	byte ptr [bx], 0
		jz	short loc_1192B
		mov	bx, [bp+var_A]
		mov	ax, [bx+2]
		mov	bx, 10h
		cwd
		idiv	bx
		add	ax, 20h	; ' '
		mov	si, ax
		mov	bx, [bp+var_A]
		mov	ax, [bx+4]
		mov	bx, 10h
		cwd
		idiv	bx
		add	ax, 10h
		mov	di, ax
		mov	bx, [bp+var_A]
		mov	ax, [bx+6]
		mov	bx, 10h
		cwd
		idiv	bx
		add	ax, 20h	; ' '
		mov	[bp+var_6], ax
		mov	bx, [bp+var_A]
		mov	ax, [bx+8]
		mov	bx, 10h
		cwd
		idiv	bx
		add	ax, 10h
		mov	[bp+var_8], ax
		call	grcg_line pascal, si, di, [bp+var_6], ax

loc_1192B:
		inc	[bp+var_4]
		add	[bp+var_A], 1Ah

loc_11932:
		cmp	[bp+var_4], 6
		jl	short loc_118D2
		jmp	short loc_11961
; ---------------------------------------------------------------------------

loc_1193A:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnz	short loc_11961
		mov	ax, _boss_pos.cur.x
		sar	ax, 4
		mov	si, ax
		mov	ax, _boss_pos.cur.y
		sar	ax, 4
		add	ax, -16
		mov	di, ax
		push	si
		push	ax
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		call	super_large_put

loc_11961:
		call	explosions_small_update_and_render
		call	explosions_big_update_and_render
		pop	di
		pop	si
		leave
		retn
kurumi_fg_render	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

orange_fg_render	proc near

var_2		= word ptr -2

		enter	2, 0
		push	si
		push	di
		cmp	_boss_phase, 2
		jnb	loc_11A12
		mov	ax, _boss_pos.cur.x
		sar	ax, 4
		add	ax, 16
		mov	si, ax
		mov	ax, _boss_pos.cur.y
		sar	ax, 4
		add	ax, -8
		mov	di, ax
		mov	al, _boss_sprite
		mov	ah, 0
		mov	dl, _stage_frame_mod8
		mov	dh, 0
		mov	bx, 4
		push	ax
		mov	ax, dx
		cwd
		idiv	bx
		pop	dx
		add	dx, ax
		mov	[bp+var_2], dx
		call	super_put pascal, si, di, dx
		cmp	_boss_phase, 0
		jnz	loc_11A90
		cmp	_boss_phase_frame, 192
		jl	loc_11A90
		mov	ax, 352
		sub	ax, _boss_phase_frame
		add	ax, ax
		mov	[bp+var_2], ax
		add	si, 24
		add	di, 8
		call	main_01:grcg_setmode_rmw_1
		mov	ah, 0Fh
		call	main_01:grcg_setcolor_direct_noint_1
		call	grcg_circle pascal, si, di, [bp+var_2]
		mov	ah, GC_RG
		call	main_01:grcg_setcolor_direct_noint_1
		push	si
		push	di
		mov	ax, [bp+var_2]
		add	ax, 6
		push	ax
		call	grcg_circle
		push	si
		push	di
		mov	ax, [bp+var_2]
		add	ax, 12
		push	ax
		call	grcg_circle
		GRCG_OFF_CLOBBERING dx
		jmp	short loc_11A90
; ---------------------------------------------------------------------------

loc_11A12:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnb	short loc_11A69
		mov	ax, _boss_pos.cur.x
		sar	ax, 4
		mov	si, ax
		mov	ax, _boss_pos.cur.y
		sar	ax, 4
		add	ax, -24
		mov	di, ax
		mov	al, _boss_sprite
		mov	ah, 0
		mov	dl, _stage_frame_mod16
		mov	dh, 0
		mov	bx, 4
		push	ax
		mov	ax, dx
		cwd
		idiv	bx
		pop	dx
		add	dx, ax
		mov	[bp+var_2], dx
		cmp	_boss_damage_this_frame, 0
		jnz	short loc_11A57
		call	super_put pascal, si, di, dx
		jmp	short loc_11A90
; ---------------------------------------------------------------------------

loc_11A57:
		call	super_put_1plane pascal, si, di, [bp+var_2], large PLANE_PUT or GC_BRGI
		jmp	short loc_11A90
; ---------------------------------------------------------------------------

loc_11A69:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnz	short loc_11A90
		mov	ax, _boss_pos.cur.x
		sar	ax, 4
		mov	si, ax
		mov	ax, _boss_pos.cur.y
		sar	ax, 4
		add	ax, -16
		mov	di, ax
		push	si
		push	ax
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		call	super_large_put

loc_11A90:
		call	explosions_small_update_and_render
		call	explosions_big_update_and_render
		pop	di
		pop	si
		leave
		retn
orange_fg_render	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_11A9A	proc near

var_4		= word ptr -4
var_2		= word ptr -2

		enter	4, 0
		push	si
		push	di
		mov	ax, _midboss_phase_frame
		shl	ax, 4
		mov	[bp+var_4], ax
		cmp	[bp+var_4], 768
		jl	short loc_11ABD
		mov	[bp+var_4], 768
		mov	al, byte_23212
		inc	al
		mov	byte_23212, al

loc_11ABD:
		mov	[bp+var_2], 0
		jmp	short loc_11B3A
; ---------------------------------------------------------------------------

loc_11AC4:
		push	_midboss_pos.cur.x
		push	[bp+var_4]
		mov	al, byte_23212
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_CosTable8[bx]
		call	vector1_at
		mov	si, ax
		push	_midboss_pos.cur.y
		push	[bp+var_4]
		mov	al, byte_23212
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_SinTable8[bx]
		call	vector1_at
		mov	di, ax
		cmp	di, (-16 shl 4)
		jle	short loc_11B2F
		cmp	di, ((PLAYFIELD_H + 16) shl 4)
		jge	short loc_11B2F
		cmp	si, (-16 shl 4)
		jle	short loc_11B2F
		cmp	si, ((PLAYFIELD_W + 16) shl 4)
		jge	short loc_11B2F
		mov	ax, si
		sar	ax, 4
		add	ax,  (PLAYFIELD_X - 16)
		mov	si, ax
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, di
		mov	di, ax
		push	si
		push	ax
		mov	al, _midboss_sprite
		mov	ah, 0
		push	ax
		call	super_roll_put

loc_11B2F:
		inc	[bp+var_2]
		mov	al, byte_23212
		add	al, 10h
		mov	byte_23212, al

loc_11B3A:
		cmp	[bp+var_2], 10h
		jl	short loc_11AC4
		pop	di
		pop	si
		leave
		retn
sub_11A9A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_11B44	proc near

@@y		= word ptr -4
@@x		= word ptr -2

		enter	4, 0
		push	si
		push	di
		mov	si, 0B204h
		xor	di, di
		jmp	loc_11BD1
; ---------------------------------------------------------------------------

loc_11B52:
		cmp	byte ptr [si], 0
		jz	short loc_11BCD
		mov	ax, [si+2]
		sar	ax, 4
		add	ax, 10h
		mov	[bp+@@x], ax
		mov	ax, [si+4]
		sar	ax, 4
		mov	[bp+@@y], ax
		cmp	byte ptr [si], 1
		jnz	short loc_11BAD
		cmp	word ptr [si+16h], 0
		jnz	short loc_11B8E
		push	[bp+@@x]
		push	ax
		mov	ax, [si+0Eh]
		shr	ax, 1
		and	ax, 3
		add	ax, 186
		push	ax
		call	super_put
		jmp	short loc_11BCD
; ---------------------------------------------------------------------------

loc_11B8E:
		push	[bp+@@x]
		push	[bp+@@y]
		mov	ax, [si+0Eh]
		shr	ax, 1
		and	ax, 3
		add	ax, 186
		push	ax
		pushd	PLANE_PUT or GC_BRGI
		call	super_put_1plane
		jmp	short loc_11BCD
; ---------------------------------------------------------------------------

loc_11BAD:
		push	[bp+@@x]
		push	[bp+@@y]
		mov	al, [si]
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		push	ax
		call	super_put
		inc	byte ptr [si]
		cmp	byte ptr [si], 30h ; '0'
		jb	short loc_11BCD
		mov	byte ptr [si], 0

loc_11BCD:
		inc	di
		add	si, 1Ah

loc_11BD1:
		cmp	di, 1Fh
		jl	loc_11B52
		cmp	byte ptr [si], 0
		jz	short loc_11C16
		call	main_01:grcg_setmode_rmw_1
		mov	ah, GC_BGI
		call	main_01:grcg_setcolor_direct_noint_1
		call	grcg_circlefill pascal, word ptr [si+2], word ptr [si+4], word ptr [si+10h]
		cmp	byte ptr [si], 1
		jz	short loc_11C16
		mov	ah, [si+18h]
		call	main_01:grcg_setcolor_direct_noint_1
		push	word ptr [si+2]
		push	word ptr [si+4]
		mov	ax, [si+12h]
		add	ax, [si+10h]
		push	ax
		call	grcg_circle
		GRCG_OFF_CLOBBERING dx

loc_11C16:
		pop	di
		pop	si
		leave
		retn
sub_11B44	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

yuuka6_fg_render	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	ax, _boss_pos.cur.x
		sar	ax, 4
		add	ax, -16
		mov	si, ax
		mov	ax, _boss_pos.cur.y
		sar	ax, 4
		add	ax, -32
		mov	di, ax
		cmp	_boss_phase, PHASE_NONE
		jz	loc_11D92
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnz	short loc_11C57
		push	si
		push	di
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		push	3
		call	super_zoom
		jmp	loc_11D92
; ---------------------------------------------------------------------------

loc_11C57:
		cmp	byte_25A08, 0
		jz	short loc_11C7A
		lea	ax, [si+24]
		push	ax
		lea	ax, [di+24]
		push	ax
		mov	al, _stage_frame_mod16
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		add	ax, 182
		push	ax
		call	super_put

loc_11C7A:
		cmp	_boss_sprite, 0
		jz	loc_11D86
		cmp	_boss_damage_this_frame, 0
		jz	short loc_11C91
		test	byte_25A03, 1
		jz	short loc_11CB1

loc_11C91:
		push	si
		push	di
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		call	super_put
		lea	ax, [si+48]
		push	ax
		push	di
		mov	al, _boss_sprite
		mov	ah, 0
		inc	ax
		push	ax
		call	super_put
		jmp	short loc_11CDB
; ---------------------------------------------------------------------------

loc_11CB1:
		push	si
		push	di
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		pushd	PLANE_PUT or GC_R
		call	super_put_1plane
		lea	ax, [si+48]
		push	ax
		push	di
		mov	al, _boss_sprite
		mov	ah, 0
		inc	ax
		push	ax
		pushd	PLANE_PUT or GC_R
		call	super_put_1plane

loc_11CDB:
		cmp	_boss_damage_this_frame, 0
		jz	short loc_11CE7
		mov	ax, 1
		jmp	short loc_11CE9
; ---------------------------------------------------------------------------

loc_11CE7:
		xor	ax, ax

loc_11CE9:
		add	al, byte_25A03
		mov	byte_25A03, al
		mov	_boss_damage_this_frame, 0
		cmp	byte_25A1B, 2
		jnz	loc_11D86
		mov	ax, point_25A0C.x
		sar	ax, 4
		add	ax, (-1 shl 4)
		mov	si, ax
		mov	ax, point_25A0C.y
		sar	ax, 4
		add	ax, (-2 shl 4)
		mov	di, ax
		cmp	byte_25A1E, 0
		jz	short loc_11D22
		test	byte_25A04, 1
		jz	short loc_11D42

loc_11D22:
		push	si
		push	di
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		call	super_put
		lea	ax, [si+48]
		push	ax
		push	di
		mov	al, _boss_sprite
		mov	ah, 0
		inc	ax
		push	ax
		call	super_put
		jmp	short loc_11D6C
; ---------------------------------------------------------------------------

loc_11D42:
		push	si
		push	di
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		pushd	PLANE_PUT or GC_R
		call	super_put_1plane
		lea	ax, [si+48]
		push	ax
		push	di
		mov	al, _boss_sprite
		mov	ah, 0
		inc	ax
		push	ax
		pushd	PLANE_PUT or GC_R
		call	super_put_1plane

loc_11D6C:
		cmp	byte_25A1E, 0
		jz	short loc_11D78
		mov	ax, 1
		jmp	short loc_11D7A
; ---------------------------------------------------------------------------

loc_11D78:
		xor	ax, ax

loc_11D7A:
		add	al, byte_25A04
		mov	byte_25A04, al
		mov	byte_25A1E, 0

loc_11D86:
		call	explosions_small_update_and_render
		call	explosions_big_update_and_render
		call	main_01:sub_E2C3
		call	main_01:sub_11B44

loc_11D92:
		pop	di
		pop	si
		pop	bp
		retn
yuuka6_fg_render	endp

include th04/player/shots_add.asm
include th04/player/shot_velocity.asm

; =============== S U B	R O U T	I N E =======================================


sub_11DE6	proc far
		xor	bx, bx
		xor	ax, ax
		mov	al, _power
		mov	cx, 9

loc_11DF0:
		cmp	ax, SHOT_LEVELS[bx]
		jb	short loc_11DFB
		add	bx, 2
		loop	loc_11DF0

loc_11DFB:
		mov	dx, bx
		shr	dx, 1
		mov	_shot_level, dl
		add	bx, playchar_shot_funcs
		mov	ax, [bx]
		mov	playchar_shot_func, ax
		nopcall	main_01:hud_power_put
		retf
sub_11DE6	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

elly_fg_render	proc near

@@patnum	= word ptr -2

		enter	2, 0
		push	si
		push	di
		mov	ax, _boss_pos.cur.x
		sar	ax, 4
		mov	si, ax
		mov	ax, _boss_pos.cur.y
		sar	ax, 4
		add	ax, -16
		mov	di, ax
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnb	short loc_11E5D
		cmp	_boss_damage_this_frame, 0
		jnz	short loc_11E48
		push	si
		push	ax
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		call	super_put
		jmp	short loc_11E71
; ---------------------------------------------------------------------------

loc_11E48:
		push	si
		push	di
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		pushd	PLANE_PUT or GC_BRGI
		call	super_put_1plane
		jmp	short loc_11E71
; ---------------------------------------------------------------------------

loc_11E5D:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnz	short loc_11E71
		push	si
		push	di
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		call	super_large_put

loc_11E71:
		cmp	byte_25A27, 1
		jnz	short loc_11EC1
		cmp	motion_25A28.cur.x, 0
		jl	short loc_11EC1
		cmp	motion_25A28.cur.x, (384 shl 4)
		jge	short loc_11EC1
		cmp	motion_25A28.cur.y, 0
		jl	short loc_11EC1
		cmp	motion_25A28.cur.y, (368 shl 4)
		jge	short loc_11EC1
		mov	ax, motion_25A28.cur.x
		sar	ax, 4
		mov	si, ax
		mov	ax, motion_25A28.cur.y
		sar	ax, 4
		add	ax, -16
		mov	di, ax
		mov	al, _stage_frame_mod8
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	ax, 142
		mov	[bp+@@patnum], ax
		call	super_put pascal, si, di, ax

loc_11EC1:
		call	explosions_small_update_and_render
		call	explosions_big_update_and_render
		pop	di
		pop	si
		leave
		retn
elly_fg_render	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_11ECB	proc near
		push	bp
		mov	bp, sp
		mov	_frames_unused, 0
		mov	_stage_frame, 0
		mov	_stage_frame_mod2, 0
		mov	_stage_frame_mod4, 0
		mov	_stage_frame_mod8, 0
		mov	_stage_frame_mod16, 0
		mov	word_266D0, 1
		mov	byte_266D2, 0
		mov	_palette_changed, 0
		mov	_bullet_clear_trigger, 0
		mov	_stage_graze, 0
		mov	_circles_color, GC_R
		call	grc_setclip pascal, large (PLAYFIELD_X shl 16) or PLAYFIELD_Y, large ((PLAYFIELD_RIGHT - 1) shl 16) or (PLAYFIELD_BOTTOM - 1)
		push	offset _shots
		push	size _shots / 4
		call	main_01:sub_C34E
		push	8A92h
		push	200h
		call	main_01:sub_C34E
		push	offset _sparks
		push	size _sparks / 4
		call	main_01:sub_C34E
		push	offset _bullets
		push	(size _pellets + size _bullets16) / 4
		call	main_01:sub_C34E
		push	0B204h
		push	0D0h
		call	main_01:sub_C34E
		push	offset _circles
		push	size _circles / 4
		call	main_01:sub_C34E
		push	offset _items
		push	size _items / 4
		call	main_01:sub_C34E
		push	9634h
		push	640h
		call	main_01:sub_C34E
		push	9292h
		push	0A8h ; ''
		call	main_01:sub_C34E
		mov	word_2A8D0, 8
		mov	byte_2A8D2, 9
		mov	word_2A8CE, 400h
		mov	byte_2A8D3, 2
		mov	word ptr dword_2A8CA, 0
		mov	word ptr dword_2A8CA+2,	0
		pop	bp
		retn
sub_11ECB	endp

include th03/formats/cfg_lres.asm
		db    0

; =============== S U B	R O U T	I N E =======================================


sub_11FC8	proc near
		push	di
		mov	bx, dx
		sar	ax, 3
		shl	dx, 6
		add	ax, dx
		shr	dx, 2
		add	ax, dx
		mov	di, ax
		mov	ax, GRAM_400
		mov	es, ax
		assume es:nothing
		cmp	bx, 180h
		ja	short loc_11FEC
		mov	cx, 10h
		xor	bx, bx
		jmp	short loc_11FF6
; ---------------------------------------------------------------------------

loc_11FEC:
		mov	cx, 190h
		sub	cx, bx
		mov	bx, 10h
		sub	bx, cx

loc_11FF6:
		stosw
		add	di, ROW_SIZE - 2
		loop	loc_11FF6
		or	bx, bx
		jz	short loc_12008
		sub	di, 7D00h
		xchg	cx, bx
		jmp	short loc_11FF6
; ---------------------------------------------------------------------------

loc_12008:
		pop	di
		retn
sub_11FC8	endp


; =============== S U B	R O U T	I N E =======================================


playfield_fillm_0_40_384_274	proc near
		push	di
		GRCG_FILL_PLAYFIELD_ROWS	  0, 40
		GRCG_FILL_PLAYFIELD_ROWS	314, 54
		pop	di
		retn
playfield_fillm_0_40_384_274	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================


sub_12024	proc near
		cli
		GRCG_SETMODE_VIA_MOV al, GC_TDW
		mov	dx, 7Eh	; '~'
		mov	al, 0FFh
		out	dx, al
		xor	al, al
		out	dx, al
		out	dx, al
		out	dx, al
		sti
		push	di
		mov	ax, GRAM_400
		mov	es, ax
		assume es:nothing
		mov	ax, 1
		out	0A6h, ax
		xor	di, di
		mov	cx, (PLANE_SIZE / 4)
		rep stosd
		xor	ax, ax
		out	0A6h, ax
		mov	cx, (PLANE_SIZE / 4)
		xor	di, di
		rep stosd
		pop	di
		GRCG_OFF_VIA_XOR al
		retn
sub_12024	endp


; =============== S U B	R O U T	I N E =======================================


playfield_fill	proc near
		push	di
		GRCG_FILL_PLAYFIELD_ROWS	0, PLAYFIELD_H
		pop	di
		retn
playfield_fill	endp

include th04/hardware/grcg_fill_rows.asm

; =============== S U B	R O U T	I N E =======================================


sub_12076	proc near
		push	di
		cli
		mov	dx, 7Eh	; '~'
		xor	al, al
		out	dx, al
		out	dx, al
		out	dx, al
		out	dx, al
		sti
		mov	bx, word_23240

loc_12086:
		mov	dx, word_2323A
		mov	di, bx
		and	di, 0FFh
		add	di, word_2323C
		jmp	short loc_120AF
; ---------------------------------------------------------------------------

loc_12096:
		mov	dx, GRAM_400 + (PLAYFIELD_Y * ROW_SIZE) shr 4
		mov	di, bx
		and	di, 0FFh
		add	di, word_2323E
		jmp	short loc_120AF
; ---------------------------------------------------------------------------

loc_120A5:
		mov	di, bx
		and	di, 0FFh
		add	di, 9B0h

loc_120AF:
		mov	es, dx

loc_120B1:
		mov	cx, 6

loc_120B4:
		mov	es:[di], eax
		add	di, 8
		loop	loc_120B4
		sub	di, 80h
		jge	short loc_120B1
		xor	bl, 0Ch
		sub	dx, 0A0h
		cmp	dx, GRAM_400 + (PLAYFIELD_Y * ROW_SIZE) shr 4
		jg	short loc_120A5
		cmp	dx, 0A7B0h
		jnz	short loc_12096
		dec	bh
		jz	short loc_120F0
		cli
		mov	dx, 7Eh	; '~'
		mov	al, 0FFh
		out	dx, al
		xor	al, al
		out	dx, al
		out	dx, al
		out	dx, al
		sti
		mov	bl, byte ptr word_23240
		xor	bl, 0Ch
		jmp	short loc_12086
; ---------------------------------------------------------------------------

loc_120F0:
		sub	word_2323A, 14h
		add	word_2323C, 140h
		cmp	word_2323A, 0AEE0h
		jge	short loc_12114
		mov	word_2323A, 0AF6Ch
		mov	word_2323C, 140h
		xor	byte ptr word_23240, 0Ch

loc_12114:
		sub	word_2323E, 140h
		jns	short loc_12122
		mov	word_2323E, 9B0h

loc_12122:
		pop	di
		retn
sub_12076	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12124	proc near
		push	bp
		mov	bp, sp
		cmp	_midboss_phase, PHASE_EXPLODE_BIG
		jnb	short loc_12141
		mov	_tile_invalidate_box.x, 64
		mov	_tile_invalidate_box.y, 64
		pushd	[_midboss_pos.prev]
		jmp	short loc_12152
; ---------------------------------------------------------------------------

loc_12141:
		mov	_tile_invalidate_box.x, 128
		mov	_tile_invalidate_box.y, 128
		pushd	[_midboss_pos.cur]

loc_12152:
		call	main_01:tiles_invalidate_around
		pop	bp
		retn
sub_12124	endp

include th04/boss/backdrop.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

orange_bg_render	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase, 0
		jnz	short loc_12199
		cmp	_boss_phase_frame, 192
		jge	short loc_121E1
		cmp	_boss_phase_frame, 2
		jg	short loc_121E6
		jmp	short loc_121E1
; ---------------------------------------------------------------------------

loc_12199:
		cmp	_boss_phase, 1
		jnz	short loc_121BF
		call	main_01:boss_backdrop_render pascal, (32 shl 16) or 136, 1
		mov	ax, _bb_stage_seg
		mov	word_2CDCE, ax
		mov	ax, _boss_phase_frame
		sar	ax, 1
		push	ax
		call	main_01:sub_BF94
		call	main_01:tiles_redraw_invalidated
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_121BF:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnb	short loc_121D3
		call	main_01:boss_backdrop_render pascal, (32 shl 16) or 136, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_121D3:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jz	short loc_121E1
		cmp	_boss_phase_frame, 2
		jg	short loc_121E6

loc_121E1:
		call	main_01:tiles_render_all
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_121E6:
		call	main_01:sub_CB58
		pop	bp
		retn
orange_bg_render	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kurumi_bg_render	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase, 0
		jz	short loc_1223D
		cmp	_boss_phase, 1
		jnz	short loc_1221B
		call	main_01:boss_backdrop_render pascal, (32 shl 16) or 96, 0
		mov	ax, _bb_stage_seg
		mov	word_2CDCE, ax
		mov	ax, _boss_phase_frame
		sar	ax, 1
		push	ax
		call	main_01:sub_BF94
		call	main_01:tiles_redraw_invalidated
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1221B:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnb	short loc_1222F
		call	main_01:boss_backdrop_render pascal, (32 shl 16) or 96, 0
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1222F:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jz	short loc_1223D
		cmp	_boss_phase_frame, 2
		jg	short loc_12242

loc_1223D:
		call	main_01:tiles_render_all
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_12242:
		call	main_01:sub_CB58
		pop	bp
		retn
kurumi_bg_render	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12247	proc near
		push	bp
		mov	bp, sp
		mov	_tile_invalidate_box.x, 64
		mov	_tile_invalidate_box.y, 64
		call	main_01:tiles_invalidate_around pascal, large [_boss_pos.prev]
		cmp	byte_25A27, 0
		jz	short loc_1226D
		call	main_01:tiles_invalidate_around pascal, large [motion_25A28.prev]

loc_1226D:
		pop	bp
		retn
sub_12247	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

elly_bg_render	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase, 1
		ja	short loc_12285
		cmp	_boss_phase_frame, 2
		jle	short loc_122CD
		call	main_01:sub_12247
		jmp	short loc_122D2
; ---------------------------------------------------------------------------

loc_12285:
		cmp	_boss_phase, 2
		jnz	short loc_122AB
		call	main_01:boss_backdrop_render pascal, (32 shl 16) or 16, 0
		mov	ax, _bb_stage_seg
		mov	word_2CDCE, ax
		mov	ax, _boss_phase_frame
		sar	ax, 1
		push	ax
		call	main_01:sub_BF94
		call	main_01:tiles_redraw_invalidated
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_122AB:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnb	short loc_122BF
		call	main_01:boss_backdrop_render pascal, (32 shl 16) or 16, 0
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_122BF:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jz	short loc_122CD
		cmp	_boss_phase_frame, 2
		jg	short loc_122D2

loc_122CD:
		call	main_01:tiles_render_all
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_122D2:
		call	main_01:sub_CB58
		pop	bp
		retn
elly_bg_render	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

reimu_marisa_bg_render	proc near

var_1		= byte ptr -1

		enter	2, 0
		cmp	_boss_phase, 0
		jnz	short loc_122EB
		cmp	_boss_phase_frame, 2
		jg	short loc_1235F
		jmp	short loc_1235A
; ---------------------------------------------------------------------------

loc_122EB:
		cmp	_boss_phase, 1
		jnz	short loc_12338
		mov	ax, _boss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		mov	[bp+var_1], al
		cmp	[bp+var_1], 8
		jnb	short loc_12309
		call	main_01:tiles_render_all
		jmp	short loc_12327
; ---------------------------------------------------------------------------

loc_12309:
		call	main_01:grcg_setmode_tdw
		mov	ah, GC_RGI
		call	main_01:grcg_setcolor_direct_noint_1
		call	main_01:playfield_fillm_64_56_256_256
		GRCG_OFF_CLOBBERING dx
		push	(96 shl 16) or 72
		push	16
		call	cdg_put_noalpha

loc_12327:
		mov	ax, _bb_stage_seg
		mov	word_2CDCE, ax
		mov	al, [bp+var_1]
		mov	ah, 0
		push	ax
		call	main_01:sub_BF16
		leave
		retn
; ---------------------------------------------------------------------------

loc_12338:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnb	short loc_1234C
		call	main_01:boss_backdrop_render pascal, (96 shl 16) or 72, 1
		leave
		retn
; ---------------------------------------------------------------------------

loc_1234C:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jz	short loc_1235A
		cmp	_boss_phase_frame, 2
		jg	short loc_1235F

loc_1235A:
		call	main_01:tiles_render_all
		leave
		retn
; ---------------------------------------------------------------------------

loc_1235F:
		call	main_01:sub_CB58
		leave
		retn
reimu_marisa_bg_render	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

yuuka5_bg_render	proc near

var_1		= byte ptr -1

		enter	2, 0
		cmp	_boss_phase, 0
		jnz	short loc_12378
		cmp	_boss_phase_frame, 2
		jg	short loc_123EC
		jmp	short loc_123E7
; ---------------------------------------------------------------------------

loc_12378:
		cmp	_boss_phase, 1
		jnz	short loc_123C5
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		mov	[bp+var_1], al
		cmp	[bp+var_1], 8
		jnb	short loc_12396
		call	main_01:tiles_render_all
		jmp	short loc_123B4
; ---------------------------------------------------------------------------

loc_12396:
		call	main_01:grcg_setmode_tdw
		mov	ah, GC_BRGI
		call	main_01:grcg_setcolor_direct_noint_1
		call	main_01:playfield_fillm_96_112_288_256
		GRCG_OFF_CLOBBERING dx
		push	(128 shl 16) or 128
		push	16
		call	cdg_put_noalpha

loc_123B4:
		mov	ax, _bb_stage_seg
		mov	word_2CDCE, ax
		mov	al, [bp+var_1]
		mov	ah, 0
		push	ax
		call	main_01:sub_BF16
		leave
		retn
; ---------------------------------------------------------------------------

loc_123C5:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnb	short loc_123D9
		call	main_01:boss_backdrop_render pascal, (128 shl 16) or 128, 0
		leave
		retn
; ---------------------------------------------------------------------------

loc_123D9:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jz	short loc_123E7
		cmp	_boss_phase_frame, 2
		jg	short loc_123EC

loc_123E7:
		call	main_01:tiles_render_all
		leave
		retn
; ---------------------------------------------------------------------------

loc_123EC:
		call	main_01:sub_CB58
		leave
		retn
yuuka5_bg_render	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_123F1	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+4]
		inc	byte ptr [si+5]
		cmp	word ptr [si], 0FF80h
		jle	short loc_12413
		cmp	word ptr [si], 1880h
		jge	short loc_12413
		cmp	word ptr [si+2], 0FF80h
		jle	short loc_12413
		cmp	word ptr [si+2], 1800h
		jl	short loc_12422

loc_12413:
		mov	word ptr [si], 0C00h
		mov	word ptr [si+2], 0B80h
		mov	al, byte ptr word_2CF2A
		mov	[si+5],	al

loc_12422:
		pop	si
		pop	bp
		retn	2
sub_123F1	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12427	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+4]
		cmp	word ptr [si], 0FF80h
		jg	short loc_12439
		add	word ptr [si], 1900h
		jmp	short loc_12443
; ---------------------------------------------------------------------------

loc_12439:
		cmp	word ptr [si], 1880h
		jl	short loc_12443
		sub	word ptr [si], 1900h

loc_12443:
		cmp	word ptr [si+2], 0FF80h
		jg	short loc_12450
		add	word ptr [si+2], 1880h
		jmp	short loc_1245C
; ---------------------------------------------------------------------------

loc_12450:
		cmp	word ptr [si+2], 1800h
		jl	short loc_1245C
		sub	word ptr [si+2], 1880h

loc_1245C:
		pop	si
		pop	bp
		retn	2
sub_12427	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12461	proc near

var_9		= byte ptr -9
var_8		= word ptr -8
var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2

		enter	0Ah, 0
		push	si
		push	di
		cmp	byte_2CDD1, 0
		jnz	short loc_12492
		mov	si, 0BA92h
		mov	al, byte_2CDD0
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 0Ch
		ja	short loc_12492
		add	bx, bx
		jmp	word ptr cs:table_1289F[bx]

loc_12484:
		mov	fp_2CF2C, offset sub_12427
		jmp	short loc_12492
; ---------------------------------------------------------------------------

loc_1248C:
		mov	fp_2CF2C, offset sub_123F1

loc_12492:
		call	main_01:grcg_setmode_rmw_1
		cmp	byte_2CDD1, 80h
		jnb	short loc_124A1
		mov	al, byte_2CDD1
		jmp	short loc_124A7
; ---------------------------------------------------------------------------

loc_124A1:
		mov	al, 0FFh
		sub	al, byte_2CDD1

loc_124A7:
		mov	[bp+var_9], al
		cmp	byte_2CDD0, 10h
		jnb	short loc_124D7
		mov	ah, GC_BRG
		call	main_01:grcg_setcolor_direct_noint_1
		test	byte_2CDD0, 1
		jz	short loc_124C5
		mov	al, [bp+var_9]
		mov	Palettes, al
		jmp	short loc_124D2
; ---------------------------------------------------------------------------

loc_124C5:
		mov	al, [bp+var_9]
		mov	ah, 0
		imul	ax, 3
		cwd
		sub	ax, dx
		sar	ax, 1

loc_124D2:
		mov	Palettes+2, al
		jmp	short loc_12508
; ---------------------------------------------------------------------------

loc_124D7:
		mov	ah, GC_RG
		call	main_01:grcg_setcolor_direct_noint_1
		cmp	byte_23242, 0
		jnz	short loc_12508
		mov	Palettes, 0
		mov	Palettes+1, 0
		mov	al, [bp+var_9]
		mov	ah, 0
		imul	ax, 3
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	Palettes+2, al
		cmp	[bp+var_9], 7Fh
		jb	short loc_12508
		mov	byte_23242, 1

loc_12508:
		mov	_palette_changed, 1
		mov	al, byte_2CDD0
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 10h
		ja	loc_127EC
		add	bx, bx
		jmp	word ptr cs:table_1287D[bx]

loc_12522:
		cmp	_boss_phase, 2
		jbe	short loc_12567
		inc	byte_2CDD1
		cmp	byte_2CDD1, 0FEh
		jb	loc_127EC
		mov	word_2CF28, 78h	; 'x'
		mov	byte_2CDD0, 4
		mov	si, 0BA92h
		xor	di, di
		jmp	short loc_12554
; ---------------------------------------------------------------------------

loc_12548:
		mov	byte ptr [si+4], 40h
		mov	byte ptr [si+5], 40h
		inc	di
		add	si, 6

loc_12554:
		cmp	di, 38h	; '8'
		jl	short loc_12548
		mov	byte_2CDD1, 0FFh
		mov	word_2CF2A, 40h
		jmp	loc_127EC
; ---------------------------------------------------------------------------

loc_12567:
		cmp	byte_2CDD1, 0FFh
		jnz	loc_127EC
		inc	word_2CF28
		inc	byte_2CDD0
		cmp	byte_2CDD0, 4
		jb	short loc_1258A
		mov	byte_2CDD0, 0
		mov	word_2CF28, 78h	; 'x'

loc_1258A:
		mov	si, 0BA92h
		xor	di, di
		jmp	short loc_1259D
; ---------------------------------------------------------------------------

loc_12591:
		mov	al, 80h
		sub	al, [si+4]
		mov	[si+4],	al
		inc	di
		add	si, 6

loc_1259D:
		cmp	di, 38h	; '8'
		jl	short loc_12591
		jmp	loc_127EC
; ---------------------------------------------------------------------------

loc_125A5:
		cmp	_boss_phase, 4
		jbe	short loc_125F6
		inc	byte_2CDD1
		cmp	byte_2CDD1, 0FEh
		jb	loc_127EC
		mov	word_2CF28, 78h	; 'x'
		mov	byte_2CDD0, 6
		mov	si, 0BA92h
		xor	di, di
		jmp	short loc_125E8
; ---------------------------------------------------------------------------

loc_125CB:
		mov	ax, [si+2]
		add	ax, 0F400h
		push	ax
		mov	ax, [si]
		add	ax, 0F380h
		push	ax
		call	iatan2
		mov	[si+4],	al
		mov	byte ptr [si+5], 10h
		inc	di
		add	si, 6

loc_125E8:
		cmp	di, 38h	; '8'
		jl	short loc_125CB
		mov	word_2CF2A, 10h
		jmp	loc_12705
; ---------------------------------------------------------------------------

loc_125F6:
		cmp	byte_2CDD1, 0FFh
		jnz	loc_127EC
		cmp	byte_2CDD0, 4
		jnz	loc_127AB
		jmp	loc_127B1
; ---------------------------------------------------------------------------

loc_1260B:
		cmp	_boss_phase, 7
		jz	short loc_12627
		cmp	_boss_phase, 8
		jz	short loc_12627
		cmp	_boss_phase, 0Bh
		jz	short loc_12627
		cmp	_boss_phase, 0Ch
		jnz	short loc_1267C

loc_12627:
		inc	byte_2CDD1
		cmp	byte_2CDD1, 0FEh
		jb	loc_127EC
		mov	word_2CF28, 78h	; 'x'
		cmp	byte_2CDD0, 0Ah
		jnb	short loc_12645
		mov	al, 8
		jmp	short loc_12647
; ---------------------------------------------------------------------------

loc_12645:
		mov	al, 0Ch

loc_12647:
		mov	byte_2CDD0, al
		mov	si, 0BA92h
		xor	di, di
		jmp	short loc_12674
; ---------------------------------------------------------------------------

loc_12651:
		push	1800h
		call	main_01:randring1_next16_mod
		mov	[si], ax
		push	1700h
		call	main_01:randring1_next16_mod
		mov	[si+2],	ax
		push	0Fh
		call	main_01:randring1_next16_and
		add	al, 0B8h
		mov	[si+4],	al
		mov	byte ptr [si+5], 48h ; 'H'
		inc	di
		add	si, 6

loc_12674:
		cmp	di, 38h	; '8'
		jl	short loc_12651
		jmp	loc_126FF
; ---------------------------------------------------------------------------

loc_1267C:
		cmp	byte_2CDD1, 0FFh
		jnz	loc_127EC
		test	byte_2CDD0, 1
		jz	loc_127B1
		jmp	loc_127AB
; ---------------------------------------------------------------------------

loc_12691:
		cmp	_boss_phase, 9
		jz	short loc_126A6
		cmp	_boss_phase, 0Ah
		jz	short loc_126A6
		cmp	_boss_phase, 0Dh
		jb	short loc_1270D

loc_126A6:
		inc	byte_2CDD1
		cmp	byte_2CDD1, 0FEh
		jb	loc_127EC
		mov	word_2CF28, 78h	; 'x'
		cmp	byte_2CDD0, 0Ch
		jnb	short loc_126C4
		mov	al, 0Ah
		jmp	short loc_126C6
; ---------------------------------------------------------------------------

loc_126C4:
		mov	al, 0Eh

loc_126C6:
		mov	byte_2CDD0, al
		mov	si, 0BA92h
		xor	di, di
		jmp	short loc_126FA
; ---------------------------------------------------------------------------

loc_126D0:
		mov	ax, [si+2]
		add	ax, 0F400h
		push	ax
		mov	ax, [si]
		add	ax, 0F380h
		push	ax
		call	iatan2
		mov	[si+4],	al
		cmp	byte_2CDD0, 0Eh
		jz	short loc_126F2
		mov	byte ptr [si+5], 10h
		jmp	short loc_126F6
; ---------------------------------------------------------------------------

loc_126F2:
		mov	byte ptr [si+5], 40h

loc_126F6:
		inc	di
		add	si, 6

loc_126FA:
		cmp	di, 38h	; '8'
		jl	short loc_126D0

loc_126FF:
		mov	word_2CF2A, 40h

loc_12705:
		mov	byte_2CDD1, 0FFh
		jmp	loc_127EC
; ---------------------------------------------------------------------------

loc_1270D:
		cmp	byte_2CDD1, 0FFh
		jnz	loc_127EC
		test	byte_2CDD0, 1
		jz	loc_127B1
		jmp	loc_127AB
; ---------------------------------------------------------------------------

loc_12722:
		mov	si, 0BA92h
		cmp	byte_2CDD0, 0Eh
		jnz	short loc_12730
		mov	al, 2
		jmp	short loc_12732
; ---------------------------------------------------------------------------

loc_12730:
		mov	al, 0FEh

loc_12732:
		mov	[bp+var_9], al
		xor	di, di
		jmp	short loc_12743
; ---------------------------------------------------------------------------

loc_12739:
		mov	al, [bp+var_9]
		add	[si+4],	al
		inc	di
		add	si, 6

loc_12743:
		cmp	di, 38h	; '8'
		jl	short loc_12739
		cmp	_boss_phase, 0Fh
		jb	short loc_1279D
		inc	byte_2CDD1
		cmp	byte_2CDD1, 0FEh
		jb	loc_127EC
		mov	word_2CF28, 7Ch	; '|'
		mov	byte_2CDD0, 10h
		mov	byte_2CDD1, 0FFh
		mov	si, 0BA92h
		xor	di, di
		jmp	short loc_12790
; ---------------------------------------------------------------------------

loc_12773:
		push	1800h
		call	main_01:randring1_next16_mod
		mov	[si], ax
		push	1700h
		call	main_01:randring1_next16_mod
		mov	[si+2],	ax
		mov	byte ptr [si+4], 40h
		mov	byte ptr [si+5], 0C0h
		inc	di
		add	si, 6

loc_12790:
		cmp	di, 38h	; '8'
		jl	short loc_12773
		mov	word_2CF2A, 0C0h
		jmp	short loc_127EC
; ---------------------------------------------------------------------------

loc_1279D:
		cmp	byte_2CDD1, 0FFh
		jnz	short loc_127EC
		test	byte_2CDD0, 1
		jz	short loc_127B1

loc_127AB:
		dec	byte_2CDD0
		jmp	short loc_127EC
; ---------------------------------------------------------------------------

loc_127B1:
		inc	byte_2CDD0
		jmp	short loc_127EC
; ---------------------------------------------------------------------------

loc_127B7:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jb	short loc_127EC
		mov	word_2CF28, 7Dh	; '}'
		mov	byte_2CDD0, 11h
		mov	byte_2CDD1, 0FFh
		mov	si, 0BA92h
		xor	di, di
		jmp	short loc_127E1
; ---------------------------------------------------------------------------

loc_127D5:
		mov	byte ptr [si+4], 40h
		mov	byte ptr [si+5], 10h
		inc	di
		add	si, 6

loc_127E1:
		cmp	di, 38h	; '8'
		jl	short loc_127D5
		mov	word_2CF2A, 10h

loc_127EC:
		inc	byte_2CDD1
		mov	si, 0BA92h
		xor	di, di
		jmp	short loc_12823
; ---------------------------------------------------------------------------

loc_127F7:
		push	ss
		lea	ax, [bp+var_6]
		push	ax
		push	ss
		lea	ax, [bp+var_8]
		push	ax
		push	word ptr [si+4]
		mov	al, [si+5]
		mov	ah, 0
		push	ax
		call	vector2
		mov	ax, [bp+var_6]
		add	[si], ax
		mov	ax, [bp+var_8]
		add	[si+2],	ax
		push	si
		call	fp_2CF2C
		inc	di
		add	si, 6

loc_12823:
		cmp	di, 38h	; '8'
		jl	short loc_127F7
		mov	ax, GRAM_400
		mov	es, ax
		assume es:nothing
		mov	si, 0BA92h
		xor	di, di
		jmp	short loc_1286D
; ---------------------------------------------------------------------------

loc_12834:
		mov	ax, word_2CF28
		mov	[bp+var_4], ax
		cmp	byte_2CDD0, 11h
		jb	short loc_1284C
		mov	ax, di
		mov	bx, 3
		cwd
		idiv	bx
		add	[bp+var_4], dx

loc_1284C:
		mov	ax, [si]
		sar	ax, 4
		add	ax, 18h
		mov	[bp+var_2], ax
		mov	ax, [si+2]
		sar	ax, 4
		add	ax, 8
		mov	cx, [bp+var_2]
		push	[bp+var_4]
		call	main_01:sub_C01A
		inc	di
		add	si, 6

loc_1286D:
		cmp	di, 38h	; '8'
		jl	short loc_12834
		GRCG_OFF_CLOBBERING dx
		pop	di
		pop	si
		leave
		retn
sub_12461	endp

; ---------------------------------------------------------------------------
		db 0
table_1287D	dw loc_12522
		dw loc_12522
		dw loc_12522
		dw loc_12522
		dw loc_125A5
		dw loc_125A5
		dw loc_1260B
		dw loc_1260B
		dw loc_12691
		dw loc_12691
		dw loc_1260B
		dw loc_1260B
		dw loc_12691
		dw loc_12691
		dw loc_12722
		dw loc_12722
		dw loc_127B7
table_1289F	dw loc_12484
		dw loc_12492
		dw loc_12492
		dw loc_12492
		dw loc_12492
		dw loc_12492
		dw loc_1248C
		dw loc_12492
		dw loc_12484
		dw loc_12492
		dw loc_1248C
		dw loc_12492
		dw loc_12484

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

yuuka6_bg_render	proc near

var_1		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		call	main_01:grcg_setmode_tdw
		cmp	_boss_phase, 0
		jnz	short loc_12921
		mov	ah, GC_RGI
		call	main_01:grcg_setcolor_direct_noint_1
		call	main_01:playfield_fill
		GRCG_OFF_CLOBBERING dx
		cmp	_boss_phase_frame, 2
		jnz	loc_12975
		mov	si, 0BA92h
		xor	di, di
		jmp	short loc_12904
; ---------------------------------------------------------------------------

loc_128E7:
		push	1800h
		call	main_01:randring1_next16_mod
		mov	[si], ax
		push	1700h
		call	main_01:randring1_next16_mod
		mov	[si+2],	ax
		mov	byte ptr [si+4], 60h
		mov	byte ptr [si+5], 10h
		inc	di
		add	si, 6

loc_12904:
		cmp	di, 38h	; '8'
		jl	short loc_128E7
		mov	word_2CF2A, 10h
		mov	word_2CF28, 78h	; 'x'
		mov	byte_2CDD0, 0
		mov	byte_2CDD1, 0
		jmp	short loc_12975
; ---------------------------------------------------------------------------

loc_12921:
		cmp	_boss_phase, 1
		jnz	short loc_12958
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		mov	[bp+var_1], al
		mov	ah, GC_RGI
		call	main_01:grcg_setcolor_direct_noint_1
		cmp	[bp+var_1], 8
		jnb	short loc_12944
		call	main_01:playfield_fill
		jmp	short loc_12947
; ---------------------------------------------------------------------------

loc_12944:
		call	main_01:sub_12076

loc_12947:
		mov	ax, _bb_stage_seg
		mov	word_2CDCE, ax
		mov	al, [bp+var_1]
		mov	ah, 0
		push	ax
		call	main_01:sub_BF16
		jmp	short loc_12975
; ---------------------------------------------------------------------------

loc_12958:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnb	short loc_12964
		call	main_01:sub_12076
		jmp	short loc_12972
; ---------------------------------------------------------------------------

loc_12964:
		mov	ah, GC_RGI
		call	main_01:grcg_setcolor_direct_noint_1
		call	main_01:playfield_fill
		GRCG_OFF_CLOBBERING dx

loc_12972:
		call	main_01:sub_12461

loc_12975:
		pop	di
		pop	si
		leave
		retn
yuuka6_bg_render	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

mugetsu_gengetsu_bg_render	proc near

var_1		= byte ptr -1

		enter	2, 0
		cmp	_boss_phase, 0
		jnz	short loc_12996
		cmp	_boss_phase_frame, 2
		jg	short loc_12A05
		mov	_stage_render, offset nullfunc_near

loc_12991:
		call	main_01:tiles_render_all
		leave
		retn
; ---------------------------------------------------------------------------

loc_12996:
		cmp	_boss_phase, 1
		jnz	short loc_129E3
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		mov	[bp+var_1], al
		cmp	[bp+var_1], 8
		jnb	short loc_129B4
		call	main_01:tiles_render_all
		jmp	short loc_129D2
; ---------------------------------------------------------------------------

loc_129B4:
		call	main_01:grcg_setmode_tdw
		mov	ah, GC_RGI
		call	main_01:grcg_setcolor_direct_noint_1
		call	main_01:playfield_fillm_0_0_384_192
		GRCG_OFF_CLOBBERING dx
		push	(32 shl 16) or 16
		push	16
		call	cdg_put_noalpha

loc_129D2:
		mov	ax, _bb_stage_seg
		mov	word_2CDCE, ax
		mov	al, [bp+var_1]
		mov	ah, 0
		push	ax
		call	main_01:sub_BF16
		leave
		retn
; ---------------------------------------------------------------------------

loc_129E3:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnb	short loc_129F7
		call	main_01:boss_backdrop_render pascal, (32 shl 16) or 16, 1
		leave
		retn
; ---------------------------------------------------------------------------

loc_129F7:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jz	short loc_12991
		cmp	_boss_phase_frame, 2
		jle	short loc_12991

loc_12A05:
		call	main_01:sub_CB58
		leave
		retn
mugetsu_gengetsu_bg_render	endp

include th04/formats/scoredat_recreate.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12AB7	proc near
		push	bp
		mov	bp, sp
		push	ds
		push	offset aGensou_scr_0 ; "GENSOU.SCR"
		call	file_exist
		or	ax, ax
		jz	short loc_12B19
		push	ds
		push	offset aGensou_scr_1 ; "GENSOU.SCR"
		call	file_ropen
		mov	al, _rank
		mov	ah, 0
		imul	ax, size scoredat_section_t
		movzx	eax, ax
		call	file_seek pascal, large eax, 0
		les	bx, _resident
		assume es:nothing
		cmp	es:[bx+resident_t.playchar_ascii], '0' + PLAYCHAR_MARISA
		jnz	short loc_12AFE
		call	file_seek pascal, large RANK_COUNT * size scoredat_section_t, 1

loc_12AFE:
		call	file_read pascal, ds, offset _hi, size scoredat_section_t
		call	file_close
		call	main_01:scoredat_decode pascal, offset _hi
		or	al, al
		jz	short loc_12B1C

loc_12B19:
		call	main_01:scoredat_recreate

loc_12B1C:
		pop	bp
		retn
sub_12AB7	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12B1E	proc near
		push	bp
		mov	bp, sp
		call	main_01:scoredat_encode pascal, offset _hi
		push	ds
		push	offset aGensou_scr_2 ; "GENSOU.SCR"
		call	file_append
		mov	al, _rank
		mov	ah, 0
		imul	ax, size scoredat_section_t
		movzx	eax, ax
		call	file_seek pascal, large eax, 0
		les	bx, _resident
		cmp	es:[bx+resident_t.playchar_ascii], '0' + PLAYCHAR_MARISA
		jnz	short loc_12B5E
		call	file_seek pascal, large RANK_COUNT * size scoredat_section_t, 1

loc_12B5E:
		call	file_write pascal, ds, offset _hi, size scoredat_section_t
		call	file_close
		pop	bp
		retn
sub_12B1E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12B71	proc near

var_A		= byte ptr -0Ah
var_2		= word ptr -2

		enter	0Ah, 0
		push	si
		lea	ax, [bp+var_A]
		push	ss
		push	ax
		push	ds
		push	offset gCONTINUE
		mov	cx, 8
		call	SCOPY@
		mov	[bp+var_2], 9
		jmp	short loc_12BCF
; ---------------------------------------------------------------------------

loc_12B8E:
		mov	si, SCORE_DIGITS - 1
		jmp	short loc_12BC8
; ---------------------------------------------------------------------------

loc_12B93:
		mov	al, _score_lebcd[si]
		mov	ah, 0
		mov	bx, [bp+var_2]
		shl	bx, 3
		mov	dl, _hi.score.g_points[bx+si]
		mov	dh, 0
		add	dx, -gb_0_
		cmp	ax, dx
		jg	short loc_12BCC
		mov	al, _score_lebcd[si]
		mov	ah, 0
		mov	bx, [bp+var_2]
		shl	bx, 3
		mov	dl, _hi.score.g_points[bx+si]
		mov	dh, 0
		add	dx, -gb_0_
		cmp	ax, dx
		jl	short loc_12BDC
		dec	si

loc_12BC8:
		or	si, si
		jge	short loc_12B93

loc_12BCC:
		dec	[bp+var_2]

loc_12BCF:
		cmp	[bp+var_2], 0
		jge	short loc_12B8E
		mov	byte_2CFF2, 0
		jmp	short loc_12BF2
; ---------------------------------------------------------------------------

loc_12BDC:
		cmp	[bp+var_2], 9
		jnz	short loc_12BEA
		mov	byte_2CFF2, 0FFh
		jmp	loc_12CB2
; ---------------------------------------------------------------------------

loc_12BEA:
		mov	al, byte ptr [bp+var_2]
		inc	al
		mov	byte_2CFF2, al

loc_12BF2:
		mov	[bp+var_2], 8
		jmp	short loc_12C43
; ---------------------------------------------------------------------------

loc_12BF9:
		mov	si, 7
		jmp	short loc_12C13
; ---------------------------------------------------------------------------

loc_12BFE:
		mov	bx, [bp+var_2]
		imul	bx, (SCOREDAT_NAME_LEN + 1)
		mov	al, _hi.score.g_name[0 * (SCOREDAT_NAME_LEN + 1)][bx+si]
		mov	bx, [bp+var_2]
		imul	bx, (SCOREDAT_NAME_LEN + 1)
		mov	_hi.score.g_name[1 * (SCOREDAT_NAME_LEN + 1)][bx+si], al
		dec	si

loc_12C13:
		or	si, si
		jge	short loc_12BFE
		mov	si, 7
		jmp	short loc_12C31
; ---------------------------------------------------------------------------

loc_12C1C:
		mov	bx, [bp+var_2]
		shl	bx, 3
		mov	al, _hi.score.g_points[0 * SCORE_DIGITS][bx+si]
		mov	bx, [bp+var_2]
		shl	bx, 3
		mov	_hi.score.g_points[1 * SCORE_DIGITS][bx+si], al
		dec	si

loc_12C31:
		or	si, si
		jge	short loc_12C1C
		mov	bx, [bp+var_2]
		mov	al, _hi.score.g_stage[0][bx]
		mov	_hi.score.g_stage[1][bx], al
		dec	[bp+var_2]

loc_12C43:
		mov	al, byte_2CFF2
		mov	ah, 0
		cmp	ax, [bp+var_2]
		jle	short loc_12BF9
		mov	si, 7
		jmp	short loc_12C65
; ---------------------------------------------------------------------------

loc_12C52:
		mov	al, [bp+si+var_A]
		mov	dl, byte_2CFF2
		mov	dh, 0
		imul	dx, (SCOREDAT_NAME_LEN + 1)
		mov	bx, dx
		mov	_hi.score.g_name[bx+si], al
		dec	si

loc_12C65:
		or	si, si
		jge	short loc_12C52
		mov	si, 7
		jmp	short loc_12C84
; ---------------------------------------------------------------------------

loc_12C6E:
		mov	al, _score_lebcd[si]
		add	al, gb_0_
		mov	dl, byte_2CFF2
		mov	dh, 0
		shl	dx, 3
		mov	bx, dx
		mov	_hi.score.g_points[bx+si], al
		dec	si

loc_12C84:
		or	si, si
		jge	short loc_12C6E
		cmp	stage_id, 6
		jz	short loc_12CA3
		mov	al, byte_2CFF2
		mov	ah, 0
		mov	dl, stage_id
		add	dl, gb_1_
		mov	bx, ax
		mov	_hi.score.g_stage[bx], dl
		jmp	short loc_12CAF
; ---------------------------------------------------------------------------

loc_12CA3:
		mov	al, byte_2CFF2
		mov	ah, 0
		mov	bx, ax
		mov	_hi.score.g_stage[bx], gb_1_

loc_12CAF:
		call	main_01:sub_12B1E

loc_12CB2:
		pop	si
		leave
		retn
sub_12B71	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12CB5	proc near
		push	bp
		mov	bp, sp
		call	main_01:sub_12AB7
		cmp	_turbo_mode, 0
		jz	short loc_12CC5
		call	main_01:sub_12B71

loc_12CC5:
		pop	bp
		retn
sub_12CB5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12CC7	proc near
		push	bp
		mov	bp, sp
		push	si
		call	main_01:sub_12AB7
		xor	si, si
		jmp	short loc_12CDD
; ---------------------------------------------------------------------------

loc_12CD2:
		mov	al, _hi.score.g_points[si]
		add	al, -gb_0_
		mov	_hiscore_lebcd[si], al
		inc	si

loc_12CDD:
		cmp	si, SCORE_DIGITS
		jl	short loc_12CD2
		pop	si
		pop	bp
		retn
sub_12CC7	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public BULLETS_RENDER
bullets_render	proc near

@@patnum		= word ptr -2

		push	bp
		mov	bp, sp
		sub	sp, 2
		push	si
		push	di
		mov	ax, GRAM_400
		mov	es, ax
		assume es:nothing
		mov	si, offset _bullets[(BULLET_COUNT - 1) * size bullet_t]
		xor	di, di
		jmp	@@bullets16_more?
; ---------------------------------------------------------------------------

@@sprite_bullet_loop:
		cmp	[si+bullet_t.flag], 1
		jnz	@@sprite_bullet_next
		cmp	[si+bullet_t.spawn_state], BSS_CLOUD_BACKWARDS
		ja	short loc_12D24
		mov	ax, [si+bullet_t.pos.cur.y]
		add	ax, ((PLAYFIELD_Y - (BULLET16_H / 2)) shl 4)
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, ax
		mov	dx, ax
		mov	ax, [si+bullet_t.pos.cur.x]
		sar	ax, 4
		add	ax, (PLAYFIELD_X - (BULLET16_W / 2))
		call	main_01:z_super_roll_put_tiny_16x16_raw pascal, [si+bullet_t.BULLET_patnum]
		jmp	short @@sprite_bullet_next
; ---------------------------------------------------------------------------

loc_12D24:
		cmp	[si+bullet_t.pos.cur.y], 0
		jl	short @@sprite_bullet_next
		cmp	[si+bullet_t.pos.cur.y], (PLAYFIELD_H shl 4)
		jge	short @@sprite_bullet_next
		cmp	[si+bullet_t.pos.cur.x], 0
		jl	short @@sprite_bullet_next
		cmp	[si+bullet_t.pos.cur.x], (PLAYFIELD_W shl 4)
		jge	short @@sprite_bullet_next
		mov	ax, [si+bullet_t.BULLET_patnum]
		cmp	ax, PAT_BULLET16_N_OUTLINED_BALL_GREEN
		jz	short loc_12D50
		cmp	ax, PAT_BULLET16_N_OUTLINED_BALL_BLUE
		jz	short loc_12D50
		cmp	ax, PAT_BULLET16_N_BALL_BLUE
		jnz	short loc_12D57

loc_12D50:
		mov	[bp+@@patnum], (PAT_CLOUD_BULLET16_BLUE - 1)
		jmp	short loc_12D5C
; ---------------------------------------------------------------------------

loc_12D57:
		mov	[bp+@@patnum], (PAT_CLOUD_BULLET16_RED - 1)

loc_12D5C:
		cmp	[si+bullet_t.BULLET_patnum], PAT_BULLET16_D_BLUE
		jl	short loc_12D6D
		cmp	[si+bullet_t.BULLET_patnum], PAT_BULLET16_D_YELLOW
		jge	short loc_12D6D
		mov	[bp+@@patnum], (PAT_CLOUD_BULLET16_BLUE - 1)

loc_12D6D:
		mov	al, [si+bullet_t.spawn_state]
		mov	ah, 0
		mov	bx, (BSS_CLOUD_FRAMES / BULLET_CLOUD_CELS)
		cwd
		idiv	bx
		add	[bp+@@patnum], ax
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, [si+bullet_t.pos.cur.y]
		mov	dx, ax
		mov	ax, [si+bullet_t.pos.cur.x]
		sar	ax, 4
		add	ax, 16
		call	main_01:z_super_roll_put_tiny_32x32_raw pascal, [bp+@@patnum]

@@sprite_bullet_next:
		inc	di
		sub	si, size bullet_t

@@bullets16_more?:
		cmp	di, BULLET16_COUNT
		jl	@@sprite_bullet_loop
		cmp	_bullet_clear_trigger, 0
		jnz	short loc_12DBE
		cmp	_bullet_clear_time, 0
		jnz	short loc_12DBE
		mov	ah, 0Fh
		call	main_01:grcg_setcolor_direct_noint_1
		call	main_01:sub_C99C
		mov	ah, GC_RG
		call	main_01:grcg_setcolor_direct_noint_1
		call	main_01:sub_CA2E
		jmp	short @@ret
; ---------------------------------------------------------------------------

loc_12DBE:
		xor	di, di
		jmp	short @@pellets_more?
; ---------------------------------------------------------------------------

@@dot_bullet_loop:
		cmp	[si+bullet_t.flag], 1
		jnz	short @@dot_bullet_next
		mov	ax, [si+bullet_t.pos.cur.y]
		add	ax, ((PLAYFIELD_Y - (BULLET16_H / 2)) shl 4)
		call	main_01:scroll_subpixel_y_to_vram_seg1 pascal, ax
		mov	dx, ax
		mov	ax, [si+bullet_t.pos.cur.x]
		sar	ax, 4
		add	ax, (PLAYFIELD_X - (BULLET16_W / 2))
		call	main_01:z_super_roll_put_tiny_16x16_raw pascal, [si+bullet_t.BULLET_patnum]

@@dot_bullet_next:
		inc	di
		sub	si, size bullet_t

@@pellets_more?:
		cmp	di, PELLET_COUNT
		jl	short @@dot_bullet_loop

@@ret:
		pop	di
		pop	si
		leave
		retn
bullets_render	endp

include th04/item/render.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12E37	proc near

@@patnum		= word ptr -6
@@y		= word ptr -4
@@x		= word ptr -2

		enter	6, 0
		push	si
		push	di
		mov	si, 0B204h
		xor	di, di
		jmp	short loc_12E8A
; ---------------------------------------------------------------------------

loc_12E44:
		cmp	byte ptr [si], 0
		jz	short loc_12E86
		cmp	word ptr [si+4], 0FF00h
		jle	short loc_12E86
		mov	ax, [si+2]
		sar	ax, 4
		add	ax, 16
		mov	[bp+@@x], ax
		mov	ax, [si+4]
		sar	ax, 4
		mov	[bp+@@y], ax
		mov	al, byte_2D03B
		mov	ah, 0
		mov	dx, _stage_frame
		add	dx, di
		and	dx, 7
		shr	dx, 1
		add	ax, dx
		mov	[bp+@@patnum], ax
		call	super_roll_put pascal, [bp+@@x], [bp+@@y], ax

loc_12E86:
		inc	di
		add	si, 1Ah

loc_12E8A:
		cmp	di, 20h	; ' '
		jl	short loc_12E44
		pop	di
		pop	si
		leave
		retn
sub_12E37	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

reimu_fg_render	proc near

@@patnum	= word ptr -2

		enter	2, 0
		push	si
		push	di
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnb	loc_12F2E
		cmp	byte_2D03C, 0
		jz	short loc_12ECF
		mov	ax, _boss_pos.prev.x
		sar	ax, 4
		mov	si, ax
		mov	ax, _boss_pos.prev.y
		sar	ax, 4
		add	ax, -16
		mov	di, ax
		push	si
		push	ax
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		pushd	PLANE_PUT or GC_BI
		call	super_put_1plane

loc_12ECF:
		mov	ax, _boss_pos.cur.x
		sar	ax, 4
		mov	si, ax
		mov	ax, _boss_pos.cur.y
		sar	ax, 4
		add	ax, -16
		mov	di, ax
		cmp	_boss_sprite, 136
		jnz	short loc_12EF9
		mov	al, _stage_frame_mod16
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		add	ax, 136
		jmp	short loc_12EFE
; ---------------------------------------------------------------------------

loc_12EF9:
		mov	al, _boss_sprite
		mov	ah, 0

loc_12EFE:
		mov	[bp+@@patnum], ax
		cmp	_boss_damage_this_frame, 0
		jnz	short loc_12F14
		call	super_put pascal, si, di, [bp+@@patnum]
		jmp	short loc_12F29
; ---------------------------------------------------------------------------

loc_12F14:
		call	super_put_1plane pascal, si, di, [bp+@@patnum], large PLANE_PUT or GC_BRGI
		mov	_boss_damage_this_frame, 0

loc_12F29:
		call	main_01:sub_12E37
		jmp	short loc_12F55
; ---------------------------------------------------------------------------

loc_12F2E:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnz	short loc_12F55
		mov	ax, _boss_pos.cur.x
		sar	ax, 4
		mov	si, ax
		mov	ax, _boss_pos.cur.y
		sar	ax, 4
		add	ax, -16
		mov	di, ax
		push	si
		push	ax
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		call	super_large_put

loc_12F55:
		call	explosions_small_update_and_render
		call	explosions_big_update_and_render
		pop	di
		pop	si
		leave
		retn
reimu_fg_render	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

gengetsu_fg_render	proc near

var_2		= word ptr -2

		enter	2, 0
		push	si
		push	di
		cmp	_boss_sprite, 0
		jz	loc_13083
		mov	ax, _boss_pos.cur.x
		sar	ax, 4
		add	ax, -16
		mov	di, ax
		mov	ax, _boss_pos.cur.y
		sar	ax, 4
		add	ax, -32
		mov	si, ax
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnb	loc_1306D
		cmp	amp_237F8, 0
		jz	short loc_12FE7
		push	di
		push	ax
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		mov	al, amp_237F8
		mov	ah, 0
		mov	dx, 80
		sub	dx, ax
		push	dx
		push	word ptr amp_237F8
		mov	al, _boss_angle
		mov	ah, 0
		push	ax
		call	super_wave_put
		lea	ax, [di+48]
		push	ax
		push	si
		mov	al, _boss_sprite
		mov	ah, 0
		inc	ax
		push	ax
		mov	al, amp_237F8
		mov	ah, 0
		mov	dx, 80
		sub	dx, ax
		push	dx
		push	word ptr amp_237F8
		mov	al, _boss_angle
		mov	ah, 0
		push	ax
		call	super_wave_put
		mov	al, _boss_angle
		add	al, 4
		mov	_boss_angle, al
		jmp	loc_13083
; ---------------------------------------------------------------------------

loc_12FE7:
		cmp	_boss_damage_this_frame, 0
		jnz	short loc_13011
		push	di
		push	si
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		call	super_put
		lea	ax, [di+48]
		push	ax
		push	si
		mov	al, _boss_sprite
		mov	ah, 0
		inc	ax
		push	ax
		call	super_put
		call	main_01:sub_11647
		jmp	short loc_13083
; ---------------------------------------------------------------------------

loc_13011:
		inc	byte_2D058
		test	byte_2D058, 1
		jz	short loc_1303C
		push	di
		push	si
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		call	super_put
		lea	ax, [di+48]
		push	ax
		push	si
		mov	al, _boss_sprite
		mov	ah, 0
		inc	ax
		push	ax
		call	super_put
		jmp	short loc_13066
; ---------------------------------------------------------------------------

loc_1303C:
		push	di
		push	si
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		pushd	PLANE_PUT or GC_BRGI
		call	super_put_1plane
		lea	ax, [di+48]
		push	ax
		push	si
		mov	al, _boss_sprite
		mov	ah, 0
		inc	ax
		push	ax
		pushd	PLANE_PUT or GC_BRGI
		call	super_put_1plane

loc_13066:
		mov	_boss_damage_this_frame, 0
		jmp	short loc_13083
; ---------------------------------------------------------------------------

loc_1306D:
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnz	short loc_13083
		push	di
		push	si
		mov	al, _boss_sprite
		mov	ah, 0
		push	ax
		push	3
		call	super_zoom

loc_13083:
		call	explosions_small_update_and_render
		call	explosions_big_update_and_render
		call	main_01:sub_E2C3
		cmp	_boss_phase, 5
		jnz	short loc_130E9
		cmp	_boss_mode, 1
		jnz	short loc_130E9
		cmp	_boss_phase_frame, 32
		jl	short loc_130E9
		cmp	_boss_phase_frame, 96
		jge	short loc_130E9
		call	main_01:grcg_setmode_rmw_1
		cmp	_stage_frame_mod2, 0
		jz	short loc_130B6
		mov	ah, GC_RG
		jmp	short loc_130B8
; ---------------------------------------------------------------------------

loc_130B6:
		mov	ah, 0Fh

loc_130B8:
		call	main_01:grcg_setcolor_direct_noint_1
		mov	[bp+var_2], 0B204h
		xor	si, si
		jmp	short loc_130E4
; ---------------------------------------------------------------------------

loc_130C4:
		mov	bx, [bp+var_2]
		mov	ax, [bx+2]
		mov	bx, 16
		cwd
		idiv	bx
		add	ax, 32
		mov	di, ax
		call	grcg_vline pascal, ax, bx, PLAYFIELD_BOTTOM - 1
		inc	si
		add	[bp+var_2], 1Ah

loc_130E4:
		cmp	si, 10h
		jl	short loc_130C4

loc_130E9:
		pop	di
		pop	si
		leave
		retn
gengetsu_fg_render	endp

main_011_TEXT	ends

; ===========================================================================

; Segment type:	Pure code
main_02_TEXT	segment	word public 'CODE' use16
		assume cs:main_02_TEXT
		;org 0Dh
		assume es:nothing, ss:nothing, ds:_DATA, fs:nothing, gs:nothing

include th01/hardware/vram_planes_set.asm
include th03/math/vector2.asm
		nop
include th03/math/vector2_between_plus.asm
include th02/hardware/frame_delay.asm
include th03/formats/hfliplut.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public MPTN_FREE
mptn_free	proc far

arg_0		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		mov	ax, [bp+arg_0]
		shl	ax, 6
		add	ax, 345Ah
		mov	si, ax
		cmp	dword ptr [si],	0
		jz	short loc_1320E
		push	word ptr [si+2]
		call	hmem_free
		mov	dword ptr [si],	0

loc_1320E:
		pop	si
		pop	bp
		retf	2
mptn_free	endp

include th04/hardware/input_wait.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public MPTN_PALETTE_SHOW
mptn_palette_show	proc far

arg_0		= word ptr  6

		push	bp
		mov	bp, sp
		push	30h ; '0'       ; n
		push	ds
		mov	ax, [bp+arg_0]
		shl	ax, 6
		add	ax, 3460h
		push	ax		; src
		push	ds
		push	offset Palettes ; dest
		call	_memcpy
		add	sp, 0Ah
		call	far ptr	palette_show
		pop	bp
		retf	2
mptn_palette_show	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public MPTN_LOAD_INNER
mptn_load_inner	proc far

var_8		= word ptr -8
var_6		= byte ptr -6
var_2		= byte ptr -2
arg_0		= dword	ptr  6
arg_4		= word ptr  0Ah

		enter	8, 0
		push	si
		push	di
		mov	di, [bp+arg_4]
		pushd	[bp+arg_0]
		call	file_ropen
		mov	ax, di
		shl	ax, 6
		add	ax, 345Ah
		mov	si, ax
		push	ss
		lea	ax, [bp+var_6]
		push	ax
		push	6
		call	file_read
		mov	al, [bp+var_2]
		mov	ah, 0
		mov	[si+4],	ax
		mov	ax, [si+4]
		inc	ax
		shl	ax, 5
		shl	ax, 2
		mov	[bp+var_8], ax
		push	ds
		lea	ax, [si+6]
		push	ax
		push	30h ; '0'
		call	file_read
		cmp	byte_21AF2, 0
		jz	short loc_132E3
		push	di
		call	mptn_palette_show

loc_132E3:
		push	di
		nopcall	mptn_free
		push	[bp+var_8]
		call	hmem_allocbyte
		mov	[si+2],	ax
		mov	word ptr [si], 0
		cmp	dword ptr [si],	0
		jnz	short loc_13308
		call	file_close
		mov	ax, 0FFFFh
		jmp	short loc_1331A
; ---------------------------------------------------------------------------

loc_13308:
		pushd	dword ptr [si]
		push	[bp+var_8]
		call	file_read
		call	file_close
		xor	ax, ax

loc_1331A:
		pop	di
		pop	si
		leave
		retf	6
mptn_load_inner	endp

include th04/math/vector1_at.asm
include th04/math/vector2_at.asm
include th04/snd/pmd_res.asm
include th02/snd/mmd_res.asm
include th04/snd/kajaint.asm
include th04/snd/detmodes.asm
include th04/snd/load.asm
include th04/formats/cdg_put.asm
include th02/exit.asm
include th02/initmain.asm
		db    0

include th04/formats/cdg_put_noalpha.asm
include th04/formats/cdg_put_plane_roll.asm
include th04/hardware/input_sense.asm
include th04/snd/se.asm
include th04/formats/cdg_load.asm
main_02_TEXT	ends

; ===========================================================================

; Segment type:	Pure code
main_03_TEXT	segment	byte public 'CODE' use16
		assume cs:main_03_TEXT
		;org 0Ch
		assume es:nothing, ss:nothing, ds:_DATA, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13A9C	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		push	di
		push	ds
		pop	es
		assume es:_DATA
		mov	si, offset _bullet_template
		mov	di, [bp+arg_0]
		add	di, 14h
		mov	cx, size _bullet_template / 2
		rep movsw
		pop	di
		pop	si
		pop	bp
		retn	2
sub_13A9C	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13AB7	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	si, 9292h
		xor	di, di
		jmp	short loc_13B18
; ---------------------------------------------------------------------------

loc_13AC3:
		cmp	byte ptr [si], 0
		jnz	short loc_13B14
		mov	byte ptr [si], 1
		push	si
		call	sub_13A9C
		mov	ax, point_2A8C6.x
		mov	[si+2],	ax
		mov	ax, point_2A8C6.y
		mov	[si+4],	ax
		mov	ax, word_2A8CE
		mov	[si+0Eh], ax
		mov	[si+26h], ax
		mov	ax, word ptr dword_2A8CA
		mov	[si+0Ah], ax
		mov	ax, word ptr dword_2A8CA+2
		mov	[si+0Ch], ax
		mov	byte ptr [si+12h], 0
		mov	al, byte_2A8D3
		mov	[si+13h], al
		mov	al, byte_2A8D2
		mov	[si+1],	al
		mov	ax, word_2A8D0
		mov	[si+10h], ax
		mov	ax, word_2A8CE
		mov	bx, 20h	; ' '
		cwd
		idiv	bx
		mov	[si+28h], ax
		jmp	short loc_13B1D
; ---------------------------------------------------------------------------

loc_13B14:
		inc	di
		add	si, 2Ah	; '*'

loc_13B18:
		cmp	di, 10h
		jl	short loc_13AC3

loc_13B1D:
		pop	di
		pop	si
		pop	bp
		retn
sub_13AB7	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13B21	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	si, 9292h
		xor	cx, cx
		jmp	short loc_13B81
; ---------------------------------------------------------------------------

loc_13B2C:
		cmp	byte ptr [si], 0
		jnz	short loc_13B7D
		mov	byte ptr [si], 1
		mov	byte ptr [si+14h], 0
		mov	ax, point_2A8C6.x
		mov	[si+2],	ax
		mov	ax, point_2A8C6.y
		mov	[si+4],	ax
		mov	ax, word_2A8CE
		mov	[si+0Eh], ax
		mov	[si+26h], ax
		mov	ax, word ptr dword_2A8CA
		mov	[si+0Ah], ax
		mov	ax, word ptr dword_2A8CA+2
		mov	[si+0Ch], ax
		mov	byte ptr [si+12h], 0
		mov	al, byte_2A8D3
		mov	[si+13h], al
		mov	al, byte_2A8D2
		mov	[si+1],	al
		mov	ax, word_2A8D0
		mov	[si+10h], ax
		mov	ax, word_2A8CE
		mov	bx, 20h	; ' '
		cwd
		idiv	bx
		mov	[si+28h], ax
		jmp	short loc_13B86
; ---------------------------------------------------------------------------

loc_13B7D:
		inc	cx
		add	si, 2Ah	; '*'

loc_13B81:
		cmp	cx, 10h
		jl	short loc_13B2C

loc_13B86:
		pop	si
		pop	bp
		retn
sub_13B21	endp

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13B89	proc near

arg_0		= byte ptr  4
arg_2		= byte ptr  6
arg_4		= word ptr  8

		push	bp
		mov	bp, sp
		mov	ax, [bp+arg_4]
		or	ax, ax
		jz	short loc_13BA1
		cmp	ax, 2
		jz	short loc_13BA6
		cmp	ax, 4
		jz	short loc_13BAC
		pop	bp
		retn	6
; ---------------------------------------------------------------------------

loc_13BA1:
		mov	al, [bp+arg_2]
		jmp	short loc_13BA9
; ---------------------------------------------------------------------------

loc_13BA6:
		mov	al, [bp+arg_0]

loc_13BA9:
		mov	byte_2A8D2, al

loc_13BAC:
		call	sub_13B21
		pop	bp
		retn	6
sub_13B89	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13BB3	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		push	di
		push	ds
		pop	es
		mov	di, offset _bullet_template
		mov	si, [bp+arg_0]
		add	si, 14h
		mov	cx, size _bullet_template / 2
		rep movsw
		pop	di
		pop	si
		pop	bp
		retn	2
sub_13BB3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13BCE	proc far
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	si, 9292h
		xor	di, di
		jmp	short loc_13C29
; ---------------------------------------------------------------------------

loc_13BDA:
		cmp	byte ptr [si], 0
		jz	short loc_13C25
		cmp	byte ptr [si], 2
		jb	short loc_13BE9
		mov	byte ptr [si], 0
		jmp	short loc_13C25
; ---------------------------------------------------------------------------

loc_13BE9:
		lea	ax, [si+2]
		push	ax
		call	_motion_update_2
		mov	ax, [si+0Eh]
		mov	[si+26h], ax
		mov	ax, [si+28h]
		sub	[si+0Eh], ax
		mov	al, [si+13h]
		add	[si+12h], al
		cmp	word ptr [si+0Eh], 20h ; ' '
		jge	short loc_13C25
		mov	byte ptr [si], 2
		cmp	byte ptr [si+14h], 0
		jz	short loc_13C25
		push	si
		call	sub_13BB3
		mov	ax, [si+2]
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, [si+4]
		mov	_bullet_template.BT_origin.y, ax
		call	fp_2D000

loc_13C25:
		inc	di
		add	si, 2Ah	; '*'

loc_13C29:
		cmp	di, 10h
		jl	short loc_13BDA
		pop	di
		pop	si
		pop	bp
		retf
sub_13BCE	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13C32	proc near
		push	bp
		mov	bp, sp
		cmp	_drawpoint.x, (-4 shl 4)
		jle	short loc_13C58
		cmp	_drawpoint.x, (388 shl 4)
		jge	short loc_13C58
		cmp	_drawpoint.y, (-4 shl 4)
		jle	short loc_13C58
		cmp	_drawpoint.y, (372 shl 4)
		jge	short loc_13C58
		mov	ax, 1
		jmp	short loc_13C5A
; ---------------------------------------------------------------------------

loc_13C58:
		xor	ax, ax

loc_13C5A:
		pop	bp
		retn
sub_13C32	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13C5C	proc far

var_4		= byte ptr -4
var_3		= byte ptr -3
var_2		= word ptr -2

		enter	4, 0
		push	si
		push	di
		mov	ax, GRAM_400
		mov	es, ax
		assume es:nothing
		mov	[bp+var_4], 0FFh
		mov	si, 9292h
		mov	[bp+var_2], 0
		jmp	short loc_13CDD
; ---------------------------------------------------------------------------

loc_13C75:
		cmp	byte ptr [si], 1
		jnz	short loc_13CD7
		mov	al, [si+1]
		cmp	al, [bp+var_4]
		jz	short loc_13C8B
		mov	[bp+var_4], al
		mov	ah, [bp+var_4]
		call	grcg_setcolor_direct_noint_2

loc_13C8B:
		xor	di, di
		jmp	short loc_13CD2
; ---------------------------------------------------------------------------

loc_13C8F:
		mov	ax, di
		shl	ax, 8
		cwd
		idiv	word ptr [si+10h]
		add	al, [si+12h]
		mov	[bp+var_3], al
		push	offset _drawpoint
		push	word ptr [si+2]
		push	word ptr [si+4]
		push	word ptr [si+0Eh]
		mov	ah, 0
		push	ax
		call	vector2_at
		call	sub_13C32
		or	al, al
		jz	short loc_13CD1
		mov	ax, _drawpoint.y
		add	ax, (12 shl 4)
		call	scroll_subpixel_y_to_vram_seg3 pascal, ax
		mov	dx, ax
		mov	ax, _drawpoint.x
		sar	ax, 4
		add	ax, 28
		call	sub_14A98

loc_13CD1:
		inc	di

loc_13CD2:
		cmp	[si+10h], di
		jg	short loc_13C8F

loc_13CD7:
		inc	[bp+var_2]
		add	si, 2Ah	; '*'

loc_13CDD:
		cmp	[bp+var_2], 10h
		jl	short loc_13C75
		pop	di
		pop	si
		leave
		retf
sub_13C5C	endp

; ---------------------------------------------------------------------------
		db    0

include th04/scroll_y_3.asm
MOTION_UPDATE_DEF 2
RANDRING_NEXT_DEF 2
		db    0

; =============== S U B	R O U T	I N E =======================================


sub_13D90	proc near
		mov	bl, byte_2520F
		inc	byte_2520F
		cmp	bl, 0C7h
		jb	short loc_13DA2
		mov	byte_2520F, 0

loc_13DA2:
		xor	bh, bh
		add	bx, 0C8h
		jmp	short loc_13DBE
sub_13D90	endp


; =============== S U B	R O U T	I N E =======================================


sub_13DAA	proc near
		mov	bl, byte_2520E
		mov	bh, 0
		inc	byte_2520E
		cmp	bl, 0C7h
		jb	short loc_13DBE
		mov	byte_2520E, 0

loc_13DBE:
		shl	bx, 4
		add	bx, 9634h
		mov	word ptr [bx], 1
		push	bp
		mov	bp, sp
		mov	ax, [bp+8]
		mov	[bx+2],	ax
		mov	ax, [bp+6]
		mov	[bx+4],	ax
		mov	word ptr [bx+0Ch], 0
		mov	al, byte_21CC8
		mov	[bx+0Eh], al
		lea	ax, [bx+0Bh]
		push	ax
		push	word ptr [bp+4]
		call	sub_189EE
		pop	bp
		retn	6
sub_13DAA	endp

; ---------------------------------------------------------------------------
		nop
include th04/math/vector2_near.asm
		nop
include th04/sparks_add.asm
GRCG_SETCOLOR_DIRECT_NOINT_DEF 2
GRCG_SETMODE_RMW_DEF 2
include th04/item/splashes_update.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13FB2	proc near
		push	bp
		mov	bp, sp
		push	si
		cmp	_midboss_pos.cur.y, (256 shl 4)
		jge	short loc_14014
		mov	si, _midboss_phase_frame
		cmp	si, 1
		jnz	short loc_13FCC
		mov	byte_25594, 1

loc_13FCC:
		mov	ax, si
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_14014
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE
		mov	al, byte_25594
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.speed, (2 shl 4)
		mov	_bullet_template.pattern, BP_SINGLE
		mov	_bullet_template.BT_special_motion, 0FFh
		call	fp_2D004
		call	fp_2D002
		mov	al, 80h
		sub	al, byte_25594
		mov	_bullet_template.BT_angle, al
		call	fp_2D002
		mov	al, byte_25594
		add	al, 0Ch
		mov	byte_25594, al

loc_14014:
		pop	si
		pop	bp
		retn
sub_13FB2	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

midboss1_update	proc far
		push	bp
		mov	bp, sp
		push	si
		cmp	_midboss_phase, 0
		jnz	loc_1411F
		mov	_midboss_pos.velocity.y, (-1 shl 4)
		push	offset _midboss_pos
		call	_motion_update_2
		mov	ax, _midboss_pos.cur.x
		add	ax, (-16 shl 4)
		push	ax
		mov	ax, _midboss_pos.cur.y
		add	ax, (-16 shl 4)
		push	ax
		push	4B4Ah
		call	sub_B682
		push	_midboss_pos.cur.x
		mov	ax, _midboss_pos.cur.y
		add	ax, (-16 shl 4)
		push	ax
		push	504Ah
		call	sub_B682
		mov	ax, _midboss_pos.cur.x
		add	ax, (-16 shl 4)
		push	ax
		push	_midboss_pos.cur.y
		push	1E4Ch
		call	sub_B682
		push	_midboss_pos.cur.x
		push	_midboss_pos.cur.y
		push	234Ch
		call	sub_B682
		inc	_midboss_phase_frame
		cmp	_midboss_phase_frame, 288
		jl	loc_142E4
		mov	_midboss_phase, 1
		mov	_midboss_phase_frame, 0
		mov	_midboss_pos.velocity.y, 2
		mov	ax, _midboss_pos.cur.x
		add	ax, (-16 shl 4)
		push	ax
		mov	ax, _midboss_pos.cur.y
		add	ax, (-16 shl 4)
		push	ax
		push	554Ah
		call	sub_B682
		push	_midboss_pos.cur.x
		mov	ax, _midboss_pos.cur.y
		add	ax, (-16 shl 4)
		push	ax
		push	5A4Ah
		call	sub_B682
		mov	ax, _midboss_pos.cur.x
		add	ax, (-16 shl 4)
		push	ax
		push	_midboss_pos.cur.y
		push	284Ch
		call	sub_B682
		push	_midboss_pos.cur.x
		push	_midboss_pos.cur.y
		push	2D4Ch
		call	sub_B682
		mov	_midboss_sprite, 136
		sub	_midboss_pos.cur.y, (4 shl 4)
		mov	al, _scroll_subpixel_line
		mov	ah, 0
		add	_midboss_pos.cur.y, ax
		call	scroll_subpixel_y_to_vram_seg3 pascal, _midboss_pos.cur.y
		mov	word_25596, ax
		call	sparks_add_circle pascal, _midboss_pos.cur.x, _midboss_pos.cur.y, large (((3 shl 4) shl 16) or 32)
		push	9

loc_14117:
		call	snd_se_play
		jmp	loc_142E4
; ---------------------------------------------------------------------------

loc_1411F:
		cmp	_midboss_phase, 1
		jnz	loc_141BF
		push	offset _midboss_pos
		call	_motion_update_2
		mov	ax, _midboss_pos.cur.x
		mov	_homing_target.x, ax
		mov	ax, _midboss_pos.cur.y
		mov	_homing_target.y, ax
		inc	_midboss_phase_frame
		cmp	_midboss_sprite, 139
		jnb	short loc_14158
		mov	ax, _midboss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1419A
		inc	_midboss_sprite
		jmp	short loc_1419A
; ---------------------------------------------------------------------------

loc_14158:
		cmp	_midboss_phase_frame, 96
		jl	short loc_1419A
		mov	_midboss_phase, 2
		mov	_midboss_phase_frame, 0
		mov	_midboss_sprite, 140
		sub	_midboss_pos.cur.y, (16 shl 4)
		mov	ax, _midboss_pos.cur.y
		add	ax, (-16 shl 4)
		call	scroll_subpixel_y_to_vram_seg3 pascal, ax
		mov	word_25596, ax
		call	sparks_add_circle pascal, _midboss_pos.cur.x, _midboss_pos.cur.y, large (((3 shl 4) shl 16) or 32)
		call	snd_se_play pascal, 9

loc_1419A:
		mov	word_257E2, 100h
		mov	word_257E4, 0C0h
		mov	ax, _midboss_pos.cur.x
		mov	word ptr dword_257DE, ax
		mov	ax, _midboss_pos.cur.y
		mov	word ptr dword_257DE+2,	ax
		call	sub_105B9
		or	ax, ax
		jz	loc_142E4
		jmp	short loc_14228
; ---------------------------------------------------------------------------

loc_141BF:
		cmp	_midboss_phase, 2
		jnz	short loc_1422D
		push	offset _midboss_pos
		call	_motion_update_2
		mov	ax, _midboss_pos.cur.x
		mov	_homing_target.x, ax
		mov	ax, _midboss_pos.cur.y
		mov	_homing_target.y, ax
		inc	_midboss_phase_frame
		cmp	_midboss_sprite, 146
		jnb	short loc_141FA
		mov	ax, _midboss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_14205
		mov	al, _midboss_sprite
		add	al, 2
		mov	_midboss_sprite, al
		jmp	short loc_14205
; ---------------------------------------------------------------------------

loc_141FA:
		mov	_midboss_phase, 3
		mov	_midboss_phase_frame, 0

loc_14205:
		mov	word_257E2, 180h
		mov	word_257E4, 100h
		mov	ax, _midboss_pos.cur.x
		mov	word ptr dword_257DE, ax
		mov	ax, _midboss_pos.cur.y
		mov	word ptr dword_257DE+2,	ax
		call	sub_105B9
		or	ax, ax
		jz	loc_142E4

loc_14228:
		push	0Ah
		jmp	loc_14117
; ---------------------------------------------------------------------------

loc_1422D:
		cmp	_midboss_phase, 3
		jnz	loc_142E1
		push	offset _midboss_pos
		call	_motion_update_2
		cmp	_scroll_speed, 2
		ja	short loc_142AC
		mov	ax, _midboss_pos.cur.x
		mov	_homing_target.x, ax
		mov	ax, _midboss_pos.cur.y
		mov	_homing_target.y, ax
		inc	_midboss_phase_frame
		mov	word_257E2, 180h
		mov	word_257E4, 100h
		mov	ax, _midboss_pos.cur.x
		mov	word ptr dword_257DE, ax
		mov	ax, _midboss_pos.cur.y
		mov	word ptr dword_257DE+2,	ax
		call	sub_105B9
		mov	si, ax
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	ax, _midboss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _midboss_pos.cur.y
		add	ax, (-1 shl 4)
		mov	_bullet_template.BT_origin.y, ax
		call	sub_13FB2
		or	si, si
		jz	short loc_142E4
		sub	_midboss_hp, si
		cmp	_midboss_hp, 0
		jle	short loc_142A2
		mov	_midboss_damage_this_frame, 1
		push	4
		jmp	loc_14117
; ---------------------------------------------------------------------------

loc_142A2:
		mov	_bullet_clear_trigger, 1
		push	5
		call	sub_19F6E

loc_142AC:
		mov	_midboss_phase, PHASE_EXPLODE_BIG
		mov	_midboss_sprite, 4
		mov	_midboss_phase_frame, 0
		mov	_midboss_pos.velocity.y, 0
		call	sparks_add_circle pascal, _midboss_pos.cur.x, _midboss_pos.cur.y, large (((8 shl 4) shl 16) or 48)
		call	snd_se_play pascal, 12
		mov	_scroll_speed, 4
		jmp	short loc_142E4
; ---------------------------------------------------------------------------

loc_142E1:
		call	sub_1A047

loc_142E4:
		push	_midboss_hp
		push	620
		call	sub_19F16
		pop	si
		pop	bp
		retf
midboss1_update	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_142F1	proc near
		push	bp
		mov	bp, sp
		cmp	_midboss_phase_frame, 2
		jnz	short loc_14339
		mov	ax, _player_pos.cur.y
		sub	ax, _midboss_pos.cur.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, _midboss_pos.cur.x
		push	ax
		call	iatan2
		mov	_midboss_angle, al
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 32
		mov	_bullet_template.speed, (2 shl 4) + 8
		mov	_bullet_template.BT_angle, 0
		call	fp_2D004
		call	fp_2D000

loc_14339:
		mov	ax, _midboss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1436F
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 2
		mov	_bullet_template.BT_delta.spread_angle, 0Ch
		mov	_bullet_template.speed, (3 shl 4) + 4
		mov	al, _midboss_angle
		mov	_bullet_template.BT_angle, al
		call	fp_2D004
		call	fp_2D000
		call	snd_se_play pascal, 3

loc_1436F:
		cmp	_midboss_phase_frame, 32
		jl	short loc_14381
		mov	byte_25598, 0FFh
		mov	_midboss_phase_frame, 0

loc_14381:
		pop	bp
		retn
sub_142F1	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_14383	proc near
		push	bp
		mov	bp, sp
		cmp	_midboss_phase_frame, 32
		jl	short loc_143C5
		mov	byte_25598, 0FFh
		mov	_midboss_phase_frame, 0
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_BACKWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 32
		mov	_bullet_template.speed, (2 shl 4) + 8
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		call	fp_2D004
		call	sub_1CFA2
		call	snd_se_play pascal, 9

loc_143C5:
		pop	bp
		retn
sub_14383	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_143C7	proc near
		push	bp
		mov	bp, sp
		cmp	_midboss_phase_frame, 1
		jnz	short loc_143D6
		mov	_midboss_angle, 128

loc_143D6:
		mov	ax, _midboss_phase_frame
		mov	bx, 2
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_14411
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 2
		mov	_bullet_template.BT_delta.spread_angle, 12h
		mov	_bullet_template.speed, (2 shl 4) + 14
		mov	al, _midboss_angle
		mov	_bullet_template.BT_angle, al
		add	al, -8
		mov	_midboss_angle, al
		call	fp_2D004
		call	fp_2D000
		call	snd_se_play pascal, 3

loc_14411:
		cmp	_midboss_phase_frame, 32
		jl	short loc_14423
		mov	byte_25598, 0FFh
		mov	_midboss_phase_frame, 0

loc_14423:
		pop	bp
		retn
sub_143C7	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_14425	proc near
		push	bp
		mov	bp, sp
		cmp	_midboss_phase_frame, 1
		jnz	short loc_14435
		call	randring2_next16
		mov	_midboss_angle, al

loc_14435:
		mov	ax, _midboss_phase_frame
		mov	bx, 6
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_14477
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.speed, (2 shl 4)
		mov	al, _midboss_angle
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.count, 24
		call	fp_2D004
		call	sub_1CFA2
		call	snd_se_play pascal, 9
		mov	al, _midboss_angle
		add	al, 6
		mov	_midboss_angle, al

loc_14477:
		cmp	_midboss_phase_frame, 32
		jl	short loc_14489
		mov	byte_25598, 0FFh
		mov	_midboss_phase_frame, 0

loc_14489:
		pop	bp
		retn
sub_14425	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

midboss3_update	proc far

var_4		= word ptr -4
var_1		= byte ptr -1

		enter	4, 0
		push	si
		mov	ax, _midboss_pos.cur.x
		mov	_homing_target.x, ax
		mov	ax, _midboss_pos.cur.y
		mov	_homing_target.y, ax
		cmp	_midboss_phase, 0
		jnz	short loc_144F1
		push	offset _midboss_pos
		call	_motion_update_2
		inc	_midboss_phase_frame
		push	1800180h
		push	0Ah
		call	sub_1E618
		mov	si, ax
		cmp	_midboss_phase_frame, 20
		jl	loc_1468D
		inc	_midboss_phase
		mov	_midboss_phase_frame, 0
		mov	_midboss_pos.velocity.x, 0
		mov	_midboss_pos.velocity.y, 0
		push	3
		call	randring2_next16_and
		mov	byte_25598, al
		push	1
		call	randring2_next16_and
		mov	byte_25599, al
		mov	byte_2559A, 0
		jmp	loc_1468D
; ---------------------------------------------------------------------------

loc_144F1:
		cmp	_midboss_phase, 1
		jnz	loc_1468A
		push	offset _midboss_pos
		call	_motion_update_2
		inc	_midboss_phase_frame
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	ax, _midboss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _midboss_pos.cur.y
		add	ax, (-16 shl 4)
		mov	_bullet_template.BT_origin.y, ax
		mov	al, byte_25598
		mov	ah, 0
		mov	[bp+var_4], ax
		mov	cx, 5		; switch 5 cases
		mov	bx, offset word_1469B

loc_14526:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_4]
		jz	short loc_14536
		add	bx, 2
		loop	loc_14526
		jmp	loc_145EA
; ---------------------------------------------------------------------------

loc_14536:
		jmp	word ptr cs:[bx+0Ah] ; switch jump

loc_1453A:
		call	sub_142F1	; jumptable 00014536 case 0
		jmp	loc_145EA
; ---------------------------------------------------------------------------

loc_14540:
		call	sub_14383	; jumptable 00014536 case 1
		jmp	loc_145EA
; ---------------------------------------------------------------------------

loc_14546:
		call	sub_143C7	; jumptable 00014536 case 2
		jmp	loc_145EA
; ---------------------------------------------------------------------------

loc_1454C:
		call	sub_14425	; jumptable 00014536 case 3
		jmp	loc_145EA
; ---------------------------------------------------------------------------

loc_14552:
		cmp	byte_2559A, 0Bh	; jumptable 00014536 case 255
		ja	short loc_145A5
		mov	ax, _midboss_pos.cur.x
		mov	point_2A8C6.x, ax
		mov	ax, _midboss_pos.cur.y
		mov	point_2A8C6.y, ax
		mov	ax, _midboss_phase_frame
		add	ax, -64
		push	ax
		push	0F0009h
		call	sub_13B89
		mov	ax, _midboss_phase_frame
		cmp	ax, 64
		jz	short loc_14584
		cmp	ax, 68
		jz	short loc_14592
		jmp	short loc_145A5
; ---------------------------------------------------------------------------

loc_14584:
		mov	_midboss_pos.velocity.x, 0
		mov	_midboss_pos.velocity.y, 0
		jmp	short loc_145A5
; ---------------------------------------------------------------------------

loc_14592:
		mov	_midboss_phase_frame, 0
		mov	al, byte_2559A
		and	al, 3
		mov	byte_25598, al
		mov	_midboss_sprite, 0

loc_145A5:
		cmp	_midboss_phase_frame, 1
		jnz	short loc_145EA
		mov	al, byte_2559A
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+1790h]
		mov	[bp+var_1], al
		cmp	byte_25599, 0
		jz	short loc_145C9
		mov	al, 80h
		sub	al, [bp+var_1]
		mov	[bp+var_1], al

loc_145C9:
		call	vector2 pascal, ds, offset _midboss_pos.velocity.x, ds, offset _midboss_pos.velocity.y, word ptr [bp+var_1], (2 shl 4)
		inc	byte_2559A
		mov	_midboss_sprite, 1
		mov	word_2A8D0, 8

loc_145EA:
		cmp	_midboss_pos.cur.y, (368 shl 4)
		jge	short loc_14601
		cmp	_midboss_pos.cur.x, 0
		jle	short loc_14601
		cmp	_midboss_pos.cur.x, (384 shl 4)
		jl	short loc_14606

loc_14601:
		mov	_midboss_phase, 3

loc_14606:
		push	1800180h
		push	4
		call	sub_1E618
		mov	si, ax
		or	si, si
		jz	short loc_1468D
		sub	_midboss_hp, si
		cmp	_midboss_hp, 0
		jle	short loc_14629
		mov	_midboss_damage_this_frame, 1
		jmp	short loc_1468D
; ---------------------------------------------------------------------------

loc_14629:
		mov	_midboss_damage_this_frame, 1
		mov	ax, _midboss_pos.cur.y
		add	ax, (-16 shl 4)
		call	scroll_subpixel_y_to_vram_always pascal, ax
		mov	si, ax
		mov	_bullet_clear_trigger, 1
		mov	al, byte_2559A
		mov	ah, 0
		mov	dx, 14h
		sub	dx, ax
		push	dx
		call	sub_19F6E
		mov	_midboss_phase, PHASE_EXPLODE_BIG
		mov	_midboss_sprite, 4
		mov	_midboss_phase_frame, 0
		mov	_midboss_pos.velocity.x, 0
		call	sparks_add_circle pascal, _midboss_pos.cur.x, _midboss_pos.cur.y, large (((6 shl 4) shl 16) or 48)
		call	snd_se_play pascal, 12
		call	items_add pascal, _midboss_pos.cur.x, _midboss_pos.cur.y, IT_1UP
		jmp	short loc_1468D
; ---------------------------------------------------------------------------

loc_1468A:
		call	sub_1A047

loc_1468D:
		push	_midboss_hp
		push	850
		call	sub_19F16
		pop	si
		leave
		retf
midboss3_update	endp

; ---------------------------------------------------------------------------
		db    0
word_1469B	dw	0,     1,     2,     3
		dw   0FFh		; value	table for switch statement
		dw offset loc_1453A	; jump table for switch	statement
		dw offset loc_14540
		dw offset loc_14546
		dw offset loc_1454C
		dw offset loc_14552

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_146AF	proc near
		push	bp
		mov	bp, sp
		mov	ax, _midboss_pos.cur.x
		mov	_midboss_pos.prev.x, ax
		mov	ax, _midboss_pos.cur.y
		mov	_midboss_pos.prev.y, ax
		push	(192 shl 4)
		push	_midboss_hp
		mov	al, _midboss_angle
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_CosTable8[bx]
		call	vector1_at
		mov	_midboss_pos.cur.x, ax
		push	(96 shl 4)
		push	_midboss_hp
		mov	al, _midboss_angle
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_SinTable8[bx]
		call	vector1_at
		mov	_midboss_pos.cur.y, ax
		mov	al, _midboss_angle
		add	al, -2
		mov	_midboss_angle, al
		pop	bp
		retn
sub_146AF	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_14700	proc near
		push	bp
		mov	bp, sp
		mov	ax, _midboss_pos.cur.x
		mov	_midboss_pos.prev.x, ax
		mov	ax, _midboss_pos.cur.y
		mov	_midboss_pos.prev.y, ax
		cmp	_midboss_phase_frame, 1
		jnz	short loc_14721
		mov	_midboss_pos.velocity.x, (1 shl 4)
		mov	_midboss_angle, 0

loc_14721:
		mov	ax, _midboss_pos.velocity.x
		add	_midboss_pos.cur.x, ax
		cmp	_midboss_phase, 5
		ja	short loc_14749
		cmp	_midboss_pos.cur.x, (16 shl 4)
		jle	short loc_1473F
		cmp	_midboss_pos.cur.x, (368 shl 4)
		jl	short loc_14749

loc_1473F:
		mov	ax, -1
		imul	_midboss_pos.velocity.x
		mov	_midboss_pos.velocity.x, ax

loc_14749:
		push	(96 shl 4)
		push	_midboss_hp
		mov	al, _midboss_angle
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_SinTable8[bx]
		call	vector1_at
		mov	_midboss_pos.cur.y, ax
		mov	al, _midboss_angle
		add	al, 2
		mov	_midboss_angle, al
		pop	bp
		retn
sub_14700	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1476F	proc near
		push	bp
		mov	bp, sp
		cmp	_stage_frame_mod16, 0
		jnz	short loc_14796
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 32
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.speed, (3 shl 4)
		call	fp_2D004
		call	fp_2D000

loc_14796:
		pop	bp
		retn
sub_1476F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_14798	proc near
		push	bp
		mov	bp, sp
		cmp	_stage_frame_mod16, 0
		jnz	short loc_147D9
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_BACKWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 32
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		mov	ax, _midboss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		add	al, 10
		mov	_bullet_template.speed, al
		call	fp_2D004
		call	fp_2D000
		call	snd_se_play pascal, 3

loc_147D9:
		pop	bp
		retn
sub_14798	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_147DB	proc near
		push	bp
		mov	bp, sp
		cmp	_stage_frame_mod16, 0
		jnz	short loc_14826
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.BT_special_motion, 87h
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 5
		mov	_bullet_template.BT_delta.spread_angle, 0Ch
		mov	_bullet_template.patnum, PAT_BULLET16_N_CROSS_YELLOW
		mov	_bullet_template.speed, (2 shl 4)
		call	randring2_next16_and pascal, 0Fh
		add	al, -048h
		mov	_bullet_template.BT_angle, al
		call	fp_2D004
		mov	byte_2CFF7, 2
		call	fp_2D002
		call	snd_se_play pascal, 9

loc_14826:
		pop	bp
		retn
sub_147DB	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_14828	proc near
		push	bp
		mov	bp, sp
		cmp	_stage_frame_mod16, 0
		jnz	short loc_1486C
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 32
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.speed, (2 shl 4)
		call	fp_2D004
		call	fp_2D000
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 16
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.speed, (3 shl 4)
		call	fp_2D004
		call	fp_2D000

loc_1486C:
		pop	bp
		retn
sub_14828	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1486E	proc near

var_2		= word ptr -2

		enter	2, 0
		mov	ax, _midboss_phase_frame
		mov	[bp+var_2], ax
		mov	cx, 15h		; switch 21 cases
		mov	bx, offset word_148F8

loc_1487E:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_1488D
		add	bx, 2
		loop	loc_1487E
		jmp	short locret_148F5 ; default
; ---------------------------------------------------------------------------

loc_1488D:
		jmp	word ptr cs:[bx+2Ah] ; switch jump

loc_14891:
		call	snd_se_play pascal, 9		; jumptable 0001488D cases 250,258,266,274
		push	_midboss_pos.cur.x
		push	_midboss_pos.cur.y
		push	2
		jmp	short loc_148F2
; ---------------------------------------------------------------------------

loc_148A4:
		call	snd_se_play pascal, 3		; jumptable 0001488D cases 290,298,306,314,390,398,406,414,490,498,506,514
		mov	_bullet_template.pattern, BP_SPREAD_AIMED
		mov	_bullet_template.count, 5
		mov	_bullet_template.BT_delta.spread_angle, 6
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.speed, (4 shl 4)
		call	fp_2D004
		call	fp_2D000
		leave
		retn
; ---------------------------------------------------------------------------

loc_148CE:
		push	9		; jumptable 0001488D cases 350,358,366,374

loc_148D0:
		call	snd_se_play
		push	_midboss_pos.cur.x
		push	_midboss_pos.cur.y
		push	IT_BIGPOWER
		jmp	short loc_148F2
; ---------------------------------------------------------------------------

loc_148E1:
		call	snd_se_play pascal, 9		; jumptable 0001488D case 450
		push	_midboss_pos.cur.x
		push	_midboss_pos.cur.y
		push	IT_1UP

loc_148F2:
		call	items_add

locret_148F5:
		leave			; default
		retn
sub_1486E	endp

; ---------------------------------------------------------------------------
		db    0
word_148F8	dw   0FAh,  102h,  10Ah,  112h
		dw   122h,  12Ah,  132h,  13Ah ; value table for switch	statement
		dw   15Eh,  166h,  16Eh,  176h
		dw   186h,  18Eh,  196h,  19Eh
		dw   1C2h,  1EAh,  1F2h,  1FAh
		dw   202h
		dw offset loc_14891	; jump table for switch	statement
		dw offset loc_14891
		dw offset loc_14891
		dw offset loc_14891
		dw offset loc_148A4
		dw offset loc_148A4
		dw offset loc_148A4
		dw offset loc_148A4
		dw offset loc_148CE
		dw offset loc_148CE
		dw offset loc_148CE
		dw offset loc_148CE
		dw offset loc_148A4
		dw offset loc_148A4
		dw offset loc_148A4
		dw offset loc_148A4
		dw offset loc_148E1
		dw offset loc_148A4
		dw offset loc_148A4
		dw offset loc_148A4
		dw offset loc_148A4

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

midbossx_update	proc far
		push	bp
		mov	bp, sp
		mov	ax, _midboss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _midboss_pos.cur.y
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	al, _midboss_phase
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 6
		ja	loc_14A87
		add	bx, bx
		jmp	cs:off_14A8A[bx]

loc_14975:
		call	sub_146AF
		inc	_midboss_phase_frame
		cmp	_midboss_hp, 128
		jle	short loc_14989
		sub	_midboss_hp, 32

loc_14989:
		cmp	_midboss_phase_frame, 128

loc_1498F:
		jl	loc_14A87	; jumptable 0001CCD9 case 17022
		call	sub_1476F
		cmp	_midboss_phase_frame, 320
		jl	loc_14A87
		jmp	loc_14A29
; ---------------------------------------------------------------------------

loc_149A3:
		call	sub_146AF
		inc	_midboss_phase_frame
		cmp	_midboss_hp, 896
		jge	short loc_149B7
		add	_midboss_hp, 8

loc_149B7:
		cmp	_midboss_phase_frame, 128
		jl	loc_14A87
		call	sub_1476F
		cmp	_midboss_phase_frame, 320
		jl	loc_14A87
		jmp	short loc_14A29
; ---------------------------------------------------------------------------

loc_149D0:
		call	sub_146AF
		inc	_midboss_phase_frame
		cmp	_midboss_hp, 128
		jle	short loc_149E4
		sub	_midboss_hp, 32

loc_149E4:
		cmp	_midboss_phase_frame, 128
		jl	loc_14A87
		call	sub_14798
		cmp	_midboss_phase_frame, 320
		jl	loc_14A87
		jmp	short loc_14A29
; ---------------------------------------------------------------------------

loc_149FD:
		cmp	_midboss_phase_frame, 128
		jge	short loc_14A0A
		call	sub_146AF
		jmp	short loc_14A1D
; ---------------------------------------------------------------------------

loc_14A0A:
		call	sub_14700
		call	sub_147DB
		cmp	_midboss_hp, 768
		jge	short loc_14A1D
		add	_midboss_hp, 8

loc_14A1D:
		inc	_midboss_phase_frame
		cmp	_midboss_phase_frame, 640
		jl	short loc_14A87

loc_14A29:
		mov	_midboss_phase_frame, 0
		jmp	short loc_14A65
; ---------------------------------------------------------------------------

loc_14A31:
		call	sub_14700
		cmp	_midboss_phase_frame, 160
		jl	short loc_14A3F
		call	sub_14828

loc_14A3F:
		inc	_midboss_phase_frame
		cmp	_midboss_phase_frame, 440
		jl	short loc_14A87
		jmp	short loc_14A5F
; ---------------------------------------------------------------------------

loc_14A4D:
		call	sub_14700
		call	sub_1486E
		inc	_midboss_phase_frame
		cmp	_midboss_phase_frame, 520
		jl	short loc_14A87

loc_14A5F:
		mov	_midboss_phase_frame, 2

loc_14A65:
		inc	_midboss_phase
		pop	bp
		retf
; ---------------------------------------------------------------------------

loc_14A6B:
		call	sub_14700
		inc	_midboss_phase_frame
		cmp	_midboss_pos.cur.x, (-16 shl 4)
		jle	short loc_14A82
		cmp	_midboss_pos.cur.x, (400 shl 4)
		jl	short loc_14A87

loc_14A82:
		nopcall	sub_19EBC

loc_14A87:
		pop	bp
		retf
midbossx_update	endp

; ---------------------------------------------------------------------------
		db    0
off_14A8A	dw offset loc_14975
		dw offset loc_149A3
		dw offset loc_149D0
		dw offset loc_149FD
		dw offset loc_14A31
off_14A94	dw offset loc_14A4D
		dw offset loc_14A6B

; =============== S U B	R O U T	I N E =======================================


sub_14A98	proc near
		push	si
		push	di
		mov	si, ax
		mov	bx, dx
		sar	ax, 3
		shl	dx, 6
		add	ax, dx
		shr	dx, 2
		add	ax, dx
		mov	di, ax
		and	si, 7
		mov	ax, si
		shl	si, 4
		add	si, 179Ch
		mov	cx, 8
		cmp	bx, 188h
		ja	short loc_14AC6
		xor	dx, dx
		jmp	short loc_14ACF
; ---------------------------------------------------------------------------

loc_14AC6:
		mov	dx, cx
		mov	cx, 190h
		sub	cx, bx
		sub	dx, cx

loc_14ACF:
		or	ax, ax
		jz	short loc_14AE6
		nop

loc_14AD4:
		movsw
		add	di, 4Eh	; 'N'
		loop	loc_14AD4

loc_14ADA:
		or	dx, dx
		jz	short loc_14AEF
		sub	di, 7D00h
		xchg	cx, dx
		jmp	short loc_14AD4
; ---------------------------------------------------------------------------

loc_14AE6:
		movsb
		add	di, 4Fh	; 'O'
		inc	si
		loop	loc_14AE6
		jmp	short loc_14ADA
; ---------------------------------------------------------------------------

loc_14AEF:
		pop	di
		pop	si
		retn
sub_14A98	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_14AF2	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	si, _midboss_phase_frame
		mov	ax, si
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_14B63
		call	snd_se_play pascal, 3
		mov	al, byte_255B3
		shl	al, 5
		add	al, 20h
		mov	_bullet_template.BT_angle, al
		mov	ax, si
		mov	bx, 8
		cwd
		idiv	bx
		test	al, 1
		jz	short loc_14B47
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.pattern, BP_SINGLE
		mov	_bullet_template.speed, (2 shl 4) + 10
		call	fp_2D004
		call	fp_2D000
		mov	_bullet_template.BT_delta.spread_angle, 0Fh
		jmp	short loc_14B4C
; ---------------------------------------------------------------------------

loc_14B47:
		mov	_bullet_template.BT_delta.spread_angle, 0Ah

loc_14B4C:
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 6
		mov	_bullet_template.speed, (2 shl 4) + 4
		call	fp_2D004
		call	fp_2D000

loc_14B63:
		cmp	si, 64
		jl	short loc_14B73
		mov	_midboss_phase_frame, 0
		mov	byte_255B2, 0FFh

loc_14B73:
		pop	si
		pop	bp
		retn
sub_14AF2	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_14B76	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	si, _midboss_phase_frame
		mov	ax, si
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_14BBA
		call	snd_se_play pascal, 3
		mov	al, byte_255B3
		shl	al, 5
		add	al, 20h
		mov	_bullet_template.BT_angle, al
		mov	ax, si
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, (2 shl 4)
		mov	_bullet_template.speed, al
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 32
		call	fp_2D004
		call	fp_2D000

loc_14BBA:
		cmp	si, 20h	; ' '
		jl	short loc_14BCA
		mov	_midboss_phase_frame, 0
		mov	byte_255B2, 0FFh

loc_14BCA:
		pop	si
		pop	bp
		retn
sub_14B76	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_14BCD	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	si, _midboss_phase_frame
		mov	ax, si
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_14C32
		call	snd_se_play pascal, 3
		mov	_bullet_template.speed, (4 shl 4)
		mov	_bullet_template.pattern, BP_SINGLE
		mov	al, byte_255B3
		shl	al, 5
		add	al, 8
		mov	_bullet_template.BT_angle, al
		call	fp_2D004
		call	fp_2D000
		mov	al, byte_255B3
		shl	al, 5
		add	al, 10h
		mov	_bullet_template.BT_angle, al
		call	fp_2D000
		mov	al, byte_255B3
		shl	al, 5
		add	al, 38h
		mov	_bullet_template.BT_angle, al
		call	fp_2D000
		mov	al, byte_255B3
		shl	al, 5
		add	al, 30h
		mov	_bullet_template.BT_angle, al
		call	fp_2D000

loc_14C32:
		cmp	si, 20h	; ' '
		jl	short loc_14C42
		mov	_midboss_phase_frame, 0
		mov	byte_255B2, 0FFh

loc_14C42:
		pop	si
		pop	bp
		retn
sub_14BCD	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_14C45	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	ax, _midboss_phase_frame
		dec	ax
		mov	si, ax
		or	si, si
		jnz	short loc_14C6B
		mov	ax, _player_pos.cur.y
		sub	ax, _midboss_pos.cur.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, _midboss_pos.cur.x
		push	ax
		call	iatan2
		mov	_midboss_angle, al

loc_14C6B:
		mov	ax, si
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_14CCC
		call	snd_se_play pascal, 3
		mov	_bullet_template.speed, (2 shl 4) + 8
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 5
		mov	_bullet_template.BT_delta.spread_angle, 10h
		mov	al, _midboss_angle
		mov	_bullet_template.BT_angle, al
		call	fp_2D004
		call	fp_2D000
		mov	_bullet_template.speed, 10
		mov	ax, _player_pos.cur.y
		sub	ax, _midboss_pos.cur.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, _midboss_pos.cur.x
		push	ax
		call	iatan2
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE
		mov	_bullet_template.pattern, BP_SINGLE
		mov	_bullet_template.BT_special_motion, 0FFh

loc_14CCC:
		mov	ax, si
		mov	bx, 20h	; ' '
		cwd
		idiv	bx
		cmp	dx, 18h
		jl	short loc_14CEA
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	al, _bullet_template.speed
		add	al, 10
		mov	_bullet_template.speed, al
		call	fp_2D002

loc_14CEA:
		cmp	si, 40h
		jl	short loc_14CFA
		mov	_midboss_phase_frame, 0
		mov	byte_255B2, 0FFh

loc_14CFA:
		pop	si
		pop	bp
		retn
sub_14C45	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

midboss2_update	proc far

var_2		= word ptr -2

		enter	2, 0
		push	si
		mov	ax, _midboss_pos.cur.x
		mov	_homing_target.x, ax
		mov	ax, _midboss_pos.cur.y
		mov	_homing_target.y, ax
		cmp	_midboss_phase, 0
		jnz	short loc_14D5D
		push	offset _midboss_pos
		call	_motion_update_2
		inc	_midboss_phase_frame
		push	1800180h
		push	0Ah
		call	sub_1E618
		mov	si, ax
		cmp	_midboss_phase_frame, 96
		jl	loc_14F57
		inc	_midboss_phase
		mov	_midboss_phase_frame, 0
		mov	_midboss_pos.velocity.x, 0
		mov	_midboss_pos.velocity.y, 0
		mov	byte_255B2, 0
		mov	byte_255B3, 1
		mov	byte_255B4, 0
		jmp	loc_14F57
; ---------------------------------------------------------------------------

loc_14D5D:
		cmp	_midboss_phase, 1
		jnz	loc_14F16
		push	offset _midboss_pos
		call	_motion_update_2
		inc	_midboss_phase_frame
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	ax, _midboss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _midboss_pos.cur.y
		add	ax, (-16 shl 4)
		mov	_bullet_template.BT_origin.y, ax
		mov	al, byte_255B2
		mov	ah, 0
		mov	[bp+var_2], ax
		mov	cx, 5		; switch 5 cases
		mov	bx, offset word_14F64

loc_14D92:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_14DA2
		add	bx, 2
		loop	loc_14D92
		jmp	loc_14E8E	; default
; ---------------------------------------------------------------------------

loc_14DA2:
		jmp	word ptr cs:[bx+0Ah] ; switch jump

loc_14DA6:
		call	sub_14AF2	; jumptable 00014DA2 case 0
		jmp	loc_14E8E	; default
; ---------------------------------------------------------------------------

loc_14DAC:
		call	sub_14B76	; jumptable 00014DA2 case 1
		jmp	loc_14E8E	; default
; ---------------------------------------------------------------------------

loc_14DB2:
		call	sub_14BCD	; jumptable 00014DA2 case 2
		jmp	loc_14E8E	; default
; ---------------------------------------------------------------------------

loc_14DB8:
		call	sub_14C45	; jumptable 00014DA2 case 3
		jmp	loc_14E8E	; default
; ---------------------------------------------------------------------------

loc_14DBE:
		mov	ax, _midboss_pos.cur.x ; jumptable 00014DA2 case 255
		mov	point_2A8C6.x, ax
		mov	ax, _midboss_pos.cur.y
		mov	point_2A8C6.y, ax
		mov	ax, _midboss_phase_frame
		add	ax, -48
		push	ax
		push	0F0007h
		call	sub_13B89
		mov	ax, _midboss_phase_frame
		cmp	ax, 1
		jz	short loc_14E20
		cmp	ax, 48
		jz	short loc_14DEF
		cmp	ax, 52
		jz	short loc_14DF8
		jmp	loc_14E8E	; default
; ---------------------------------------------------------------------------

loc_14DEF:
		mov	_midboss_pos.velocity.x, 0
		jmp	loc_14E8E	; default
; ---------------------------------------------------------------------------

loc_14DF8:
		mov	_midboss_phase_frame, 0
		cmp	byte_255B3, 1
		jnz	short loc_14E0A
		mov	_midboss_sprite, 0

loc_14E0A:
		inc	byte_255B4
		mov	al, byte_255B4
		and	al, 3
		mov	byte_255B2, al
		cmp	byte_255B4, 10h
		jbe	short loc_14E8E	; default
		jmp	loc_14EE0
; ---------------------------------------------------------------------------

loc_14E20:
		mov	word_2A8D0, 8
		mov	word_2A8CE, 600h
		cmp	byte_255B3, 1
		jnz	short loc_14E5E
		call	randring2_next16
		test	al, 1
		jz	short loc_14E4C
		mov	_midboss_sprite, 1
		mov	byte_255B3, 0
		mov	_midboss_pos.velocity.x, (-3 shl 4)
		jmp	short loc_14E8E	; default
; ---------------------------------------------------------------------------

loc_14E4C:
		mov	_midboss_sprite, 2
		mov	byte_255B3, 2
		mov	_midboss_pos.velocity.x, (3 shl 4)
		jmp	short loc_14E8E	; default
; ---------------------------------------------------------------------------

loc_14E5E:
		cmp	byte_255B3, 0
		jnz	short loc_14E77
		mov	byte_255B3, 1
		mov	_midboss_pos.velocity.x, (3 shl 4)
		mov	_midboss_sprite, 2
		jmp	short loc_14E8E	; default
; ---------------------------------------------------------------------------

loc_14E77:
		cmp	byte_255B3, 2
		jnz	short loc_14E8E	; default
		mov	byte_255B3, 1
		mov	_midboss_pos.velocity.x, (-3 shl 4)
		mov	_midboss_sprite, 1

loc_14E8E:
		push	1800180h	; default
		push	0Ah
		call	sub_1E618
		mov	si, ax
		or	si, si
		jz	loc_14F57
		sub	_midboss_hp, si
		cmp	_midboss_hp, 0
		jle	short loc_14EB5
		mov	_midboss_damage_this_frame, 1
		push	4
		jmp	short loc_14F0F
; ---------------------------------------------------------------------------

loc_14EB5:
		mov	_midboss_damage_this_frame, 1
		mov	_bullet_clear_trigger, 1
		mov	al, byte_255B4
		mov	ah, 0
		mov	dx, 12h
		sub	dx, ax
		push	dx
		call	sub_19F6E
		call	items_add pascal, _midboss_pos.cur.x, _midboss_pos.cur.y, IT_BOMB
		mov	word_255C2, 0Ch

loc_14EE0:
		mov	_midboss_phase, 2
		mov	_midboss_sprite, 0
		mov	_midboss_phase_frame, 0
		mov	_midboss_pos.velocity.x, 0
		mov	_midboss_pos.velocity.y, (-1 shl 4)
		call	sparks_add_circle pascal, _midboss_pos.cur.x, _midboss_pos.cur.y, large (((8 shl 4) shl 16) or 48)
		push	12

loc_14F0F:
		call	snd_se_play
		jmp	short loc_14F57
; ---------------------------------------------------------------------------

loc_14F16:
		cmp	_midboss_phase, 2
		jnz	short loc_14F52
		push	offset _midboss_pos
		call	_motion_update_2
		inc	_midboss_phase_frame
		cmp	_midboss_pos.cur.y, 0
		jg	short loc_14F38
		inc	_midboss_phase
		mov	_midboss_hp, 0

loc_14F38:
		cmp	_stage_frame_mod16, 0
		jnz	short loc_14F57
		call	sparks_add_circle pascal, _midboss_pos.cur.x, _midboss_pos.cur.y, large (((8 shl 4) shl 16) or 16)
		jmp	short loc_14F57
; ---------------------------------------------------------------------------

loc_14F52:
		nopcall	sub_19EBC

loc_14F57:
		push	_midboss_hp
		push	750
		call	sub_19F16
		pop	si
		leave
		retf
midboss2_update	endp

; ---------------------------------------------------------------------------
word_14F64	dw	0,     1,     2,     3
		dw   0FFh		; value	table for switch statement
		dw offset loc_14DA6	; jump table for switch	statement
		dw offset loc_14DAC
		dw offset loc_14DB2
		dw offset loc_14DB8
		dw offset loc_14DBE

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_14F78	proc near
		push	bp
		mov	bp, sp
		cmp	_midboss_phase_frame, 24
		jg	short loc_14F9B
		mov	ax, _midboss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		mov	_midboss_sprite, al
		cmp	_midboss_phase_frame, 24
		jnz	loc_15025
		push	6
		jmp	short loc_14FF9
; ---------------------------------------------------------------------------

loc_14F9B:
		cmp	_midboss_phase_frame, 128
		jge	short loc_15000
		test	byte ptr _midboss_phase_frame, 3
		jnz	short loc_15025
		mov	_bullet_template.pattern, BP_SPREAD_AIMED
		mov	_bullet_template.count, 2
		mov	_bullet_template.BT_delta.spread_angle, 6
		call	randring2_next16_mod pascal, 18h
		add	al, (2 shl 4)
		mov	_bullet_template.speed, al
		call	randring2_next16_mod pascal, 60h
		sub	al, 30h
		mov	_bullet_template.BT_angle, al
		call	fp_2D004
		call	fp_2D000
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_SMALL_BALL_YELLOW
		call	randring2_next16_mod pascal, (1 shl 4) + 8
		add	al, (2 shl 4)
		mov	_bullet_template.speed, al
		call	randring2_next16_mod pascal, 60h
		sub	al, 30h
		mov	_bullet_template.BT_angle, al
		call	fp_2D000
		push	3

loc_14FF9:
		call	snd_se_play
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_15000:
		cmp	_midboss_phase_frame, 152
		jge	short loc_1501A
		mov	ax, 159
		sub	ax, _midboss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		mov	_midboss_sprite, al
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1501A:
		mov	_midboss_phase_frame, 0
		mov	byte_255C6, 0FFh

loc_15025:
		pop	bp
		retn
sub_14F78	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_15027	proc near

var_1		= byte ptr -1

		enter	2, 0
		cmp	_midboss_phase_frame, 24
		jg	short loc_15068
		mov	ax, _midboss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		mov	_midboss_sprite, al
		cmp	_midboss_phase_frame, 24
		jnz	locret_1511B
		call	snd_se_play pascal, 6
		cmp	_midboss_pos.cur.x, (192 shl 4)
		jge	short loc_1505D
		mov	_bullet_template.BT_angle, 36h
		jmp	short loc_15062
; ---------------------------------------------------------------------------

loc_1505D:
		mov	_bullet_template.BT_angle, 56h

loc_15062:
		inc	byte_22B9E
		leave
		retn
; ---------------------------------------------------------------------------

loc_15068:
		cmp	_midboss_phase_frame, 136
		jg	loc_150F6
		mov	ax, _midboss_phase_frame
		add	ax, -25
		test	al, 0Fh
		jnz	locret_1511B
		mov	_bullet_template.pattern, BP_STACK
		test	byte_22B9E, 1
		jz	short loc_150A1
		mov	ax, _player_pos.cur.y
		sub	ax, _midboss_pos.cur.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, _midboss_pos.cur.x
		push	ax
		call	iatan2
		jmp	short loc_150A6
; ---------------------------------------------------------------------------

loc_150A1:
		mov	al, _bullet_template.BT_angle
		add	al, -8

loc_150A6:
		mov	_bullet_template.BT_angle, al
		mov	al, _bullet_template.BT_angle
		mov	[bp+var_1], al
		call	snd_se_play pascal, 3
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_SMALL_BALL_YELLOW
		call	fp_2D004
		mov	_bullet_template.speed, (1 shl 4)
		mov	_bullet_template.count, 12
		mov	_bullet_template.BT_delta.stack_speed, 7
		call	sub_1CFA2
		cmp	_midboss_pos.cur.x, (192 shl 4)
		jle	short loc_150E2
		mov	al, -60h
		jmp	short loc_150E4
; ---------------------------------------------------------------------------

loc_150E2:
		mov	al, 60h

loc_150E4:
		sub	al, _bullet_template.BT_angle
		mov	_bullet_template.BT_angle, al
		call	sub_1CFA2
		mov	al, [bp+var_1]
		mov	_bullet_template.BT_angle, al
		leave
		retn
; ---------------------------------------------------------------------------

loc_150F6:
		cmp	_midboss_phase_frame, 160
		jge	short loc_15110
		mov	ax, 165
		sub	ax, _midboss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		mov	_midboss_sprite, al
		leave
		retn
; ---------------------------------------------------------------------------

loc_15110:
		mov	_midboss_phase_frame, 0
		mov	byte_255C6, 0FFh

locret_1511B:
		leave
		retn
sub_15027	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1511D	proc near
		push	bp
		mov	bp, sp
		push	si
		cmp	_midboss_phase_frame, 24
		jg	short loc_15142
		mov	ax, _midboss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		mov	_midboss_sprite, al
		cmp	_midboss_phase_frame, 24
		jnz	loc_151FF
		push	6
		jmp	loc_151D3
; ---------------------------------------------------------------------------

loc_15142:
		cmp	_midboss_phase_frame, 120
		jg	loc_151DA
		test	byte ptr _midboss_phase_frame, 7
		jnz	short loc_1517E
		mov	_bullet_template.pattern, BP_SPREAD_AIMED
		call	randring2_next16_and pascal, 3
		add	al, al
		inc	al
		mov	_bullet_template.count, al
		call	randring2_next16_and pascal, 7
		add	al, 0Ah
		mov	_bullet_template.BT_delta.spread_angle, al
		mov	_bullet_template.speed, (3 shl 4) + 2
		mov	_bullet_template.BT_angle, 0
		call	fp_2D004
		call	sub_1CFA2

loc_1517E:
		mov	ax, _midboss_phase_frame
		add	ax, -25
		and	ax, 1Fh
		mov	si, ax
		or	si, si
		jnz	short loc_151A5
		mov	ax, _player_pos.cur.y
		sub	ax, _midboss_pos.cur.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, _midboss_pos.cur.x
		push	ax
		call	iatan2
		mov	_midboss_angle, al

loc_151A5:
		test	si, 3
		jnz	short loc_151FF
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.pattern, BP_SINGLE
		mov	_bullet_template.patnum, PAT_BULLET16_D_YELLOW
		mov	ax, si
		imul	ax, 3
		add	al, (2 shl 4) + 8
		mov	_bullet_template.speed, al
		mov	al, _midboss_angle
		mov	_bullet_template.BT_angle, al
		call	fp_2D004
		call	sub_1CFA2
		push	3

loc_151D3:
		call	snd_se_play
		jmp	short loc_151FF
; ---------------------------------------------------------------------------

loc_151DA:
		cmp	_midboss_phase_frame, 144
		jge	short loc_151F4
		mov	ax, 151
		sub	ax, _midboss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		mov	_midboss_sprite, al
		jmp	short loc_151FF
; ---------------------------------------------------------------------------

loc_151F4:
		mov	_midboss_phase_frame, 0
		mov	byte_255C6, 0FFh

loc_151FF:
		pop	si
		pop	bp
		retn
sub_1511D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_15202	proc near
		push	bp
		mov	bp, sp
		cmp	_midboss_phase_frame, 24
		jg	short loc_1522F
		mov	ax, _midboss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		mov	_midboss_sprite, al
		cmp	_midboss_phase_frame, 24
		jnz	loc_152B2
		call	snd_se_play pascal, 6
		mov	_bullet_template.BT_angle, -20h
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1522F:
		cmp	_midboss_phase_frame, 128
		jge	short loc_1528D
		test	byte ptr _midboss_phase_frame, 2
		jnz	short loc_152B2
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 3
		mov	_bullet_template.BT_delta.spread_angle, 6
		mov	_bullet_template.speed, (3 shl 4) + 12
		cmp	_midboss_pos.cur.x, (192 shl 4)
		jge	short loc_15263
		mov	al, 80h
		sub	al, _bullet_template.BT_angle
		mov	_bullet_template.BT_angle, al

loc_15263:
		call	fp_2D004
		call	fp_2D000
		cmp	_midboss_pos.cur.x, (192 shl 4)
		jge	short loc_1527C
		mov	al, 80h
		sub	al, _bullet_template.BT_angle
		mov	_bullet_template.BT_angle, al

loc_1527C:
		call	snd_se_play pascal, 3
		mov	al, _bullet_template.BT_angle
		add	al, 6
		mov	_bullet_template.BT_angle, al
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1528D:
		cmp	_midboss_phase_frame, 152
		jge	short loc_152A7
		mov	ax, 159
		sub	ax, _midboss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		mov	_midboss_sprite, al
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_152A7:
		mov	_midboss_phase_frame, 0
		mov	byte_255C6, 0FFh

loc_152B2:
		pop	bp
		retn
sub_15202	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

midboss4_update	proc far

var_2		= word ptr -2

		enter	2, 0
		push	si
		mov	ax, _midboss_pos.cur.x
		mov	_homing_target.x, ax
		mov	ax, _midboss_pos.cur.y
		mov	_homing_target.y, ax
		cmp	_midboss_phase, 0
		jnz	short loc_15314
		push	offset _midboss_pos
		call	_motion_update_2
		inc	_midboss_phase_frame
		push	1800180h
		push	0Ah
		call	sub_1E618
		mov	si, ax
		cmp	_midboss_phase_frame, 48
		jl	loc_1552D
		inc	_midboss_phase
		mov	_midboss_phase_frame, 0
		mov	_midboss_pos.velocity.x, 0
		mov	_midboss_pos.velocity.y, 0
		mov	byte_255C8, 0
		mov	byte_255C6, 0
		mov	byte_255C7, 0
		jmp	loc_1552D
; ---------------------------------------------------------------------------

loc_15314:
		cmp	_midboss_phase, 1
		jnz	loc_15490
		push	offset _midboss_pos
		call	_motion_update_2
		inc	_midboss_phase_frame
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	ax, _midboss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _midboss_pos.cur.y
		add	ax, (-16 shl 4)
		mov	_bullet_template.BT_origin.y, ax
		mov	al, byte_255C6
		mov	ah, 0
		mov	[bp+var_2], ax
		mov	cx, 5		; switch 5 cases
		mov	bx, offset word_1553B

loc_15349:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_15358
		add	bx, 2
		loop	loc_15349
		jmp	short loc_153D2	; default
; ---------------------------------------------------------------------------

loc_15358:
		jmp	word ptr cs:[bx+0Ah] ; switch jump

loc_1535C:
		call	sub_14F78	; jumptable 00015358 case 0
		jmp	short loc_153D2	; default
; ---------------------------------------------------------------------------

loc_15361:
		call	sub_1511D	; jumptable 00015358 case 1
		jmp	short loc_153D2	; default
; ---------------------------------------------------------------------------

loc_15366:
		call	sub_15027	; jumptable 00015358 case 2
		jmp	short loc_153D2	; default
; ---------------------------------------------------------------------------

loc_1536B:
		call	sub_15202	; jumptable 00015358 case 3
		jmp	short loc_153D2	; default
; ---------------------------------------------------------------------------

loc_15370:
		cmp	_midboss_phase_frame, 1	; jumptable 00015358 case 255
		jnz	short loc_1538C
		cmp	_midboss_pos.cur.x, (180 shl 4)
		jl	short loc_15384
		mov	ax, 0FFC0h
		jmp	short loc_15387
; ---------------------------------------------------------------------------

loc_15384:
		mov	ax, 40h

loc_15387:
		mov	_midboss_pos.velocity.x, ax
		jmp	short loc_153D2	; default
; ---------------------------------------------------------------------------

loc_1538C:
		cmp	byte_255C7, 8
		jnb	short loc_153BD
		cmp	_midboss_pos.cur.x, (48 shl 4)
		jle	short loc_153A3

loc_1539B:
		cmp	_midboss_pos.cur.x, (336 shl 4)
		jl	short loc_153D2	; default

loc_153A3:
		mov	_midboss_pos.velocity.x, 0
		mov	_midboss_phase_frame, 0
		inc	byte_255C7
		mov	al, byte_255C7
		and	al, 3
		mov	byte_255C6, al
		jmp	short loc_153D2	; default
; ---------------------------------------------------------------------------

loc_153BD:
		cmp	_midboss_pos.cur.x, (-32 shl 4)
		jle	short loc_153CD
		cmp	_midboss_pos.cur.x, (416 shl 4)
		jl	short loc_153D2	; default

loc_153CD:
		mov	_midboss_phase, 3

loc_153D2:
		cmp	_midboss_pos.cur.y, (368 shl 4) 	; default
		jge	short loc_153E9
		cmp	_midboss_pos.cur.x, 0
		jle	short loc_153E9
		cmp	_midboss_pos.cur.x, (384 shl 4)
		jl	short loc_153EE

loc_153E9:
		mov	_midboss_phase, PHASE_NONE

loc_153EE:
		push	1800180h
		push	4
		call	sub_1E618
		mov	si, ax
		or	si, si
		jz	loc_1552D
		sub	_midboss_hp, si
		cmp	_midboss_hp, 0
		jle	short loc_15414
		mov	_midboss_damage_this_frame, 1
		jmp	loc_1552D
; ---------------------------------------------------------------------------

loc_15414:
		mov	_midboss_damage_this_frame, 1
		mov	ax, _midboss_pos.cur.y
		add	ax, (-16 shl 4)
		call	scroll_subpixel_y_to_vram_always pascal, ax
		mov	si, ax
		mov	_bullet_clear_trigger, 1
		mov	al, byte_255C7
		mov	ah, 0
		mov	dx, 1Eh
		sub	dx, ax
		push	dx
		call	sub_19F6E
		mov	word_255C2, 0Ch
		mov	_midboss_phase, PHASE_EXPLODE_BIG
		mov	_midboss_sprite, 4
		mov	_midboss_phase_frame, 0
		mov	_midboss_pos.velocity.x, 0
		call	sparks_add_circle pascal, _midboss_pos.cur.x, _midboss_pos.cur.y, large (((6 shl 4) shl 16) or 48)
		call	snd_se_play pascal, 12
		cmp	_midboss_frames_until, 2800
		jnz	short loc_15480
		push	_midboss_pos.cur.x
		push	_midboss_pos.cur.y
		push	IT_BOMB
		jmp	short loc_1548A
; ---------------------------------------------------------------------------

loc_15480:
		push	_midboss_pos.cur.x
		push	_midboss_pos.cur.y
		push	IT_1UP

loc_1548A:
		call	items_add
		jmp	loc_1552D
; ---------------------------------------------------------------------------

loc_15490:
		cmp	_midboss_phase, PHASE_EXPLODE_BIG
		jnz	short loc_154D1
		mov	_midboss_pos.velocity.x, 0
		mov	_midboss_pos.velocity.y, 0
		push	offset _midboss_pos
		call	_motion_update_2
		inc	_midboss_phase_frame
		mov	ax, _midboss_phase_frame
		mov	bx, 16
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1552D
		inc	_midboss_sprite
		cmp	_midboss_sprite, 12
		jb	short loc_1552D
		inc	_midboss_phase
		mov	_midboss_hp, 0
		jmp	short loc_1552D
; ---------------------------------------------------------------------------

loc_154D1:
		nopcall	sub_19EBC
		cmp	_midboss_frames_until, 2800
		jnz	short loc_1552D
		mov	_midboss_frames_until, 5600
		setfarfp	_midboss_update_func, midboss4_update
		mov	_midboss_render_func, offset midboss4_render
		mov	_midboss_pos.cur.x, (240 shl 4)
		mov	_midboss_pos.cur.y, (-32 shl 4)
		mov	_midboss_pos.prev.x, (240 shl 4)
		mov	_midboss_pos.prev.y, (-32 shl 4)
		mov	_midboss_pos.velocity.x, (-4 shl 4)
		mov	_midboss_pos.velocity.y, (2 shl 4)
		mov	_midboss_hp, 1200
		mov	_midboss_sprite, 0
		mov	_midboss_phase_frame, 0
		jmp	short loc_15537
; ---------------------------------------------------------------------------

loc_1552D:
		push	_midboss_hp
		push	1200
		call	sub_19F16

loc_15537:
		pop	si
		leave
		retf
midboss4_update	endp

; ---------------------------------------------------------------------------
		db 0
word_1553B	dw	0,     1,     2,     3
		dw   0FFh		; value	table for switch statement
		dw offset loc_1535C	; jump table for switch	statement
		dw offset loc_15361
		dw offset loc_15366
		dw offset loc_1536B
		dw offset loc_15370

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1554F	proc near

var_2		= word ptr -2

		enter	2, 0
		push	si
		mov	ax, word_2598A
		mov	[bp+var_2], ax
		add	ax, 2
		call	_motion_update_2 pascal, ax
		mov	si, [bp+var_2]
		cmp	byte ptr [si+20h], 0
		jz	short loc_15572
		add	ax, (16 shl 4)
		cmp	ax, ((PLAYFIELD_W + 32) shl 4)
		jnb	short loc_15586

loc_15572:
		cmp	byte ptr [si+21h], 0
		jz	short loc_15582
		add	dx, (16 shl 4)
		cmp	dx, ((PLAYFIELD_H + 32) shl 4)
		jnb	short loc_15586

loc_15582:
		mov	al, 0
		jmp	short loc_1558F
; ---------------------------------------------------------------------------

loc_15586:
		inc	_enemies_gone
		mov	byte ptr [si], 2
		mov	al, 1

loc_1558F:
		pop	si
		leave
		retn
sub_1554F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_15592	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	si, word_2598A
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [si+1Eh]
		push	word ptr [si+1Ch]
		call	vector2_near
		pop	si
		pop	bp
		retn
sub_15592	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_155AA	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	si, word_2598A
		push	es
		mov	ax, _player_pos.cur.y
		sub	ax, [si+4]
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, [si+2]
		push	ax
		call	iatan2
		add	al, [si+1Eh]
		mov	[si+1Eh], al
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [si+1Eh]
		push	word ptr [si+1Ch]
		call	vector2_near
		pop	es
		assume es:nothing
		pop	si
		pop	bp
		retn
sub_155AA	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_155DD	proc near

var_4		= word ptr -4
var_2		= byte ptr -2
var_1		= byte ptr -1

		enter	4, 0
		push	si
		push	di
		mov	si, word_2598A
		mov	es, _std_seg

loc_155EB:
		mov	di, [si+16h]
		add	di, [si+18h]

loc_155F1:
		mov	al, es:[di]
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 8Fh
		ja	loc_15B1A
		add	bx, bx
		jmp	cs:off_15B4D[bx]

loc_15607:
		cmp	byte ptr [si+1Ah], 0
		jnz	short loc_15620
		mov	al, es:[di+2]
		mov	ah, 0
		mov	[si+1Ch], ax
		mov	al, es:[di+1]
		mov	[si+1Eh], al
		call	sub_15592

loc_15620:
		call	sub_1554F
		or	al, al
		jnz	loc_159A4
		mov	al, es:[di+3]
		mov	[bp+var_1], al
		mov	[bp+var_2], 4
		jmp	loc_15B1A
; ---------------------------------------------------------------------------

loc_15637:
		cmp	byte ptr [si+1Ah], 0
		jnz	short loc_15640
		call	sub_15592

loc_15640:
		call	sub_1554F
		or	al, al
		jnz	loc_159A4
		jmp	loc_1573B
; ---------------------------------------------------------------------------

loc_1564C:
		cmp	byte ptr [si+1Ah], 0
		jnz	short loc_1565E
		mov	al, es:[di+1]
		mov	ah, 0
		mov	[si+1Ch], ax
		call	sub_15592

loc_1565E:
		call	sub_1554F
		or	al, al
		jnz	loc_159A4
		mov	al, es:[di+2]
		mov	[bp+var_1], al
		mov	[bp+var_2], 3
		jmp	loc_15B1A
; ---------------------------------------------------------------------------

loc_15675:
		cmp	byte ptr [si+1Ah], 0
		jnz	short loc_15692
		mov	al, es:[di+1]
		mov	[si+1Eh], al
		mov	al, es:[di+3]
		mov	[si+1Fh], al
		mov	al, es:[di+2]
		mov	ah, 0
		mov	[si+1Ch], ax

loc_15692:
		call	sub_15592
		cmp	byte ptr es:[di], 5
		jnz	short loc_156B8
		mov	al, es:[di+4]
		cbw
		add	[si+0Ah], ax
		mov	al, es:[di+5]
		cbw
		add	[si+0Ch], ax
		mov	al, es:[di+6]
		mov	[bp+var_1], al
		mov	[bp+var_2], 7
		jmp	short loc_156C3
; ---------------------------------------------------------------------------

loc_156B8:
		mov	al, es:[di+4]
		mov	[bp+var_1], al
		mov	[bp+var_2], 5

loc_156C3:
		call	sub_1554F
		or	al, al
		jnz	loc_159A4
		jmp	short loc_15708
; ---------------------------------------------------------------------------

loc_156CE:
		call	sub_15592
		cmp	byte ptr es:[di], 0Eh
		jnz	short loc_156F4
		mov	al, es:[di+1]
		cbw
		add	[si+0Ah], ax
		mov	al, es:[di+2]
		cbw
		add	[si+0Ch], ax
		mov	al, es:[di+3]
		mov	[bp+var_1], al
		mov	[bp+var_2], 4
		jmp	short loc_156FF
; ---------------------------------------------------------------------------

loc_156F4:
		mov	al, es:[di+1]
		mov	[bp+var_1], al
		mov	[bp+var_2], 2

loc_156FF:
		call	sub_1554F
		or	al, al
		jnz	loc_159A4

loc_15708:
		mov	al, [si+1Fh]
		add	[si+1Eh], al
		jmp	loc_15B1A
; ---------------------------------------------------------------------------

loc_15711:
		cmp	byte ptr [si+1Ah], 0
		jnz	short loc_1573B
		mov	eax, [si+2]
		mov	[si+6],	eax
		jmp	short loc_1573B
; ---------------------------------------------------------------------------

loc_15721:
		cmp	byte ptr [si+1Ah], 0
		jnz	short loc_1572C
		mov	word ptr [si+0Ah], 0

loc_1572C:
		mov	ax, _scroll_last_delta
		mov	[si+0Ch], ax
		call	sub_1554F
		or	al, al
		jnz	loc_159A4

loc_1573B:
		mov	al, es:[di+1]
		mov	[bp+var_1], al
		mov	[bp+var_2], 2
		jmp	loc_15B1A
; ---------------------------------------------------------------------------

loc_15749:
		cmp	byte ptr [si+1Ah], 0
		jnz	short loc_1575A
		mov	byte ptr [si+1Eh], 0
		mov	al, es:[di+2]
		mov	[si+1Fh], al

loc_1575A:
		movzx	eax, byte ptr es:[di+1]
		mov	dl, [si+1Eh]
		mov	dh, 0
		add	dx, dx
		mov	bx, dx
		movsx	edx, _CosTable8[bx]
		imul	eax, edx
		sar	eax, 8
		mov	[si+0Ah], ax
		mov	al, es:[di+3]
		cbw
		mov	[si+0Ch], ax
		cmp	byte ptr es:[di], 8
		jnz	short loc_1579A
		mov	ax, [si+0Ah]
		mov	[bp+var_4], ax
		mov	ax, [si+0Ch]
		mov	[si+0Ah], ax
		mov	ax, [bp+var_4]
		mov	[si+0Ch], ax

loc_1579A:
		call	sub_1554F
		or	al, al
		jnz	loc_159A4
		mov	al, [si+1Fh]
		add	[si+1Eh], al
		mov	al, es:[di+4]
		mov	[bp+var_1], al
		mov	[bp+var_2], 5
		jmp	loc_15B1A
; ---------------------------------------------------------------------------

loc_157B7:
		mov	al, es:[di+1]
		mov	[si+1Eh], al
		mov	al, es:[di+2]
		mov	ah, 0
		mov	[si+1Ch], ax
		call	sub_155AA
		jmp	loc_15A9D
; ---------------------------------------------------------------------------

loc_157CD:
		mov	al, es:[di+1]
		add	[si+1Eh], al
		jmp	loc_15ACD
; ---------------------------------------------------------------------------

loc_157D7:
		mov	al, es:[di+1]
		cbw
		add	[si+1Ch], ax
		jmp	loc_15ACD
; ---------------------------------------------------------------------------

loc_157E2:
		call	randring2_next16
		mov	[si+1Eh], al
		jmp	loc_158BE
; ---------------------------------------------------------------------------

loc_157EB:
		mov	al, [si+2Ch]
		mov	_bullet_template.spawn_type, al
		mov	al, [si+2Dh]
		mov	_bullet_template.patnum, al
		mov	ax, [si+2Eh]
		add	ax, [si+2]
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, [si+30h]
		add	ax, [si+4]
		mov	_bullet_template.BT_origin.y, ax
		mov	al, [si+36h]
		mov	_bullet_template.pattern, al
		mov	al, [si+37h]
		mov	_bullet_template.BT_angle, al
		mov	al, [si+38h]
		mov	_bullet_template.speed, al
		mov	al, [si+39h]
		mov	_bullet_template.count, al
		mov	al, [si+3Ah]
		mov	_bullet_template.BT_delta, al
		push	es
		call	fp_2D004
		call	fp_2D000
		pop	es
		jmp	loc_158BE
; ---------------------------------------------------------------------------

loc_15834:
		mov	byte ptr [si+29h], 0
		mov	al, es:[di+1]
		mov	[si+2Ch], al
		mov	ax, es:[di+2]
		mov	[si+2Eh], ax
		mov	ax, es:[di+4]
		mov	[si+30h], ax
		mov	al, es:[di+6]
		mov	[si+36h], al
		mov	al, es:[di+7]
		mov	[si+37h], al
		mov	al, es:[di+8]
		mov	[si+38h], al
		mov	al, es:[di+9]
		mov	[si+2Dh], al
		mov	al, es:[di+0Ah]
		mov	[si+39h], al
		mov	[bp+var_2], 0Bh
		jmp	loc_15B37
; ---------------------------------------------------------------------------

loc_15877:
		mov	al, es:[di+1]
		mov	[si+2Ch], al
		jmp	loc_15AE4
; ---------------------------------------------------------------------------

loc_15881:
		cmp	byte ptr [si+1Ah], 0
		jnz	short loc_1588F
		mov	eax, [si+2]
		mov	[si+6],	eax

loc_1588F:
		mov	ax, es:[di+1]
		mov	[si+2Eh], ax
		mov	ax, es:[di+3]
		mov	[si+30h], ax
		mov	[bp+var_2], 5
		jmp	loc_15B37
; ---------------------------------------------------------------------------

loc_158A4:
		mov	al, es:[di+1]
		mov	[si+37h], al
		jmp	loc_15AE4
; ---------------------------------------------------------------------------

loc_158AE:
		mov	al, es:[di+1]
		add	[si+37h], al
		jmp	loc_15AE4
; ---------------------------------------------------------------------------

loc_158B8:
		call	randring2_next16
		mov	[si+37h], al

loc_158BE:
		mov	[bp+var_2], 1
		jmp	loc_15B37
; ---------------------------------------------------------------------------

loc_158C5:
		mov	al, es:[di+1]
		mov	[si+2Dh], al
		jmp	loc_15AE4
; ---------------------------------------------------------------------------

loc_158CF:
		mov	al, es:[di+1]
		mov	[si+39h], al
		jmp	loc_15AE4
; ---------------------------------------------------------------------------

loc_158D9:
		mov	al, es:[di+1]
		mov	[si+38h], al
		jmp	loc_15AE4
; ---------------------------------------------------------------------------

loc_158E3:
		mov	al, es:[di+1]
		add	[si+38h], al
		jmp	loc_15AE4
; ---------------------------------------------------------------------------

loc_158ED:
		mov	al, es:[di+1]
		mov	[si+36h], al
		jmp	loc_15AE4
; ---------------------------------------------------------------------------

loc_158F7:
		mov	al, es:[di+1]
		mov	ah, 0
		mov	[bp+var_4], ax
		cmp	_playperf, 16
		jbe	short loc_1593A
		mov	al, _playperf
		mov	ah, 0
		add	ax, -16
		imul	[bp+var_4]
		mov	[bp+var_4], ax
		mov	bx, 20h	; ' '
		mov	ax, [bp+var_4]
		cwd
		idiv	bx
		mov	[bp+var_4], ax
		mov	al, es:[di+1]
		mov	ah, 0
		sub	ax, [bp+var_4]
		mov	[bp+var_4], ax
		cmp	[bp+var_4], 10h
		jge	short loc_15977
		mov	[bp+var_4], 10h
		jmp	short loc_15977
; ---------------------------------------------------------------------------

loc_1593A:
		cmp	_playperf, 16
		jnb	short loc_15977
		mov	al, _playperf
		mov	ah, 0
		push	ax
		mov	ax, 10h
		pop	dx
		sub	ax, dx
		imul	[bp+var_4]
		mov	[bp+var_4], ax
		mov	bx, 20h	; ' '
		mov	ax, [bp+var_4]
		cwd
		idiv	bx
		mov	[bp+var_4], ax
		mov	al, es:[di+1]
		mov	ah, 0
		add	ax, [bp+var_4]
		mov	[bp+var_4], ax
		cmp	[bp+var_4], 100h
		jl	short loc_15977
		mov	[bp+var_4], 0FFh

loc_15977:
		cmp	_rank, RANK_EASY
		jnz	short loc_15983
		mov	[bp+var_4], 0FFh

loc_15983:
		mov	al, byte ptr [bp+var_4]
		mov	[si+3Fh], al
		jmp	loc_15AE4
; ---------------------------------------------------------------------------

loc_1598C:
		mov	byte ptr [si+29h], 1
		jmp	loc_158BE
; ---------------------------------------------------------------------------

loc_15993:
		mov	byte ptr [si+29h], 0
		jmp	loc_158BE
; ---------------------------------------------------------------------------

loc_1599A:
		mov	al, es:[di+1]
		mov	[si+3Ah], al
		jmp	loc_15AE4
; ---------------------------------------------------------------------------

loc_159A4:
		mov	byte ptr [si], 2
		mov	al, 1
		jmp	loc_15B49
; ---------------------------------------------------------------------------

loc_159AC:
		mov	byte ptr [si], 1
		mov	al, es:[di+1]
		mov	[si+0Eh], al
		mov	ax, es:[di+2]
		mov	[si+10h], ax
		mov	ax, es:[di+4]
		mov	[si+14h], ax
		mov	byte ptr [si+28h], 1
		mov	byte ptr [si+2Ah], 1
		mov	[bp+var_2], 6
		jmp	loc_15B37
; ---------------------------------------------------------------------------

loc_159D3:
		mov	byte ptr [si+20h], 1
		jmp	loc_158BE
; ---------------------------------------------------------------------------

loc_159DA:
		mov	byte ptr [si+20h], 1

loc_159DE:
		mov	byte ptr [si+21h], 1
		jmp	loc_158BE
; ---------------------------------------------------------------------------

loc_159E5:
		mov	al, es:[di+1]
		mov	[si+25h], al
		mov	al, es:[di+2]
		mov	[si+26h], al
		jmp	loc_15A9D
; ---------------------------------------------------------------------------

loc_159F6:
		mov	al, es:[di+1]
		mov	ah, 0
		call	snd_se_play pascal, ax
		jmp	loc_15AE4
; ---------------------------------------------------------------------------

loc_15A05:
		mov	al, es:[di+1]
		mov	[si+0Eh], al
		jmp	loc_15AE4
; ---------------------------------------------------------------------------

loc_15A0F:
		mov	byte ptr [si+28h], 0
		mov	[bp+var_2], 1
		mov	byte ptr [si+29h], 0
		jmp	loc_15B37
; ---------------------------------------------------------------------------

loc_15A1E:
		mov	byte ptr [si+28h], 1
		mov	[bp+var_2], 1
		cmp	_rank, RANK_LUNATIC
		jnz	short loc_15A32
		mov	ax, 1
		jmp	short loc_15A34
; ---------------------------------------------------------------------------

loc_15A32:
		xor	ax, ax

loc_15A34:
		mov	[si+29h], al
		jmp	loc_15B37
; ---------------------------------------------------------------------------

loc_15A3A:
		mov	byte ptr [si+2Ah], 0
		jmp	loc_158BE
; ---------------------------------------------------------------------------

loc_15A41:
		mov	byte ptr [si+2Ah], 1
		jmp	loc_158BE
; ---------------------------------------------------------------------------

loc_15A48:
		mov	eax, [si+2]
		mov	[si+6],	eax
		mov	ax, es:[di+1]
		mov	[si+2],	ax
		mov	ax, es:[di+3]
		mov	[si+4],	ax
		jmp	short loc_15A76
; ---------------------------------------------------------------------------

loc_15A60:
		mov	eax, [si+2]
		mov	[si+6],	eax
		mov	ax, es:[di+1]
		add	[si+2],	ax
		mov	ax, es:[di+3]
		add	[si+4],	ax

loc_15A76:
		mov	[bp+var_2], 5
		mov	[bp+var_1], 0
		jmp	loc_15B1A
; ---------------------------------------------------------------------------

loc_15A81:
		mov	al, es:[di+1]
		add	[si+0Eh], al
		jmp	short loc_15AE4
; ---------------------------------------------------------------------------

loc_15A8A:
		mov	al, es:[di+1]
		mov	[si+1Eh], al
		mov	al, es:[di+2]
		mov	ah, 0		; jumptable 0001C46F case 60
		mov	[si+1Ch], ax

loc_15A9A:
		call	sub_15592

loc_15A9D:
		mov	[bp+var_2], 3
		jmp	loc_15B37
; ---------------------------------------------------------------------------

loc_15AA4:
		mov	al, es:[di+1]
		mov	[si+1Eh], al
		mov	al, es:[di+2]
		mov	ah, 0
		mov	[si+1Ch], ax
		cmp	byte ptr [si+2Bh], 0
		jnz	short loc_15A9A
		mov	al, 80h
		sub	al, [si+1Eh]
		mov	[si+1Eh], al
		jmp	short loc_15A9A
; ---------------------------------------------------------------------------

loc_15AC4:
		mov	al, es:[di+1]
		mov	ah, 0
		mov	[si+1Ch], ax

loc_15ACD:
		call	sub_15592
		jmp	short loc_15AE4
; ---------------------------------------------------------------------------

loc_15AD2:
		push	word ptr [si+2]
		push	word ptr [si+4]
		mov	al, es:[di+1]
		mov	ah, 0
		push	ax
		call	sub_B682

loc_15AE4:
		mov	[bp+var_2], 2
		jmp	short loc_15B37
; ---------------------------------------------------------------------------

loc_15AEA:
		mov	al, [si+1Bh]
		cmp	al, es:[di+2]
		jb	short loc_15AF9
		mov	byte ptr [si+1Bh], 0
		jmp	short loc_15A9D
; ---------------------------------------------------------------------------

loc_15AF9:
		inc	byte ptr [si+1Bh]
		cmp	byte ptr es:[di], 80h
		jnz	short loc_15B0E
		mov	al, es:[di+1]
		mov	ah, 0
		mov	[si+18h], ax
		jmp	loc_155EB
; ---------------------------------------------------------------------------

loc_15B0E:
		mov	al, es:[di+1]
		mov	ah, 0
		sub	[si+18h], ax
		jmp	loc_155EB
; ---------------------------------------------------------------------------

loc_15B1A:
		mov	al, [si+1Ah]
		cmp	al, [bp+var_1]
		jb	short loc_15B30
		mov	byte ptr [si+1Ah], 0
		mov	al, [bp+var_2]
		mov	ah, 0
		add	[si+18h], ax
		jmp	short loc_15B33
; ---------------------------------------------------------------------------

loc_15B30:
		inc	byte ptr [si+1Ah]

loc_15B33:
		mov	al, 0
		jmp	short loc_15B49
; ---------------------------------------------------------------------------

loc_15B37:
		mov	al, [bp+var_2]
		mov	ah, 0
		add	[si+18h], ax
		mov	al, [bp+var_2]
		mov	ah, 0
		add	di, ax
		jmp	loc_155F1
; ---------------------------------------------------------------------------

loc_15B49:
		pop	di
		pop	si
		leave
		retn
sub_155DD	endp

; ---------------------------------------------------------------------------
off_15B4D	dw offset loc_159A4
		dw offset loc_15607
		dw offset loc_15637
		dw offset loc_1564C
		dw offset loc_15675
		dw offset loc_15675
		dw offset loc_15711
		dw offset loc_15749
		dw offset loc_15749
		dw offset loc_157B7
		dw offset loc_157CD
		dw offset loc_15721
		dw offset loc_157D7
		dw offset loc_156CE
		dw offset loc_156CE
		dw offset loc_15B1A
		dw offset loc_159AC
		dw offset loc_157E2
		dw offset loc_15A8A
		dw offset loc_15AA4
		dw offset loc_15AC4
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_157EB
		dw offset loc_15834
		dw offset loc_15877
		dw offset loc_15881
		dw offset loc_158A4
		dw offset loc_158AE
		dw offset loc_158D9
		dw offset loc_158E3
		dw offset loc_158ED
		dw offset loc_158CF
		dw offset loc_158C5
		dw offset loc_1598C
		dw offset loc_158F7
		dw offset loc_158B8
		dw offset loc_15993
		dw offset loc_15B1A
		dw offset loc_1599A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15B1A
		dw offset loc_15AEA
		dw offset loc_15AEA
		dw offset loc_159D3
		dw offset loc_159DE
		dw offset loc_159DA
		dw offset loc_159E5
		dw offset loc_159F6
		dw offset loc_15A05
		dw offset loc_15A0F
		dw offset loc_15A1E
		dw offset loc_15A48
		dw offset loc_15A60
		dw offset loc_15A3A
		dw offset loc_15A41
		dw offset loc_15A81
		dw offset loc_15AD2

include th04/boss/explosions_reset.asm
include th04/boss/explode_small.asm
include th04/boss/explode_big.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_15D74	proc far
		push	bp
		mov	bp, sp
		push	si
		mov	si, 42F0h
		xor	ax, ax
		jmp	short loc_15D86
; ---------------------------------------------------------------------------

loc_15D7F:
		mov	byte ptr [si], 0
		inc	ax
		add	si, 18h

loc_15D86:
		cmp	ax, 2
		jl	short loc_15D7F
		mov	word_25622, 0
		mov	byte_25618, 1
		mov	word_2562C, 1
		mov	word_2562E, 1
		pop	si
		pop	bp
		retf
sub_15D74	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_15DA5	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	cx, 0Ch
		push	ds
		pop	es
		assume es:_DATA
		mov	si, 42D8h
		mov	di, [bp+arg_0]
		rep movsw
		pop	di
		pop	si
		pop	bp
		retn	2
sub_15DA5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_15DBD	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	si, 42F0h
		xor	di, di
		jmp	short loc_15DDF
; ---------------------------------------------------------------------------

loc_15DC9:
		cmp	byte ptr [si], 0
		jnz	short loc_15DDB
		push	si
		call	sub_15DA5
		call	snd_se_play pascal, 5
		jmp	short loc_15DE4
; ---------------------------------------------------------------------------

loc_15DDB:
		inc	di
		add	si, 18h

loc_15DDF:
		cmp	di, 2
		jl	short loc_15DC9

loc_15DE4:
		pop	di
		pop	si
		pop	bp
		retn
sub_15DBD	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_15DE8	proc near

var_2		= word ptr -2

		push	bp
		mov	bp, sp
		sub	sp, 2
		push	si
		push	di
		mov	si, 42F0h
		mov	[bp+var_2], 0
		jmp	loc_15EC2
; ---------------------------------------------------------------------------

loc_15DFB:
		cmp	byte ptr [si], 0
		jz	loc_15EBC
		cmp	byte ptr [si], 1
		jnz	short loc_15E1F
		mov	ax, [si+0Ah]
		cmp	ax, [si+0Ch]
		jl	short loc_15E6B
		inc	byte ptr [si]
		mov	word ptr [si+0Ah], 0
		call	snd_se_play pascal, 6
		jmp	short loc_15E6B
; ---------------------------------------------------------------------------

loc_15E1F:
		cmp	byte ptr [si], 2
		jnz	short loc_15E41
		mov	ax, [si+16h]
		add	[si+14h], ax
		mov	ax, [si+14h]
		cmp	ax, [si+12h]
		jl	short loc_15E6B
		inc	byte ptr [si]
		mov	word ptr [si+0Ah], 0
		mov	ax, [si+12h]
		mov	[si+14h], ax
		jmp	short loc_15E6B
; ---------------------------------------------------------------------------

loc_15E41:
		cmp	byte ptr [si], 3
		jnz	short loc_15E57
		mov	ax, [si+0Ah]
		cmp	ax, [si+0Eh]
		jl	short loc_15E6B
		inc	byte ptr [si]
		mov	word ptr [si+0Ah], 0
		jmp	short loc_15E6B
; ---------------------------------------------------------------------------

loc_15E57:
		cmp	byte ptr [si], 4
		jnz	short loc_15E6B
		mov	ax, [si+16h]
		sub	[si+14h], ax
		cmp	word ptr [si+14h], 1
		jg	short loc_15E6B
		mov	byte ptr [si], 0

loc_15E6B:
		inc	word ptr [si+0Ah]
		cmp	byte ptr [si], 1
		jbe	short loc_15EBC
		mov	ax, [si+14h]
		shl	ax, 3
		mov	di, ax
		mov	ax, [si+4]
		add	ax, di
		cmp	ax, _player_pos.cur.y
		jg	short loc_15EBC
		mov	ax, [si+14h]
		shl	ax, 2
		mov	di, ax
		cmp	di, 100h
		jl	short loc_15E97
		mov	di, 100h

loc_15E97:
		mov	ax, [si+14h]
		shl	ax, 4
		sub	ax, di
		mov	di, ax
		mov	ax, [si+2]
		sub	ax, di
		cmp	ax, _player_pos.cur.x
		jg	short loc_15EBC
		mov	ax, [si+2]
		add	ax, di
		cmp	ax, _player_pos.cur.x
		jl	short loc_15EBC
		mov	byte_259A9, 1

loc_15EBC:
		inc	[bp+var_2]
		add	si, 18h

loc_15EC2:
		cmp	[bp+var_2], 2
		jl	loc_15DFB
		pop	di
		pop	si
		leave
		retn
sub_15DE8	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_15ECE	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		push	di
		cmp	byte_25667, 0
		jnz	short loc_15EEA
		mov	byte_25667, 1
		mov	_boss_damage_this_frame, 0
		add	_boss_pos.cur.y, (16 shl 4)

loc_15EEA:
		cmp	byte_25667, 1
		jnz	short loc_15F46
		cmp	_boss_phase_frame, 32
		jl	loc_15F8F
		mov	_boss_phase_frame, 0
		mov	byte_25667, 2
		cmp	[bp+arg_0], 0
		jnz	short loc_15F23
		push	1000h
		call	randring2_next16_mod
		add	ax, 400h
		mov	si, ax
		push	400h
		call	randring2_next16_mod
		add	ax, 400h
		mov	di, ax
		jmp	short loc_15F29
; ---------------------------------------------------------------------------

loc_15F23:
		mov	si, 0C00h
		mov	di, 500h

loc_15F29:
		mov	ax, si
		sub	ax, _boss_pos.cur.x
		mov	bx, 64
		cwd
		idiv	bx
		mov	_boss_pos.velocity.x, ax
		mov	ax, di
		sub	ax, _boss_pos.cur.y
		cwd
		idiv	bx
		mov	_boss_pos.velocity.y, ax
		jmp	short loc_15F8F
; ---------------------------------------------------------------------------

loc_15F46:
		cmp	byte_25667, 2
		jnz	short loc_15F67
		push	offset _boss_pos
		call	_motion_update_2
		cmp	_boss_phase_frame, 64
		jl	short loc_15F8F
		mov	_boss_phase_frame, 0
		mov	byte_25667, 3
		jmp	short loc_15F8F
; ---------------------------------------------------------------------------

loc_15F67:
		cmp	byte_25667, 3
		jnz	short loc_15F8F
		cmp	_boss_phase_frame, 8
		jl	short loc_15F8F
		mov	_boss_phase_frame, 0
		mov	byte_25667, 0
		mov	_boss_mode, 0FEh
		sub	_boss_pos.cur.y, (16 shl 4)
		mov	al, 1
		jmp	short loc_15F91
; ---------------------------------------------------------------------------

loc_15F8F:
		mov	al, 0

loc_15F91:
		pop	di
		pop	si
		pop	bp
		retn	2
sub_15ECE	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_15F97	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 1
		jnz	short loc_15FCF
		mov	ax, _boss_pos.cur.x
		add	ax, (-32 shl 4)
		mov	word_25662, ax
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_CROSS_YELLOW
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 11
		mov	_bullet_template.BT_delta.spread_angle, 5
		mov	_bullet_template.speed, (2 shl 4) + 8
		call	fp_2D004
		jmp	loc_1607E
; ---------------------------------------------------------------------------

loc_15FCF:
		cmp	_boss_phase_frame, 15
		jnz	short loc_15FDE
		mov	_bullet_template.BT_angle, 0
		jmp	loc_1607E
; ---------------------------------------------------------------------------

loc_15FDE:
		cmp	_boss_phase_frame, 31
		jnz	short loc_15FF3
		add	word_25662, 400h
		mov	_bullet_template.BT_angle, 80h
		jmp	loc_1607E
; ---------------------------------------------------------------------------

loc_15FF3:
		cmp	_boss_phase_frame, 47
		jnz	short loc_16007
		sub	word_25662, 400h
		mov	_bullet_template.BT_angle, 10h
		jmp	short loc_1607E
; ---------------------------------------------------------------------------

loc_16007:
		cmp	_boss_phase_frame, 63
		jnz	short loc_1601B
		add	word_25662, 400h
		mov	_bullet_template.BT_angle, 70h
		jmp	short loc_1607E
; ---------------------------------------------------------------------------

loc_1601B:
		cmp	_boss_phase_frame, 79
		jnz	short loc_1602F
		sub	word_25662, 400h
		mov	_bullet_template.BT_angle, 20h
		jmp	short loc_1607E
; ---------------------------------------------------------------------------

loc_1602F:
		cmp	_boss_phase_frame, 95
		jnz	short loc_16043
		add	word_25662, 400h
		mov	_bullet_template.BT_angle, 60h
		jmp	short loc_1607E
; ---------------------------------------------------------------------------

loc_16043:
		cmp	_boss_phase_frame, 111
		jnz	short loc_16057
		sub	word_25662, 400h
		mov	_bullet_template.BT_angle, 30h
		jmp	short loc_1607E
; ---------------------------------------------------------------------------

loc_16057:
		cmp	_boss_phase_frame, 127
		jnz	short loc_1606B
		add	word_25662, 400h
		mov	_bullet_template.BT_angle, 50h
		jmp	short loc_1607E
; ---------------------------------------------------------------------------

loc_1606B:
		cmp	_boss_phase_frame, 140
		jnz	short loc_1607E
		mov	_boss_mode, 0FFh
		mov	_boss_phase_frame, 0

loc_1607E:
		mov	ax, _boss_phase_frame
		mov	bx, 16
		cwd
		idiv	bx
		cmp	dx, 15
		jnz	short loc_160A3
		mov	ax, word_25662
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_bullet_template.BT_origin.y, ax
		call	fp_2D000
		call	snd_se_play pascal, 3

loc_160A3:
		pop	bp
		retn
sub_15F97	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_160A5	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 1
		jnz	short loc_160DC
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE
		mov	_bullet_template.pattern, BP_RING
		mov	al, _rank
		inc	al
		mov	_bullet_template.count, al
		mov	_bullet_template.speed, (4 shl 4)
		mov	byte_25664, 1
		mov	byte_25665, 0
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_160DC:
		cmp	_boss_phase_frame, 128
		jge	short loc_160F4
		cmp	byte_25665, 10h
		jb	loc_1617E
		mov	al, _bullet_template.BT_angle
		add	al, 7
		jmp	short loc_16164
; ---------------------------------------------------------------------------

loc_160F4:
		cmp	_boss_phase_frame, 128
		jnz	short loc_16150
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_CROSS_YELLOW
		mov	_bullet_template.BT_angle, 80h
		mov	_bullet_template.speed, (1 shl 4)
		mov	_bullet_template.BT_special_motion, 82h
		mov	byte_2CFF7, 1
		mov	_bullet_template.count, 32
		call	fp_2D004
		call	sub_1CFB5
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.speed, (4 shl 4)
		mov	al, _rank
		inc	al
		mov	_bullet_template.count, al
		mov	byte_25664, 1
		mov	byte_25665, 0
		call	snd_se_play pascal, 9
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_16150:
		cmp	_boss_phase_frame, 256
		jge	short loc_16187
		cmp	byte_25665, 10h
		jb	short loc_1617E
		mov	al, _bullet_template.BT_angle
		add	al, -7

loc_16164:
		mov	_bullet_template.BT_angle, al
		call	fp_2D000
		call	snd_se_play pascal, 3
		inc	byte_25664
		mov	al, byte_25665
		add	al, -10h
		mov	byte_25665, al

loc_1617E:
		mov	al, byte_25664
		add	byte_25665, al
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_16187:
		cmp	_boss_phase_frame, 256
		jnz	short loc_161C2
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_CROSS_YELLOW
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.speed, (1 shl 4)
		mov	_bullet_template.BT_special_motion, 82h
		mov	byte_2CFF7, 1
		mov	_bullet_template.count, 32
		call	fp_2D004
		call	sub_1CFB5
		call	snd_se_play pascal, 9
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_161C2:
		cmp	_boss_phase_frame, 288
		jnz	short loc_161D5
		mov	_boss_mode, 0FFh
		mov	_boss_phase_frame, 0

loc_161D5:
		pop	bp
		retn
sub_160A5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_161D7	proc near

var_2		= word ptr -2

		enter	2, 0
		mov	ax, _boss_phase_frame
		mov	[bp+var_2], ax
		mov	cx, 4		; switch 4 cases
		mov	bx, offset word_16293

loc_161E7:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_161F6
		add	bx, 2
		loop	loc_161E7
		jmp	short loc_1626B	; default
; ---------------------------------------------------------------------------

loc_161F6:
		jmp	word ptr cs:[bx+8] ; switch jump

loc_161FA:
		mov	ax, _bullet_template.BT_origin.x ; jumptable 000161F6 case 1
		mov	point_2A8C6.x, ax
		mov	ax, _bullet_template.BT_origin.y
		mov	point_2A8C6.y, ax
		mov	word_2A8D0, 20h	; ' '
		mov	byte_2A8D2, 0Bh
		mov	word_2A8CE, 1000h
		mov	byte_2A8D3, 3

loc_1621C:
		call	sub_13B21	; jumptable 000161F6 case 5
		jmp	short loc_1626B	; default
; ---------------------------------------------------------------------------

loc_16221:
		mov	byte_2A8D2, 0Ah	; jumptable 000161F6 case 3
		jmp	short loc_1621C	; jumptable 000161F6 case 5
; ---------------------------------------------------------------------------

loc_16228:
		call	circles_add_shrinking pascal, _bullet_template.BT_origin.x, _bullet_template.BT_origin.y
		mov	_circles_color, 0Fh
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.speed, (1 shl 4)
		mov	_bullet_template.BT_special_motion, 87h
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 7
		mov	_bullet_template.BT_delta.spread_angle, 8
		mov	_bullet_template.patnum, PAT_BULLET16_N_CROSS_YELLOW
		mov	_bullet_template.speed, (2 shl 4)
		call	fp_2D004
		mov	byte_2CFF7, 1

loc_1626B:
		cmp	_boss_phase_frame, 32 ; default
		jl	short locret_16290
		mov	ax, _boss_phase_frame
		mov	bx, 16
		cwd
		idiv	bx
		or	dx, dx
		jnz	short locret_16290
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		call	fp_2D002
		call	snd_se_play pascal, 9

locret_16290:
		leave
		retn
sub_161D7	endp

; ---------------------------------------------------------------------------
		db 0
word_16293	dw	1,     3,     5,   11h
					; value	table for switch statement
		dw offset loc_161FA	; jump table for switch	statement
		dw offset loc_16221
		dw offset loc_1621C
		dw offset loc_16228

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_162A3	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 1
		jnz	short loc_162D7
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_CROSS_YELLOW
		mov	_bullet_template.pattern, BP_RING_AIMED
		mov	_bullet_template.BT_delta.spread_angle, 6
		mov	_bullet_template.speed, (1 shl 4)
		mov	_bullet_template.BT_special_motion, 82h
		mov	_bullet_template.count, 8
		mov	byte_2CFF7, 1
		jmp	short loc_162EA
; ---------------------------------------------------------------------------

loc_162D7:
		cmp	_boss_phase_frame, 170
		jnz	short loc_162EA
		mov	_boss_mode, 0FFh
		mov	_boss_phase_frame, 0

loc_162EA:
		mov	ax, _boss_phase_frame
		mov	bx, 16
		cwd
		idiv	bx
		cmp	dx, 15
		jnz	short loc_1630B
		call	fp_2D002
		mov	al, _bullet_template.count
		add	al, 3
		mov	_bullet_template.count, al
		call	snd_se_play pascal, 3

loc_1630B:
		pop	bp
		retn
sub_162A3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1630D	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 1
		jnz	short loc_16353
		mov	ax, _player_pos.cur.y
		sub	ax, _bullet_template.BT_origin.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, _bullet_template.BT_origin.x
		push	ax
		call	iatan2
		mov	_bullet_template.BT_angle, al

loc_1632F:
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 5
		mov	_bullet_template.BT_delta.spread_angle, 42h
		mov	_bullet_template.speed, (5 shl 4)
		call	fp_2D004
		jmp	short loc_16366
; ---------------------------------------------------------------------------

loc_16353:
		cmp	_boss_phase_frame, 128
		jnz	short loc_16366
		mov	_boss_mode, 0FFh
		mov	_boss_phase_frame, 0

loc_16366:
		mov	ax, _boss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		cmp	dx, 7
		jnz	short loc_16387
		mov	al, _bullet_template.BT_delta.spread_angle
		add	al, -4
		mov	_bullet_template.BT_delta.spread_angle, al
		call	fp_2D000
		call	snd_se_play pascal, 3

loc_16387:
		pop	bp
		retn
sub_1630D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_16389	proc near

var_2		= word ptr -2

		enter	2, 0
		mov	ax, _boss_phase_frame
		mov	[bp+var_2], ax
		mov	cx, 14h		; switch 20 cases
		mov	bx, offset word_164ED

loc_16399:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_163A9
		add	bx, 2
		loop	loc_16399
		jmp	loc_16437	; default
; ---------------------------------------------------------------------------

loc_163A9:
		jmp	word ptr cs:[bx+28h] ; switch jump

loc_163AD:
		mov	byte_2A8D3, 3	; jumptable 000163A9 case 16
		jmp	loc_16437	; default
; ---------------------------------------------------------------------------

loc_163B5:
		mov	_bullet_template.BT_angle, 0	; jumptable 000163A9 case 48
		call	snd_se_play pascal, 8
		mov	byte_25666, 64h	; 'd'

loc_163C6:
		mov	_circles_color, 0Fh	; jumptable 000163A9 cases 56,64,72,80
		call	circles_add_shrinking pascal, _bullet_template.BT_origin.x, _bullet_template.BT_origin.y

loc_163D8:
		mov	al, byte_2A8D3	; jumptable 000163A9 case 40
		neg	al
		mov	byte_2A8D3, al
		mov	ax, _bullet_template.BT_origin.x
		mov	point_2A8C6.x, ax
		mov	ax, _bullet_template.BT_origin.y
		mov	point_2A8C6.y, ax
		mov	word_2A8D0, 8
		mov	byte_2A8D2, 9
		mov	word_2A8CE, 1000h

loc_163FD:
		call	sub_13B21	; jumptable 000163A9 cases 44,52,60,68,76,84
		jmp	short loc_16437	; default
; ---------------------------------------------------------------------------

loc_16402:
		mov	byte_2A8D2, 8	; jumptable 000163A9 cases 42,50,58,66,74,82
		jmp	short loc_163FD	; jumptable 000163A9 cases 44,52,60,68,76,84
; ---------------------------------------------------------------------------

loc_16409:
		mov	ax, _bullet_template.BT_origin.x ; jumptable 000163A9 case 96
		mov	point_2561A.x, ax
		mov	ax, _bullet_template.BT_origin.y
		mov	point_2561A.y, ax
		mov	al, byte_2D01E
		mov	ah, 0
		mov	word_2562A, ax
		mov	word_2562E, 6
		mov	word_25624, 20h	; ' '
		mov	word_25626, 90h
		mov	byte_25628, 8
		call	sub_15DBD

loc_16437:
		cmp	_boss_phase_frame, 128 ; default
		jl	locret_164EB
		cmp	_boss_phase_frame, 160
		jg	short loc_16453
		mov	al, byte_25666
		add	al, 2
		mov	byte_25666, al
		jmp	short loc_16469
; ---------------------------------------------------------------------------

loc_16453:
		cmp	byte_25666, 64h	; 'd'
		jbe	short loc_16476
		mov	al, byte ptr _boss_phase_frame
		and	al, 1
		mov	dl, byte_25666
		sub	dl, al
		mov	byte_25666, dl

loc_16469:
		mov	al, byte_25666
		mov	ah, 0
		mov	PaletteTone, ax
		mov	_palette_changed, 1

loc_16476:
		cmp	_boss_phase_frame, 128
		jl	short locret_164EB
		mov	ax, _boss_phase_frame
		mov	bx, 32
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_164BB
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 32
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE
		mov	_bullet_template.speed, (4 shl 4) + 8
		call	fp_2D004
		call	fp_2D000
		mov	al, _bullet_template.BT_angle
		add	al, 2
		mov	_bullet_template.BT_angle, al
		call	snd_se_play pascal, 9

loc_164BB:
		cmp	_boss_phase_frame, 192
		jl	short locret_164EB
		cmp	_stage_frame_mod2, 0
		jz	short locret_164EB
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.pattern, BP_RANDOM_ANGLE
		mov	_bullet_template.patnum, PAT_BULLET16_N_OUTLINED_BALL_BLUE
		mov	_bullet_template.speed, (2 shl 4)
		mov	_bullet_template.count, 2
		call	fp_2D004
		call	fp_2D000

locret_164EB:
		leave
		retn
sub_16389	endp

; ---------------------------------------------------------------------------
word_164ED	dw    10h,   28h,   2Ah,   2Ch
		dw    30h,   32h,   34h,   38h ; value table for switch	statement
		dw    3Ah,   3Ch,   40h,   42h
		dw    44h,   48h,   4Ah,   4Ch
		dw    50h,   52h,   54h,   60h
		dw offset loc_163AD	; jump table for switch	statement
		dw offset loc_163D8
		dw offset loc_16402
		dw offset loc_163FD
		dw offset loc_163B5
		dw offset loc_16402
		dw offset loc_163FD
		dw offset loc_163C6
		dw offset loc_16402
		dw offset loc_163FD
		dw offset loc_163C6
		dw offset loc_16402
		dw offset loc_163FD
		dw offset loc_163C6
		dw offset loc_16402
		dw offset loc_163FD
		dw offset loc_163C6
		dw offset loc_16402
		dw offset loc_163FD
		dw offset loc_16409

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1653D	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 48
		jnz	short loc_1656A
		call	circles_add_shrinking pascal, _bullet_template.BT_origin.x, _bullet_template.BT_origin.y
		mov	_circles_color, 0Fh
		mov	_boss_angle, 16
		mov	byte_2D02D, 10h
		mov	_bullet_template.BT_special_motion, 0FFh
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1656A:
		cmp	_boss_phase_frame, 64
		jl	loc_1660E
		mov	ax, _boss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_1660E
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.count, 5
		mov	_bullet_template.BT_delta.spread_angle, 1
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.speed, (2 shl 4) + 8
		call	fp_2D004
		add	_bullet_template.BT_origin.x, (32 shl 4)
		mov	al, _boss_angle
		mov	_bullet_template.BT_angle, al
		call	fp_2D002
		sub	_bullet_template.BT_origin.x, (64 shl 4)
		mov	al, 80h
		sub	al, _boss_angle
		mov	_bullet_template.BT_angle, al
		call	fp_2D002
		mov	al, _boss_angle
		add	al, -16
		mov	_boss_angle, al
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.count, 3
		mov	_bullet_template.speed, (1 shl 4) + 8
		call	fp_2D004
		mov	al, byte_2D02D
		mov	_bullet_template.BT_angle, al
		call	fp_2D002
		add	_bullet_template.BT_origin.x, (64 shl 4)
		mov	al, 80h
		sub	al, byte_2D02D
		mov	_bullet_template.BT_angle, al
		call	fp_2D002
		mov	al, byte_2D02D
		add	al, 9
		mov	byte_2D02D, al
		call	snd_se_play pascal, 3

loc_1660E:
		pop	bp
		retn
sub_1653D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

yuuka5_update	proc far

var_4		= word ptr -4
var_2		= word ptr -2

		enter	4, 0
		mov	ax, _boss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		add	ax, (16 shl 4)
		mov	_bullet_template.BT_origin.y, ax
		mov	al, _boss_phase
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 12h
		ja	loc_169B3
		add	bx, bx
		jmp	cs:off_169F4[bx]

loc_16638:
		cmp	_boss_phase_frame, 0
		jnz	short loc_16651
		setfarfp	_stage_vm, nullsub_2
		mov	_midboss_frames_until, 0

loc_16651:
		call	sub_1E67C
		cmp	_boss_phase_frame, 128
		jle	loc_169B8
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		call	snd_se_play pascal, 13
		mov	byte_25667, 0
		mov	byte_2CDCA, 0Fh
		mov	fp_255AC, offset yuuka5_bg_render
		jmp	loc_169B8
; ---------------------------------------------------------------------------

loc_16682:
		call	sub_1E67C
		cmp	_boss_phase_frame, 32
		jnz	short loc_166A0
		mov	Palettes, 40h
		mov	Palettes+1, 40h
		mov	Palettes+2, 40h
		mov	_palette_changed, 1

loc_166A0:
		cmp	_boss_phase_frame, 64
		jl	loc_169B8
		inc	_boss_phase
		mov	_boss_pos.velocity.x, 0
		mov	_boss_mode_change, 0
		mov	_boss_mode, 0
		mov	_boss_hp, 9000
		mov	_boss_phase_end_hp, 7900
		mov	_boss_phase_frame, 0
		sub	_boss_pos.cur.y, (16 shl 4)
		jmp	loc_169B8
; ---------------------------------------------------------------------------

loc_166D8:
		mov	al, _boss_mode
		mov	ah, 0
		mov	[bp+var_2], ax
		mov	cx, 4		; switch 4 cases
		mov	bx, offset word_169E4

loc_166E6:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_166F5
		add	bx, 2
		loop	loc_166E6
		jmp	short loc_16723	; default
; ---------------------------------------------------------------------------

loc_166F5:
		jmp	word ptr cs:[bx+8] ; switch jump

loc_166F9:
		call	sub_15F97	; jumptable 000166F5 case 0
		jmp	short loc_16723	; default
; ---------------------------------------------------------------------------

loc_166FE:
		call	sub_160A5	; jumptable 000166F5 case 1
		jmp	short loc_16723	; default
; ---------------------------------------------------------------------------

loc_16703:
		mov	_boss_phase_frame, 0	; jumptable 000166F5 case 254
		inc	_boss_mode_change
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	bx, 2
		cwd
		idiv	bx
		mov	_boss_mode, dl
		jmp	short loc_16723	; default
; ---------------------------------------------------------------------------

loc_1671E:
		push	0		; jumptable 000166F5 case 255
		call	sub_15ECE

loc_16723:
		cmp	byte_25667, 0	; default
		jnz	short loc_16766
		cmp	_boss_mode_change, 4
		jnb	short loc_16742
		call	sub_1E64E
		or	al, al
		jz	loc_169B8
		push	0Fh
		call	sub_19FD8
		call	sub_1E692

loc_16742:
		cmp	_bullet_clear_time, 20
		jnb	short loc_1674E
		mov	_bullet_clear_time, 20

loc_1674E:
		call	boss_explode_small pascal, 0
		inc	_boss_phase
		mov	ax, _boss_phase_end_hp
		mov	_boss_hp, ax
		sub	_boss_phase_end_hp, 800
		jmp	loc_169B8
; ---------------------------------------------------------------------------

loc_16766:
		inc	_boss_phase_frame
		jmp	loc_169B8
; ---------------------------------------------------------------------------

loc_1676D:
		inc	_boss_phase_frame
		push	1
		call	sub_15ECE
		or	al, al
		jz	loc_169B8
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		mov	_boss_mode_change, 0
		mov	_boss_mode, 0
		jmp	loc_169B8
; ---------------------------------------------------------------------------

loc_16793:
		call	sub_161D7
		cmp	_boss_phase_frame, 500
		jge	short loc_167AF
		call	sub_1E64E
		or	al, al
		jz	loc_169B8
		push	0Fh
		call	sub_19FD8
		call	sub_1E692

loc_167AF:
		cmp	_bullet_clear_time, 20
		jnb	short loc_167BB
		mov	_bullet_clear_time, 20

loc_167BB:
		call	boss_explode_small pascal, 1
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		mov	_boss_mode_change, 0
		mov	_boss_mode, 0
		mov	ax, _boss_phase_end_hp
		mov	_boss_hp, ax
		cmp	_boss_phase, 0Ah
		jnb	short loc_167EA
		sub	_boss_phase_end_hp, 1100
		jmp	loc_169B8
; ---------------------------------------------------------------------------

loc_167EA:
		sub	_boss_phase_end_hp, 1200
		jmp	loc_169B8
; ---------------------------------------------------------------------------

loc_167F3:
		mov	al, _boss_mode
		mov	ah, 0
		mov	[bp+var_4], ax
		mov	cx, 4		; switch 4 cases
		mov	bx, offset word_169D4

loc_16801:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_4]
		jz	short loc_16810
		add	bx, 2
		loop	loc_16801
		jmp	short loc_1683E	; default
; ---------------------------------------------------------------------------

loc_16810:
		jmp	word ptr cs:[bx+8] ; switch jump

loc_16814:
		call	sub_162A3	; jumptable 00016810 case 0
		jmp	short loc_1683E	; default
; ---------------------------------------------------------------------------

loc_16819:
		call	sub_1630D	; jumptable 00016810 case 1
		jmp	short loc_1683E	; default
; ---------------------------------------------------------------------------

loc_1681E:
		mov	_boss_phase_frame, 0	; jumptable 00016810 case 254
		inc	_boss_mode_change
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	bx, 2
		cwd
		idiv	bx
		mov	_boss_mode, dl
		jmp	short loc_1683E	; default
; ---------------------------------------------------------------------------

loc_16839:
		push	0		; jumptable 00016810 case 255
		call	sub_15ECE

loc_1683E:
		cmp	byte_25667, 0	; default
		jnz	short loc_1687B
		cmp	_boss_mode_change, 4
		jnb	short loc_1685D
		call	sub_1E64E
		or	al, al
		jz	loc_169B8
		push	0Fh
		call	sub_19FD8
		call	sub_1E692

loc_1685D:
		cmp	_bullet_clear_time, 20
		jnb	short loc_16869
		mov	_bullet_clear_time, 20

loc_16869:
		call	boss_explode_small pascal, 0
		inc	_boss_phase
		mov	ax, _boss_phase_end_hp
		mov	_boss_hp, ax
		jmp	loc_169B8
; ---------------------------------------------------------------------------

loc_1687B:
		inc	_boss_phase_frame
		jmp	loc_169B8
; ---------------------------------------------------------------------------

loc_16882:
		inc	_boss_phase_frame
		push	1
		call	sub_15ECE
		or	al, al
		jz	loc_169B8
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		mov	_boss_mode_change, 0
		mov	_boss_mode, 0
		jmp	loc_169B8
; ---------------------------------------------------------------------------

loc_168A8:
		call	sub_16389
		call	sub_1E67C
		cmp	_boss_phase_frame, 288
		jl	loc_169B8
		call	boss_explode_small pascal, 4
		cmp	_bullet_clear_time, 20
		jnb	short loc_168C9
		mov	_bullet_clear_time, 20

loc_168C9:
		inc	_boss_phase
		mov	ax, _boss_phase_end_hp
		mov	_boss_hp, ax
		cmp	_boss_phase, 11h
		jnz	short loc_168F6
		mov	_boss_phase_end_hp, 0
		mov	Palettes, 80h
		mov	Palettes+1, 40h
		mov	Palettes+2, 40h
		mov	_palette_changed, 1
		jmp	short loc_168FC
; ---------------------------------------------------------------------------

loc_168F6:
		sub	_boss_phase_end_hp, 1200

loc_168FC:
		mov	_boss_phase_frame, 0
		mov	_boss_mode_change, 0

loc_16907:
		mov	_boss_mode, 0
		mov	PaletteTone, 100
		mov	_palette_changed, 1
		jmp	loc_169B8
; ---------------------------------------------------------------------------

loc_1691A:
		call	sub_1653D
		call	sub_1E64E
		or	al, al
		jnz	short loc_1692E
		cmp	_boss_phase_frame, 1000
		jl	loc_169B8

loc_1692E:
		call	boss_explode_small pascal, 1
		inc	_boss_phase
		cmp	_boss_phase_frame, 1000
		jge	short loc_16946
		mov	_boss_mode_change, 1
		jmp	short loc_1694B
; ---------------------------------------------------------------------------

loc_16946:
		mov	_boss_mode_change, 0

loc_1694B:
		mov	_boss_phase_frame, 0
		jmp	short loc_16907
; ---------------------------------------------------------------------------

loc_16953:
		inc	_boss_phase_frame
		cmp	_boss_phase_frame, 16
		jnz	short loc_16963
		call	boss_explode_small pascal, 4

loc_16963:
		cmp	_boss_phase_frame, 32
		jnz	short loc_169B8
		call	boss_explode_big pascal, 2
		mov	_boss_phase, PHASE_EXPLODE_BIG
		mov	al, _boss_mode_change
		mov	_bullet_clear_trigger, al
		cmp	_boss_mode_change, 0
		jz	short loc_16986
		push	3Ch ; '<'
		call	sub_19FD8

loc_16986:
		mov	_boss_sprite, 4
		mov	_boss_phase_frame, 0
		call	snd_se_play pascal, 12
		mov	Palettes, 0
		mov	Palettes+1, 0
		mov	Palettes+2, 0
		mov	_palette_changed, 1
		mov	_player_invincibility_time, BOSS_DEFEAT_INVINCIBILITY_FRAMES
		jmp	short loc_169B8
; ---------------------------------------------------------------------------

loc_169B3:
		call	sub_1E743
		leave
		retf
; ---------------------------------------------------------------------------

loc_169B8:
		mov	ax, _boss_pos.cur.x
		mov	_homing_target.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_homing_target.y, ax
		call	sub_15DE8
		push	_boss_hp
		push	9000
		call	sub_19F16
		leave
		retf
yuuka5_update	endp

; ---------------------------------------------------------------------------
		db 0
word_169D4	dw	0,     1,  0FEh,  0FFh
					; value	table for switch statement
		dw offset loc_16814	; jump table for switch	statement
		dw offset loc_16819
		dw offset loc_1681E
		dw offset loc_16839
word_169E4	dw	0,     1,  0FEh,  0FFh
					; value	table for switch statement
		dw offset loc_166F9	; jump table for switch	statement
		dw offset loc_166FE
		dw offset loc_16703
		dw offset loc_1671E
off_169F4	dw offset loc_16638
		dw offset loc_16682
		dw offset loc_166D8
		dw offset loc_1676D
		dw offset loc_16793
		dw offset loc_166D8
		dw offset loc_1676D
		dw offset loc_16793
		dw offset loc_166D8
		dw offset loc_1676D
		dw offset loc_16793
		dw offset loc_167F3
		dw offset loc_16882
		dw offset loc_168A8
		dw offset loc_167F3
		dw offset loc_16882
		dw offset loc_168A8
		dw offset loc_1691A
		dw offset loc_16953

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_16A1A	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_mode, 1
		jb	short loc_16A71
		cmp	_boss_mode, 6
		ja	short loc_16A71
		mov	ax, _boss_phase_frame
		cmp	ax, 32
		jz	short loc_16A3F
		cmp	ax, 34
		jz	short loc_16A69
		cmp	ax, 36
		jz	short loc_16A6E
		jmp	short loc_16A71
; ---------------------------------------------------------------------------

loc_16A3F:
		mov	ax, _boss_pos.cur.x
		add	ax, (-20 shl 4)
		mov	point_2A8C6.x, ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-8 shl 4)
		mov	point_2A8C6.y, ax
		mov	word_2A8D0, 10h
		mov	byte_2A8D3, 0FEh
		mov	byte_2A8D2, 3
		mov	word_2A8CE, 1000h
		jmp	short loc_16A6E
; ---------------------------------------------------------------------------

loc_16A69:
		mov	byte_2A8D2, 2

loc_16A6E:
		call	sub_13B21

loc_16A71:
		cmp	_boss_phase_frame, 16
		jnz	short loc_16A86
		mov	_boss_sprite, 130
		call	snd_se_play pascal, 8
		jmp	short loc_16ADA
; ---------------------------------------------------------------------------

loc_16A86:
		cmp	_boss_phase_frame, 30
		jnz	short loc_16AA2
		mov	ax, _boss_pos.cur.x
		add	ax, (-20 shl 4)
		push	ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-8 shl 4)
		push	ax
		call	circles_add_shrinking
		jmp	short loc_16ADA
; ---------------------------------------------------------------------------

loc_16AA2:
		cmp	_boss_phase_frame, 44
		jl	short loc_16AC3
		cmp	_boss_phase_frame, 64
		jge	short loc_16AC3
		mov	ax, _boss_phase_frame
		add	ax, -32
		mov	bx, 4
		cwd
		idiv	bx
		add	al, 128
		mov	_boss_sprite, al
		jmp	short loc_16ADA
; ---------------------------------------------------------------------------

loc_16AC3:
		cmp	_boss_phase_frame, 64
		jnz	short loc_16ADA
		mov	_boss_sprite, 130
		call	snd_se_play pascal, 15
		mov	al, 2
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_16ADA:
		cmp	_boss_phase_frame, 64
		jge	short loc_16AE5
		mov	al, 0
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_16AE5:
		mov	al, 1
		pop	bp
		retn
sub_16A1A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_16AE9	proc near

var_1		= byte ptr -1

		enter	2, 0
		mov	ax, _boss_phase_frame
		and	ax, 1Fh
		cmp	ax, 1
		jnz	loc_16B7D
		cmp	_boss_pos.cur.x, (112 shl 4)
		jg	short loc_16B0A
		mov	_boss_pos.velocity.x, (2 shl 4)
		jmp	short loc_16B2E
; ---------------------------------------------------------------------------

loc_16B0A:
		cmp	_boss_pos.cur.x, (272 shl 4)
		jl	short loc_16B1A
		mov	_boss_pos.velocity.x, (-2 shl 4)
		jmp	short loc_16B2E
; ---------------------------------------------------------------------------

loc_16B1A:
		push	1
		call	randring2_next16_and
		or	ax, ax
		jz	short loc_16B28
		mov	ax, (1 shl 4)
		jmp	short loc_16B2B
; ---------------------------------------------------------------------------

loc_16B28:
		mov	ax, (-1 shl 4)

loc_16B2B:
		mov	_boss_pos.velocity.x, ax

loc_16B2E:
		cmp	_boss_pos.cur.y, (80 shl 4)
		jg	short loc_16B3E
		mov	_boss_pos.velocity.y, (1 shl 4)
		jmp	short loc_16B7D
; ---------------------------------------------------------------------------

loc_16B3E:
		cmp	_boss_pos.cur.y, (144 shl 4)
		jl	short loc_16B4E
		mov	_boss_pos.velocity.y, (-1 shl 4)
		jmp	short loc_16B7D
; ---------------------------------------------------------------------------

loc_16B4E:
		push	3

loc_16B50:
		call	randring2_next16_and	; jumptable 0001EA6B case 7819
		mov	[bp+var_1], al
		cmp	[bp+var_1], 0
		jnz	short loc_16B61
		mov	ax, (1 shl 4)
		jmp	short loc_16B7A
; ---------------------------------------------------------------------------

loc_16B61:
		cmp	[bp+var_1], 1
		jnz	short loc_16B6C
		mov	ax, (-1 shl 4)
		jmp	short loc_16B7A
; ---------------------------------------------------------------------------

loc_16B6C:
		cmp	[bp+var_1], 2
		jnz	short loc_16B77
		mov	ax, 24
		jmp	short loc_16B7A
; ---------------------------------------------------------------------------

loc_16B77:
		mov	ax, -24

loc_16B7A:
		mov	_boss_pos.velocity.y, ax

loc_16B7D:
		push	offset _boss_pos
		call	_motion_update_2
		leave
		retn
sub_16AE9	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_16B85	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_0]
		cmp	byte_2D02B, 0
		jnz	short loc_16BC5
		mov	ax, si
		cwd
		sub	ax, dx
		sar	ax, 1
		add	ax, 0FFFAh
		push	ax
		mov	ax, (192 shl 4)
		sub	ax, _boss_pos.cur.x
		cwd
		pop	bx
		idiv	bx
		mov	_boss_pos.velocity.x, ax
		mov	ax, si
		cwd
		sub	ax, dx
		sar	ax, 1
		add	ax, 0FFFAh
		push	ax
		mov	ax, (112 shl 4)
		sub	ax, _boss_pos.cur.y
		cwd
		pop	bx
		idiv	bx
		mov	_boss_pos.velocity.y, ax

loc_16BC5:
		inc	byte_2D02B
		mov	al, byte_2D02B
		mov	ah, 0
		lea	dx, [si-0Ch]
		cmp	ax, dx
		jl	short loc_16BEB
		mov	ax, _boss_pos.velocity.x
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	_boss_pos.velocity.x, ax
		mov	ax, _boss_pos.velocity.y
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	_boss_pos.velocity.y, ax

loc_16BEB:
		mov	al, byte_2D02B
		mov	ah, 0
		cmp	ax, si
		jl	short loc_16BF8
		mov	al, 1
		jmp	short loc_16C00
; ---------------------------------------------------------------------------

loc_16BF8:
		push	offset _boss_pos
		call	_motion_update_2
		mov	al, 0

loc_16C00:
		pop	si
		pop	bp
		retn	2
sub_16B85	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_16C05	proc near

var_A		= byte ptr -0Ah
var_1		= byte ptr -1

		enter	0Ah, 0
		push	si
		push	di
		lea	ax, [bp+var_A]
		push	ss
		push	ax
		push	ds
		push	offset unk_22D9E
		mov	cx, 8
		call	SCOPY@
		call	randring2_next16
		mov	[bp+var_1], al
		mov	si, 0B204h
		xor	di, di
		jmp	short loc_16C61
; ---------------------------------------------------------------------------

loc_16C29:
		mov	byte ptr [si], 1
		mov	al, byte_25671
		mov	[si+19h], al
		mov	al, [bp+var_1]
		mov	[si+1],	al
		add	al, 40h
		mov	[bp+var_1], al
		lea	ax, [di+88h]
		mov	[si+6],	ax
		mov	word ptr [si+10h], 0
		mov	bx, di
		add	bx, bx
		lea	ax, [bp+var_A]
		add	bx, ax
		mov	ax, ss:[bx]
		mov	[si+14h], ax
		mov	word ptr [si+12h], 20h ; ' '
		inc	di
		add	si, 1Ah

loc_16C61:
		cmp	di, 4
		jl	short loc_16C29
		pop	di
		pop	si
		leave
		retn
sub_16C05	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_16C6A	proc near

var_4		= word ptr -4
var_2		= word ptr -2

		enter	4, 0
		push	si
		push	di
		mov	byte_25672, 0
		mov	si, 0B204h
		mov	[bp+var_2], 0
		jmp	loc_16DCB
; ---------------------------------------------------------------------------

loc_16C80:
		cmp	byte ptr [si], 0
		jz	loc_16DC5
		cmp	byte ptr [si], 80h
		jb	short loc_16CB4
		mov	al, [si]
		inc	al
		mov	[si], al
		mov	ah, 0
		mov	di, ax
		add	ax, 0FF80h
		mov	bx, 4
		cwd
		idiv	bx
		add	ax, 4
		mov	di, ax
		mov	[si+6],	di
		cmp	di, 0Ch
		jl	loc_16DC5
		mov	byte ptr [si], 0
		jmp	loc_16DC5
; ---------------------------------------------------------------------------

loc_16CB4:
		mov	al, [si+19h]
		add	[si+1],	al
		mov	ax, [si+12h]
		add	[si+10h], ax
		lea	ax, [si+2]
		push	ax
		push	_boss_pos.cur.x
		push	_boss_pos.cur.y
		push	word ptr [si+10h]
		mov	al, [si+1]
		mov	ah, 0
		push	ax
		call	vector2_at
		cmp	byte ptr [si], 1
		jnz	short loc_16CEF
		cmp	word ptr [si+10h], 400h
		jl	short loc_16CFC
		inc	byte ptr [si]
		mov	word ptr [si+12h], 0
		jmp	short loc_16CFC
; ---------------------------------------------------------------------------

loc_16CEF:
		cmp	byte ptr [si], 2
		jnz	short loc_16CFC
		cmp	word ptr [si+10h], 40h
		jl	short loc_16CFC
		inc	byte ptr [si]

loc_16CFC:
		mov	word_257E2, 0C0h
		mov	word_257E4, 0C0h
		mov	ax, [si+2]
		mov	word ptr dword_257DE, ax
		mov	ax, [si+4]
		mov	word ptr dword_257DE+2,	ax
		call	sub_105B9
		mov	[si+16h], ax
		mov	ax, [si+16h]
		sub	[si+14h], ax
		cmp	word ptr [si+14h], 0
		jg	short loc_16D53
		mov	word ptr [si+6], 4
		mov	byte ptr [si], 80h
		call	snd_se_play pascal, 3
		add	_score_delta, 5120
		push	word ptr [si+2]
		push	word ptr [si+4]
		push	large (((4 shl 4) shl 16) or 8)
		nopcall	sparks_add_random
		jmp	short loc_16DC5
; ---------------------------------------------------------------------------

loc_16D53:
		mov	ax, [si+2]
		add	ax, 0FF40h
		mov	di, ax
		mov	ax, [si+4]
		add	ax, 0FF40h
		mov	[bp+var_4], ax
		mov	ax, _player_pos.cur.x
		sub	ax, di
		cmp	ax, 180h
		jnb	short loc_16D7E
		mov	ax, _player_pos.cur.y
		sub	ax, [bp+var_4]
		cmp	ax, 180h
		jnb	short loc_16D7E
		mov	byte_259A9, 1

loc_16D7E:
		mov	ax, [si+4]
		cmp	ax, _homing_target.y
		jge	short loc_16D93
		mov	ax, [si+2]
		mov	_homing_target.x, ax
		mov	ax, [si+4]
		mov	_homing_target.y, ax

loc_16D93:
		mov	ax, [si+2]
		sar	ax, 4
		add	ax, 20h	; ' '
		mov	dl, byte_25672
		mov	dh, 0
		add	dx, dx
		mov	bx, dx
		mov	[bx+4338h], ax
		mov	ax, [si+4]
		sar	ax, 4
		add	ax, 10h
		mov	dl, byte_25672
		mov	dh, 0
		add	dx, dx
		mov	bx, dx
		mov	[bx+4340h], ax
		inc	byte_25672

loc_16DC5:
		inc	[bp+var_2]
		add	si, 1Ah

loc_16DCB:
		cmp	[bp+var_2], 4
		jl	loc_16C80
		pop	di
		pop	si
		leave
		retn
sub_16C6A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_16DD7	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	si, 0B204h
		xor	di, di
		jmp	short loc_16DF6
; ---------------------------------------------------------------------------

loc_16DE3:
		cmp	byte ptr [si], 0
		jz	short loc_16DF2
		cmp	byte ptr [si], 80h
		jnb	short loc_16DF2
		push	si
		call	fp_25676

loc_16DF2:
		inc	di
		add	si, 1Ah

loc_16DF6:
		cmp	di, 4
		jl	short loc_16DE3
		pop	di
		pop	si
		pop	bp
		retn
sub_16DD7	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_16DFF	proc near

var_1		= byte ptr -1

		enter	2, 0
		call	sub_16A1A
		mov	[bp+var_1], al
		cmp	[bp+var_1], 2
		jnz	short loc_16E2E
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.BT_angle, 80h
		mov	_bullet_template.BT_delta.spread_angle, 8
		call	fp_2D004
		leave
		retn
; ---------------------------------------------------------------------------

loc_16E2E:
		cmp	[bp+var_1], 1
		jnz	short locret_16E9B
		mov	ax, _boss_phase_frame
		mov	bx, 2
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_16E84
		call	randring2_next16_and pascal, 3
		inc	al
		mov	_bullet_template.count, al
		call	randring2_next16_and pascal, 1Fh
		add	al, (2 shl 4)
		mov	_bullet_template.speed, al
		mov	al, _bullet_template.BT_angle
		add	al, -8
		mov	_bullet_template.BT_angle, al
		sub	_bullet_template.BT_origin.x, (6 shl 4)
		call	fp_2D000
		call	randring2_next16_and pascal, 3
		inc	al
		mov	_bullet_template.count, al
		call	randring2_next16_and pascal, 1Fh
		add	al, (2 shl 4)
		mov	_bullet_template.speed, al
		add	_bullet_template.BT_origin.x, (12 shl 4)
		call	fp_2D000

loc_16E84:
		cmp	_bullet_template.BT_angle, 0
		jnz	short locret_16E9B
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh
		mov	_boss_sprite, 129

locret_16E9B:
		leave
		retn
sub_16DFF	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_16E9D	proc near

var_2		= word ptr -2

		enter	2, 0
		call	sub_16A1A
		mov	ax, _boss_phase_frame
		mov	[bp+var_2], ax
		mov	cx, 5		; switch 5 cases
		mov	bx, offset word_16F10

loc_16EB0:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_16EBF
		add	bx, 2
		loop	loc_16EB0
		jmp	short locret_16F0E ; default
; ---------------------------------------------------------------------------

loc_16EBF:
		jmp	word ptr cs:[bx+0Ah] ; switch jump

loc_16EC3:
		mov	ax, _boss_pos.cur.x ; jumptable 00016EBF case 32
		mov	point_2A8C6.x, ax
		mov	ax, _boss_pos.cur.y
		mov	point_2A8C6.y, ax
		mov	word_2A8D0, 20h	; ' '
		mov	byte_2A8D3, 0FEh
		mov	byte_2A8D2, 9
		mov	word_2A8CE, 1000h

loc_16EE5:
		call	sub_13B21	; jumptable 00016EBF case 36
		leave
		retn
; ---------------------------------------------------------------------------

loc_16EEA:
		mov	byte_2A8D2, 8	; jumptable 00016EBF case 34
		jmp	short loc_16EE5	; jumptable 00016EBF case 36
; ---------------------------------------------------------------------------

loc_16EF1:
		call	sub_16C05	; jumptable 00016EBF case 64
		mov	al, byte_25671
		neg	al
		mov	byte_25671, al
		leave
		retn
; ---------------------------------------------------------------------------

loc_16EFE:
		mov	_boss_phase_frame, 0	; jumptable 00016EBF case 96
		mov	_boss_mode, 0FFh
		mov	_boss_sprite, 129

locret_16F0E:
		leave			; default
		retn
sub_16E9D	endp

; ---------------------------------------------------------------------------
word_16F10	dw    20h,   22h,   24h,   40h
		dw    60h		; value	table for switch statement
		dw offset loc_16EC3	; jump table for switch	statement
		dw offset loc_16EEA
		dw offset loc_16EE5
		dw offset loc_16EF1
		dw offset loc_16EFE

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_16F24	proc near

@@angle		= byte ptr -1
arg_0		= word ptr  4

		enter	2, 0
		push	si
		mov	si, [bp+arg_0]
		cmp	byte_25672, 2
		ja	short loc_16F38
		mov	_bullet_template.count, 5

loc_16F38:
		cmp	byte ptr [si+19h], 0
		jl	short loc_16F42
		mov	al, -40h
		jmp	short loc_16F44
; ---------------------------------------------------------------------------

loc_16F42:
		mov	al, 40h

loc_16F44:
		mov	[bp+@@angle], al
		mov	al, [si+1]
		add	al, [bp+@@angle]
		mov	_bullet_template.BT_angle, al
		mov	eax, [si+2]
		mov	_bullet_template.BT_origin, eax
		call	fp_2D000
		pop	si
		leave
		retn	2
sub_16F24	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_16F61	proc near

var_1		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		call	sub_16A1A
		mov	[bp+var_1], al
		cmp	[bp+var_1], 2
		jnz	short loc_16F9F
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.speed, (3 shl 4) + 8
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 3
		mov	_bullet_template.BT_delta.spread_angle, 8
		call	fp_2D004
		mov	fp_25676, offset sub_16F24
		mov	al, byte ptr _boss_phase_frame
		mov	byte_2D02D, al
		jmp	loc_1705D
; ---------------------------------------------------------------------------

loc_16F9F:
		cmp	[bp+var_1], 1
		jnz	loc_1705D
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1702D
		cmp	byte_25672, 0
		jz	short loc_16FC6
		call	sub_16DD7
		mov	al, byte ptr _boss_phase_frame
		mov	byte_2D02D, al
		jmp	short loc_17026
; ---------------------------------------------------------------------------

loc_16FC6:
		mov	al, byte_2D02D
		mov	ah, 0
		mov	dx, 0A0h
		sub	dx, ax
		push	dx
		call	sub_16B85
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE
		mov	_bullet_template.speed, (3 shl 4) + 4
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 3
		mov	_bullet_template.BT_delta.spread_angle, 6
		mov	al, _bullet_template.BT_angle
		add	al, 6
		mov	_bullet_template.BT_angle, al
		call	fp_2D004
		call	fp_2D000
		mov	al, _bullet_template.BT_angle
		add	al, 40h
		mov	_bullet_template.BT_angle, al
		call	fp_2D000
		mov	al, _bullet_template.BT_angle
		add	al, 40h
		mov	_bullet_template.BT_angle, al
		call	fp_2D000
		mov	al, _bullet_template.BT_angle
		add	al, 40h
		mov	_bullet_template.BT_angle, al
		call	fp_2D000

loc_17026:
		call	snd_se_play pascal, 9

loc_1702D:
		cmp	_boss_phase_frame, 160
		jl	short loc_1705D
		mov	si, 0B204h
		xor	di, di
		jmp	short loc_17048
; ---------------------------------------------------------------------------

loc_1703C:
		mov	al, [si+19h]
		neg	al
		mov	[si+19h], al
		inc	di
		add	si, 1Ah

loc_17048:
		cmp	di, 4
		jl	short loc_1703C
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh
		mov	_boss_sprite, 129

loc_1705D:
		pop	di
		pop	si
		leave
		retn
sub_16F61	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_17061	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+4]
		mov	eax, [si+2]
		mov	_bullet_template.BT_origin, eax
		call	fp_2D000
		pop	si
		pop	bp
		retn	2
sub_17061	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_17079	proc near

var_1		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		call	sub_16A1A
		mov	[bp+var_1], al
		cmp	[bp+var_1], 2
		jnz	short loc_170C3
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.speed, (1 shl 4)
		mov	_bullet_template.pattern, BP_SINGLE
		call	fp_2D004
		mov	fp_25676, offset sub_17061
		mov	si, 0B204h
		xor	di, di
		jmp	short loc_170B5
; ---------------------------------------------------------------------------

loc_170AB:
		mov	al, [si+19h]
		add	[si+19h], al
		inc	di
		add	si, 1Ah

loc_170B5:
		cmp	di, 4
		jl	short loc_170AB
		mov	al, byte ptr _boss_phase_frame
		mov	byte_2D02D, al
		jmp	loc_17179
; ---------------------------------------------------------------------------

loc_170C3:
		cmp	[bp+var_1], 1
		jnz	loc_17179
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_17145
		mov	ax, _player_pos.cur.y
		sub	ax, _boss_pos.cur.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, _boss_pos.cur.x
		push	ax
		call	iatan2
		mov	_bullet_template.BT_angle, al
		cmp	byte_25672, 0
		jz	short loc_17102
		call	sub_16DD7
		mov	al, byte ptr _boss_phase_frame
		mov	byte_2D02D, al
		jmp	short loc_17136
; ---------------------------------------------------------------------------

loc_17102:
		mov	al, byte_2D02D
		mov	ah, 0
		mov	dx, 0A0h
		sub	dx, ax
		push	dx
		call	sub_16B85
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_STAR
		mov	_bullet_template.pattern, BP_SPREAD_AIMED
		mov	_bullet_template.count, 3
		mov	_bullet_template.BT_delta.spread_angle, 0Ch
		mov	_bullet_template.BT_angle, 0
		call	fp_2D004
		call	fp_2D000

loc_17136:
		mov	al, _bullet_template.speed
		add	al, 4
		mov	_bullet_template.speed, al
		call	snd_se_play pascal, 9

loc_17145:
		cmp	_boss_phase_frame, 160
		jl	short loc_17179
		mov	si, 0B204h
		xor	di, di
		jmp	short loc_17164
; ---------------------------------------------------------------------------

loc_17154:
		mov	al, [si+19h]
		cbw
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	[si+19h], al
		inc	di
		add	si, 1Ah

loc_17164:
		cmp	di, 4
		jl	short loc_17154
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh
		mov	_boss_sprite, 129

loc_17179:
		pop	di
		pop	si
		leave
		retn
sub_17079	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1717D	proc near

var_1		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		call	sub_16A1A
		mov	[bp+var_1], al
		cmp	[bp+var_1], 2
		jnz	short loc_171A2
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	fp_25676, offset sub_16F24
		mov	byte_2D02D, 0
		jmp	loc_17331
; ---------------------------------------------------------------------------

loc_171A2:
		cmp	[bp+var_1], 1
		jnz	loc_17331
		cmp	byte_25672, 0
		jz	loc_1726E
		cmp	_boss_phase_frame, 192
		jg	short loc_171D2
		mov	si, 0B204h
		xor	di, di
		jmp	short loc_171CA
; ---------------------------------------------------------------------------

loc_171C2:
		add	word ptr [si+10h], 18h
		inc	di
		add	si, 1Ah

loc_171CA:
		cmp	di, 4
		jl	short loc_171C2
		jmp	loc_17331
; ---------------------------------------------------------------------------

loc_171D2:
		cmp	_boss_phase_frame, 256
		jg	short loc_17232
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_17331
		mov	ax, _boss_phase_frame
		mov	bx, 32
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1720D
		mov	_bullet_template.speed, (2 shl 4)
		mov	_bullet_template.pattern, BP_RING_AIMED
		mov	_bullet_template.count, 16
		call	fp_2D004
		call	fp_2D000

loc_1720D:
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 3
		mov	_bullet_template.BT_delta.spread_angle, 6
		call	fp_2D004
		mov	_bullet_template.speed, (4 shl 4)
		call	snd_se_play pascal, 9
		call	sub_16DD7
		jmp	loc_17331
; ---------------------------------------------------------------------------

loc_17232:
		cmp	_boss_phase_frame, 384
		jg	short loc_17251
		mov	si, 0B204h
		xor	di, di
		jmp	short loc_17249
; ---------------------------------------------------------------------------

loc_17241:
		sub	word ptr [si+10h], 18h
		inc	di
		add	si, 1Ah

loc_17249:
		cmp	di, 4
		jl	short loc_17241
		jmp	loc_17331
; ---------------------------------------------------------------------------

loc_17251:
		mov	si, 0B204h
		xor	di, di
		jmp	short loc_17266
; ---------------------------------------------------------------------------

loc_17258:
		mov	al, [si+19h]
		neg	al
		mov	[si+19h], al
		add	di, 2
		add	si, 34h	; '4'

loc_17266:
		cmp	di, 4
		jl	short loc_17258
		jmp	loc_17318
; ---------------------------------------------------------------------------

loc_1726E:
		push	60h
		call	sub_16B85
		cmp	byte_2D02D, 0
		jnz	short loc_1729F
		mov	byte_2D02D, 1
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.BT_angle, 80h
		mov	_bullet_template.BT_delta.spread_angle, 8
		call	snd_se_play pascal, 15

loc_1729F:
		mov	ax, _boss_phase_frame
		mov	bx, 2
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_17331
		call	randring2_next16_and pascal, 3
		inc	al
		mov	_bullet_template.count, al
		call	randring2_next16_and pascal, 1Fh
		add	al, (1 shl 4)
		mov	_bullet_template.speed, al
		test	byte_2D02D, 1
		jz	short loc_172D0
		mov	al, _bullet_template.BT_angle
		add	al, -8
		jmp	short loc_172D5
; ---------------------------------------------------------------------------

loc_172D0:
		mov	al, _bullet_template.BT_angle
		add	al, 8

loc_172D5:
		mov	_bullet_template.BT_angle, al
		sub	_bullet_template.BT_origin.x, (6 shl 4)
		call	fp_2D000
		call	randring2_next16_and pascal, 3
		inc	al
		mov	_bullet_template.count, al
		call	randring2_next16_and pascal, 1Fh
		add	al, (1 shl 4)
		mov	_bullet_template.speed, al
		add	_bullet_template.BT_origin.x, (12 shl 4)
		call	fp_2D000
		cmp	_bullet_template.BT_angle, 0
		jz	short loc_1730D
		cmp	_bullet_template.BT_angle, 80h
		jb	short loc_17331

loc_1730D:
		inc	byte_2D02D
		cmp	byte_2D02D, 4
		jb	short loc_1732A

loc_17318:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh
		mov	_boss_sprite, 129
		jmp	short loc_17331
; ---------------------------------------------------------------------------

loc_1732A:
		call	snd_se_play pascal, 15

loc_17331:
		pop	di
		pop	si
		leave
		retn
sub_1717D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_17335	proc near

var_3		= byte ptr -3
@@speed		= word ptr -2

		enter	4, 0
		push	si
		push	di
		call	sub_16A1A
		mov	[bp+var_3], al
		cmp	[bp+var_3], 2
		jnz	short loc_1736D
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_BACKWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.speed, (3 shl 4) + 2
		mov	_bullet_template.pattern, BP_RING_AIMED
		mov	_bullet_template.BT_angle, 0
		call	fp_2D004
		mov	fp_25676, offset sub_17061
		jmp	loc_1748D
; ---------------------------------------------------------------------------

loc_1736D:
		cmp	[bp+var_3], 1
		jnz	loc_1748D
		cmp	byte_25672, 0
		jz	short loc_173D3
		mov	ax, _boss_phase_frame
		mov	bx, 32
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_173AC
		mov	al, byte_25672
		add	al, al
		mov	dl, 24
		sub	dl, al
		mov	_bullet_template.count, dl
		cmp	byte_25674, 2
		jnz	short loc_173A2
		mov	_bullet_template.count, 28

loc_173A2:
		call	sub_16DD7
		call	snd_se_play pascal, 9

loc_173AC:
		cmp	_boss_phase_frame, 160
		jl	loc_1748D
		mov	di, 0B204h
		xor	si, si
		jmp	short loc_173CB
; ---------------------------------------------------------------------------

loc_173BD:
		mov	al, [di+19h]
		neg	al
		mov	[di+19h], al
		add	si, 2
		add	di, 34h	; '4'

loc_173CB:
		cmp	si, 4
		jl	short loc_173BD
		jmp	loc_1747D
; ---------------------------------------------------------------------------

loc_173D3:
		push	40h
		call	sub_16B85
		or	al, al
		jnz	loc_1747D
		mov	ax, _boss_phase_frame
		mov	bx, 16
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_1748D
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_RED
		mov	_bullet_template.pattern, BP_SINGLE_AIMED
		mov	_bullet_template.BT_special_motion, 0FFh
		call	fp_2D004
		xor	si, si
		jmp	short loc_1746F
; ---------------------------------------------------------------------------

loc_17409:
		call	randring2_next16_mod pascal, (64 shl 4)
		mov	dx, _boss_pos.cur.x
		add	dx, (-52 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.x, ax
		call	randring2_next16_mod pascal, (64 shl 4)
		mov	dx, _boss_pos.cur.y
		add	dx, (-40 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.y, ax
		call	randring2_next16_mod pascal, (6 shl 4)
		add	ax, (1 shl 4)
		mov	[bp+@@speed], ax
		mov	al, byte ptr [bp+@@speed]
		mov	_bullet_template.speed, al
		cmp	[bp+@@speed], (4 shl 4)
		jl	short loc_1744D
		mov	_bullet_template.BT_angle, 0
		jmp	short loc_1746A
; ---------------------------------------------------------------------------

loc_1744D:
		mov	ax, (4 shl 4)
		sub	ax, [bp+@@speed]
		mov	[bp+@@speed], ax
		push	ax
		call	randring2_next16_mod
		push	ax
		mov	ax, [bp+@@speed]
		cwd
		sub	ax, dx
		sar	ax, 1
		pop	dx
		sub	dl, al
		mov	_bullet_template.BT_angle, dl

loc_1746A:
		call	fp_2D002
		inc	si

loc_1746F:
		cmp	si, 20h	; ' '
		jl	short loc_17409
		call	snd_se_play pascal, 15
		jmp	short loc_1748D
; ---------------------------------------------------------------------------

loc_1747D:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh
		mov	_boss_sprite, 129

loc_1748D:
		pop	di
		pop	si
		leave
		retn
sub_17335	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_17491	proc near

var_1		= byte ptr -1

		enter	2, 0
		push	si
		call	sub_16A1A
		mov	[bp+var_1], al
		cmp	[bp+var_1], 2
		jnz	short loc_174CD
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_STAR
		mov	_bullet_template.speed, (5 shl 4) + 12
		mov	_bullet_template.pattern, BP_SINGLE
		mov	_bullet_template.BT_special_motion, 83h
		call	fp_2D004
		mov	fp_25676, offset sub_17061
		mov	byte_2D02D, 0
		jmp	loc_1769B
; ---------------------------------------------------------------------------

loc_174CD:
		cmp	[bp+var_1], 1
		jnz	loc_1769B
		cmp	byte_25672, 0
		jz	loc_17615
		cmp	_boss_phase_frame, 96
		jg	short loc_17515
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_17683
		mov	byte_2CFF8, 40h
		mov	_bullet_template.BT_angle, 10h
		xor	si, si
		jmp	short loc_1750E
; ---------------------------------------------------------------------------

loc_17502:
		call	sub_1CFB5
		mov	al, _bullet_template.BT_angle
		add	al, 20h
		mov	_bullet_template.BT_angle, al
		inc	si

loc_1750E:
		cmp	si, 4
		jl	short loc_17502
		jmp	short loc_17560
; ---------------------------------------------------------------------------

loc_17515:
		cmp	_boss_phase_frame, 128
		jg	short loc_1756A
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_17683
		mov	byte_2CFF8, 30h	; '0'
		mov	_bullet_template.BT_angle, -70h
		call	sub_1CFB5
		mov	byte_2CFF8, 50h	; 'P'
		mov	_bullet_template.BT_angle, -50h
		call	sub_1CFB5
		mov	byte_2CFF8, 30h	; '0'
		mov	_bullet_template.BT_angle, -30h
		call	sub_1CFB5
		mov	byte_2CFF8, 50h	; 'P'
		mov	_bullet_template.BT_angle, -10h
		call	sub_1CFB5

loc_17560:
		call	snd_se_play pascal, 3
		jmp	loc_17683
; ---------------------------------------------------------------------------

loc_1756A:
		cmp	_boss_phase_frame, 160
		jg	short loc_175A2
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_17683
		mov	byte_2CFF8, 70h	; 'p'
		mov	_bullet_template.BT_angle, 10h
		xor	si, si
		jmp	short loc_1759B
; ---------------------------------------------------------------------------

loc_1758F:
		call	sub_1CFB5
		mov	al, _bullet_template.BT_angle
		add	al, 20h
		mov	_bullet_template.BT_angle, al
		inc	si

loc_1759B:
		cmp	si, 4
		jl	short loc_1758F
		jmp	short loc_17560
; ---------------------------------------------------------------------------

loc_175A2:
		cmp	_boss_phase_frame, 192
		jg	short loc_175DA
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_17683
		mov	byte_2CFF8, 10h
		mov	_bullet_template.BT_angle, 10h
		xor	si, si
		jmp	short loc_175D3
; ---------------------------------------------------------------------------

loc_175C7:
		call	sub_1CFB5
		mov	al, _bullet_template.BT_angle
		add	al, 20h
		mov	_bullet_template.BT_angle, al
		inc	si

loc_175D3:
		cmp	si, 4
		jl	short loc_175C7
		jmp	short loc_17560
; ---------------------------------------------------------------------------

loc_175DA:
		cmp	_boss_phase_frame, 224
		jg	loc_17683
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_17683
		mov	byte_2CFF8, 40h
		mov	_bullet_template.BT_angle, 10h
		xor	si, si
		jmp	short loc_1760D
; ---------------------------------------------------------------------------

loc_17601:
		call	sub_1CFB5
		mov	al, _bullet_template.BT_angle
		add	al, 20h
		mov	_bullet_template.BT_angle, al
		inc	si

loc_1760D:
		cmp	si, 4
		jl	short loc_17601
		jmp	loc_17560
; ---------------------------------------------------------------------------

loc_17615:
		push	80h
		call	sub_16B85
		cmp	byte_2D02D, 0
		jnz	short loc_17634
		call	randring2_next16_and pascal, 1Fh
		mov	dl, 80h
		sub	dl, al
		mov	_bullet_template.BT_angle, dl
		mov	byte_2D02D, 1

loc_17634:
		mov	ax, _boss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_17675
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.pattern, BP_STACK
		mov	_bullet_template.count, 16
		mov	_bullet_template.BT_delta.stack_speed, 5
		mov	_bullet_template.speed, (1 shl 4)
		call	fp_2D004
		call	sub_1CFA2
		mov	al, _bullet_template.BT_angle
		add	al, -8
		mov	_bullet_template.BT_angle, al
		call	snd_se_play pascal, 15

loc_17675:
		cmp	_bullet_template.BT_angle, 80h
		jbe	short loc_17683
		cmp	_bullet_template.BT_angle, -20h
		jbe	short loc_1768B

loc_17683:
		cmp	_boss_phase_frame, 256
		jl	short loc_1769B

loc_1768B:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh
		mov	_boss_sprite, 129

loc_1769B:
		pop	si
		leave
		retn
sub_17491	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1769E	proc near

var_1		= byte ptr -1

		enter	2, 0
		call	sub_16A1A
		mov	[bp+var_1], al
		cmp	[bp+var_1], 2
		jnz	short loc_176D9
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_STAR
		mov	_bullet_template.pattern, BP_SINGLE
		mov	_bullet_template.BT_special_motion, 0FFh
		mov	_bullet_template.BT_angle, -40h
		mov	_bullet_template.speed, (6 shl 4)
		mov	fp_25676, offset sub_17061
		mov	byte_2D02D, 0
		leave
		retn
; ---------------------------------------------------------------------------

loc_176D9:
		cmp	[bp+var_1], 1
		jnz	locret_17811
		cmp	byte_25672, 0
		jz	loc_1779E
		cmp	_boss_phase_frame, 128
		jg	short loc_17707
		cmp	_stage_frame_mod4, 0
		jnz	locret_17811
		call	sub_16DD7
		call	snd_se_play pascal, 9
		leave
		retn
; ---------------------------------------------------------------------------

loc_17707:
		cmp	_boss_phase_frame, 192
		jg	loc_17794
		cmp	_stage_frame_mod4, 0
		jnz	locret_17811
		mov	_bullet_template.BT_origin.x, 0
		call	randring2_next16_mod pascal, (192 shl 4)
		mov	_bullet_template.BT_origin.y, ax
		call	randring2_next16_and pascal, 1Fh
		add	al, (1 shl 4)
		mov	_bullet_template.speed, al
		call	randring2_next16_and pascal, 1Fh
		mov	dl, 30h
		sub	dl, al
		mov	_bullet_template.BT_angle, dl
		call	fp_2D002
		mov	_bullet_template.BT_origin.x, (384 shl 4)
		call	randring2_next16_mod pascal, (192 shl 4)
		mov	_bullet_template.BT_origin.y, ax
		call	randring2_next16_and pascal, 1Fh
		add	al, (1 shl 4)
		mov	_bullet_template.speed, al
		call	randring2_next16_and pascal, 1Fh
		add	al, 50h
		mov	_bullet_template.BT_angle, al
		call	fp_2D002
		call	randring2_next16_mod pascal, (384 shl 4)
		mov	_bullet_template.BT_origin.x, ax
		mov	_bullet_template.BT_origin.y, 0
		call	randring2_next16_and pascal, 1Fh
		add	al, (1 shl 4)
		mov	_bullet_template.speed, al
		call	randring2_next16_and pascal, 1Fh
		add	al, 30h
		mov	_bullet_template.BT_angle, al
		call	fp_2D002
		leave
		retn
; ---------------------------------------------------------------------------

loc_17794:
		cmp	_boss_phase_frame, 256
		jl	short locret_17811
		jmp	short loc_17801
; ---------------------------------------------------------------------------

loc_1779E:
		push	0A0h
		call	sub_16B85
		cmp	byte_2D02D, 0
		jnz	short loc_177B8
		call	randring2_next16_and pascal, 1Fh
		mov	_bullet_template.BT_angle, al
		mov	byte_2D02D, 1

loc_177B8:
		mov	ax, _boss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_177F9
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.pattern, BP_STACK
		mov	_bullet_template.count, 16
		mov	_bullet_template.BT_delta.stack_speed, 5
		mov	_bullet_template.speed, (1 shl 4)
		call	fp_2D004
		call	sub_1CFA2
		mov	al, _bullet_template.BT_angle
		add	al, 8
		mov	_bullet_template.BT_angle, al
		call	snd_se_play pascal, 15

loc_177F9:
		cmp	_boss_phase_frame, 192
		jl	short locret_17811

loc_17801:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh
		mov	_boss_sprite, 129

locret_17811:
		leave
		retn
sub_1769E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_17813	proc near

var_1		= byte ptr -1

		enter	2, 0
		call	sub_16A1A
		mov	[bp+var_1], al
		cmp	[bp+var_1], 2
		jnz	short loc_1784F
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.count, 32
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.speed, (3 shl 4) + 8
		call	fp_2D004
		push	1
		call	randring2_next16_and
		or	ax, ax
		jnz	short loc_17848
		mov	al, 1
		jmp	short loc_1784A
; ---------------------------------------------------------------------------

loc_17848:
		mov	al, 0FFh

loc_1784A:
		mov	byte_2D02D, al
		leave
		retn
; ---------------------------------------------------------------------------

loc_1784F:
		cmp	[bp+var_1], 1
		jnz	short locret_1788C
		mov	ax, _boss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_17874
		call	fp_2D000
		mov	al, byte_2D02D
		add	_bullet_template.BT_angle, al
		call	snd_se_play pascal, 9

loc_17874:
		cmp	_boss_phase_frame, 128
		jl	short locret_1788C
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh
		mov	_boss_sprite, 129

locret_1788C:
		leave
		retn
sub_17813	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1788E	proc far

var_1		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		call	sub_16A1A
		mov	[bp+var_1], al
		cmp	[bp+var_1], 2
		jnz	short loc_178AD
		mov	byte_2D02C, 20h	; ' '
		push	1
		call	randring2_next16_and
		mov	byte_2D02D, al

loc_178AD:
		call	sub_16A1A
		cmp	al, 1
		jnz	loc_179B8
		cmp	byte_25672, 0
		jz	loc_1795F
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1793D
		mov	fp_25676, offset sub_17061
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.speed, (2 shl 4)
		mov	_bullet_template.pattern, BP_SINGLE
		mov	al, byte ptr _stage_frame
		shl	al, 3
		mov	_bullet_template.BT_angle, al
		cmp	byte_2D02D, 0
		jz	short loc_178F6
		neg	al
		mov	_bullet_template.BT_angle, al

loc_178F6:
		call	fp_2D004
		call	sub_16DD7
		mov	ax, _boss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_17936
		mov	fp_25676, offset sub_16F24
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	al, byte_2D02C
		mov	_bullet_template.speed, al
		add	al, 2
		mov	byte_2D02C, al
		mov	_bullet_template.pattern, BP_SINGLE
		mov	_bullet_template.BT_angle, 0
		call	fp_2D004
		call	sub_16DD7

loc_17936:
		call	snd_se_play pascal, 9

loc_1793D:
		cmp	_boss_phase_frame, 160
		jl	short loc_179B8
		mov	si, 0B204h
		xor	di, di
		jmp	short loc_17958
; ---------------------------------------------------------------------------

loc_1794C:
		mov	al, [si+19h]
		neg	al
		mov	[si+19h], al
		inc	di
		add	si, 1Ah

loc_17958:
		cmp	di, 4
		jl	short loc_1794C
		jmp	short loc_179A8
; ---------------------------------------------------------------------------

loc_1795F:
		push	48h ; 'H'
		call	sub_16B85
		or	al, al
		jnz	short loc_179A8
		mov	ax, _boss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_179B8
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.pattern, BP_STACK_AIMED
		mov	_bullet_template.count, 16
		mov	_bullet_template.BT_delta.stack_speed, 5
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.speed, (1 shl 4)
		call	fp_2D004
		call	sub_1CFA2
		call	snd_se_play pascal, 15
		jmp	short loc_179B8

loc_179A8:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh
		mov	_boss_sprite, 129

loc_179B8:
		pop	di
		pop	si
		leave
		retn
sub_1788E	endp

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_179BC	proc near
		push	bp
		mov	bp, sp
		inc	_boss_phase_frame
		push	1800180h
		push	4
		call	sub_1E5D8
		mov	_boss_damage_this_frame, al
		mov	ah, 0
		mov	dl, byte_25672
		mov	dh, 0
		inc	dx
		push	dx
		cwd
		pop	bx
		idiv	bx
		sub	_boss_hp, ax
		mov	ax, _boss_hp
		cmp	ax, _boss_phase_end_hp
		jg	short loc_179F0
		mov	al, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_179F0:
		mov	al, 0
		pop	bp
		retn
sub_179BC	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

marisa_update	proc far

var_4		= word ptr -4
var_2		= word ptr -2

		enter	4, 0
		mov	ax, _boss_pos.cur.x
		add	ax, (-20 shl 4)
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-8 shl 4)
		mov	_bullet_template.BT_origin.y, ax
		mov	al, _boss_phase
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 3
		ja	loc_17C9F
		add	bx, bx
		jmp	cs:off_17CEB[bx]

loc_17A1F:
		cmp	_boss_phase_frame, 0
		jnz	short loc_17A31
		mov	_boss_hp, 6000
		mov	byte_25671, 2

loc_17A31:
		call	sub_1E67C
		cmp	_boss_phase_frame, 96
		jle	loc_17CA4
		inc	_boss_phase
		mov	Palettes, 0
		mov	Palettes+1, 0
		mov	Palettes+2, 7
		mov	_palette_changed, 1
		mov	_boss_phase_frame, 0
		call	snd_se_play pascal, 13
		mov	fp_255AC, offset reimu_marisa_bg_render
		mov	byte_2CDCA, 0Fh
		mov	byte_25670, 0
		jmp	loc_17CA4
; ---------------------------------------------------------------------------

loc_17A75:
		inc	_boss_phase_frame
		call	sub_1E67C
		cmp	_boss_phase_frame, 128
		jl	loc_17CA4
		inc	_boss_phase
		mov	_boss_pos.velocity.x, 0
		mov	_boss_mode_change, 0
		mov	_boss_mode, 0Ah
		mov	_boss_phase_frame, 0
		mov	_boss_sprite, 129
		mov	byte_25673, 1
		mov	byte_25674, 0
		mov	byte_2566E, 0Ah
		mov	byte_2566F, 0
		mov	byte_2D02B, 0
		jmp	loc_17CA4
; ---------------------------------------------------------------------------

loc_17AC1:
		mov	al, _boss_mode
		mov	ah, 0
		mov	[bp+var_4], ax
		mov	cx, 0Bh		; switch 11 cases
		mov	bx, offset word_17CBF

loc_17ACF:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_4]
		jz	short loc_17ADF
		add	bx, 2
		loop	loc_17ACF
		jmp	loc_17B98	; default
; ---------------------------------------------------------------------------

loc_17ADF:
		jmp	word ptr cs:[bx+16h] ; switch jump

loc_17AE3:
		call	sub_16E9D	; jumptable 00017ADF case 0
		jmp	loc_17B98	; default
; ---------------------------------------------------------------------------

loc_17AE9:
		call	sub_16F61	; jumptable 00017ADF case 1
		jmp	loc_17B98	; default
; ---------------------------------------------------------------------------

loc_17AEF:
		call	sub_17079	; jumptable 00017ADF case 2
		jmp	loc_17B98	; default
; ---------------------------------------------------------------------------

loc_17AF5:
		call	sub_1717D	; jumptable 00017ADF case 3
		jmp	loc_17B98	; default
; ---------------------------------------------------------------------------

loc_17AFB:
		call	sub_17335	; jumptable 00017ADF case 4
		jmp	loc_17B98	; default
; ---------------------------------------------------------------------------

loc_17B01:
		call	sub_17491	; jumptable 00017ADF case 5
		jmp	loc_17B98	; default
; ---------------------------------------------------------------------------

loc_17B07:
		call	sub_1769E	; jumptable 00017ADF case 6
		jmp	loc_17B98	; default
; ---------------------------------------------------------------------------

loc_17B0D:
		call	near ptr sub_1788E ; jumptable 00017ADF	case 7
		jmp	loc_17B98	; default
; ---------------------------------------------------------------------------

loc_17B13:
		call	sub_16DFF	; jumptable 00017ADF case 10
		jmp	loc_17B98	; default
; ---------------------------------------------------------------------------

loc_17B19:
		call	sub_17813	; jumptable 00017ADF case 11
		jmp	short loc_17B98	; default
; ---------------------------------------------------------------------------

loc_17B1E:
		call	sub_16AE9	; jumptable 00017ADF case 255
		cmp	_boss_phase_frame, 64
		jl	short loc_17B98	; default
		inc	_boss_mode_change
		mov	byte_2D02B, 0
		cmp	byte_2566F, 0
		jnz	short loc_17B62
		cmp	byte_25672, 0
		jnz	short loc_17B62
		inc	byte_25673
		cmp	byte_25673, 2
		jb	short loc_17B56
		mov	_boss_mode, 0
		mov	byte_25673, 0
		jmp	short loc_17B84
; ---------------------------------------------------------------------------

loc_17B56:
		push	1
		call	randring2_next16_and
		add	al, 0Ah
		mov	_boss_mode, al
		jmp	short loc_17B84
; ---------------------------------------------------------------------------

loc_17B62:
		push	7
		call	randring2_next16_mod
		inc	ax
		mov	[bp+var_2], ax
		mov	al, byte_2566E
		mov	ah, 0
		cmp	ax, [bp+var_2]
		jz	short loc_17B62
		mov	al, byte ptr [bp+var_2]
		mov	_boss_mode, al
		mov	byte_2566E, al
		mov	al, byte_25672
		mov	byte_2566F, al

loc_17B84:
		mov	_boss_phase_frame, 0
		cmp	_boss_mode_change, 52
		jb	short loc_17B98	; default
		mov	_boss_mode_change, 0
		jmp	short loc_17BA4
; ---------------------------------------------------------------------------

loc_17B98:
		call	sub_179BC	; default
		or	al, al
		jz	short loc_17BB3
		mov	_boss_mode_change, 1

loc_17BA4:
		call	boss_explode_small pascal, 3
		inc	_boss_phase
		mov	_boss_phase_frame, 0

loc_17BB3:
		cmp	_stage_frame_mod4, 0
		jnz	short loc_17BF0
		cmp	byte_25670, 0
		jnz	short loc_17BD7
		mov	al, Palettes+2
		add	al, 2
		mov	Palettes+2, al
		cmp	Palettes+2, 0C0h
		jb	short loc_17BEB
		mov	byte_25670, 1
		jmp	short loc_17BEB
; ---------------------------------------------------------------------------

loc_17BD7:
		mov	al, Palettes+2
		add	al, 0FEh
		mov	Palettes+2, al
		cmp	Palettes+2, 26h	; '&'
		ja	short loc_17BEB
		mov	byte_25670, 0

loc_17BEB:
		mov	_palette_changed, 1

loc_17BF0:
		cmp	_boss_hp, 4500
		jg	short loc_17BFF
		cmp	byte_25674, 0
		jz	short loc_17C21

loc_17BFF:
		cmp	_boss_hp, 2500
		jg	short loc_17C0E
		cmp	byte_25674, 1
		jz	short loc_17C21

loc_17C0E:
		cmp	_boss_hp, 1000
		jg	loc_17CA4
		cmp	byte_25674, 2
		jnz	loc_17CA4

loc_17C21:
		call	sub_1E692
		cmp	_bullet_clear_time, 20
		jnb	short loc_17C30
		mov	_bullet_clear_time, 20

loc_17C30:
		push	0Ah
		call	sub_19FD8
		mov	al, byte_25674
		mov	ah, 0
		call	boss_explode_small pascal, ax
		inc	byte_25674
		jmp	short loc_17CA4
; ---------------------------------------------------------------------------

loc_17C44:
		inc	_boss_phase_frame
		cmp	_boss_phase_frame, 16
		jnz	short loc_17C54
		call	boss_explode_small pascal, 4

loc_17C54:
		cmp	_boss_phase_frame, 32
		jnz	short loc_17CA4
		call	boss_explode_big pascal, 2
		mov	_boss_phase, PHASE_EXPLODE_BIG
		mov	al, _boss_mode_change
		mov	_bullet_clear_trigger, al
		cmp	_boss_mode_change, 0
		jz	short loc_17C77
		push	28h ; '('
		call	sub_19FD8

loc_17C77:
		mov	_boss_sprite, 4
		mov	_boss_phase_frame, 0
		call	snd_se_play pascal, 12
		mov	Palettes, 0
		mov	Palettes+2, 0
		mov	_palette_changed, 1
		mov	_player_invincibility_time, BOSS_DEFEAT_INVINCIBILITY_FRAMES
		jmp	short loc_17CA4
; ---------------------------------------------------------------------------

loc_17C9F:
		call	sub_1E743
		leave
		retf
; ---------------------------------------------------------------------------

loc_17CA4:
		mov	ax, _boss_pos.cur.x
		mov	_homing_target.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_homing_target.y, ax
		call	sub_16C6A
		push	_boss_hp
		push	6000
		call	sub_19F16
		leave
		retf
marisa_update	endp

; ---------------------------------------------------------------------------
word_17CBF	dw	0,     1,     2,     3
		dw	4,     5,     6,     7 ; value table for switch	statement
		dw    0Ah,   0Bh,  0FFh
		dw offset loc_17AE3	; jump table for switch	statement
		dw offset loc_17AE9
		dw offset loc_17AEF
		dw offset loc_17AF5
		dw offset loc_17AFB
		dw offset loc_17B01
		dw offset loc_17B07
		dw offset loc_17B0D
		dw offset loc_17B13
		dw offset loc_17B19
		dw offset loc_17B1E
off_17CEB	dw offset loc_17A1F
		dw offset loc_17A75
		dw offset loc_17AC1
		dw offset loc_17C44

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_17CF3	proc near

var_2		= word ptr -2
arg_0		= byte ptr  4
arg_2		= word ptr  6
arg_4		= word ptr  8
arg_6		= word ptr  0Ah

		enter	2, 0
		push	si
		push	di
		mov	di, [bp+arg_4]
		mov	si, 8A92h
		mov	[bp+var_2], 0
		jmp	loc_17DC3
; ---------------------------------------------------------------------------

loc_17D07:
		cmp	byte ptr [si], 0
		jnz	loc_17DBD

loc_17D0E:
		mov	byte ptr [si], 3 ; jumptable 0001CCD9 case 30465
		mov	byte ptr [si+1Ah], 0
		mov	byte ptr [si+1Bh], 0
		mov	byte ptr [si+1], 0
		mov	word ptr [si+18h], 0
		mov	bx, [bp+arg_6]
		add	bx, bx
		mov	ax, _enemy_script_ptrs[bx]
		mov	[si+16h], ax
		cmp	di, 3E70h
		jnz	short loc_17D3C
		push	1800h
		call	randring2_next16_mod
		mov	di, ax

loc_17D3C:
		cmp	[bp+arg_2], 3E70h
		jnz	short loc_17D4C
		push	1700h
		call	randring2_next16_mod
		mov	[bp+arg_2], ax

loc_17D4C:
		mov	[si+2],	di
		mov	ax, [bp+arg_2]
		mov	[si+4],	ax
		mov	al, [bp+arg_0]
		mov	[si+23h], al
		mov	byte ptr [si+24h], 0
		cmp	_rank, RANK_LUNATIC
		jnz	short loc_17D6B
		mov	ax, 1
		jmp	short loc_17D6D
; ---------------------------------------------------------------------------

loc_17D6B:
		xor	ax, ax

loc_17D6D:
		mov	[si+29h], al
		mov	byte ptr [si+20h], 0
		mov	byte ptr [si+21h], 0
		mov	byte ptr [si+25h], 1
		mov	byte ptr [si+26h], 4
		mov	byte ptr [si+27h], 0
		mov	byte ptr [si+28h], 0
		mov	byte ptr [si+2Ah], 0
		cmp	di, 0C00h
		jge	short loc_17D96
		mov	al, 1
		jmp	short loc_17D98
; ---------------------------------------------------------------------------

loc_17D96:
		mov	al, 0

loc_17D98:
		mov	[si+2Bh], al
		call	randring2_next16
		mov	[si+3Eh], al
		mov	byte ptr [si+3Fh], 80h
		mov	byte ptr [si+36h], 41h ; 'A'
		mov	byte ptr [si+2Ch], 1
		mov	byte ptr [si+38h], 2Ah ; '*'
		mov	word ptr [si+2Eh], 0
		mov	word ptr [si+30h], 0
		jmp	short loc_17DCB
; ---------------------------------------------------------------------------

loc_17DBD:
		inc	[bp+var_2]
		add	si, 40h

loc_17DC3:
		cmp	[bp+var_2], 20h	; ' '

loc_17DC7:
		jl	loc_17D07

loc_17DCB:
		pop	di
		pop	si
		leave
		retn	8
sub_17CF3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

std_run	proc far

var_1		= byte ptr -1

		enter	2, 0
		les	bx, _std_ip
		assume es:nothing
		mov	ax, es:[bx]
		cmp	ax, _stage_frame
		jnz	short locret_17E3C
		add	word ptr _std_ip, 2
		les	bx, _std_ip
		mov	al, es:[bx]
		mov	[bp-1],	al
		inc	word ptr _std_ip

loc_17DF5:
		cmp	_midboss_active, 0
		jnz	short loc_17E18
		les	bx, _std_ip
		mov	al, es:[bx]
		mov	ah, 0
		push	ax
		push	word ptr es:[bx+1]
		push	word ptr es:[bx+3]
		mov	al, es:[bx+5]
		mov	ah, 0
		push	ax
		call	sub_17CF3

loc_17E18:
		add	word ptr _std_ip, 8
		dec	byte ptr [bp-1]
		cmp	byte ptr [bp-1], 0
		ja	short loc_17DF5
		les	bx, _std_ip
		cmp	word ptr es:[bx], 0
		jnz	short locret_17E3C
		setfarfp	_stage_vm, nullsub_2

locret_17E3C:
		leave
		retf
std_run	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_17E3E	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	cx, size _bullet_template / 2
		mov	si, [bp+arg_0]
		add	si, 2Ch	; ','
		mov	di, offset _bullet_template
		push	ds
		pop	es
		assume es:_DATA
		rep movsw
		pop	di
		pop	si
		pop	bp
		retn	2
sub_17E3E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_17E59	proc far

var_1		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		mov	_homing_target.x, HOMING_TARGET_NONE
		mov	_homing_target.y, HOMING_TARGET_NONE
		mov	word_257E2, 100h
		mov	word_257E4, 0C0h
		mov	si, 8A92h
		xor	di, di
		jmp	loc_18024
; ---------------------------------------------------------------------------

loc_17E7F:
		cmp	byte ptr [si], 0
		jz	loc_18020
		cmp	byte ptr [si], 2
		jnz	short loc_17E91
		mov	byte ptr [si], 0
		jmp	loc_18020
; ---------------------------------------------------------------------------

loc_17E91:
		mov	word_2598A, si
		cmp	byte ptr [si], 80h
		jnb	loc_17FF4
		call	sub_155DD
		cmp	byte ptr [si+2Ah], 0
		jz	short loc_17ECA
		mov	ax, [si+2]
		sub	ax, _player_pos.cur.x
		add	ax, 0C0h
		cmp	ax, 180h
		jnb	short loc_17ECA
		mov	ax, [si+4]
		sub	ax, _player_pos.cur.y
		add	ax, 0C0h
		cmp	ax, 180h
		jnb	short loc_17ECA
		mov	byte_259A9, 1
		jmp	short loc_17F3C
; ---------------------------------------------------------------------------

loc_17ECA:
		cmp	byte ptr [si+28h], 0
		jz	loc_17F9B
		cmp	word ptr [si+10h], 0FFFFh
		jz	loc_17F9B
		mov	ax, [si+2]
		add	ax, 100h
		cmp	ax, 1A00h
		jnb	loc_17F9B
		mov	ax, [si+4]
		add	ax, 100h
		cmp	ax, 1800h
		jnb	loc_17F9B
		mov	ax, [si+4]
		cmp	ax, _homing_target.y
		jle	short loc_17F0F
		cmp	ax, _player_pos.cur.y
		jg	short loc_17F0F
		mov	ax, [si+2]
		mov	_homing_target.x, ax
		mov	ax, [si+4]
		mov	_homing_target.y, ax

loc_17F0F:
		mov	eax, [si+2]
		mov	dword_257DE, eax
		call	sub_105B9
		mov	[bp+var_1], al
		cmp	[bp+var_1], 0
		jz	short loc_17F9B
		cmp	word ptr [si+10h], 0FFFEh
		jz	short loc_17F94
		mov	ah, 0
		cmp	ax, [si+10h]
		jge	short loc_17F3C
		mov	al, [bp+var_1]
		mov	ah, 0
		sub	[si+10h], ax
		jmp	short loc_17F8E
; ---------------------------------------------------------------------------

loc_17F3C:
		mov	byte ptr [si], 80h
		mov	byte ptr [si+25h], 1
		mov	byte ptr [si+28h], 0
		mov	byte ptr [si+2Ah], 0
		mov	word ptr [si+0Ah], 0
		mov	word ptr [si+0Ch], 0
		call	items_add pascal, word ptr [si+2], word ptr [si+4], word ptr [si+23h]
		call	snd_se_play pascal, 3
		movzx	eax, word ptr [si+14h]
		add	_score_delta, eax
		push	word ptr [si+2]
		push	word ptr [si+4]
		push	large (((4 shl 4) shl 16) or 8)
		nopcall	sparks_add_random
		inc	_enemies_gone
		inc	_enemies_killed
		jmp	loc_18020
; ---------------------------------------------------------------------------

loc_17F8E:
		mov	byte ptr [si+24h], 1
		jmp	short loc_17F9B
; ---------------------------------------------------------------------------

loc_17F94:
		call	snd_se_play pascal, 10

loc_17F9B:
		cmp	byte ptr [si+29h], 0
		jz	short loc_17FEF
		inc	byte ptr [si+3Eh]
		mov	al, [si+3Eh]
		cmp	al, [si+3Fh]
		jb	short loc_17FEF
		cmp	word ptr [si+4], 1300h
		jge	short loc_17FEF
		mov	ax, [si+2]
		sub	ax, _player_pos.cur.x
		add	ax, 300h
		cmp	ax, 600h
		jnb	short loc_17FD1
		mov	ax, [si+4]
		sub	ax, _player_pos.cur.y
		add	ax, 300h
		cmp	ax, 600h
		jb	short loc_17FEF

loc_17FD1:
		mov	byte ptr [si+3Eh], 0
		push	si
		call	sub_17E3E
		mov	ax, [si+2]
		add	_bullet_template.BT_origin.x, ax
		mov	ax, [si+4]
		add	_bullet_template.BT_origin.y, ax
		call	fp_2D004
		call	fp_2D000

loc_17FEF:
		inc	byte ptr [si+1]
		jmp	short loc_18020
; ---------------------------------------------------------------------------

loc_17FF4:
		lea	ax, [si+2]
		push	ax
		call	_motion_update_2
		mov	al, [si]
		inc	al
		mov	[si], al
		mov	[bp+var_1], al
		mov	ah, 0
		add	ax, 0FF80h
		mov	bx, 4
		cwd
		idiv	bx
		add	al, 4
		mov	[bp+var_1], al
		mov	[si+0Eh], al
		cmp	[bp+var_1], 0Ch
		jb	short loc_18020
		mov	byte ptr [si], 2

loc_18020:
		inc	di
		add	si, 40h

loc_18024:
		cmp	di, 20h	; ' '
		jl	loc_17E7F
		pop	di
		pop	si
		leave
		retf
sub_17E59	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1802F	proc near
		push	bp
		mov	bp, sp
		mov	byte_2A8D3, 0FEh
		call	sub_13B21
		mov	byte_2A8D3, 2
		call	sub_13B21
		pop	bp
		retn
sub_1802F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_18044	proc near

var_2		= word ptr -2

		enter	2, 0
		mov	ax, _boss_phase_frame
		add	ax, word_231F2
		mov	[bp+var_2], ax
		mov	cx, 4		; switch 4 cases
		mov	bx, offset word_180AB

loc_18058:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_18067
		add	bx, 2
		loop	loc_18058
		jmp	short locret_180A9 ; default
; ---------------------------------------------------------------------------

loc_18067:
		jmp	word ptr cs:[bx+8] ; switch jump

loc_1806B:
		mov	word_2A8CE, 1400h ; jumptable 00018067 case 32
		mov	ax, point_259EA.y
		add	ax, (-10 shl 4)
		mov	point_2A8C6.y, ax
		mov	ax, point_259EA.x
		mov	point_2A8C6.x, ax
		mov	word_2A8D0, 10h
		mov	byte_2A8D2, 0Eh

loc_1808B:
		call	sub_1802F	; jumptable 00018067 case 36
		leave
		retn
; ---------------------------------------------------------------------------

loc_18090:
		mov	byte_2A8D2, 7	; jumptable 00018067 case 34
		jmp	short loc_1808B	; jumptable 00018067 case 36
; ---------------------------------------------------------------------------

loc_18097:
		push	point_2A8C6.x ; jumptable 00018067 case 48
		push	point_2A8C6.y
		call	circles_add_shrinking
		mov	_circles_color, 0Fh

locret_180A9:
		leave			; default
		retn
sub_18044	endp

; ---------------------------------------------------------------------------
word_180AB	dw    20h,   22h,   24h,   30h
					; value	table for switch statement
		dw offset loc_1806B	; jump table for switch	statement
		dw offset loc_18090
		dw offset loc_1808B
		dw offset loc_18097

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_180BB	proc near
		push	bp
		mov	bp, sp
		mov	word_231F2, 10h
		call	sub_18044
		cmp	_boss_phase_frame, 16
		jl	short loc_18126
		cmp	_boss_phase_frame, 16
		jz	short loc_180FF
		cmp	_boss_sprite, 24
		jb	short loc_18126
		cmp	_boss_phase_frame, 48
		jge	short loc_18106
		cmp	_boss_phase_frame, 24
		jnz	short loc_180F1
		call	snd_se_play pascal, 8

loc_180F1:
		cmp	_stage_frame_mod2, 0
		jz	short loc_180FF
		mov	_boss_sprite, 130
		jmp	short loc_18126
; ---------------------------------------------------------------------------

loc_180FF:
		mov	_boss_sprite, 129
		jmp	short loc_18126
; ---------------------------------------------------------------------------

loc_18106:
		cmp	_boss_phase_frame, 48
		jnz	short loc_18116
		mov	_boss_sprite, 128
		mov	al, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18116:
		cmp	_boss_phase_frame, 128
		jge	short loc_18122
		mov	al, 2
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18122:
		mov	al, 3
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18126:
		mov	al, 0
		pop	bp
		retn
sub_180BB	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1812A	proc near
		push	bp
		mov	bp, sp
		mov	word_231F2, 0
		call	sub_18044
		mov	bx, _boss_phase_frame
		sub	bx, 16
		cmp	bx, 32
		ja	short loc_18184
		add	bx, bx
		jmp	cs:off_181DC[bx]

loc_18149:
		mov	_boss_sprite, 0
		mov	ax, point_259EA.x
		mov	_boss_pos.cur.x, ax
		mov	ax, point_259EA.y
		mov	_boss_pos.cur.y, ax
		jmp	short loc_18184
; ---------------------------------------------------------------------------

loc_1815C:
		mov	_boss_sprite, 135
		jmp	short loc_18184
; ---------------------------------------------------------------------------

loc_18163:
		mov	_boss_sprite, 134
		jmp	short loc_18184
; ---------------------------------------------------------------------------

loc_1816A:
		mov	_boss_sprite, 133
		jmp	short loc_18184
; ---------------------------------------------------------------------------

loc_18171:
		mov	_boss_sprite, 132
		jmp	short loc_18184
; ---------------------------------------------------------------------------

loc_18178:
		mov	_boss_sprite, 131
		jmp	short loc_18184
; ---------------------------------------------------------------------------

loc_1817F:
		mov	_boss_sprite, 129

loc_18184:
		cmp	_boss_phase_frame, 48
		jge	short loc_1818D
		jmp	short loc_181D7
; ---------------------------------------------------------------------------

loc_1818D:
		cmp	_boss_phase_frame, 64
		jge	short loc_181B7
		cmp	_boss_phase_frame, 32
		jnz	short loc_181A2
		call	snd_se_play pascal, 8

loc_181A2:
		cmp	_stage_frame_mod2, 0
		jz	short loc_181B0
		mov	_boss_sprite, 130
		jmp	short loc_181D7
; ---------------------------------------------------------------------------

loc_181B0:
		mov	_boss_sprite, 129
		jmp	short loc_181D7
; ---------------------------------------------------------------------------

loc_181B7:
		cmp	_boss_phase_frame, 64
		jnz	short loc_181C7
		mov	_boss_sprite, 128
		mov	al, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_181C7:
		cmp	_boss_phase_frame, 144
		jge	short loc_181D3
		mov	al, 2
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_181D3:
		mov	al, 3
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_181D7:
		mov	al, 0
		pop	bp
		retn
sub_1812A	endp

; ---------------------------------------------------------------------------
		db 0
off_181DC	dw offset loc_1817F
		dw offset loc_18184
		dw offset loc_18184
		dw offset loc_18184
		dw offset loc_18184
		dw offset loc_18184
		dw offset loc_18184
		dw offset loc_18184
		dw offset loc_18178
		dw offset loc_18184
		dw offset loc_18171
		dw offset loc_18184
		dw offset loc_1816A
		dw offset loc_18184
		dw offset loc_18163
		dw offset loc_18184
		dw offset loc_1815C
		dw offset loc_18184
		dw offset loc_18149
		dw offset loc_18184
		dw offset loc_18184
		dw offset loc_18184
		dw offset loc_1815C
		dw offset loc_18184
		dw offset loc_18163
		dw offset loc_18184
		dw offset loc_1816A
		dw offset loc_18184
		dw offset loc_18171
		dw offset loc_18184
		dw offset loc_18178
		dw offset loc_18184
		dw offset loc_1817F

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1821E	proc near
		push	bp
		mov	bp, sp
		mov	word_231F2, 0FFB0h
		call	sub_18044
		mov	bx, _boss_phase_frame
		sub	bx, 16
		cmp	bx, 32
		ja	short loc_18278
		add	bx, bx
		jmp	cs:off_182D2[bx]

loc_1823D:
		mov	_boss_sprite, 0
		mov	ax, point_259EA.x
		mov	_boss_pos.cur.x, ax
		mov	ax, point_259EA.y
		mov	_boss_pos.cur.y, ax
		jmp	short loc_18278
; ---------------------------------------------------------------------------

loc_18250:
		mov	_boss_sprite, 135
		jmp	short loc_18278
; ---------------------------------------------------------------------------

loc_18257:
		mov	_boss_sprite, 134
		jmp	short loc_18278
; ---------------------------------------------------------------------------

loc_1825E:
		mov	_boss_sprite, 133
		jmp	short loc_18278
; ---------------------------------------------------------------------------

loc_18265:
		mov	_boss_sprite, 132
		jmp	short loc_18278
; ---------------------------------------------------------------------------

loc_1826C:
		mov	_boss_sprite, 131
		jmp	short loc_18278
; ---------------------------------------------------------------------------

loc_18273:
		mov	_boss_sprite, 129

loc_18278:
		cmp	_boss_phase_frame, 48
		jge	short loc_18281
		jmp	short loc_182CD
; ---------------------------------------------------------------------------

loc_18281:
		cmp	_boss_phase_frame, 128
		jge	short loc_182AC
		cmp	_boss_phase_frame, 48
		jnz	short loc_18297
		call	snd_se_play pascal, 8

loc_18297:
		cmp	_stage_frame_mod2, 0
		jz	short loc_182A5
		mov	_boss_sprite, 130
		jmp	short loc_182CD
; ---------------------------------------------------------------------------

loc_182A5:
		mov	_boss_sprite, 129
		jmp	short loc_182CD
; ---------------------------------------------------------------------------

loc_182AC:
		cmp	_boss_phase_frame, 128
		jnz	short loc_182BD
		mov	_boss_sprite, 128
		mov	al, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_182BD:
		cmp	_boss_phase_frame, 192
		jge	short loc_182C9
		mov	al, 2
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_182C9:
		mov	al, 3
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_182CD:
		mov	al, 0
		pop	bp
		retn
sub_1821E	endp

; ---------------------------------------------------------------------------
		db 0
off_182D2	dw offset loc_18273
		dw offset loc_18278
		dw offset loc_18278
		dw offset loc_18278
		dw offset loc_18278
		dw offset loc_18278
		dw offset loc_18278
		dw offset loc_18278
		dw offset loc_1826C
		dw offset loc_18278
		dw offset loc_18265
		dw offset loc_18278
		dw offset loc_1825E
		dw offset loc_18278
		dw offset loc_18257
		dw offset loc_18278
		dw offset loc_18250
		dw offset loc_18278
		dw offset loc_1823D
		dw offset loc_18278
		dw offset loc_18278
		dw offset loc_18278
		dw offset loc_18250
		dw offset loc_18278
		dw offset loc_18257
		dw offset loc_18278
		dw offset loc_1825E
		dw offset loc_18278
		dw offset loc_18265
		dw offset loc_18278
		dw offset loc_1826C
		dw offset loc_18278
		dw offset loc_18273

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_18314	proc near
		push	bp
		mov	bp, sp
		call	fp_259E8
		mov	ah, 0
		cmp	ax, 1
		jz	short loc_1832E
		cmp	ax, 2
		jz	short loc_1834D
		cmp	ax, 3
		jz	short loc_1837D
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1832E:
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 8
		mov	_bullet_template.speed, (2 shl 4)
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		push	1
		call	randring2_next16_and
		mov	byte_2D02D, al
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1834D:
		cmp	_stage_frame_mod4, 0
		jnz	short loc_18388
		call	fp_2D000
		mov	al, _bullet_template.speed
		add	al, 3
		mov	_bullet_template.speed, al
		cmp	byte_2D02D, 0
		jz	short loc_1836B
		mov	al, 4
		jmp	short loc_1836D
; ---------------------------------------------------------------------------

loc_1836B:
		mov	al, -4

loc_1836D:
		add	al, _bullet_template.BT_angle
		mov	_bullet_template.BT_angle, al
		call	snd_se_play pascal, 3
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1837D:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_18388:
		pop	bp
		retn
sub_18314	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1838A	proc near

var_2		= word ptr -2

		enter	2, 0
		call	fp_259E8
		mov	ah, 0
		cmp	ax, 1
		jz	short loc_183A7
		cmp	ax, 2
		jz	short loc_18409
		cmp	ax, 3
		jz	loc_18451
		leave
		retn
; ---------------------------------------------------------------------------

loc_183A7:
		call	snd_se_play pascal, 15
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_CROSS_YELLOW
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 32
		mov	_bullet_template.BT_special_motion, 81h
		mov	_bullet_template.speed, (2 shl 4) + 8
		mov	byte_2CFF7, 2
		mov	byte_2CFF8, 0E0h
		call	fp_2D004
		call	sub_1CFB5
		mov	byte_2CFF8, 20h	; ' '
		call	sub_1CFB5
		mov	ax, _player_pos.cur.y
		sub	ax, _boss_pos.cur.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, _boss_pos.cur.x
		push	ax
		call	iatan2
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.BT_delta.spread_angle, 42h
		leave
		retn
; ---------------------------------------------------------------------------

loc_18409:
		mov	ax, _boss_phase_frame
		and	ax, 7
		mov	[bp+var_2], ax
		or	ax, ax
		jnz	short loc_1841E
		mov	al, _bullet_template.BT_delta.spread_angle
		add	al, -8
		mov	_bullet_template.BT_delta.spread_angle, al

loc_1841E:
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE
		mov	ax, [bp+var_2]
		imul	ax, 12
		add	al, (2 shl 4)
		mov	_bullet_template.speed, al
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 2
		call	fp_2D000
		cmp	_stage_frame_mod4, 0
		jnz	short locret_1845C
		call	snd_se_play pascal, 3
		leave
		retn
; ---------------------------------------------------------------------------

loc_18451:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

locret_1845C:
		leave
		retn
sub_1838A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1845E	proc near
		push	bp
		mov	bp, sp
		call	fp_259E8
		mov	ah, 0
		cmp	ax, 1
		jz	short loc_18473
		cmp	ax, 2
		jz	short loc_1849F
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18473:
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_BACKWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 40
		mov	_bullet_template.speed, (1 shl 4)
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		call	fp_2D000
		call	snd_se_play pascal, 15
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1849F:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh
		pop	bp
		retn
sub_1845E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_184AC	proc near
		push	bp
		mov	bp, sp
		call	fp_259E8
		mov	ah, 0
		cmp	ax, 1
		jz	short loc_184C8
		cmp	ax, 2
		jz	short loc_184D9
		cmp	ax, 3
		jz	loc_18549
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_184C8:
		mov	_bullet_template.BT_special_motion, 81h
		mov	_bullet_template.pattern, BP_SINGLE
		mov	byte_2CFF7, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_184D9:
		cmp	_stage_frame_mod2, 0
		jz	short loc_18554
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_SMALL_BALL_YELLOW
		call	randring2_next16_and pascal, 3Fh
		add	al, (1 shl 4)
		mov	_bullet_template.speed, al
		call	randring2_next16_mod pascal, (64 shl 4)
		mov	dx, _boss_pos.cur.x
		add	dx, (-32 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.x, ax
		call	randring2_next16_mod pascal, (32 shl 4)
		mov	dx, _boss_pos.cur.y
		add	dx, (-26 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.BT_angle, 0
		mov	byte_2CFF8, 40h
		call	fp_2D002
		call	randring2_next16_and pascal, 3Fh
		add	al, (1 shl 4)
		mov	_bullet_template.speed, al
		mov	_bullet_template.BT_angle, 80h
		mov	byte_2CFF8, 0C0h
		call	fp_2D002
		call	snd_se_play pascal, 9
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18549:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_18554:
		pop	bp
		retn
sub_184AC	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_18556	proc near
		push	bp
		mov	bp, sp
		call	fp_259E8
		mov	ah, 0
		cmp	ax, 1
		jz	short loc_18570
		cmp	ax, 2
		jz	short loc_18580
		cmp	ax, 3
		jz	short loc_185D7
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18570:
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 32
		call	fp_2D004
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18580:
		cmp	_stage_frame_mod8, 0
		jnz	short loc_185E2
		call	randring2_next16_and pascal, BST_PELLET
		mov	_bullet_template.spawn_type, al
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		call	randring2_next16_and pascal, 3Fh
		add	al, (1 shl 4)
		mov	_bullet_template.speed, al
		call	randring2_next16_mod pascal, (64 shl 4)
		mov	dx, _boss_pos.cur.x
		add	dx, (-32 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.x, ax
		call	randring2_next16_mod pascal, (32 shl 4)
		mov	dx, _boss_pos.cur.y
		add	dx, (-26 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.y, ax
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		call	fp_2D000
		call	snd_se_play pascal, 3
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_185D7:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_185E2:
		pop	bp
		retn
sub_18556	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_185E4	proc near
		push	bp
		mov	bp, sp
		cmp	_stage_frame_mod8, 0
		jnz	short loc_18653
		mov	al, _boss_angle
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 16
		mov	ax, _boss_phase_frame
		mov	bx, 256
		cwd
		idiv	bx
		add	al, (2 shl 4)
		mov	_bullet_template.speed, al
		call	fp_2D000
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	al, _bullet_template.BT_angle
		neg	al
		add	al, al
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.count, 4
		mov	al, _bullet_template.speed
		add	al, (1 shl 4)
		mov	_bullet_template.speed, al
		call	fp_2D000
		mov	ax, _boss_phase_frame
		mov	bx, 1024
		cwd
		idiv	bx
		cmp	dx, 512
		jge	short loc_1864B
		mov	al, _boss_angle
		add	al, 3
		jmp	short loc_18650
; ---------------------------------------------------------------------------

loc_1864B:
		mov	al, _boss_angle
		add	al, -3

loc_18650:
		mov	_boss_angle, al

loc_18653:
		pop	bp
		retn
sub_185E4	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_18655	proc near
		push	bp
		mov	bp, sp
		cmp	_stage_frame_mod8, 0
		jnz	short loc_18682
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 32
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE
		mov	_bullet_template.spawn_type, BST_BULLET16
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.speed, (7 shl 4)
		call	fp_2D000

loc_18682:
		pop	bp
		retn
sub_18655	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_18684	proc near

arg_0		= word ptr  4
@@type		= word ptr  6

		push	bp
		mov	bp, sp
		call	sub_1E692
		call	boss_explode_small pascal, [bp+@@type]
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0
		mov	_boss_mode_change, 0
		mov	ax, _boss_phase_end_hp
		mov	_boss_hp, ax
		mov	ax, [bp+arg_0]
		mov	_boss_phase_end_hp, ax
		mov	byte_259EE, 0
		pop	bp
		retn	4
sub_18684	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_186B9	proc near
		push	bp
		mov	bp, sp
		cmp	byte_259EF, 0
		jz	short loc_186D0
		push	3000300h
		push	0Ah
		call	sub_1E5D8
		jmp	short loc_186E3
; ---------------------------------------------------------------------------

loc_186D0:
		cmp	_boss_sprite, 130
		ja	short loc_186E3
		cmp	_boss_sprite, 0
		jz	short loc_186E3
		call	sub_1E64E
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_186E3:
		inc	_boss_phase_frame
		mov	al, 0
		pop	bp
		retn
sub_186B9	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

mugetsu_update	proc far

var_4		= word ptr -4
var_1		= byte ptr -1

		enter	4, 0
		cmp	byte_256A8, 0
		jz	short loc_186FB
		mov	byte_259EF, 20h	; ' '

loc_186FB:
		cmp	byte_259EF, 0
		jz	short loc_18706
		dec	byte_259EF

loc_18706:
		mov	ax, _boss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-10 shl 4)
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	al, _boss_phase
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 7
		ja	loc_1899C
		add	bx, bx
		jmp	cs:off_189DE[bx]

loc_1872F:
		cmp	_boss_phase_frame, 0
		jnz	short loc_1876B
		setfarfp	_stage_vm, nullsub_2
		mov	_midboss_frames_until, 0
		mov	fp_259E8, offset sub_180BB
		mov	byte_259EF, 0
		mov	_boss_hp, 9400
		mov	_boss_phase_end_hp, 3700
		mov	ax, _boss_pos.cur.x
		mov	point_259EA.x, ax
		mov	ax, _boss_pos.cur.y
		mov	point_259EA.y, ax

loc_1876B:
		call	sub_186B9
		cmp	_boss_phase_frame, 128
		jle	loc_189A1
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		call	snd_se_play pascal, 13
		mov	byte_2CDCA, 0Fh
		mov	fp_255AC, offset mugetsu_gengetsu_bg_render
		jmp	loc_189A1
; ---------------------------------------------------------------------------

loc_18797:
		call	sub_186B9
		cmp	_boss_phase_frame, 64
		jl	loc_189A1
		inc	_boss_phase
		mov	_boss_mode, 0
		mov	_boss_mode_change, 2
		mov	_boss_phase_frame, 0
		mov	_boss_pos.velocity.x, 0
		mov	byte_259EE, 0
		jmp	loc_189A1
; ---------------------------------------------------------------------------

loc_187C5:
		mov	al, _boss_mode
		mov	ah, 0
		mov	[bp+var_4], ax
		mov	cx, 9		; switch 9 cases
		mov	bx, offset word_189BA

loc_187D3:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_4]
		jz	short loc_187E2
		add	bx, 2
		loop	loc_187D3
		jmp	short loc_18856	; default
; ---------------------------------------------------------------------------

loc_187E2:
		jmp	word ptr cs:[bx+12h] ; switch jump
; ---------------------------------------------------------------------------
		jmp	short loc_187F2	; jumptable 000187E2 cases 0,6
; ---------------------------------------------------------------------------

loc_187E8:
		call	sub_184AC	; jumptable 000187E2 case 3
		jmp	short loc_18856	; default
; ---------------------------------------------------------------------------

loc_187ED:
		call	sub_1845E	; jumptable 000187E2 cases 1,4,5
		jmp	short loc_18856	; default
; ---------------------------------------------------------------------------

loc_187F2:
		call	sub_18314	; jumptable 000187E2 cases 0,6
		jmp	short loc_18856	; default
; ---------------------------------------------------------------------------

loc_187F7:
		call	sub_1838A	; jumptable 000187E2 cases 2,7
		jmp	short loc_18856	; default
; ---------------------------------------------------------------------------

loc_187FC:
		cmp	_boss_phase_frame, 16	; jumptable 000187E2 case 255
		jle	short loc_18856	; default
		push	3
		call	randring2_next16_and
		or	ax, ax
		jnz	short loc_18814
		mov	fp_259E8, offset sub_180BB
		jmp	short loc_18844
; ---------------------------------------------------------------------------

loc_18814:
		mov	fp_259E8, offset sub_1812A

loc_1881A:
		push	5
		call	randring2_next16_mod
		mov	[bp+var_1], al
		mov	al, _boss_mode_change
		cmp	al, [bp+var_1]
		jz	short loc_1881A
		mov	al, [bp+var_1]
		mov	_boss_mode_change, al
		mov	ah, 0
		shl	ax, 6
		shl	ax, 4
		add	ax, (64 shl 4)
		mov	point_259EA.x, ax
		mov	ax, _boss_pos.cur.y
		mov	point_259EA.y, ax

loc_18844:
		mov	_boss_phase_frame, 0
		inc	byte_259EE
		mov	al, byte_259EE
		and	al, 7
		mov	_boss_mode, al

loc_18856:
		cmp	byte_259EE, 20h	; ' ' ; default
		jb	short loc_1886E
		cmp	_boss_mode, 0FFh
		jz	short loc_1886E
		cmp	_boss_phase_frame, 24
		jle	short loc_1886E
		call	sub_18655

loc_1886E:
		cmp	byte_259EE, 24h	; '$'
		jnb	short loc_18883
		call	sub_186B9
		or	al, al
		jz	loc_189A1
		push	64h ; 'd'
		call	sub_19FD8

loc_18883:
		cmp	_bullet_clear_time, 20
		jnb	short loc_1888F
		mov	_bullet_clear_time, 20

loc_1888F:
		pushd	0
		call	sub_18684
		mov	point_259EA.x, (192 shl 4)
		jmp	loc_189A1
; ---------------------------------------------------------------------------

loc_1889E:
		call	sub_186B9
		cmp	_boss_phase_frame, 64
		jl	loc_189A1
		inc	_boss_phase
		mov	fp_259E8, offset sub_1821E

loc_188B4:
		mov	_boss_phase_frame, 0
		jmp	loc_189A1
; ---------------------------------------------------------------------------

loc_188BD:
		call	sub_186B9
		call	sub_18556
		cmp	_boss_phase_frame, 0
		jnz	loc_189A1
		call	boss_explode_small pascal, 3
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		mov	_boss_sprite, 129
		jmp	loc_189A1
; ---------------------------------------------------------------------------

loc_188E3:
		call	sub_186B9
		cmp	_boss_phase_frame, 128
		jl	loc_189A1
		inc	_boss_phase
		jmp	short loc_188B4
; ---------------------------------------------------------------------------

loc_188F6:
		call	sub_185E4
		cmp	_boss_phase_frame, 3000
		jl	short loc_18904
		call	sub_18655

loc_18904:
		call	sub_186B9
		or	al, al
		jnz	short loc_18915
		cmp	_boss_phase_frame, 4000
		jl	loc_189A1

loc_18915:
		call	boss_explode_small pascal, 1
		inc	_boss_phase
		cmp	_boss_phase_frame, 4000
		jge	short loc_1892D
		mov	_boss_mode_change, 1
		jmp	short loc_18932
; ---------------------------------------------------------------------------

loc_1892D:
		mov	_boss_mode_change, 0

loc_18932:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0
		mov	PaletteTone, 100
		mov	_palette_changed, 1
		jmp	short loc_189A1
; ---------------------------------------------------------------------------

loc_1894A:
		inc	_boss_phase_frame
		cmp	_boss_phase_frame, 16
		jnz	short loc_1895A
		call	boss_explode_small pascal, 4

loc_1895A:
		cmp	_boss_phase_frame, 32
		jnz	short loc_189A1
		call	boss_explode_big pascal, 2
		mov	_boss_phase, PHASE_EXPLODE_BIG
		mov	al, _boss_mode_change
		mov	_bullet_clear_trigger, al
		cmp	_boss_mode_change, 0
		jz	short loc_1897E
		push	0C8h
		call	sub_19FD8

loc_1897E:
		mov	_boss_sprite, 4
		mov	_boss_phase_frame, 0
		call	snd_se_play pascal, 12
		mov	_palette_changed, 1
		mov	_player_invincibility_time, BOSS_DEFEAT_INVINCIBILITY_FRAMES
		jmp	short loc_189A1
; ---------------------------------------------------------------------------

loc_1899C:
		call	sub_1E743
		leave
		retf
; ---------------------------------------------------------------------------

loc_189A1:
		mov	ax, _boss_pos.cur.x
		mov	_homing_target.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_homing_target.y, ax
		push	_boss_hp
		push	9400
		call	sub_19F16
		leave
		retf
mugetsu_update	endp

; ---------------------------------------------------------------------------
		db 0
word_189BA	dw	0,     1,     2,     3
		dw	4,     5,     6,     7 ; value table for switch	statement
		dw   0FFh
		dw offset loc_187F2	; jump table for switch	statement
		dw offset loc_187ED
		dw offset loc_187F7
		dw offset loc_187E8
		dw offset loc_187ED
		dw offset loc_187ED
		dw offset loc_187F2
		dw offset loc_187F7
		dw offset loc_187FC
off_189DE	dw offset loc_1872F
		dw offset loc_18797
		dw offset loc_187C5
		dw offset loc_1889E
		dw offset loc_188BD
		dw offset loc_188E3
		dw offset loc_188F6
		dw offset loc_1894A

; =============== S U B	R O U T	I N E =======================================


sub_189EE	proc near
		mov	bx, sp
		mov	dx, ss:[bx+2]
		mov	bx, ss:[bx+4]
		push	si
		mov	si, 1EB6h
		mov	cx, 3

loc_189FF:
		mov	ax, dx
		xor	dx, dx
		div	word ptr [si]
		mov	[bx], al
		dec	bx
		add	si, 2
		loop	loc_189FF
		mov	[bx], dl
		pop	si
		retn	4
sub_189EE	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_18A14	proc near

arg_0		= word ptr  4
arg_2		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	si, 0B204h
		xor	di, di
		jmp	short loc_18A6E
; ---------------------------------------------------------------------------

loc_18A20:
		cmp	byte ptr [si], 0
		jnz	short loc_18A6A
		mov	byte ptr [si], 1
		mov	ax, _boss_pos.cur.x
		add	ax, [bp+arg_2]
		mov	[si+2],	ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-10 shl 4)
		mov	[si+4],	ax
		mov	ax, _boss_pos.cur.x
		add	ax, [bp+arg_2]
		mov	[si+6],	ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-10 shl 4)
		mov	[si+8],	ax
		push	ds
		lea	ax, [si+0Ah]
		push	ax
		push	ds
		lea	ax, [si+0Ch]
		push	ax
		push	[bp+arg_0]
		push	(16 shl 4)
		call	vector2
		call	snd_se_play pascal, 5
		jmp	short loc_18A73
; ---------------------------------------------------------------------------

loc_18A6A:
		inc	di
		add	si, 1Ah

loc_18A6E:
		cmp	di, 6
		jl	short loc_18A20

loc_18A73:
		pop	di
		pop	si
		pop	bp
		retn	4
sub_18A14	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_18A79	proc near

var_4		= word ptr -4
var_2		= word ptr -2

		enter	4, 0
		push	si
		push	di
		mov	si, 0B204h
		xor	di, di
		mov	[bp+var_2], 0
		jmp	loc_18B51
; ---------------------------------------------------------------------------

loc_18A8C:
		cmp	byte ptr [si], 0
		jnz	short loc_18A94
		inc	[bp+var_2]

loc_18A94:
		cmp	byte ptr [si], 1
		jnz	loc_18B1D
		cmp	word ptr [si+2], 1800h
		jge	short loc_18AC4
		cmp	word ptr [si+4], 1700h
		jge	short loc_18AC4
		cmp	word ptr [si+2], 0
		jle	short loc_18AC4
		cmp	word ptr [si+4], 0
		jle	short loc_18AC4
		mov	ax, [si+0Ah]
		add	[si+2],	ax
		mov	ax, [si+0Ch]
		add	[si+4],	ax
		jmp	loc_18B4D
; ---------------------------------------------------------------------------

loc_18AC4:
		mov	ax, [si+2]
		sub	ax, [si+0Ah]
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, [si+4]
		sub	ax, [si+0Ch]
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.BT_special_motion, 82h
		mov	byte_2CFF7, 1
		mov	[bp+var_4], 0
		mov	_bullet_template.speed, (2 shl 4)
		jmp	short loc_18AFA
; ---------------------------------------------------------------------------

loc_18AEC:
		call	sub_1CFA2
		inc	[bp+var_4]
		mov	al, _bullet_template.speed
		add	al, 6
		mov	_bullet_template.speed, al

loc_18AFA:
		cmp	[bp+var_4], 3
		jl	short loc_18AEC
		inc	byte ptr [si]
		call	snd_se_play pascal, 6
		mov	_circles_color, GC_RG
		call	circles_add_growing pascal, _bullet_template.BT_origin.x, _bullet_template.BT_origin.y
		jmp	short loc_18B4D
; ---------------------------------------------------------------------------

loc_18B1D:
		cmp	byte ptr [si], 2
		jnz	short loc_18B4D
		cmp	word ptr [si+6], 1800h
		jge	short loc_18B4A
		cmp	word ptr [si+8], 1700h
		jge	short loc_18B4A
		cmp	word ptr [si+6], 0
		jle	short loc_18B4A
		cmp	word ptr [si+8], 0
		jle	short loc_18B4A
		mov	ax, [si+0Ah]
		add	[si+6],	ax
		mov	ax, [si+0Ch]
		add	[si+8],	ax
		jmp	short loc_18B4D
; ---------------------------------------------------------------------------

loc_18B4A:
		mov	byte ptr [si], 0

loc_18B4D:
		inc	di
		add	si, 1Ah

loc_18B51:
		cmp	di, 6
		jl	loc_18A8C
		cmp	[bp+var_2], 6
		jnz	short loc_18B62
		mov	al, 1
		jmp	short loc_18B64
; ---------------------------------------------------------------------------

loc_18B62:
		mov	al, 0

loc_18B64:
		pop	di
		pop	si
		leave
		retn
sub_18A79	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_18B68	proc near
		push	bp
		mov	bp, sp
		push	((192 shl 4) shl 16) or (64 shl 4)
		mov	al, _boss_angle
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_CosTable8[bx]
		call	vector1_at
		mov	_boss_pos.cur.x, ax
		push	((91 shl 4) shl 16) or (20 shl 4)
		mov	al, _boss_angle
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_SinTable8[bx]
		call	vector1_at
		mov	_boss_pos.cur.y, ax
		inc	_boss_angle
		pop	bp
		retn
sub_18B68	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_18BA7	proc near
		push	bp
		mov	bp, sp
		push	((192 shl 4) shl 16) or (64 shl 4)
		mov	al, _boss_angle
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_CosTable8[bx]
		call	vector1_at
		mov	_boss_pos.cur.x, ax
		push	((91 shl 4) shl 16) or (20 shl 4)
		mov	al, _boss_angle
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_SinTable8[bx]
		call	vector1_at
		mov	_boss_pos.cur.y, ax
		dec	_boss_angle
		pop	bp
		retn
sub_18BA7	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_18BE6	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 16
		jnz	short loc_18BF7
		mov	_boss_sprite, 8
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18BF7:
		cmp	_boss_phase_frame, 48
		jnz	short loc_18C1F
		mov	ax, _boss_pos.cur.x
		add	ax, (-12 shl 4)
		push	ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-10 shl 4)
		push	ax
		call	circles_add_shrinking
		mov	_circles_color, 0Fh
		call	snd_se_play pascal, 8
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18C1F:
		cmp	_boss_phase_frame, 64
		jnz	short loc_18C3E
		mov	_boss_sprite, 0
		push	0FF40000Fh
		call	randring2_next16_and
		mov	dl, 18h
		sub	dl, al
		push	dx
		call	sub_18A14
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18C3E:
		cmp	_boss_phase_frame, 64
		jle	short loc_18C74
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_OUTLINED_BALL_BLUE
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.pattern, BP_RING_AIMED
		mov	_bullet_template.count, 16
		call	fp_2D004
		call	sub_18A79
		or	al, al
		jz	short loc_18C74
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0

loc_18C74:
		pop	bp
		retn
sub_18BE6	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_18C76	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 16
		jnz	short loc_18C87
		mov	_boss_sprite, 9
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18C87:
		cmp	_boss_phase_frame, 48
		jnz	short loc_18CAF
		mov	ax, _boss_pos.cur.x
		add	ax, (12 shl 4)
		push	ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-10 shl 4)
		push	ax
		call	circles_add_shrinking
		mov	_circles_color, 0Fh
		call	snd_se_play pascal, 8
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18CAF:
		cmp	_boss_phase_frame, 64
		jnz	short loc_18CCC
		mov	_boss_sprite, 0
		push	0C0000Fh
		call	randring2_next16_and
		add	al, 68h	; 'h'
		push	ax
		call	sub_18A14
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18CCC:
		cmp	_boss_phase_frame, 64
		jle	short loc_18D02
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_OUTLINED_BALL_BLUE
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.pattern, BP_RING_AIMED
		mov	_bullet_template.count, 16
		call	fp_2D004
		call	sub_18A79
		or	al, al
		jz	short loc_18D02
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0

loc_18D02:
		pop	bp
		retn
sub_18C76	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_18D04	proc near

var_1		= byte ptr -1

		enter	2, 0
		cmp	_boss_phase_frame, 16
		jnz	short loc_18D16
		mov	_boss_sprite, 10
		leave
		retn
; ---------------------------------------------------------------------------

loc_18D16:
		cmp	_boss_phase_frame, 48
		jnz	short loc_18D51
		mov	ax, _boss_pos.cur.x
		add	ax, (12 shl 4)
		push	ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-10 shl 4)
		push	ax
		call	circles_add_shrinking
		mov	ax, _boss_pos.cur.x
		add	ax, (-12 shl 4)
		push	ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-10 shl 4)
		push	ax
		call	circles_add_shrinking
		mov	_circles_color, 0Fh
		call	snd_se_play pascal, 8
		leave
		retn
; ---------------------------------------------------------------------------

loc_18D51:
		cmp	_boss_phase_frame, 64
		jnz	short loc_18D7E
		mov	_boss_sprite, 0
		push	0Fh
		call	randring2_next16_and
		add	al, 68h	; 'h'
		mov	[bp+var_1], al
		push	0C0h
		push	word ptr [bp+var_1]
		call	sub_18A14
		push	0FF40h
		mov	al, 80h
		sub	al, [bp+var_1]
		push	ax
		call	sub_18A14
		leave
		retn
; ---------------------------------------------------------------------------

loc_18D7E:
		cmp	_boss_phase_frame, 64
		jle	short locret_18DB4
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_OUTLINED_BALL_BLUE
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.pattern, BP_RING_AIMED
		mov	_bullet_template.count, 8
		call	fp_2D004
		call	sub_18A79
		or	al, al
		jz	short locret_18DB4
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0

locret_18DB4:
		leave
		retn
sub_18D04	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_18DB6	proc near
		push	bp
		mov	bp, sp
		call	sub_18BA7
		cmp	_boss_angle, 128
		jbe	short loc_18DCA
		mov	_boss_sprite, 4
		jmp	short loc_18DCF
; ---------------------------------------------------------------------------

loc_18DCA:
		mov	_boss_sprite, 6

loc_18DCF:
		mov	ax, _stage_frame
		mov	bx, 57
		xor	dx, dx
		div	bx
		or	dx, dx
		jnz	short loc_18E41
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_OUTLINED_BALL_BLUE
		mov	eax, _boss_pos.cur
		mov	_bullet_template.BT_origin, eax
		mov	_bullet_template.pattern, BP_RING_AIMED
		mov	_bullet_template.count, 16
		mov	_bullet_template.BT_special_motion, 81h
		mov	_bullet_template.speed, (3 shl 4)
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		mov	byte_2CFF7, 1
		test	byte_259F0, 1
		jz	short loc_18E19
		mov	al, 40h
		jmp	short loc_18E1B
; ---------------------------------------------------------------------------

loc_18E19:
		mov	al, 0C0h

loc_18E1B:
		mov	byte_2CFF8, al
		call	fp_2D004
		call	fp_2D002
		mov	al, byte_2CFF8
		add	al, 80h
		mov	byte_2CFF8, al
		mov	_bullet_template.speed, (2 shl 4)
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		call	fp_2D002
		inc	byte_259F0

loc_18E41:
		pop	bp
		retn
sub_18DB6	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_18E43	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 16
		jnz	short loc_18E54
		mov	_boss_sprite, 8
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18E54:
		cmp	_boss_phase_frame, 48
		jnz	short loc_18E7C
		mov	ax, _boss_pos.cur.x
		add	ax, (-12 shl 4)
		push	ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-10 shl 4)
		push	ax
		call	circles_add_shrinking
		mov	_circles_color, 0Fh
		call	snd_se_play pascal, 8
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18E7C:
		cmp	_boss_phase_frame, 64
		jnz	short loc_18E92
		mov	_boss_sprite, 0
		push	0FF40h
		push	18h
		call	sub_18A14
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18E92:
		cmp	_boss_phase_frame, 64
		jle	short loc_18EE5
		cmp	_boss_phase_frame, 80
		jnz	short loc_18EA7
		push	0FF40h
		push	10h
		jmp	short loc_18EB3
; ---------------------------------------------------------------------------

loc_18EA7:
		cmp	_boss_phase_frame, 96
		jnz	short loc_18EB6
		push	0FF40h
		push	8

loc_18EB3:
		call	sub_18A14

loc_18EB6:
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_OUTLINED_BALL_BLUE
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.pattern, BP_RING_AIMED
		mov	_bullet_template.count, 12
		call	fp_2D004
		call	sub_18A79
		or	al, al
		jz	short loc_18EE5
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0

loc_18EE5:
		pop	bp
		retn
sub_18E43	endp

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_18EE7	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 16
		jnz	short loc_18EF8
		mov	_boss_sprite, 9
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18EF8:
		cmp	_boss_phase_frame, 48
		jnz	short loc_18F20
		mov	ax, _boss_pos.cur.x
		add	ax, (12 shl 4)
		push	ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-10 shl 4)
		push	ax
		call	circles_add_shrinking
		mov	_circles_color, 0Fh
		call	snd_se_play pascal, 8
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18F20:
		cmp	_boss_phase_frame, 64
		jnz	short loc_18F36
		mov	_boss_sprite, 0
		push	0C0h
		push	68h ; 'h'
		call	sub_18A14
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18F36:
		cmp	_boss_phase_frame, 64
		jle	short loc_18F89
		cmp	_boss_phase_frame, 80
		jnz	short loc_18F4B
		push	0C0h
		push	70h ; 'p'
		jmp	short loc_18F57
; ---------------------------------------------------------------------------

loc_18F4B:
		cmp	_boss_phase_frame, 96
		jnz	short loc_18F5A
		push	0C0h
		push	78h ; 'x'

loc_18F57:
		call	sub_18A14

loc_18F5A:
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_OUTLINED_BALL_BLUE
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.pattern, BP_RING_AIMED
		mov	_bullet_template.count, 12
		call	fp_2D004
		call	sub_18A79
		or	al, al
		jz	short loc_18F89
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0

loc_18F89:
		pop	bp
		retn
sub_18EE7	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_18F8B	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 16
		jnz	short loc_18F9C
		mov	_boss_sprite, 10
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18F9C:
		cmp	_boss_phase_frame, 48
		jnz	short loc_18FD7
		mov	ax, _boss_pos.cur.x
		add	ax, (-12 shl 4)
		push	ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-10 shl 4)
		push	ax
		call	circles_add_shrinking
		mov	ax, _boss_pos.cur.x
		add	ax, (12 shl 4)
		push	ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-10 shl 4)
		push	ax
		call	circles_add_shrinking
		mov	_circles_color, 0Fh
		call	snd_se_play pascal, 8
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18FD7:
		cmp	_boss_phase_frame, 64
		jnz	short loc_18FF5
		mov	_boss_sprite, 0
		push	0FF40h
		push	18h
		call	sub_18A14
		push	0C0h
		push	68h ; 'h'
		call	sub_18A14
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_18FF5:
		cmp	_boss_phase_frame, 64
		jle	short loc_19058
		cmp	_boss_phase_frame, 80
		jnz	short loc_19012
		push	0FF40h
		push	10h
		call	sub_18A14
		push	0C0h
		push	70h ; 'p'
		jmp	short loc_19026
; ---------------------------------------------------------------------------

loc_19012:
		cmp	_boss_phase_frame, 96
		jnz	short loc_19029
		push	0FF40h
		push	8
		call	sub_18A14
		push	0C0h
		push	78h ; 'x'

loc_19026:
		call	sub_18A14

loc_19029:
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_OUTLINED_BALL_BLUE
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.pattern, BP_RING_AIMED
		mov	_bullet_template.count, 6
		call	fp_2D004
		call	sub_18A79
		or	al, al
		jz	short loc_19058
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0

loc_19058:
		pop	bp
		retn
sub_18F8B	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1905A	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 16
		jl	loc_1915B
		cmp	_boss_phase_frame, 16
		jnz	short loc_1908E
		push	0Fh
		call	randring2_next16_and
		mov	dl, 0E0h
		sub	dl, al
		mov	byte_2D02D, dl
		push	0Fh
		call	randring2_next16_and
		add	al, 0A0h
		mov	byte_2D02C, al
		mov	byte_2D02B, 0
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE

loc_1908E:
		mov	ax, _boss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_190DE
		mov	_bullet_template.speed, (1 shl 4)
		mov	al, byte_2D02D
		add	al, 10h
		mov	byte_2D02D, al
		mov	al, byte_2D02C
		add	al, 0F0h
		mov	byte_2D02C, al
		inc	byte_2D02B
		cmp	byte_2D02B, 0Ah
		jbe	short loc_190D7
		push	0Fh
		call	randring2_next16_and
		mov	dl, 0E0h
		sub	dl, al
		mov	byte_2D02D, dl
		push	0Fh
		call	randring2_next16_and
		add	al, 0A0h
		mov	byte_2D02C, al
		mov	byte_2D02B, 0

loc_190D7:
		call	snd_se_play pascal, 15

loc_190DE:
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.pattern, BP_SINGLE
		mov	ax, _boss_pos.cur.y
		add	ax, (-10 shl 4)
		mov	_bullet_template.BT_origin.y, ax
		mov	ax, _boss_pos.cur.x
		add	ax, (12 shl 4)
		mov	_bullet_template.BT_origin.x, ax
		mov	al, byte_2D02D
		mov	_bullet_template.BT_angle, al
		call	sub_1CFA2
		sub	_bullet_template.BT_origin.x, (24 shl 4)
		mov	al, byte_2D02C
		mov	_bullet_template.BT_angle, al
		call	sub_1CFA2
		mov	al, _bullet_template.speed
		add	al, 10
		mov	_bullet_template.speed, al
		mov	al, byte_2D01E
		mov	ah, 0
		push	ax
		mov	ax, _boss_phase_frame
		cwd
		pop	bx
		idiv	bx
		or	dx, dx
		jnz	short loc_1915B
		mov	_bullet_template.pattern, BP_SPREAD_AIMED
		mov	_bullet_template.count, 5
		mov	_bullet_template.BT_delta.spread_angle, 9
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.spawn_type, BST_PELLET
		call	randring2_next16_and pascal, 0Fh
		add	al, (2 shl 4)
		mov	_bullet_template.speed, al
		mov	_bullet_template.BT_special_motion, 0FFh
		call	fp_2D004
		call	fp_2D002

loc_1915B:
		pop	bp
		retn
sub_1905A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kurumi_update	proc far

var_2		= word ptr -2

		enter	2, 0
		push	si
		push	di
		mov	al, _boss_phase
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 6
		ja	loc_195A4
		add	bx, bx
		jmp	cs:off_195D6[bx]

loc_19178:
		cmp	_boss_phase_frame, 0
		jnz	short loc_191DC
		mov	_boss_hp, 4800
		mov	_boss_phase_end_hp, 4800
		mov	Palettes, 60h
		mov	Palettes+1, 0
		mov	Palettes+2, 0
		mov	_palette_changed, 1
		mov	word ptr [bp-2], 0B204h
		xor	si, si
		jmp	short loc_191B3
; ---------------------------------------------------------------------------

loc_191A8:
		mov	bx, [bp-2]
		mov	byte ptr [bx], 0
		inc	si
		add	word ptr [bp-2], 1Ah

loc_191B3:
		cmp	si, 6
		jl	short loc_191A8
		mov	ax, _boss_pos.cur.x
		mov	point_2A8C6.x, ax
		mov	ax, _boss_pos.cur.y
		mov	point_2A8C6.y, ax
		mov	word_2A8D0, 20h	; ' '
		mov	word_2A8CE, 1400h
		mov	byte_2A8D3, 0FDh
		mov	byte_2A8D2, 0Fh
		jmp	short loc_19235
; ---------------------------------------------------------------------------

loc_191DC:
		cmp	_boss_phase_frame, 288
		jl	short loc_19226
		cmp	_boss_phase_frame, 296
		jnz	short loc_191F1
		mov	byte_2A8D2, 9

loc_191F1:
		test	byte ptr _boss_phase_frame, 7
		jnz	short loc_191FB
		call	sub_13B21

loc_191FB:
		cmp	_boss_phase_frame, 320
		jl	short loc_19235
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		call	snd_se_play pascal, 13
		mov	byte_259F1, 0
		mov	fp_255AC, offset kurumi_bg_render
		mov	byte_2CDCA, 0
		jmp	short loc_19235
; ---------------------------------------------------------------------------

loc_19226:
		cmp	_boss_phase_frame, 128
		jnz	short loc_19235
		call	snd_se_play pascal, 8

loc_19235:
		call	sub_1E67C
		jmp	loc_195A9
; ---------------------------------------------------------------------------

loc_1923B:
		call	sub_1E67C
		cmp	_boss_phase_frame, 32
		jl	loc_195A9
		push	0FFFF0CE4h
		call	sub_1E6F3
		mov	_boss_mode, 3
		mov	_boss_angle, 192
		call	snd_se_play pascal, 6
		jmp	loc_195A9
; ---------------------------------------------------------------------------

loc_19264:
		mov	al, _boss_mode
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 4
		ja	loc_19309
		add	bx, bx
		jmp	cs:off_195CC[bx]

loc_19279:
		call	sub_18B68
		cmp	_boss_phase_frame, 96
		jl	loc_19309
		mov	_boss_phase_frame, 0
		push	3
		call	randring2_next16_and
		inc	al
		mov	_boss_mode, al
		inc	_boss_mode_change
		cmp	_boss_mode_change, 10
		ja	short loc_19317
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	ax, _boss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.patnum, PAT_BULLET16_N_OUTLINED_BALL_BLUE
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 22
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		call	fp_2D004
		mov	_bullet_template.speed, (1 shl 4)
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	di, ax
		cmp	di, 5
		jle	short loc_192DE
		mov	di, 5

loc_192DE:
		xor	si, si
		jmp	short loc_192F6
; ---------------------------------------------------------------------------

loc_192E2:
		call	sub_1CFA2
		inc	si
		mov	al, _bullet_template.speed
		add	al, 8
		mov	_bullet_template.speed, al
		mov	al, _bullet_template.BT_angle
		add	al, -3
		mov	_bullet_template.BT_angle, al

loc_192F6:
		cmp	si, di
		jl	short loc_192E2
		jmp	short loc_19309
; ---------------------------------------------------------------------------

loc_192FC:
		call	sub_18BE6
		jmp	short loc_19309
; ---------------------------------------------------------------------------

loc_19301:
		call	sub_18C76
		jmp	short loc_19309
; ---------------------------------------------------------------------------

loc_19306:
		call	sub_18D04

loc_19309:
		call	sub_1E64E
		or	al, al
		jz	loc_195A9
		push	0Ah
		call	sub_19FD8

loc_19317:
		push	10802h
		call	sub_1E6F3
		mov	byte_2CFF8, 40h
		jmp	loc_195A9
; ---------------------------------------------------------------------------

loc_19328:
		call	sub_18A79
		mov	al, _boss_mode
		mov	ah, 0
		or	ax, ax
		jz	short loc_1933B
		cmp	ax, 1
		jz	short loc_19350
		jmp	short loc_19353
; ---------------------------------------------------------------------------

loc_1933B:
		cmp	_boss_phase_frame, 128
		jl	short loc_19353
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 1
		jmp	short loc_19353
; ---------------------------------------------------------------------------

loc_19350:
		call	sub_18DB6

loc_19353:
		cmp	_boss_phase_frame, 2000
		jg	short loc_19369
		call	sub_1E64E
		or	al, al
		jz	loc_195A9
		push	0Ah
		call	sub_19FD8

loc_19369:
		push	20226h
		jmp	loc_1942B
; ---------------------------------------------------------------------------

loc_19372:
		mov	al, _boss_mode
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 3
		ja	loc_19417
		add	bx, bx
		jmp	cs:off_195C4[bx]

loc_19387:
		call	sub_18B68
		cmp	_boss_phase_frame, 96
		jl	loc_19417
		mov	_boss_phase_frame, 0
		push	3
		call	randring2_next16_mod
		inc	al
		mov	_boss_mode, al
		inc	_boss_mode_change
		cmp	_boss_mode_change, 10
		ja	short loc_19425
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	ax, _boss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.patnum, PAT_BULLET16_N_OUTLINED_BALL_BLUE
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 22
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		call	fp_2D004
		mov	_bullet_template.speed, (1 shl 4)
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	di, ax
		cmp	di, 5
		jle	short loc_193EC
		mov	di, 5

loc_193EC:
		xor	si, si
		jmp	short loc_19404
; ---------------------------------------------------------------------------

loc_193F0:
		call	sub_1CFA2
		inc	si
		mov	al, _bullet_template.speed
		add	al, 8
		mov	_bullet_template.speed, al
		mov	al, _bullet_template.BT_angle
		add	al, 3
		mov	_bullet_template.BT_angle, al

loc_19404:
		cmp	si, di
		jl	short loc_193F0
		jmp	short loc_19417
; ---------------------------------------------------------------------------

loc_1940A:
		call	sub_18E43
		jmp	short loc_19417
; ---------------------------------------------------------------------------

loc_1940F:
		call	sub_18EE7
		jmp	short loc_19417
; ---------------------------------------------------------------------------

loc_19414:
		call	sub_18F8B

loc_19417:
		call	sub_1E64E
		or	al, al
		jz	loc_195A9
		push	0Ah
		call	sub_19FD8

loc_19425:
		push	30000h

loc_1942B:
		call	sub_1E6F3
		jmp	loc_195A9
; ---------------------------------------------------------------------------

loc_19431:
		call	sub_18A79
		mov	al, _boss_mode
		mov	ah, 0
		or	ax, ax
		jz	short loc_19444
		cmp	ax, 1
		jz	short loc_194BE
		jmp	short loc_194C1
; ---------------------------------------------------------------------------

loc_19444:
		cmp	_boss_phase_frame, 144
		jnz	short loc_1945E
		push	_boss_pos.cur.x
		push	_boss_pos.cur.y
		call	circles_add_shrinking
		mov	_circles_color, 0Fh

loc_1945E:
		cmp	_boss_phase_frame, 64
		jle	short loc_1947A
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 1
		mov	_boss_sprite, 12
		mov	_boss_angle, 128

loc_1947A:
		cmp	_boss_pos.cur.x, (191 shl 4)
		jge	short loc_1948A
		mov	_boss_pos.velocity.x, 24
		jmp	short loc_19498
; ---------------------------------------------------------------------------

loc_1948A:
		cmp	_boss_pos.cur.x, (193 shl 4)
		jle	short loc_19498
		mov	_boss_pos.velocity.x, -24

loc_19498:
		cmp	_boss_pos.cur.y, (79 shl 4)
		jge	short loc_194A8
		mov	_boss_pos.velocity.y, 12
		jmp	short loc_194B6
; ---------------------------------------------------------------------------

loc_194A8:
		cmp	_boss_pos.cur.y, (81 shl 4)
		jle	short loc_194B6
		mov	_boss_pos.velocity.y, -12

loc_194B6:
		push	offset _boss_pos
		call	_motion_update_2
		jmp	short loc_194C1
; ---------------------------------------------------------------------------

loc_194BE:
		call	sub_1905A

loc_194C1:
		call	sub_1E64E
		or	al, al
		jnz	short loc_194D2
		cmp	_boss_phase_frame, 700
		jl	loc_195A9

loc_194D2:
		inc	_boss_phase
		call	sparks_add_circle pascal, _boss_pos.cur.x, _boss_pos.cur.y, large (((8 shl 4) shl 16) or 48)
		call	boss_explode_small pascal, 4
		cmp	_boss_phase_frame, 600
		jge	short loc_194FB
		mov	_boss_mode_change, 1
		jmp	short loc_19500
; ---------------------------------------------------------------------------

loc_194FB:
		mov	_boss_mode_change, 0

loc_19500:
		mov	_boss_phase_frame, 0
		jmp	loc_195A9
; ---------------------------------------------------------------------------

loc_19509:
		call	sub_18A79
		cmp	_boss_pos.cur.x, (191 shl 4)
		jge	short loc_1951C
		mov	_boss_pos.velocity.x, 24
		jmp	short loc_1952A
; ---------------------------------------------------------------------------

loc_1951C:
		cmp	_boss_pos.cur.x, (193 shl 4)
		jle	short loc_1952A
		mov	_boss_pos.velocity.x, -24

loc_1952A:
		cmp	_boss_pos.cur.y, (79 shl 4)
		jge	short loc_1953A
		mov	_boss_pos.velocity.y, 12
		jmp	short loc_19548
; ---------------------------------------------------------------------------

loc_1953A:
		cmp	_boss_pos.cur.y, (81 shl 4)
		jle	short loc_19548
		mov	_boss_pos.velocity.y, -12

loc_19548:
		push	offset _boss_pos
		call	_motion_update_2
		inc	_boss_phase_frame
		cmp	_boss_phase_frame, 16
		jnz	short loc_1955E
		call	boss_explode_small pascal, 4

loc_1955E:
		cmp	_boss_phase_frame, 32
		jnz	short loc_195A9
		call	boss_explode_big pascal, 0
		mov	_boss_phase, PHASE_EXPLODE_BIG
		mov	al, _boss_mode_change
		mov	_bullet_clear_trigger, al
		cmp	_boss_mode_change, 0
		jz	short loc_19581
		push	14h
		call	sub_19FD8

loc_19581:
		mov	_boss_sprite, 4
		mov	_boss_phase_frame, 0
		call	snd_se_play pascal, 12
		mov	Palettes, 0
		mov	_palette_changed, 1
		mov	_player_invincibility_time, BOSS_DEFEAT_INVINCIBILITY_FRAMES
		jmp	short loc_195A9
; ---------------------------------------------------------------------------

loc_195A4:
		call	sub_1E743
		jmp	short loc_195BF
; ---------------------------------------------------------------------------

loc_195A9:
		mov	ax, _boss_pos.cur.x
		mov	_homing_target.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_homing_target.y, ax
		push	_boss_hp
		push	4800
		call	sub_19F16

loc_195BF:
		pop	di
		pop	si
		leave
		retf
kurumi_update	endp

; ---------------------------------------------------------------------------
		db 0
off_195C4	dw offset loc_19387
		dw offset loc_1940A
		dw offset loc_1940F
		dw offset loc_19414
off_195CC	dw offset loc_19279
		dw offset loc_192FC
		dw offset loc_19301
		dw offset loc_19306
		dw offset loc_19306
off_195D6	dw offset loc_19178
		dw offset loc_1923B
		dw offset loc_19264
		dw offset loc_19328
		dw offset loc_19372
		dw offset loc_19431
		dw offset loc_19509

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_195E4	proc near

var_4		= word ptr -4
var_2		= word ptr -2

		enter	4, 0
		mov	ax, _boss_phase_frame
		add	ax, -70
		push	ax
		push	70006h
		call	sub_13B89
		cmp	_boss_phase_frame, 16
		jl	short loc_19678
		cmp	_boss_phase_frame, 16
		jnz	short loc_19647
		push	1400h
		call	randring2_next16_mod
		add	ax, 200h
		mov	[bp+var_2], ax
		push	600h
		call	randring2_next16_mod
		add	ax, 400h
		mov	[bp+var_4], ax
		mov	ax, [bp+var_2]
		sub	ax, _boss_pos.cur.x
		mov	bx, (4 shl 4)
		cwd
		idiv	bx
		mov	_boss_pos.velocity.x, ax
		mov	ax, [bp+var_4]
		sub	ax, _boss_pos.cur.y
		cwd
		idiv	bx
		mov	_boss_pos.velocity.y, ax
		mov	word_2A8CE, 600h
		mov	word_2A8D0, 8

loc_19647:
		cmp	_boss_phase_frame, 70
		jge	short loc_19656
		push	offset _boss_pos
		call	_motion_update_2
		jmp	short loc_19682
; ---------------------------------------------------------------------------

loc_19656:
		cmp	_boss_phase_frame, 70
		jnz	short loc_19671
		push	_boss_pos.cur.x
		push	_boss_pos.cur.y
		call	circles_add_shrinking
		mov	_circles_color, 0Fh
		jmp	short loc_19682
; ---------------------------------------------------------------------------

loc_19671:
		cmp	_boss_phase_frame, 86
		jge	short loc_1967D

loc_19678:
		mov	ax, 1
		leave
		retn
; ---------------------------------------------------------------------------

loc_1967D:
		mov	ax, 2
		leave
		retn
; ---------------------------------------------------------------------------

loc_19682:
		xor	ax, ax
		leave
		retn
sub_195E4	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_19686	proc near
		push	bp
		mov	bp, sp
		call	sub_195E4
		cmp	ax, 2
		jnz	loc_1971E
		cmp	_boss_phase_frame, 86
		jnz	short loc_196C2
		push	1
		call	randring2_next16_and
		mov	_boss_mode_change, al
		cmp	_boss_mode_change, 0
		jnz	short loc_196AD
		mov	al, 0
		jmp	short loc_196AF
; ---------------------------------------------------------------------------

loc_196AD:
		mov	al, 80h

loc_196AF:
		mov	_boss_angle, al
		cmp	_boss_mode_change, 0
		jnz	short loc_196BD
		mov	al, 0Bh
		jmp	short loc_196BF
; ---------------------------------------------------------------------------

loc_196BD:
		mov	al, 0F5h

loc_196BF:
		mov	_boss_mode_change, al

loc_196C2:
		cmp	_stage_frame_mod2, 0
		jnz	short loc_19712
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	ax, _boss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 2
		mov	al, _boss_angle
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.speed, (1 shl 4) + 14
		call	fp_2D000
		mov	al, _bullet_template.BT_angle
		add	al, 5
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.speed, (1 shl 4) + 4
		call	fp_2D000
		mov	al, _boss_mode_change
		add	_boss_angle, al
		call	snd_se_play pascal, 9

loc_19712:
		cmp	_boss_phase_frame, 118
		jl	short loc_1971E
		mov	_boss_mode, 0

loc_1971E:
		pop	bp
		retn
sub_19686	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_19720	proc near
		push	bp
		mov	bp, sp
		call	sub_195E4
		cmp	ax, 2
		jnz	loc_197B9
		cmp	_boss_phase_frame, 86
		jnz	short loc_19751
		mov	ax, _player_pos.cur.y
		sub	ax, _boss_pos.cur.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, _boss_pos.cur.x
		push	ax
		call	iatan2
		mov	_boss_angle, al
		mov	_bullet_template.speed, (1 shl 4)

loc_19751:
		cmp	_stage_frame_mod4, 0
		jnz	short loc_197AD
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_OUTLINED_BALL_WHITE
		mov	ax, _boss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 3
		mov	_bullet_template.BT_delta.spread_angle, 0Ch
		mov	_bullet_template.BT_special_motion, 0FFh
		mov	al, _boss_angle
		add	al, -20h
		mov	_bullet_template.BT_angle, al
		call	fp_2D004
		call	fp_2D002
		mov	al, _bullet_template.BT_angle
		add	al, 40h
		mov	_bullet_template.BT_angle, al
		call	fp_2D002
		call	snd_se_play pascal, 3
		mov	al, _bullet_template.speed
		add	al, 6
		mov	_bullet_template.speed, al

loc_197AD:
		cmp	_boss_phase_frame, 118
		jl	short loc_197B9
		mov	_boss_mode, 0

loc_197B9:
		pop	bp
		retn
sub_19720	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_197BB	proc near
		push	bp
		mov	bp, sp
		call	sub_195E4
		cmp	ax, 2
		jnz	short loc_19812
		cmp	_stage_frame_mod8, 0
		jnz	short loc_19806
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_OUTLINED_BALL_WHITE
		mov	ax, _boss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.pattern, BP_RING_AIMED
		mov	_bullet_template.count, 16
		mov	_bullet_template.speed, (2 shl 4)
		mov	_bullet_template.BT_angle, 0
		call	fp_2D004
		call	fp_2D000
		call	snd_se_play pascal, 9

loc_19806:
		cmp	_boss_phase_frame, 118
		jl	short loc_19812
		mov	_boss_mode, 0

loc_19812:
		pop	bp
		retn
sub_197BB	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_19814	proc near
		push	bp
		mov	bp, sp
		call	sub_195E4
		cmp	ax, 2
		jnz	short loc_19876
		cmp	_stage_frame_mod8, 0
		jnz	short loc_1986A
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	ax, _boss_pos.cur.x
		add	ax, (-32 shl 4)
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 8
		mov	_bullet_template.speed, (1 shl 4) + 14
		mov	al, _bullet_template.BT_angle
		add	al, 8
		mov	_bullet_template.BT_angle, al
		call	fp_2D004
		call	fp_2D000
		add	_bullet_template.BT_origin.x, (64 shl 4)
		call	fp_2D000
		call	snd_se_play pascal, 9

loc_1986A:
		cmp	_boss_phase_frame, 118
		jl	short loc_19876
		mov	_boss_mode, 0

loc_19876:
		pop	bp
		retn
sub_19814	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_19878	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 1
		jnz	short loc_1989A
		cmp	_boss_pos.cur.x, (192 shl 4)
		jge	short loc_1988F
		mov	ax, (1 shl 4)
		jmp	short loc_19892
; ---------------------------------------------------------------------------

loc_1988F:
		mov	ax, (-1 shl 4)

loc_19892:
		mov	_boss_pos.velocity.x, ax
		mov	_boss_angle, 0

loc_1989A:
		pushd	(1 shl 4)
		mov	al, _boss_angle
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_SinTable8[bx]
		call	vector1_at
		mov	_boss_pos.velocity.y, ax
		cmp	_boss_pos.cur.y, (96 shl 4)
		jl	short loc_198C0
		mov	_boss_pos.velocity.y, (-1 shl 4)

loc_198C0:
		cmp	_boss_pos.cur.y, (48 shl 4)
		jg	short loc_198CE
		mov	_boss_pos.velocity.y, (1 shl 4)

loc_198CE:
		mov	al, _boss_angle
		add	al, 2
		mov	_boss_angle, al
		push	offset _boss_pos
		call	_motion_update_2
		cmp	ax, (32 shl 4)
		jbe	short loc_198E6
		cmp	ax, (352 shl 4)
		jb	short loc_198F0

loc_198E6:
		mov	ax, -1
		imul	_boss_pos.velocity.x
		mov	_boss_pos.velocity.x, ax

loc_198F0:
		cmp	_stage_frame_mod4, 0
		jnz	loc_19989
		cmp	_rank, RANK_EASY
		jnz	short loc_19909
		cmp	_stage_frame_mod8, 0
		jz	loc_19989

loc_19909:
		mov	_bullet_template.patnum, PAT_BULLET16_N_OUTLINED_BALL_WHITE
		mov	ax, _boss_pos.cur.x
		add	ax, (-32 shl 4)
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.pattern, BP_RANDOM_ANGLE
		mov	_bullet_template.count, 1
		cmp	_boss_hp, 700
		jg	short loc_19942
		cmp	_rank, RANK_LUNATIC
		jnb	short loc_1993D
		mov	_bullet_template.count, 2
		jmp	short loc_19942
; ---------------------------------------------------------------------------

loc_1993D:
		mov	_bullet_template.count, 4

loc_19942:
		mov	_bullet_template.speed, (2 shl 4)
		call	randring2_next16_and pascal, 1
		or	ax, ax
		jnz	short loc_19954
		mov	al, BST_PELLET
		jmp	short loc_19956
; ---------------------------------------------------------------------------

loc_19954:
		mov	al, BST_BULLET16_CLOUD_FORWARDS

loc_19956:
		mov	_bullet_template.spawn_type, al
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		call	fp_2D004
		call	fp_2D000
		add	_bullet_template.BT_origin.x, (64 shl 4)
		call	randring2_next16_and pascal, 1
		or	ax, ax
		jnz	short loc_1997A
		mov	al, BST_PELLET
		jmp	short loc_1997C
; ---------------------------------------------------------------------------

loc_1997A:
		mov	al, BST_BULLET16_CLOUD_FORWARDS

loc_1997C:
		mov	_bullet_template.spawn_type, al
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		call	fp_2D000

loc_19989:
		pop	bp
		retn
sub_19878	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1998B	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 96
		jz	short loc_199AD
		cmp	_boss_phase_frame, 160
		jz	short loc_199AD
		cmp	_boss_phase_frame, 224
		jz	short loc_199AD
		cmp	_boss_phase_frame, 288
		jnz	short loc_199BC

loc_199AD:
		mov	ax, _bullet_template.BT_origin.x
		mov	point_2A8C6.x, ax
		mov	ax, _bullet_template.BT_origin.y
		mov	point_2A8C6.y, ax
		call	sub_13B21

loc_199BC:
		cmp	_boss_phase_frame, 112
		jz	short loc_199DB
		cmp	_boss_phase_frame, 160
		jz	short loc_199DB
		cmp	_boss_phase_frame, 240
		jz	short loc_199DB
		cmp	_boss_phase_frame, 304
		jnz	short loc_199ED

loc_199DB:
		call	circles_add_shrinking pascal, _bullet_template.BT_origin.x, _bullet_template.BT_origin.y
		mov	_circles_color, 0Fh

loc_199ED:
		cmp	_stage_frame_mod4, 0
		jnz	loc_19AA1
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.pattern, BP_SINGLE
		mov	al, _boss_angle
		add	al, -7
		mov	_boss_angle, al
		mov	_bullet_template.speed, (2 shl 4)
		mov	_bullet_template.BT_angle, al
		call	fp_2D004
		call	sub_1CFA2
		cmp	_boss_phase_frame, 128
		jl	loc_19AA1
		cmp	_boss_phase_frame, 192
		jl	short loc_19A4F
		cmp	_boss_phase_frame, 256
		jl	short loc_19A44
		cmp	_boss_phase_frame, 320
		jge	short loc_19A56
		mov	al, _bullet_template.BT_angle
		add	al, 40h
		mov	_bullet_template.BT_angle, al
		call	sub_1CFA2

loc_19A44:
		mov	al, _bullet_template.BT_angle
		add	al, 40h
		mov	_bullet_template.BT_angle, al
		call	sub_1CFA2

loc_19A4F:
		mov	al, _bullet_template.BT_angle
		add	al, 40h
		jmp	short loc_19A9B
; ---------------------------------------------------------------------------

loc_19A56:
		mov	al, _bullet_template.BT_angle
		add	al, 40h
		mov	_bullet_template.BT_angle, al
		call	sub_1CFA2
		mov	al, _bullet_template.BT_angle
		add	al, 40h
		mov	_bullet_template.BT_angle, al
		call	sub_1CFA2
		mov	al, _bullet_template.BT_angle
		add	al, 40h
		mov	_bullet_template.BT_angle, al
		call	sub_1CFA2
		mov	al, _bullet_template.speed
		add	al, (1 shl 4)
		mov	_bullet_template.speed, al
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_OUTLINED_BALL_WHITE
		mov	al, _bullet_template.BT_angle
		neg	al
		add	al, -20h
		mov	_bullet_template.BT_angle, al
		call	sub_1CFA2
		mov	al, _bullet_template.BT_angle
		add	al, 80h

loc_19A9B:
		mov	_bullet_template.BT_angle, al
		call	sub_1CFA2

loc_19AA1:
		pop	bp
		retn
sub_1998B	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

orange_update	proc far
		push	bp
		mov	bp, sp
		push	si
		mov	ax, _boss_pos.cur.x
		mov	point_2A8C6.x, ax
		mov	ax, _boss_pos.cur.y
		mov	point_2A8C6.y, ax
		mov	al, _boss_phase
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 5
		ja	loc_19E88
		add	bx, bx
		jmp	cs:off_19EB0[bx]

loc_19AC8:
		cmp	_boss_phase_frame, 0
		jnz	short loc_19AEF
		mov	_boss_hp, 3050
		mov	_boss_phase_end_hp, 1950
		mov	Palettes, 0
		mov	Palettes+1, 0
		mov	Palettes+2, 60h
		mov	_palette_changed, 1

loc_19AEF:
		inc	_boss_phase_frame
		cmp	_boss_phase_frame, 192
		jnz	short loc_19B35
		mov	al, _boss_sprite
		add	al, 2
		mov	_boss_sprite, al
		call	snd_se_play pascal, 8
		mov	ax, _boss_pos.cur.x
		add	ax, (8 shl 4)
		mov	point_2A8C6.x, ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-40 shl 4)
		mov	point_2A8C6.y, ax
		mov	word_2A8CE, 1400h
		mov	word_2A8D0, 20h	; ' '
		mov	byte_2A8D3, 3
		mov	byte_2A8D2, 7
		jmp	loc_19C02
; ---------------------------------------------------------------------------

loc_19B35:
		cmp	_boss_phase_frame, 320
		jle	loc_19C02
		cmp	_boss_phase_frame, 336
		jnz	short loc_19B4C
		mov	byte_2A8D2, 6

loc_19B4C:
		test	byte ptr _boss_phase_frame, 7
		jnz	short loc_19B56
		call	sub_13B21

loc_19B56:
		cmp	_boss_phase_frame, 352
		jl	loc_19C02
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		call	snd_se_play pascal, 13
		mov	byte_2D02D, 0
		mov	byte_2D02C, 0FFh
		mov	fp_255AC, offset orange_bg_render
		mov	byte_2CDCA, 0
		jmp	short loc_19C02
; ---------------------------------------------------------------------------

loc_19B88:
		inc	_boss_phase_frame
		cmp	_boss_phase_frame, 32
		jl	short loc_19C02
		mov	word_2A8CE, 400h
		mov	byte_2A8D3, 2
		mov	word_2A8D0, 8
		mov	_boss_phase, 2
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0
		mov	al, _boss_sprite
		add	al, 2
		mov	_boss_sprite, al
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	ax, _boss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 16
		mov	_bullet_template.speed, (4 shl 4)
		mov	_bullet_template.BT_angle, 0
		call	fp_2D004
		xor	si, si
		jmp	short loc_19BF6
; ---------------------------------------------------------------------------

loc_19BE9:
		call	fp_2D000
		mov	al, _bullet_template.speed
		add	al, (-1 shl 4)
		mov	_bullet_template.speed, al
		inc	si

loc_19BF6:
		cmp	si, 3
		jl	short loc_19BE9
		call	snd_se_play pascal, 6

loc_19C02:
		push	1000100h
		push	0Ah
		call	sub_1E5D8
		jmp	loc_19E8D
; ---------------------------------------------------------------------------

loc_19C10:
		mov	al, _boss_mode
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 4
		ja	short loc_19C61
		add	bx, bx
		jmp	cs:off_19EA6[bx]

loc_19C23:
		mov	_boss_phase_frame, 0

loc_19C29:
		push	3
		call	randring2_next16_and
		inc	al
		mov	_boss_mode, al
		mov	al, byte_2D02C
		cmp	al, _boss_mode
		jz	short loc_19C29
		mov	al, _boss_mode
		mov	byte_2D02C, al
		inc	byte_2D02D
		cmp	byte_2D02D, 10h
		jb	short loc_19C61
		jmp	short loc_19C6F
; ---------------------------------------------------------------------------

loc_19C4F:
		call	sub_19686
		jmp	short loc_19C61
; ---------------------------------------------------------------------------

loc_19C54:
		call	sub_19720
		jmp	short loc_19C61
; ---------------------------------------------------------------------------

loc_19C59:
		call	sub_197BB
		jmp	short loc_19C61
; ---------------------------------------------------------------------------

loc_19C5E:
		call	sub_19814

loc_19C61:
		call	sub_1E64E
		or	al, al
		jz	loc_19E8D
		push	5
		call	sub_19FD8

loc_19C6F:
		push	101C2h
		call	sub_1E6F3
		mov	Palettes, 70h	; 'p'
		mov	Palettes+2, 70h	; 'p'
		mov	_palette_changed, 1
		jmp	loc_19E8D
; ---------------------------------------------------------------------------

loc_19C8A:
		mov	al, _boss_mode
		mov	ah, 0
		or	ax, ax
		jz	short loc_19C9A
		cmp	ax, 1
		jz	short loc_19CAF
		jmp	short loc_19CB2
; ---------------------------------------------------------------------------

loc_19C9A:
		cmp	_boss_phase_frame, 128
		jle	short loc_19CB2
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 1
		jmp	short loc_19CB2
; ---------------------------------------------------------------------------

loc_19CAF:
		call	sub_19878

loc_19CB2:
		cmp	_boss_phase_frame, 1500
		jg	short loc_19CC8
		call	sub_1E64E
		or	al, al
		jz	loc_19E8D
		push	5
		call	sub_19FD8

loc_19CC8:
		push	10000h
		call	sub_1E6F3
		mov	al, _boss_sprite
		add	al, 4
		mov	_boss_sprite, al
		mov	Palettes, 90h
		mov	Palettes+2, 20h	; ' '
		mov	_palette_changed, 1
		mov	byte_2A8D2, 9
		jmp	loc_19E8D
; ---------------------------------------------------------------------------

loc_19CF0:
		mov	ax, _boss_pos.cur.x
		add	ax, (8 shl 4)
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-16 shl 4)
		mov	_bullet_template.BT_origin.y, ax
		mov	al, _boss_mode
		mov	ah, 0
		or	ax, ax
		jz	short loc_19D15
		cmp	ax, 1
		jz	loc_19D9B
		jmp	loc_19D9E
; ---------------------------------------------------------------------------

loc_19D15:
		cmp	_boss_phase_frame, 96
		jnz	short loc_19D2B
		mov	ax, _bullet_template.BT_origin.x
		mov	point_2A8C6.x, ax
		mov	ax, _bullet_template.BT_origin.y
		mov	point_2A8C6.y, ax
		call	sub_13B21

loc_19D2B:
		cmp	_boss_phase_frame, 112
		jnz	short loc_19D44
		call	circles_add_shrinking pascal, _bullet_template.BT_origin.x, _bullet_template.BT_origin.y
		mov	_circles_color, 0Fh

loc_19D44:
		cmp	_boss_phase_frame, 128
		jle	short loc_19D57
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 1

loc_19D57:
		cmp	_boss_pos.cur.x, (191 shl 4)
		jge	short loc_19D67
		mov	_boss_pos.velocity.x, 24
		jmp	short loc_19D75
; ---------------------------------------------------------------------------

loc_19D67:
		cmp	_boss_pos.cur.x, (193 shl 4)
		jle	short loc_19D75
		mov	_boss_pos.velocity.x, -24

loc_19D75:
		cmp	_boss_pos.cur.y, (79 shl 4)
		jge	short loc_19D85
		mov	_boss_pos.velocity.y, 12
		jmp	short loc_19D93
; ---------------------------------------------------------------------------

loc_19D85:
		cmp	_boss_pos.cur.y, (81 shl 4)
		jle	short loc_19D93
		mov	_boss_pos.velocity.y, -12

loc_19D93:
		push	offset _boss_pos
		call	_motion_update_2
		jmp	short loc_19D9E
; ---------------------------------------------------------------------------

loc_19D9B:
		call	sub_1998B

loc_19D9E:
		cmp	_boss_phase_frame, 600
		jg	short loc_19DAF
		call	sub_1E64E
		or	al, al
		jz	loc_19E8D

loc_19DAF:
		cmp	_boss_phase_frame, 600
		jg	short loc_19DBE
		mov	_boss_mode_change, 1
		jmp	short loc_19DC3
; ---------------------------------------------------------------------------

loc_19DBE:
		mov	_boss_mode_change, 0

loc_19DC3:
		call	boss_explode_small pascal, 3
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0
		call	sparks_add_circle pascal, _boss_pos.cur.x, _boss_pos.cur.y, large (((8 shl 4) shl 16) or 48)
		jmp	loc_19E8D
; ---------------------------------------------------------------------------

loc_19DEB:
		cmp	_boss_pos.cur.x, (191 shl 4)
		jge	short loc_19DFB
		mov	_boss_pos.velocity.x, 24
		jmp	short loc_19E09
; ---------------------------------------------------------------------------

loc_19DFB:
		cmp	_boss_pos.cur.x, (193 shl 4)
		jle	short loc_19E09
		mov	_boss_pos.velocity.x, -24

loc_19E09:
		cmp	_boss_pos.cur.y, (79 shl 4)
		jge	short loc_19E19
		mov	_boss_pos.velocity.y, 12
		jmp	short loc_19E27
; ---------------------------------------------------------------------------

loc_19E19:
		cmp	_boss_pos.cur.y, (81 shl 4)
		jle	short loc_19E27
		mov	_boss_pos.velocity.y, -12

loc_19E27:
		push	offset _boss_pos
		call	_motion_update_2
		inc	_boss_phase_frame
		cmp	_boss_phase_frame, 16
		jnz	short loc_19E3D
		call	boss_explode_small pascal, 4

loc_19E3D:
		cmp	_boss_phase_frame, 32
		jnz	short loc_19E8D
		call	boss_explode_big pascal, 0
		mov	_boss_phase, PHASE_EXPLODE_BIG
		mov	al, _boss_mode_change
		mov	_bullet_clear_trigger, al
		cmp	_boss_mode_change, 0
		jz	short loc_19E60
		push	0Ah
		call	sub_19FD8

loc_19E60:
		mov	_boss_sprite, 4
		mov	_boss_phase_frame, 0
		call	snd_se_play pascal, 12
		mov	Palettes, 0
		mov	Palettes+2, 0
		mov	_palette_changed, 1
		mov	_player_invincibility_time, BOSS_DEFEAT_INVINCIBILITY_FRAMES
		jmp	short loc_19E8D
; ---------------------------------------------------------------------------

loc_19E88:
		call	sub_1E743
		jmp	short loc_19EA3
; ---------------------------------------------------------------------------

loc_19E8D:
		mov	ax, _boss_pos.cur.x
		mov	_homing_target.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_homing_target.y, ax
		push	_boss_hp
		push	3050
		call	sub_19F16

loc_19EA3:
		pop	si
		pop	bp
		retf
orange_update	endp

; ---------------------------------------------------------------------------
off_19EA6	dw offset loc_19C23
		dw offset loc_19C4F
		dw offset loc_19C54
		dw offset loc_19C59
		dw offset loc_19C5E
off_19EB0	dw offset loc_19AC8
		dw offset loc_19B88
		dw offset loc_19C10
		dw offset loc_19C8A
		dw offset loc_19CF0
		dw offset loc_19DEB

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_19EBC	proc far
		push	bp
		mov	bp, sp
		mov	_midboss_invalidate?, offset nullfunc_near
		mov	_midboss_render, offset nullfunc_near
		setfarfp	_midboss_update, nullsub_2
		mov	_midboss_active, 0
		mov	_midboss_hp, 0
		pop	bp
		retf
sub_19EBC	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_19EE4	proc far
		push	bp
		mov	bp, sp
		mov	ax, _midboss_frames_until
		cmp	ax, _stage_frame
		jnz	short loc_19F14
		mov	_midboss_invalidate?, offset sub_12124
		mov	ax, _midboss_render_func
		mov	_midboss_render, ax
		mov	eax, _midboss_update_func
		mov	_midboss_update, eax
		mov	_midboss_phase, 0
		mov	_midboss_phase_frame, 0
		mov	_midboss_active, 1

loc_19F14:
		pop	bp
		retf
sub_19EE4	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_19F16	proc near

arg_0		= word ptr  4
arg_2		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	di, [bp+arg_2]
		or	di, di
		jg	short loc_19F26
		xor	si, si
		jmp	short loc_19F4B
; ---------------------------------------------------------------------------

loc_19F26:
		cmp	di, [bp+arg_0]
		jl	short loc_19F30
		mov	si, 80h
		jmp	short loc_19F4B
; ---------------------------------------------------------------------------

loc_19F30:
		movsx	eax, di
		shl	eax, 7
		movsx	ebx, [bp+arg_0]
		cdq
		idiv	ebx
		mov	si, ax
		cmp	si, 80h
		jge	short loc_19F4B
		inc	si

loc_19F4B:
		cmp	word_23210, si
		jge	short loc_19F55
		inc	word_23210

loc_19F55:
		cmp	word_23210, si
		jle	short loc_19F5F
		mov	word_23210, si

loc_19F5F:
		push	word_23210
		call	sub_F0DD
		pop	di
		pop	si
		pop	bp
		retn	4
sub_19F16	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_19F6E	proc near

var_4		= word ptr -4
var_2		= word ptr -2
arg_0		= word ptr  4

		enter	4, 0
		push	si
		push	di
		mov	ax, [bp+arg_0]
		imul	ax, 1280
		movzx	eax, ax
		add	_score_delta, eax
		mov	byte_21CC8, 0
		mov	ax, _midboss_pos.cur.x
		add	ax, (-64 shl 4)
		mov	[bp+var_2], ax
		mov	ax, _midboss_pos.cur.y
		add	ax, (-64 shl 4)
		mov	[bp+var_4], ax
		xor	di, di
		jmp	short loc_19FCD
; ---------------------------------------------------------------------------

loc_19F9F:
		push	800h
		call	randring2_next16_mod
		add	ax, [bp+var_2]
		mov	si, ax
		or	si, si
		jge	short loc_19FB2
		xor	si, si
		jmp	short loc_19FBB
; ---------------------------------------------------------------------------

loc_19FB2:
		cmp	si, 1800h
		jle	short loc_19FBB
		mov	si, 1800h

loc_19FBB:
		push	si
		push	800h
		call	randring2_next16_mod
		add	ax, [bp+var_4]
		push	ax
		push	500h
		call	sub_13D90
		inc	di

loc_19FCD:
		cmp	di, [bp+arg_0]
		jb	short loc_19F9F
		pop	di
		pop	si
		leave
		retn	2
sub_19F6E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_19FD8	proc near

var_4		= word ptr -4
var_2		= word ptr -2
arg_0		= word ptr  4

		enter	4, 0
		push	si
		push	di
		mov	ax, [bp+arg_0]
		imul	ax, 1280
		movzx	eax, ax
		add	_score_delta, eax
		mov	byte_21CC8, 0
		mov	ax, _boss_pos.cur.x
		add	ax, (-64 shl 4)
		mov	[bp+var_2], ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-64 shl 4)
		mov	[bp+var_4], ax
		xor	di, di
		jmp	short loc_1A037
; ---------------------------------------------------------------------------

loc_1A009:
		push	800h
		call	randring2_next16_mod
		add	ax, [bp+var_2]
		mov	si, ax
		or	si, si
		jge	short loc_1A01C
		xor	si, si
		jmp	short loc_1A025
; ---------------------------------------------------------------------------

loc_1A01C:
		cmp	si, 1800h
		jle	short loc_1A025
		mov	si, 1800h

loc_1A025:
		push	si
		push	800h
		call	randring2_next16_mod
		add	ax, [bp+var_4]
		push	ax
		push	500h
		call	sub_13D90
		inc	di

loc_1A037:
		cmp	di, [bp+arg_0]
		jb	short loc_1A009
		mov	_boss_phase_timed_out, 0
		pop	di
		pop	si
		leave
		retn	2
sub_19FD8	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A047	proc near
		push	bp
		mov	bp, sp
		cmp	_midboss_phase, PHASE_EXPLODE_BIG
		jnz	short loc_1A081
		cmp	_midboss_phase_frame, 0
		jnz	short loc_1A05E
		mov	word_255C2, 0Ch

loc_1A05E:
		inc	_midboss_phase_frame
		mov	ax, _midboss_phase_frame
		mov	bx, 16
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1A085
		inc	_midboss_sprite
		cmp	_midboss_sprite, 12
		jb	short loc_1A085
		mov	_midboss_phase, PHASE_NONE
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1A081:
		call	sub_19EBC

loc_1A085:
		pop	bp
		retn
sub_1A047	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A087	proc near

arg_0		= byte ptr  4
arg_2		= byte ptr  6

		push	bp
		mov	bp, sp
		push	si
		mov	si, 0B204h
		xor	dx, dx
		jmp	short loc_1A0C7
; ---------------------------------------------------------------------------

loc_1A092:
		cmp	byte ptr [si], 0
		jnz	short loc_1A0C3
		mov	byte ptr [si], 1
		mov	word ptr [si+16h], 0
		mov	word ptr [si+0Eh], 0
		mov	al, [bp+arg_2]
		mov	[si+1],	al
		mov	al, [bp+arg_0]
		mov	[si+18h], al
		mov	word ptr [si+14h], 64h ; 'd'
		mov	ax, _boss_pos.cur.x
		mov	[si+2],	ax
		mov	ax, _boss_pos.cur.y
		mov	[si+4],	ax
		jmp	short loc_1A0CC
; ---------------------------------------------------------------------------

loc_1A0C3:
		inc	dx
		add	si, 1Ah

loc_1A0C7:
		cmp	dx, 20h	; ' '
		jl	short loc_1A092

loc_1A0CC:
		pop	si
		pop	bp
		retn	4
sub_1A087	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A0D1	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	si, 0B52Ah
		mov	byte ptr [si], 1
		mov	word ptr [si+0Eh], 0
		mov	byte ptr [si+18h], 8
		mov	ax, _player_pos.cur.x
		sar	ax, 4
		add	ax, 20h	; ' '
		mov	[si+2],	ax
		mov	ax, _player_pos.cur.y
		sar	ax, 4
		add	ax, 10h
		mov	[si+4],	ax
		mov	word ptr [si+10h], 8
		mov	word ptr [si+12h], 50h ; 'P'
		call	snd_se_play pascal, 8
		pop	si
		pop	bp
		retn
sub_1A0D1	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A110	proc near

var_6		= byte ptr -6
var_5		= byte ptr -5
var_4		= word ptr -4
var_2		= word ptr -2

		enter	6, 0
		push	si
		push	di
		mov	word_257E2, 0C0h
		mov	word_257E4, 0C0h
		mov	si, 0B204h
		xor	di, di
		jmp	loc_1A235
; ---------------------------------------------------------------------------

loc_1A12A:
		cmp	byte ptr [si], 1
		jnz	loc_1A231
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [si+1]
		mov	al, [si+18h]
		mov	ah, 0
		push	ax
		call	vector2_near
		mov	ax, [si+0Ah]
		add	[si+2],	ax
		mov	ax, [si+0Ch]
		add	[si+4],	ax
		cmp	word ptr [si+2], 0FF00h
		jle	short loc_1A169
		cmp	word ptr [si+2], 1900h
		jge	short loc_1A169
		cmp	word ptr [si+4], 1800h
		jge	short loc_1A169
		cmp	word ptr [si+4], 0FF00h
		jg	short loc_1A16C

loc_1A169:
		mov	byte ptr [si], 0

loc_1A16C:
		mov	ax, [si+2]
		add	ax, 0FF40h
		mov	[bp+var_2], ax
		mov	ax, [si+4]
		add	ax, 0FF40h
		mov	[bp+var_4], ax
		mov	ax, _player_pos.cur.x
		sub	ax, [bp+var_2]
		cmp	ax, 180h
		jnb	short loc_1A199
		mov	ax, _player_pos.cur.y
		sub	ax, [bp+var_4]
		cmp	ax, 180h
		jnb	short loc_1A199
		mov	byte_259A9, 1

loc_1A199:
		cmp	word ptr [si+0Eh], 38h ; '8'
		jnb	short loc_1A1CF
		mov	ax, _player_pos.cur.y
		sub	ax, [si+4]
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, [si+2]
		push	ax
		call	iatan2
		mov	[bp+var_5], al
		mov	al, [si+1]
		sub	[bp+var_5], al
		cmp	[bp+var_5], 80h
		jnb	short loc_1A1C6
		inc	byte ptr [si+1]
		jmp	short loc_1A1CF
; ---------------------------------------------------------------------------

loc_1A1C6:
		cmp	[bp+var_5], 80h
		jb	short loc_1A1CF
		dec	byte ptr [si+1]

loc_1A1CF:
		mov	ax, [si+2]
		mov	word ptr dword_257DE, ax
		mov	ax, [si+4]
		mov	word ptr dword_257DE+2,	ax
		call	sub_105B9
		mov	[si+16h], ax
		or	ax, ax
		jz	short loc_1A1EE
		call	snd_se_play pascal, 4

loc_1A1EE:
		mov	ax, [si+16h]
		sub	[si+14h], ax
		cmp	word ptr [si+14h], 0
		jg	short loc_1A22E
		call	snd_se_play pascal, 3
		add	_score_delta, 3000
		mov	byte ptr [si], 10h
		mov	word ptr [si+0Eh], 0
		push	word ptr [si+2]
		push	word ptr [si+4]
		push	large (((4 shl 4) shl 16) or 8)
		nopcall	sparks_add_random
		call	items_add pascal, word ptr [si+2], word ptr [si+4], IT_BIGPOWER

loc_1A22E:
		inc	word ptr [si+0Eh]

loc_1A231:
		inc	di
		add	si, 1Ah

loc_1A235:
		cmp	di, 1Fh
		jl	loc_1A12A
		mov	al, [si]
		mov	ah, 0
		cmp	ax, 1
		jz	short loc_1A24D
		cmp	ax, 2
		jz	short loc_1A261
		jmp	loc_1A3BF
; ---------------------------------------------------------------------------

loc_1A24D:
		cmp	word ptr [si+10h], 80h
		jg	short loc_1A25B
		add	word ptr [si+10h], 8
		jmp	loc_1A3BF
; ---------------------------------------------------------------------------

loc_1A25B:
		mov	byte ptr [si], 2
		jmp	loc_1A3BF
; ---------------------------------------------------------------------------

loc_1A261:
		cmp	word ptr [si+0Eh], 8
		jnb	short loc_1A26E
		sub	word ptr [si+12h], 8
		jmp	loc_1A3BC
; ---------------------------------------------------------------------------

loc_1A26E:
		cmp	word ptr [si+0Eh], 8
		jnz	short loc_1A27B
		mov	byte ptr [si+18h], 9
		jmp	loc_1A3BC
; ---------------------------------------------------------------------------

loc_1A27B:
		cmp	word ptr [si+0Eh], 10h
		jnb	short loc_1A288
		sub	word ptr [si+12h], 2
		jmp	loc_1A3BC
; ---------------------------------------------------------------------------

loc_1A288:
		cmp	word ptr [si+0Eh], 0A0h
		jnb	loc_1A3A8
		mov	ax, [si+0Eh]
		and	ax, 1Fh
		cmp	ax, 10h
		jnb	short loc_1A2A1
		inc	word ptr [si+12h]
		jmp	short loc_1A2A4
; ---------------------------------------------------------------------------

loc_1A2A1:
		dec	word ptr [si+12h]

loc_1A2A4:
		cmp	_stage_frame_mod2, 0
		jz	short loc_1A2B1
		mov	byte ptr [si+18h], 0Fh
		jmp	short loc_1A2B5
; ---------------------------------------------------------------------------

loc_1A2B1:
		mov	byte ptr [si+18h], 9

loc_1A2B5:
		cmp	word ptr [si+0Eh], 68h ; 'h'
		ja	short loc_1A2BE
		dec	word ptr [si+10h]

loc_1A2BE:
		test	byte ptr [si+0Eh], 0Fh
		jnz	loc_1A3BC
		mov	[bp+var_6], 0C0h
		test	byte ptr [si+0Eh], 1Fh
		jnz	short loc_1A309
		mov	ax, _boss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		add	ax, (32 shl 4)
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_SMALL_BALL_RED
		mov	_bullet_template.pattern, BP_RING_AIMED
		mov	_bullet_template.count, 32
		mov	_bullet_template.speed, (1 shl 4)
		mov	_bullet_template.BT_angle, 0
		call	fp_2D004
		call	fp_2D000
		mov	[bp+var_6], 40h

loc_1A309:
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.BT_delta.spread_angle, 0Ch
		mov	ax, _stage_frame
		mov	bx, 5
		xor	dx, dx
		div	bx
		mov	[bp+var_5], al
		mov	ax, [si+10h]
		add	ax, 4
		mov	[bp+var_2], ax
		xor	di, di
		jmp	short loc_1A39A
; ---------------------------------------------------------------------------

loc_1A32D:
		mov	al, [bp+var_5]
		add	al, [bp+var_6]
		mov	_bullet_template.BT_angle, al
		push	offset _bullet_template.BT_origin
		push	word ptr [si+2]
		push	word ptr [si+4]
		push	[bp+var_2]
		mov	al, [bp+var_5]
		mov	ah, 0
		push	ax
		call	vector2_at
		sub	_bullet_template.BT_origin.x, (2 shl 4)
		sub	_bullet_template.BT_origin.y, (1 shl 4)
		mov	ax, (1 shl 4)
		imul	_bullet_template.BT_origin.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, (1 shl 4)
		imul	_bullet_template.BT_origin.y
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.pattern, BP_STACK
		mov	_bullet_template.count, 8
		mov	_bullet_template.speed, (1 shl 4)
		call	fp_2D000
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 4
		mov	_bullet_template.speed, (3 shl 4)
		call	fp_2D000
		inc	di
		mov	al, [bp+var_5]
		add	al, 20h	; ' '
		mov	[bp+var_5], al

loc_1A39A:
		cmp	di, 8
		jl	short loc_1A32D
		call	snd_se_play pascal, 3
		jmp	short loc_1A3BC
; ---------------------------------------------------------------------------

loc_1A3A8:
		cmp	word ptr [si+0Eh], 0B0h	; ''
		jnb	short loc_1A3B9
		add	word ptr [si+12h], 10h
		sub	word ptr [si+10h], 2
		jmp	short loc_1A3BC
; ---------------------------------------------------------------------------

loc_1A3B9:
		mov	byte ptr [si], 0

loc_1A3BC:
		inc	word ptr [si+0Eh]

loc_1A3BF:
		pop	di
		pop	si
		leave
		retn
sub_1A110	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A3C3	proc near
		push	bp
		mov	bp, sp
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	bx, 6
		cwd
		idiv	bx
		cmp	dx, 5
		jge	short loc_1A42E
		mov	ax, _boss_phase_frame
		cmp	ax, 1
		jz	short loc_1A3E5
		cmp	ax, 112
		jz	short loc_1A40E
		jmp	short loc_1A41C
; ---------------------------------------------------------------------------

loc_1A3E5:
		push	offset _boss_pos.velocity
		mov	al, byte_25A07
		mov	ah, 0
		imul	ax, 5
		mov	dl, _boss_mode_change
		mov	dh, 0
		mov	bx, 6
		push	ax
		mov	ax, dx
		cwd
		idiv	bx
		pop	bx
		add	bx, dx
		mov	al, [bx+1ED4h]
		push	ax
		push	8
		call	vector2_near
		jmp	short loc_1A41C
; ---------------------------------------------------------------------------

loc_1A40E:
		mov	_boss_phase_frame, 0
		inc	_boss_mode_change
		mov	al, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1A41C:
		mov	ax, _boss_pos.velocity.x
		add	_boss_pos.cur.x, ax
		mov	ax, _boss_pos.velocity.y
		add	_boss_pos.cur.y, ax
		mov	al, 0
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1A42E:
		push	0C000500h
		call	sub_1A439
		pop	bp
		retn
sub_1A3C3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A439	proc near

arg_0		= word ptr  4
arg_2		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	si, [bp+arg_2]
		mov	di, [bp+arg_0]
		cmp	_boss_phase_frame, 64
		jge	short loc_1A457
		cmp	byte_25A06, 0
		jz	short loc_1A461
		call	sub_1A7BC
		jmp	short loc_1A461
; ---------------------------------------------------------------------------

loc_1A457:
		cmp	byte_25A06, 0
		jnz	short loc_1A461
		call	sub_1A831

loc_1A461:
		mov	ax, _boss_phase_frame
		cmp	ax, 64
		jz	short loc_1A470
		cmp	ax, 128
		jz	short loc_1A492
		jmp	short loc_1A4A0
; ---------------------------------------------------------------------------

loc_1A470:
		mov	_boss_pos.cur.x, si
		mov	_boss_pos.cur.y, di
		cmp	byte_25A1B, 0
		jz	short loc_1A4A0
		mov	byte_25A1B, 2
		mov	ax, (PLAYFIELD_W shl 4)
		sub	ax, si
		mov	point_25A0C.x, ax
		mov	point_25A0C.y, di
		jmp	short loc_1A4A0
; ---------------------------------------------------------------------------

loc_1A492:
		mov	_boss_phase_frame, 0
		inc	_boss_mode_change
		mov	al, 1
		jmp	short loc_1A4A2
; ---------------------------------------------------------------------------

loc_1A4A0:
		mov	al, 0

loc_1A4A2:
		pop	di
		pop	si
		pop	bp
		retn	4
sub_1A439	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A4A8	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 1
		jnz	short loc_1A4BD
		mov	_boss_pos.velocity.x, (2 shl 4)
		mov	_boss_angle, 0

loc_1A4BD:
		mov	ax, _boss_pos.velocity.x
		add	_boss_pos.cur.x, ax
		cmp	_boss_pos.cur.x, (48 shl 4)
		jle	short loc_1A4D4
		cmp	_boss_pos.cur.x, (336 shl 4)
		jl	short loc_1A4DE

loc_1A4D4:
		mov	ax, -1
		imul	_boss_pos.velocity.x
		mov	_boss_pos.velocity.x, ax

loc_1A4DE:
		push	((80 shl 4) shl 16) or (48 shl 4)
		mov	al, _boss_angle
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_SinTable8[bx]
		call	vector1_at
		mov	_boss_pos.cur.y, ax
		mov	al, _boss_angle
		add	al, 2
		mov	_boss_angle, al
		pop	bp
		retn
sub_1A4A8	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A503	proc near
		push	bp
		mov	bp, sp
		cmp	byte_25A06, 0
		jnz	short loc_1A512
		call	sub_1A831
		jmp	short loc_1A539
; ---------------------------------------------------------------------------

loc_1A512:
		mov	byte_25A08, 0
		cmp	_boss_pos.cur.x, (192 shl 4)
		jge	short loc_1A526
		add	_boss_pos.cur.x, (1 shl 4)
		jmp	short loc_1A539
; ---------------------------------------------------------------------------

loc_1A526:
		cmp	_boss_pos.cur.x, (193 shl 4)
		jl	short loc_1A535
		sub	_boss_pos.cur.x, (1 shl 4)
		jmp	short loc_1A539
; ---------------------------------------------------------------------------

loc_1A535:
		mov	al, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1A539:
		mov	al, 0
		pop	bp
		retn
sub_1A503	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A53D	proc near

var_2		= word ptr -2

		enter	2, 0
		mov	byte_25A06, 1
		inc	word_25A0A
		mov	ax, word_25A0A
		mov	[bp+var_2], ax
		mov	cx, 5		; switch 5 cases
		mov	bx, offset word_1A598

loc_1A556:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_1A565
		add	bx, 2
		loop	loc_1A556
		jmp	short loc_1A594	; default
; ---------------------------------------------------------------------------

loc_1A565:
		jmp	word ptr cs:[bx+0Ah] ; switch jump

loc_1A569:
		mov	_boss_sprite, 128 ; jumptable 0001A565 case 1
		jmp	short loc_1A594	; default
; ---------------------------------------------------------------------------

loc_1A570:
		mov	_boss_sprite, 130 ; jumptable 0001A565 case 7
		jmp	short loc_1A594	; default
; ---------------------------------------------------------------------------

loc_1A577:
		mov	_boss_sprite, 132 ; jumptable 0001A565 case 13
		jmp	short loc_1A594	; default
; ---------------------------------------------------------------------------

loc_1A57E:
		mov	_boss_sprite, 134 ; jumptable 0001A565 case 19
		jmp	short loc_1A594	; default
; ---------------------------------------------------------------------------

loc_1A585:
		mov	word_25A0A, 0	; jumptable 0001A565 case 25
		mov	byte_25A06, 2

loc_1A590:
		mov	al, 1		; jumptable 0001EA6B case 13291
		leave
		retn
; ---------------------------------------------------------------------------

loc_1A594:
		mov	al, 0		; default
		leave
		retn
sub_1A53D	endp

; ---------------------------------------------------------------------------
word_1A598	dw	1,     7,   0Dh,   13h
		dw    19h		; value	table for switch statement
		dw offset loc_1A569	; jump table for switch	statement
		dw offset loc_1A570
		dw offset loc_1A577
		dw offset loc_1A57E
		dw offset loc_1A585

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A5AC	proc near

var_2		= word ptr -2

		enter	2, 0
		mov	byte_25A06, 2
		inc	word_25A0A
		mov	ax, word_25A0A
		mov	[bp+var_2], ax
		mov	cx, 5		; switch 5 cases
		mov	bx, offset word_1A608

loc_1A5C5:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_1A5D4
		add	bx, 2
		loop	loc_1A5C5
		jmp	short loc_1A603	; default
; ---------------------------------------------------------------------------

loc_1A5D4:
		jmp	word ptr cs:[bx+0Ah] ; switch jump

loc_1A5D8:
		mov	_boss_sprite, 134 ; jumptable 0001A5D4 case 1
		jmp	short loc_1A603	; default
; ---------------------------------------------------------------------------

loc_1A5DF:
		mov	_boss_sprite, 132 ; jumptable 0001A5D4 case 7
		jmp	short loc_1A603	; default
; ---------------------------------------------------------------------------

loc_1A5E6:
		mov	_boss_sprite, 130 ; jumptable 0001A5D4 case 13
		jmp	short loc_1A603	; default
; ---------------------------------------------------------------------------

loc_1A5ED:
		mov	_boss_sprite, 128 ; jumptable 0001A5D4 case 19
		jmp	short loc_1A603	; default
; ---------------------------------------------------------------------------

loc_1A5F4:
		mov	word_25A0A, 0	; jumptable 0001A5D4 case 25
		mov	byte_25A06, 1
		mov	al, 1
		leave
		retn
; ---------------------------------------------------------------------------

loc_1A603:
		mov	al, 0		; default
		leave
		retn
sub_1A5AC	endp

; ---------------------------------------------------------------------------
		db 0
word_1A608	dw	1,     7,   0Dh,   13h
		dw    19h		; value	table for switch statement
		dw offset loc_1A5D8	; jump table for switch	statement
		dw offset loc_1A5DF
		dw offset loc_1A5E6
		dw offset loc_1A5ED
		dw offset loc_1A5F4

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A61C	proc near

var_2		= word ptr -2

		enter	2, 0
		inc	word_25A0A
		mov	ax, word_25A0A
		mov	[bp+var_2], ax
		mov	cx, 5		; switch 5 cases
		mov	bx, offset word_1A672

loc_1A630:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_1A63F
		add	bx, 2
		loop	loc_1A630
		jmp	short loc_1A66E	; default
; ---------------------------------------------------------------------------

loc_1A63F:
		jmp	word ptr cs:[bx+0Ah] ; switch jump

loc_1A643:
		mov	_boss_sprite, 134 ; jumptable 0001A63F case 1
		jmp	short loc_1A66E	; default
; ---------------------------------------------------------------------------

loc_1A64A:
		mov	_boss_sprite, 136 ; jumptable 0001A63F case 7
		jmp	short loc_1A66E	; default
; ---------------------------------------------------------------------------

loc_1A651:
		mov	_boss_sprite, 152 ; jumptable 0001A63F case 13
		jmp	short loc_1A66E	; default
; ---------------------------------------------------------------------------

loc_1A658:
		mov	_boss_sprite, 138 ; jumptable 0001A63F case 19
		jmp	short loc_1A66E	; default
; ---------------------------------------------------------------------------

loc_1A65F:
		mov	word_25A0A, 0	; jumptable 0001A63F case 25
		mov	byte_25A06, 3
		mov	al, 1
		leave
		retn
; ---------------------------------------------------------------------------

loc_1A66E:
		mov	al, 0		; default
		leave
		retn
sub_1A61C	endp

; ---------------------------------------------------------------------------
word_1A672	dw	1,     7,   0Dh,   13h
		dw    19h		; value	table for switch statement
		dw offset loc_1A643	; jump table for switch	statement
		dw offset loc_1A64A
		dw offset loc_1A651
		dw offset loc_1A658
		dw offset loc_1A65F

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A686	proc near

var_2		= word ptr -2

		enter	2, 0
		inc	word_25A0A
		mov	ax, word_25A0A
		mov	[bp+var_2], ax
		mov	cx, 4		; switch 4 cases
		mov	bx, offset word_1A6D5

loc_1A69A:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_1A6A9
		add	bx, 2
		loop	loc_1A69A
		jmp	short loc_1A6D1	; default
; ---------------------------------------------------------------------------

loc_1A6A9:
		jmp	word ptr cs:[bx+8] ; switch jump

loc_1A6AD:
		mov	_boss_sprite, 134 ; jumptable 0001A6A9 case 1
		jmp	short loc_1A6D1	; default
; ---------------------------------------------------------------------------

loc_1A6B4:
		mov	_boss_sprite, 136 ; jumptable 0001A6A9 case 7
		jmp	short loc_1A6D1	; default
; ---------------------------------------------------------------------------

loc_1A6BB:
		mov	_boss_sprite, 150 ; jumptable 0001A6A9 case 13
		jmp	short loc_1A6D1	; default
; ---------------------------------------------------------------------------

loc_1A6C2:
		mov	word_25A0A, 0	; jumptable 0001A6A9 case 19
		mov	byte_25A06, 4
		mov	al, 1
		leave
		retn
; ---------------------------------------------------------------------------

loc_1A6D1:
		mov	al, 0		; default
		leave
		retn
sub_1A686	endp

; ---------------------------------------------------------------------------
word_1A6D5	dw	1,     7,   0Dh,   13h
					; value	table for switch statement
		dw offset loc_1A6AD	; jump table for switch	statement
		dw offset loc_1A6B4
		dw offset loc_1A6BB
		dw offset loc_1A6C2

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A6E5	proc near
		push	bp
		mov	bp, sp
		inc	word_25A0A
		mov	bx, word_25A0A
		dec	bx
		cmp	bx, 27h	; '''
		ja	short loc_1A767
		add	bx, bx
		jmp	cs:off_1A76C[bx]

loc_1A6FD:
		mov	_boss_sprite, 150
		jmp	short loc_1A767
; ---------------------------------------------------------------------------

loc_1A704:
		mov	_boss_sprite, 152
		jmp	short loc_1A767
; ---------------------------------------------------------------------------

loc_1A70B:
		mov	_boss_sprite, 154
		jmp	short loc_1A767
; ---------------------------------------------------------------------------

loc_1A712:
		mov	_boss_sprite, 156
		jmp	short loc_1A767
; ---------------------------------------------------------------------------

loc_1A719:
		mov	_boss_sprite, 158
		jmp	short loc_1A767
; ---------------------------------------------------------------------------

loc_1A720:
		mov	_boss_sprite, 160
		jmp	short loc_1A767
; ---------------------------------------------------------------------------

loc_1A727:
		mov	_boss_sprite, 162
		jmp	short loc_1A767
; ---------------------------------------------------------------------------

loc_1A72E:
		mov	_boss_sprite, 164
		jmp	short loc_1A767
; ---------------------------------------------------------------------------

loc_1A735:
		mov	_boss_sprite, 166
		jmp	short loc_1A767
; ---------------------------------------------------------------------------

loc_1A73C:
		mov	_boss_sprite, 168
		jmp	short loc_1A767
; ---------------------------------------------------------------------------

loc_1A743:
		mov	_boss_sprite, 170
		jmp	short loc_1A767
; ---------------------------------------------------------------------------

loc_1A74A:
		mov	_boss_sprite, 172
		jmp	short loc_1A767
; ---------------------------------------------------------------------------

loc_1A751:
		mov	_boss_sprite, 134
		jmp	short loc_1A767
; ---------------------------------------------------------------------------

loc_1A758:
		mov	word_25A0A, 0
		mov	byte_25A06, 2
		mov	al, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1A767:
		mov	al, 0
		pop	bp
		retn
sub_1A6E5	endp

; ---------------------------------------------------------------------------
		db 0
off_1A76C	dw offset loc_1A6FD
		dw offset loc_1A767
		dw offset loc_1A767
		dw offset loc_1A704
		dw offset loc_1A767
		dw offset loc_1A767
		dw offset loc_1A70B
		dw offset loc_1A767
		dw offset loc_1A767
		dw offset loc_1A712
		dw offset loc_1A767
		dw offset loc_1A767
		dw offset loc_1A719
		dw offset loc_1A767
		dw offset loc_1A767
		dw offset loc_1A720
		dw offset loc_1A767
		dw offset loc_1A767
		dw offset loc_1A727
		dw offset loc_1A767
		dw offset loc_1A767
		dw offset loc_1A72E
		dw offset loc_1A767
		dw offset loc_1A767
		dw offset loc_1A735
		dw offset loc_1A767
		dw offset loc_1A767
		dw offset loc_1A73C
		dw offset loc_1A767
		dw offset loc_1A767
		dw offset loc_1A743
		dw offset loc_1A767
		dw offset loc_1A767
		dw offset loc_1A74A
		dw offset loc_1A767
		dw offset loc_1A767
		dw offset loc_1A751
		dw offset loc_1A767
		dw offset loc_1A767
		dw offset loc_1A758

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A7BC	proc near

var_2		= word ptr -2

		enter	2, 0
		inc	word_25A0A
		mov	ax, word_25A0A
		mov	[bp+var_2], ax
		mov	cx, 6		; switch 6 cases
		mov	bx, offset word_1A819

loc_1A7D0:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_1A7DF
		add	bx, 2
		loop	loc_1A7D0
		jmp	short loc_1A815	; default
; ---------------------------------------------------------------------------

loc_1A7DF:
		jmp	word ptr cs:[bx+0Ch] ; switch jump

loc_1A7E3:
		mov	_boss_sprite, 174 ; jumptable 0001A7DF case 1
		jmp	short loc_1A815	; default
; ---------------------------------------------------------------------------

loc_1A7EA:
		mov	_boss_sprite, 176 ; jumptable 0001A7DF case 8
		jmp	short loc_1A815	; default
; ---------------------------------------------------------------------------

loc_1A7F1:
		mov	_boss_sprite, 178 ; jumptable 0001A7DF case 15
		jmp	short loc_1A815	; default
; ---------------------------------------------------------------------------

loc_1A7F8:
		mov	_boss_sprite, 180 ; jumptable 0001A7DF case 22
		jmp	short loc_1A815	; default
; ---------------------------------------------------------------------------

loc_1A7FF:
		mov	_boss_sprite, 0	; jumptable 0001A7DF case 29
		jmp	short loc_1A815	; default
; ---------------------------------------------------------------------------

loc_1A806:
		mov	word_25A0A, 0	; jumptable 0001A7DF case 36
		mov	byte_25A06, 0
		mov	al, 1
		leave
		retn
; ---------------------------------------------------------------------------

loc_1A815:
		mov	al, 0		; default
		leave
		retn
sub_1A7BC	endp

; ---------------------------------------------------------------------------
word_1A819	dw	1,     8,   0Fh,   16h
		dw    1Dh,   24h	; value	table for switch statement
		dw offset loc_1A7E3	; jump table for switch	statement
		dw offset loc_1A7EA
		dw offset loc_1A7F1
		dw offset loc_1A7F8
		dw offset loc_1A7FF
		dw offset loc_1A806

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A831	proc near

var_2		= word ptr -2

		enter	2, 0
		inc	word_25A0A
		mov	ax, word_25A0A
		mov	[bp+var_2], ax
		mov	cx, 6		; switch 6 cases
		mov	bx, offset word_1A88F

loc_1A845:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_1A854
		add	bx, 2
		loop	loc_1A845
		jmp	short loc_1A88A	; default
; ---------------------------------------------------------------------------

loc_1A854:
		jmp	word ptr cs:[bx+0Ch] ; switch jump

loc_1A858:
		mov	_boss_sprite, 180 ; jumptable 0001A854 case 1
		jmp	short loc_1A88A	; default
; ---------------------------------------------------------------------------

loc_1A85F:
		mov	_boss_sprite, 178 ; jumptable 0001A854 case 8
		jmp	short loc_1A88A	; default
; ---------------------------------------------------------------------------

loc_1A866:
		mov	_boss_sprite, 176 ; '' ; jumptable 0001A854 case 15
		jmp	short loc_1A88A	; default
; ---------------------------------------------------------------------------

loc_1A86D:
		mov	_boss_sprite, 174 ; jumptable 0001A854 case 22
		jmp	short loc_1A88A	; default
; ---------------------------------------------------------------------------

loc_1A874:
		mov	_boss_sprite, 128 ; jumptable 0001A854 case 29
		jmp	short loc_1A88A	; default
; ---------------------------------------------------------------------------

loc_1A87B:
		mov	word_25A0A, 0	; jumptable 0001A854 case 36
					; jumptable 0001F539 case 65142
		mov	byte_25A06, 1
		mov	al, 1
		leave
		retn
; ---------------------------------------------------------------------------

loc_1A88A:
		mov	al, 0		; default
		leave
		retn
sub_1A831	endp

; ---------------------------------------------------------------------------
		db 0
word_1A88F	dw	1,     8,   0Fh,   16h
		dw    1Dh,   24h	; value	table for switch statement
		dw offset loc_1A858	; jump table for switch	statement
		dw offset loc_1A85F
		dw offset loc_1A866
		dw offset loc_1A86D
		dw offset loc_1A874
		dw offset loc_1A87B

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A8A7	proc near

var_2		= word ptr -2

		enter	2, 0
		inc	word_25A0A
		mov	ax, word_25A0A
		mov	[bp+var_2], ax
		mov	cx, 4		; switch 4 cases
		mov	bx, offset word_1A8F7

loc_1A8BB:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_1A8CA
		add	bx, 2
		loop	loc_1A8BB
		jmp	short loc_1A8F2	; default
; ---------------------------------------------------------------------------

loc_1A8CA:
		jmp	word ptr cs:[bx+8] ; switch jump

loc_1A8CE:
		mov	_boss_sprite, 128 ; jumptable 0001A8CA case 1
		jmp	short loc_1A8F2	; default
; ---------------------------------------------------------------------------

loc_1A8D5:
		mov	_boss_sprite, 142 ; jumptable 0001A8CA case 7
		jmp	short loc_1A8F2	; default
; ---------------------------------------------------------------------------

loc_1A8DC:
		mov	_boss_sprite, 144; jumptable 0001A8CA case 13
		jmp	short loc_1A8F2	; default
; ---------------------------------------------------------------------------

loc_1A8E3:
		mov	word_25A0A, 0	; jumptable 0001A8CA case 19
		mov	byte_25A06, 8
		mov	al, 1
		leave
		retn
; ---------------------------------------------------------------------------

loc_1A8F2:
		mov	al, 0		; default
		leave
		retn
sub_1A8A7	endp

; ---------------------------------------------------------------------------
		db 0
word_1A8F7	dw	1,     7,   0Dh,   13h
					; value	table for switch statement
		dw offset loc_1A8CE	; jump table for switch	statement
		dw offset loc_1A8D5
		dw offset loc_1A8DC
		dw offset loc_1A8E3

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A907	proc near

var_2		= word ptr -2

		enter	2, 0
		mov	ax, _boss_phase_frame
		mov	[bp+var_2], ax
		mov	cx, 4		; switch 4 cases
		mov	bx, offset word_1A9A5

loc_1A917:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_1A926
		add	bx, 2
		loop	loc_1A917
		jmp	short locret_1A9A3 ; default
; ---------------------------------------------------------------------------

loc_1A926:
		jmp	word ptr cs:[bx+8] ; switch jump

loc_1A92A:
		call	snd_se_play pascal, 8		; jumptable 0001A926 case 16
		mov	word_2A8CE, 1400h
		mov	ax, _boss_pos.cur.y
		add	ax, (-4 shl 4)
		mov	point_2A8C6.y, ax
		mov	ax, _boss_pos.cur.x
		add	ax, (24 shl 4)
		mov	point_2A8C6.x, ax
		mov	word_2A8D0, 10h
		mov	byte_2A8D2, 9
		mov	byte_2A8D3, 0FEh

loc_1A959:
		call	sub_13B21	; jumptable 0001A926 case 20
		sub	point_2A8C6.x, (44 shl 4)
		mov	byte_2A8D3, 2

loc_1A967:
		call	sub_13B21
		leave
		retn
; ---------------------------------------------------------------------------

loc_1A96C:
		mov	byte_2A8D2, 8	; jumptable 0001A926 case 18
		call	sub_13B21
		add	point_2A8C6.x, (44 shl 4)
		mov	byte_2A8D3, 0FEh
		jmp	short loc_1A967
; ---------------------------------------------------------------------------

loc_1A981:
		push	point_2A8C6.x ; jumptable 0001A926 case 32
		push	point_2A8C6.y
		call	circles_add_shrinking
		mov	ax, point_2A8C6.x
		add	ax, (44 shl 4)
		push	ax
		push	point_2A8C6.y
		call	circles_add_shrinking
		mov	_circles_color, 0Fh

locret_1A9A3:
		leave			; default
		retn
sub_1A907	endp

; ---------------------------------------------------------------------------
word_1A9A5	dw    10h,   12h,   14h,   20h
					; value	table for switch statement
		dw offset loc_1A92A	; jump table for switch	statement
		dw offset loc_1A96C
		dw offset loc_1A959
		dw offset loc_1A981

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A9B5	proc near
		push	bp
		mov	bp, sp
		mov	byte_2A8D3, 0FEh
		call	sub_13B21
		mov	byte_2A8D3, 2
		call	sub_13B21
		pop	bp
		retn
sub_1A9B5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A9CA	proc near

var_2		= word ptr -2

		enter	2, 0
		mov	ax, _boss_phase_frame
		mov	[bp+var_2], ax
		mov	cx, 4		; switch 4 cases
		mov	bx, offset word_1AA35

loc_1A9DA:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_1A9E9
		add	bx, 2
		loop	loc_1A9DA
		jmp	short locret_1AA32 ; default
; ---------------------------------------------------------------------------

loc_1A9E9:
		jmp	word ptr cs:[bx+8] ; switch jump

loc_1A9ED:
		call	snd_se_play pascal, 8		; jumptable 0001A9E9 case 48
		mov	word_2A8CE, 1400h
		mov	ax, _boss_pos.cur.y
		add	ax, (32 shl 4)
		mov	point_2A8C6.y, ax
		mov	ax, _boss_pos.cur.x
		mov	point_2A8C6.x, ax
		mov	word_2A8D0, 8
		mov	byte_2A8D2, 9

loc_1AA14:
		call	sub_1A9B5	; jumptable 0001A9E9 case 52
		leave
		retn
; ---------------------------------------------------------------------------

loc_1AA19:
		mov	byte_2A8D2, 8	; jumptable 0001A9E9 case 50
		jmp	short loc_1AA14	; jumptable 0001A9E9 case 52
; ---------------------------------------------------------------------------

loc_1AA20:
		push	point_2A8C6.x ; jumptable 0001A9E9 case 64
		push	point_2A8C6.y
		call	circles_add_shrinking
		mov	_circles_color, 0Fh

locret_1AA32:
		leave			; default
		retn
sub_1A9CA	endp

; ---------------------------------------------------------------------------
		db 0
word_1AA35	dw    30h,   32h,   34h,   40h
					; value	table for switch statement
		dw offset loc_1A9ED	; jump table for switch	statement
		dw offset loc_1AA19
		dw offset loc_1AA14
		dw offset loc_1AA20

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1AA45	proc near

var_2		= word ptr -2

		enter	2, 0
		mov	ax, _boss_phase_frame
		mov	[bp+var_2], ax
		mov	cx, 4		; switch 4 cases
		mov	bx, offset word_1AAD5

loc_1AA55:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_1AA64
		add	bx, 2
		loop	loc_1AA55
		jmp	short locret_1AAD2 ; default
; ---------------------------------------------------------------------------

loc_1AA64:
		jmp	word ptr cs:[bx+8] ; switch jump

loc_1AA68:
		call	snd_se_play pascal, 8		; jumptable 0001AA64 case 32
		mov	word_2A8CE, 1400h
		mov	word_2A8D0, 8
		mov	byte_2A8D2, 9

loc_1AA80:
		mov	ax, _boss_pos.cur.y ; jumptable 0001AA64	case 36
		add	ax, (32 shl 4)
		mov	point_2A8C6.y, ax
		mov	ax, _boss_pos.cur.x
		mov	point_2A8C6.x, ax
		call	sub_1A9B5
		mov	ax, point_25A0C.y
		add	ax, (32 shl 4)
		mov	point_2A8C6.y, ax
		mov	ax, point_25A0C.x
		mov	point_2A8C6.x, ax
		call	sub_1A9B5
		leave
		retn
; ---------------------------------------------------------------------------

loc_1AAA6:
		mov	byte_2A8D2, 8	; jumptable 0001AA64 case 34
		jmp	short loc_1AA80	; jumptable 0001AA64 case 36
; ---------------------------------------------------------------------------

loc_1AAAD:
		push	_boss_pos.cur.x ; jumptable 0001AA64 case 48
		mov	ax, _boss_pos.cur.y
		add	ax, (32 shl 4)
		push	ax
		call	circles_add_shrinking
		push	point_25A0C.x
		mov	ax, point_25A0C.y
		add	ax, (32 shl 4)
		push	ax
		call	circles_add_shrinking
		mov	_circles_color, 0Fh

locret_1AAD2:
		leave			; default
		retn
sub_1AA45	endp

; ---------------------------------------------------------------------------
		db 0
word_1AAD5	dw    20h,   22h,   24h,   30h
					; value	table for switch statement
		dw offset loc_1AA68	; jump table for switch	statement
		dw offset loc_1AAA6
		dw offset loc_1AA80
		dw offset loc_1AAAD

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1AAE5	proc near

var_2		= word ptr -2

		enter	2, 0
		mov	ax, _boss_phase_frame
		mov	[bp+var_2], ax
		mov	cx, 4		; switch 4 cases
		mov	bx, offset word_1AB4D

loc_1AAF5:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_1AB04
		add	bx, 2
		loop	loc_1AAF5
		jmp	short locret_1AB4A ; default
; ---------------------------------------------------------------------------

loc_1AB04:
		jmp	word ptr cs:[bx+8] ; switch jump

loc_1AB08:
		call	snd_se_play pascal, 8		; jumptable 0001AB04 case 16
		mov	word_2A8CE, 1400h
		mov	ax, _boss_pos.cur.y
		mov	point_2A8C6.y, ax
		mov	ax, _boss_pos.cur.x
		mov	point_2A8C6.x, ax
		mov	word_2A8D0, 10h
		mov	byte_2A8D2, 7

loc_1AB2C:
		call	sub_1A9B5	; jumptable 0001AB04 case 20
		leave
		retn
; ---------------------------------------------------------------------------

loc_1AB31:
		mov	byte_2A8D2, 6	; jumptable 0001AB04 case 18
		jmp	short loc_1AB2C	; jumptable 0001AB04 case 20
; ---------------------------------------------------------------------------

loc_1AB38:
		push	point_2A8C6.x ; jumptable 0001AB04 case 32
		push	point_2A8C6.y
		call	circles_add_shrinking
		mov	_circles_color, 0Fh

locret_1AB4A:
		leave			; default
		retn
sub_1AAE5	endp

; ---------------------------------------------------------------------------
		db 0
word_1AB4D	dw    10h,   12h,   14h,   20h
					; value	table for switch statement
		dw offset loc_1AB08	; jump table for switch	statement
		dw offset loc_1AB31
		dw offset loc_1AB2C
		dw offset loc_1AB38

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1AB5D	proc near
		push	bp
		mov	bp, sp
		cmp	byte_25A06, 1
		jnz	short loc_1AB6A
		call	sub_1A53D

loc_1AB6A:
		call	sub_1A907
		mov	ax, _boss_phase_frame
		cmp	ax, 48
		jz	short loc_1AB81
		cmp	ax, 64
		jz	short loc_1AB86
		cmp	ax, 80
		jz	short loc_1ABD8
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1AB81:
		mov	_bullet_template.speed, (2 shl 4) + 8

loc_1AB86:
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_CROSS_YELLOW
		mov	ax, _boss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-4 shl 4)
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.BT_special_motion, 81h
		mov	_bullet_template.count, 20
		mov	byte_2CFF8, 0C0h
		call	fp_2D004
		call	sub_1CFB5
		mov	byte_2CFF8, 40h
		call	sub_1CFB5
		call	snd_se_play pascal, 9
		mov	al, _bullet_template.speed
		add	al, (1 shl 4)
		mov	_bullet_template.speed, al
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1ABD8:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh
		pop	bp
		retn
sub_1AB5D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1ABE5	proc near

var_1		= byte ptr -1

		enter	2, 0
		cmp	_boss_phase_frame, 48
		jge	short loc_1ABFF
		cmp	byte_25A06, 2
		jnz	loc_1AC96
		call	sub_1A686
		jmp	loc_1AC96
; ---------------------------------------------------------------------------

loc_1ABFF:
		cmp	byte_25A06, 4
		jnz	loc_1AC96
		call	sub_1A6E5
		cmp	_boss_phase_frame, 80
		jg	loc_1AC96
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.pattern, BP_RING
		mov	al, byte_2D01F
		mov	_bullet_template.count, al
		mov	al, byte ptr _boss_phase_frame
		shl	al, 3
		mov	dl, 0
		sub	dl, al
		mov	[bp+var_1], dl
		mov	_bullet_template.speed, (2 shl 4) + 8
		mov	al, [bp+var_1]
		mov	_bullet_template.BT_angle, al
		push	offset _bullet_template.BT_origin
		push	_boss_pos.cur.x
		push	_boss_pos.cur.y
		push	(34 shl 4)
		mov	ah, 0
		push	ax
		call	vector2_at
		call	fp_2D000
		mov	al, 80h
		sub	al, [bp+var_1]
		mov	[bp+var_1], al
		push	offset _bullet_template.BT_origin
		push	_boss_pos.cur.x
		push	_boss_pos.cur.y
		push	(34 shl 4)
		mov	ah, 0
		push	ax
		call	vector2_at
		mov	ax, _boss_phase_frame
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	dl, (3 shl 4) + 12
		sub	dl, al
		mov	_bullet_template.speed, dl
		call	fp_2D000
		cmp	_stage_frame_mod4, 0
		jnz	short loc_1AC96
		call	snd_se_play pascal, 9

loc_1AC96:
		mov	ax, _boss_phase_frame
		cmp	ax, 32
		jz	short loc_1ACA5
		cmp	ax, 96
		jz	short loc_1ACBF
		leave
		retn
; ---------------------------------------------------------------------------

loc_1ACA5:
		mov	ax, _boss_pos.cur.x
		add	ax, (-40 shl 4)
		push	ax
		mov	ax, _boss_pos.cur.y
		add	ax, (40 shl 4)
		push	ax
		call	circles_add_shrinking
		mov	_circles_color, 0Fh
		leave
		retn
; ---------------------------------------------------------------------------

loc_1ACBF:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh
		leave
		retn
sub_1ABE5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1ACCC	proc near
		push	bp
		mov	bp, sp
		cmp	byte_25A06, 2
		jnz	short loc_1ACD9
		call	sub_1A5AC

loc_1ACD9:
		cmp	_boss_phase_frame, 48
		jl	short loc_1AD58
		cmp	_boss_phase_frame, 80
		jg	short loc_1AD58
		cmp	_stage_frame_mod4, 0
		jnz	short loc_1AD6A
		mov	al, _stage_frame_mod8
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		inc	al
		mov	_bullet_template.spawn_type, al
		mov	_bullet_template.patnum, PAT_BULLET16_N_SMALL_BALL_RED
		mov	ax, _boss_pos.cur.y
		add	ax, (-4 shl 4)
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.pattern, BP_RANDOM_ANGLE_AND_SPEED
		mov	_bullet_template.count, 4
		mov	_bullet_template.BT_special_motion, 88h
		call	randring2_next16_mod pascal, (1 shl 4) + 8
		add	al, 8
		mov	_bullet_template.speed, al
		mov	ax, _boss_pos.cur.x
		add	ax, (-20 shl 4)
		mov	_bullet_template.BT_origin.x, ax
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		mov	byte_2CFF7, 1
		call	fp_2D004
		call	sub_1CFB5
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		add	_bullet_template.BT_origin.x, (44 shl 4)
		call	sub_1CFB5
		call	snd_se_play pascal, 9
		jmp	short loc_1AD6A
; ---------------------------------------------------------------------------

loc_1AD58:
		cmp	_boss_phase_frame, 80
		jle	short loc_1AD6A
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_1AD6A:
		call	sub_1A907
		pop	bp
		retn
sub_1ACCC	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1AD6F	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 64
		jge	short loc_1AD91
		cmp	byte_25A06, 1
		jnz	short loc_1AD85
		call	sub_1A53D
		jmp	short loc_1ADCC
; ---------------------------------------------------------------------------

loc_1AD85:
		cmp	byte_25A06, 2
		jnz	short loc_1ADCC
		call	sub_1A61C
		jmp	short loc_1ADCC
; ---------------------------------------------------------------------------

loc_1AD91:
		cmp	_boss_phase_frame, 64
		jl	short loc_1ADA6
		cmp	_boss_phase_frame, 112
		jg	short loc_1ADA6
		mov	_boss_sprite, 140
		jmp	short loc_1ADCC
; ---------------------------------------------------------------------------

loc_1ADA6:
		cmp	_boss_phase_frame, 288
		jl	short loc_1ADCC
		cmp	byte_25A06, 2
		jz	short loc_1ADBA
		call	sub_1A6E5
		jmp	short loc_1ADCC
; ---------------------------------------------------------------------------

loc_1ADBA:
		call	sub_1A5AC
		or	al, al
		jz	short loc_1ADCC
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_1ADCC:
		call	sub_1A9CA
		cmp	_boss_phase_frame, 64
		jnz	short loc_1ADD9
		call	sub_1A0D1

loc_1ADD9:
		pop	bp
		retn
sub_1AD6F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1ADDB	proc near
		push	bp
		mov	bp, sp
		cmp	_stage_frame_mod16, 0
		jnz	loc_1AE8D
		mov	ax, _boss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_bullet_template.BT_origin.y, ax
		cmp	_boss_phase, 6
		jnz	short loc_1AE40
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_SMALL_BALL_RED
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 16
		mov	_bullet_template.speed, (1 shl 4) + 14
		call	fp_2D004
		call	fp_2D000
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	ax, _boss_phase_frame
		mov	bx, 16
		cwd
		idiv	bx
		add	al, 2
		mov	_bullet_template.count, al
		mov	_bullet_template.speed, (2 shl 4) + 2
		jmp	short loc_1AE85
; ---------------------------------------------------------------------------

loc_1AE40:
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.pattern, BP_STACK_AIMED
		mov	_bullet_template.count, 7
		mov	_bullet_template.speed, (2 shl 4)
		mov	_bullet_template.BT_delta.spread_angle, 0Ah
		call	fp_2D004
		call	sub_1CFA2
		call	snd_se_play pascal, 15
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.pattern, BP_RANDOM_ANGLE_AND_SPEED
		mov	_bullet_template.count, 4
		mov	_bullet_template.speed, (1 shl 4) + 8

loc_1AE85:
		call	fp_2D004
		call	fp_2D000

loc_1AE8D:
		pop	bp
		retn
sub_1ADDB	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1AE8F	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 64
		jge	short loc_1AEB7
		cmp	byte_25A06, 1
		jnz	short loc_1AEA5
		call	sub_1A53D
		jmp	short loc_1AEAF
; ---------------------------------------------------------------------------

loc_1AEA5:
		cmp	byte_25A06, 2
		jnz	short loc_1AEAF
		call	sub_1A61C

loc_1AEAF:
		mov	_bullet_template.speed, (1 shl 4)
		jmp	loc_1AF59
; ---------------------------------------------------------------------------

loc_1AEB7:
		cmp	_boss_phase_frame, 64
		jl	short loc_1AF33
		cmp	_boss_phase_frame, 128
		jg	short loc_1AF33
		mov	_boss_sprite, 140
		cmp	_stage_frame_mod8, 0
		jnz	loc_1AF59
		mov	ax, _boss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.BT_delta.spread_angle, 8
		mov	_bullet_template.count, 3
		call	fp_2D004
		mov	_bullet_template.BT_angle, 60h
		call	fp_2D000
		mov	_bullet_template.BT_angle, 20h
		call	fp_2D000
		mov	ax, point_25A0C.x
		mov	_bullet_template.BT_origin.x, ax
		call	fp_2D000
		mov	_bullet_template.BT_angle, 60h
		call	fp_2D000
		mov	al, _bullet_template.speed
		add	al, 12
		mov	_bullet_template.speed, al
		call	snd_se_play pascal, 3
		jmp	short loc_1AF59
; ---------------------------------------------------------------------------

loc_1AF33:
		cmp	_boss_phase_frame, 128
		jl	short loc_1AF59
		cmp	byte_25A06, 2
		jz	short loc_1AF47
		call	sub_1A6E5
		jmp	short loc_1AF59
; ---------------------------------------------------------------------------

loc_1AF47:
		call	sub_1A5AC
		or	al, al
		jz	short loc_1AF59
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_1AF59:
		call	sub_1AA45
		cmp	_boss_phase_frame, 64
		jnz	short loc_1AFA6
		mov	al, byte_2D01E
		mov	ah, 0
		mov	word_2562A, ax
		mov	word_2562E, 4
		mov	word_25624, 24h	; '$'
		mov	word_25626, 28h	; '('
		mov	byte_25628, 8
		mov	ax, _boss_pos.cur.x
		mov	point_2561A.x, ax
		mov	ax, _boss_pos.cur.y
		add	ax, (32 shl 4)
		mov	point_2561A.y, ax
		call	sub_15DBD
		mov	ax, point_25A0C.x
		mov	point_2561A.x, ax
		mov	ax, point_25A0C.y
		add	ax, (40 shl 4)
		mov	point_2561A.y, ax
		call	sub_15DBD

loc_1AFA6:
		pop	bp
		retn
sub_1AE8F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1AFA8	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 64
		jge	short loc_1AFD0
		cmp	byte_25A06, 1
		jnz	short loc_1AFBE
		call	sub_1A53D
		jmp	short loc_1AFC8
; ---------------------------------------------------------------------------

loc_1AFBE:
		cmp	byte_25A06, 2
		jnz	short loc_1AFC8
		call	sub_1A61C

loc_1AFC8:
		mov	byte_2D02D, 2
		jmp	loc_1B094
; ---------------------------------------------------------------------------

loc_1AFD0:
		cmp	_boss_phase_frame, 64
		jl	loc_1B06E
		cmp	_boss_phase_frame, 128
		jg	loc_1B06E
		mov	_boss_sprite, 140
		cmp	_stage_frame_mod4, 0
		jnz	loc_1B094
		mov	ax, _boss_pos.cur.y
		add	ax, (32 shl 4)
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_D_YELLOW
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 5
		call	randring2_next16_and pascal, 1Fh
		add	al, 12
		mov	_bullet_template.speed, al
		mov	_bullet_template.BT_delta.spread_angle, 10h
		mov	al, byte_2D02D
		mov	ah, 0
		add	ax, ax
		call	randring2_next16_mod pascal, ax
		mov	dl, 40h
		sub	dl, byte_2D02D
		add	al, dl
		mov	_bullet_template.BT_angle, al
		mov	ax, _boss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		call	fp_2D000
		mov	al, byte_2D02D
		mov	ah, 0
		add	ax, ax
		call	randring2_next16_mod pascal, ax
		mov	dl, 40h
		sub	dl, byte_2D02D
		add	al, dl
		mov	_bullet_template.BT_angle, al
		mov	ax, point_25A0C.x
		mov	_bullet_template.BT_origin.x, ax
		call	fp_2D000
		call	snd_se_play pascal, 9
		mov	al, byte_2D02D
		add	al, 6
		mov	byte_2D02D, al
		jmp	short loc_1B094
; ---------------------------------------------------------------------------

loc_1B06E:
		cmp	_boss_phase_frame, 128
		jl	short loc_1B094
		cmp	byte_25A06, 2
		jz	short loc_1B082
		call	sub_1A6E5
		jmp	short loc_1B094
; ---------------------------------------------------------------------------

loc_1B082:
		call	sub_1A5AC
		or	al, al
		jz	short loc_1B094
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_1B094:
		call	sub_1AA45
		pop	bp
		retn
sub_1AFA8	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1B099	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 48
		jg	short loc_1B0AF
		cmp	byte_25A06, 8
		jz	short loc_1B125
		call	sub_1A8A7
		jmp	short loc_1B125
; ---------------------------------------------------------------------------

loc_1B0AF:
		cmp	_boss_phase_frame, 136
		jge	short loc_1B0F0
		mov	al, _stage_frame_mod4
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, al
		add	al, 146
		mov	_boss_sprite, al
		cmp	_stage_frame_mod2, 0
		jz	short loc_1B0D2
		call	sub_1CFA2

loc_1B0D2:
		cmp	_stage_frame_mod4, 0
		jnz	short loc_1B0E0
		call	snd_se_play pascal, 3

loc_1B0E0:
		cmp	_boss_phase_frame, 112
		jl	short loc_1B125
		mov	al, _boss_angle
		add	_bullet_template.BT_angle, al
		jmp	short loc_1B125
; ---------------------------------------------------------------------------

loc_1B0F0:
		cmp	_rank, RANK_HARD
		jb	short loc_1B120
		cmp	_boss_phase_frame, 150
		jge	short loc_1B120
		mov	al, _boss_angle
		sub	_bullet_template.BT_angle, al
		cmp	_stage_frame_mod2, 0
		jz	short loc_1B110
		call	sub_1CFA2

loc_1B110:
		cmp	_stage_frame_mod4, 0
		jnz	short loc_1B125
		call	snd_se_play pascal, 3
		jmp	short loc_1B125
; ---------------------------------------------------------------------------

loc_1B120:
		mov	_boss_sprite, 146

loc_1B125:
		call	sub_1AAE5
		mov	ax, _boss_phase_frame
		cmp	ax, 48
		jz	short loc_1B13C
		cmp	ax, 144
		jz	short loc_1B19D
		cmp	ax, 156
		jz	short loc_1B1A4
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1B13C:
		mov	ax, _boss_pos.cur.y
		sub	ax, _player_pos.cur.y
		push	ax
		mov	ax, _boss_pos.cur.x
		sub	ax, _player_pos.cur.x
		push	ax
		call	iatan2
		add	al, 10h
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_RED
		mov	ax, _boss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 8
		mov	_bullet_template.speed, (9 shl 4)
		cmp	_rank, RANK_EASY
		jz	short loc_1B196
		call	randring2_next16_and pascal, 1
		or	ax, ax
		jz	short loc_1B18F
		mov	al, 1
		jmp	short loc_1B191
; ---------------------------------------------------------------------------

loc_1B18F:
		mov	al, -1

loc_1B191:
		mov	_boss_angle, al
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1B196:
		mov	_boss_angle, 0
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1B19D:
		cmp	_rank, RANK_HARD
		jnb	short loc_1B1AF

loc_1B1A4:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_1B1AF:
		pop	bp
		retn
sub_1B099	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1B1B1	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 48
		jle	short loc_1B20E
		mov	al, _stage_frame_mod4
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, al
		add	al, 146
		mov	_boss_sprite, al
		cmp	_stage_frame_mod8, 0
		jnz	short loc_1B213
		call	snd_se_play pascal, 3
		mov	al, _bullet_template.BT_angle
		add	al, 2
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE
		mov	_bullet_template.speed, (3 shl 4)
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		add	al, 4
		mov	_bullet_template.count, al
		call	fp_2D004
		call	fp_2D000
		jmp	short loc_1B213
; ---------------------------------------------------------------------------

loc_1B20E:
		mov	_boss_sprite, 146

loc_1B213:
		call	sub_1AAE5
		cmp	_boss_phase_frame, 144
		jnz	short loc_1B229
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_1B229:
		pop	bp
		retn
sub_1B1B1	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1B22B	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 48
		jle	short loc_1B268
		mov	al, _stage_frame_mod4
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, al
		add	al, 146
		mov	_boss_sprite, al
		cmp	_stage_frame_mod8, 0
		jnz	short loc_1B26D
		call	randring2_next16
		push	ax
		push	20h ; ' '
		call	sub_1A087
		call	randring2_next16
		push	ax
		push	20h ; ' '
		call	sub_1A087
		call	snd_se_play pascal, 3
		jmp	short loc_1B26D
; ---------------------------------------------------------------------------

loc_1B268:
		mov	_boss_sprite, 146

loc_1B26D:
		cmp	_boss_phase_frame, 144
		jnz	short loc_1B280
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_1B280:
		pop	bp
		retn
sub_1B22B	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1B282	proc near

var_1		= byte ptr -1

		enter	2, 0
		mov	al, byte ptr _boss_phase_frame
		and	al, 1Fh
		mov	[bp+var_1], al
		mov	al, _stage_frame_mod4
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, al
		add	al, 146
		mov	_boss_sprite, al
		test	[bp+var_1], 3
		jnz	short loc_1B2ED
		mov	ax, _boss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_bullet_template.BT_origin.y, ax
		mov	al, BST_GATHER_PELLET
		sub	al, _bullet_template.spawn_type
		mov	_bullet_template.spawn_type, al
		mov	_bullet_template.patnum, PAT_BULLET16_N_SMALL_BALL_RED
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 8
		mov	al, [bp+var_1]
		add	al, (2 shl 4)
		mov	_bullet_template.speed, al
		call	fp_2D004
		mov	al, -7Eh
		sub	al, _bullet_template.BT_angle
		mov	_bullet_template.BT_angle, al
		call	sub_1CFA2
		mov	al, 80h
		sub	al, _bullet_template.BT_angle
		mov	_bullet_template.BT_angle, al
		call	sub_1CFA2

loc_1B2ED:
		cmp	[bp+var_1], 0
		jnz	short locret_1B311
		mov	al, _bullet_template.BT_angle
		add	al, 8
		mov	_bullet_template.BT_angle, al
		mov	word_2A8D0, 8
		mov	byte_2A8D2, 9
		mov	al, byte_2A8D3
		neg	al
		mov	byte_2A8D3, al
		call	sub_13B21

locret_1B311:
		leave
		retn
sub_1B282	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1B313	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 64
		jge	short loc_1B339
		cmp	byte_25A06, 1
		jnz	short loc_1B32A
		call	sub_1A53D
		jmp	loc_1B3DD
; ---------------------------------------------------------------------------

loc_1B32A:
		cmp	byte_25A06, 2
		jnz	loc_1B3DD
		call	sub_1A61C
		jmp	loc_1B3DD
; ---------------------------------------------------------------------------

loc_1B339:
		cmp	_boss_phase_frame, 64
		jl	short loc_1B3B7
		cmp	_boss_phase_frame, 192
		jg	short loc_1B3B7
		mov	_boss_sprite, 140
		cmp	_stage_frame_mod16, 0
		jnz	loc_1B3DD
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE
		mov	_bullet_template.speed, (2 shl 4) + 8
		mov	_bullet_template.BT_delta.spread_angle, 0Eh
		test	byte ptr _stage_frame, 1Fh
		jnz	short loc_1B382
		mov	_bullet_template.count, 10
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.BT_angle, 40h
		jmp	short loc_1B391
; ---------------------------------------------------------------------------

loc_1B382:
		mov	_bullet_template.count, 7
		mov	_bullet_template.pattern, BP_SPREAD_AIMED
		mov	_bullet_template.BT_angle, 0

loc_1B391:
		mov	ax, _boss_pos.cur.y
		add	ax, (32 shl 4)
		mov	_bullet_template.BT_origin.y, ax
		mov	ax, _boss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		call	fp_2D000
		mov	ax, point_25A0C.x
		mov	_bullet_template.BT_origin.x, ax
		call	fp_2D000
		call	snd_se_play pascal, 3
		jmp	short loc_1B3DD
; ---------------------------------------------------------------------------

loc_1B3B7:
		cmp	_boss_phase_frame, 192
		jl	short loc_1B3DD
		cmp	byte_25A06, 2
		jz	short loc_1B3CB
		call	sub_1A6E5
		jmp	short loc_1B3DD
; ---------------------------------------------------------------------------

loc_1B3CB:
		call	sub_1A5AC
		or	al, al
		jz	short loc_1B3DD
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_1B3DD:
		call	sub_1AA45
		pop	bp
		retn
sub_1B313	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1B3E2	proc near
		push	bp
		mov	bp, sp
		cmp	byte_25A1B, 2
		jnz	short loc_1B42B
		mov	word_257E2, 180h
		mov	word_257E4, 300h
		mov	ax, point_25A0C.x
		mov	word ptr dword_257DE, ax
		mov	ax, point_25A0C.y
		mov	word ptr dword_257DE+2,	ax
		call	sub_105B9
		mov	byte_25A1E, al
		or	al, al
		jz	short loc_1B417
		call	snd_se_play pascal, 4

loc_1B417:
		mov	al, byte_25A1E
		mov	ah, 0
		sub	_boss_hp, ax
		cmp	_boss_hp, 0
		jge	short loc_1B42B
		mov	al, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1B42B:
		mov	al, 0
		pop	bp
		retn
sub_1B3E2	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1B42F	proc near

arg_0		= word ptr  4
@@type		= word ptr  6

		push	bp
		mov	bp, sp
		cmp	_bullet_clear_time, 20
		jnb	short loc_1B43E
		mov	_bullet_clear_time, 20

loc_1B43E:
		call	boss_explode_small pascal, [bp+@@type]
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		mov	_boss_mode_change, 0
		mov	_boss_mode, 0
		mov	ax, _boss_phase_end_hp
		mov	_boss_hp, ax
		mov	ax, [bp+arg_0]
		mov	_boss_phase_end_hp, ax
		mov	word_25A0A, 0
		mov	_boss_sprite, 128
		mov	word_25A0A, 0
		mov	byte_25A06, 1
		pop	bp
		retn	4
sub_1B42F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

yuuka6_update	proc far

var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2

		enter	6, 0
		mov	al, _boss_phase
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 11h
		ja	loc_1B8E5
		add	bx, bx
		jmp	cs:off_1B938[bx]

loc_1B497:
		cmp	_boss_phase_frame, 0
		jnz	short loc_1B4BA
		setfarfp	_stage_vm, nullsub_2
		mov	_midboss_frames_until, 0
		mov	byte_25A08, 0
		mov	byte_25A1B, 0

loc_1B4BA:
		call	sub_1E67C
		cmp	_boss_phase_frame, 128
		jle	loc_1B8EA
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		call	snd_se_play pascal, 13
		mov	byte_25A02, 0
		mov	fp_255AC, offset yuuka6_bg_render
		mov	byte_2CDCA, 0Fh
		jmp	loc_1B8EA
; ---------------------------------------------------------------------------

loc_1B4EB:
		call	sub_1E67C
		cmp	_boss_phase_frame, 64
		jl	loc_1B8EA
		inc	_boss_phase
		mov	_boss_pos.velocity.x, 0
		mov	_boss_mode_change, 0
		mov	_boss_mode, 0
		mov	_boss_hp, 13300
		mov	_boss_phase_end_hp, 10600
		mov	_boss_phase_frame, 0
		mov	word_25A0A, 0
		mov	byte_25A06, 1
		push	1
		call	randring2_next16_and
		mov	byte_25A07, al
		jmp	loc_1B8EA
; ---------------------------------------------------------------------------

loc_1B533:
		mov	al, _boss_mode
		mov	ah, 0
		mov	[bp+var_2], ax
		mov	cx, 4
		mov	bx, offset word_1B928

loc_1B541:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_1B550
		add	bx, 2
		loop	loc_1B541
		jmp	short loc_1B580	; default
; ---------------------------------------------------------------------------

loc_1B550:
		jmp	word ptr cs:[bx+8] ; switch jump

loc_1B554:
		call	sub_1AB5D	; jumptable 0001B550 case 0
		jmp	short loc_1B580	; default
; ---------------------------------------------------------------------------

loc_1B559:
		call	sub_1ABE5	; jumptable 0001B550 case 1
		jmp	short loc_1B580	; default
; ---------------------------------------------------------------------------

loc_1B55E:
		call	sub_1ACCC	; jumptable 0001B550 case 2
		jmp	short loc_1B580	; default
; ---------------------------------------------------------------------------

loc_1B563:
		call	sub_1A3C3	; jumptable 0001B550 case 255
		or	al, al
		jz	short loc_1B580	; default
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	bx, 3
		cwd
		idiv	bx
		mov	_boss_mode, dl
		cmp	_boss_mode_change, 10
		jnb	short loc_1B59A

loc_1B580:
		cmp	_boss_sprite, 0	; default
		jz	loc_1B787
		call	sub_1E64E
		or	al, al
		jz	loc_1B8EA
		push	14h
		call	sub_19FD8
		call	sub_1E692

loc_1B59A:
		pushd	1DB0h
		call	sub_1B42F
		jmp	loc_1B8EA
; ---------------------------------------------------------------------------

loc_1B5A6:
		inc	_boss_phase_frame
		push	0C000500h
		call	sub_1A439
		or	al, al
		jz	loc_1B8EA
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		mov	_boss_mode_change, 0
		jmp	loc_1B8EA
; ---------------------------------------------------------------------------

loc_1B5CB:
		mov	al, _boss_mode
		mov	ah, 0
		or	ax, ax
		jz	short loc_1B5DB
		cmp	ax, 0FFh
		jz	short loc_1B5E0
		jmp	short loc_1B600
; ---------------------------------------------------------------------------

loc_1B5DB:
		call	sub_1AD6F
		jmp	short loc_1B600
; ---------------------------------------------------------------------------

loc_1B5E0:
		push	1200h
		call	randring2_next16_mod
		add	ax, 300h
		push	ax
		push	500h
		call	sub_1A439
		or	al, al
		jz	short loc_1B600
		mov	_boss_mode, 0
		cmp	_boss_mode_change, 10
		jnb	short loc_1B623

loc_1B600:
		cmp	_boss_sprite, 0
		jz	loc_1B787
		cmp	_boss_mode, 0FFh
		jz	loc_1B787
		call	sub_1E64E
		or	al, al
		jz	loc_1B8EA
		push	14h
		call	sub_19FD8
		call	sub_1E692

loc_1B623:
		pushd	1518h
		call	sub_1B42F
		mov	byte_25A08, 1
		jmp	loc_1B8EA
; ---------------------------------------------------------------------------

loc_1B634:
		inc	_boss_phase_frame
		cmp	byte_25A06, 0
		jz	short loc_1B645
		call	sub_1A7BC
		jmp	loc_1B8EA
; ---------------------------------------------------------------------------

loc_1B645:
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		jmp	loc_1B8EA
; ---------------------------------------------------------------------------

loc_1B652:
		call	sub_1ADDB
		inc	_boss_phase_frame
		call	sub_1A4A8
		cmp	_boss_phase_frame, 320
		jl	loc_1B8EA
		cmp	_boss_pos.cur.y, (80 shl 4)
		jnz	loc_1B8EA
		call	boss_explode_small pascal, 2
		cmp	_bullet_clear_time, 20
		jnb	short loc_1B681
		mov	_bullet_clear_time, 20

loc_1B681:
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		mov	word_25A0A, 0
		jmp	loc_1B8EA
; ---------------------------------------------------------------------------

loc_1B694:
		call	sub_1E64E
		call	sub_1A503
		or	al, al
		jz	loc_1B8EA
		inc	_boss_phase
		mov	_boss_mode_change, 0
		mov	_boss_mode, 0FFh
		mov	_boss_phase_frame, 0
		mov	word_25A0A, 0
		mov	byte_25A06, 2
		mov	byte_25A1B, 1
		mov	byte_25A02, 0FFh
		jmp	loc_1B8EA
; ---------------------------------------------------------------------------

loc_1B6CC:
		mov	al, _boss_mode
		mov	ah, 0
		mov	[bp+var_4], ax
		mov	cx, 4
		mov	bx, offset word_1B918

loc_1B6DA:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_4]
		jz	short loc_1B6E9
		add	bx, 2
		loop	loc_1B6DA
		jmp	short loc_1B72E	; default
; ---------------------------------------------------------------------------

loc_1B6E9:
		jmp	word ptr cs:[bx+8] ; switch jump

loc_1B6ED:
		call	sub_1AE8F	; jumptable 0001B6E9 case 0
		jmp	short loc_1B72E	; default
; ---------------------------------------------------------------------------

loc_1B6F2:
		call	sub_1AFA8	; jumptable 0001B6E9 case 1
		jmp	short loc_1B72E	; default
; ---------------------------------------------------------------------------

loc_1B6F7:
		call	sub_1B313	; jumptable 0001B6E9 case 2
		jmp	short loc_1B72E	; default
; ---------------------------------------------------------------------------

loc_1B6FC:
		push	900h		; jumptable 0001B6E9 case 255
		call	randring2_next16_mod
		add	ax, 300h
		push	ax
		push	500h
		call	sub_1A439
		or	al, al
		jz	short loc_1B72E	; default

loc_1B710:
		push	3
		call	randring2_next16_mod
		mov	_boss_mode, al
		mov	al, byte_25A02
		cmp	al, _boss_mode
		jz	short loc_1B710
		mov	al, _boss_mode
		mov	byte_25A02, al
		cmp	_boss_mode_change, 10
		jnb	short loc_1B75B

loc_1B72E:
		cmp	_boss_sprite, 0	; default
		jz	short loc_1B787
		cmp	_boss_mode, 2
		ja	short loc_1B744
		call	sub_1E64E
		call	sub_1B3E2
		jmp	short loc_1B748
; ---------------------------------------------------------------------------

loc_1B744:
		inc	_boss_phase_frame

loc_1B748:
		mov	ax, _boss_hp
		cmp	ax, _boss_phase_end_hp
		jg	loc_1B8EA
		push	14h
		call	sub_19FD8
		call	sub_1E692

loc_1B75B:
		cmp	_boss_phase, 8
		jnz	short loc_1B76A
		pushd	0D48h
		jmp	short loc_1B770
; ---------------------------------------------------------------------------

loc_1B76A:
		pushd	4B0h

loc_1B770:
		call	sub_1B42F
		cmp	_boss_phase, 9
		jnz	short loc_1B77F
		mov	byte_25A08, 1

loc_1B77F:
		mov	byte_25A1B, 0
		jmp	loc_1B8EA
; ---------------------------------------------------------------------------

loc_1B787:
		inc	_boss_phase_frame
		jmp	loc_1B8EA
; ---------------------------------------------------------------------------

loc_1B78E:
		call	sub_1E67C
		call	sub_1A503
		or	al, al
		jz	loc_1B8EA
		inc	_boss_phase
		mov	_boss_mode_change, 0
		mov	_boss_mode, 0
		mov	_boss_phase_frame, 0
		mov	word_25A0A, 0
		mov	byte_25A06, 2
		mov	byte_25A1B, 1
		jmp	loc_1B8EA
; ---------------------------------------------------------------------------

loc_1B7C1:
		mov	al, _boss_mode
		mov	ah, 0
		mov	[bp+var_6], ax
		mov	cx, 4
		mov	bx, offset word_1B908

loc_1B7CF:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_6]
		jz	short loc_1B7DE
		add	bx, 2
		loop	loc_1B7CF
		jmp	short loc_1B80B	; default
; ---------------------------------------------------------------------------

loc_1B7DE:
		jmp	word ptr cs:[bx+8] ; switch jump

loc_1B7E2:
		call	sub_1B099	; jumptable 0001B7DE case 0
		jmp	short loc_1B80B	; default
; ---------------------------------------------------------------------------

loc_1B7E7:
		call	sub_1B1B1	; jumptable 0001B7DE case 1
		jmp	short loc_1B80B	; default
; ---------------------------------------------------------------------------

loc_1B7EC:
		call	sub_1B22B	; jumptable 0001B7DE case 2
		jmp	short loc_1B80B	; default
; ---------------------------------------------------------------------------

loc_1B7F1:
		inc	_boss_mode_change	; jumptable 0001B7DE case 255
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	bx, 3
		cwd
		idiv	bx
		mov	_boss_mode, dl
		cmp	_boss_mode_change, 18
		jnb	short loc_1B81C

loc_1B80B:
		call	sub_1E64E	; default
		or	al, al
		jz	loc_1B8EA
		push	14h
		call	sub_19FD8
		call	sub_1E692

loc_1B81C:
		push	30000h
		call	sub_1B42F
		mov	_boss_sprite, 146
		jmp	loc_1B8EA
; ---------------------------------------------------------------------------

loc_1B82D:
		call	sub_1E64E
		cmp	_boss_phase_frame, 128
		jl	loc_1B8EA
		inc	_boss_phase
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.BT_angle, 0
		jmp	loc_1B8EA
; ---------------------------------------------------------------------------

loc_1B84B:
		call	sub_1B282
		call	sub_1E64E
		or	al, al
		jnz	short loc_1B85F
		cmp	_boss_phase_frame, 2500
		jl	loc_1B8EA

loc_1B85F:
		call	boss_explode_small pascal, 1
		inc	_boss_phase
		cmp	_boss_phase_frame, 2500
		jge	short loc_1B877
		mov	_boss_mode_change, 1
		jmp	short loc_1B87C
; ---------------------------------------------------------------------------

loc_1B877:
		mov	_boss_mode_change, 0

loc_1B87C:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0
		mov	PaletteTone, 100
		mov	_palette_changed, 1
		jmp	short loc_1B8EA
; ---------------------------------------------------------------------------

loc_1B894:
		inc	_boss_phase_frame
		cmp	_boss_phase_frame, 16
		jnz	short loc_1B8A4
		call	boss_explode_small pascal, 4

loc_1B8A4:
		cmp	_boss_phase_frame, 32
		jnz	short loc_1B8EA
		call	boss_explode_big pascal, 2
		mov	_boss_phase, PHASE_EXPLODE_BIG
		mov	al, _boss_mode_change
		mov	_bullet_clear_trigger, al
		cmp	_boss_mode_change, 0
		jz	short loc_1B8C7
		push	46h ; 'F'
		call	sub_19FD8

loc_1B8C7:
		mov	_boss_sprite, 4
		mov	_boss_phase_frame, 0
		call	snd_se_play pascal, 12
		mov	_palette_changed, 1
		mov	_player_invincibility_time, BOSS_DEFEAT_INVINCIBILITY_FRAMES
		jmp	short loc_1B8EA
; ---------------------------------------------------------------------------

loc_1B8E5:
		call	sub_1E743
		leave
		retf
; ---------------------------------------------------------------------------

loc_1B8EA:
		mov	ax, _boss_pos.cur.x
		mov	_homing_target.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_homing_target.y, ax
		call	sub_15DE8
		call	sub_1A110
		push	_boss_hp
		push	13300
		call	sub_19F16
		leave
		retf
yuuka6_update	endp

; ---------------------------------------------------------------------------
word_1B908		dw	0,     1,     2,  0FFh ; value table for switch	statement
		dw offset loc_1B7E2	; jump table for switch	statement
		dw offset loc_1B7E7
		dw offset loc_1B7EC
		dw offset loc_1B7F1
word_1B918		dw	0,     1,     2,  0FFh ; value table for switch	statement
		dw offset loc_1B6ED	; jump table for switch	statement
		dw offset loc_1B6F2
		dw offset loc_1B6F7
		dw offset loc_1B6FC
word_1B928		dw	0,     1,     2,  0FFh ; value table for switch	statement
		dw offset loc_1B554	; jump table for switch	statement
		dw offset loc_1B559
		dw offset loc_1B55E
		dw offset loc_1B563
off_1B938	dw offset loc_1B497
		dw offset loc_1B4EB
		dw offset loc_1B533
		dw offset loc_1B5A6
		dw offset loc_1B5CB
		dw offset loc_1B634
		dw offset loc_1B652
		dw offset loc_1B694
		dw offset loc_1B6CC
		dw offset loc_1B634
		dw offset loc_1B652
		dw offset loc_1B694
		dw offset loc_1B6CC
		dw offset loc_1B78E
		dw offset loc_1B7C1
		dw offset loc_1B82D
		dw offset loc_1B84B
		dw offset loc_1B894

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1B95C	proc near

var_1		= byte ptr -1

		enter	2, 0
		cmp	byte_25A27, 2
		jnz	short loc_1B96C
		mov	byte_25A27, 0

loc_1B96C:
		mov	al, byte_25A26
		mov	ah, 0
		dec	ax
		mov	bx, ax
		cmp	bx, 7
		ja	loc_1BBA8
		add	bx, bx
		jmp	cs:off_1BC2C[bx]
; ---------------------------------------------------------------------------

loc_1B982:
		cmp	word_25A34, 40h
		jnb	short loc_1B99B
		test	byte ptr word_25A34, 7
		jnz	short loc_1B99B
		mov	ax, word_25A34
		shr	ax, 3
		add	al, 134
		mov	_boss_sprite, al

loc_1B99B:
		cmp	word_25A34, 0
		jnz	short loc_1B9AC
		call	snd_se_play pascal, 8
		jmp	loc_1BBA4
; ---------------------------------------------------------------------------

loc_1B9AC:
		cmp	word_25A34, 38h	; '8'
		jnz	short loc_1B9CE
		call	snd_se_play pascal, 9
		mov	byte_25A27, 1
		mov	ax, _boss_pos.cur.x
		mov	motion_25A28.cur.x, ax
		mov	ax, _boss_pos.cur.y
		mov	motion_25A28.cur.y, ax
		jmp	loc_1BBA4
; ---------------------------------------------------------------------------

loc_1B9CE:
		cmp	word_25A34, 40h
		jb	loc_1BBA4
		mov	_boss_sprite, 141
		mov	byte_25A26, 2

loc_1B9E1:
		cmp	word_25A34, 50h	; 'P'
		jnb	short loc_1BA49
		mov	ax, _player_pos.cur.y
		sub	ax, motion_25A28.cur.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, motion_25A28.cur.x
		push	ax
		call	iatan2
		mov	[bp+var_1], al
		mov	al, byte ptr word_25A36
		sub	[bp+var_1], al
		cmp	[bp+var_1], 80h
		jnb	short loc_1BA19
		cmp	[bp+var_1], 10h
		jb	short loc_1BA19
		mov	byte_25A38, 1
		jmp	short loc_1BA2A
; ---------------------------------------------------------------------------

loc_1BA19:
		cmp	[bp+var_1], 80h
		jb	short loc_1BA33
		cmp	[bp+var_1], 0F0h
		ja	short loc_1BA33
		mov	byte_25A38, 0FFh

loc_1BA2A:
		mov	al, _stage_frame_mod2
		add	byte ptr word_25A36+1, al
		jmp	short loc_1BA40
; ---------------------------------------------------------------------------

loc_1BA33:
		mov	al, byte ptr word_25A36+1
		inc	al
		mov	byte ptr word_25A36+1, al
		mov	byte_25A38, 0

loc_1BA40:
		mov	al, byte_25A38
		add	byte ptr word_25A36, al
		jmp	short loc_1BA50
; ---------------------------------------------------------------------------

loc_1BA49:
		mov	al, _stage_frame_mod2
		add	byte ptr word_25A36+1, al

loc_1BA50:
		cmp	motion_25A28.cur.x, (64 shl 4)
		jg	short loc_1BA60
		mov	byte_25A26, 3
		jmp	loc_1BBA4
; ---------------------------------------------------------------------------

loc_1BA60:
		cmp	motion_25A28.cur.x, (320 shl 4)
		jl	short loc_1BA70
		mov	byte_25A26, 4
		jmp	loc_1BBA4
; ---------------------------------------------------------------------------

loc_1BA70:
		cmp	motion_25A28.cur.y, (304 shl 4)
		jl	short loc_1BA80
		mov	byte_25A26, 5
		jmp	loc_1BBA4
; ---------------------------------------------------------------------------

loc_1BA80:
		cmp	motion_25A28.cur.y, (32 shl 4)
		jg	loc_1BBA4
		mov	byte_25A26, 6
		jmp	loc_1BBA4
; ---------------------------------------------------------------------------

loc_1BA92:
		mov	al, byte ptr word_25A36+1
		add	al, 0FCh
		mov	byte ptr word_25A36+1, al
		mov	al, byte_25A38
		add	byte ptr word_25A36, al
		cmp	byte ptr word_25A36+1, 4
		ja	loc_1BBA8
		jmp	short loc_1BB0C
; ---------------------------------------------------------------------------

loc_1BAAC:
		mov	al, byte ptr word_25A36+1
		add	al, 0FCh
		mov	byte ptr word_25A36+1, al
		mov	al, byte_25A38
		add	byte ptr word_25A36, al
		cmp	byte_25A38, 0
		jz	short loc_1BACB
		mov	al, byte_25A38
		add	byte ptr word_25A36, al
		jmp	short loc_1BACF
; ---------------------------------------------------------------------------

loc_1BACB:
		inc	byte ptr word_25A36

loc_1BACF:
		cmp	byte ptr word_25A36+1, 4
		ja	loc_1BBA8
		jmp	short loc_1BB0C
; ---------------------------------------------------------------------------

loc_1BADA:
		mov	al, byte ptr word_25A36+1
		add	al, 0FCh
		mov	byte ptr word_25A36+1, al
		mov	al, byte_25A38
		add	byte ptr word_25A36, al
		cmp	byte ptr word_25A36+1, 4
		ja	loc_1BBA8
		jmp	short loc_1BB0C
; ---------------------------------------------------------------------------

loc_1BAF4:
		mov	al, byte ptr word_25A36+1
		add	al, 0FCh
		mov	byte ptr word_25A36+1, al
		mov	al, byte_25A38
		add	byte ptr word_25A36, al
		cmp	byte ptr word_25A36+1, 4
		ja	loc_1BBA8

loc_1BB0C:
		mov	byte_25A26, 7
		jmp	loc_1BBA8
; ---------------------------------------------------------------------------

loc_1BB14:
		mov	ax, _boss_pos.cur.y
		sub	ax, motion_25A28.cur.y
		push	ax
		mov	ax, _boss_pos.cur.x
		sub	ax, motion_25A28.cur.x
		push	ax
		call	iatan2
		mov	byte ptr word_25A36, al
		mov	al, byte ptr word_25A36+1
		add	al, 8
		mov	byte ptr word_25A36+1, al
		mov	ax, _boss_pos.cur.x
		add	ax, (-16 shl 4)
		cmp	ax, motion_25A28.cur.x
		jge	short loc_1BBA8
		mov	ax, _boss_pos.cur.x
		add	ax, (16 shl 4)
		cmp	ax, motion_25A28.cur.x
		jle	short loc_1BBA8
		mov	ax, _boss_pos.cur.y
		add	ax, (-16 shl 4)
		cmp	ax, motion_25A28.cur.y
		jge	short loc_1BBA8
		mov	ax, _boss_pos.cur.y
		add	ax, (16 shl 4)
		cmp	ax, motion_25A28.cur.y
		jle	short loc_1BBA8
		mov	byte_25A26, 8
		mov	byte_25A27, 2
		mov	word_25A34, 0
		jmp	short loc_1BBA8
; ---------------------------------------------------------------------------

loc_1BB76:
		cmp	word_25A34, 20h	; ' '
		jnb	short loc_1BB93
		test	byte ptr word_25A34, 7
		jnz	short loc_1BB93
		mov	ax, 1Fh
		sub	ax, word_25A34
		shr	ax, 2
		add	al, 134
		mov	_boss_sprite, al

loc_1BB93:
		cmp	word_25A34, 20h	; ' '
		jb	short loc_1BBA4
		mov	_boss_sprite, 134
		mov	byte_25A26, 0

loc_1BBA4:
		inc	word_25A34

loc_1BBA8:
		cmp	byte_25A27, 1
		jnz	short locret_1BC2A
		push	ds
		push	offset motion_25A28.velocity.x
		push	ds
		push	offset motion_25A28.velocity.y
		push	word_25A36
		mov	al, byte ptr word_25A36+1
		mov	ah, 0
		push	ax
		call	vector2
		mov	word_257E2, 200h
		mov	word_257E4, 200h
		mov	ax, motion_25A28.cur.x
		mov	word ptr dword_257DE, ax
		mov	ax, motion_25A28.cur.y
		mov	word ptr dword_257DE+2,	ax
		call	sub_105B9
		shr	ax, 1
		mov	dx, motion_25A28.velocity.y
		sub	dx, ax
		mov	motion_25A28.velocity.y, dx
		call	_motion_update_2 pascal, offset motion_25A28
		mov	ax, motion_25A28.cur.x
		add	ax, (-24 shl 4)
		cmp	ax, _player_pos.cur.x
		jge	short locret_1BC2A
		mov	ax, motion_25A28.cur.x
		add	ax, (24 shl 4)
		cmp	ax, _player_pos.cur.x
		jle	short locret_1BC2A
		mov	ax, motion_25A28.cur.y
		add	ax, (-24 shl 4)
		cmp	ax, _player_pos.cur.y
		jge	short locret_1BC2A
		mov	ax, motion_25A28.cur.y
		add	ax, (24 shl 4)
		cmp	ax, _player_pos.cur.y
		jle	short locret_1BC2A
		mov	byte_259A9, 1

locret_1BC2A:
		leave
		retn
sub_1B95C	endp

; ---------------------------------------------------------------------------
off_1BC2C	dw offset loc_1B982
		dw offset loc_1B9E1
		dw offset loc_1BA92
		dw offset loc_1BAAC
		dw offset loc_1BADA
		dw offset loc_1BAF4
		dw offset loc_1BB14
		dw offset loc_1BB76

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1BC3C	proc near
		push	bp
		mov	bp, sp
		mov	byte ptr word_25A36+1, 8
		mov	ax, _player_pos.cur.y
		sub	ax, _boss_pos.cur.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, _boss_pos.cur.x
		push	ax
		call	iatan2
		mov	byte ptr word_25A36, al
		mov	byte_25A26, 1
		mov	word_25A34, 0
		mov	byte_25A27, 0
		mov	byte_25A38, 0
		pop	bp
		retn
sub_1BC3C	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1BC73	proc near
		push	bp
		mov	bp, sp
		cmp	word_25A3A, 80h
		jge	short loc_1BC8A
		add	_boss_pos.prev.x, 8
		mov	_boss_angle, 96
		jmp	short loc_1BCE9
; ---------------------------------------------------------------------------

loc_1BC8A:
		cmp	word_25A3A, 100h
		jge	short loc_1BC98
		dec	_boss_angle
		jmp	short loc_1BCE9
; ---------------------------------------------------------------------------

loc_1BC98:
		cmp	word_25A3A, 180h
		jl	short loc_1BCCA
		cmp	word_25A3A, 200h
		jge	short loc_1BCB4
		add	_boss_pos.prev.x, 8
		mov	_boss_angle, 32
		jmp	short loc_1BCE9
; ---------------------------------------------------------------------------

loc_1BCB4:
		cmp	word_25A3A, 280h
		jge	short loc_1BCC2
		inc	_boss_angle
		jmp	short loc_1BCE9
; ---------------------------------------------------------------------------

loc_1BCC2:
		cmp	word_25A3A, 300h
		jge	short loc_1BCD1

loc_1BCCA:
		sub	_boss_pos.prev.x, 8
		jmp	short loc_1BCE9
; ---------------------------------------------------------------------------

loc_1BCD1:
		cmp	word_25A3A, 300h
		jl	short loc_1BCE9
		add	_boss_pos.prev.x, 8
		mov	_boss_angle, 96
		mov	word_25A3A, 0

loc_1BCE9:
		push	(192 shl 4)
		push	_boss_pos.prev.x
		mov	al, _boss_angle
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_CosTable8[bx]
		call	vector1_at
		mov	_boss_pos.cur.x, ax
		push	(96 shl 4)
		push	_boss_pos.prev.x
		mov	al, _boss_angle
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_SinTable8[bx]
		call	vector1_at
		mov	_boss_pos.cur.y, ax
		pop	bp
		retn
sub_1BC73	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1BD23	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 32
		jnz	short loc_1BD30
		call	sub_1BC3C

loc_1BD30:
		cmp	_boss_phase_frame, 32
		jle	short loc_1BD49
		cmp	byte_25A26, 0
		jnz	short loc_1BD49
		mov	_boss_mode, 0FFh
		mov	_boss_phase_frame, 0

loc_1BD49:
		pop	bp
		retn
sub_1BD23	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1BD4B	proc near
		push	bp
		mov	bp, sp
		call	sub_1BC73
		inc	word_25A3A
		cmp	_boss_phase_frame, 16
		jnz	short loc_1BD64
		call	sub_1BC3C
		mov	_bullet_template.BT_angle, -40h

loc_1BD64:
		cmp	_boss_phase_frame, 16
		jle	short loc_1BDB2
		cmp	_stage_frame_mod16, 0
		jnz	short loc_1BDA0
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_D_YELLOW
		mov	_bullet_template.speed, (3 shl 4)
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 5
		mov	_bullet_template.BT_delta.spread_angle, 10h
		call	fp_2D004
		call	fp_2D000
		mov	al, _bullet_template.BT_angle
		add	al, -10h
		mov	_bullet_template.BT_angle, al

loc_1BDA0:
		cmp	byte_25A26, 0
		jnz	short loc_1BDB2
		mov	_boss_mode, 0FFh
		mov	_boss_phase_frame, 0

loc_1BDB2:
		pop	bp
		retn
sub_1BD4B	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1BDB4	proc near

var_2		= word ptr -2

		enter	2, 0
		cmp	_boss_phase_frame, 32
		jle	short loc_1BDC3
		mov	al, 0
		leave
		retn
; ---------------------------------------------------------------------------

loc_1BDC3:
		mov	ax, _boss_phase_frame
		mov	[bp+var_2], ax
		mov	cx, 4		; switch 4 cases
		mov	bx, offset word_1BE33

loc_1BDCF:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_1BDDE
		add	bx, 2
		loop	loc_1BDCF
		jmp	short loc_1BE2E	; default
; ---------------------------------------------------------------------------

loc_1BDDE:
		jmp	word ptr cs:[bx+8] ; switch jump
; ---------------------------------------------------------------------------

loc_1BDE2:
		mov	ax, _boss_pos.cur.x
		mov	point_2A8C6.x, ax
		mov	ax, _boss_pos.cur.y
		mov	point_2A8C6.y, ax
		mov	word_2A8D0, 8
		mov	word_2A8CE, 0C00h
		mov	byte_2A8D2, 0Fh

loc_1BDFF:
		mov	byte_2A8D3, 0FEh
		call	sub_13B21
		mov	byte_2A8D3, 2
		call	sub_13B21
		jmp	short loc_1BE2E	; default
; ---------------------------------------------------------------------------

loc_1BE11:
		push	_boss_pos.cur.x
		push	_boss_pos.cur.y
		call	circles_add_shrinking
		mov	_circles_color, 0Fh

loc_1BE23:
		mov	byte_2A8D2, 7
		jmp	short loc_1BDFF
; ---------------------------------------------------------------------------

loc_1BE2A:
		mov	al, 2
		leave
		retn
; ---------------------------------------------------------------------------

loc_1BE2E:
		mov	al, 1		; default
		leave
		retn
sub_1BDB4	endp

; ---------------------------------------------------------------------------
		db 0
word_1BE33	dw 1
		dw 8
		dw 10h
		dw 20h
		dw offset loc_1BDE2
		dw offset loc_1BE23
		dw offset loc_1BE11
		dw offset loc_1BE2A

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1BE43	proc near
		push	bp
		mov	bp, sp
		mov	_boss_mode, 0FFh
		mov	_boss_phase_frame, 0
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_BACKWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.speed, (2 shl 4)
		mov	_bullet_template.pattern, BP_RING_AIMED
		mov	_bullet_template.count, 48
		call	fp_2D004
		call	sub_1CFA2
		pop	bp
		retn
sub_1BE43	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1BE78	proc near
		push	bp
		mov	bp, sp
		call	sub_1BDB4
		mov	ah, 0
		or	ax, ax
		jz	short loc_1BEA5
		cmp	ax, 2
		jnz	loc_1BF50
		mov	ax, _player_pos.cur.y
		sub	ax, _boss_pos.cur.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, _boss_pos.cur.x
		push	ax
		call	iatan2
		add	al, 0C0h
		jmp	loc_1BF40
; ---------------------------------------------------------------------------

loc_1BEA5:
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1BEB9
		call	snd_se_play pascal, 9

loc_1BEB9:
		cmp	_boss_phase_frame, 72
		jge	short loc_1BEF7
		mov	ax, _boss_phase_frame
		mov	bx, 2
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_1BF50
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.speed, (4 shl 4)
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 2
		mov	_bullet_template.BT_delta.spread_angle, 0Ch
		call	fp_2D004
		call	fp_2D000
		mov	al, _bullet_template.BT_angle
		add	al, 4
		jmp	short loc_1BF40
; ---------------------------------------------------------------------------

loc_1BEF7:
		cmp	_boss_phase_frame, 72
		jnz	short loc_1BF05
		mov	al, _bullet_template.BT_angle
		add	al, 40h
		jmp	short loc_1BF40
; ---------------------------------------------------------------------------

loc_1BF05:
		cmp	_boss_phase_frame, 144
		jge	short loc_1BF45
		mov	ax, _boss_phase_frame
		mov	bx, 2
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1BF50
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.speed, (4 shl 4)
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 2
		mov	_bullet_template.BT_delta.spread_angle, 0Ch
		call	fp_2D004
		call	fp_2D000
		mov	al, _bullet_template.BT_angle
		add	al, -2

loc_1BF40:
		mov	_bullet_template.BT_angle, al
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1BF45:
		cmp	_boss_phase_frame, 144
		jl	short loc_1BF50
		call	sub_1BE43

loc_1BF50:
		pop	bp
		retn
sub_1BE78	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1BF52	proc near
		push	bp
		mov	bp, sp
		call	sub_1BC73
		inc	word_25A3A
		cmp	_boss_phase_frame, 16
		jnz	short loc_1BF66
		call	sub_1BC3C

loc_1BF66:
		cmp	_boss_phase_frame, 16
		jle	short loc_1BFA9
		mov	ax, _boss_phase_frame
		mov	bx, 16
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1BF97
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.speed, (2 shl 4)
		mov	_bullet_template.pattern, BP_RING_AIMED
		mov	_bullet_template.count, 8
		call	fp_2D000

loc_1BF97:
		cmp	byte_25A26, 0
		jnz	short loc_1BFA9
		mov	_boss_mode, 0FFh
		mov	_boss_phase_frame, 0

loc_1BFA9:
		pop	bp
		retn
sub_1BF52	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1BFAB	proc near
		push	bp
		mov	bp, sp
		call	sub_1BDB4
		mov	ah, 0
		or	ax, ax
		jz	short loc_1BFD7
		cmp	ax, 2
		jnz	loc_1C042
		mov	ax, _player_pos.cur.y
		sub	ax, _boss_pos.cur.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, _boss_pos.cur.x
		push	ax
		call	iatan2
		add	al, 0C0h
		jmp	short loc_1C033
; ---------------------------------------------------------------------------

loc_1BFD7:
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1BFEB
		call	snd_se_play pascal, 9

loc_1BFEB:
		cmp	_boss_phase_frame, 80
		jge	short loc_1C038
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1C042
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	ax, _boss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		add	al, (2 shl 4) + 12
		mov	_bullet_template.speed, al
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 4
		mov	_bullet_template.BT_delta.spread_angle, 0Ch
		mov	_bullet_template.patnum, PAT_BULLET16_N_OUTLINED_BALL_WHITE
		call	fp_2D004
		call	fp_2D000
		mov	al, _bullet_template.BT_angle
		add	al, 0Bh

loc_1C033:
		mov	_bullet_template.BT_angle, al
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1C038:
		cmp	_boss_phase_frame, 80
		jl	short loc_1C042
		call	sub_1BE43

loc_1C042:
		pop	bp
		retn
sub_1BFAB	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1C044	proc near
		push	bp
		mov	bp, sp
		call	sub_1BC73
		inc	word_25A3A
		call	sub_1BC73
		inc	word_25A3A
		cmp	_boss_phase_frame, 16
		jnz	short loc_1C07C
		call	sub_1BC3C
		mov	_bullet_template.BT_angle, 40h
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.speed, (4 shl 4)
		mov	_bullet_template.pattern, BP_SINGLE_AIMED
		mov	_bullet_template.patnum, PAT_BULLET16_N_OUTLINED_BALL_BLUE
		call	fp_2D004

loc_1C07C:
		cmp	_boss_phase_frame, 16
		jle	short loc_1C0BD
		cmp	_stage_frame_mod8, 0
		jnz	short loc_1C0AB
		call	fp_2D000
		mov	al, _bullet_template.BT_angle
		neg	al
		mov	_bullet_template.BT_angle, al
		call	fp_2D000
		mov	al, _bullet_template.BT_angle
		neg	al
		add	al, -3
		mov	_bullet_template.BT_angle, al
		call	snd_se_play pascal, 3

loc_1C0AB:
		cmp	byte_25A26, 0
		jnz	short loc_1C0BD
		mov	_boss_mode, 0FFh
		mov	_boss_phase_frame, 0

loc_1C0BD:
		pop	bp
		retn
sub_1C044	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1C0BF	proc near
		push	bp
		mov	bp, sp
		call	sub_1BDB4
		mov	ah, 0
		or	ax, ax
		jz	short loc_1C0EB
		cmp	ax, 2
		jnz	loc_1C162
		mov	ax, _player_pos.cur.y
		sub	ax, _boss_pos.cur.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, _boss_pos.cur.x
		push	ax
		call	iatan2

loc_1C0E7:
		add	al, 40h
		jmp	short loc_1C147
; ---------------------------------------------------------------------------

loc_1C0EB:
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1C0FF
		call	snd_se_play pascal, 9

loc_1C0FF:
		cmp	_boss_phase_frame, 80
		jge	short loc_1C14C
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1C162
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	ax, _boss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		add	al, (2 shl 4) + 12
		mov	_bullet_template.speed, al
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 4
		mov	_bullet_template.BT_delta.spread_angle, 0Ch
		mov	_bullet_template.patnum, PAT_BULLET16_N_OUTLINED_BALL_WHITE
		call	fp_2D004
		call	fp_2D000
		mov	al, _bullet_template.BT_angle
		add	al, -0Bh

loc_1C147:
		mov	_bullet_template.BT_angle, al
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1C14C:
		cmp	_boss_phase_frame, 80
		jnz	short loc_1C158
		mov	al, _bullet_template.BT_angle
		jmp	short loc_1C0E7
; ---------------------------------------------------------------------------

loc_1C158:
		cmp	_boss_phase_frame, 80
		jl	short loc_1C162
		call	sub_1BE43

loc_1C162:
		pop	bp
		retn
sub_1C0BF	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1C164	proc near
		push	bp
		mov	bp, sp
		call	sub_1BC73
		inc	word_25A3A
		call	sub_1BC73
		inc	word_25A3A
		cmp	_boss_phase_frame, 16
		jnz	short loc_1C19C
		call	sub_1BC3C
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.speed, (2 shl 4)
		mov	_bullet_template.pattern, BP_RING_AIMED
		mov	_bullet_template.count, 16
		call	fp_2D004

loc_1C19C:
		cmp	_boss_phase_frame, 16
		jle	short loc_1C1CD
		mov	ax, _boss_phase_frame
		mov	bx, 16
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1C1BB
		call	fp_2D000
		call	snd_se_play pascal, 3

loc_1C1BB:
		cmp	byte_25A26, 0
		jnz	short loc_1C1CD
		mov	_boss_mode, 0FFh
		mov	_boss_phase_frame, 0

loc_1C1CD:
		pop	bp
		retn
sub_1C164	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1C1CF	proc near

		push	bp
		mov	bp, sp
		call	sub_1BDB4
		mov	ah, 0
		or	ax, ax
		jz	short loc_1C245
		cmp	ax, 2
		jnz	short loc_1C24F
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.speed, (2 shl 4)
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 16
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		sub	_bullet_template.BT_origin.x, (32 shl 4)
		call	fp_2D004
		call	fp_2D000
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		add	_bullet_template.BT_origin.x, (64 shl 4)
		call	fp_2D000
		call	randring2_next16

loc_1C21B:
		mov	_bullet_template.BT_angle, al
		sub	_bullet_template.BT_origin.x, (32 shl 4)
		sub	_bullet_template.BT_origin.y, (32 shl 4)
		call	fp_2D000
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		add	_bullet_template.BT_origin.y, (64 shl 4)
		call	fp_2D000
		call	snd_se_play pascal, 9

loc_1C245:
		cmp	_boss_phase_frame, 80
		jl	short loc_1C24F
		call	sub_1BE43

loc_1C24F:
		pop	bp
		retn
sub_1C1CF	endp

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1C251	proc near
		push	bp
		mov	bp, sp
		call	sub_1BC73
		inc	word_25A3A
		call	sub_1BC73
		inc	word_25A3A
		cmp	_boss_phase_frame, 16
		jnz	short loc_1C26C
		call	sub_1BC3C

loc_1C26C:
		cmp	_boss_phase_frame, 16
		jle	short loc_1C2E3
		mov	ax, _boss_phase_frame
		mov	bx, 16
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1C2AD
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE
		mov	_bullet_template.speed, (3 shl 4) + 8
		mov	_bullet_template.pattern, BP_RING_AIMED
		mov	_bullet_template.count, 16
		mov	_bullet_template.BT_angle, 0
		call	fp_2D004
		call	fp_2D000
		call	snd_se_play pascal, 3

loc_1C2AD:
		cmp	_boss_hp, 200
		jg	short loc_1C2D1
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.speed, (2 shl 4)
		mov	_bullet_template.pattern, BP_RANDOM_ANGLE
		mov	_bullet_template.count, 2
		call	fp_2D004
		call	fp_2D000

loc_1C2D1:
		cmp	byte_25A26, 0
		jnz	short loc_1C2E3
		mov	_boss_mode, 0FFh
		mov	_boss_phase_frame, 0

loc_1C2E3:
		pop	bp
		retn
sub_1C251	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

elly_update	proc far

var_2		= word ptr -2

		enter	2, 0
		call	sub_1B95C
		mov	al, _boss_phase
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 4
		ja	loc_1C675
		add	bx, bx
		jmp	cs:off_1C6C4[bx]

loc_1C301:
		mov	byte_25A27, 0
		mov	byte_25A26, 0
		inc	_boss_phase
		mov	_boss_mode, 0
		mov	Palettes+2, 80h
		mov	_palette_changed, 1
		mov	_boss_hp, 6000
		mov	_boss_phase_end_hp, 6000
		jmp	loc_1C67A
; ---------------------------------------------------------------------------

loc_1C32D:
		push	offset _boss_pos
		call	_motion_update_2
		mov	al, _boss_mode
		mov	ah, 0
		or	ax, ax
		jz	short loc_1C343
		cmp	ax, 0FFh
		jz	short loc_1C348
		jmp	short loc_1C39E
; ---------------------------------------------------------------------------

loc_1C343:
		call	sub_1BD23
		jmp	short loc_1C39E
; ---------------------------------------------------------------------------

loc_1C348:
		cmp	_boss_phase_frame, 64
		jg	short loc_1C37B
		cmp	_boss_mode_change, 0
		jz	short loc_1C35D
		cmp	_boss_mode_change, 3
		jnz	short loc_1C365

loc_1C35D:
		mov	_boss_pos.velocity.x, (-1 shl 4)
		jmp	short loc_1C39E
; ---------------------------------------------------------------------------

loc_1C365:
		cmp	_boss_mode_change, 1
		jz	short loc_1C373
		cmp	_boss_mode_change, 2
		jnz	short loc_1C39E

loc_1C373:
		mov	_boss_pos.velocity.x, (1 shl 4)
		jmp	short loc_1C39E
; ---------------------------------------------------------------------------

loc_1C37B:
		cmp	_boss_mode_change, 3
		jnb	short loc_1C388
		inc	_boss_mode_change
		jmp	short loc_1C38D
; ---------------------------------------------------------------------------

loc_1C388:
		mov	_boss_mode_change, 0

loc_1C38D:
		mov	_boss_mode, 0
		mov	_boss_phase_frame, 0
		mov	_boss_pos.velocity.x, 0

loc_1C39E:
		inc	_boss_phase_frame
		call	sub_1E67C
		cmp	_stage_frame, 9240
		jb	loc_1C67A
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		call	snd_se_play pascal, 13
		mov	_boss_pos.velocity.y, 8
		mov	fp_255AC, offset elly_bg_render
		mov	byte_2CDCA, 0
		jmp	loc_1C67A
; ---------------------------------------------------------------------------

loc_1C3D4:
		push	offset _boss_pos
		call	_motion_update_2
		cmp	_boss_pos.cur.x, (192 shl 4)
		jge	short loc_1C3EA
		mov	_boss_pos.velocity.x, (2 shl 4)
		jmp	short loc_1C400
; ---------------------------------------------------------------------------

loc_1C3EA:
		cmp	_boss_pos.cur.x, (193 shl 4)
		jl	short loc_1C3FA
		mov	_boss_pos.velocity.x, (-2 shl 4)
		jmp	short loc_1C400
; ---------------------------------------------------------------------------

loc_1C3FA:
		mov	_boss_pos.velocity.x, 0

loc_1C400:
		call	sub_1E67C
		cmp	_boss_phase_frame, 32
		jl	loc_1C67A
		mov	_boss_pos.velocity.x, 0
		mov	Palettes+2, 0
		mov	_palette_changed, 1
		mov	word_25A3A, 0
		mov	_boss_pos.cur.x, (192 shl 4)
		mov	_boss_pos.cur.y, (96 shl 4)
		mov	_boss_pos.prev.x, 0
		push	0FFFF0000h
		call	sub_1E6F3
		mov	byte_25A24, 0
		jmp	loc_1C67A
; ---------------------------------------------------------------------------

loc_1C445:
		mov	ax, _boss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_bullet_template.BT_origin.y, ax
		mov	al, _boss_mode
		mov	ah, 0
		mov	[bp+var_2], ax
		mov	cx, 0Ah		; switch 10 cases
		mov	bx, offset word_1C69C

loc_1C45F:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_1C46F
		add	bx, 2
		loop	loc_1C45F
		jmp	loc_1C585	; default
; ---------------------------------------------------------------------------

loc_1C46F:
		jmp	word ptr cs:[bx+14h] ; switch jump
; ---------------------------------------------------------------------------

loc_1C473:
		call	sub_1BD4B
		jmp	loc_1C585	; default
; ---------------------------------------------------------------------------

loc_1C479:
		call	sub_1BE78
		jmp	loc_1C585	; default
; ---------------------------------------------------------------------------

loc_1C47F:
		call	sub_1BF52
		jmp	loc_1C585	; default
; ---------------------------------------------------------------------------

loc_1C485:
		call	sub_1BFAB
		jmp	loc_1C585	; default
; ---------------------------------------------------------------------------

loc_1C48B:
		call	sub_1C044
		jmp	loc_1C585	; default
; ---------------------------------------------------------------------------

loc_1C491:
		call	sub_1C0BF
		jmp	loc_1C585	; default
; ---------------------------------------------------------------------------

loc_1C497:
		call	sub_1C164
		jmp	loc_1C585	; default
; ---------------------------------------------------------------------------

loc_1C49D:
		call	sub_1C1CF
		jmp	loc_1C585	; default
; ---------------------------------------------------------------------------

loc_1C4A3:
		call	sub_1C251
		jmp	loc_1C585	; default
; ---------------------------------------------------------------------------

loc_1C4A9:
		cmp	_boss_phase_frame, 32
		jge	short loc_1C4BA
		call	sub_1BC73
		inc	word_25A3A
		jmp	loc_1C585	; default
; ---------------------------------------------------------------------------

loc_1C4BA:
		inc	_boss_mode_change
		mov	al, byte_25A24
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 4
		ja	loc_1C57F
		add	bx, bx
		jmp	cs:off_1C692[bx]

loc_1C4D3:
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	bx, 2
		cwd
		idiv	bx
		mov	_boss_mode, dl
		cmp	_boss_mode_change, 8
		jb	loc_1C57F

loc_1C4EB:
		mov	al, byte_25A24
		mov	ah, 0
		call	boss_explode_small pascal, ax
		mov	_boss_mode, 0FFh
		inc	byte_25A24
		mov	al, byte_25A24
		mov	ah, 0
		imul	ax, 1500
		mov	dx, 6000
		sub	dx, ax
		mov	_boss_hp, dx
		jmp	short loc_1C57F
; ---------------------------------------------------------------------------

loc_1C511:
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		mov	_boss_mode, dl
		cmp	_boss_mode_change, 16
		jb	short loc_1C57F
		jmp	short loc_1C4EB
; ---------------------------------------------------------------------------

loc_1C529:
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		add	dl, 2
		mov	_boss_mode, dl
		cmp	_boss_mode_change, 24
		jb	short loc_1C57F
		jmp	short loc_1C4EB
; ---------------------------------------------------------------------------

loc_1C544:
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		add	dl, 4
		mov	_boss_mode, dl
		cmp	_boss_mode_change, 32
		jb	short loc_1C57F
		jmp	short loc_1C4EB
; ---------------------------------------------------------------------------

loc_1C55F:
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		add	dl, 5
		mov	_boss_mode, dl
		cmp	_boss_mode_change, 40
		jb	short loc_1C57F
		mov	_boss_mode_change, 0
		jmp	short loc_1C591
; ---------------------------------------------------------------------------

loc_1C57F:
		mov	_boss_phase_frame, 0

loc_1C585:
		call	sub_1E64E	; default
		or	al, al
		jz	short loc_1C5B1
		mov	_boss_mode_change, 1

loc_1C591:
		inc	_boss_phase
		call	sparks_add_circle pascal, _boss_pos.cur.x, _boss_pos.cur.y, large (((8 shl 4) shl 16) or 48)
		call	boss_explode_small pascal, 4
		mov	_boss_phase_frame, 0

loc_1C5B1:
		cmp	byte_25A24, 0
		jnz	short loc_1C5C0
		cmp	_boss_hp, 4700
		jle	short loc_1C5F1

loc_1C5C0:
		cmp	byte_25A24, 1
		jnz	short loc_1C5CF
		cmp	_boss_hp, 3300
		jle	short loc_1C5F1

loc_1C5CF:
		cmp	byte_25A24, 2
		jnz	short loc_1C5DE
		cmp	_boss_hp, 2100
		jle	short loc_1C5F1

loc_1C5DE:
		cmp	byte_25A24, 3
		jnz	loc_1C67A
		cmp	_boss_hp, 700
		jg	loc_1C67A

loc_1C5F1:
		call	sub_1E692
		cmp	_bullet_clear_time, 20
		jnb	short loc_1C600
		mov	_bullet_clear_time, 20

loc_1C600:
		push	0Ah
		call	sub_19FD8
		mov	al, byte_25A24
		mov	ah, 0
		call	boss_explode_small pascal, ax
		mov	_boss_mode, 0FFh
		mov	_boss_phase_frame, 0
		inc	byte_25A24
		jmp	short loc_1C67A
; ---------------------------------------------------------------------------

loc_1C61F:
		inc	_boss_phase_frame
		cmp	_boss_phase_frame, 16
		jnz	short loc_1C62F
		call	boss_explode_small pascal, 4

loc_1C62F:
		cmp	_boss_phase_frame, 32
		jnz	short loc_1C67A
		call	boss_explode_big pascal, 3
		mov	_boss_phase, PHASE_EXPLODE_BIG
		mov	al, _boss_mode_change
		mov	_bullet_clear_trigger, al
		cmp	_boss_mode_change, 0
		jz	short loc_1C652
		push	28h ; '('
		call	sub_19FD8

loc_1C652:
		mov	_boss_sprite, 4
		mov	_boss_phase_frame, 0
		call	snd_se_play pascal, 12
		mov	_player_invincibility_time, BOSS_DEFEAT_INVINCIBILITY_FRAMES
		mov	byte_25A26, 0
		mov	byte_25A27, 0
		jmp	short loc_1C67A
; ---------------------------------------------------------------------------

loc_1C675:
		call	sub_1E743
		leave
		retf
; ---------------------------------------------------------------------------

loc_1C67A:
		mov	ax, _boss_pos.cur.x
		mov	_homing_target.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_homing_target.y, ax
		push	_boss_hp
		push	6000
		call	sub_19F16
		leave
		retf
elly_update	endp
; ---------------------------------------------------------------------------

off_1C692	dw offset loc_1C4D3
		dw offset loc_1C511
		dw offset loc_1C529
		dw offset loc_1C544
		dw offset loc_1C55F
word_1C69C	dw 0
		dw 1
		dw 2
		dw 3
		dw 4
		dw 5
		dw 6
		dw 7
		dw 8
		dw 0FFh
		dw offset loc_1C473
		dw offset loc_1C479
		dw offset loc_1C47F
		dw offset loc_1C485
		dw offset loc_1C48B
		dw offset loc_1C491
		dw offset loc_1C497
		dw offset loc_1C49D
		dw offset loc_1C4A3
		dw offset loc_1C4A9
off_1C6C4	dw offset loc_1C301
		dw offset loc_1C32D
		dw offset loc_1C3D4
		dw offset loc_1C445
		dw offset loc_1C61F

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public BULLET_TURN_X
bullet_turn_x	proc near

@@bullet		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+@@bullet]
		inc	[si+bullet_t.turn_count]
		mov	al, 80h
		sub	al, [si+bullet_t.BULLET_angle]
		mov	[si+bullet_t.BULLET_angle], al
		mov	al, [si+bullet_t.turn_count]
		cmp	al, byte_2CFF7
		jb	short loc_1C6ED
		mov	[si+bullet_t.move_state], BMS_NORMAL

loc_1C6ED:
		lea	ax, [si+bullet_t.pos.velocity]
		push	ax
		push	word ptr [si+bullet_t.BULLET_angle]
		mov	al, [si+bullet_t.speed_cur]
		mov	ah, 0
		push	ax
		call	vector2_near
		pop	si
		pop	bp
		retn	2
bullet_turn_x	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public BULLET_TURN_Y
bullet_turn_y	proc near

@@bullet		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+@@bullet]
		inc	[si+bullet_t.turn_count]
		mov	al, [si+bullet_t.BULLET_angle]
		neg	al
		mov	[si+bullet_t.BULLET_angle], al
		mov	al, [si+bullet_t.turn_count]
		cmp	al, byte_2CFF7
		jb	short loc_1C721
		mov	[si+bullet_t.move_state], BMS_NORMAL

loc_1C721:
		lea	ax, [si+bullet_t.pos.velocity]
		push	ax
		push	word ptr [si+bullet_t.BULLET_angle]
		mov	al, [si+bullet_t.speed_cur]
		mov	ah, 0
		push	ax
		call	vector2_near
		pop	si
		pop	bp
		retn	2
bullet_turn_y	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public BULLET_UPDATE_SPECIAL
bullet_update_special	proc near

@@bullet		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+@@bullet]
		mov	al, [si+bullet_t.special_motion]
		mov	ah, 0
		sub	ax, 80h
		mov	bx, ax
		cmp	bx, 8
		ja	loc_1C8B1
		add	bx, bx
		jmp	cs:off_1C8B6[bx]

loc_1C755:
		cmp	[si+bullet_t.speed_cur], 0
		jz	short loc_1C75D
		jmp	short loc_1C790
; ---------------------------------------------------------------------------

loc_1C75D:
		inc	[si+bullet_t.turn_count]
		mov	ax, _player_pos.cur.y
		sub	ax, [si+bullet_t.pos.cur.y]
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, [si+bullet_t.pos.cur.x]
		push	ax
		call	iatan2
		mov	[si+bullet_t.BULLET_angle], al
		mov	al, [si+bullet_t.speed_final]
		mov	[si+bullet_t.speed_cur], al
		mov	al, [si+bullet_t.turn_count]
		cmp	al, byte_2CFF7
		jb	loc_1C831
		jmp	loc_1C82D
; ---------------------------------------------------------------------------

loc_1C78A:
		cmp	[si+bullet_t.speed_cur], 0
		jz	short loc_1C7A6

loc_1C790:
		lea	ax, [si+bullet_t.pos.velocity]
		push	ax
		push	word ptr [si+bullet_t.BULLET_angle]
		mov	al, [si+bullet_t.speed_cur]
		mov	ah, 0
		push	ax
		call	vector2_near
		dec	[si+bullet_t.speed_cur]
		jmp	loc_1C8B1
; ---------------------------------------------------------------------------

loc_1C7A6:
		inc	[si+bullet_t.turn_count]
		mov	al, [si+bullet_t.turn_angle]
		add	[si+bullet_t.BULLET_angle], al
		mov	al, [si+bullet_t.speed_final]
		mov	[si+bullet_t.speed_cur], al
		mov	al, [si+bullet_t.turn_count]
		cmp	al, byte_2CFF7
		jb	short loc_1C831
		jmp	short loc_1C82D
; ---------------------------------------------------------------------------

loc_1C7C0:
		lea	ax, [si+bullet_t.pos.velocity]
		push	ax
		push	word ptr [si+bullet_t.BULLET_angle]
		mov	al, [si+bullet_t.speed_cur]
		mov	ah, 0
		push	ax
		call	vector2_near
		mov	al, byte_2CFF7
		add	[si+bullet_t.speed_cur], al
		jmp	loc_1C8B1
; ---------------------------------------------------------------------------

loc_1C7D9:
		cmp	[si+bullet_t.speed_cur], 0
		jz	short loc_1C821
		lea	ax, [si+bullet_t.pos.velocity]
		push	ax
		push	word ptr [si+bullet_t.BULLET_angle]
		mov	al, [si+bullet_t.speed_cur]
		mov	ah, 0
		push	ax
		call	vector2_near
		cmp	[si+bullet_t.speed_cur], 1
		jbe	short loc_1C7FF
		mov	al, [si+bullet_t.speed_cur]
		add	al, -2
		mov	[si+bullet_t.speed_cur], al
		jmp	short loc_1C803
; ---------------------------------------------------------------------------

loc_1C7FF:
		mov	[si+bullet_t.speed_cur], 0

loc_1C803:
		cmp	[si+bullet_t.speed_cur], (2 shl 4)
		jnb	loc_1C8B1
		mov	al, [si+bullet_t.turn_angle]
		sub	al, [si+bullet_t.BULLET_angle]
		cbw
		mov	bx, 4
		cwd
		idiv	bx
		add	al, [si+bullet_t.BULLET_angle]
		mov	[si+bullet_t.BULLET_angle], al
		jmp	loc_1C8B1
; ---------------------------------------------------------------------------

loc_1C821:
		mov	al, [si+bullet_t.turn_angle]
		mov	[si+bullet_t.BULLET_angle], al
		mov	al, [si+bullet_t.speed_final]
		mov	[si+bullet_t.speed_cur], al

loc_1C82D:
		mov	[si+bullet_t.move_state], BMS_NORMAL

loc_1C831:
		lea	ax, [si+bullet_t.pos.velocity]
		push	ax
		push	word ptr [si+bullet_t.BULLET_angle]
		mov	al, [si+bullet_t.speed_cur]
		mov	ah, 0
		push	ax
		call	vector2_near
		jmp	short loc_1C8B1
; ---------------------------------------------------------------------------

loc_1C843:
		cmp	[si+bullet_t.pos.cur.x], 0
		jle	short loc_1C850
		cmp	[si+bullet_t.pos.cur.x], (PLAYFIELD_W shl 4)
		jl	short loc_1C8B1

loc_1C850:
		call	bullet_turn_x pascal, si
		jmp	short loc_1C8B1
; ---------------------------------------------------------------------------

loc_1C856:
		cmp	[si+bullet_t.pos.cur.y], 0
		jle	short loc_1C89C
		cmp	[si+bullet_t.pos.cur.y], (PLAYFIELD_H shl 4)
		jl	short loc_1C8B1
		jmp	short loc_1C89C
; ---------------------------------------------------------------------------

loc_1C865:
		cmp	[si+bullet_t.pos.cur.x], 0
		jle	short loc_1C872
		cmp	[si+bullet_t.pos.cur.x], (PLAYFIELD_W shl 4)
		jl	short loc_1C876

loc_1C872:
		call	bullet_turn_x pascal, si

loc_1C876:
		cmp	[si+bullet_t.pos.cur.y], 0
		jle	short loc_1C89C
		cmp	[si+bullet_t.pos.cur.y], (PLAYFIELD_H shl 4)
		jl	short loc_1C8B1
		jmp	short loc_1C89C
; ---------------------------------------------------------------------------

loc_1C885:
		cmp	[si+bullet_t.pos.cur.x], 0
		jle	short loc_1C892
		cmp	[si+bullet_t.pos.cur.x], (PLAYFIELD_W shl 4)
		jl	short loc_1C896

loc_1C892:
		call	bullet_turn_x pascal, si

loc_1C896:
		cmp	[si+bullet_t.pos.cur.y], 0
		jg	short loc_1C8B1

loc_1C89C:
		call	bullet_turn_y pascal, si
		jmp	short loc_1C8B1
; ---------------------------------------------------------------------------

loc_1C8A2:
		cmp	_stage_frame_mod2, 0
		jz	short loc_1C8B1
		mov	al, byte_2CFF7
		mov	ah, 0
		add	[si+bullet_t.pos.velocity.y], ax

loc_1C8B1:
		pop	si
		pop	bp
		retn	2

; ---------------------------------------------------------------------------
off_1C8B6	dw offset loc_1C755
		dw offset loc_1C78A
		dw offset loc_1C7C0
		dw offset loc_1C7D9
		dw offset loc_1C843
		dw offset loc_1C856
		dw offset loc_1C865
		dw offset loc_1C885
		dw offset loc_1C8A2
bullet_update_special	endp

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public BULLETS_UPDATE
bullets_update	proc far

@@patnum		= byte ptr -9
var_8		= word ptr -8
var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2

		push	bp
		mov	bp, sp
		sub	sp, 0Ah
		push	si
		push	di
		mov	[bp+var_2], 0
		mov	word_2D006, 0
		mov	si, offset _bullets[(BULLET_COUNT - 1) * size bullet_t]
		cmp	_bullet_clear_trigger, 0
		jnz	loc_1CB44
		xor	di, di
		jmp	loc_1CAFC
; ---------------------------------------------------------------------------

loc_1C8EC:
		cmp	[si+bullet_t.flag], 0
		jz	loc_1CAF8
		cmp	[si+bullet_t.flag], 2
		jnz	short loc_1C8FE
		mov	[si+bullet_t.flag], 0
		jmp	loc_1CAF8
; ---------------------------------------------------------------------------

loc_1C8FE:
		inc	[bp+var_2]
		cmp	_bullet_clear_time, 0
		jz	short loc_1C961
		cmp	[si+bullet_t.move_state], BMS_DECAY
		jnb	short loc_1C939
		mov	[si+bullet_t.move_state], BMS_DECAY
		cmp	di, BULLET16_COUNT
		jge	short loc_1C91D
		mov	ax, PAT_DECAY_BULLET16
		jmp	short loc_1C920
; ---------------------------------------------------------------------------

loc_1C91D:
		mov	ax, PAT_DECAY_PELLET

loc_1C920:
		mov	[si+bullet_t.BULLET_patnum], ax
		cmp	[si+bullet_t.age], 0
		jz	short loc_1C931
		add	_score_delta, 100
		jmp	short loc_1C961
; ---------------------------------------------------------------------------

loc_1C931:
		add	_score_delta, 10
		jmp	short loc_1C961
; ---------------------------------------------------------------------------

loc_1C939:
		inc	[si+bullet_t.move_state]
		cmp	[si+bullet_t.move_state], BMS_DECAY_END
		jb	short loc_1C94F
		lea	ax, [si+bullet_t.pos]
		call	_motion_update_2 pascal, ax
		mov	[si+bullet_t.flag], 2
		jmp	loc_1CAF8
; ---------------------------------------------------------------------------

loc_1C94F:
		mov	al, [si+bullet_t.move_state]
		mov	ah, 0
		mov	bx, (BMS_DECAY_FRAMES / BULLET_DECAY_CELS)
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1C961
		inc	[si+bullet_t.BULLET_patnum]

loc_1C961:
		inc	[si+bullet_t.age]
		cmp	[si+bullet_t.spawn_state], BSS_ACTIVE
		jb	short loc_1C9DA
		cmp	[si+bullet_t.spawn_state], BSS_ACTIVE
		jnz	short loc_1C976
		mov	[si+bullet_t.spawn_state], BSS_GRAZEABLE
		jmp	short loc_1C9DA
; ---------------------------------------------------------------------------

loc_1C976:
		cmp	[si+bullet_t.spawn_state], BSS_CLOUD_BACKWARDS
		jnz	short loc_1C99C
		mov	eax, dword ptr [si+bullet_t.pos.cur]
		mov	dword ptr [si+bullet_t.pos.prev], eax
		mov	ax, [si+bullet_t.pos.velocity.x]
		shl	ax, 3
		sub	[si+bullet_t.pos.cur.x], ax
		mov	ax, [si+bullet_t.pos.velocity.y]
		shl	ax, 3
		sub	[si+bullet_t.pos.cur.y], ax
		mov	[si+bullet_t.spawn_state], BSS_CLOUD_FORWARDS
		jmp	short loc_1C9C8
; ---------------------------------------------------------------------------

loc_1C99C:
		cmp	[si+bullet_t.spawn_state], BSS_CLOUD_FORWARDS
		jnz	short loc_1C9AB
		lea	ax, [si+bullet_t.pos]
		call	_motion_update_2 pascal, ax
		jmp	short loc_1C9C8
; ---------------------------------------------------------------------------

loc_1C9AB:
		mov	eax, dword ptr [si+bullet_t.pos.cur]
		mov	dword ptr [si+bullet_t.pos.prev], eax
		mov	ax, [si+bullet_t.pos.velocity.x]
		mov	bx, 3
		cwd
		idiv	bx
		add	[si+bullet_t.pos.cur.x], ax
		mov	ax, [si+bullet_t.pos.velocity.y]
		cwd
		idiv	bx
		add	[si+bullet_t.pos.cur.y], ax

loc_1C9C8:
		inc	[si+bullet_t.spawn_state]
		cmp	[si+bullet_t.spawn_state], BSS_CLOUD_END
		jb	loc_1CAF8
		mov	[si+bullet_t.spawn_state], BSS_ACTIVE
		jmp	loc_1CAF8
; ---------------------------------------------------------------------------

loc_1C9DA:
		cmp	[si+bullet_t.move_state], BMS_SPECIAL
		jnz	short loc_1C9E6
		call	bullet_update_special pascal, si
		jmp	short loc_1CA27
; ---------------------------------------------------------------------------

loc_1C9E6:
		cmp	[si+bullet_t.move_state], BMS_SLOWDOWN
		jnz	short loc_1CA27
		dec	[si+bullet_t.slowdown_time]
		mov	al, [si+bullet_t.slowdown_time]
		mov	ah, 0
		mov	dl, [si+bullet_t.slowdown_speed_delta]
		mov	dh, 0
		imul	dx
		mov	bx, BMS_SLOWDOWN_FRAMES
		cwd
		idiv	bx
		add	al, [si+bullet_t.speed_final]
		mov	[si+bullet_t.speed_cur], al
		cmp	[si+bullet_t.slowdown_time], 0
		jnz	short loc_1CA17
		mov	al, [si+bullet_t.speed_final]
		mov	[si+bullet_t.speed_cur], al
		mov	[si+bullet_t.move_state], BMS_NORMAL

loc_1CA17:
		lea	ax, [si+bullet_t.pos.velocity]
		push	ax
		push	word ptr [si+bullet_t.BULLET_angle]
		mov	al, [si+bullet_t.speed_cur]
		mov	ah, 0
		push	ax
		call	vector2_near

loc_1CA27:
		lea	ax, [si+bullet_t.pos]
		call	_motion_update_2 pascal, ax
		cmp	ax, (-8 shl 4)
		jle	short loc_1CA43
		cmp	ax, ((PLAYFIELD_W + 8) shl 4)
		jge	short loc_1CA43
		cmp	dx, (-8 shl 4)
		jle	short loc_1CA43
		cmp	dx, ((PLAYFIELD_H + 8) shl 4)
		jl	short loc_1CA49

loc_1CA43:
		mov	[si+bullet_t.flag], 2
		jmp	loc_1CAF8
; ---------------------------------------------------------------------------

loc_1CA49:
		cmp	_bullet_clear_time, 0
		jnz	loc_1CAF8
		sub	ax, _player_pos.cur.x
		sub	dx, _player_pos.cur.y
		cmp	_player_invincibility_time, 0
		jnz	short loc_1CAC5
		cmp	[si+bullet_t.spawn_state], BSS_GRAZEABLE
		jz	short loc_1CA82
		add	ax, (4 shl 4)
		cmp	ax, (8 shl 4)
		ja	short loc_1CAC5
		add	dx, (4 shl 4)
		cmp	dx, (8 shl 4)
		ja	short loc_1CAC5
		mov	[si+bullet_t.flag], 2
		mov	byte_259A9, 1
		jmp	short loc_1CAF8
; ---------------------------------------------------------------------------

loc_1CA82:
		add	ax, (16 shl 4)
		cmp	ax, (36 shl 4)
		ja	short loc_1CAC5
		add	dx, (22 shl 4)
		cmp	dx, (44 shl 4)
		ja	short loc_1CAC5
		push	[si+bullet_t.pos.cur.x]
		push	[si+bullet_t.pos.cur.y]
		push	large (((2 shl 4) shl 16) or 2)
		nopcall	sparks_add_random
		mov	[si+bullet_t.spawn_state], BSS_GRAZED
		cmp	_stage_graze, GRAZE_MAX
		jnb	short loc_1CAC5
		inc	_stage_graze
		call	hud_graze_put
		movzx	eax, score_2CFFE
		add	_score_delta, eax

loc_1CAC5:
		cmp	di, BULLET16_COUNT
		jl	short loc_1CAF8
		mov	ax, [si+bullet_t.pos.cur.x]
		sar	ax, 4
		add	ax, 28
		mov	bx, word_2D006
		shl	bx, 2
		mov	[bx-792Eh], ax
		mov	ax, [si+bullet_t.pos.cur.y]
		add	ax, (12 shl 4)
		call	scroll_subpixel_y_to_vram_seg3 pascal, ax
		mov	bx, word_2D006
		shl	bx, 2
		mov	[bx-792Ch], ax
		inc	word_2D006

loc_1CAF8:
		inc	di
		sub	si, size bullet_t

loc_1CAFC:
		cmp	di, BULLET_COUNT
		jl	loc_1C8EC
		cmp	_turbo_mode, 0
		jnz	loc_1CC19
		mov	di, 24
		mov	al, _playperf
		mov	ah, 0
		add	di, ax
		mov	al, _rank
		mov	ah, 0
		shl	ax, 3
		add	di, ax
		cmp	[bp+var_2], di
		jl	short loc_1CB31
		cmp	_stage_frame_mod2, 0
		jnz	loc_1CC19
		jmp	short loc_1CB3B
; ---------------------------------------------------------------------------

loc_1CB31:
		lea	ax, [di+18h]
		cmp	ax, [bp+var_2]
		jg	loc_1CC19

loc_1CB3B:
		mov	word_266D0, 2
		jmp	loc_1CC19
; ---------------------------------------------------------------------------

loc_1CB44:
		mov	al, _bullet_clear_trigger
		mov	ah, 0
		mov	bx, BULLET_DECAY_CELS
		cwd
		idiv	bx
		add	al, PAT_BULLET_KILL
		mov	[bp+@@patnum], al
		mov	[bp+var_4], 1
		mov	[bp+var_6], 1
		mov	al, _rank
		mov	ah, 0
		mov	bx, ax
		cmp	bx, RANK_EXTRA
		ja	short loc_1CB84
		add	bx, bx
		jmp	cs:off_1CC29[bx]

loc_1CB71:
		mov	[bp+var_8], 3E8h
		jmp	short loc_1CB84
; ---------------------------------------------------------------------------

loc_1CB78:
		mov	[bp+var_8], 640h
		jmp	short loc_1CB84
; ---------------------------------------------------------------------------

loc_1CB7F:
		mov	[bp+var_8], 7D0h

loc_1CB84:
		mov	_popup_bonus, 0
		xor	di, di
		jmp	short loc_1CBF1
; ---------------------------------------------------------------------------

loc_1CB91:
		cmp	[si+bullet_t.flag], 1
		jnz	short loc_1CBED
		mov	[si+bullet_t.pos.velocity.x], 0
		mov	[si+bullet_t.pos.velocity.y], 0
		lea	ax, [si+bullet_t.pos]
		call	_motion_update_2 pascal, ax
		cmp	[bp+@@patnum], PAT_BULLET16_D
		jnb	short loc_1CBB7
		mov	al, [bp+@@patnum]
		mov	ah, 0
		mov	[si+bullet_t.BULLET_patnum], ax
		jmp	short loc_1CBED
; ---------------------------------------------------------------------------

loc_1CBB7:
		movzx	eax, [bp+var_4]
		add	_popup_bonus, eax
		add	_score_delta, eax
		push	[si+bullet_t.pos.cur.x]
		push	[si+bullet_t.pos.cur.y]
		push	[bp+var_4]
		call	sub_13DAA
		mov	ax, [bp+var_6]
		add	[bp+var_4], ax
		add	[bp+var_6], 3
		mov	ax, [bp+var_4]
		cmp	ax, [bp+var_8]
		jbe	short loc_1CBEA
		mov	ax, [bp+var_8]
		mov	[bp+var_4], ax

loc_1CBEA:
		mov	[si+bullet_t.flag], 2

loc_1CBED:
		inc	di
		sub	si, size bullet_t

loc_1CBF1:
		cmp	di, BULLET_COUNT
		jl	short loc_1CB91
		cmp	_popup_bonus, 0
		jz	short loc_1CC0A
		mov	_popup_id_new, POPUP_ID_BONUS
		mov	_popup_fp, offset popup_update_and_render

loc_1CC0A:
		inc	_bullet_clear_trigger
		cmp	[bp+@@patnum], PAT_BULLET16_D
		jb	short loc_1CC19
		mov	_bullet_clear_trigger, 0

loc_1CC19:
		cmp	_bullet_clear_time, 0
		jz	short loc_1CC24
		dec	_bullet_clear_time

loc_1CC24:
		pop	di
		pop	si
		leave
		retf
; ---------------------------------------------------------------------------
		db 0
off_1CC29	dw offset loc_1CB71
		dw offset loc_1CB78
		dw offset loc_1CB78
		dw offset loc_1CB78
		dw offset loc_1CB7F
bullets_update	endp

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1CC33	proc near
		push	bp
		mov	bp, sp
		mov	al, _bullet_template.pattern
		mov	ah, 0
		sub	ax, BP_RANDOM_ANGLE
		mov	bx, ax
		cmp	bx, (BP_STACK_AIMED - BP_RANDOM_ANGLE)
		ja	short @@ret
		add	bx, bx
		jmp	cs:off_1CC8C[bx]

@@stack:
		mov	al, _bullet_template.BT_delta.stack_speed
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		mov	dl, _bullet_template.BT_delta.stack_speed
		sub	dl, al
		mov	_bullet_template.BT_delta.stack_speed, dl
		cmp	_bullet_template.count, 2
		jb	short @@ret
		dec	_bullet_template.count
		pop	bp
		retn
; ---------------------------------------------------------------------------

@@spread:
		cmp	_bullet_template.count, 3
		jb	short @@ret
		mov	al, _bullet_template.count
		add	al, -2
		jmp	short loc_1CC86
; ---------------------------------------------------------------------------

loc_1CC7C:
		mov	al, _bullet_template.count
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1

loc_1CC86:
		mov	_bullet_template.count, al

@@ret:
		pop	bp
		retn

; ---------------------------------------------------------------------------
		db 0
off_1CC8C	dw offset loc_1CC7C
		dw offset @@ret
		dw offset @@ret
		dw offset @@ret
		dw offset @@ret
		dw offset @@ret
		dw offset @@ret
		dw offset @@ret
		dw offset @@ret
		dw offset @@ret
		dw offset @@ret
		dw offset loc_1CC7C
		dw offset @@ret
		dw offset @@ret
		dw offset @@ret
		dw offset @@ret
		dw offset @@ret
		dw offset loc_1CC7C
		dw offset @@spread
		dw offset @@spread
		dw offset @@stack
		dw offset @@stack
sub_1CC33	endp

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1CCB8	proc near

@@pattern		= word ptr -2

		enter	2, 0
		mov	al, _bullet_template.pattern
		mov	ah, 0
		mov	[bp+@@pattern], ax
		mov	cx, 0Ah
		mov	bx, offset word_1CD46

loc_1CCCA:
		mov	ax, cs:[bx]
		cmp	ax, [bp+@@pattern]
		jz	short loc_1CCD9
		add	bx, 2
		loop	loc_1CCCA
		jmp	short locret_1CD43 ; default
; ---------------------------------------------------------------------------

loc_1CCD9:
		jmp	word ptr cs:[bx+14h] ; switch jump
; ---------------------------------------------------------------------------

@@single_aimed:
		mov	_bullet_template.pattern, BP_STACK_AIMED
		jmp	short loc_1CCE9
; ---------------------------------------------------------------------------

@@single:
		mov	_bullet_template.pattern, BP_STACK

loc_1CCE9:
		mov	_bullet_template.count, 2
		mov	_bullet_template.BT_delta.stack_speed, 6
		leave
		retn
; ---------------------------------------------------------------------------

@@stack:
		mov	al, _bullet_template.BT_delta.stack_speed
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, _bullet_template.BT_delta.stack_speed
		mov	_bullet_template.BT_delta.stack_speed, al
		leave
		retn
; ---------------------------------------------------------------------------

@@spread:
		mov	al, _bullet_template.count
		add	al, 2
		jmp	short loc_1CD40
; ---------------------------------------------------------------------------

@@ring:
		mov	al, _bullet_template.count
		mov	ah, 0
		imul	ax, 3
		mov	_bullet_template.count, al
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	_bullet_template.count, al
		cmp	_bullet_template.count, 48
		jbe	short locret_1CD43 ; default
		mov	_bullet_template.count, 48
		leave
		retn
; ---------------------------------------------------------------------------

@@random:
		mov	al, _bullet_template.count
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, _bullet_template.count

loc_1CD40:
		mov	_bullet_template.count, al

locret_1CD43:
		leave			; default
		retn

; ---------------------------------------------------------------------------
		db 0
word_1CD46	dw BP_SINGLE
		dw BP_SINGLE_AIMED
		dw BP_RANDOM_ANGLE
		dw BP_RANDOM_ANGLE_AND_SPEED
		dw BP_RING
		dw BP_RING_AIMED
		dw BP_SPREAD
		dw BP_SPREAD_AIMED
		dw BP_STACK
		dw BP_STACK_AIMED
		dw offset @@single
		dw offset @@single_aimed
		dw offset @@random
		dw offset @@random
		dw offset @@ring
		dw offset @@ring
		dw offset @@spread
		dw offset @@spread
		dw offset @@stack
		dw offset @@stack
sub_1CCB8	endp

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1CD6E	proc near

@@pattern		= word ptr -2

		enter	2, 0
		mov	al, _bullet_template.pattern
		mov	ah, 0
		mov	[bp+@@pattern], ax
		mov	cx, 0Ah
		mov	bx, offset word_1CDEA

loc_1CD80:
		mov	ax, cs:[bx]
		cmp	ax, [bp+@@pattern]
		jz	short loc_1CD8F
		add	bx, 2
		loop	loc_1CD80
		jmp	short locret_1CDE7 ; default
; ---------------------------------------------------------------------------

loc_1CD8F:
		jmp	word ptr cs:[bx+14h] ; switch jump
; ---------------------------------------------------------------------------

@@single_aimed:
		mov	_bullet_template.pattern, BP_SPREAD_AIMED
		jmp	short loc_1CD9F
; ---------------------------------------------------------------------------

@@single:
		mov	_bullet_template.pattern, BP_SPREAD

loc_1CD9F:
		mov	_bullet_template.count, 3
		mov	_bullet_template.BT_delta.spread_angle, 6
		leave
		retn
; ---------------------------------------------------------------------------

@@stack:
		mov	al, _bullet_template.BT_delta.stack_speed
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, _bullet_template.BT_delta.stack_speed
		mov	_bullet_template.BT_delta.stack_speed, al
		inc	_bullet_template.count
		leave
		retn
; ---------------------------------------------------------------------------

@@spread:
		mov	al, _bullet_template.count
		add	al, 4
		jmp	short loc_1CDE4
; ---------------------------------------------------------------------------

@@ring:
		mov	al, _bullet_template.count
		add	al, al
		mov	_bullet_template.count, al
		cmp	_bullet_template.count, 48
		jbe	short locret_1CDE7 ; default
		mov	_bullet_template.count, 48
		leave
		retn
; ---------------------------------------------------------------------------

@@random:
		mov	al, _bullet_template.count
		add	al, al

loc_1CDE4:
		mov	_bullet_template.count, al

locret_1CDE7:
		leave			; default
		retn

; ---------------------------------------------------------------------------
		db 0
word_1CDEA	dw BP_SINGLE
		dw BP_SINGLE_AIMED
		dw BP_RANDOM_ANGLE
		dw BP_RANDOM_ANGLE_AND_SPEED
		dw BP_RING
		dw BP_RING_AIMED
		dw BP_SPREAD
		dw BP_SPREAD_AIMED
		dw BP_STACK
		dw BP_STACK_AIMED
		dw offset @@single
		dw offset @@single_aimed
		dw offset @@random
		dw offset @@random
		dw offset @@ring
		dw offset @@ring
		dw offset @@spread
		dw offset @@spread
		dw offset @@stack
		dw offset @@stack
sub_1CD6E	endp

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1CE12	proc near
		push	bp
		mov	bp, sp
		mov	al, _bullet_template.pattern
		mov	ah, 0
		sub	ax, BP_RING
		mov	bx, ax
		cmp	bx, 0Ah
		ja	@@ret
		add	bx, bx
		jmp	cs:off_1CEAF[bx]

@@stack:
		cmp	_playperf, 24
		jb	short loc_1CE3A
		inc	_bullet_template.count
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1CE3A:
		cmp	_playperf, 6
		ja	short @@ret
		cmp	_bullet_template.count, 2
		jb	short @@ret
		dec	_bullet_template.count
		pop	bp
		retn
; ---------------------------------------------------------------------------

@@spread:
		cmp	_playperf, 24
		jb	short loc_1CE57
		jmp	short loc_1CE81
; ---------------------------------------------------------------------------

loc_1CE57:
		cmp	_playperf, 6
		ja	short @@ret
		cmp	_bullet_template.count, 3
		jb	short @@ret
		mov	al, _bullet_template.count
		add	al, -2
		jmp	short loc_1CEAA
; ---------------------------------------------------------------------------

@@ring:
		cmp	_playperf, 24
		jb	short loc_1CE7A
		mov	al, _bullet_template.count
		add	al, 4
		jmp	short loc_1CEAA
; ---------------------------------------------------------------------------

loc_1CE7A:
		cmp	_playperf, 20
		jb	short loc_1CE88

loc_1CE81:
		mov	al, _bullet_template.count
		add	al, 2
		jmp	short loc_1CEAA
; ---------------------------------------------------------------------------

loc_1CE88:
		cmp	_bullet_template.count, 5
		jb	short @@ret
		cmp	_playperf, 10
		ja	short loc_1CE9E
		mov	al, _bullet_template.count
		add	al, -2
		mov	_bullet_template.count, al

loc_1CE9E:
		cmp	_playperf, 4
		ja	short @@ret
		mov	al, _bullet_template.count
		add	al, -4

loc_1CEAA:
		mov	_bullet_template.count, al

@@ret:
		pop	bp
		retn

; ---------------------------------------------------------------------------
off_1CEAF	dw offset @@ring
		dw offset @@ret
		dw offset @@ret
		dw offset @@ret
		dw offset @@ret
		dw offset @@ret
		dw offset @@ring
		dw offset @@spread
		dw offset @@spread
		dw offset @@stack
		dw offset @@stack
sub_1CE12	endp

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1CEC5	proc near
		push	bp
		mov	bp, sp
		call	sub_1CE12
		call	sub_1CC33
		pop	bp
		retn
sub_1CEC5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1CED0	proc near
		push	bp
		mov	bp, sp
		call	sub_1CE12
		pop	bp
		retn
sub_1CED0	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1CED8	proc near
		push	bp
		mov	bp, sp
		call	sub_1CE12
		call	sub_1CCB8
		pop	bp
		retn
sub_1CED8	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1CEE3	proc near
		push	bp
		mov	bp, sp
		call	sub_1CE12
		call	sub_1CD6E
		pop	bp
		retn
sub_1CEE3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1CEEE	proc near

var_2		= byte ptr -2
var_1		= byte ptr -1

		enter	2, 0
		cmp	_bullet_clear_trigger, 0
		jnz	short locret_1CF14
		mov	al, _bullet_template.count
		mov	[bp+var_2], al
		mov	al, _bullet_template.speed
		mov	[bp+var_1], al
		call	sub_1D294
		mov	al, [bp+var_2]
		mov	_bullet_template.count, al
		mov	al, [bp+var_1]
		mov	_bullet_template.speed, al

locret_1CF14:
		leave
		retn
sub_1CEEE	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1CF16	proc near

var_1		= byte ptr -1

		enter	2, 0
		cmp	_bullet_clear_trigger, 0
		jnz	short locret_1CF30
		mov	al, _bullet_template.speed
		mov	[bp+var_1], al
		call	sub_1D294
		mov	al, [bp+var_1]
		mov	_bullet_template.speed, al

locret_1CF30:
		leave
		retn
sub_1CF16	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1CF32	proc near

var_1		= byte ptr -1

		enter	2, 0
		cmp	_bullet_clear_trigger, 0
		jnz	short locret_1CF4C
		mov	al, _bullet_template.speed
		mov	[bp+var_1], al
		call	sub_1D294
		mov	al, [bp+var_1]
		mov	_bullet_template.speed, al

locret_1CF4C:
		leave
		retn
sub_1CF32	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1CF4E	proc near

var_1		= byte ptr -1

		enter	2, 0
		cmp	_bullet_clear_trigger, 0
		jnz	short locret_1CF68
		mov	al, _bullet_template.speed
		mov	[bp+var_1], al
		call	sub_1D3BF
		mov	al, [bp+var_1]
		mov	_bullet_template.speed, al

locret_1CF68:
		leave
		retn
sub_1CF4E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1CF6A	proc near

var_1		= byte ptr -1

		enter	2, 0
		cmp	_bullet_clear_trigger, 0
		jnz	short locret_1CF84
		mov	al, _bullet_template.speed
		mov	[bp+var_1], al
		call	sub_1D3BF
		mov	al, [bp+var_1]
		mov	_bullet_template.speed, al

locret_1CF84:
		leave
		retn
sub_1CF6A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1CF86	proc near

var_1		= byte ptr -1

		enter	2, 0
		cmp	_bullet_clear_trigger, 0
		jnz	short locret_1CFA0
		mov	al, _bullet_template.speed
		mov	[bp+var_1], al
		call	sub_1D3BF
		mov	al, [bp+var_1]
		mov	_bullet_template.speed, al

locret_1CFA0:
		leave
		retn
sub_1CF86	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1CFA2	proc near
		push	bp
		mov	bp, sp
		mov	byte_23278, 1
		call	fp_2D000
		mov	byte_23278, 0
		pop	bp
		retn
sub_1CFA2	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1CFB5	proc near
		push	bp
		mov	bp, sp
		mov	byte_23278, 1
		call	fp_2D002
		mov	byte_23278, 0
		pop	bp
		retn
sub_1CFB5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1CFC8	proc near

var_4		= byte ptr -4
var_3		= byte ptr -3
var_2		= word ptr -2
arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		sub	sp, 4
		push	si
		mov	si, [bp+arg_0]
		mov	[bp+var_2], 0
		mov	[bp+var_4], 0
		mov	al, _bullet_template.speed
		mov	[bp+var_3], al
		mov	al, _bullet_template.pattern
		mov	ah, 0
		cmp	ax, BP_RING_AIMED
		jz	@@ring_aimed
		jg	short loc_1D027
		cmp	ax, BP_RANDOM_ANGLE
		jz	@@random_angle
		jg	short loc_1D00F
		or	ax, ax
		jz	@@single
		cmp	ax, BP_SINGLE_AIMED
		jz	@@single_aimed
		cmp	ax, BP_FORCESINGLE_RANDOM_ANGLE
		jz	@@single_random_angle
		jmp	@@aim
; ---------------------------------------------------------------------------

loc_1D00F:
		cmp	ax, BP_RANDOM_ANGLE_AND_SPEED
		jz	@@random_angle_and_speed
		cmp	ax, BP_SPREAD_RANDOM_ANGLE_AIMED
		jz	@@spread_random_angle_aimed
		cmp	ax, BP_RING
		jz	@@ring
		jmp	@@aim
; ---------------------------------------------------------------------------

loc_1D027:
		cmp	ax, BP_STACK_AIMED
		jz	@@stack
		jg	short loc_1D044
		cmp	ax, BP_SPREAD
		jz	short @@spread
		cmp	ax, BP_SPREAD_AIMED
		jz	short @@spread
		cmp	ax, BP_STACK
		jz	@@stack
		jmp	@@aim
; ---------------------------------------------------------------------------

loc_1D044:
		cmp	ax, BP_FORCESINGLE
		jz	@@single
		cmp	ax, BP_FORCESINGLE_AIMED
		jz	@@single_aimed
		jmp	@@aim
; ---------------------------------------------------------------------------

@@spread:
		test	_bullet_template.count, 1
		jz	short loc_1D088
		or	si, si
		jnz	short loc_1D06C
		mov	byte_2CFF6, 0
		mov	[bp+var_2], 0
		jmp	short loc_1D0B0
; ---------------------------------------------------------------------------

loc_1D06C:
		test	si, 1
		jz	short loc_1D0A8
		mov	al, _bullet_template.BT_delta.spread_angle
		add	byte_2CFF6, al

loc_1D079:
		mov	al, byte_2CFF6
		mov	ah, 0
		mov	dx, 100h
		sub	dx, ax
		mov	[bp+var_2], dx
		jmp	short loc_1D0B0
; ---------------------------------------------------------------------------

loc_1D088:
		or	si, si
		jnz	short loc_1D09B
		mov	al, _bullet_template.BT_delta.spread_angle
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	byte_2CFF6, al
		jmp	short loc_1D0A8
; ---------------------------------------------------------------------------

loc_1D09B:
		test	si, 1
		jnz	short loc_1D079
		mov	al, _bullet_template.BT_delta.spread_angle
		add	byte_2CFF6, al

loc_1D0A8:
		mov	al, byte_2CFF6
		mov	ah, 0
		mov	[bp+var_2], ax

loc_1D0B0:
		mov	al, _bullet_template.count
		mov	ah, 0
		dec	ax
		cmp	ax, si
		jg	short loc_1D0BE
		mov	[bp+var_4], 1

loc_1D0BE:
		cmp	_bullet_template.pattern, BP_SPREAD
		jnz	@@aim
		jmp	@@static
; ---------------------------------------------------------------------------

@@ring:
		mov	ax, si
		shl	ax, 8
		mov	dl, _bullet_template.count
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		mov	[bp+var_2], ax
		mov	al, _bullet_template.count
		mov	ah, 0
		dec	ax
		cmp	ax, si
		jg	@@static
		jmp	short @@single
; ---------------------------------------------------------------------------

@@ring_aimed:
		mov	ax, si
		shl	ax, 8
		mov	dl, _bullet_template.count
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		mov	[bp+var_2], ax
		mov	al, _bullet_template.count
		mov	ah, 0
		dec	ax
		cmp	ax, si
		jg	@@aim
		jmp	short @@single_aimed
; ---------------------------------------------------------------------------

@@single_random_angle:
		call	randring2_next16
		mov	[bp+var_2], ax

@@single:
		mov	[bp+var_4], 1
		jmp	@@static
; ---------------------------------------------------------------------------

@@random_angle:
		call	randring2_next16
		mov	[bp+var_2], ax
		mov	al, _bullet_template.count
		mov	ah, 0
		dec	ax
		cmp	ax, si
		jg	short @@static
		jmp	short @@single
; ---------------------------------------------------------------------------

@@random_angle_and_speed:
		call	randring2_next16
		mov	[bp+var_2], ax
		call	randring2_next16_and pascal, 1Fh
		add	al, [bp+var_3]
		mov	[bp+var_3], al
		mov	al, _bullet_template.count
		mov	ah, 0
		dec	ax
		cmp	ax, si
		jg	short @@static
		jmp	short @@single
; ---------------------------------------------------------------------------

@@spread_random_angle_aimed:
		call	randring2_next16_and pascal, 1Fh
		mov	[bp+var_2], ax
		sub	[bp+var_2], 10h
		mov	al, _bullet_template.count
		mov	ah, 0
		dec	ax
		cmp	ax, si
		jg	short @@aim

@@single_aimed:
		mov	[bp+var_4], 1
		jmp	short @@aim
; ---------------------------------------------------------------------------

@@stack:
		mov	al, _bullet_template.BT_delta.stack_speed
		mov	ah, 0
		imul	si
		add	al, [bp+var_3]
		mov	[bp+var_3], al
		mov	al, _bullet_template.count
		mov	ah, 0
		dec	ax
		cmp	ax, si
		jle	short loc_1D182
		cmp	_bullet_template.speed, (10 shl 4)
		jb	short loc_1D186

loc_1D182:
		mov	[bp+var_4], 1

loc_1D186:
		cmp	_bullet_template.pattern, BP_STACK
		jz	short @@static

@@aim:
		mov	ax, _player_pos.cur.y
		sub	ax, _bullet_template.BT_origin.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, _bullet_template.BT_origin.x
		push	ax
		call	iatan2
		add	[bp+var_2], ax

@@static:
		push	offset _bullet_template.BT_velocity
		mov	al, byte ptr [bp+var_2]
		add	al, _bullet_template.BT_angle
		push	ax
		mov	al, [bp+var_3]
		mov	ah, 0
		push	ax
		call	vector2_near
		mov	al, byte ptr [bp+var_2]
		add	al, _bullet_template.BT_angle
		mov	angle_2D008, al
		mov	al, [bp+var_4]
		mov	ah, 0
		pop	si
		leave
		retn	2
sub_1CFC8	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1D1CD	proc near
		push	bp
		mov	bp, sp
		mov	al, _bullet_template.speed
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	_bullet_template.speed, al
		mov	ah, 0
		mov	cx, ax
		mov	al, _playperf
		mov	ah, 0
		imul	cx
		mov	cx, ax
		mov	bx, 10h
		mov	ax, cx
		cwd
		idiv	bx
		mov	cx, ax
		mov	al, _bullet_template.speed
		add	al, cl
		mov	_bullet_template.speed, al
		cmp	_bullet_template.speed, (8 shl 4)
		jbe	short loc_1D20A
		mov	_bullet_template.speed, (8 shl 4)
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1D20A:
		cmp	_bullet_template.speed, 8
		jnb	short loc_1D216
		mov	_bullet_template.speed, 8

loc_1D216:
		pop	bp
		retn
sub_1D1CD	endp

include th04/bullet/patnum_for_angle.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1D230	proc near
		push	bp
		mov	bp, sp
		cmp	_bullet_clear_time, 0
		jbe	short loc_1D241
		cmp	_bullet_clear_time, 17
		jbe	short loc_1D282

loc_1D241:
		cmp	_bullet_template.BT_origin.x, (-8 shl 4)
		jle	short loc_1D282
		cmp	_bullet_template.BT_origin.x, ((PLAYFIELD_W + 8) shl 4)
		jge	short loc_1D282
		cmp	_bullet_template.BT_origin.y, (-8 shl 4)
		jle	short loc_1D282
		cmp	_bullet_template.BT_origin.y, ((PLAYFIELD_H + 8) shl 4)
		jge	short loc_1D282
		mov	ax, _bullet_template.BT_origin.x
		sub	ax, _player_pos.cur.x
		add	ax, (4 shl 4)
		cmp	ax, (8 shl 4)
		ja	short loc_1D286
		mov	ax, _bullet_template.BT_origin.y
		sub	ax, _player_pos.cur.y
		add	ax, (4 shl 4)
		cmp	ax, (8 shl 4)
		ja	short loc_1D286
		mov	byte_259A9, 1

loc_1D282:
		mov	al, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1D286:
		cmp	byte_23278, 0
		jnz	short loc_1D290
		call	sub_1D1CD

loc_1D290:
		mov	al, 0
		pop	bp
		retn
sub_1D230	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1D294	proc near

@@spawn_state		= byte ptr -5
var_4		= byte ptr -4
@@move_state		= byte ptr -3
@@i		= word ptr -2

		push	bp
		mov	bp, sp
		sub	sp, 6
		push	si
		push	di
		cmp	_bullet_template.spawn_type, BST_GATHER_PELLET
		jnz	short loc_1D2D5
		mov	eax, _bullet_template.BT_origin
		mov	point_2A8C6, eax
		mov	dword_2A8CA, 0
		mov	word_2A8CE, 400h
		mov	byte_2A8D3, 2
		mov	byte_2A8D2, 9
		mov	word_2A8D0, 8
		mov	_bullet_template.spawn_type, BST_PELLET
		call	sub_13AB7
		jmp	loc_1D3BB
; ---------------------------------------------------------------------------

loc_1D2D5:
		call	sub_1D230
		or	al, al
		jnz	loc_1D3BB
		mov	[bp+@@spawn_state], BSS_GRAZEABLE
		mov	al, _bullet_template.spawn_type
		mov	ah, 0
		cmp	ax, BST_PELLET
		jz	short @@pellet
		cmp	ax, BST_BULLET16_CLOUD_FORWARDS
		jz	short @@cloud_forwards
		cmp	ax, BST_BULLET16_CLOUD_BACKWARDS
		jz	short @@cloud_backwards
		jmp	short loc_1D30C
; ---------------------------------------------------------------------------

@@pellet:
		mov	si, offset _pellets[(PELLET_COUNT - 1) * size bullet_t]
		mov	[bp+@@i], PELLET_COUNT
		jmp	short loc_1D314
; ---------------------------------------------------------------------------

@@cloud_backwards:
		mov	[bp+@@spawn_state], BSS_CLOUD_BACKWARDS
		jmp	short loc_1D30C
; ---------------------------------------------------------------------------

@@cloud_forwards:
		mov	[bp+@@spawn_state], BSS_CLOUD_FORWARDS

loc_1D30C:
		mov	si, offset _bullets16[(BULLET16_COUNT - 1) * size bullet_t]
		mov	[bp+@@i], BULLET16_COUNT

loc_1D314:
		mov	[bp+@@move_state], BMS_NORMAL
		cmp	_bullet_template.speed, (4 shl 4)
		jb	short loc_1D326
		cmp	_bullet_clear_time, 0
		jz	short loc_1D338

loc_1D326:
		cmp	_bullet_template.pattern, BP_STACK
		jz	short loc_1D338
		cmp	_bullet_template.pattern, BP_STACK_AIMED
		jz	short loc_1D338
		mov	[bp+@@move_state], BMS_SLOWDOWN

loc_1D338:
		xor	di, di
		jmp	short loc_1D3B5
; ---------------------------------------------------------------------------

loc_1D33C:
		cmp	[si+bullet_t.flag], 0
		jnz	short loc_1D3AF
		mov	[si+bullet_t.flag], 1
		mov	al, [bp+@@move_state]
		mov	[si+bullet_t.move_state], al
		mov	[si+bullet_t.slowdown_time], BMS_SLOWDOWN_FRAMES
		mov	al, BMS_SLOWDOWN_BASE_SPEED
		sub	al, _bullet_template.speed
		mov	[si+bullet_t.slowdown_speed_delta], al
		mov	[si+bullet_t.age], 0
		mov	eax, _bullet_template.BT_origin
		mov	dword ptr [si+bullet_t.pos.cur], eax
		mov	al, _bullet_template.pattern
		mov	[si+bullet_t.from_pattern], al
		mov	al, _bullet_template.patnum
		mov	ah, 0
		mov	[si+bullet_t.BULLET_patnum], ax
		mov	al, [bp+@@spawn_state]
		mov	[si+bullet_t.spawn_state], al
		push	di
		call	sub_1CFC8
		mov	[bp+var_4], al
		cmp	_bullet_template.patnum, PAT_BULLET16_D
		jb	short loc_1D391
		call	bullet_patnum_for_angle pascal, word ptr angle_2D008
		mov	ah, 0
		add	[si+bullet_t.BULLET_patnum], ax

loc_1D391:
		mov	eax, _bullet_template.BT_velocity
		mov	dword ptr [si+bullet_t.pos.velocity], eax
		mov	al, angle_2D008
		mov	[si+bullet_t.BULLET_angle], al
		mov	al, _bullet_template.speed
		mov	[si+bullet_t.speed_final], al
		mov	[si+bullet_t.speed_cur], al
		cmp	[bp+var_4], 0
		jnz	short loc_1D3BB
		inc	di

loc_1D3AF:
		dec	[bp+@@i]
		sub	si, size bullet_t

loc_1D3B5:
		cmp	[bp+@@i], 0
		jg	short loc_1D33C

loc_1D3BB:
		pop	di
		pop	si
		leave
		retn
sub_1D294	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1D3BF	proc near

@@spawn_state		= byte ptr -4
var_3		= byte ptr -3
@@i		= word ptr -2

		push	bp
		mov	bp, sp
		sub	sp, 4
		push	si
		push	di
		call	sub_1D230
		or	al, al
		jnz	loc_1D48A
		mov	[bp+@@spawn_state], 0
		mov	al, _bullet_template.spawn_type
		mov	ah, 0
		cmp	ax, BST_PELLET
		jz	short @@pellet
		cmp	ax, BST_BULLET16_CLOUD_FORWARDS
		jz	short @@cloud_forwards
		cmp	ax, BST_BULLET16_CLOUD_BACKWARDS
		jz	short @@cloud_backwards
		jmp	short loc_1D3FE
; ---------------------------------------------------------------------------

@@pellet:
		mov	si, offset _pellets[(PELLET_COUNT - 1) * size bullet_t]
		mov	[bp+@@i], PELLET_COUNT
		jmp	short loc_1D406
; ---------------------------------------------------------------------------

@@cloud_backwards:
		mov	[bp+@@spawn_state], BSS_CLOUD_BACKWARDS
		jmp	short loc_1D3FE
; ---------------------------------------------------------------------------

@@cloud_forwards:
		mov	[bp+@@spawn_state], BSS_CLOUD_FORWARDS

loc_1D3FE:
		mov	si, offset _bullets16[(BULLET16_COUNT - 1) * size bullet_t]
		mov	[bp+@@i], BULLET16_COUNT

loc_1D406:
		xor	di, di
		jmp	short loc_1D484
; ---------------------------------------------------------------------------

loc_1D40A:
		cmp	[si+bullet_t.flag], 0
		jnz	short loc_1D47E
		mov	[si+bullet_t.flag], 1
		mov	[si+bullet_t.move_state], BMS_SPECIAL
		mov	al, _bullet_template.BT_special_motion
		mov	[si+bullet_t.special_motion], al
		mov	[si+bullet_t.turn_count], 0
		mov	al, byte_2CFF8
		mov	[si+bullet_t.turn_angle], al
		mov	[si+bullet_t.age], 0
		mov	eax, _bullet_template.BT_origin
		mov	dword ptr [si+bullet_t.pos.cur], eax
		mov	al, _bullet_template.pattern
		mov	[si+bullet_t.from_pattern], al
		mov	al, _bullet_template.patnum
		mov	ah, 0
		mov	[si+bullet_t.BULLET_patnum], ax
		mov	al, [bp+@@spawn_state]
		mov	[si+bullet_t.spawn_state], al
		push	di
		call	sub_1CFC8
		mov	[bp+var_3], al
		cmp	_bullet_template.patnum, PAT_BULLET16_D
		jb	short loc_1D460
		call	bullet_patnum_for_angle pascal, word ptr angle_2D008
		mov	ah, 0
		add	[si+bullet_t.BULLET_patnum], ax

loc_1D460:
		mov	eax, _bullet_template.BT_velocity
		mov	dword ptr [si+bullet_t.pos.velocity], eax
		mov	al, angle_2D008
		mov	[si+bullet_t.BULLET_angle], al
		mov	al, _bullet_template.speed
		mov	[si+bullet_t.speed_final], al
		mov	[si+bullet_t.speed_cur], al
		cmp	[bp+var_3], 0
		jnz	short loc_1D48A
		inc	di

loc_1D47E:
		dec	[bp+@@i]
		sub	si, size bullet_t

loc_1D484:
		cmp	[bp+@@i], 0
		jg	short loc_1D40A

loc_1D48A:
		pop	di
		pop	si
		leave
		retn
sub_1D3BF	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1D48E	proc near

var_12		= dword	ptr -12h
var_E		= dword	ptr -0Eh
var_A		= byte ptr -0Ah
var_4		= byte ptr -4
var_3		= byte ptr -3
var_2		= byte ptr -2
arg_0		= dword	ptr  4
arg_4		= word ptr  8

		enter	12h, 0
		push	si
		push	di
		mov	[bp+var_E], 0F4240h
		xor	si, si
		xor	di, di
		jmp	short loc_1D4EA
; ---------------------------------------------------------------------------

loc_1D4A2:
		mov	eax, [bp+arg_0]
		xor	edx, edx
		div	[bp+var_E]
		mov	[bp+var_12], eax
		mov	eax, [bp+arg_0]
		xor	edx, edx
		div	[bp+var_E]
		mov	[bp+arg_0], edx
		or	di, word ptr [bp+var_12]
		or	di, di
		jz	short loc_1D4D1
		mov	al, byte ptr [bp+var_12]
		add	al, 0A0h
		mov	[bp+si+var_A], al
		jmp	short loc_1D4D5
; ---------------------------------------------------------------------------

loc_1D4D1:
		mov	[bp+si+var_A], 2

loc_1D4D5:
		mov	ebx, 0Ah
		mov	eax, [bp+var_E]
		xor	edx, edx
		div	ebx
		mov	[bp+var_E], eax
		inc	si

loc_1D4EA:
		cmp	[bp+var_E], 1
		ja	short loc_1D4A2
		mov	al, byte ptr [bp+arg_0]
		add	al, 0A0h
		mov	[bp+var_4], al
		mov	[bp+var_3], 0A0h
		mov	[bp+var_2], 0
		push	34
		push	[bp+arg_4]
		push	ss
		lea	ax, [bp+var_A]
		push	ax
		push	TX_WHITE
		call	gaiji_putsa
		pop	di
		pop	si
		leave
		retn	6
sub_1D48E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1D519	proc far

var_A		= word ptr -0Ah
var_8		= word ptr -8
var_6		= byte ptr -6
var_2		= byte ptr -2
var_1		= byte ptr -1
arg_0		= word ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah

		enter	0Ah, 0
		push	si
		push	di
		mov	si, 2710h
		xor	di, di
		mov	[bp+var_A], 0
		jmp	short loc_1D565
; ---------------------------------------------------------------------------

loc_1D52B:
		mov	ax, [bp+arg_0]
		xor	dx, dx
		div	si
		mov	[bp+var_8], ax
		mov	ax, [bp+arg_0]
		xor	dx, dx
		div	si
		mov	[bp+arg_0], dx
		mov	ax, [bp+var_8]
		or	[bp+var_A], ax
		cmp	[bp+var_A], 0
		jz	short loc_1D555
		mov	al, byte ptr [bp+var_8]
		add	al, 0A0h
		mov	[bp+di+var_6], al
		jmp	short loc_1D559
; ---------------------------------------------------------------------------

loc_1D555:
		mov	[bp+di+var_6], 2

loc_1D559:
		mov	bx, 0Ah
		mov	ax, si
		xor	dx, dx
		div	bx
		mov	si, ax
		inc	di

loc_1D565:
		cmp	si, 1
		ja	short loc_1D52B
		mov	al, byte ptr [bp+arg_0]
		add	al, 0A0h
		mov	[bp+var_2], al
		mov	[bp+var_1], 0
		push	[bp+arg_4]
		push	[bp+arg_2]
		push	ss
		lea	ax, [bp+var_6]
		push	ax
		push	TX_WHITE
		call	gaiji_putsa
		pop	di
		pop	si
		leave
		retf	6
sub_1D519	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1D58F	proc near

var_2		= word ptr -2
arg_0		= dword	ptr  4
arg_4		= word ptr  8
arg_6		= word ptr  0Ah
arg_8		= word ptr  0Ch

		enter	2, 0
		push	si
		mov	si, [bp+arg_4]
		movsx	eax, si
		les	bx, [bp+arg_0]
		assume es:nothing
		imul	eax, es:[bx]
		mov	es:[bx], eax
		mov	eax, es:[bx]
		mov	ebx, 0Ah
		xor	edx, edx
		div	ebx
		mov	bx, word ptr [bp+arg_0]
		mov	es:[bx], eax
		cmp	si, 0Ah
		jge	short loc_1D5C8
		mov	ax, TX_RED
		jmp	short loc_1D5CB
; ---------------------------------------------------------------------------

loc_1D5C8:
		mov	ax, TX_GREEN

loc_1D5CB:
		mov	[bp+var_2], ax
		push	6
		push	[bp+arg_8]
		mov	bx, [bp+arg_6]
		shl	bx, 2
		pushd	dword ptr [bx+1F3Ah]
		push	ax
		call	text_putsa
		pop	si
		leave
		retn	0Ah
sub_1D58F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1D5E9	proc near

arg_0		= dword	ptr  4

		push	bp
		mov	bp, sp
		cmp	_boss_mode_change, 0
		jnz	short loc_1D5FE
		push	140000h
		push	0
		jmp	loc_1D6AE
; ---------------------------------------------------------------------------

loc_1D5FE:
		les	bx, _resident
		mov	al, es:[bx+resident_t.credit_lives]
		mov	ah, 0
		cmp	ax, 4
		jz	short loc_1D62D
		cmp	ax, 5
		jz	short loc_1D623
		cmp	ax, 6
		jz	short loc_1D619
		jmp	short loc_1D63C
; ---------------------------------------------------------------------------

loc_1D619:
		push	120001h
		push	3
		jmp	short loc_1D635
; ---------------------------------------------------------------------------

loc_1D623:
		push	120002h
		push	5
		jmp	short loc_1D635
; ---------------------------------------------------------------------------

loc_1D62D:
		push	120003h
		push	7

loc_1D635:
		pushd	[bp+arg_0]
		call	sub_1D58F

loc_1D63C:
		mov	al, _continues_used
		mov	ah, 0
		cmp	ax, 1
		jz	short loc_1D652
		cmp	ax, 2
		jz	short loc_1D65C
		cmp	ax, 3
		jz	short loc_1D666
		jmp	short loc_1D675
; ---------------------------------------------------------------------------

loc_1D652:
		push	130004h
		push	8
		jmp	short loc_1D66E
; ---------------------------------------------------------------------------

loc_1D65C:
		push	130005h
		push	6
		jmp	short loc_1D66E
; ---------------------------------------------------------------------------

loc_1D666:
		push	130006h
		push	4

loc_1D66E:
		pushd	[bp+arg_0]
		call	sub_1D58F

loc_1D675:
		mov	al, _rank
		mov	ah, 0
		mov	bx, ax
		cmp	bx, RANK_LUNATIC
		ja	short loc_1D6B5
		add	bx, bx
		jmp	cs:off_1D6B9[bx]

loc_1D688:
		push	140007h
		push	5
		jmp	short loc_1D6AE
; ---------------------------------------------------------------------------

loc_1D692:
		push	140008h
		push	0Ah
		jmp	short loc_1D6AE
; ---------------------------------------------------------------------------

loc_1D69C:
		push	140009h
		push	0Ch
		jmp	short loc_1D6AE
; ---------------------------------------------------------------------------

loc_1D6A6:
		push	14000Ah
		push	0Eh

loc_1D6AE:
		pushd	[bp+arg_0]
		call	sub_1D58F

loc_1D6B5:
		pop	bp
		retn	4
sub_1D5E9	endp

; ---------------------------------------------------------------------------
off_1D6B9	dw offset loc_1D688
		dw offset loc_1D692
		dw offset loc_1D69C
		dw offset loc_1D6A6

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1D6C1	proc near

var_8		= dword	ptr -8
var_4		= dword	ptr -4

		enter	8, 0
		push	si
		mov	PaletteTone, 60
		call	far ptr	palette_show
		call	gaiji_putsa pascal, (20 shl 16) + 4, ds, offset gpCLEAR_BONUS, TX_WHITE
		call	text_putsa pascal, (6 shl 16) + 7, ds, offset aBONUS_STAGE, TX_WHITE
		call	text_putsa pascal, (6 shl 16) + 9, ds, offset aPOWERX50, TX_WHITE
		call	text_putsa pascal, (6 shl 16) + 11, ds, offset aBONUS_DREAM, TX_WHITE
		call	text_putsa pascal, (6 shl 16) + 13, ds, offset aGRAZEX50, TX_WHITE
		call	text_putsa pascal, (6 shl 16) + 16, ds, offset aBONUS_POINT, TX_WHITE
		call	text_putsa pascal, (6 shl 16) + 21, ds, offset aBONUS_TOTAL, TX_WHITE
		call	text_putsa pascal, (6 shl 16) + 22, ds, offset aBOMB_EXTEND, TX_YELLOW + TX_BLINK
		les	bx, _resident
		mov	al, es:[bx+resident_t.stage]
		mov	ah, 0
		imul	ax, 64h
		add	ax, 64h	; 'd'
		mov	si, ax
		movzx	eax, si
		mov	[bp+var_4], eax
		push	7
		push	eax
		call	sub_1D48E
		mov	al, _power
		mov	ah, 0
		imul	ax, 5
		mov	si, ax
		movzx	eax, si
		add	[bp+var_4], eax
		push	9
		push	eax
		call	sub_1D48E
		mov	si, _dream_score
		movzx	eax, si
		add	[bp+var_4], eax
		push	0Bh
		push	eax
		call	sub_1D48E
		mov	ax, _stage_graze
		imul	ax, 5
		mov	si, ax
		movzx	eax, si
		add	[bp+var_4], eax
		push	0Dh
		push	eax
		call	sub_1D48E
		mov	al, _stage_point_items_collected
		mov	ah, 0
		mov	si, ax
		movzx	eax, si
		imul	eax, [bp+var_4]
		mov	[bp+var_4], eax
		push	280010h
		push	si
		call	sub_1D519
		mov	eax, [bp+var_4]
		mov	[bp+var_8], eax
		push	ss
		lea	ax, [bp+var_4]
		push	ax
		call	sub_1D5E9
		push	15h
		pushd	[bp+var_4]
		call	sub_1D48E
		mov	eax, [bp+var_4]
		add	_score_delta, eax
		cmp	[bp+var_8], 124F80h
		jb	short loc_1D814
		push	4
		jmp	short loc_1D82E
; ---------------------------------------------------------------------------

loc_1D814:
		cmp	[bp+var_8], 0C3500h
		jb	short loc_1D822
		push	2
		jmp	short loc_1D82E
; ---------------------------------------------------------------------------

loc_1D822:
		cmp	[bp+var_8], 7A120h
		jb	short loc_1D835
		push	1

loc_1D82E:
		call	_playperf_raise
		jmp	short loc_1D854
; ---------------------------------------------------------------------------

loc_1D835:
		cmp	[bp+var_8], 186A0h
		ja	short loc_1D843
		push	2
		jmp	short loc_1D84F
; ---------------------------------------------------------------------------

loc_1D843:
		cmp	[bp+var_8], 30D40h
		ja	short loc_1D854
		push	1

loc_1D84F:
		call	_playperf_lower

loc_1D854:
		les	bx, _resident
		inc	es:[bx+resident_t.rem_bombs]
		call	sub_EFA1
		les	bx, _resident
		mov	al, es:[bx+resident_t.miss_count]
		cmp	al, stage_id
		ja	short loc_1D876
		call	_playperf_raise pascal, 2

loc_1D876:
		les	bx, _resident
		mov	al, es:[bx+resident_t.bombs_used]
		mov	ah, 0
		mov	dl, stage_id
		mov	dh, 0
		add	dx, dx
		cmp	ax, dx
		jg	short loc_1D893
		call	_playperf_raise pascal, 2

loc_1D893:
		pop	si
		leave
		retn
sub_1D6C1	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1D896	proc near

var_4		= dword	ptr -4

		enter	4, 0
		push	si
		mov	PaletteTone, 60
		call	far ptr	palette_show
		mov	_extends_gained, 10
		call	gaiji_putsa pascal, (19 shl 16) + 4, ds, offset gpCONGRATULATION, TX_WHITE
		call	text_putsa pascal, (6 shl 16) + 6, ds, offset aALL_CLEAR, TX_WHITE
		call	text_putsa pascal, (6 shl 16) + 8, ds, offset aPOWERX50_2, TX_WHITE
		call	text_putsa pascal, (6 shl 16) + 10, ds, offset aBONUS_DREAM_2, TX_WHITE
		call	text_putsa pascal, (6 shl 16) + 12, ds, offset aGRAZEX50_2, TX_WHITE
		cmp	_rank, RANK_EXTRA
		jz	short loc_1D918
		push	(6 shl 16) + 14
		push	ds
		push	offset aPLAYER_REM_10000
		jmp	short loc_1D922
; ---------------------------------------------------------------------------

loc_1D918:
		push	(6 shl 16) + 14
		push	ds
		push	offset aPLAYER_REM_30000

loc_1D922:
		push	TX_WHITE
		call	text_putsa
		call	text_putsa pascal, (6 shl 16) + 17, ds, offset aBONUS_POINT_2, TX_WHITE
		call	text_putsa pascal, (6 shl 16) + 21, ds, offset aBONUS_TOTAL_2, TX_WHITE
		mov	si, 3E8h
		movzx	eax, si
		mov	[bp+var_4], eax
		push	6
		push	eax
		call	sub_1D48E
		mov	al, _power
		mov	ah, 0
		imul	ax, 5
		mov	si, ax
		movzx	eax, si
		add	[bp+var_4], eax
		push	8
		push	eax
		call	sub_1D48E
		mov	si, _dream_score
		movzx	eax, si
		add	[bp+var_4], eax
		push	0Ah
		push	eax
		call	sub_1D48E
		mov	ax, _stage_graze
		imul	ax, 5
		mov	si, ax
		movzx	eax, si
		add	[bp+var_4], eax
		push	0Ch
		push	eax
		call	sub_1D48E
		cmp	_rank, RANK_EXTRA
		jz	short loc_1D9BD
		les	bx, _resident
		mov	al, es:[bx+resident_t.rem_lives]
		mov	ah, 0
		imul	ax, 3E8h
		add	ax, 0FC18h
		jmp	short loc_1D9CE
; ---------------------------------------------------------------------------

loc_1D9BD:
		les	bx, _resident
		mov	al, es:[bx+resident_t.rem_lives]
		mov	ah, 0
		imul	ax, 0BB8h
		add	ax, 0F448h

loc_1D9CE:
		mov	si, ax
		movzx	eax, si
		add	[bp+var_4], eax
		push	0Eh
		push	eax
		call	sub_1D48E
		mov	al, _stage_point_items_collected
		mov	ah, 0
		mov	si, ax
		movzx	eax, si
		imul	eax, [bp+var_4]
		mov	[bp+var_4], eax
		push	280011h
		push	si
		call	sub_1D519
		push	ss
		lea	ax, [bp+var_4]
		push	ax
		call	sub_1D5E9
		push	15h
		pushd	[bp+var_4]
		call	sub_1D48E
		mov	eax, [bp+var_4]
		add	_score_delta, eax
		pop	si
		leave
		retn
sub_1D896	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1DA1B	proc far
		push	bp
		mov	bp, sp
		call	IRand
		and	al, 0Fh
		mov	byte_2D00E, al
		call	item_splashes_init
		mov	byte_236E0, 0
		mov	_dream_score, 0
		pop	bp
		retf
sub_1DA1B	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public ITEMS_ADD
items_add	proc near

@@type		= byte ptr  4
@@y		= word ptr  6
@@x		= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		push	di
		cmp	[bp+@@type], -1
		jnz	short loc_1DA6F
		inc	byte_2D00E
		mov	al, byte_2D00E
		mov	ah, 0
		mov	bx, 2
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1DAC8
		mov	al, byte_2D00E
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	bx, 40h
		cwd
		idiv	bx
		mov	bx, dx
		mov	al, ENEMY_DROPS[bx]
		mov	[bp+@@type], al

loc_1DA6F:
		mov	si, offset _items
		xor	di, di
		jmp	short loc_1DAC3
; ---------------------------------------------------------------------------

loc_1DA76:
		cmp	byte ptr [si], 0
		jnz	short loc_1DABF
		mov	byte ptr [si], 1
		mov	byte ptr [si+0Fh], 0
		mov	ax, [bp+@@x]
		mov	[si+2],	ax
		mov	ax, [bp+@@y]
		mov	[si+4],	ax
		mov	[si+item_t.pos.velocity.x], 0
		mov	[si+item_t.pos.velocity.y], (-3 shl 4)
		mov	al, [bp+@@type]
		mov	[si+item_t.ITEM_type], al
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	ax, ITEM_TYPE_PATNUM[bx]
		mov	[si+item_t.ITEM_patnum], ax
		call	item_splashes_add pascal, [bp+@@x], [bp+@@y]
		mov	word ptr [si+12h], 0
		inc	_items_spawned
		jmp	short loc_1DAC8
; ---------------------------------------------------------------------------

loc_1DABF:
		inc	di
		add	si, size item_t

loc_1DAC3:
		cmp	di, ITEM_COUNT
		jl	short loc_1DA76

loc_1DAC8:
		pop	di
		pop	si
		pop	bp
		retn	6
items_add	endp

include th04/item/miss_add.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1DBAE	proc near

var_1		= byte ptr -1
arg_0		= word ptr  4

		enter	2, 0
		push	si
		push	di
		mov	di, [bp+arg_0]
		mov	[bp+var_1], 0
		mov	al, [di+0Eh]
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 6
		ja	loc_1DD93
		add	bx, bx
		jmp	cs:off_1DDE9[bx]

loc_1DBD0:
		cmp	_power, 128
		jnb	short loc_1DC04
		cmp	_power, 127
		jnz	short loc_1DBF5
		mov	_popup_id_new, POPUP_ID_FULL_POWERUP
		mov	_popup_fp, offset popup_update_and_render
		cmp	_bullet_clear_time, 20
		jnb	short loc_1DBF5
		mov	_bullet_clear_time, 20

loc_1DBF5:
		inc	_power
		call	sub_11DE6
		mov	si, 1
		jmp	loc_1DD93
; ---------------------------------------------------------------------------

loc_1DC04:
		inc	_power_overflow_level
		cmp	_power_overflow_level, 42
		jb	short loc_1DC19
		mov	_power_overflow_level, 42
		mov	[bp+var_1], 1

loc_1DC19:
		mov	bx, _power_overflow_level
		add	bx, bx
		mov	si, POWER_OVERFLOW_BONUS[bx]
		cmp	byte_21CC8, 0
		jz	loc_1DD93
		inc	byte_23660
		jmp	loc_1DD93
; ---------------------------------------------------------------------------

loc_1DC33:
		cmp	word ptr [di+4], 340h
		jg	short loc_1DC58
		mov	si, 1400h
		mov	al, byte_23660
		add	al, 4
		mov	byte_23660, al
		inc	_total_max_valued_point_items_collected
		mov	[bp+var_1], 1
		cmp	byte_21CC8, 0
		jz	short loc_1DC7B
		add	al, 4
		jmp	short loc_1DC78
; ---------------------------------------------------------------------------

loc_1DC58:
		mov	ax, [di+4]
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	dx, 0CE4h
		sub	dx, ax
		mov	si, dx
		mov	al, byte_23660
		add	al, 2
		mov	byte_23660, al
		cmp	byte_21CC8, 0
		jz	short loc_1DC7B
		add	al, 2

loc_1DC78:
		mov	byte_23660, al

loc_1DC7B:
		inc	_total_point_items_collected
		add	si, _dream_score
		inc	_stage_point_items_collected
		call	hud_point_items_put
		jmp	loc_1DD93
; ---------------------------------------------------------------------------

loc_1DC8F:
		cmp	_dream_items_collected, 6
		ja	short loc_1DC9A
		inc	_dream_items_collected

loc_1DC9A:
		mov	al, _dream_items_collected
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	ax, _DREAM_SCORE_PER_ITEMS[bx]
		mov	_dream_score, ax
		mov	si, _dream_score
		call	hud_dream_put
		mov	al, byte_23660
		add	al, 2
		mov	byte_23660, al
		cmp	byte_21CC8, 0
		jz	loc_1DD93
		add	al, 2
		mov	byte_23660, al
		jmp	loc_1DD93
; ---------------------------------------------------------------------------

loc_1DCCC:
		cmp	_power, 128
		jnb	short loc_1DD09
		mov	al, _power
		add	al, 10
		mov	_power, al
		cmp	_power, 128
		jb	short loc_1DCFE
		mov	_power, 128
		mov	_popup_id_new, POPUP_ID_FULL_POWERUP
		mov	_popup_fp, offset popup_update_and_render
		cmp	_bullet_clear_time, 20
		jnb	short loc_1DCFE
		mov	_bullet_clear_time, 20

loc_1DCFE:
		call	sub_11DE6
		mov	si, 1
		jmp	loc_1DD93
; ---------------------------------------------------------------------------

loc_1DD09:
		add	_power_overflow_level, 5
		mov	bx, _power_overflow_level
		add	bx, bx
		mov	si, POWER_OVERFLOW_BONUS[bx]
		cmp	_power_overflow_level, 42
		jbe	short loc_1DD25
		mov	_power_overflow_level, 42

loc_1DD25:
		cmp	_power_overflow_level, 42
		jnz	short loc_1DD93
		mov	si, 0A00h
		mov	[bp+var_1], 1
		jmp	short loc_1DD93
; ---------------------------------------------------------------------------

loc_1DD35:
		les	bx, _resident
		inc	es:[bx+resident_t.rem_bombs]
		mov	si, 64h	; 'd'
		call	sub_EFA1
		jmp	short loc_1DD93
; ---------------------------------------------------------------------------

loc_1DD47:
		call	_playperf_raise pascal, 3
		les	bx, _resident
		inc	es:[bx+resident_t.rem_lives]
		call	sub_EEE8
		call	snd_se_play pascal, 7
		mov	_popup_id_new, POPUP_ID_EXTEND
		mov	_popup_fp, offset popup_update_and_render
		jmp	short loc_1DD90	; jumptable 0001CCD9 case 696
; ---------------------------------------------------------------------------

loc_1DD6F:
		cmp	_bullet_clear_time, 20
		jnb	short loc_1DD7B
		mov	_bullet_clear_time, 20

loc_1DD7B:
		mov	_popup_id_new, POPUP_ID_FULL_POWERUP
		mov	_popup_fp, offset popup_update_and_render
		mov	_power, 128
		call	sub_11DE6

loc_1DD90:
		mov	si, 64h	; 'd'   ; jumptable 0001CCD9 case 696

loc_1DD93:
		cmp	byte_21CC8, 0
		jnz	short loc_1DDA0
		movzx	eax, si
		jmp	short loc_1DDA8
; ---------------------------------------------------------------------------

loc_1DDA0:
		mov	ax, si
		add	ax, ax
		movzx	eax, ax

loc_1DDA8:
		add	_score_delta, eax
		cmp	[bp+var_1], 0
		jnz	short loc_1DDBF
		push	word ptr [di+2]
		push	word ptr [di+4]
		push	si
		call	sub_13DAA
		jmp	short loc_1DDC9
; ---------------------------------------------------------------------------

loc_1DDBF:
		push	word ptr [di+2]
		push	word ptr [di+4]
		push	si
		call	sub_13D90

loc_1DDC9:
		cmp	byte_23660, 20h	; ' '
		jb	short loc_1DDDF
		mov	al, byte_23660
		add	al, 0E0h
		mov	byte_23660, al
		call	_playperf_raise pascal, 1

loc_1DDDF:
		inc	_items_collected
		pop	di
		pop	si
		leave
		retn	2
sub_1DBAE	endp

; ---------------------------------------------------------------------------
off_1DDE9	dw offset loc_1DBD0
		dw offset loc_1DC33
		dw offset loc_1DC8F
		dw offset loc_1DCCC
		dw offset loc_1DD35
		dw offset loc_1DD47
		dw offset loc_1DD6F

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1DDF7	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_0]
		mov	al, [si+0Eh]
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 5
		ja	short loc_1DE36
		add	bx, bx
		jmp	cs:off_1DE51[bx]

loc_1DE11:
		inc	byte_23661
		jmp	short loc_1DE36
; ---------------------------------------------------------------------------

loc_1DE17:
		mov	al, byte_23661
		add	al, 2
		mov	byte_23661, al
		jmp	short loc_1DE36
; ---------------------------------------------------------------------------

loc_1DE21:
		mov	al, byte_23661
		add	al, 4
		mov	byte_23661, al
		jmp	short loc_1DE36
; ---------------------------------------------------------------------------

loc_1DE2B:
		push	2
		jmp	short loc_1DE31
; ---------------------------------------------------------------------------

loc_1DE2F:
		push	4

loc_1DE31:
		call	_playperf_lower

loc_1DE36:
		cmp	byte_23661, 40h
		jb	short loc_1DE4C
		mov	al, byte_23661
		add	al, 0D0h
		mov	byte_23661, al
		call	_playperf_lower pascal, 1

loc_1DE4C:
		pop	si
		pop	bp
		retn	2
sub_1DDF7	endp

; ---------------------------------------------------------------------------
off_1DE51	dw offset loc_1DE11
		dw offset loc_1DE17
		dw offset loc_1DE21
		dw offset loc_1DE11
		dw offset loc_1DE2B
		dw offset loc_1DE2F

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public ITEMS_UPDATE
items_update	proc far

@@angle		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		mov	si, offset _items
		cmp	byte_236E0, 0
		jz	short loc_1DE74
		mov	byte_21CC8, 1
		jmp	short loc_1DE79
; ---------------------------------------------------------------------------

loc_1DE74:
		mov	byte_21CC8, 0

loc_1DE79:
		xor	di, di
		jmp	loc_1DF4E
; ---------------------------------------------------------------------------

loc_1DE7E:
		cmp	byte ptr [si], 0
		jz	loc_1DF4A
		cmp	byte ptr [si], 2
		jnz	short loc_1DE90
		mov	byte ptr [si], 0
		jmp	loc_1DF4A
; ---------------------------------------------------------------------------

loc_1DE90:
		cmp	byte_236E0, 0
		jz	short loc_1DEC6
		mov	byte_21CC8, 1
		mov	[si+item_t.pulled_to_player], 1
		mov	ax, _player_pos.cur.y
		sub	ax, [si+item_t.pos.cur.y]
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, [si+item_t.pos.cur.x]
		push	ax
		call	iatan2
		mov	[bp+@@angle], al
		lea	ax, [si+item_t.pos.velocity]
		call	vector2_near pascal, ax, word ptr [bp+@@angle], (ITEM_PULL_SPEED shl 4)
		jmp	short loc_1DEDB
; ---------------------------------------------------------------------------

loc_1DEC6:
		cmp	[si+item_t.pulled_to_player], 0
		jz	short loc_1DEDB
		mov	[si+item_t.pos.velocity.x], 0
		mov	[si+item_t.pos.velocity.y], 0
		mov	[si+item_t.pulled_to_player], 0

loc_1DEDB:
		lea	ax, [si+item_t.pos]
		push	ax
		call	_motion_update_2
		cmp	ax, (-(ITEM_W / 2) shl 4)
		jle	short loc_1DEF2
		cmp	ax, ((PLAYFIELD_W + (ITEM_W / 2)) shl 4)
		jge	short loc_1DEF2
		cmp	dx, ((PLAYFIELD_H + (ITEM_H / 2)) shl 4)
		jl	short loc_1DEFB

loc_1DEF2:
		mov	byte ptr [si], 2
		push	si
		call	sub_1DDF7
		jmp	short loc_1DF4A
; ---------------------------------------------------------------------------

loc_1DEFB:
		cmp	dx, (-(ITEM_H / 2) shl 4)
		jge	short loc_1DF05
		mov	[si+item_t.pos.cur.y], (-(ITEM_H / 2) shl 4)

loc_1DF05:
		cmp	word ptr [si+0Ch], 0
		jl	short @@hittest
		mov	word ptr [si+0Ah], 0

@@hittest:
		cmp	_miss_time, 0
		jnz	short loc_1DF47
		mov	bx, _player_pos.cur.x
		add	bx, (24 shl 4)
		sub	bx, ax
		cmp	bx, (48 shl 4)
		ja	short loc_1DF47
		mov	bx, _player_pos.cur.y
		add	bx, (24 shl 4)
		sub	bx, dx
		cmp	bx, (38 shl 4)
		ja	short loc_1DF47
		push	si
		call	sub_1DBAE
		call	snd_se_play pascal, 11
		mov	byte ptr [si], 2
		jmp	short loc_1DF4A
; ---------------------------------------------------------------------------

loc_1DF47:
		inc	[si+item_t.pos.velocity.y]

loc_1DF4A:
		inc	di
		add	si, size item_t

loc_1DF4E:
		cmp	di, ITEM_COUNT
		jl	loc_1DE7E
		call	item_splashes_update
		mov	byte_21CC8, 0
		pop	di
		pop	si
		leave
		retf
items_update	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

boss_reset	proc near
		push	bp
		mov	bp, sp
		setfarfp	_boss_update, nullsub_2
		mov	_boss_fg_render, offset nullfunc_near
		mov	_boss_phase, 0
		mov	_boss_mode, 0
		mov	_boss_mode_change, 0
		mov	_boss_phase_frame, 0
		mov	_boss_pos.velocity.x, 0
		mov	_boss_pos.velocity.y, 0
		mov	_boss_damage_this_frame, 0
		nopcall	explosions_small_reset
		mov	_boss_phase_timed_out, 1
		pop	bp
		retn
boss_reset	endp

include th04/formats/bb_stage.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

stage1_setup	proc far
		push	bp
		mov	bp, sp
		setfarfp	_midboss_update_func, midboss1_update
		mov	_midboss_render_func, offset midboss1_render
		mov	_midboss_frames_until, 3100
		mov	_midboss_pos.cur.x, (192 shl 4)
		mov	_midboss_pos.cur.y, (368 shl 4)
		mov	_midboss_pos.prev.x, (192 shl 4)
		mov	_midboss_pos.prev.y, (368 shl 4)
		mov	_midboss_pos.velocity.x, 0
		mov	_midboss_pos.velocity.y, (1 shl 4)
		mov	_midboss_hp, 800
		call	boss_reset
		mov	_boss_pos.cur.x, (192 shl 4)
		mov	_boss_pos.prev.x, (192 shl 4)
		mov	_boss_pos.cur.y, (40 shl 4)
		mov	_boss_pos.prev.y, (40 shl 4)
		mov	_boss_bg_render_func, offset orange_bg_render
		setfarfp	_boss_update_func, orange_update
		mov	_boss_fg_render_func, offset orange_fg_render
		mov	_boss_sprite, 128
		mov	_boss_hitbox_radius.x, (24 shl 4)
		mov	_boss_hitbox_radius.y, (16 shl 4)
		mov	_boss_backdrop_colorfill, offset playfield_fillm_0_120_384_128
		call	super_entry_bfnt pascal, ds, offset aSt00_bmt ; "st00.bmt"
		call	cdg_load_single_noalpha pascal, 16, ds, offset aSt00bk_cdg, 0
		call	bb_stage_load pascal, ds, offset aSt00_bb
		mov	Palettes, 0FFh
		mov	Palettes+1, 0FFh
		mov	_stage_render, offset nullfunc_near
		mov	_stage_invalidate, offset nullfunc_near
		pop	bp
		retf
stage1_setup	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

stage2_setup	proc far
		push	bp
		mov	bp, sp
		setfarfp	_midboss_update_func, midboss2_update
		mov	_midboss_render_func, offset midboss2_render
		mov	_midboss_frames_until, 2600
		mov	_midboss_pos.cur.x, (192 shl 4)
		mov	_midboss_pos.cur.y, (-32 shl 4)
		mov	_midboss_pos.prev.x, (192 shl 4)
		mov	_midboss_pos.prev.y, (-32 shl 4)
		mov	_midboss_pos.velocity.x, 0
		mov	_midboss_pos.velocity.y, (1 shl 4)
		mov	_midboss_hp, 750
		mov	_midboss_sprite, 0
		call	boss_reset
		mov	_boss_pos.cur.x, (192 shl 4)
		mov	_boss_pos.prev.x, (192 shl 4)
		mov	_boss_pos.cur.y, (81 shl 4)
		mov	_boss_pos.prev.y, (81 shl 4)
		mov	_boss_bg_render_func, offset kurumi_bg_render
		setfarfp	_boss_update_func, kurumi_update
		mov	_boss_fg_render_func, offset kurumi_fg_render
		mov	_boss_sprite, 0
		mov	_boss_hitbox_radius.x, (24 shl 4)
		mov	_boss_hitbox_radius.y, (24 shl 4)
		mov	_boss_backdrop_colorfill, offset playfield_fillm_0_80_384_112
		call	super_entry_bfnt pascal, ds, offset aSt01_bmt ; "st01.bmt"
		call	cdg_load_single_noalpha pascal, 16, ds, offset aSt01bk_cdg, 0
		call	bb_stage_load pascal, ds, offset aSt01_bb
		push	(255 shl 16) or 128
		push	( 32 shl 16) or   8
		call	select_for_rank
		mov	byte_2D01E, al
		mov	_stage_render, offset nullfunc_near
		mov	_stage_invalidate, offset nullfunc_near
		pop	bp
		retf
stage2_setup	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

stage3_setup	proc far
		push	bp
		mov	bp, sp
		setfarfp	_midboss_update_func, midboss3_update
		mov	_midboss_render_func, offset midboss3_render
		mov	_midboss_frames_until, 1600
		mov	_midboss_pos.cur.x, (192 shl 4)
		mov	_midboss_pos.cur.y, (-32 shl 4)
		mov	_midboss_pos.prev.x, (192 shl 4)
		mov	_midboss_pos.prev.y, (-32 shl 4)
		mov	_midboss_pos.velocity.x, 0
		mov	_midboss_pos.velocity.y, (4 shl 4)
		mov	_midboss_hp, 850
		mov	_midboss_sprite, 0
		call	boss_reset
		mov	_boss_pos.cur.x, (192 shl 4)
		mov	_boss_pos.prev.x, (192 shl 4)
		mov	_boss_pos.cur.y, (64 shl 4)
		mov	_boss_pos.prev.y, (64 shl 4)
		mov	_boss_bg_render_func, offset elly_bg_render
		setfarfp	_boss_update_func, elly_update
		mov	_boss_fg_render_func, offset elly_fg_render
		mov	_boss_sprite, 134
		mov	_boss_hitbox_radius.x, (24 shl 4)
		mov	_boss_hitbox_radius.y, (24 shl 4)
		mov	_boss_backdrop_colorfill, offset playfield_fillm_0_0_384_112
		call	super_entry_bfnt pascal, ds, offset aSt02_bmt ; "st02.bmt"
		call	cdg_load_single_noalpha pascal, 16, ds, offset aSt02bk_cdg, 0
		call	bb_stage_load pascal, ds, offset aSt02_bb
		mov	_stage_render, offset nullfunc_near
		mov	_stage_invalidate, offset nullfunc_near
		pop	bp
		retf
stage3_setup	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

stage4_setup	proc far
		push	bp
		mov	bp, sp
		setfarfp	_midboss_update_func, midboss4_update
		mov	_midboss_render_func, offset midboss4_render
		mov	_midboss_frames_until, 2800
		mov	_midboss_pos.cur.x, (144 shl 4)
		mov	_midboss_pos.cur.y, (-32 shl 4)
		mov	_midboss_pos.prev.x, (144 shl 4)
		mov	_midboss_pos.prev.y, (-32 shl 4)
		mov	_midboss_pos.velocity.x, (4 shl 4)
		mov	_midboss_pos.velocity.y, (2 shl 4)
		mov	_midboss_hp, 1200
		mov	_midboss_sprite, 0
		call	boss_reset
		mov	_boss_pos.cur.x, (192 shl 4)
		mov	_boss_pos.prev.x, (192 shl 4)
		mov	_boss_pos.cur.y, (64 shl 4)
		mov	_boss_pos.prev.y, (64 shl 4)
		mov	_boss_bg_render_func, offset reimu_marisa_bg_render
		cmp	_playchar, PLAYCHAR_MARISA
		jnz	@@playing_as_reimu
		setfarfp	_boss_update_func, reimu_update
		mov	_boss_fg_render_func, offset reimu_fg_render
		push	( 4 shl 16) or  6
		push	( 8 shl 16) or 12
		call	select_for_rank
		mov	byte_2D01E, al
		push	(16 shl 16) or 12
		push	( 8 shl 16) or  6
		call	select_for_rank
		mov	byte_2D01F, al
		push	( 1 shl 16) or  2
		push	( 3 shl 16) or  4
		call	select_for_rank
		mov	byte_2D020, al
		push	(23 shl 16) or 23
		push	(24 shl 16) or 24
		call	select_for_rank
		mov	byte_2D021, al
		push	( 8 shl 16) or  9
		push	( 9 shl 16) or 10
		call	select_for_rank
		mov	byte_2D022, al
		push	(18 shl 16) or 16
		push	(14 shl 16) or 10
		call	select_for_rank
		mov	byte_2D023, al
		push	( 6 shl 16) or  8
		push	( 9 shl 16) or 10
		call	select_for_rank
		mov	byte_2D024, al
		jmp	short loc_1E371
; ---------------------------------------------------------------------------

@@playing_as_reimu:
		setfarfp	_boss_update_func, marisa_update
		mov	_boss_fg_render_func, offset marisa_fg_render
		mov	_boss_hp, 6000

loc_1E371:
		mov	_boss_sprite, 128
		mov	_boss_hitbox_radius.x, (24 shl 4)
		mov	_boss_hitbox_radius.y, (24 shl 4)
		mov	_boss_backdrop_colorfill, offset playfield_fillm_64_56_256_256
		call	super_entry_bfnt pascal, ds, offset aSt03_bmt ; "st03.bmt"
		cmp	_playchar, PLAYCHAR_REIMU
		jz	short loc_1E3A0
		push	10h
		push	ds
		push	offset aSt03bk_cdg ; "st03bk.cdg"
		jmp	short loc_1E3A6
; ---------------------------------------------------------------------------

loc_1E3A0:
		push	10h
		push	ds
		push	offset aSt03bk2_cdg ; "st03bk2.cdg"

loc_1E3A6:
		push	0
		call	cdg_load_single_noalpha
		call	bb_stage_load pascal, ds, offset aSt03_bb
		mov	_stage_render, offset nullfunc_near
		mov	_stage_invalidate, offset nullfunc_near
		pop	bp
		retf
stage4_setup	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

stage5_setup	proc far
		push	bp
		mov	bp, sp
		setfarfp	_midboss_update_func, nullsub_2
		mov	_midboss_render_func, offset nullfunc_near
		mov	_midboss_frames_until, 60000
		call	boss_reset
		mov	_boss_pos.cur.x, (192 shl 4)
		mov	_boss_pos.prev.x, (192 shl 4)
		mov	_boss_pos.cur.y, (64 shl 4)
		mov	_boss_pos.prev.y, (64 shl 4)
		mov	_boss_bg_render_func, offset yuuka5_bg_render
		setfarfp	_boss_update_func, yuuka5_update
		mov	_boss_fg_render_func, offset yuuka5_fg_render
		mov	_boss_sprite, 128
		mov	_boss_hitbox_radius.x, (26 shl 4)
		mov	_boss_hitbox_radius.y, (26 shl 4)
		mov	_boss_backdrop_colorfill, offset playfield_fillm_96_112_288_256
		call	cdg_load_single_noalpha pascal, 16, ds, offset aSt04bk_cdg, 0
		call	bb_stage_load pascal, ds, offset aSt04_bb
		call	cdg_load_single_noalpha pascal, 17, ds, offset aSt04_cdg, 0
		mov	word_2D034, 1400h
		mov	word_2D036, 280h
		mov	word_2D038, 0BE0h
		mov	_stage_render, offset stage5_render
		mov	_stage_invalidate, offset stage5_invalidate
		push	(144 shl 16) or 160
		push	(168 shl 16) or 180
		call	select_for_rank
		mov	byte_2D01E, al
		pop	bp
		retf
stage5_setup	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

stage6_setup	proc far
		push	bp
		mov	bp, sp
		setfarfp	_midboss_update_func, nullsub_2
		mov	_midboss_render_func, offset nullfunc_near
		mov	_midboss_frames_until, 60000
		call	boss_reset
		mov	_boss_pos.cur.x, (192 shl 4)
		mov	_boss_pos.prev.x, (192 shl 4)
		mov	_boss_pos.cur.y, (80 shl 4)
		mov	_boss_pos.prev.y, (80 shl 4)
		mov	_boss_bg_render_func, offset yuuka6_bg_render
		setfarfp	_boss_update_func, yuuka6_update
		mov	_boss_fg_render_func, offset yuuka6_fg_render
		mov	_boss_sprite, 128
		mov	_boss_hitbox_radius.x, (24 shl 4)
		mov	_boss_hitbox_radius.y, (48 shl 4)
		call	bb_stage_load pascal, ds, offset aSt05_bb
		mov	_stage_render, offset nullfunc_near
		mov	_stage_invalidate, offset nullfunc_near
		push	(48 shl 16) or 64
		push	(80 shl 16) or 96
		call	select_for_rank
		mov	byte_2D01E, al
		push	( 1 shl 16) or  1
		push	( 2 shl 16) or  4
		call	select_for_rank
		mov	byte_2D01F, al
		pop	bp
		retf
stage6_setup	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

stagex_setup	proc far
		push	bp
		mov	bp, sp
		setfarfp	_midboss_update_func, midbossx_update
		mov	_midboss_render_func, offset midbossx_render
		mov	_midboss_frames_until, 5400
		mov	_midboss_pos.cur.x, (-16 shl 4)
		mov	_midboss_pos.cur.y, (256 shl 4)
		mov	_midboss_pos.prev.x, (-16 shl 4)
		mov	_midboss_pos.prev.y, (256 shl 4)
		mov	_midboss_pos.velocity.x, (4 shl 4)
		mov	_midboss_pos.velocity.y, (-4 shl 4)
		mov	_midboss_hp, 4096
		mov	_midboss_sprite, 0
		mov	_midboss_angle, 96
		call	boss_reset
		mov	_boss_pos.cur.x, (192 shl 4)
		mov	_boss_pos.prev.x, (192 shl 4)
		mov	_boss_pos.cur.y, (80 shl 4)
		mov	_boss_pos.prev.y, (80 shl 4)
		mov	_boss_bg_render_func, offset mugetsu_gengetsu_bg_render
		setfarfp	_boss_update_func, mugetsu_update
		mov	_boss_fg_render_func, offset mugetsu_fg_render
		mov	_boss_sprite, 128
		mov	_boss_hitbox_radius.x, (24 shl 4)
		mov	_boss_hitbox_radius.y, (48 shl 4)
		mov	_boss_backdrop_colorfill, offset playfield_fillm_0_0_384_192
		mov	byte_2D01E, 0
		call	cdg_load_single_noalpha pascal, 16, ds, offset aSt06bk_cdg, 0
		call	bb_stage_load pascal, ds, offset aSt06_bb
		mov	_stage_render, offset nullfunc_near
		mov	_stage_invalidate, offset nullfunc_near
		pop	bp
		retf
stagex_setup	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1E5D8	proc near

arg_0		= word ptr  4
arg_2		= word ptr  6
arg_4		= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		mov	byte_22E9C, 1
		mov	ax, [bp+arg_4]
		mov	word_257E2, ax
		mov	ax, [bp+arg_2]
		mov	word_257E4, ax
		mov	ax, _boss_pos.cur.x
		mov	word ptr dword_257DE, ax
		mov	ax, _boss_pos.cur.y
		mov	word ptr dword_257DE+2,	ax
		call	sub_105B9
		mov	si, ax
		or	si, si
		jz	short loc_1E60C
		call	snd_se_play pascal, [bp+arg_0]

loc_1E60C:
		mov	byte_22E9C, 0
		mov	ax, si
		pop	si
		pop	bp
		retn	6
sub_1E5D8	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1E618	proc near

arg_0		= word ptr  4
arg_2		= word ptr  6
arg_4		= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		mov	ax, [bp+arg_4]
		mov	word_257E2, ax
		mov	ax, [bp+arg_2]
		mov	word_257E4, ax
		mov	ax, _midboss_pos.cur.x
		mov	word ptr dword_257DE, ax
		mov	ax, _midboss_pos.cur.y
		mov	word ptr dword_257DE+2,	ax
		call	sub_105B9
		mov	si, ax
		or	si, si
		jz	short loc_1E647
		call	snd_se_play pascal, [bp+arg_0]

loc_1E647:
		mov	ax, si
		pop	si
		pop	bp
		retn	6
sub_1E618	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1E64E	proc near
		push	bp
		mov	bp, sp
		inc	_boss_phase_frame
		call	sub_1E5D8 pascal, _boss_hitbox_radius.x, _boss_hitbox_radius.y, 4
		mov	_boss_damage_this_frame, al
		mov	ah, 0
		sub	_boss_hp, ax
		mov	ax, _boss_hp
		cmp	ax, _boss_phase_end_hp
		jg	short loc_1E678
		mov	al, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1E678:
		mov	al, 0
		pop	bp
		retn
sub_1E64E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1E67C	proc near
		push	bp
		mov	bp, sp
		inc	_boss_phase_frame
		call	sub_1E5D8 pascal, _boss_hitbox_radius.x, _boss_hitbox_radius.y, 10
		pop	bp
		retn
sub_1E67C	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1E692	proc near

var_4		= word ptr -4
var_2		= word ptr -2

		enter	4, 0
		push	si
		push	di
		cmp	_power, 123
		ja	short loc_1E6A3
		xor	di, di
		jmp	short loc_1E6B2
; ---------------------------------------------------------------------------

loc_1E6A3:
		cmp	_power, 128
		jnb	short loc_1E6AF
		mov	di, 1
		jmp	short loc_1E6B2
; ---------------------------------------------------------------------------

loc_1E6AF:
		mov	di, 2

loc_1E6B2:
		mov	ax, _boss_pos.cur.x
		add	ax, (-64 shl 4)
		mov	[bp+var_2], ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-64 shl 4)
		mov	[bp+var_4], ax
		xor	si, si
		jmp	short loc_1E6EA
; ---------------------------------------------------------------------------

loc_1E6C8:
		push	800h
		call	randring2_next16_mod
		add	ax, [bp+var_2]
		push	ax
		push	800h
		call	randring2_next16_mod
		add	ax, [bp+var_4]
		push	ax
		mov	bx, di
		imul	bx, 5
		mov	al, [bx+si+23DEh]
		push	ax
		call	items_add
		inc	si

loc_1E6EA:
		cmp	si, 5
		jl	short loc_1E6C8
		pop	di
		pop	si
		leave
		retn
sub_1E692	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1E6F3	proc near

arg_0		= word ptr  4
arg_2		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_2]
		cmp	si, 0FFFFh
		jz	short loc_1E719
		call	boss_explode_small pascal, si
		cmp	_boss_phase_timed_out, 0
		jnz	short loc_1E719
		cmp	_bullet_clear_time, 20
		jnb	short loc_1E716
		mov	_bullet_clear_time, 20

loc_1E716:
		call	sub_1E692

loc_1E719:
		mov	_boss_phase_timed_out, 1
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0
		mov	_boss_mode_change, 0
		mov	ax, _boss_phase_end_hp
		mov	_boss_hp, ax
		mov	ax, [bp+arg_0]
		mov	_boss_phase_end_hp, ax
		pop	si
		pop	bp
		retn	4
sub_1E6F3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1E743	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase, PHASE_EXPLODE_BIG
		jnz	short loc_1E7B5
		cmp	_boss_phase_frame, 12
		jge	short loc_1E778
		cmp	_stage_frame_mod2, 0
		jnz	short loc_1E760
		mov	ax, 0FFFCh
		jmp	short loc_1E763
; ---------------------------------------------------------------------------

loc_1E760:
		mov	ax, 4

loc_1E763:
		mov	word_255BE, ax
		cmp	_stage_frame_mod4, 1
		ja	short loc_1E772
		mov	ax, 0FFFCh
		jmp	short loc_1E775
; ---------------------------------------------------------------------------

loc_1E772:
		mov	ax, 4

loc_1E775:
		mov	word_255C0, ax

loc_1E778:
		mov	fp_255AC, offset tiles_render_all
		mov	word_266D0, 2
		inc	_boss_phase_frame
		mov	ax, _boss_phase_frame
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_1E915
		inc	_boss_sprite
		cmp	_boss_sprite, 12
		jb	loc_1E915
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		mov	byte_2D00A, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1E7B5:
		mov	PaletteTone, 60
		mov	_palette_changed, 1
		cmp	_boss_phase_frame, 0
		jnz	loc_1E8B3
		les	bx, _resident
		mov	ax, _stage_graze
		add	es:[bx+resident_t.graze], ax
		cmp	stage_id, 5
		jz	loc_1E8AE
		cmp	stage_id, 4
		jnz	short loc_1E801
		cmp	_continues_used, 0
		jnz	short loc_1E7F2
		cmp	_rank, RANK_EASY
		jnz	short loc_1E801

loc_1E7F2:
		call	sub_CF01
		call	sub_D6EB
		call	end_game_bad

loc_1E801:
		cmp	stage_id, 6
		jnz	loc_1E8A4
		call	super_clean pascal, (128 shl 16) or 256
		call	sub_D6EB
		cmp	byte_2D01E, 0
		jnz	short loc_1E89B
		mov	byte_2D01E, 1
		call	boss_reset
		mov	_boss_pos.cur.x, (192 shl 4)
		mov	_boss_pos.prev.x, (192 shl 4)
		mov	_boss_pos.cur.y, (96 shl 4)
		mov	_boss_pos.prev.y, (96 shl 4)
		mov	_boss_bg_render, offset mugetsu_gengetsu_bg_render
		setfarfp	_boss_update, gengetsu_update
		mov	_boss_fg_render, offset gengetsu_fg_render
		mov	_boss_sprite, 128
		mov	_boss_hitbox_radius.x, (24 shl 4)
		mov	_boss_hitbox_radius.y, (48 shl 4)
		mov	_bgm_title_id, 0Fh
		mov	_overlay_text_fp, offset sub_11195
		call	cdg_free pascal, 16
		call	bb_stage_free
		call	cdg_load_single_noalpha pascal, 16, ds, offset aSt06bk2_cdg, 0
		call	bb_stage_load pascal, ds, offset aSt06b_bb
		mov	byte_2D00A, 0
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1E89B:
		call	sub_1D896
		inc	_boss_phase_frame
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1E8A4:
		call	sub_D6EB
		call	sub_1D6C1
		jmp	short loc_1E905
; ---------------------------------------------------------------------------

loc_1E8AE:
		call	sub_1D896
		jmp	short loc_1E905
; ---------------------------------------------------------------------------

loc_1E8B3:
		cmp	_boss_phase_frame, 416
		jnz	short loc_1E8E5
		cmp	stage_id, 5
		jnz	short loc_1E8C9
		call	end_game_good
		jmp	short loc_1E8D5
; ---------------------------------------------------------------------------

loc_1E8C9:
		cmp	stage_id, 6
		jnz	short loc_1E8D5
		call	end_extra

loc_1E8D5:
		mov	_overlay_text_fp, offset sub_10E39
		kajacall	KAJA_SONG_FADE, 10
		jmp	short loc_1E905
; ---------------------------------------------------------------------------

loc_1E8E5:
		cmp	_boss_phase_frame, 488
		jnz	short loc_1E905
		les	bx, _resident
		inc	es:[bx+resident_t.stage]
		inc	es:[bx+resident_t.stage_ascii]
		mov	byte_266D2, 2
		push	1
		call	frame_delay

loc_1E905:
		inc	_boss_phase_frame
		mov	_homing_target.x, HOMING_TARGET_NONE
		mov	_homing_target.y, HOMING_TARGET_NONE

loc_1E915:
		pop	bp
		retn
sub_1E743	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1E917	proc near
		push	bp
		mov	bp, sp
		push	si
		cmp	_boss_phase_frame, 1
		jnz	short loc_1E96E
		mov	byte_2D03C, 1
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	bx, 3
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1E944
		mov	_boss_pos.velocity.x, (-4 shl 4)
		mov	_boss_pos.velocity.y, (1 shl 4)
		jmp	short loc_1E96E
; ---------------------------------------------------------------------------

loc_1E944:
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	bx, 3
		cwd
		idiv	bx
		cmp	dx, 1
		jnz	short loc_1E962
		mov	_boss_pos.velocity.x, (4 shl 4)
		mov	_boss_pos.velocity.y, 0
		jmp	short loc_1E96E
; ---------------------------------------------------------------------------

loc_1E962:
		mov	_boss_pos.velocity.x, (-4 shl 4)
		mov	_boss_pos.velocity.y, (-1 shl 4)

loc_1E96E:
		push	offset _boss_pos
		call	_motion_update_2
		mov	si, 20h	; ' '
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	bx, 3
		cwd
		idiv	bx
		cmp	dx, 1
		jnz	short loc_1E98A
		mov	si, 40h

loc_1E98A:
		cmp	_boss_phase_frame, si
		jnz	short loc_1E9AE
		inc	_boss_mode_change
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	bx, 2
		cwd
		idiv	bx
		mov	_boss_mode, dl
		mov	_boss_phase_frame, 0
		mov	byte_2D03C, 0

loc_1E9AE:
		pop	si
		pop	bp
		retn
sub_1E917	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1E9B1	proc near
		push	bp
		mov	bp, sp
		push	si
		cmp	_boss_phase_frame, 1
		jnz	short loc_1EA08
		mov	byte_2D03C, 1
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	bx, 3
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1E9DE
		mov	_boss_pos.velocity.x, (4 shl 4)
		mov	_boss_pos.velocity.y, (-1 shl 4)
		jmp	short loc_1EA08
; ---------------------------------------------------------------------------

loc_1E9DE:
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	bx, 3
		cwd
		idiv	bx
		cmp	dx, 1
		jnz	short loc_1E9FC
		mov	_boss_pos.velocity.x, (-4 shl 4)
		mov	_boss_pos.velocity.y, 0
		jmp	short loc_1EA08
; ---------------------------------------------------------------------------

loc_1E9FC:
		mov	_boss_pos.velocity.x, (4 shl 4)
		mov	_boss_pos.velocity.y, (1 shl 4)

loc_1EA08:
		push	offset _boss_pos
		call	_motion_update_2
		mov	si, 20h	; ' '
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	bx, 3
		cwd
		idiv	bx
		cmp	dx, 1
		jnz	short loc_1EA24
		mov	si, 40h

loc_1EA24:
		cmp	_boss_phase_frame, si
		jnz	short loc_1EA48
		inc	_boss_mode_change
		mov	al, _boss_mode_change
		mov	ah, 0
		mov	bx, 2
		cwd
		idiv	bx
		mov	_boss_mode, dl
		mov	_boss_phase_frame, 0
		mov	byte_2D03C, 0

loc_1EA48:
		pop	si
		pop	bp
		retn
sub_1E9B1	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1EA4B	proc near

var_2		= word ptr -2

		enter	2, 0
		mov	ax, _boss_phase_frame
		mov	[bp+var_2], ax
		mov	cx, 0Ah
		mov	bx, offset word_1EB09

loc_1EA5B:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_1EA6B
		add	bx, 2
		loop	loc_1EA5B
		jmp	loc_1EAF9	; default
; ---------------------------------------------------------------------------

loc_1EA6B:
		jmp	word ptr cs:[bx+14h] ; switch jump
; ---------------------------------------------------------------------------

loc_1EA6F:
		mov	ax, _boss_pos.cur.x
		add	ax, (4 shl 4)
		mov	point_2A8C6.x, ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-28 shl 4)
		mov	point_2A8C6.y, ax
		mov	word_2A8D0, 10h
		mov	word_2A8CE, 1000h
		mov	byte_2A8D2, 9
		call	sub_13B21
		mov	_boss_sprite, 129
		call	snd_se_play pascal, 8
		mov	_circles_color, 0Fh
		jmp	short loc_1EAF9	; default
; ---------------------------------------------------------------------------

loc_1EAA8:
		mov	byte_2A8D2, 8

loc_1EAAD:
		call	sub_13B21
		jmp	short loc_1EAF9	; default
; ---------------------------------------------------------------------------

loc_1EAB2:
		mov	_boss_sprite, 130
		jmp	short loc_1EAF9	; default
; ---------------------------------------------------------------------------

loc_1EAB9:
		mov	_boss_sprite, 131
		jmp	short loc_1EAF9	; default
; ---------------------------------------------------------------------------

loc_1EAC0:
		mov	_boss_sprite, 132
		push	point_2A8C6.x
		push	point_2A8C6.y
		call	circles_add_shrinking
		jmp	short loc_1EAF9	; default
; ---------------------------------------------------------------------------

loc_1EAD4:
		mov	_boss_sprite, 133
		jmp	short loc_1EAF9	; default
; ---------------------------------------------------------------------------

loc_1EADB:
		mov	_boss_sprite, 134
		jmp	short loc_1EAF9	; default
; ---------------------------------------------------------------------------

loc_1EAE2:
		mov	_boss_sprite, 135
		jmp	short loc_1EAF9	; default
; ---------------------------------------------------------------------------

loc_1EAE9:
		mov	_boss_sprite, 129
		call	snd_se_play pascal, 3
		mov	al, 2
		leave
		retn
; ---------------------------------------------------------------------------

loc_1EAF9:
		cmp	_boss_phase_frame, 46 ; default
		jge	short loc_1EB04
		mov	al, 0
		leave
		retn
; ---------------------------------------------------------------------------

loc_1EB04:
		mov	al, 1
		leave
		retn
sub_1EA4B	endp

; ---------------------------------------------------------------------------
		db 0
word_1EB09	dw 0Eh
		dw 10h
		dw 12h
		dw 16h
		dw 1Ah
		dw 1Eh
		dw 22h
		dw 26h
		dw 2Ah
		dw 2Eh
		dw offset loc_1EA6F
		dw offset loc_1EAA8
		dw offset loc_1EAAD
		dw offset loc_1EAB2
		dw offset loc_1EAB9
		dw offset loc_1EAC0
		dw offset loc_1EAD4
		dw offset loc_1EADB
		dw offset loc_1EAE2
		dw offset loc_1EAE9

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1EB31	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	si, 0B204h
		xor	di, di
		jmp	short loc_1EB83
; ---------------------------------------------------------------------------

loc_1EB3D:
		cmp	byte ptr [si], 0
		jnz	short loc_1EB7F
		mov	byte ptr [si], 2
		mov	eax, dword ptr word_2D03F+1
		mov	[si+2],	eax
		mov	eax, dword_2D044
		mov	[si+6],	eax
		mov	ax, word_2D050
		mov	[si+12h], ax
		mov	al, byte_2D056
		mov	[si+18h], al
		mov	al, byte ptr word_2D03F
		mov	[si+1],	al
		mov	word ptr [si+10h], 0
		lea	ax, [si+0Ah]
		push	ax
		push	word_2D03F
		mov	al, byte_2D056
		mov	ah, 0
		push	ax
		call	vector2_near
		jmp	short loc_1EB88
; ---------------------------------------------------------------------------

loc_1EB7F:
		inc	di
		add	si, 1Ah

loc_1EB83:
		cmp	di, 20h	; ' '
		jl	short loc_1EB3D

loc_1EB88:
		pop	di
		pop	si
		pop	bp
		retn
sub_1EB31	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1EB8C	proc near

arg_0		= word ptr  4
arg_2		= byte ptr  6

		push	bp
		mov	bp, sp
		push	si
		push	di
		xor	cx, cx
		mov	si, 0B204h
		xor	di, di
		jmp	short loc_1EBE8
; ---------------------------------------------------------------------------

loc_1EB9A:
		cmp	byte ptr [si], 0
		jnz	short loc_1EBE4
		mov	byte ptr [si], 1
		mov	ax, word_2D04C
		mov	[si+0Eh], ax
		mov	eax, dword ptr word_2D03F+1
		mov	[si+2],	eax
		mov	eax, dword_2D044
		mov	[si+6],	eax
		mov	ax, word_2D050
		mov	[si+12h], ax
		mov	al, byte_2D056
		mov	[si+18h], al
		mov	ax, cx
		shl	ax, 8
		cwd
		idiv	[bp+arg_0]
		add	al, [bp+arg_2]
		mov	[si+1],	al
		mov	word ptr [si+10h], 0
		mov	al, byte_2D057
		mov	[si+19h], al
		inc	cx
		cmp	cx, [bp+arg_0]
		jge	short loc_1EBED

loc_1EBE4:
		inc	di
		add	si, 1Ah

loc_1EBE8:
		cmp	di, 20h	; ' '
		jl	short loc_1EB9A

loc_1EBED:
		pop	di
		pop	si
		pop	bp
		retn	4
sub_1EB8C	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1EBF3	proc near

var_4		= word ptr -4
var_2		= word ptr -2

		enter	4, 0
		push	si
		push	di
		mov	si, 0B204h
		xor	di, di
		jmp	loc_1ED0A
; ---------------------------------------------------------------------------

loc_1EC01:
		cmp	byte ptr [si], 0
		jz	loc_1ED06
		cmp	byte ptr [si], 1
		jnz	short loc_1EC86
		push	word ptr [si+6]
		push	word ptr [si+10h]
		mov	al, [si+1]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_CosTable8[bx]
		call	vector1_at
		mov	[si+2],	ax
		push	word ptr [si+8]
		push	word ptr [si+10h]
		mov	al, [si+1]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_SinTable8[bx]
		call	vector1_at
		mov	[si+4],	ax
		cmp	word ptr [si+10h], 400h
		jge	short loc_1EC4E
		add	word ptr [si+10h], 40h

loc_1EC4E:
		dec	word ptr [si+0Eh]
		mov	al, [si+19h]
		add	[si+1],	al
		cmp	word ptr [si+0Eh], 0
		jnz	short loc_1ECBC
		cmp	byte ptr [si+19h], 0
		jl	short loc_1EC6A
		mov	al, [si+1]
		add	al, 40h
		jmp	short loc_1EC6F
; ---------------------------------------------------------------------------

loc_1EC6A:
		mov	al, [si+1]
		add	al, 0C0h

loc_1EC6F:
		mov	[si+1],	al
		lea	ax, [si+0Ah]
		push	ax
		push	word ptr [si+1]
		mov	al, [si+18h]
		mov	ah, 0
		push	ax
		call	vector2_near
		inc	byte ptr [si]
		jmp	short loc_1ECBC
; ---------------------------------------------------------------------------

loc_1EC86:
		cmp	byte ptr [si], 2
		jnz	short loc_1ECBC
		inc	word ptr [si+0Eh]
		mov	ax, [si+0Ah]
		add	[si+2],	ax
		cmp	word ptr [si+2], 0
		jl	short loc_1ECA1
		cmp	word ptr [si+2], 1800h
		jle	short loc_1ECA9

loc_1ECA1:
		mov	ax, [si+0Ah]
		neg	ax
		mov	[si+0Ah], ax

loc_1ECA9:
		mov	ax, [si+0Ch]
		add	[si+4],	ax
		cmp	word ptr [si+4], 1700h
		jl	short loc_1ECB9
		mov	byte ptr [si], 0

loc_1ECB9:
		inc	word ptr [si+0Ch]

loc_1ECBC:
		mov	word_257E2, 0C0h
		mov	word_257E4, 0C0h
		mov	ax, [si+2]
		mov	word ptr dword_257DE, ax
		mov	ax, [si+4]
		mov	word ptr dword_257DE+2,	ax
		call	sub_105B9
		mov	ax, [si+2]
		add	ax, 0FF40h
		mov	[bp+var_2], ax
		mov	ax, [si+4]
		add	ax, 0FF40h
		mov	[bp+var_4], ax
		mov	ax, _player_pos.cur.x
		sub	ax, [bp+var_2]
		cmp	ax, 180h
		jnb	short loc_1ED06
		mov	ax, _player_pos.cur.y
		sub	ax, [bp+var_4]
		cmp	ax, 180h
		jnb	short loc_1ED06
		mov	byte_259A9, 1

loc_1ED06:
		inc	di
		add	si, 1Ah

loc_1ED0A:
		cmp	di, 20h	; ' '
		jl	loc_1EC01
		pop	di
		pop	si
		leave
		retn
sub_1EBF3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1ED15	proc near

var_1		= byte ptr -1

		enter	2, 0
		call	sub_1EA4B
		mov	[bp+var_1], al
		cmp	[bp+var_1], 2
		jnz	short loc_1ED71
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_D_YELLOW
		mov	_bullet_template.speed, (6 shl 4)
		mov	ax, _player_pos.cur.y
		sub	ax, _boss_pos.cur.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, _boss_pos.cur.x
		push	ax
		call	iatan2
		mov	_boss_angle, al
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 6
		mov	al, byte_2D023
		mov	_bullet_template.BT_delta.spread_angle, al
		call	fp_2D004
		cmp	_player_pos.cur.x, 192 * 16
		jge	short loc_1ED6C
		mov	al, 0FEh
		jmp	short loc_1ED6E
; ---------------------------------------------------------------------------

loc_1ED6C:
		mov	al, 2

loc_1ED6E:
		mov	byte_2D03A, al

loc_1ED71:
		cmp	[bp+var_1], 1
		jnz	short locret_1EDBA
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1EDA3
		mov	al, _boss_angle
		mov	_bullet_template.BT_angle, al
		call	fp_2D000
		call	snd_se_play pascal, 3
		cmp	_boss_phase_frame, 64
		jl	short loc_1EDA3
		mov	al, byte_2D03A
		add	_boss_angle, al

loc_1EDA3:
		cmp	_boss_phase_frame, 112
		jl	short locret_1EDBA
		mov	_boss_sprite, 128
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

locret_1EDBA:
		leave
		retn
sub_1ED15	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1EDBC	proc near

var_1		= byte ptr -1

		enter	2, 0
		call	sub_1EA4B
		mov	[bp+var_1], al
		cmp	[bp+var_1], 2
		jnz	short loc_1EE01
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.speed, (5 shl 4) + 5
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.BT_special_motion, 80h
		mov	al, byte_2D020
		mov	byte_2CFF7, al
		mov	_bullet_template.pattern, BP_SPREAD_AIMED
		mov	_bullet_template.count, 9
		mov	_bullet_template.BT_delta.spread_angle, 6
		call	fp_2D004
		call	sub_1CFB5

loc_1EE01:
		cmp	[bp+var_1], 1
		jnz	short locret_1EE1F
		cmp	_boss_phase_frame, 128
		jl	short locret_1EE1F
		mov	_boss_sprite, 128
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

locret_1EE1F:
		leave
		retn
sub_1EDBC	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1EE21	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 32
		jnz	short loc_1EE57
		mov	_boss_sprite, 136
		mov	word_2D04C, 40h
		mov	byte_2D056, 38h	; '8'
		mov	eax, _boss_pos.cur
		mov	dword_2D044, eax
		call	randring2_next16
		push	ax
		mov	al, byte_2D01E
		mov	ah, 0
		push	ax
		call	sub_1EB8C
		call	snd_se_play pascal, 8

loc_1EE57:
		cmp	_boss_phase_frame, 96
		jl	short loc_1EE71
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh
		mov	al, byte_2D057
		neg	al
		mov	byte_2D057, al

loc_1EE71:
		pop	bp
		retn
sub_1EE21	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1EE73	proc near

var_1		= byte ptr -1

		enter	2, 0
		push	si
		call	sub_1EA4B
		mov	[bp+var_1], al
		cmp	[bp+var_1], 1
		jnz	loc_1EF84
		mov	ax, _boss_phase_frame
		mov	bx, 32
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1EEF5
		call	randring2_next16_mod pascal, (64 shl 4)
		mov	dx, _boss_pos.cur.x
		add	dx, (-32 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.x, ax
		call	randring2_next16_mod pascal, (64 shl 4)
		mov	dx, _boss_pos.cur.y
		add	dx, (-32 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.y, ax
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_BACKWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.speed, (1 shl 4)
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.BT_special_motion, 82h
		mov	byte_2CFF7, 1
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 16
		call	fp_2D004
		call	sub_1CFB5
		call	snd_se_play pascal, 3

loc_1EEF5:
		mov	ax, _boss_phase_frame
		mov	bx, 32
		cwd
		idiv	bx
		cmp	dx, 10h
		jnz	short loc_1EF6C
		call	randring2_next16_mod pascal, (64 shl 4)
		mov	dx, _boss_pos.cur.x
		add	dx, (-32 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.x, ax
		call	randring2_next16_mod pascal, (64 shl 4)
		mov	dx, _boss_pos.cur.y
		add	dx, (-32 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.y, ax
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.speed, (1 shl 4) + 8
		mov	_bullet_template.pattern, BP_STACK
		mov	_bullet_template.count, 4
		mov	_bullet_template.BT_delta.stack_speed, 8
		call	fp_2D004
		xor	si, si
		call	randring2_next16
		jmp	short loc_1EF5D
; ---------------------------------------------------------------------------

loc_1EF53:
		call	fp_2D000
		inc	si
		mov	al, _bullet_template.BT_angle
		add	al, 15h

loc_1EF5D:
		mov	_bullet_template.BT_angle, al
		cmp	si, 0Ch
		jl	short loc_1EF53
		call	snd_se_play pascal, 3

loc_1EF6C:
		cmp	_boss_phase_frame, 288
		jl	short loc_1EF84
		mov	_boss_sprite, 128
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_1EF84:
		pop	si
		leave
		retn
sub_1EE73	endp

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1EF87	proc near

var_1		= byte ptr -1

		enter	2, 0
		call	sub_1EA4B
		mov	[bp+var_1], al
		cmp	[bp+var_1], 1
		jnz	locret_1F04C
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_1F034
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.speed, (8 shl 4)
		call	randring2_next16_and pascal, 7
		add	al, -44h
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.pattern, BP_SPREAD
		mov	al, byte_2D021
		mov	_bullet_template.count, al
		mov	al, byte_2D022
		mov	_bullet_template.BT_delta.spread_angle, al
		call	sub_1CFA2
		mov	ax, _boss_phase_frame
		mov	bx, 16
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1F034
		call	randring2_next16_mod pascal, (64 shl 4)
		mov	dx, _boss_pos.cur.x
		add	dx, (-32 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.x, ax
		call	randring2_next16_mod pascal, (64 shl 4)
		mov	dx, _boss_pos.cur.y
		add	dx, (-32 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.pattern, BP_STACK_AIMED
		mov	al, _rank
		add	al, 3
		mov	_bullet_template.count, al
		mov	_bullet_template.BT_delta.stack_speed, (1 shl 4)
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.speed, (2 shl 4)
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_RED
		call	fp_2D000
		call	snd_se_play pascal, 3

loc_1F034:
		cmp	_boss_phase_frame, 192
		jl	short locret_1F04C
		mov	_boss_sprite, 128
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

locret_1F04C:
		leave
		retn
sub_1EF87	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1F04E	proc near

var_1		= byte ptr -1

		enter	2, 0
		call	sub_1EA4B
		mov	[bp+var_1], al
		cmp	[bp+var_1], 2
		jnz	short loc_1F08E
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.speed, (3 shl 4) + 6
		mov	ax, _player_pos.cur.y
		sub	ax, _boss_pos.cur.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, _boss_pos.cur.x
		push	ax
		call	iatan2
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.pattern, BP_RANDOM_ANGLE_AND_SPEED
		mov	_bullet_template.count, 3
		call	fp_2D004

loc_1F08E:
		cmp	[bp+var_1], 1
		jnz	short locret_1F10F
		cmp	_boss_phase_frame, 96
		jge	short loc_1F0B0
		mov	ax, _boss_phase_frame
		mov	bx, 2
		cwd
		idiv	bx
		or	dx, dx
		jnz	short locret_1F10F
		call	fp_2D000
		push	3
		jmp	short loc_1F0F8
; ---------------------------------------------------------------------------

loc_1F0B0:
		cmp	_boss_phase_frame, 128
		jg	short loc_1F0FF
		mov	ax, _boss_phase_frame
		mov	bx, 16
		cwd
		idiv	bx
		or	dx, dx
		jnz	short locret_1F10F
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_BACKWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 32
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.speed, (3 shl 4)
		mov	_bullet_template.BT_special_motion, 82h
		mov	byte_2CFF7, 1
		call	fp_2D004
		call	fp_2D002
		push	15

loc_1F0F8:
		call	snd_se_play
		leave
		retn
; ---------------------------------------------------------------------------

loc_1F0FF:
		mov	_boss_sprite, 128
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

locret_1F10F:
		leave
		retn
sub_1F04E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1F111	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 32
		jnz	short loc_1F13D
		mov	_boss_sprite, 136
		mov	byte ptr word_2D03F, 0
		mov	byte_2D056, 38h	; '8'
		mov	ax, _boss_pos.cur.x
		mov	word_2D03F+1, ax
		mov	ax, _boss_pos.cur.y
		mov	word_2D042, ax
		call	snd_se_play pascal, 8

loc_1F13D:
		cmp	_boss_phase_frame, 32
		jl	short loc_1F15F
		mov	al, byte_2D01F
		mov	ah, 0
		push	ax
		mov	ax, _boss_phase_frame
		cwd
		pop	bx
		idiv	bx
		or	dx, dx
		jnz	short loc_1F15F
		mov	al, byte_2D057
		sub	byte ptr word_2D03F, al
		call	sub_1EB31

loc_1F15F:
		cmp	_boss_phase_frame, 180
		jl	short loc_1F17A
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh
		mov	al, byte_2D057
		neg	al
		mov	byte_2D057, al

loc_1F17A:
		pop	bp
		retn
sub_1F111	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1F17C	proc near
		push	bp
		mov	bp, sp
		push	si
		cmp	_boss_phase_frame, 32
		jnz	short loc_1F1AA
		mov	_boss_sprite, 136
		mov	_boss_angle, 0
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.BT_angle, -40h
		mov	_bullet_template.BT_special_motion, 0FFh
		mov	_bullet_template.BT_delta.stack_speed, 8

loc_1F1AA:
		cmp	_boss_phase_frame, 32
		jl	short loc_1F227
		mov	ax, _boss_phase_frame
		mov	bx, 16
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1F227
		call	randring2_next16_mod pascal, (64 shl 4)
		mov	dx, _boss_pos.cur.x
		add	dx, (-32 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.x, ax
		call	randring2_next16_mod pascal, (64 shl 4)
		mov	dx, _boss_pos.cur.y
		add	dx, (-32 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.y, ax
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	_bullet_template.speed, (1 shl 4) + 8
		mov	_bullet_template.pattern, BP_STACK
		mov	_bullet_template.count, 4
		mov	_bullet_template.BT_delta.stack_speed, 10
		call	fp_2D004
		xor	si, si
		call	randring2_next16
		jmp	short loc_1F218
; ---------------------------------------------------------------------------

loc_1F20E:
		call	fp_2D000
		inc	si
		mov	al, _bullet_template.BT_angle
		add	al, 20h

loc_1F218:
		mov	_bullet_template.BT_angle, al
		cmp	si, 8
		jl	short loc_1F20E
		call	snd_se_play pascal, 3

loc_1F227:
		pop	si
		pop	bp
		retn
sub_1F17C	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1F22A	proc near

var_1		= byte ptr -1

		enter	2, 0
		call	sub_1EA4B
		mov	[bp+var_1], al
		cmp	[bp+var_1], 2
		jnz	short loc_1F263
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.BT_angle, -40h
		mov	_bullet_template.BT_special_motion, 0FFh
		mov	_bullet_template.BT_delta.spread_angle, 8
		cmp	byte_237F6, 78h	; 'x'
		jz	short loc_1F25E
		mov	al, 78h	; 'x'
		jmp	short loc_1F260
; ---------------------------------------------------------------------------

loc_1F25E:
		mov	al, 88h

loc_1F260:
		mov	byte_237F6, al

loc_1F263:
		cmp	[bp+var_1], 1
		jnz	locret_1F2F1
		mov	ax, _boss_phase_frame
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1F2D9
		call	randring2_next16_and pascal, 1Fh
		add	al, (1 shl 4)
		mov	_bullet_template.speed, al
		mov	_bullet_template.pattern, BP_SPREAD
		call	randring2_next16_and pascal, 3
		add	al, 2
		mov	_bullet_template.count, al
		call	fp_2D004
		call	randring2_next16_mod pascal, (64 shl 4)
		mov	dx, _boss_pos.cur.x
		add	dx, (-32 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.x, ax
		call	randring2_next16_mod pascal, (64 shl 4)
		mov	dx, _boss_pos.cur.y
		add	dx, (-32 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.y, ax
		mov	al, byte_237F6
		add	_bullet_template.BT_angle, al
		call	fp_2D002
		mov	al, _bullet_template.BT_angle
		add	al, 80h
		mov	_bullet_template.BT_angle, al
		call	fp_2D002
		call	snd_se_play pascal, 3

loc_1F2D9:
		cmp	_boss_phase_frame, 224
		jl	short locret_1F2F1
		mov	_boss_sprite, 128
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

locret_1F2F1:
		leave
		retn
sub_1F22A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1F2F3	proc near

var_1		= byte ptr -1

		enter	2, 0
		push	si
		call	sub_1EA4B
		mov	[bp+var_1], al
		cmp	[bp+var_1], 2
		jnz	short loc_1F328
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		mov	_bullet_template.pattern, BP_STACK_AIMED
		mov	al, byte_2D024
		mov	_bullet_template.count, al
		mov	_bullet_template.BT_delta.stack_speed, 12
		mov	_bullet_template.BT_special_motion, 0FFh
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE

loc_1F328:
		cmp	[bp+var_1], 1
		jnz	short loc_1F375
		mov	ax, _boss_phase_frame
		mov	bx, 32
		cwd
		idiv	bx
		cmp	dx, 10h
		jnz	short loc_1F35D
		xor	si, si
		mov	_bullet_template.BT_angle, 20h
		jmp	short loc_1F351
; ---------------------------------------------------------------------------

loc_1F345:
		call	sub_1CFB5
		inc	si
		mov	al, _bullet_template.BT_angle
		add	al, -10h
		mov	_bullet_template.BT_angle, al

loc_1F351:
		cmp	si, 5
		jl	short loc_1F345
		call	snd_se_play pascal, 15

loc_1F35D:
		cmp	_boss_phase_frame, 128
		jl	short loc_1F375
		mov	_boss_sprite, 128
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_1F375:
		pop	si
		leave
		retn
sub_1F2F3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1F378	proc near
		push	bp
		mov	bp, sp
		cmp	byte_237F7, 0
		jnz	short loc_1F394
		inc	Palettes
		cmp	Palettes, 0F0h
		jb	short loc_1F3A4
		mov	byte_237F7, 1
		jmp	short loc_1F3A4
; ---------------------------------------------------------------------------

loc_1F394:
		dec	Palettes
		cmp	Palettes, 40h
		ja	short loc_1F3A4
		mov	byte_237F7, 0

loc_1F3A4:
		mov	_palette_changed, 1
		pop	bp
		retn
sub_1F378	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

reimu_update	proc far

var_2		= word ptr -2

		enter	2, 0
		mov	ax, _boss_pos.cur.x
		add	ax, (4 shl 4)
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-28 shl 4)
		mov	_bullet_template.BT_origin.y, ax
		mov	al, _boss_phase
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 0Ch
		ja	loc_1F8A0
		add	bx, bx
		jmp	cs:off_1F8D4[bx]

loc_1F3D6:
		cmp	_boss_phase_frame, 0
		jnz	short loc_1F3E2
		mov	byte_2D03C, 0

loc_1F3E2:
		call	sub_1E67C
		cmp	_boss_phase_frame, 96
		jle	loc_1F8A5
		inc	_boss_phase
		mov	Palettes, 80h
		mov	Palettes+1, 0
		mov	Palettes+2, 0E0h
		mov	_palette_changed, 1
		mov	_boss_phase_frame, 0
		call	snd_se_play pascal, 13
		mov	fp_255AC, offset reimu_marisa_bg_render
		mov	byte_2CDCA, 0Fh
		jmp	loc_1F8A5
; ---------------------------------------------------------------------------

loc_1F421:
		call	sub_1F378
		inc	_boss_phase_frame
		call	sub_1E67C
		cmp	_boss_phase_frame, 128
		jl	loc_1F8A5
		mov	_boss_pos.velocity.x, 0
		mov	_boss_phase_end_hp, 9100
		push	0FFFF1EDCh
		call	sub_1E6F3
		jmp	loc_1F8A5
; ---------------------------------------------------------------------------

loc_1F44D:
		mov	al, _boss_mode
		mov	ah, 0
		or	ax, ax
		jz	short loc_1F462
		cmp	ax, 1
		jz	short loc_1F467
		cmp	ax, 0FFh
		jz	short loc_1F46C
		jmp	short loc_1F46F
; ---------------------------------------------------------------------------

loc_1F462:
		call	sub_1ED15
		jmp	short loc_1F46F
; ---------------------------------------------------------------------------

loc_1F467:
		call	sub_1EDBC
		jmp	short loc_1F46F
; ---------------------------------------------------------------------------

loc_1F46C:
		call	sub_1E917

loc_1F46F:
		call	sub_1F378
		cmp	_boss_mode_change, 9
		jnb	short loc_1F487
		call	sub_1E64E
		or	al, al
		jz	loc_1F8A5
		push	0Ah
		call	sub_19FD8

loc_1F487:
		pushd	189Ch
		jmp	loc_1F621
; ---------------------------------------------------------------------------

loc_1F490:
		cmp	_boss_pos.cur.x, (192 shl 4)
		jge	short loc_1F4A0
		mov	_boss_pos.velocity.x, (2 shl 4)
		jmp	short loc_1F4B6
; ---------------------------------------------------------------------------

loc_1F4A0:
		cmp	_boss_pos.cur.x, (192 shl 4)
		jle	short loc_1F4B0
		mov	_boss_pos.velocity.x, (-2 shl 4)
		jmp	short loc_1F4B6
; ---------------------------------------------------------------------------

loc_1F4B0:
		mov	_boss_pos.velocity.x, 0

loc_1F4B6:
		cmp	_boss_pos.cur.y, (96 shl 4)
		jge	short loc_1F4C6
		mov	_boss_pos.velocity.y, (1 shl 4)
		jmp	short loc_1F4DC
; ---------------------------------------------------------------------------

loc_1F4C6:
		cmp	_boss_pos.cur.y, (96 shl 4)
		jle	short loc_1F4D6
		mov	_boss_pos.velocity.y, (-1 shl 4)
		jmp	short loc_1F4DC
; ---------------------------------------------------------------------------

loc_1F4D6:
		mov	_boss_pos.velocity.y, 0

loc_1F4DC:
		push	offset _boss_pos
		call	_motion_update_2
		call	sub_1F378
		call	sub_1E64E
		cmp	_boss_phase_frame, 64
		jl	loc_1F8A5
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		mov	_boss_mode_change, 0
		mov	_boss_mode, 0
		mov	_boss_sprite, 129
		mov	byte_2D057, 4
		mov	byte_2D03B, 8Ch
		mov	byte_2D028, 0
		jmp	loc_1F8A5
; ---------------------------------------------------------------------------

loc_1F51C:
		mov	al, _boss_mode
		mov	ah, 0
		mov	[bp+var_2], ax
		mov	cx, 5		; switch 5 cases
		mov	bx, offset word_1F8C0

loc_1F52A:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_1F539
		add	bx, 2
		loop	loc_1F52A
		jmp	short loc_1F579	; default
; ---------------------------------------------------------------------------

loc_1F539:
		jmp	word ptr cs:[bx+0Ah] ; switch jump
; ---------------------------------------------------------------------------

loc_1F53D:
		call	sub_1EE21
		jmp	short loc_1F579	; default
; ---------------------------------------------------------------------------

loc_1F542:
		call	sub_1EE73
		jmp	short loc_1F579	; default
; ---------------------------------------------------------------------------

loc_1F547:
		inc	_boss_mode_change
		cmp	byte_2D028, 2
		ja	short loc_1F568
		push	1
		call	randring2_next16_and
		or	ax, ax
		jz	short loc_1F561
		inc	byte_2D028
		jmp	short loc_1F56D
; ---------------------------------------------------------------------------

loc_1F561:
		mov	byte_2D028, 3
		jmp	short loc_1F56D
; ---------------------------------------------------------------------------

loc_1F568:
		mov	byte_2D028, 0

loc_1F56D:
		mov	al, byte_2D028
		mov	_boss_mode, al
		mov	_boss_phase_frame, 0

loc_1F579:
		call	sub_1F378	; default
		cmp	_boss_mode_change, 18
		jnb	short loc_1F591
		call	sub_1E64E
		or	al, al
		jz	loc_1F8A5
		push	0Ah
		call	sub_19FD8

loc_1F591:
		push	11194h
		call	sub_1E6F3
		mov	_boss_pos.velocity.x, 0
		jmp	loc_1F8A5
; ---------------------------------------------------------------------------

loc_1F5A3:
		cmp	_boss_pos.cur.y, (128 shl 4)
		jge	short loc_1F5B3
		mov	_boss_pos.velocity.y, (1 shl 4)
		jmp	short loc_1F5C9
; ---------------------------------------------------------------------------

loc_1F5B3:
		cmp	_boss_pos.cur.y, (128 shl 4)
		jle	short loc_1F5C3
		mov	_boss_pos.velocity.y, (-1 shl 4)
		jmp	short loc_1F5C9
; ---------------------------------------------------------------------------

loc_1F5C3:
		mov	_boss_pos.velocity.y, 0

loc_1F5C9:
		push	offset _boss_pos
		call	_motion_update_2
		call	sub_1F378
		call	sub_1E64E
		cmp	_boss_phase_frame, 64
		jl	loc_1F8A5
		jmp	loc_1F7E1
; ---------------------------------------------------------------------------

loc_1F5E1:
		mov	al, _boss_mode
		mov	ah, 0
		or	ax, ax
		jz	short loc_1F5F6
		cmp	ax, 1
		jz	short loc_1F5FB
		cmp	ax, 0FFh
		jz	short loc_1F600
		jmp	short loc_1F603
; ---------------------------------------------------------------------------

loc_1F5F6:
		call	sub_1EF87
		jmp	short loc_1F603
; ---------------------------------------------------------------------------

loc_1F5FB:
		call	sub_1F04E
		jmp	short loc_1F603
; ---------------------------------------------------------------------------

loc_1F600:
		call	sub_1E9B1

loc_1F603:
		call	sub_1F378
		cmp	_boss_mode_change, 11
		jnb	short loc_1F61B
		call	sub_1E64E
		or	al, al
		jz	loc_1F8A5
		push	0Ah
		call	sub_19FD8

loc_1F61B:
		push	20A8Ch

loc_1F621:
		call	sub_1E6F3
		mov	_boss_sprite, 129
		mov	byte_2D03C, 0
		jmp	loc_1F8A5
; ---------------------------------------------------------------------------

loc_1F631:
		cmp	_boss_pos.cur.x, (192 shl 4)
		jge	short loc_1F641
		mov	_boss_pos.velocity.x, (2 shl 4)
		jmp	short loc_1F657
; ---------------------------------------------------------------------------

loc_1F641:
		cmp	_boss_pos.cur.x, (192 shl 4)
		jle	short loc_1F651
		mov	_boss_pos.velocity.x, (-2 shl 4)
		jmp	short loc_1F657
; ---------------------------------------------------------------------------

loc_1F651:
		mov	_boss_pos.velocity.x, 0

loc_1F657:
		cmp	_boss_pos.cur.y, (96 shl 4)
		jge	short loc_1F667
		mov	_boss_pos.velocity.y, (1 shl 4)
		jmp	short loc_1F67D
; ---------------------------------------------------------------------------

loc_1F667:
		cmp	_boss_pos.cur.y, (96 shl 4)
		jle	short loc_1F677
		mov	_boss_pos.velocity.y, (-1 shl 4)
		jmp	short loc_1F67D
; ---------------------------------------------------------------------------

loc_1F677:
		mov	_boss_pos.velocity.y, 0

loc_1F67D:
		push	offset _boss_pos

loc_1F680:
		call	_motion_update_2
		call	sub_1F378
		call	sub_1E64E
		cmp	_boss_phase_frame, 64
		jl	loc_1F8A5
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		mov	_boss_mode_change, 0
		mov	_boss_mode, 0
		mov	_boss_sprite, 129
		mov	byte_2D057, 12h
		mov	byte_2D03B, 90h
		jmp	loc_1F8A5
; ---------------------------------------------------------------------------

loc_1F6B8:
		mov	al, _boss_mode
		mov	ah, 0
		or	ax, ax
		jz	short loc_1F6CD
		cmp	ax, 1
		jz	short loc_1F6D2
		cmp	ax, 0FFh
		jz	short loc_1F6D7
		jmp	short loc_1F6E9
; ---------------------------------------------------------------------------

loc_1F6CD:
		call	sub_1F111
		jmp	short loc_1F6E9
; ---------------------------------------------------------------------------

loc_1F6D2:
		call	sub_1F22A
		jmp	short loc_1F6E9
; ---------------------------------------------------------------------------

loc_1F6D7:
		inc	_boss_mode_change
		mov	al, _boss_mode_change
		and	al, 1
		mov	_boss_mode, al
		mov	_boss_phase_frame, 0

loc_1F6E9:
		call	sub_1F378
		cmp	_boss_mode_change, 10
		jnb	short loc_1F701
		call	sub_1E64E
		or	al, al
		jz	loc_1F8A5
		push	0Ah
		call	sub_19FD8

loc_1F701:
		push	30384h
		call	sub_1E6F3
		mov	_boss_pos.velocity.x, 0
		mov	byte_2D057, 3
		jmp	loc_1F8A5
; ---------------------------------------------------------------------------

loc_1F718:
		mov	al, _boss_mode
		mov	ah, 0
		or	ax, ax
		jz	short loc_1F72D
		cmp	ax, 1
		jz	short loc_1F732
		cmp	ax, 0FFh
		jz	short loc_1F737
		jmp	short loc_1F73A
; ---------------------------------------------------------------------------

loc_1F72D:
		call	sub_1EF87
		jmp	short loc_1F73A
; ---------------------------------------------------------------------------

loc_1F732:
		call	sub_1F2F3
		jmp	short loc_1F73A
; ---------------------------------------------------------------------------

loc_1F737:
		call	sub_1E917

loc_1F73A:
		call	sub_1F378
		cmp	_boss_mode_change, 12
		jnb	short loc_1F752
		call	sub_1E64E
		or	al, al
		jz	loc_1F8A5
		push	0Ah
		call	sub_19FD8

loc_1F752:
		push	40000h
		call	sub_1E6F3
		mov	_boss_pos.velocity.x, 0
		mov	byte_2D057, 3
		mov	Palettes, 3Ch	; '<'
		jmp	loc_1F8A5
; ---------------------------------------------------------------------------

loc_1F76E:
		cmp	_boss_pos.cur.x, (192 shl 4)
		jge	short loc_1F77E
		mov	_boss_pos.velocity.x, (2 shl 4)
		jmp	short loc_1F794
; ---------------------------------------------------------------------------

loc_1F77E:
		cmp	_boss_pos.cur.x, (192 shl 4)
		jle	short loc_1F78E
		mov	_boss_pos.velocity.x, (-2 shl 4)
		jmp	short loc_1F794
; ---------------------------------------------------------------------------

loc_1F78E:
		mov	_boss_pos.velocity.x, 0

loc_1F794:
		cmp	_boss_pos.cur.y, (96 shl 4)
		jge	short loc_1F7A4
		mov	_boss_pos.velocity.y, (1 shl 4)
		jmp	short loc_1F7BA
; ---------------------------------------------------------------------------

loc_1F7A4:
		cmp	_boss_pos.cur.y, (96 shl 4)
		jle	short loc_1F7B4

loc_1F7AC:
		mov	_boss_pos.velocity.y, (-1 shl 4)
		jmp	short loc_1F7BA
; ---------------------------------------------------------------------------

loc_1F7B4:
		mov	_boss_pos.velocity.y, 0

loc_1F7BA:
		push	offset _boss_pos
		call	_motion_update_2
		mov	al, Palettes
		add	al, 3
		mov	Palettes, al
		mov	al, Palettes+2
		add	al, 0FEh
		mov	Palettes+2, al
		mov	_palette_changed, 1
		call	sub_1E64E
		cmp	_boss_phase_frame, 64
		jl	loc_1F8A5

loc_1F7E1:
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		mov	_boss_mode_change, 0
		mov	_boss_mode, 0
		mov	_boss_sprite, 129
		mov	byte_2D057, 4
		jmp	loc_1F8A5
; ---------------------------------------------------------------------------

loc_1F802:
		mov	ax, _boss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_bullet_template.BT_origin.y, ax
		call	sub_1F17C
		call	sub_1E64E
		or	al, al
		jnz	short loc_1F822
		cmp	_boss_phase_frame, 1000
		jl	loc_1F8A5

loc_1F822:
		call	boss_explode_small pascal, 3
		inc	_boss_phase
		mov	_boss_mode_change, 0
		cmp	_boss_phase_frame, 1000
		jge	short loc_1F83D
		mov	_boss_mode_change, 1

loc_1F83D:
		mov	_boss_phase_frame, 0
		jmp	short loc_1F8A5
; ---------------------------------------------------------------------------

loc_1F845:
		inc	_boss_phase_frame
		cmp	_boss_phase_frame, 16
		jnz	short loc_1F855
		call	boss_explode_small pascal, 4

loc_1F855:
		cmp	_boss_phase_frame, 32
		jnz	short loc_1F8A5
		call	boss_explode_big pascal, 2
		mov	_boss_phase, PHASE_EXPLODE_BIG
		mov	al, _boss_mode_change
		mov	_bullet_clear_trigger, al
		cmp	_boss_mode_change, 0
		jz	short loc_1F878
		push	28h ; '('
		call	sub_19FD8

loc_1F878:
		mov	_boss_sprite, 4
		mov	_boss_phase_frame, 0
		call	snd_se_play pascal, 12
		mov	Palettes, 0
		mov	Palettes+2, 0
		mov	_palette_changed, 1
		mov	_player_invincibility_time, BOSS_DEFEAT_INVINCIBILITY_FRAMES
		jmp	short loc_1F8A5
; ---------------------------------------------------------------------------

loc_1F8A0:
		call	sub_1E743
		leave
		retf
; ---------------------------------------------------------------------------

loc_1F8A5:
		mov	ax, _boss_pos.cur.x
		mov	_homing_target.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_homing_target.y, ax
		call	sub_1EBF3
		push	_boss_hp
		push	9100
		call	sub_19F16
		leave
		retf
reimu_update	endp

; ---------------------------------------------------------------------------
word_1F8C0	dw 0
		dw 1
		dw 2
		dw 3
		dw 0FFh
		dw offset loc_1F53D
		dw offset loc_1F53D
		dw offset loc_1F53D
		dw offset loc_1F542
		dw offset loc_1F547
off_1F8D4	dw offset loc_1F3D6
		dw offset loc_1F421
		dw offset loc_1F44D
		dw offset loc_1F490
		dw offset loc_1F51C
		dw offset loc_1F5A3
		dw offset loc_1F5E1
		dw offset loc_1F631
		dw offset loc_1F6B8
		dw offset loc_1F718
		dw offset loc_1F76E
		dw offset loc_1F802
		dw offset loc_1F845

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1F8EE	proc near
		push	bp
		mov	bp, sp
		mov	byte_2A8D3, 0FEh
		call	sub_13B21
		mov	byte_2A8D3, 2
		call	sub_13B21
		pop	bp
		retn
sub_1F8EE	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1F903	proc near

var_2		= word ptr -2

		enter	2, 0
		mov	ax, _boss_phase_frame
		mov	[bp+var_2], ax
		mov	cx, 4		; switch 4 cases
		mov	bx, offset word_1F96A

loc_1F913:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_2]
		jz	short loc_1F922
		add	bx, 2
		loop	loc_1F913
		jmp	short locret_1F967 ; default
; ---------------------------------------------------------------------------

loc_1F922:
		jmp	word ptr cs:[bx+8] ; switch jump
; ---------------------------------------------------------------------------

loc_1F926:
		mov	word_2A8CE, 1400h
		mov	ax, _boss_pos.cur.y
		add	ax, (-48 shl 4)
		mov	point_2A8C6.y, ax
		mov	ax, _boss_pos.cur.x
		add	ax, (-13 shl 4)
		mov	point_2A8C6.x, ax
		mov	word_2A8D0, 10h
		mov	byte_2A8D2, 0Fh

loc_1F949:
		call	sub_1F8EE
		leave
		retn
; ---------------------------------------------------------------------------

loc_1F94E:
		mov	byte_2A8D2, 9
		jmp	short loc_1F949
; ---------------------------------------------------------------------------

loc_1F955:
		push	point_2A8C6.x
		push	point_2A8C6.y
		call	circles_add_shrinking
		mov	_circles_color, 0Fh

locret_1F967:
		leave			; default
		retn
sub_1F903	endp

; ---------------------------------------------------------------------------
		db 0
word_1F96A	dw 30h
		dw 32h
		dw 34h
		dw 40h
		dw offset loc_1F926
		dw offset loc_1F94E
		dw offset loc_1F949
		dw offset loc_1F955

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1F97A	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 1
		jnz	short loc_1F994
		mov	ax, word_2D05A
		sub	ax, _boss_pos.cur.x
		mov	bx, 64
		cwd
		idiv	bx
		mov	_boss_pos.velocity.x, ax

loc_1F994:
		mov	ax, _boss_pos.velocity.x
		add	_boss_pos.cur.x, ax
		cmp	_boss_phase_frame, 32
		jg	short loc_1F9A9
		mov	al, amp_237F8
		add	al, 2
		jmp	short loc_1F9AE
; ---------------------------------------------------------------------------

loc_1F9A9:
		mov	al, amp_237F8
		add	al, -2

loc_1F9AE:
		mov	amp_237F8, al
		cmp	_boss_phase_frame, 64
		jnz	short loc_1F9C1
		mov	amp_237F8, 0
		mov	al, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1F9C1:
		mov	al, 0
		pop	bp
		retn
sub_1F97A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1F9C5	proc near
		push	bp
		mov	bp, sp
		cmp	_boss_phase_frame, 1
		jnz	short loc_1F9E2
		cmp	_boss_pos.cur.x, (192 shl 4)
		jge	short loc_1F9DC
		mov	ax, (2 shl 4)
		jmp	short loc_1F9DF
; ---------------------------------------------------------------------------

loc_1F9DC:
		mov	ax, (-2 shl 4)

loc_1F9DF:
		mov	_boss_pos.velocity.x, ax

loc_1F9E2:
		cmp	_boss_pos.velocity.x, 0
		jge	short loc_1F9F1
		cmp	_boss_pos.cur.x, (193 shl 4)
		jge	short loc_1FA00

loc_1F9F1:
		cmp	_boss_pos.velocity.x, 0
		jle	short loc_1FA07
		cmp	_boss_pos.cur.x, (192 shl 4)
		jg	short loc_1FA07

loc_1FA00:
		mov	ax, _boss_pos.velocity.x
		add	_boss_pos.cur.x, ax

loc_1FA07:
		cmp	_boss_phase_frame, 64
		jg	short loc_1FA14
		inc	amp_237F8
		jmp	short loc_1FA18
; ---------------------------------------------------------------------------

loc_1FA14:
		dec	amp_237F8

loc_1FA18:
		cmp	_boss_phase_frame, 128
		jnz	short loc_1FA2F
		mov	_boss_pos.cur.x, (192 shl 4)
		mov	amp_237F8, 0
		mov	al, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FA2F:
		mov	al, 0
		pop	bp
		retn
sub_1F9C5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1FA33	proc near
		push	bp
		mov	bp, sp
		call	sub_1F903
		cmp	_boss_phase_frame, 8
		jl	short loc_1FA55
		cmp	_boss_phase_frame, 8
		jnz	short loc_1FA4E
		mov	_boss_sprite, 130
		jmp	short loc_1FA55
; ---------------------------------------------------------------------------

loc_1FA4E:
		cmp	_boss_sprite, 32
		jnb	short loc_1FA59

loc_1FA55:
		mov	al, 0
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FA59:
		cmp	_boss_phase_frame, 80
		jge	short loc_1FA85
		cmp	_boss_phase_frame, 32
		jnz	short loc_1FA6E
		call	snd_se_play pascal, 8

loc_1FA6E:
		cmp	_stage_frame_mod2, 0
		jz	short loc_1FA7C
		mov	_boss_sprite, 134
		jmp	short loc_1FA81
; ---------------------------------------------------------------------------

loc_1FA7C:
		mov	_boss_sprite, 130

loc_1FA81:
		mov	al, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FA85:
		cmp	_boss_phase_frame, 80
		jnz	short loc_1FA95
		mov	_boss_sprite, 132
		mov	al, 2
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FA95:
		cmp	_boss_phase_frame, 144
		jge	short loc_1FAA1
		mov	al, 3
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FAA1:
		mov	_boss_sprite, 132
		mov	al, 4
		pop	bp
		retn
sub_1FA33	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1FAAA	proc near
		push	bp
		mov	bp, sp
		call	sub_1FA33
		mov	ah, 0
		cmp	ax, 2
		jz	short loc_1FABE
		cmp	ax, 4
		jz	short loc_1FAEA
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FABE:
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_BACKWARDS
		mov	_bullet_template.patnum, PAT_BULLET16_N_HEART_BALL_RED
		mov	_bullet_template.speed, (4 shl 4) + 6
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 90
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		call	fp_2D000
		call	snd_se_play pascal, 9
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FAEA:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh
		pop	bp
		retn
sub_1FAAA	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1FAF7	proc near
		push	bp
		mov	bp, sp
		call	sub_1FA33
		mov	ah, 0
		cmp	ax, 2
		jz	short loc_1FB10
		cmp	ax, 3
		jz	short loc_1FB36
		cmp	ax, 4
		jz	short loc_1FB79
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FB10:
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.BT_delta.spread_angle, 8
		mov	ax, _player_pos.cur.y
		sub	ax, _bullet_template.BT_origin.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, _bullet_template.BT_origin.x
		push	ax
		call	iatan2
		add	al, 0C0h
		mov	byte_2D02D, al
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FB36:
		cmp	_stage_frame_mod2, 0
		jnz	short loc_1FB84
		call	randring2_next16_and pascal, 3Fh
		add	al, 8
		mov	_bullet_template.speed, al
		call	randring2_next16_and pascal, 3
		add	al, 5
		mov	_bullet_template.count, al
		mov	al, byte_2D02D
		mov	_bullet_template.BT_angle, al
		call	fp_2D000
		mov	al, 80h
		sub	al, byte_2D02D
		mov	_bullet_template.BT_angle, al
		call	fp_2D000
		mov	al, byte_2D02D
		add	al, 7
		mov	byte_2D02D, al
		call	snd_se_play pascal, 9
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FB79:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_1FB84:
		pop	bp
		retn
sub_1FAF7	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1FB86	proc near
		push	bp
		mov	bp, sp
		call	sub_1FA33
		mov	ah, 0
		cmp	ax, 2
		jz	short loc_1FBA1
		cmp	ax, 3
		jz	short loc_1FBAD
		cmp	ax, 4
		jz	loc_1FC39
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FBA1:
		mov	_bullet_template.BT_special_motion, 86h
		mov	byte_2CFF7, 4
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FBAD:
		cmp	_stage_frame_mod2, 0
		jz	loc_1FC44
		mov	_bullet_template.pattern, BP_SINGLE
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_CROSS_YELLOW
		call	randring2_next16_and pascal, 3Fh
		add	al, (2 shl 4) + 10
		mov	_bullet_template.speed, al
		call	randring2_next16_mod pascal, (64 shl 4)
		mov	dx, _boss_pos.cur.x
		add	dx, (-32 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.x, ax
		call	randring2_next16_mod pascal, (32 shl 4)
		mov	dx, _boss_pos.cur.y
		add	dx, (-32 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.BT_angle, -20h
		call	fp_2D002
		call	randring2_next16_and pascal, 3Fh
		add	al, (2 shl 4) + 10
		mov	_bullet_template.speed, al
		mov	_bullet_template.BT_angle, -60h
		call	fp_2D002
		call	snd_se_play pascal, 9
		cmp	_stage_frame_mod16, 1
		jnz	short loc_1FC44
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE
		mov	_bullet_template.pattern, BP_RING_AIMED
		mov	_bullet_template.count, 32
		mov	_bullet_template.speed, (5 shl 4)
		call	fp_2D000
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FC39:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_1FC44:
		pop	bp
		retn
sub_1FB86	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1FC46	proc near
		push	bp
		mov	bp, sp
		call	sub_1FA33
		mov	ah, 0
		cmp	ax, 2
		jz	short loc_1FC61
		cmp	ax, 3
		jz	short loc_1FC68
		cmp	ax, 4
		jz	loc_1FD23
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FC61:
		mov	byte_2CFF7, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FC68:
		cmp	_stage_frame_mod2, 0
		jz	short loc_1FCE0
		mov	_bullet_template.BT_special_motion, 81h
		mov	_bullet_template.pattern, BP_SINGLE
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_N_SMALL_BALL_YELLOW
		call	randring2_next16_and pascal, 3Fh
		add	al, (1 shl 4)
		mov	_bullet_template.speed, al
		push	(64 shl 4)
		call	randring2_next16_mod
		mov	dx, _boss_pos.cur.x ; jumptable 0001EA6B case 32792
		add	dx, (-32 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.x, ax
		push	(32 shl 4)
		call	randring2_next16_mod
		mov	dx, _boss_pos.cur.y
		add	dx, (-26 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.y, ax
		call	randring2_next16_and pascal, 3Fh
		add	al, (1 shl 4)
		mov	_bullet_template.speed, al
		mov	_bullet_template.BT_angle, 80h
		mov	byte_2CFF8, 0C0h
		call	fp_2D002
		mov	_bullet_template.BT_angle, 0
		mov	byte_2CFF8, 40h
		call	fp_2D002
		call	snd_se_play pascal, 9

loc_1FCE0:
		cmp	_stage_frame_mod4, 0
		jnz	short loc_1FD2E
		mov	word_2A8D0, 8
		mov	word_2A8CE, 400h
		mov	byte_2A8D2, 0Eh
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	ax, _bullet_template.BT_origin.y
		mov	point_2A8C6.y, ax
		call	randring2_next16_mod pascal, (320 shl 4)
		add	ax, (32 shl 4)
		mov	point_2A8C6.x, ax
		mov	_bullet_template.pattern, BP_RING_AIMED
		mov	_bullet_template.count, 16
		mov	_bullet_template.speed, (4 shl 4)
		call	sub_13AB7
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FD23:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_1FD2E:
		pop	bp
		retn
sub_1FC46	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1FD30	proc near
		push	bp
		mov	bp, sp
		push	si
		call	sub_1FA33
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 4
		ja	loc_1FDF1
		add	bx, bx
		jmp	cs:off_1FDF4[bx]

loc_1FD49:
		mov	_bullet_template.patnum, PAT_BULLET16_N_HEART_BALL_RED
		mov	_bullet_template.pattern, BP_SPREAD_AIMED
		mov	_bullet_template.BT_special_motion, 0FFh
		mov	_bullet_template.BT_delta.spread_angle, 10h
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.count, 2
		jmp	loc_1FDF1
; ---------------------------------------------------------------------------

loc_1FD6A:
		mov	ax, _boss_phase_frame
		and	ax, 0Fh
		cmp	ax, 8
		jnz	short loc_1FDF1
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		xor	si, si
		mov	_bullet_template.speed, (1 shl 4)
		jmp	short loc_1FD8F
; ---------------------------------------------------------------------------

loc_1FD83:
		call	sub_1CFB5
		inc	si
		mov	al, _bullet_template.speed
		add	al, (1 shl 4) + 4
		mov	_bullet_template.speed, al

loc_1FD8F:
		cmp	si, 4
		jl	short loc_1FD83
		call	snd_se_play pascal, 15
		mov	al, _bullet_template.count
		add	al, 2
		mov	_bullet_template.count, al
		mov	al, _bullet_template.BT_delta
		add	al, -2
		mov	_bullet_template.BT_delta, al
		jmp	short loc_1FDF1
; ---------------------------------------------------------------------------

loc_1FDAD:
		mov	_bullet_template.pattern, BP_STACK_AIMED
		mov	_bullet_template.count, 8
		mov	_bullet_template.BT_delta.stack_speed, 10
		mov	_bullet_template.speed, (2 shl 4)
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		mov	_bullet_template.BT_angle, 0
		jmp	short loc_1FDF1
; ---------------------------------------------------------------------------

loc_1FDCD:
		test	byte ptr _boss_phase_frame, 3
		jnz	short loc_1FDF1
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_FORWARDS
		call	fp_2D000
		call	snd_se_play pascal, 15
		jmp	short loc_1FDF1
; ---------------------------------------------------------------------------

loc_1FDE6:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_1FDF1:
		pop	si
		pop	bp
		retn
sub_1FD30	endp

; ---------------------------------------------------------------------------
off_1FDF4	dw offset loc_1FD49
		dw offset loc_1FD6A
		dw offset loc_1FDAD
		dw offset loc_1FDCD
		dw offset loc_1FDE6

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1FDFE	proc near
		push	bp
		mov	bp, sp
		call	sub_1FA33
		mov	ah, 0
		cmp	ax, 2
		jz	short loc_1FE17
		cmp	ax, 3
		jz	short loc_1FE45
		cmp	ax, 4
		jz	short loc_1FE5D
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FE17:
		mov	_bullet_template.speed, (5 shl 4)
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 1
		mov	_bullet_template.BT_delta.spread_angle, 6
		mov	ax, _player_pos.cur.y
		sub	ax, _bullet_template.BT_origin.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, _bullet_template.BT_origin.x
		push	ax
		call	iatan2
		mov	_bullet_template.BT_angle, al
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FE45:
		cmp	_stage_frame_mod4, 0
		jnz	short loc_1FE68
		call	fp_2D000
		inc	_bullet_template.count
		call	snd_se_play pascal, 9
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FE5D:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_1FE68:
		pop	bp
		retn
sub_1FDFE	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1FE6A	proc near
		push	bp
		mov	bp, sp
		call	sub_1FA33
		mov	ah, 0
		cmp	ax, 2
		jz	short loc_1FE83
		cmp	ax, 3
		jz	short loc_1FEA3
		cmp	ax, 4
		jz	short loc_1FED2
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FE83:
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 5
		mov	_bullet_template.BT_delta.spread_angle, 0Bh
		mov	_bullet_template.BT_angle, 0
		mov	_bullet_template.speed, (5 shl 4) + 10
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FEA3:
		cmp	_stage_frame_mod2, 0
		jnz	short loc_1FEDD
		mov	_bullet_template.spawn_type, BST_BULLET16
		call	fp_2D000
		mov	al, 80h
		sub	al, _bullet_template.BT_angle
		mov	_bullet_template.BT_angle, al
		call	fp_2D000
		mov	al, 78h
		sub	al, _bullet_template.BT_angle
		mov	_bullet_template.BT_angle, al
		call	snd_se_play pascal, 3
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1FED2:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_1FEDD:
		pop	bp
		retn
sub_1FE6A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1FEDF	proc near

var_1		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		cmp	_boss_phase_frame, 1
		jnz	short loc_1FF2E
		push	1
		call	randring2_next16_and
		mov	[bp+var_1], al
		mov	si, 0B204h
		xor	di, di
		jmp	short loc_1FF29
; ---------------------------------------------------------------------------

loc_1FEFB:
		cmp	[bp+var_1], 0
		jnz	short loc_1FF0C
		mov	ax, di
		imul	ax, 180h
		add	ax, 0C0h
		jmp	short loc_1FF1D
; ---------------------------------------------------------------------------

loc_1FF0C:
		push	0C0h
		call	randring2_next16_mod
		mov	dx, di
		imul	dx, 180h
		add	dx, 60h
		add	ax, dx

loc_1FF1D:
		mov	[si+2],	ax
		mov	word ptr [si+4], 0
		inc	di
		add	si, 1Ah

loc_1FF29:
		cmp	di, 10h
		jl	short loc_1FEFB

loc_1FF2E:
		call	sub_1FA33
		mov	ah, 0
		dec	ax
		mov	bx, ax
		cmp	bx, 3
		ja	loc_20044
		add	bx, bx
		jmp	cs:off_20048[bx]

loc_1FF44:
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.count, 5
		mov	_bullet_template.BT_delta.spread_angle, 18h
		mov	_bullet_template.BT_angle, -40h
		mov	_bullet_template.patnum, PAT_BULLET16_N_OUTLINED_BALL_WHITE
		mov	_bullet_template.speed, (7 shl 4) + 15
		call	fp_2D004
		call	fp_2D000
		call	snd_se_play pascal, 3
		mov	ax, _player_pos.cur.y
		sub	ax, _bullet_template.BT_origin.y
		push	ax
		mov	ax, _player_pos.cur.x
		sub	ax, _bullet_template.BT_origin.x
		push	ax
		call	iatan2
		add	al, 0D0h
		mov	byte_2D02D, al
		jmp	loc_20044
; ---------------------------------------------------------------------------

loc_1FF93:
		mov	ax, _bullet_template.BT_origin.x
		mov	point_2561A.x, ax
		mov	ax, _boss_pos.cur.y
		mov	point_2561A.y, ax
		mov	word_2562A, 40h
		mov	word_2562E, 6
		mov	word_25624, 20h	; ' '
		mov	word_25626, 30h	; '0'
		mov	byte_25628, 8
		call	sub_15DBD
		jmp	loc_20044
; ---------------------------------------------------------------------------

loc_1FFC2:
		cmp	_stage_frame_mod4, 0
		jnz	short loc_20044
		cmp	_stage_frame_mod8, 0
		jnz	short loc_1FFF8
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	al, byte_2D02D
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.pattern, BP_STACK
		mov	_bullet_template.count, 12
		mov	_bullet_template.speed, (2 shl 4)
		mov	_bullet_template.BT_delta.stack_speed, 8
		add	al, 0Ch
		mov	byte_2D02D, al
		call	fp_2D000

loc_1FFF8:
		mov	_bullet_template.speed, (8 shl 4)
		mov	_bullet_template.BT_angle, 40h
		mov	_bullet_template.patnum, PAT_BULLET16_N_OUTLINED_BALL_WHITE
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.BT_origin.y, 0
		mov	_bullet_template.pattern, BP_SINGLE
		mov	si, 0B204h
		xor	di, di
		jmp	short loc_2002B
; ---------------------------------------------------------------------------

loc_2001E:
		mov	ax, [si+2]
		mov	_bullet_template.BT_origin.x, ax
		call	sub_1CFA2
		inc	di
		add	si, 1Ah

loc_2002B:
		cmp	di, 10h
		jl	short loc_2001E
		call	snd_se_play pascal, 3
		jmp	short loc_20044
; ---------------------------------------------------------------------------

loc_20039:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0FFh

loc_20044:
		pop	di
		pop	si
		leave
		retn
sub_1FEDF	endp

; ---------------------------------------------------------------------------
off_20048	dw offset loc_1FF44
		dw offset loc_1FF93
		dw offset loc_1FFC2
		dw offset loc_20039

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_20050	proc near
		push	bp
		mov	bp, sp
		mov	_boss_sprite, 128
		cmp	_stage_frame_mod8, 0
		jnz	short loc_200B4
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		call	randring2_next16_mod pascal, (64 shl 4)
		mov	dx, _boss_pos.cur.x
		add	dx, (-32 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.x, ax
		call	randring2_next16_mod pascal, (32 shl 4)
		mov	dx, _boss_pos.cur.y
		add	dx, (-26 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 16
		mov	_bullet_template.spawn_type, BST_BULLET16
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE
		call	randring2_next16_and pascal, 3Fh
		add	al, (1 shl 4)
		mov	_bullet_template.speed, al
		call	fp_2D000
		call	snd_se_play pascal, 3

loc_200B4:
		pop	bp
		retn
sub_20050	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_200B6	proc near
		push	bp
		mov	bp, sp
		cmp	_stage_frame_mod4, 0
		jnz	loc_2018E
		mov	_boss_sprite, 134
		mov	_bullet_template.pattern, BP_SPREAD
		mov	_bullet_template.BT_delta.spread_angle, 9
		mov	_bullet_template.count, 8
		mov	_bullet_template.speed, (3 shl 4) + 8
		mov	al, byte ptr _stage_frame
		add	al, al
		mov	_bullet_template.BT_angle, al
		mov	ax, _stage_frame
		and	ax, 1FFh
		cmp	ax, 256
		jb	short loc_200F6
		mov	al, _bullet_template.BT_angle
		neg	al
		mov	_bullet_template.BT_angle, al

loc_200F6:
		call	fp_2D000
		mov	al, _bullet_template.BT_angle
		add	al, 80h
		mov	_bullet_template.BT_angle, al
		call	fp_2D000
		mov	_bullet_template.speed, (2 shl 4)
		mov	_bullet_template.spawn_type, BST_BULLET16_CLOUD_BACKWARDS
		mov	_bullet_template.BT_delta.spread_angle, 1
		mov	_bullet_template.count, 3
		mov	_bullet_template.patnum, PAT_BULLET16_N_BALL_BLUE
		call	randring2_next16_mod pascal, (32 shl 4)
		mov	dx, _boss_pos.cur.y
		add	dx, (-26 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.y, ax
		mov	al, byte_2D02D
		mov	ah, 0
		shl	ax, 4
		add	ax, _boss_pos.cur.x
		mov	_bullet_template.BT_origin.x, ax
		mov	al, byte_2D02C
		mov	_bullet_template.BT_angle, al
		call	fp_2D000
		mov	al, byte_2D02D
		mov	ah, 0
		shl	ax, 4
		mov	dx, _boss_pos.cur.x
		sub	dx, ax
		mov	_bullet_template.BT_origin.x, dx
		mov	al, byte_2D02C
		neg	al
		mov	_bullet_template.BT_angle, al
		call	fp_2D000
		mov	al, byte_2D02D
		add	al, 10h
		mov	byte_2D02D, al
		cmp	byte_2D02D, 0B0h ; ''
		jbe	short loc_2017D
		mov	byte_2D02D, 10h

loc_2017D:
		mov	al, byte_2D02C
		add	al, 0Bh
		mov	byte_2D02C, al
		call	snd_se_play pascal, 3
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_2018E:
		mov	_boss_sprite, 130
		pop	bp
		retn
sub_200B6	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_20195	proc near
		push	bp
		mov	bp, sp
		cmp	_stage_frame_mod2, 0
		jz	short loc_201A6
		mov	_boss_sprite, 134
		jmp	short loc_201AB
; ---------------------------------------------------------------------------

loc_201A6:
		mov	_boss_sprite, 130

loc_201AB:
		cmp	_stage_frame_mod4, 0
		jnz	short loc_20200
		call	randring2_next16_and pascal, 1
		mov	_bullet_template.spawn_type, al
		call	randring2_next16_mod pascal, (64 shl 4)
		mov	dx, _boss_pos.cur.x
		add	dx, (-32 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.x, ax
		call	randring2_next16_mod pascal, (32 shl 4)
		mov	dx, _boss_pos.cur.y
		add	dx, (-26 shl 4)
		add	ax, dx
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 32
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.speed, (6 shl 4) + 4
		call	fp_2D000
		call	snd_se_play pascal, 3

loc_20200:
		pop	bp
		retn
sub_20195	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_20202	proc near
		push	bp
		mov	bp, sp
		cmp	byte_259EF, 0
		jz	short loc_20220
		cmp	amp_237F8, 0
		jnz	short loc_20220
		push	3000300h
		push	0Ah
		call	sub_1E5D8
		jmp	short loc_20233
; ---------------------------------------------------------------------------

loc_20220:
		cmp	_boss_sprite, 0
		jz	short loc_20233
		cmp	amp_237F8, 0
		jnz	short loc_20233
		call	sub_1E64E
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_20233:
		inc	_boss_phase_frame
		mov	al, 0
		pop	bp
		retn
sub_20202	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_2023B	proc near
		push	bp
		mov	bp, sp
		cmp	_stage_frame_mod8, 0
		jnz	short loc_20268
		mov	_bullet_template.pattern, BP_RING
		mov	_bullet_template.count, 32
		mov	_bullet_template.patnum, PAT_BULLET16_D_BLUE
		mov	_bullet_template.spawn_type, BST_BULLET16
		call	randring2_next16
		mov	_bullet_template.BT_angle, al
		mov	_bullet_template.speed, (7 shl 4)
		call	fp_2D000

loc_20268:
		pop	bp
		retn
sub_2023B	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

gengetsu_update	proc far
		push	bp
		mov	bp, sp
		cmp	byte_256A8, 0
		jz	short loc_20279
		mov	byte_259EF, 20h	; ' '

loc_20279:
		cmp	byte_259EF, 0
		jz	short loc_20284
		dec	byte_259EF

loc_20284:
		mov	ax, _boss_pos.cur.x
		add	ax, (-13 shl 4)
		mov	_bullet_template.BT_origin.x, ax
		mov	ax, _boss_pos.cur.y
		add	ax, (-48 shl 4)
		mov	_bullet_template.BT_origin.y, ax
		mov	_bullet_template.spawn_type, BST_PELLET
		mov	al, _boss_phase
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 9
		ja	loc_206B1
		add	bx, bx
		jmp	cs:off_206D8[bx]

loc_202B0:
		call	sub_20202
		mov	_boss_hp, 18700
		cmp	_boss_phase_frame, 128
		jle	loc_206B6
		mov	_boss_phase_end_hp, 14700
		inc	_boss_phase
		mov	_boss_phase_frame, 0
		call	snd_se_play pascal, 13
		mov	byte_2CDCA, 0Fh
		mov	fp_255AC, offset mugetsu_gengetsu_bg_render
		jmp	loc_206B6
; ---------------------------------------------------------------------------

loc_202E8:
		call	sub_20202
		cmp	_boss_phase_frame, 64
		jl	loc_206B6
		inc	_boss_phase
		mov	_boss_mode, 0
		mov	_boss_mode_change, 0
		mov	_boss_phase_frame, 0
		mov	_boss_pos.velocity.x, 0
		jmp	loc_206B6
; ---------------------------------------------------------------------------

loc_20311:
		mov	al, _boss_mode
		mov	ah, 0
		or	ax, ax
		jz	short loc_20326
		cmp	ax, 1
		jz	short loc_2032B
		cmp	ax, 0FFh
		jz	short loc_20330
		jmp	short loc_20389
; ---------------------------------------------------------------------------

loc_20326:
		call	sub_1FAAA
		jmp	short loc_20389
; ---------------------------------------------------------------------------

loc_2032B:
		call	sub_1FAF7
		jmp	short loc_20389
; ---------------------------------------------------------------------------

loc_20330:
		cmp	_boss_phase_frame, 1
		jnz	short loc_20370
		test	_boss_mode_change, 1
		jz	short loc_20364
		mov	ax, _player_pos.cur.x
		mov	word_2D05A, ax
		cmp	word_2D05A, 200h
		jge	short loc_20354
		mov	word_2D05A, 200h
		jmp	short loc_20370
; ---------------------------------------------------------------------------

loc_20354:
		cmp	word_2D05A, 1600h
		jle	short loc_20370
		mov	word_2D05A, 1600h
		jmp	short loc_20370
; ---------------------------------------------------------------------------

loc_20364:
		push	1000h
		call	randring2_next16_mod
		add	ax, 400h
		mov	word_2D05A, ax

loc_20370:
		call	sub_1F97A
		or	al, al
		jz	short loc_20389
		inc	_boss_mode_change
		mov	al, _boss_mode_change
		and	al, 1
		mov	_boss_mode, al
		mov	_boss_phase_frame, 0

loc_20389:
		cmp	_boss_mode_change, 18
		jb	short loc_2039A
		cmp	_boss_mode, 0FFh
		jz	short loc_2039A
		call	sub_2023B

loc_2039A:
		cmp	_boss_mode_change, 22
		jnb	short loc_203AF
		call	sub_20202
		or	al, al
		jz	loc_206B6
		push	64h ; 'd'
		call	sub_19FD8

loc_203AF:
		pushd	319Ch
		jmp	loc_205AA
; ---------------------------------------------------------------------------

loc_203B8:
		mov	al, _boss_mode
		mov	ah, 0
		or	ax, ax
		jz	short loc_203CD
		cmp	ax, 1
		jz	short loc_203D2
		cmp	ax, 0FFh
		jz	short loc_203D7
		jmp	short loc_20430
; ---------------------------------------------------------------------------

loc_203CD:
		call	sub_1FB86
		jmp	short loc_20430
; ---------------------------------------------------------------------------

loc_203D2:
		call	sub_1FC46
		jmp	short loc_20430
; ---------------------------------------------------------------------------

loc_203D7:
		cmp	_boss_phase_frame, 1
		jnz	short loc_20417
		test	_boss_mode_change, 1
		jz	short loc_2040B
		mov	ax, _player_pos.cur.x
		mov	word_2D05A, ax
		cmp	word_2D05A, 200h
		jge	short loc_203FB
		mov	word_2D05A, 200h
		jmp	short loc_20417
; ---------------------------------------------------------------------------

loc_203FB:
		cmp	word_2D05A, 1600h
		jle	short loc_20417
		mov	word_2D05A, 1600h
		jmp	short loc_20417
; ---------------------------------------------------------------------------

loc_2040B:
		push	1000h
		call	randring2_next16_mod
		add	ax, 400h
		mov	word_2D05A, ax

loc_20417:
		call	sub_1F97A
		or	al, al
		jz	short loc_20430
		mov	al, _boss_mode_change
		and	al, 1
		mov	_boss_mode, al
		inc	_boss_mode_change
		mov	_boss_phase_frame, 0

loc_20430:
		cmp	_boss_mode_change, 18
		jb	short loc_20441
		cmp	_boss_mode, 0FFh
		jz	short loc_20441
		call	sub_2023B

loc_20441:
		cmp	_boss_mode_change, 22
		jnb	short loc_20456
		call	sub_20202
		or	al, al
		jz	loc_206B6
		push	64h ; 'd'
		call	sub_19FD8

loc_20456:
		push	322C4h
		jmp	loc_205AA
; ---------------------------------------------------------------------------

loc_2045F:
		mov	al, _boss_mode
		mov	ah, 0
		or	ax, ax
		jz	short loc_20474
		cmp	ax, 1
		jz	short loc_20479
		cmp	ax, 0FFh
		jz	short loc_2047E
		jmp	short loc_204D7
; ---------------------------------------------------------------------------

loc_20474:
		call	sub_1FD30
		jmp	short loc_204D7
; ---------------------------------------------------------------------------

loc_20479:
		call	sub_1FDFE
		jmp	short loc_204D7
; ---------------------------------------------------------------------------

loc_2047E:
		cmp	_boss_phase_frame, 1
		jnz	short loc_204BE
		test	_boss_mode_change, 1
		jz	short loc_204B2
		mov	ax, _player_pos.cur.x
		mov	word_2D05A, ax
		cmp	word_2D05A, 200h
		jge	short loc_204A2
		mov	word_2D05A, 200h
		jmp	short loc_204BE
; ---------------------------------------------------------------------------

loc_204A2:
		cmp	word_2D05A, 1600h
		jle	short loc_204BE
		mov	word_2D05A, 1600h
		jmp	short loc_204BE
; ---------------------------------------------------------------------------

loc_204B2:
		push	1000h
		call	randring2_next16_mod
		add	ax, 400h
		mov	word_2D05A, ax

loc_204BE:
		call	sub_1F97A
		or	al, al
		jz	short loc_204D7
		mov	al, _boss_mode_change
		and	al, 1
		mov	_boss_mode, al
		inc	_boss_mode_change
		mov	_boss_phase_frame, 0

loc_204D7:
		cmp	_boss_mode_change, 18
		jb	short loc_204E8
		cmp	_boss_mode, 0FFh
		jz	short loc_204E8
		call	sub_2023B

loc_204E8:
		cmp	_boss_mode_change, 22
		jnb	short loc_204FD
		call	sub_20202
		or	al, al
		jz	loc_206B6
		push	64h ; 'd'
		call	sub_19FD8

loc_204FD:
		push	3157Ch
		jmp	loc_205AA
; ---------------------------------------------------------------------------

loc_20506:
		mov	al, _boss_mode
		mov	ah, 0
		or	ax, ax
		jz	short loc_2051B
		cmp	ax, 1
		jz	short loc_20520
		cmp	ax, 0FFh
		jz	short loc_20525
		jmp	short loc_2057E
; ---------------------------------------------------------------------------

loc_2051B:
		call	sub_1FE6A
		jmp	short loc_2057E
; ---------------------------------------------------------------------------

loc_20520:
		call	sub_1FEDF
		jmp	short loc_2057E
; ---------------------------------------------------------------------------

loc_20525:
		cmp	_boss_phase_frame, 1
		jnz	short loc_20565
		test	_boss_mode_change, 1
		jz	short loc_20559
		mov	ax, _player_pos.cur.x
		mov	word_2D05A, ax
		cmp	word_2D05A, 200h
		jge	short loc_20549
		mov	word_2D05A, 200h
		jmp	short loc_20565
; ---------------------------------------------------------------------------

loc_20549:
		cmp	word_2D05A, 1600h
		jle	short loc_20565
		mov	word_2D05A, 1600h
		jmp	short loc_20565
; ---------------------------------------------------------------------------

loc_20559:
		push	1000h
		call	randring2_next16_mod
		add	ax, 400h
		mov	word_2D05A, ax

loc_20565:
		call	sub_1F97A
		or	al, al
		jz	short loc_2057E
		mov	al, _boss_mode_change
		and	al, 1
		mov	_boss_mode, al
		inc	_boss_mode_change
		mov	_boss_phase_frame, 0

loc_2057E:
		cmp	_boss_mode_change, 18
		jb	short loc_2058F
		cmp	_boss_mode, 0FFh
		jz	short loc_2058F
		call	sub_2023B

loc_2058F:
		cmp	_boss_mode_change, 22
		jnb	short loc_205A4
		call	sub_20202
		or	al, al
		jz	loc_206B6
		push	64h ; 'd'
		call	sub_19FD8

loc_205A4:
		push	30BB8h

loc_205AA:
		call	sub_1E6F3
		mov	_boss_mode, 0FFh
		mov	word_2D05A, 0C00h
		jmp	loc_206B6
; ---------------------------------------------------------------------------

loc_205BB:
		call	sub_20202
		call	sub_1F9C5
		or	al, al
		jz	loc_206B6
		inc	_boss_phase
		mov	_boss_phase_frame, 32
		jmp	loc_206B6
; ---------------------------------------------------------------------------

loc_205D4:
		call	sub_20050
		cmp	_boss_phase_frame, 1500
		jge	short loc_205ED
		call	sub_20202
		or	al, al
		jz	loc_206B6
		push	64h ; 'd'
		call	sub_19FD8

loc_205ED:
		push	40000h
		call	sub_1E6F3
		mov	_boss_mode, 0FFh
		mov	word_2D05A, 0C00h
		mov	byte_2D02D, 10h
		jmp	loc_206B6
; ---------------------------------------------------------------------------

loc_20609:
		cmp	_boss_phase_frame, 3000
		jg	short loc_20616
		call	sub_200B6
		jmp	short loc_20619
; ---------------------------------------------------------------------------

loc_20616:
		call	sub_20195

loc_20619:
		call	sub_20202
		or	al, al
		jnz	short loc_2062A
		cmp	_boss_phase_frame, 5000
		jl	loc_206B6

loc_2062A:
		call	boss_explode_small pascal, 1
		inc	_boss_phase
		cmp	_boss_phase_frame, 5000
		jge	short loc_20642
		mov	_boss_mode_change, 1
		jmp	short loc_20647
; ---------------------------------------------------------------------------

loc_20642:
		mov	_boss_mode_change, 0

loc_20647:
		mov	_boss_phase_frame, 0
		mov	_boss_mode, 0
		mov	PaletteTone, 100
		mov	_palette_changed, 1
		jmp	short loc_206B6
; ---------------------------------------------------------------------------

loc_2065F:
		inc	_boss_phase_frame
		cmp	_boss_phase_frame, 16
		jnz	short loc_2066F
		call	boss_explode_small pascal, 4

loc_2066F:
		cmp	_boss_phase_frame, 32
		jnz	short loc_206B6
		call	boss_explode_big pascal, 3
		mov	_boss_phase, PHASE_EXPLODE_BIG
		mov	al, _boss_mode_change
		mov	_bullet_clear_trigger, al
		cmp	_boss_mode_change, 0
		jz	short loc_20693
		push	0C8h
		call	sub_19FD8

loc_20693:
		mov	_boss_sprite, 4
		mov	_boss_phase_frame, 0
		call	snd_se_play pascal, 12
		mov	_palette_changed, 1
		mov	_player_invincibility_time, BOSS_DEFEAT_INVINCIBILITY_FRAMES
		jmp	short loc_206B6
; ---------------------------------------------------------------------------

loc_206B1:
		call	sub_1E743
		pop	bp
		retf
; ---------------------------------------------------------------------------

loc_206B6:
		cmp	amp_237F8, 0
		jnz	short loc_206C9
		mov	ax, _boss_pos.cur.x
		mov	_homing_target.x, ax
		mov	ax, _boss_pos.cur.y
		mov	_homing_target.y, ax

loc_206C9:
		call	sub_15DE8
		push	_boss_hp
		push	18700
		call	sub_19F16
		pop	bp
		retf
gengetsu_update	endp

; ---------------------------------------------------------------------------
off_206D8	dw offset loc_202B0
		dw offset loc_202E8
		dw offset loc_20311
		dw offset loc_203B8
		dw offset loc_2045F
		dw offset loc_20506
		dw offset loc_205BB
		dw offset loc_205D4
		dw offset loc_20609
		dw offset loc_2065F
main_03_TEXT	ends

; ---------------------------------------------------------------------------
; ===========================================================================

	.data

include th04/strings/pause[data].asm
		db    0
eyename	dd aEye0_cdg	; original ZUN variable name
word_213DE	dw 0
off_213E0	dd aSt00
					; "ST00"
bbname	dd aBb0_cdg_0	; original ZUN variable name
aEye0_cdg	db 'eye0.cdg',0
aUmx		db 'z.',0
aGameft_bft	db 'GAMEFT.bft',0
aMiko		db 'miko',0
; char arg0[]
arg0		db 'op',0
aSt00		db 'ST00',0
aEye_rgb	db 'eye.rgb',0
aMiko_bft	db 'miko.bft',0
aMari_bft	db 'mari.bft',0
aMikod_bft	db 'mikod.bft',0
aMiko32_bft	db 'miko32.bft',0
aMiko16_bft	db 'miko16.bft',0
aBss0_cd2	db 'BSS0.CD2',0
aSt00_bft	db 'st00.bft',0
aSt00_mpn	db 'st00.mpn',0
aSt10_mpn	db 'st10.mpn',0
aBss1_cd2	db 'BSS1.CD2',0
aSt01_bft	db 'st01.bft',0
aSt01_mpn	db 'st01.mpn',0
aBss2_cd2	db 'BSS2.CD2',0
aSt02_bft	db 'st02.bft',0
aSt02_mpn	db 'st02.mpn',0
aKao3_cd2	db 'KAO3.CD2',0
aKao2_cd2	db 'KAO2.CD2',0
aSt03_bft	db 'st03.bft',0
aSt03_mpn	db 'st03.mpn',0
aBss4_cd2	db 'BSS4.CD2',0
aSt04_bft	db 'st04.bft',0
aSt04_mpn	db 'st04.mpn',0
aSt05_bft	db 'st05.bft',0
aBss5_cd2	db 'BSS5.CD2',0
aSt05_mpn	db 'st05.mpn',0
aSt06_bft	db 'st06.bft',0
aBss6_cd2	db 'BSS6.CD2',0
aSt06_mpn	db 'st06.mpn',0
include th04/pause[data].asm
aDemo0_rec	db 'DEMO0.REC',0
aOp_0		db 'op',0
aGensoems	db 'GENSOEMS',0
aBb0_cdg_0	db 'BB0.CDG',0
aKao0_cd2	db 'KAO0.cd2',0
aKao1_cd2	db 'KAO1.cd2',0
		db    0
include libs/master.lib/atan8[data].asm
include libs/master.lib/atrtcmod[data].asm
include libs/master.lib/bfnt_id[data].asm
include libs/master.lib/clip[data].asm
include libs/master.lib/edges[data].asm
include libs/master.lib/fil[data].asm
include libs/master.lib/dos_ropen[data].asm
include libs/master.lib/get_machine_98[data].asm
include libs/master.lib/get_machine_at[data].asm
include libs/master.lib/gaiji_backup[data].asm
include libs/master.lib/gaiji_entry_bfnt[data].asm
include libs/master.lib/grp[data].asm
include libs/master.lib/js[data].asm
include libs/master.lib/machine[data].asm
include libs/master.lib/pal[data].asm
include libs/master.lib/pf[data].asm
include libs/master.lib/rand[data].asm
include libs/master.lib/sin7[data].asm
include libs/master.lib/sin8[data].asm
include libs/master.lib/tx[data].asm
include libs/master.lib/vs[data].asm
include libs/master.lib/wordmask[data].asm
include libs/master.lib/mem[data].asm
include libs/master.lib/super_entry_bfnt[data].asm
include libs/master.lib/superpa[data].asm
include th02/formats/pfopen[data].asm
byte_21AF2	db 1
		db 0
include libs/master.lib/bgm_timerhook[data].asm
include libs/master.lib/bgm[data].asm
include th04/snd/se_priority[data].asm
include th04/snd/snd[data].asm
		db    0
include th04/snd/load[data].asm
include th03/snd/se_state[data].asm
include th03/formats/cdg[data].asm
include th04/formats/std[data].asm
; char aMaine[]
aMaine		db 'maine',0
; char aMaine_0[]
aMaine_0	db 'maine',0
; char aMaine_1[]
aMaine_1	db 'maine',0
		dw 0
		db  40h
		db    1
		db  80h
		db    2
		db 0C0h
		db    3
		db    0
		db    5
		db  40h
		db    6
		db  80h
		db    7
		db 0C0h
		db    8
		db    0
		db  0Ah
		db  40h
		db  0Bh
		db  80h
		db  0Ch
		db 0C0h
		db  0Dh
		db    0
		db  0Fh
		db  40h
		db  10h
		db  80h
		db  11h
		db 0C0h
		db  12h
		db    0
		db  14h
		db  40h
		db  15h
		db  80h
		db  16h
		db 0C0h
		db  17h
		db    0
		db  19h
		db  40h
		db  1Ah
		db  80h
		db  1Bh
		db 0C0h
		db  1Ch
		db    0
		db  1Eh
		db  40h
		db  1Fh
		db  80h
		db  20h
		db 0C0h
		db  21h	; !
		db    0
		db  23h	; #
		db  40h
		db  24h	; $
		db  80h
		db  25h	; %
		db 0C0h
		db  26h	; &
off_21CBA	dd aSt00_map
					; "ST00.MAP"
aSt00_map	db 'ST00.MAP',0
		db 0
byte_21CC8	db 0
		db 0
; 0
NUMERALS	db    0,   0, 38h,   0,	44h,   0, 82h,	 0, 82h,   0, 82h,   0,	44h,   0, 38h,	 0
		db    0,   0, 1Ch,   0,	22h,   0, 41h,	 0, 41h,   0, 41h,   0,	22h,   0, 1Ch,	 0
		db    0,   0, 0Eh,   0,	11h,   0, 20h, 80h, 20h, 80h, 20h, 80h,	11h,   0, 0Eh,	 0
		db    0,   0,	7,   0,	  8, 80h, 10h, 40h, 10h, 40h, 10h, 40h,	  8, 80h,   7,	 0
		db    0,   0,	3, 80h,	  4, 40h,   8, 20h,   8, 20h,	8, 20h,	  4, 40h,   3, 80h
		db    0,   0,	1,0C0h,	  2, 20h,   4, 10h,   4, 10h,	4, 10h,	  2, 20h,   1,0C0h
		db    0,   0,	0,0E0h,	  1, 10h,   2,	 8,   2,   8,	2,   8,	  1, 10h,   0,0E0h
		db    0,   0,	0, 70h,	  0, 88h,   1,	 4,   1,   4,	1,   4,	  0, 88h,   0, 70h
; 1
		db    0,   0,	0,   0,	  0,   0,   6,	 0, 7Eh,   0,	0,   0,	  0,   0,   0,	 0
		db    0,   0,	0,   0,	  0,   0,   3,	 0, 3Fh,   0,	0,   0,	  0,   0,   0,	 0
		db    0,   0,	0,   0,	  0,   0,   1, 80h, 1Fh, 80h,	0,   0,	  0,   0,   0,	 0
		db    0,   0,	0,   0,	  0,   0,   0,0C0h, 0Fh,0C0h,	0,   0,	  0,   0,   0,	 0
		db    0,   0,	0,   0,	  0,   0,   0, 60h,   7,0E0h,	0,   0,	  0,   0,   0,	 0
		db    0,   0,	0,   0,	  0,   0,   0, 30h,   3,0F0h,	0,   0,	  0,   0,   0,	 0
		db    0,   0,	0,   0,	  0,   0,   0, 18h,   1,0F8h,	0,   0,	  0,   0,   0,	 0
		db    0,   0,	0,   0,	  0,   0,   0, 0Ch,   0,0FCh,	0,   0,	  0,   0,   0,	 0
; 2
		db    0,   0, 0Ch,   0,	3Ch,   0,   0,	 0,   0,   0,	6,   0,	7Eh,   0,   0,	 0
		db    0,   0,	6,   0,	1Eh,   0,   0,	 0,   0,   0,	3,   0,	3Fh,   0,   0,	 0
		db    0,   0,	3,   0,	0Fh,   0,   0,	 0,   0,   0,	1, 80h,	1Fh, 80h,   0,	 0
		db    0,   0,	1, 80h,	  7, 80h,   0,	 0,   0,   0,	0,0C0h,	0Fh,0C0h,   0,	 0
		db    0,   0,	0,0C0h,	  3,0C0h,   0,	 0,   0,   0,	0, 60h,	  7,0E0h,   0,	 0
		db    0,   0,	0, 60h,	  1,0E0h,   0,	 0,   0,   0,	0, 30h,	  3,0F0h,   0,	 0
		db    0,   0,	0, 30h,	  0,0F0h,   0,	 0,   0,   0,	0, 18h,	  1,0F8h,   0,	 0
		db    0,   0,	0, 18h,	  0, 78h,   0,	 0,   0,   0,	0, 0Ch,	  0,0FCh,   0,	 0
; 3
		db    6,   0, 7Eh,   0,	  0,   0,   6,	 0, 3Ch,   0,	0,   0,	  3,   0,0FFh,	 0
		db    3,   0, 3Fh,   0,	  0,   0,   3,	 0, 1Eh,   0,	0,   0,	  1, 80h, 7Fh, 80h
		db    1, 80h, 1Fh, 80h,	  0,   0,   1, 80h, 0Fh,   0,	0,   0,	  0,0C0h, 3Fh,0C0h
		db    0,0C0h, 0Fh,0C0h,	  0,   0,   0,0C0h,   7, 80h,	0,   0,	  0, 60h, 1Fh,0E0h
		db    0, 60h,	7,0E0h,	  0,   0,   0, 60h,   3,0C0h,	0,   0,	  0, 30h, 0Fh,0F0h
		db    0, 30h,	3,0F0h,	  0,   0,   0, 30h,   1,0E0h,	0,   0,	  0, 18h,   7,0F8h
		db    0, 18h,	1,0F8h,	  0,   0,   0, 18h,   0,0F0h,	0,   0,	  0, 0Ch,   3,0FCh
		db    0, 0Ch,	0,0FCh,	  0,   0,   0, 0Ch,   0, 78h,	0,   0,	  0,   6,   1,0FEh
; 4
		db    0,   0, 7Eh,   0,	5Ah,   0, 7Eh,	 0, 42h,   0, 42h,   0,	7Eh,   0,   0,	 0
		db    0,   0, 3Fh,   0,	2Dh,   0, 3Fh,	 0, 21h,   0, 21h,   0,	3Fh,   0,   0,	 0
		db    0,   0, 1Fh, 80h,	16h, 80h, 1Fh, 80h, 10h, 80h, 10h, 80h,	1Fh, 80h,   0,	 0
		db    0,   0, 0Fh,0C0h,	0Bh, 40h, 0Fh,0C0h,   8, 40h,	8, 40h,	0Fh,0C0h,   0,	 0
		db    0,   0,	7,0E0h,	  5,0A0h,   7,0E0h,   4, 20h,	4, 20h,	  7,0E0h,   0,	 0
		db    0,   0,	3,0F0h,	  2,0D0h,   3,0F0h,   2, 10h,	2, 10h,	  3,0F0h,   0,	 0
		db    0,   0,	1,0F8h,	  1, 68h,   1,0F8h,   1,   8,	1,   8,	  1,0F8h,   0,	 0
		db    0,   0,	0,0FCh,	  0,0B4h,   0,0FCh,   0, 84h,	0, 84h,	  0,0FCh,   0,	 0
; 5
		db    0,   0, 7Eh,   0,	  8,   0, 10h,	 0, 7Ch,   0, 24h,   0,	44h,   0,0FFh,	 0
		db    0,   0, 3Fh,   0,	  4,   0,   8,	 0, 3Eh,   0, 12h,   0,	22h,   0, 7Fh, 80h
		db    0,   0, 1Fh, 80h,	  2,   0,   4,	 0, 1Fh,   0,	9,   0,	11h,   0, 3Fh,0C0h
		db    0,   0, 0Fh,0C0h,	  1,   0,   2,	 0, 0Fh, 80h,	4, 80h,	  8, 80h, 1Fh,0E0h
		db    0,   0,	7,0E0h,	  0, 80h,   1,	 0,   7,0C0h,	2, 40h,	  4, 40h, 0Fh,0F0h
		db    0,   0,	3,0F0h,	  0, 40h,   0, 80h,   3,0E0h,	1, 20h,	  2, 20h,   7,0F8h
		db    0,   0,	1,0F8h,	  0, 20h,   0, 40h,   1,0F0h,	0, 90h,	  1, 10h,   3,0FCh
		db    0,   0,	0,0FCh,	  0, 10h,   0, 20h,   0,0F8h,	0, 48h,	  0, 88h,   1,0FEh
; 6
		db    0,   0, 18h,   0,	7Eh,   0,   0,	 0,   0,   0, 24h,   0,	42h,   0,   0,	 0
		db    0,   0, 0Ch,   0,	3Fh,   0,   0,	 0,   0,   0, 12h,   0,	21h,   0,   0,	 0
		db    0,   0,	6,   0,	1Fh, 80h,   0,	 0,   0,   0,	9,   0,	10h, 80h,   0,	 0
		db    0,   0,	3,   0,	0Fh,0C0h,   0,	 0,   0,   0,	4, 80h,	  8, 40h,   0,	 0
		db    0,   0,	1, 80h,	  7,0E0h,   0,	 0,   0,   0,	2, 40h,	  4, 20h,   0,	 0
		db    0,   0,	0,0C0h,	  3,0F0h,   0,	 0,   0,   0,	1, 20h,	  2, 10h,   0,	 0
		db    0,   0,	0, 60h,	  1,0F8h,   0,	 0,   0,   0,	0, 90h,	  1,   8,   0,	 0
		db    0,   0,	0, 30h,	  0,0FCh,   0,	 0,   0,   0,	0, 48h,	  0, 84h,   0,	 0
; 7
		db    0,   0, 20h,   0,	7Eh,   0, 20h,	 0, 20h,   0, 3Ch,   0,	  0,   0,   0,	 0
		db    0,   0, 10h,   0,	3Fh,   0, 10h,	 0, 10h,   0, 1Eh,   0,	  0,   0,   0,	 0
		db    0,   0,	8,   0,	1Fh, 80h,   8,	 0,   8,   0, 0Fh,   0,	  0,   0,   0,	 0
		db    0,   0,	4,   0,	0Fh,0C0h,   4,	 0,   4,   0,	7, 80h,	  0,   0,   0,	 0
		db    0,   0,	2,   0,	  7,0E0h,   2,	 0,   2,   0,	3,0C0h,	  0,   0,   0,	 0
		db    0,   0,	1,   0,	  3,0F0h,   1,	 0,   1,   0,	1,0E0h,	  0,   0,   0,	 0
		db    0,   0,	0, 80h,	  1,0F8h,   0, 80h,   0, 80h,	0,0F0h,	  0,   0,   0,	 0
		db    0,   0,	0, 40h,	  0,0FCh,   0, 40h,   0, 40h,	0, 78h,	  0,   0,   0,	 0
; 8
		db    0,   0,	4,   0,	24h,   0, 22h,	 0, 42h,   0, 41h,   0,	  0,   0,   0,	 0
		db    0,   0,	2,   0,	12h,   0, 11h,	 0, 21h,   0, 20h, 80h,	  0,   0,   0,	 0
		db    0,   0,	1,   0,	  9,   0,   8, 80h, 10h, 80h, 10h, 40h,	  0,   0,   0,	 0
		db    0,   0,	0, 80h,	  4, 80h,   4, 40h,   8, 40h,	8, 20h,	  0,   0,   0,	 0
		db    0,   0,	0, 40h,	  2, 40h,   2, 20h,   4, 20h,	4, 10h,	  0,   0,   0,	 0
		db    0,   0,	0, 20h,	  1, 20h,   1, 10h,   2, 10h,	2,   8,	  0,   0,   0,	 0
		db    0,   0,	0, 10h,	  0, 90h,   0, 88h,   1,   8,	1,   4,	  0,   0,   0,	 0
		db    0,   0,	0,   8,	  0, 48h,   0, 44h,   0, 84h,	0, 82h,	  0,   0,   0,	 0
; 9
		db    0,   0, 10h,   0,	3Eh,   0, 24h,	 0, 26h,   0, 4Ah,   0,	8Eh,   0,   0,	 0
		db    0,   0,	8,   0,	1Fh,   0, 12h,	 0, 13h,   0, 25h,   0,	47h,   0,   0,	 0
		db    0,   0,	4,   0,	0Fh, 80h,   9,	 0,   9, 80h, 12h, 80h,	23h, 80h,   0,	 0
		db    0,   0,	2,   0,	  7,0C0h,   4, 80h,   4,0C0h,	9, 40h,	11h,0C0h,   0,	 0
		db    0,   0,	1,   0,	  3,0E0h,   2, 40h,   2, 60h,	4,0A0h,	  8,0E0h,   0,	 0
		db    0,   0,	0, 80h,	  1,0F0h,   1, 20h,   1, 30h,	2, 50h,	  4, 70h,   0,	 0
		db    0,   0,	0, 40h,	  0,0F8h,   0, 90h,   0, 98h,	1, 28h,	  2, 38h,   0,	 0
		db    0,   0,	0, 20h,	  0, 7Ch,   0, 48h,   0, 4Ch,	0, 94h,	  1, 1Ch,   0,	 0
; x
		db  81h,   0, 42h,   0,	24h,   0, 18h,	 0, 18h,   0, 24h,   0,	42h,   0, 81h,	 0
		db  40h, 80h, 21h,   0,	12h,   0, 0Ch,	 0, 0Ch,   0, 12h,   0,	21h,   0, 40h, 80h
		db  20h, 40h, 10h, 80h,	  9,   0,   6,	 0,   6,   0,	9,   0,	10h, 80h, 20h, 40h
		db  10h, 20h,	8, 40h,	  4, 80h,   3,	 0,   3,   0,	4, 80h,	  8, 40h, 10h, 20h
		db    8, 10h,	4, 20h,	  2, 40h,   1, 80h,   1, 80h,	2, 40h,	  4, 20h,   8, 10h
		db    4,   8,	2, 10h,	  1, 20h,   0,0C0h,   0,0C0h,	1, 20h,	  2, 10h,   4,	 8
		db    2,   4,	1,   8,	  0, 90h,   0, 60h,   0, 60h,	0, 90h,	  1,   8,   2,	 4
		db    1,   2,	0, 84h,	  0, 48h,   0, 30h,   0, 30h,	0, 48h,	  0, 84h,   1,	 2
; 2 (multiplier)
		db  3Ch,   0, 46h,   0,	46h,   0,   6,	 0, 3Ch,   0, 60h,   0,0C1h,   0,0FFh,	 0
		db  1Eh,   0, 23h,   0,	23h,   0,   3,	 0, 1Eh,   0, 30h,   0,	60h, 80h, 7Fh, 80h
		db  0Fh,   0, 11h, 80h,	11h, 80h,   1, 80h, 0Fh,   0, 18h,   0,	30h, 40h, 3Fh,0C0h
		db    7, 80h,	8,0C0h,	  8,0C0h,   0,0C0h,   7, 80h, 0Ch,   0,	18h, 20h, 1Fh,0E0h
		db    3,0C0h,	4, 60h,	  4, 60h,   0, 60h,   3,0C0h,	6,   0,	0Ch, 10h, 0Fh,0F0h
		db    1,0E0h,	2, 30h,	  2, 30h,   0, 30h,   1,0E0h,	3,   0,	  6,   8,   7,0F8h
		db    0,0F0h,	1, 18h,	  1, 18h,   0, 18h,   0,0F0h,	1, 80h,	  3,   4,   3,0FCh
		db    0, 78h,	0, 8Ch,	  0, 8Ch,   0, 0Ch,   0, 78h,	0,0C0h,	  1, 82h,   1,0FEh

		db  18h
		db  3Ch	; <
		db  7Eh	; ~
		db 0BDh
		db 0FFh
		db    0
include th02/sprites/sparks.asm
include th04/player/shot_velocity[data].asm
		db  18h
		db  68h	; h
		db  98h
		db 0E8h
		db    0
		db  60h
		db 0A0h
		db  40h
		db 0E0h
		db  80h
		db  20h
		db  60h
		db  3Ch	; <
		db    0
		db  7Eh	; ~
		db    0
		db 0FFh
		db    0
		db 0FFh
		db    0
		db 0FFh
		db    0
		db 0FFh
		db    0
		db  7Eh	; ~
		db    0
		db  3Ch	; <
		db    0
		db  1Eh
		db    0
		db  3Fh	; ?
		db    0
		db  7Fh
		db  80h
		db  7Fh
		db  80h
		db  7Fh
		db  80h
		db  7Fh
		db  80h
		db  3Fh	; ?
		db    0
		db  1Eh
		db    0
		db  0Fh
		db    0
		db  1Fh
		db  80h
		db  3Fh	; ?
		db 0C0h
		db  3Fh	; ?
		db 0C0h
		db  3Fh	; ?
		db 0C0h
		db  3Fh	; ?
		db 0C0h
		db  1Fh
		db  80h
		db  0Fh
		db    0
		db    7
		db  80h
		db  0Fh
		db 0C0h
		db  1Fh
		db 0E0h
		db  1Fh
		db 0E0h
		db  1Fh
		db 0E0h
		db  1Fh
		db 0E0h
		db  0Fh
		db 0C0h
		db    7
		db  80h
		db    3
		db 0C0h
		db    7
		db 0E0h
		db  0Fh
		db 0F0h
		db  0Fh
		db 0F0h
		db  0Fh
		db 0F0h
		db  0Fh
		db 0F0h
		db    7
		db 0E0h
		db    3
		db 0C0h
		db    1
		db 0E0h
		db    3
		db 0F0h
		db    7
		db 0F8h
		db    7
		db 0F8h
		db    7
		db 0F8h
		db    7
		db 0F8h
		db    3
		db 0F0h
		db    1
		db 0E0h
		db    0
		db 0F0h
		db    1
		db 0F8h
		db    3
		db 0FCh
		db    3
		db 0FCh
		db    3
		db 0FCh
		db    3
		db 0FCh
		db    1
		db 0F8h
		db    0
		db 0F0h
		db    0
		db  78h	; x
		db    0
		db 0FCh
		db    1
		db 0FEh
		db    1
		db 0FEh
		db    1
		db 0FEh
		db    1
		db 0FEh
		db    0
		db 0FCh
		db    0
		db  78h	; x
		db    1
		db    0
		db  83h
		db    0
		db  7Eh	; ~
		db    0
		db  3Ch	; <
		db    0
		db    0
		db  80h
		db  41h	; A
		db  80h
		db  3Fh	; ?
		db    0
		db  1Eh
		db    0
		db    0
		db  40h
		db  20h
		db 0C0h
		db  1Fh
		db  80h
		db  0Fh
		db    0
		db    0
		db  20h
		db  10h
		db  60h
		db  0Fh
		db 0C0h
		db    7
		db  80h
		db    0
		db  10h
		db    8
		db  30h	; 0
		db    7
		db 0E0h
		db    3
		db 0C0h
		db    0
		db    8
		db    4
		db  18h
		db    3
		db 0F0h
		db    1
		db 0E0h
		db    0
		db    4
		db    2
		db  0Ch
		db    1
		db 0F8h
		db    0
		db 0F0h
		db    0
		db    2
		db    1
		db    6
		db    0
		db 0FCh
		db    0
		db  78h	; x
byte_22B9C	db 0
		db 0
byte_22B9E	db 1
		db 0
include th04/frames[data].asm
off_22BAA	dd a_dm00_txt
					; "_DM00.TXT"
off_22BAE	dd a_dm04b_txt
					; "_DM04B.txt"
include th04/formats/dialog[data].asm
byte_22BCA	db 0
a_dm00_txt	db '_DM00.TXT',0
a_dm04b_txt	db '_DM04B.txt',0
		db '  ',0
aKao0_cd2_0	db 'KAO0.cd2',0
aKao1_cd2_0	db 'KAO1.cd2',0
aBss7_cd2	db 'bss7.cd2',0
aBss8_cd2	db 'bss8.cd2',0
aBb0_cdg	db 'bb0.cdg',0
aBb1_cdg	db 'bb1.cdg',0
		db    0
include th04/boss/explosions_big[data].asm
byte_22C1A	db 0
		db    0
include th04/strings/gameover[data].asm
asc_22C3F	db '  ',0
asc_22C42	db '  ',0
; char aMaine_2[]
aMaine_2	db 'maine',0
		db    0
		db 'H',0
		db 'H',0
		db 'H',0
aJsh		db 'JsH',0
aJsh_0		db 'JsH',0
		db 'H',0
		db 'H',0
		db 'H',0
		db 'H',0
		db 'H',0
		db 'H',0
		db 'H',0
		db 'H',0
		db 'H',0
		db 'H',0
		db 'H',0
aJxh		db 'JxH',0
aJxh_0		db 'JxH',0
		db 'H',0
		db 'H',0
aJ7j2jL		db 'J7J2J-L',0
aJL		db 'J-L',0
		db  4Ah	; J
		db  2Dh	; -
		db  4Ah	; J
		db  2Dh	; -
		db  4Ah	; J
		db  2Dh	; -
		db  4Ah	; J
		db  2Dh	; -
		db  4Ah	; J
		db  2Dh	; -
		db  4Ah	; J
		db  2Dh	; -
		db  4Ah	; J
		db  2Dh	; -
		db  4Ah	; J
		db  2Dh	; -
		db  4Ah	; J
		db  2Dh	; -
		db  4Ah	; J
		db  2Dh	; -
		db  4Ah	; J
		db  2Dh	; -
		db  4Ah	; J
		db  2Dh	; -
		db  4Ch	; L
		db    5
		db  4Ah	; J
		db  2Dh	; -
		db  4Ch	; L
		db    5
		db  4Ah	; J
		db  2Dh	; -
		db  4Ah	; J
		db  32h	; 2
		db  4Ah	; J
		db  37h	; 7
		db  4Ah	; J
		db  46h	; F
		db  4Ah	; J
		db  41h	; A
		db  4Ah	; J
		db  3Ch	; <
		db  4Ch	; L
		db  0Ah
		db  4Ah	; J
		db  3Ch	; <
		db  4Ch	; L
		db  0Ah
		db  4Ah	; J
		db  3Ch	; <
		db  4Ah	; J
		db  3Ch	; <
		db  4Ah	; J
		db  3Ch	; <
		db  4Ah	; J
		db  3Ch	; <
		db  4Ah	; J
		db  3Ch	; <
		db  4Ah	; J
		db  3Ch	; <
		db  4Ah	; J
		db  3Ch	; <
		db  4Ah	; J
		db  3Ch	; <
		db  4Ah	; J
		db  3Ch	; <
		db  4Ah	; J
		db  3Ch	; <
		db  4Ah	; J
		db  3Ch	; <
		db  4Ah	; J
		db  3Ch	; <
		db  4Ch	; L
		db  0Fh
		db  4Ah	; J
		db  3Ch	; <
		db  4Ch	; L
		db  0Fh
		db  4Ah	; J
		db  3Ch	; <
		db  4Ah	; J
		db  41h	; A
		db  4Ah	; J
		db  46h	; F
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    1
		db    1
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    1
		db    1
		db    0
		db    0
		db    1
		db    1
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    1
		db    1
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    1
		db    1
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    1
		db    1
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    1
		db    1
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    2
		db    0
		db    1
		db    1
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    1
		db    1
		db    2
		db    2
		db    2
		db    2
		db    1
		db    1
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    1
		db    1
		db    2
		db    1
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    1
word_22D9C	dw 0
unk_22D9E	db 0DCh
		db    0
		db  90h
		db    1
		db  18h
		db    1
		db 0C2h
		db    1
include th04/score[data].asm
include th04/strings/hud[data].asm
include th04/hud/bar_colors[data].asm
word_22E07	dw 202h
word_22E09	dw 202h
word_22E0B	dw 202h
word_22E0D	dw 202h
byte_22E0F	db 0
word_22E10	dw 6141h
word_22E12	dw 0C1A1h
byte_22E14	db 0E1h
include th04/hud/bar_put[data].asm
aB@b@bB@b@	db '@@~@@',0
aB@b@bB@b@_0	db '@@~@@',0
include th04/formats/bb_playchar[data].asm
SHOT_FUNCS_REIMU_A label word
	dw shot_reimu_l0
	dw shot_reimu_l1
	dw shot_reimu_a_l2
	dw shot_reimu_a_l3
	dw shot_reimu_a_l4
	dw shot_reimu_a_l5
	dw shot_reimu_a_l6
	dw shot_reimu_a_l7
	dw shot_reimu_a_l8
	dw shot_reimu_a_l9
SHOT_FUNCS_REIMU_B label word
	dw shot_reimu_l0
	dw shot_reimu_l1
	dw shot_reimu_b_l2
	dw shot_reimu_b_l3
	dw shot_reimu_b_l4
	dw shot_reimu_b_l5
	dw shot_reimu_b_l6
	dw shot_reimu_b_l7
	dw shot_reimu_b_l8
	dw shot_reimu_b_l9
SHOT_FUNCS_MARISA_A label word
	dw shot_marisa_l0
	dw shot_marisa_l1
	dw shot_marisa_a_l2
	dw shot_marisa_a_l3
	dw shot_marisa_a_l4
	dw shot_marisa_a_l5
	dw shot_marisa_a_l6
	dw shot_marisa_a_l7
	dw shot_marisa_a_l8
	dw shot_marisa_a_l9
SHOT_FUNCS_MARISA_B label word
	dw shot_marisa_l0
	dw shot_marisa_l1
	dw shot_marisa_b_l2
	dw shot_marisa_b_l3
	dw shot_marisa_b_l4
	dw shot_marisa_b_l5
	dw shot_marisa_b_l6
	dw shot_marisa_b_l7
	dw shot_marisa_b_l8
	dw shot_marisa_b_l9
byte_22E9C	db 0
		db    0
_enemies_gone	dw 0
_enemies_killed	dw 0
byte_22EA2	db 0
byte_22EA3	db 0
public _popup_frame
_popup_frame	db 0
		db    0
include th04/formats/bb_txt[data].asm
include th04/hud/popup[data].asm
byte_22EF6	db 0
		db 0
public _PLAYFIELD_BLANK_ROW
_PLAYFIELD_BLANK_ROW	dd aPLAYFIELD_BLANK_ROW
STAGE_TITLE		dd aMCB@bPhantomLa	; "@` Phantom Land "
		dd aMCsb@bPhantomN	; "@` Phantom Night"
		dd aMKib@bLakeOfBl	; "@` Lake of Blood"
		dd aCChb@bDarkness	; "H@` Darkness "
		dd aCMB@bDreamOfFr	; "@` Dream of Frail Girl"
		dd aMSzb@bPhantasm	; "z@` Phantasmagoria "
		dd aTMvb@bRaspberr	; "@` Raspberry Trap "
		dd aVVVcvVvmnvRViv	; "N@` Puckish "...
BGM_TITLE		dd aWitchingDream	; "Witching Dream"
		dd aSeleneSLight	; "Selene's light"
		dd aSxp			; "@` Decoration Battle"
		dd aBreakTheSabbat	; "Break the Sabbath"
		dd aNglLB@bScarlet	; "g@` Scarlet Phoneme"
		dd aBadApple		; "BAD Apple!!"
		dd aCRab@bPerditio	; "@` Perdition crisis "
		dd aGagkgxgGggxgeg	; "AX}GXe"
		dd aRpvKab@bCasket	; "@` Casket of	Star "
		dd aLotusLove		; "Lotus Love"
		dd aCVVslXB@bSleep	; "|@` Sleeping Terror"
		dd aDreamLand		; "Dream Land"
		dd aChcB@bInanimat	; "H@` Inanimate Dream "
		dd aLVVVsv		; "VY	"
		dd aGbgcghmSzb@bIc	; "Chz@` Icemilk Magic	"
		dd aVivavvvvilcvb@	; "@` Innocence"
		dd aPnpcuyszlB@bCa	; "Yz@` Capriccio "
include th04/strings/demoplay[data].asm
aPLAYFIELD_BLANK_ROW	db '                                                ',0
aMCB@bPhantomLa	db '@` Phantom Land ',0
aMCsb@bPhantomN	db '@` Phantom Night',0
aMKib@bLakeOfBl	db '@` Lake of Blood',0
aCChb@bDarkness	db 'H@` Darkness ',0
aCMB@bDreamOfFr	db '@` Dream of Frail Girl',0
aMSzb@bPhantasm	db 'z@` Phantasmagoria ',0
aTMvb@bRaspberr	db '@` Raspberry Trap ',0
aVVVcvVvmnvRViv	db 'N@` Puckish Angel',0
aWitchingDream	db 'Witching Dream',0
aSeleneSLight	db 'Selene',27h,'s light',0
aSxp		db '@` Decoration Battle',0
aBreakTheSabbat	db 'Break the Sabbath',0
aNglLB@bScarlet	db 'g@` Scarlet Phoneme',0
aBadApple	db 'BAD Apple!!',0
aCRab@bPerditio	db '@` Perdition crisis ',0
aGagkgxgGggxgeg	db 'AX}GXe',0
aRpvKab@bCasket	db '@` Casket of Star ',0
aLotusLove	db 'Lotus Love',0
aCVVslXB@bSleep	db '|@` Sleeping Terror',0
aDreamLand	db 'Dream Land',0
aChcB@bInanimat	db 'H@` Inanimate Dream ',0
aLVVVsv		db 'VY ',0
aGbgcghmSzb@bIc	db 'Chz@` Icemilk Magic ',0
aVivavvvvilcvb@	db '@` Innocence',0
aPnpcuyszlB@bCa	db 'Yz@` Capriccio ',0
include th04/formats/bb_txt_load[data].asm
word_231F2	dw 10h
include th03/5_powers_of_10[data].asm
include th04/scoreupd[data].asm
include th04/hud/gaiji_row[data].asm
word_23210	dw 0
byte_23212	db 0
		db    0
		db  60h
		db    0
		db  70h	; p
		db 0E0h
		db  80h
		db  20h
		db  70h	; p
		db  90h
		db 0F0h
		db  10h
include th04/player/shot_levels[data].asm
include th04/formats/cfg_lres[data].asm
		db    0
word_2323A	dw 0AF30h
word_2323C	dw 4B0h
word_2323E	dw 9B0h
word_23240	dw 204h
byte_23242	db 0
		db    0
gCONTINUE	db 0ACh, 0B8h, 0B7h, 0BDh, 0B2h, 0B7h, 0BEh, 0AEh
aGensou_scr	db 'GENSOU.SCR',0
aGensou_scr_0	db 'GENSOU.SCR',0
aGensou_scr_1	db 'GENSOU.SCR',0
aGensou_scr_2	db 'GENSOU.SCR',0
byte_23278	db 0
		db 0
		dd aBOSS_FINAL_TIMEOUT
		dd aPENALTY_6
		dd aPENALTY_5
		dd aPENALTY_4
		dd aPENALTY_CONT_1
		dd aPENALTY_CONT_2
		dd aPENALTY_CONT_3
		dd aBONUS_EASY
		dd aBONUS_NORMAL
		dd aBONUS_HARD
		dd aBONUS_LUNATIC
; char gpCLEAR_BONUS[3]
gpCLEAR_BONUS	db 4Dh,	4Eh, 4Fh, 2, 58h, 59h, 5Ah, 5Bh, 0
; char gpCONGRATULATION[]
gpCONGRATULATION db 5Ch, 5Dh, 5Eh, 5Fh, 60h, 61h, 62h, 63h, 64h, 0
aBOSS_FINAL_TIMEOUT	db '{XsII@@@@@@@~@ODO',0
aPENALTY_6	db 'vC[yieBiUlj~@ODR',0
aPENALTY_5	db 'vC[yieBiTlj~@ODT',0
aPENALTY_4	db 'vC[yieBiSlj~@ODV',0
aPENALTY_CONT_1	db 'ReBj[yieBiPj@~@ODW',0
aPENALTY_CONT_2	db 'ReBj[yieBiQj@~@ODU',0
aPENALTY_CONT_3	db 'ReBj[yieBiRj@~@ODS',0
aBONUS_EASY	db 'x{[iXidj@@@@~@ODT',0
aBONUS_NORMAL	db 'x{[iXimj@@~@PDO',0
aBONUS_HARD	db 'x{[iXigj@@@@~@PDQ',0
aBONUS_LUNATIC	db 'x{[iXikj@~@PDS',0
aBONUS_STAGE	db 'rs`fd@a',0
aPOWERX50	db 'onvdq@~@@TO',0
aBONUS_DREAM	db 'cqd`l@a',0
aGRAZEX50	db 'JXe@~@@TO',0
aBONUS_POINT	db 'onhms@a@@@@@@~',0
aBONUS_TOTAL	db '@@@sns`k',0
aBOMB_EXTEND	db '@@@@@a@dII',0
aALL_CLEAR	db '`kk@b@@',0
aPOWERX50_2	db 'onvdq@~@@TO',0
aBONUS_DREAM_2	db 'cqd`l@a',0
aGRAZEX50_2	db 'JXe@~@@TO',0
aPLAYER_REM_10000	db 'cl@~POOOO',0
aPLAYER_REM_30000	db 'cl@~ROOOO',0
aBONUS_POINT_2	db 'onhms@a@@@@@@~',0
aBONUS_TOTAL_2	db '@@@sns`k',0
		db    0
include th04/item/enemy_drops[data].asm
byte_23660	db 0
byte_23661	db 0
include th04/item/type_patnum[data].asm
include th02/power_overflow[data].asm
include th04/dream_score[data].asm
_power_overflow_level	dw 0
include th04/item/collect[data].asm
byte_236E0	db 0
		db 0
include th04/item/miss_add[data].asm
		db    0
		db    0
		db    3
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    1
		db    1
		db    1
		db    1
		db    1
include th04/boss/phase_timed_out[data].asm
aSt00_bmt	db 'st00.bmt',0
aSt00bk_cdg	db 'st00bk.cdg',0
aSt00_bb	db 'st00.bb',0
aSt01_bmt	db 'st01.bmt',0
aSt01bk_cdg	db 'st01bk.cdg',0
aSt01_bb	db 'st01.bb',0
aSt02_bmt	db 'st02.bmt',0
aSt02bk_cdg	db 'st02bk.cdg',0
aSt02_bb	db 'st02.bb',0
aSt03_bmt	db 'st03.bmt',0
aSt03bk_cdg	db 'st03bk.cdg',0
aSt03bk2_cdg	db 'st03bk2.cdg',0
aSt03_bb	db 'st03.bb',0
aSt04bk_cdg	db 'st04bk.cdg',0
aSt04_bb	db 'st04.bb',0
aSt04_cdg	db 'st04.cdg',0
aSt05_bb	db 'st05.bb',0
aSt06bk_cdg	db 'st06bk.cdg',0
aSt06_bb	db 'st06.bb',0
aSt06bk2_cdg	db 'st06bk2.cdg',0
aSt06b_bb	db 'st06b.bb',0
byte_237F6	db 0
byte_237F7	db 0
amp_237F8	db 0
	even

	.data?

; TODO: Missing clip[bss].asm (16 bytes) somewhere in there...
		dw ?
fp_23D90	dw ?
include th02/demo[bss].asm
		dd ?
		dd ?
		dd ?
		dd ?
include libs/master.lib/fil[bss].asm
include libs/master.lib/grcg_circle[bss].asm
include libs/master.lib/js[bss].asm
include libs/master.lib/pal[bss].asm
include libs/master.lib/vs[bss].asm
include libs/master.lib/vsync[bss].asm
include libs/master.lib/mem[bss].asm
include libs/master.lib/superpa[bss].asm
include th01/hardware/vram_planes[bss].asm
include libs/master.lib/pfint21[bss].asm
include th03/formats/hfliplut[bss].asm
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
		dd ?
include th04/snd/interrupt[bss].asm
include libs/master.lib/bgm[bss].asm
include libs/master.lib/super_wave_put[bss].asm
include th02/snd/load[bss].asm
include th04/mem[bss].asm
include th04/hardware/input[bss].asm
include th04/formats/cdg[bss].asm
include th04/formats/std[bss].asm
byte_250FE	db ?
		db ?
word_25100	dw ?
_invalidate_left_x_tile	dw ?
byte_25104	db ?
word_25105	dw ?
word_25107	dw ?
word_25109	dw ?
		db    ?	;
include th02/math/randring[bss].asm
byte_2520E	db ?
byte_2520F	db ?
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		db    ?	;
		db    ?	;
word_25532	dw ?
include th04/sparks_add[bss].asm
include th04/item/splashes[bss].asm
include th04/circles_color[bss].asm
byte_25594	db ?
		db ?
word_25596	dw ?
byte_25598	db ?
byte_25599	db ?
byte_2559A	db ?
		db ?
		dd    ?	;
include th04/tiles_invalidate[bss].asm
_boss_bg_render	dw ?
fp_255AA	dw ?
fp_255AC	dw ?
		dw ?
byte_255B0	db ?
		db ?
byte_255B2	db ?
byte_255B3	db ?
byte_255B4	db ?
		db ?
include th04/scroll[bss].asm
word_255BE	dw ?
word_255C0	dw ?
word_255C2	dw ?
		db    ?	;
		db    ?	;
byte_255C6	db ?
byte_255C7	db ?
byte_255C8	db ?
		db ?
fp_255CA	dw ?
dword_255CC	dd ?
word_255D0	dw ?
word_255D2	dw ?
word_255D4	dw ?
word_255D6	dw ?
include th04/boss/explosions[bss].asm
word_25608	dw ?
byte_2560A	db ?
		db ?
dword_2560C	dd ?
dword_25610	dd ?
		dd ?
byte_25618	db ?
		db ?
point_2561A	Point <?>
		dd    ?	;
word_25622	dw ?
word_25624	dw ?
word_25626	dw ?
byte_25628	db ?
		db ?
word_2562A	dw ?
word_2562C	dw ?
word_2562E	dw ?
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
byte_25660	db ?
		db ?
word_25662	dw ?
byte_25664	db ?
byte_25665	db ?
byte_25666	db ?
byte_25667	db ?
byte_25668	db ?
		db ?
include th04/stage_funcs[bss].asm
byte_2566E	db ?
byte_2566F	db ?
byte_25670	db ?
byte_25671	db ?
byte_25672	db ?
byte_25673	db ?
byte_25674	db ?
		db ?
fp_25676	dw ?
word_25678	dw ?
		dw ?
		dw ?
		dw ?
word_25680	dw ?
		dw ?
		dw ?
		dw ?
_rank	db ?
include th04/score[bss].asm
byte_256A2	db ?
		db ?
include th04/player/shots_add[bss].asm
byte_256A8	db ?
byte_256A9	db ?
fp_256AA	dw ?
fp_256AC	dw ?
include th04/formats/bb_playchar[bss].asm
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		db    ?	;
		db    ?	;
byte_257D6	db ?
byte_257D7	db ?
byte_257D8	db ?
		db ?
playchar_shot_func	dw ?
playchar_shot_funcs	dw ?
dword_257DE	dd ?
word_257E2	dw ?
word_257E4	dw ?
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
word_2597E	dw ?
byte_25980	db ?
		db ?
include th04/homing_target[bss].asm
public _stage_vm
_stage_vm	dd ?
word_2598A	dw ?
word_2598C	dw ?
include th04/player/pos[bss].asm
word_2599A	dw ?
word_2599C	dw ?
word_2599E	dw ?
word_259A0	dw ?
public _player_invincibility_time, _power, _shot_level, _shot_time
_player_invincibility_time	db ?
byte_259A3	db ?
_power	db ?
_shot_level	db ?
_shot_time	db ?
include th01/player_is_hit[bss].asm
		db    ?	;
byte_259A9	db ?
public _MISS_TIME, _stage_point_items_collected, _dream_items_collected
_miss_time	db ?
_stage_point_items_collected	db ?
include th04/player/option[bss].asm
_dream_items_collected	db ?
		db    ?	;
		db    ?	;
public _MISS_EXPLOSION_ANGLE
_miss_explosion_angle	db ?
public _MISS_EXPLOSION_RADIUS
_miss_explosion_radius	dw ?
		dw ?
		dw ?
stage_title_len	dw ?
bgm_title_len	dw ?
stage_title_id	db ?
		db ?
word_259C6	dw ?
include th04/hud/popup[bss].asm
byte_259E6	db ?
		db ?
fp_259E8	dw ?
point_259EA	Point <?>
byte_259EE	db ?
byte_259EF	db ?
byte_259F0	db ?
byte_259F1	db ?
include th04/midboss/funcs[bss].asm
byte_25A02	db ?
byte_25A03	db ?
byte_25A04	db ?
		db ?
byte_25A06	db ?
byte_25A07	db ?
byte_25A08	db ?
		db ?
word_25A0A	dw ?
point_25A0C	Point <?>
		dd    ?	;
		dd    ?	;
		db    ?	;
		db    ?	;
		db    ?	;
byte_25A1B	db ?
		db    ?	;
		db    ?	;
byte_25A1E	db ?
		dd    ?	;
		db    ?	;
byte_25A24	db ?
		db ?
byte_25A26	db ?
byte_25A27	db ?
motion_25A28	motion_t <?>
word_25A34	dw ?
word_25A36	dw ?
byte_25A38	db ?
		db ?
word_25A3A	dw ?
include th02/hardware/pages[bss].asm
map_seg	dw ?
include th04/tiles[bss].asm
include th04/frames[bss].asm
word_266D0	dw ?
byte_266D2	db ?
include th03/hardware/palette_changed[bss].asm
stage_id	db ?
include th04/playperf[bss].asm
public _playchar
_playchar	db ?
		db ?
include th04/drawpoint[bss].asm
include th04/ems[bss].asm
_turbo_mode	db ?
		db ?
include th04/bullet/template[bss].asm
include th04/midboss/vars[bss].asm
include th04/boss/vars[bss].asm
include th04/sparks[bss].asm
include th04/bullet/bullets[bss].asm
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
byte_2A16E	db ?
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		db    ?	;
		db    ?	;
		db    ?	;
point_2A8C6	Point <?>
dword_2A8CA	dd ?
word_2A8CE	dw ?
word_2A8D0	dw ?
byte_2A8D2	db ?
byte_2A8D3	db ?
include th04/circles[bss].asm
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
include th04/item/items[bss].asm
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		db    ?	;
		db    ?	;
include th04/player/shots[bss].asm
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
public _resident
_resident	dd ?
byte_2CDCA	db ?
		db ?
include th04/boss/backdrop[bss].asm
word_2CDCE	dw ?
byte_2CDD0	db ?
byte_2CDD1	db ?
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		dd    ?	;
		db    ?	;
		db    ?	;
word_2CF28	dw ?
word_2CF2A	dw ?
fp_2CF2C	dw ?
include th04/formats/scoredat[bss].asm
byte_2CFF2	db ?
		db ?
word_2CFF4	dw ?
byte_2CFF6	db ?
byte_2CFF7	db ?
byte_2CFF8	db ?
include th04/bullet_clear[bss].asm
		db ?
public _stage_graze
_stage_graze	dw ?
score_2CFFE	dw ?
fp_2D000	dw ?
fp_2D002	dw ?
fp_2D004	dw ?
word_2D006	dw ?
angle_2D008	db ?
	evendata
byte_2D00A	db ?
		db ?
public _dream_score
_dream_score	dw ?
byte_2D00E	db ?
		db ?
include th04/boss/funcs[bss].asm
byte_2D01E	db ?
byte_2D01F	db ?
byte_2D020	db ?
byte_2D021	db ?
byte_2D022	db ?
byte_2D023	db ?
byte_2D024	db ?
		db ?
		db    ?	;
		db    ?	;
byte_2D028	db ?
		db    ?	;
		db    ?	;
byte_2D02B	db ?
byte_2D02C	db ?
byte_2D02D	db ?
include th04/formats/bb_stage[bss].asm
include th04/boss/hitbox[bss].asm
word_2D034	dw ?
word_2D036	dw ?
word_2D038	dw ?
byte_2D03A	db ?
byte_2D03B	db ?
byte_2D03C	db ?
		db    ?	;
		db    ?	;
word_2D03F	dw ?
		db ?
word_2D042	dw ?
dword_2D044	dd ?
		dd    ?	;
word_2D04C	dw ?
		dw ?
word_2D050	dw ?
		dd    ?	;
byte_2D056	db ?
byte_2D057	db ?
byte_2D058	db ?
		db ?
word_2D05A	dw ?

		end

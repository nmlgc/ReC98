;
; +-------------------------------------------------------------------------+
; |   This file has been generated by The Interactive Disassembler (IDA)    |
; |        Copyright (c) 2009 by Hex-Rays, <support@hex-rays.com>           |
; +-------------------------------------------------------------------------+
;
; Input	MD5   :	43EE91A800F1F0FE35A87149C90B037D

; File Name   :	th03/MAIN.EXE
; Format      :	MS-DOS executable (EXE)
; Base Address:	0h Range: 0h-26470h Loaded length: 1E6E2h
; Entry	Point :	0:0
; OS type	  :  MS	DOS
; Application type:  Executable	16bit

		.286 ; Force the .model directive to create 16-bit default segments...
		.model large
		.386 ; ... then switch to what we actually need.
		; And yes, we can't move this to an include file for some reason.

include ReC98.inc
include th03/th03.inc
include th03/main/playfld.inc
include th03/main/player/bomb.inc
include th03/sprite16.inc
include libs/sprite16/sprite16.inc

	extern _execl:proc
	.seq

; ===========================================================================

; Segment type:	Pure code
_TEXT		segment	word public 'CODE' use16
		assume cs:_TEXT
		assume es:nothing, ds:_DATA, fs:nothing, gs:nothing

include libs/master.lib/bfnt_entry_pat.asm
include libs/master.lib/bfnt_extend_header_skip.asm
include libs/master.lib/bfnt_header_read.asm
include libs/master.lib/bfnt_header_analysis.asm
include libs/master.lib/bcloser.asm
include libs/master.lib/bfill.asm
include libs/master.lib/bfnt_palette_set.asm
include libs/master.lib/bgetc.asm
include libs/master.lib/palette_black_out.asm
include libs/master.lib/bopenr.asm
include libs/master.lib/bread.asm
include libs/master.lib/bseek.asm
include libs/master.lib/bseek_.asm
include libs/master.lib/cutline.asm
include libs/master.lib/dos_keyclear.asm
include libs/master.lib/dos_setvect.asm
include libs/master.lib/egc.asm
include libs/master.lib/file_close.asm
include libs/master.lib/file_read.asm
include libs/master.lib/file_ropen.asm
include libs/master.lib/dos_close.asm
include libs/master.lib/dos_ropen.asm
include libs/master.lib/grcg_boxfill.asm
include libs/master.lib/grcg_circle.asm
include libs/master.lib/grcg_circle_x.asm
include libs/master.lib/grc_setclip.asm
include libs/master.lib/grcg_fill.asm
include libs/master.lib/grcg_hline.asm
include libs/master.lib/grcg_line.asm
include libs/master.lib/grcg_setcolor.asm
include libs/master.lib/grcg_settile_1line.asm
include libs/master.lib/grcg_triangle.asm
include libs/master.lib/grcg_vline.asm
include libs/master.lib/grcg_trapezoid.asm
include libs/master.lib/gaiji_backup.asm
include libs/master.lib/gaiji_entry_bfnt.asm
include libs/master.lib/gaiji_putca.asm
include libs/master.lib/gaiji_putsa.asm
include libs/master.lib/gaiji_read.asm
include libs/master.lib/gaiji_write.asm
include libs/master.lib/graph_200line.asm
include libs/master.lib/graph_400line.asm
include libs/master.lib/graph_clear.asm
include libs/master.lib/graph_copy_page.asm
include libs/master.lib/graph_extmode.asm
include libs/master.lib/graph_hide.asm
include libs/master.lib/graph_pi_free.asm
include libs/master.lib/graph_pi_load_pack.asm
include libs/master.lib/iatan2.asm
include libs/master.lib/js_end.asm
include libs/master.lib/make_linework.asm
include libs/master.lib/palette_show.asm
include libs/master.lib/pfclose.asm
include libs/master.lib/pfgetc.asm
include libs/master.lib/pfread.asm
include libs/master.lib/pfrewind.asm
include libs/master.lib/pfseek.asm
include libs/master.lib/random.asm
include libs/master.lib/smem_release.asm
include libs/master.lib/smem_wget.asm
include libs/master.lib/soundio.asm
include libs/master.lib/text_boxfilla.asm
include libs/master.lib/text_clear.asm
include libs/master.lib/text_fillca.asm
include libs/master.lib/text_puts.asm
include libs/master.lib/text_putsa.asm
include libs/master.lib/vsync.asm
include libs/master.lib/vsync_wait.asm
include libs/master.lib/hmem_lallocate.asm
include libs/master.lib/mem_assign_dos.asm
include libs/master.lib/mem_assign.asm
include libs/master.lib/memheap.asm
include libs/master.lib/mem_unassign.asm
include libs/master.lib/super_free.asm
include libs/master.lib/super_entry_pat.asm
include libs/master.lib/super_entry_at.asm
include libs/master.lib/super_entry_bfnt.asm
include libs/master.lib/super_cancel_pat.asm
include libs/master.lib/super_put.asm
include libs/master.lib/respal_exist.asm
include libs/master.lib/respal_get_palettes.asm
include libs/master.lib/pfint21.asm
		db 0
include libs/master.lib/js_start.asm
include libs/master.lib/js_sense.asm
		db 0
include th03/hardware/sprite16_copy.asm
include libs/master.lib/draw_trapezoid.asm
include th03/formats/pfopen.asm
include libs/master.lib/pf_str_ieq.asm
_TEXT		ends

; ===========================================================================

; Segment type:	Pure code
main_01_TEXT	segment	word public 'CODE' use16
		assume cs:main_01_TEXT
		;org 5
		assume es:nothing, ss:nothing, ds:_DATA, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

; int __cdecl main(int argc, const char	**argv,	const char **envp)
public _main
_main		proc far

_argc		= word ptr  6
_argv		= dword	ptr  8
_envp		= dword	ptr  0Ch

		push	bp
		mov	bp, sp
		push	si
		call	game_init_main pascal, ds, offset aCOul
		call	cfg_load_resident
		or	ax, ax
		jz	short @@ret
		mov	_snd_midi_active, 0
		les	bx, _resident
		cmp	es:[bx+resident_t.bgm_mode], SND_BGM_OFF
		jz	short loc_970F
		call	_snd_determine_mode

loc_970F:
		call	gaiji_backup
		push	ds
		push	offset aGameft_bft ; "GAMEFT.bft"
		call	gaiji_entry_bfnt
		call	sub_9B14
		call	farfp_20F20

loc_9724:
		mov	PaletteTone, 100
		call	far ptr	palette_show
		call	sub_9778
		mov	ah, 0
		mov	si, ax
		les	bx, _resident
		mov	eax, _round_frame
		mov	es:[bx+resident_t.rand], eax
		cmp	si, 1
		jnz	short loc_974D
		call	sub_A21F
		jmp	short loc_9724
; ---------------------------------------------------------------------------

loc_974D:
		call	sub_13DF9
		kajacall	KAJA_SONG_STOP
		or	si, si
		jnz	short loc_9764
		push	ds
		push	offset aOp	; "op"
		jmp	short loc_9770
; ---------------------------------------------------------------------------

loc_9764:
		les	bx, _resident
		inc	es:[bx+resident_t.story_stage]
		push	ds
		push	offset arg0	; "mainl"

loc_9770:
		nopcall	sub_B454

@@ret:
		pop	si
		pop	bp
		retf
_main		endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_9778	proc near
		push	bp
		mov	bp, sp
		jmp	loc_9AC9
; ---------------------------------------------------------------------------

loc_977E:
		call	sub_A438
		call	sub_1797F
		mov	_pid_current, 0
		mov	byte ptr word_23AF0, 0
		call	p1_1FE70
		call	p1_1F32E
		call	p1_205CE
		mov	_pid_current, 1
		mov	byte ptr word_23AF0, 28h ; '('
		call	p2_1FE7C
		call	p2_1F332
		call	p2_205D2
		call	sub_B7E5
		call	shots_update
		mov	_pid_current, 0
		mov	byte ptr word_23AF0, 0
		call	_chargeshot_update_p1
		mov	_pid_current, 1
		mov	byte ptr word_23AF0, 28h ; '('
		call	_chargeshot_update_p2
		call	sub_BB12
		call	sub_13CC7
		call	sub_17A1B
		call	sub_1609E
		call	sub_18059
		mov	_pid_current, 0
		mov	byte ptr word_23AF0, 0
		call	p1_202A4
		call	p1_202AC
		mov	_pid_current, 1
		mov	byte ptr word_23AF0, 28h ; '('
		call	p2_202A8
		call	p2_202B0
		nopcall	sub_CEB2
		call	_input_mode
		mov	byte ptr word_23AF0, 0
		push	_input_mp_p1
		push	offset _p1
		call	sub_DA43
		mov	byte ptr word_23AF0, 1
		push	_input_mp_p2
		push	offset _p2
		call	sub_DA43
		call	_snd_se_update
		test	_input_sp.hi, high INPUT_CANCEL
		jz	short loc_9845
		call	sub_C7A5

loc_9845:
		nopcall	sub_CA3C
		push	0
		nopcall	sub_CB81
		push	1
		nopcall	sub_CB81
		call	farfp_20F24
		cmp	byte_23AFA, 0
		jz	short loc_986C
		test	byte ptr word_23AF6, 1
		jz	loc_9A62

loc_986C:
		call	egc_on
		mov	_pid_current, 0
		mov	byte ptr word_23AF0, 0
		call	bomb_p1
		mov	_pid_current, 1
		mov	byte ptr word_23AF0, 28h ; '('
		call	bomb_p2
		mov	_pid_current, 0
		mov	byte ptr word_23AF0, 0
		call	p1_1F336
		mov	_pid_current, 1
		mov	byte ptr word_23AF0, 28h ; '('
		call	p2_1F33A
		call	shots_render
		call	sub_164DA
		call	sub_1837C
		call	sub_B80B
		mov	_pid_current, 0
		mov	byte ptr word_23AF0, 0
		call	p1_1FE74
		call	_chargeshot_render_p1
		mov	_pid_current, 1
		mov	byte ptr word_23AF0, 28h ; '('
		call	p2_1FE80
		call	_chargeshot_render_p2
		mov	byte ptr word_23AF0, 0
		push	offset _p1
		call	sub_DE95
		mov	byte ptr word_23AF0, 1
		push	offset _p2
		call	sub_DE95
		call	egc_off
		mov	byte ptr word_23AF0, 0
		push	offset _p1
		call	sub_DF18
		mov	byte ptr word_23AF0, 1
		push	offset _p2
		call	sub_DF18
		nopcall	sub_CEE0
		call	sub_17BD1
		cmp	byte_20E3C, 2
		jnz	loc_99B1
		call	sub_C2F9
		les	bx, _resident
		cmp	es:[bx+resident_t.game_mode], GM_STORY
		jz	short loc_9973
		cmp	_p1.rounds_won, 2
		jnb	short loc_994E
		cmp	_p2.rounds_won, 2
		jnb	short loc_994E
		cmp	word_23AF6, 0A0h
		jz	short loc_9986
		cmp	byte_1FBC3, 0
		jz	short loc_99B1
		jmp	short loc_99A4
; ---------------------------------------------------------------------------

loc_994E:
		call	sub_E3F2
		mov	ax, word_23AF6
		cmp	ax, word_1E6E8
		jz	short loc_9986
		cmp	byte_1FBC3, 0
		jz	short loc_99B1
		les	bx, _resident
		mov	al, es:[bx+resident_t.pid_winner]
		mov	ah, 0
		push	ax
		call	sub_A289
		mov	al, 2
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_9973:
		les	bx, _resident
		cmp	es:[bx+resident_t.pid_winner], 0
		jz	short loc_994E
		cmp	word_23AF6, 0A0h
		jnz	short loc_998E

loc_9986:
		mov	fp_1FBC0, offset sub_B4A8
		jmp	short loc_99B1
; ---------------------------------------------------------------------------

loc_998E:
		cmp	byte_1FBC3, 0
		jz	short loc_99B1
		les	bx, _resident
		cmp	es:[bx+resident_t.story_lives], 0
		jz	short loc_99A8
		dec	es:[bx+resident_t.story_lives]

loc_99A4:
		mov	al, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_99A8:
		push	0
		call	sub_A289
		mov	al, 2
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_99B1:
		call	sub_C830
		call	sub_C8C4
		call	sub_D52E
		push	0
		nopcall	sub_C9FE
		push	1
		nopcall	sub_C9FE
		call	sub_BE5D
		call	_combo_update_and_render
		call	fp_1FBC0
		call	fp_1E6EA
		cmp	byte_23AFA, 0
		jnz	short loc_99F7

loc_99DF:
		mov	al, byte_23AF9
		mov	ah, 0
		cmp	ax, vsync_Count1
		ja	short loc_99DF
		mov	vsync_Count1, 0
		mov	byte_23AF9, 1
		jmp	short loc_9A14
; ---------------------------------------------------------------------------

loc_99F7:
		test	byte ptr word_23AF6, 1
		jnz	short loc_9A14
		mov	vsync_Count1, 0

loc_9A04:
		mov	al, byte_23AF9
		mov	ah, 0
		cmp	ax, vsync_Count1
		ja	short loc_9A04
		mov	byte_23AF9, 2

loc_9A14:
		cmp	_palette_changed, 0
		jz	short loc_9A25
		call	far ptr	palette_show
		mov	_palette_changed, 0

loc_9A25:
		graph_accesspage _page_front
		graph_showpage _page_back
		mov	_page_front, al
		xor	_page_back, 1
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 0
		mov	bx, 3932h
		call	sub_B37C
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 1
		mov	bx, 395Ah
		call	sub_B37C
		call	grcg_off

loc_9A62:
		inc	_round_frame
		inc	word_23AF6
		mov	al, byte ptr _round_frame
		and	al, 0Fh
		mov	_round_frame_mod16, al
		and	al, 7
		mov	_round_frame_mod8, al
		and	al, 3
		mov	_round_frame_mod4, al
		and	al, 1
		mov	_round_frame_mod2, al
		test	byte ptr word_23AF6, 3Fh
		jnz	short loc_9AC9
		cmp	byte_23AF8, 7Fh
		jnb	short loc_9A94
		inc	byte_23AF8

loc_9A94:
		test	word_23AF6, 3FFh
		jnz	short loc_9AB5
		call	randring_fill
		cmp	_p1.miss_damage_next, 6
		jnb	short loc_9AAA
		inc	_p1.miss_damage_next

loc_9AAA:
		cmp	_p2.miss_damage_next, 6
		jnb	short loc_9AB5
		inc	_p2.miss_damage_next

loc_9AB5:
		cmp	word_23AF6, 7D0h
		jnb	short loc_9AC9
		mov	_p1.cpu_frame, 0
		mov	_p2.cpu_frame, 0

loc_9AC9:
		cmp	byte_23B00, 0
		jz	loc_977E
		mov	al, 0
		pop	bp
		retn
sub_9778	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_9AD6	proc near
		push	bp
		mov	bp, sp
		cmp	_demo_frame, DEMO_N
		jnb	short loc_9AE7
		inc	_demo_frame
		jmp	short loc_9AF5
; ---------------------------------------------------------------------------

loc_9AE7:
		cmp	_demo_frame, DEMO_N
		jnz	short loc_9AF5
		mov	fp_1FBC0, offset sub_B4A8

loc_9AF5:
		cmp	byte_1FBC3, 0
		jz	short loc_9B01
		mov	byte_23B00, 1

loc_9B01:
		cmp	_input_sp, INPUT_NONE
		jz	short loc_9B0D
		mov	byte_23B00, 1

loc_9B0D:
		pop	bp
		retn
sub_9AD6	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_9B0F	proc near
		push	bp
		mov	bp, sp
		pop	bp
		retn
sub_9B0F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_9B14	proc near

var_8		= word ptr -8
var_6		= dword	ptr -6
var_2		= word ptr -2

		enter	8, 0
		push	si
		push	di
		les	bx, _resident
		mov	eax, es:[bx+resident_t.rand]
		mov	random_seed, eax
		call	text_fillca pascal, (' ' shl 16) + TX_BLACK + TX_REVERSE
		call	graph_copy_page pascal, 0
		call	sub_13CDD
		mov	byte_207E3, 0
		call	sub_9EBF
		call	_hflip_lut_generate
		nopcall	sub_D5A2
		mov	byte_23AFA, 0
		les	bx, _resident
		cmp	es:[bx+resident_t.story_stage], 8
		jnb	short loc_9B68
		mov	word_1E6E8, 140h
		jmp	short loc_9B6E
; ---------------------------------------------------------------------------

loc_9B68:
		mov	word_1E6E8, 1CCh

loc_9B6E:
		les	bx, _resident
		cmp	es:[bx+resident_t.game_mode], GM_STORY
		jnz	loc_9BFF
		xor	si, si
		jmp	short loc_9B8E
; ---------------------------------------------------------------------------

loc_9B7F:
		les	bx, _resident
		add	bx, si
		mov	al, es:[bx+resident_t.score_last]
		mov	_score_lebcd_p1[si], al
		inc	si

loc_9B8E:
		cmp	si, SCORE_DIGITS
		jl	short loc_9B7F
		les	bx, _resident
		mov	al, es:[bx+resident_t.story_stage]
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 5
		ja	short @@cpu_additional_hit_damage_in_stage_7_8_9
		add	bx, bx
		jmp	cs:@@cpu_additional_hit_damage[bx]

@@cpu_additional_hit_damage_in_stage_1_2:
		mov	_cpu_hit_damage_additional, 3
		jmp	short loc_9BC5
; ---------------------------------------------------------------------------

@@cpu_additional_hit_damage_in_stage_3_4:
		mov	_cpu_hit_damage_additional, 2
		jmp	short loc_9BC5
; ---------------------------------------------------------------------------

@@cpu_additional_hit_damage_in_stage_5_6:
		mov	_cpu_hit_damage_additional, 1
		jmp	short loc_9BC5
; ---------------------------------------------------------------------------

@@cpu_additional_hit_damage_in_stage_7_8_9:
		mov	_cpu_hit_damage_additional, 0

loc_9BC5:
		les	bx, _resident
		mov	al, es:[bx+resident_t.story_stage]
		inc	al
		mov	byte_202B6, al
		mov	al, es:[bx+resident_t.story_stage]
		inc	al
		mov	byte_202B7, al
		mov	al, _score_lebcd_p1[6]
		mov	byte_220DC, al
		cmp	byte_220DC, 2
		jnb	short loc_9BEF
		cmp	_score_lebcd_p1[7], 0
		jz	short loc_9BF4

loc_9BEF:
		mov	byte_220DC, -1

loc_9BF4:
		les	bx, _resident
		mov	al, es:[bx+resident_t.rem_credits]
		push	ax
		jmp	short loc_9C70
; ---------------------------------------------------------------------------

loc_9BFF:
		les	bx, _resident
		cmp	es:[bx+resident_t.RESIDENT_is_cpu][1], 0
		jz	short loc_9C13
		cmp	es:[bx+resident_t.RESIDENT_is_cpu][0], 0
		jz	short loc_9C13
		jmp	short @@lunatic
; ---------------------------------------------------------------------------

loc_9C13:
		les	bx, _resident
		mov	al, es:[bx+resident_t.rank]
		mov	ah, 0
		mov	bx, ax
		cmp	bx, RANK_LUNATIC
		ja	short loc_9C51
		add	bx, bx
		jmp	cs:off_9EAB[bx]

@@easy:
		mov	[bp+var_6], 3E8h
		jmp	short loc_9C51
; ---------------------------------------------------------------------------

@@normal:
		mov	[bp+var_6], 76Ch
		jmp	short loc_9C51
; ---------------------------------------------------------------------------

@@hard:
		mov	[bp+var_6], 0FA0h
		jmp	short loc_9C51
; ---------------------------------------------------------------------------

@@lunatic:
		mov	[bp+var_6], 0FFFFh

loc_9C51:
		mov	ax, word ptr [bp+var_6]
		mov	_p1.cpu_safety_frames, ax
		mov	_p2.cpu_safety_frames, ax
		mov	byte_202B6, 1
		mov	byte_202B7, 1
		mov	byte_220DC, -1
		mov	_cpu_hit_damage_additional, 0
		push	3

loc_9C70:
		nopcall	sub_D6C0
		mov	di, offset _players
		xor	si, si
		jmp	short loc_9C93
; ---------------------------------------------------------------------------

loc_9C7C:
		mov	[di+player_t.rounds_won], 0
		mov	[di+player_t.gauge_avail], ((1 shl 6) shl 4)
		mov	[di+player_t.combo_hits_max], 0
		mov	[di+player_t.combo_bonus_max], 0
		inc	si
		add	di, size player_t

loc_9C93:
		cmp	si, PLAYER_COUNT
		jl	short loc_9C7C
		les	bx, _resident
		cmp	es:[bx+resident_t.demo_num], 0
		jnz	short loc_9CAB
		mov	fp_1E6EA, offset sub_9B0F
		jmp	short loc_9CD0
; ---------------------------------------------------------------------------

loc_9CAB:
		mov	_demo_frame, 0
		mov	fp_1E6EA, offset sub_9AD6
		mov	byte_23AF8, 40h
		mov	byte_23E3C, 0
		mov	byte_1F39E, 8
		mov	byte_202B6, 9
		mov	byte_202B7, 9

loc_9CD0:
		mov	fp_1FBC0, offset sub_B4A3
		les	bx, _resident
		cmp	es:[bx+resident_t.demo_num], 0
		jz	short loc_9CF0
		setfarfp	_input_mode, input_mode_attract
		jmp	loc_9D80
; ---------------------------------------------------------------------------

loc_9CF0:
		les	bx, _resident
		cmp	es:[bx+resident_t.RESIDENT_is_cpu][1], 0
		jz	short loc_9D10
		cmp	es:[bx+resident_t.RESIDENT_is_cpu][0], 0
		jz	short loc_9D10
		setfarfp	_input_mode, input_mode_cpu_vs_cpu
		jmp	short loc_9D80
; ---------------------------------------------------------------------------

loc_9D10:
		les	bx, _resident
		cmp	es:[bx+resident_t.RESIDENT_is_cpu][1], 0
		jz	short loc_9D29
		setfarfp	_input_mode, input_mode_1p_vs_cpu
		jmp	short loc_9D80
; ---------------------------------------------------------------------------

loc_9D29:
		les	bx, _resident
		cmp	es:[bx+resident_t.RESIDENT_is_cpu][0], 0
		jz	short loc_9D42
		setfarfp	_input_mode, input_mode_cpu_vs_1p
		jmp	short loc_9D80
; ---------------------------------------------------------------------------

loc_9D42:
		les	bx, _resident
		cmp	es:[bx+resident_t.key_mode], KM_KEY_KEY
		jnz	short loc_9D5B
		setfarfp	_input_mode, input_mode_key_vs_key
		jmp	short loc_9D80
; ---------------------------------------------------------------------------

loc_9D5B:
		les	bx, _resident
		cmp	es:[bx+resident_t.key_mode], KM_JOY_KEY
		jnz	short loc_9D74
		setfarfp	_input_mode, input_mode_joy_vs_key
		jmp	short loc_9D80
; ---------------------------------------------------------------------------

loc_9D74:
		setfarfp	_input_mode, input_mode_key_vs_joy

loc_9D80:
		xor	si, si
		jmp	loc_9E24
; ---------------------------------------------------------------------------

loc_9D85:
		mov	bx, si
		shl	bx, 7
		mov	al, _players[bx].playchar_paletted
		mov	ah, 0
		dec	ax
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	[bp+var_2], ax
		imul	ax, size playchar_speeds_t
		add	ax, offset _PLAYCHAR_SPEEDS
		mov	[bp+var_8], ax
		mov	ax, si
		shl	ax, 7
		add	ax, offset _players
		mov	di, ax
		mov	bx, [bp+var_8]
		mov	al, [bx]
		mov	[di+player_t.speed.aligned.x8], al
		inc	[bp+var_8]
		mov	bx, [bp+var_8]
		mov	al, [bx]
		mov	[di+player_t.speed.aligned.y8], al
		inc	[bp+var_8]
		mov	bx, [bp+var_8]
		mov	al, [bx]
		mov	[di+player_t.speed.diagonal.x8], al
		inc	[bp+var_8]
		mov	bx, [bp+var_8]
		mov	al, [bx]
		mov	[di+player_t.speed.diagonal.y8], al
		inc	[bp+var_8]
		mov	bx, [bp+var_8]
		mov	al, [bx]
		mov	[di+player_t.gauge_charge_speed], al
		mov	bx, [bp+var_2]
		cmp	bx, PLAYCHAR_COUNT - 1
		ja	short loc_9E23
		add	bx, bx
		jmp	cs:off_9E99[bx]

loc_9DEF:
		push	si
		call	set_callbacks_reimu
		jmp	short loc_9E23
; ---------------------------------------------------------------------------

loc_9DF5:
		push	si
		call	set_callbacks_mima
		jmp	short loc_9E23
; ---------------------------------------------------------------------------

loc_9DFB:
		push	si
		call	set_callbacks_marisa
		jmp	short loc_9E23
; ---------------------------------------------------------------------------

loc_9E01:
		push	si
		call	set_callbacks_ellen
		jmp	short loc_9E23
; ---------------------------------------------------------------------------

loc_9E07:
		push	si
		call	set_callbacks_kotohime
		jmp	short loc_9E23
; ---------------------------------------------------------------------------

loc_9E0D:
		push	si
		call	set_callbacks_kana
		jmp	short loc_9E23
; ---------------------------------------------------------------------------

loc_9E13:
		push	si
		call	set_callbacks_rikako
		jmp	short loc_9E23
; ---------------------------------------------------------------------------

loc_9E19:
		push	si
		call	set_callbacks_chiyuri
		jmp	short loc_9E23
; ---------------------------------------------------------------------------

loc_9E1F:
		push	si
		call	set_callbacks_yumemi

loc_9E23:
		inc	si

loc_9E24:
		cmp	si, PLAYER_COUNT
		jl	loc_9D85
		call	super_entry_bfnt pascal, ds, offset aLose_bf2 ; "lose.bf2"
		call	super_entry_bfnt pascal, ds, offset aRound_bf2 ; "round.bf2"
		call	super_entry_bfnt pascal, ds, offset aZikicw_bf2 ; "zikicw.bf2"
		call	sub_E266
		nopcall	sub_A38E
		call	graph_200line pascal, 0
		call	sprite16_sprites_commit
		mov	_page_back, 0
		mov	_page_front, 1
		graph_accesspage 0
		graph_showpage 1
		call	_snd_se_reset
		nopcall	sub_B8F7
		nopcall	sub_BAE0
		call	grc_setclip pascal, large 0, ((RES_X - 1) shl 16) or (SPRITE16_RES_Y - 1)
		kajacall	KAJA_SONG_PLAY
		pop	di
		pop	si
		leave
		retn

; ---------------------------------------------------------------------------
		db 0
off_9E99	dw offset loc_9DEF
		dw offset loc_9DF5
		dw offset loc_9DFB
		dw offset loc_9E01
		dw offset loc_9E07
		dw offset loc_9E0D
		dw offset loc_9E13
		dw offset loc_9E19
		dw offset loc_9E1F
off_9EAB	dw offset @@easy
		dw offset @@normal
		dw offset @@hard
		dw offset @@lunatic
@@cpu_additional_hit_damage	dw offset @@cpu_additional_hit_damage_in_stage_1_2
		dw offset @@cpu_additional_hit_damage_in_stage_1_2
		dw offset @@cpu_additional_hit_damage_in_stage_3_4
		dw offset @@cpu_additional_hit_damage_in_stage_3_4
		dw offset @@cpu_additional_hit_damage_in_stage_5_6
		dw offset @@cpu_additional_hit_damage_in_stage_5_6
sub_9B14	endp

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_9EBF	proc near

var_6		= dword	ptr -6
@@i		= word ptr -2

		enter	6, 0
		push	si
		push	di
		mov	word_1F32A, 0
		mov	word_1F32C, 0
		mov	byte_26356, 0
		mov	byte_1FBC2, 0
		mov	byte_1FBC3, 0
		mov	byte_1F520, 0
		call	sub_E313
		call	randring_fill
		call	sub_17384
		xor	di, di
		jmp	short loc_9EFF
; ---------------------------------------------------------------------------

loc_9EF4:
		mov	bx, di
		imul	bx, 30h
		mov	byte ptr [bx+3ED6h], 0
		inc	di

loc_9EFF:
		cmp	di, 40h
		jl	short loc_9EF4
		xor	di, di
		jmp	short loc_9F1D
; ---------------------------------------------------------------------------

loc_9F08:
		mov	bx, di
		shl	bx, 5
		mov	byte ptr [bx+292Ah], 0
		mov	bx, di
		shl	bx, 5
		mov	byte ptr [bx+2B2Ah], 0
		inc	di

loc_9F1D:
		cmp	di, 10h
		jl	short loc_9F08
		xor	di, di
		jmp	short loc_9F31
; ---------------------------------------------------------------------------

loc_9F26:
		mov	bx, di
		imul	bx, size shotpair_t
		mov	_shotpairs[bx].flag, 0
		inc	di

loc_9F31:
		cmp	di, SHOTPAIR_COUNT
		jl	short loc_9F26
		call	sub_14A76
		call	sub_153BB
		call	sub_142D0
		call	sub_1B653
		call	sub_193BC
		les	bx, _resident
		cmp	es:[bx+resident_t.game_mode], GM_STORY
		jnz	loc_9FFA
		mov	al, byte_207E3
		mov	ah, 0
		mov	dl, es:[bx+resident_t.rem_credits]
		mov	dh, 0
		sub	ax, dx
		add	ax, 3
		mov	di, ax
		cmp	di, 5
		jle	short loc_9F76
		mov	di, 5

loc_9F76:
		les	bx, _resident
		mov	al, es:[bx+resident_t.story_stage]
		mov	ah, 0
		imul	ax, 0Ch
		mov	dx, di
		add	dx, dx
		add	ax, dx
		mov	bx, ax
		movzx	eax, word ptr [bx+90h]
		mov	[bp+var_6], eax
		mov	bx, word ptr _resident
		mov	al, es:[bx+resident_t.rank]
		mov	ah, 0
		or	ax, ax
		jz	short loc_9FAF
		cmp	ax, RANK_HARD
		jz	short loc_9FC4
		cmp	ax, RANK_LUNATIC
		jz	short loc_9FCE
		jmp	short loc_9FE2
; ---------------------------------------------------------------------------

loc_9FAF:
		mov	ebx, 3
		mov	eax, [bp+var_6]
		cdq
		idiv	ebx

loc_9FBE:
		mov	[bp+var_6], eax
		jmp	short loc_9FE2
; ---------------------------------------------------------------------------

loc_9FC4:
		mov	eax, [bp+var_6]
		imul	eax, 2
		jmp	short loc_9FBE
; ---------------------------------------------------------------------------

loc_9FCE:
		mov	eax, [bp+var_6]
		imul	eax, 3
		mov	[bp+var_6], eax
		add	[bp+var_6], 500

loc_9FE2:
		cmp	[bp+var_6], 0FFFFh
		jle	short loc_9FF4
		mov	[bp+var_6], 0FFFFh

loc_9FF4:
		mov	ax, word ptr [bp+var_6]
		mov	_p2.cpu_safety_frames, ax

loc_9FFA:
		les	bx, _resident
		mov	al, es:[bx+resident_t.rank]
		mov	ah, 0
		mov	bx, ax
		cmp	bx, RANK_LUNATIC
		ja	loc_A0E7
		add	bx, bx
		jmp	cs:off_A217[bx]

@@easy:
		mov	al, byte_207E3
		shl	al, 4
		mov	byte_23AF8, al
		mov	byte_23E3C, 0
		les	bx, _resident
		mov	al, es:[bx+resident_t.story_stage]
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, byte_207E3
		mov	byte_1F39E, al
		cmp	es:[bx+resident_t.game_mode], GM_STORY
		jz	loc_A0E7
		inc	byte_202B6
		inc	byte_202B7
		jmp	loc_A0E7
; ---------------------------------------------------------------------------

@@normal:
		mov	al, byte_207E3
		shl	al, 5
		mov	byte_23AF8, al
		mov	byte_23E3C, 0
		les	bx, _resident
		mov	al, es:[bx+resident_t.story_stage]
		mov	dl, byte_207E3
		add	dl, dl
		add	al, dl
		mov	byte_1F39E, al
		cmp	es:[bx+resident_t.game_mode], GM_STORY
		jz	short loc_A0E7
		jmp	short loc_A0A2
; ---------------------------------------------------------------------------

@@hard:
		mov	al, byte_207E3
		shl	al, 5
		add	al, 20h	; ' '
		mov	byte_23AF8, al
		mov	byte_23E3C, 8
		les	bx, _resident
		mov	al, es:[bx+resident_t.story_stage]
		mov	dl, byte_207E3
		add	dl, dl
		add	al, dl
		add	al, 2
		mov	byte_1F39E, al
		cmp	es:[bx+resident_t.game_mode], GM_STORY
		jz	short loc_A0E7

loc_A0A2:
		mov	al, byte_202B6
		add	al, 2
		mov	byte_202B6, al
		mov	al, byte_202B7
		add	al, 2
		jmp	short loc_A0E4
; ---------------------------------------------------------------------------

@@lunatic:
		mov	byte_23AF8, 60h
		mov	byte_23E3C, 18h
		les	bx, _resident
		mov	al, es:[bx+resident_t.story_stage]
		mov	dl, byte_207E3
		add	dl, dl
		add	al, dl
		add	al, 8
		mov	byte_1F39E, al
		cmp	es:[bx+resident_t.game_mode], GM_STORY
		jz	short loc_A0E7
		mov	al, byte_202B6
		add	al, 4
		mov	byte_202B6, al
		mov	al, byte_202B7
		add	al, 4

loc_A0E4:
		mov	byte_202B7, al

loc_A0E7:
		cmp	byte_23AF8, 80h
		jb	short loc_A0F3
		mov	byte_23AF8, 7Fh

loc_A0F3:
		cmp	byte_1F39E, 10h
		jbe	short loc_A0FF
		mov	byte_1F39E, 10h

loc_A0FF:
		cmp	byte_202B6, 10h
		jbe	short loc_A10B
		mov	byte_202B6, 10h

loc_A10B:
		cmp	byte_202B7, 10h
		jbe	short loc_A117
		mov	byte_202B7, 10h

loc_A117:
		mov	byte_1DB9E, -1
		mov	byte_20E3C, 0
		mov	byte_207E2, 1
		mov	word_21434, 1400h
		mov	_round_frame_mod16, 0
		mov	_round_frame_mod8, 0
		mov	_round_frame_mod4, 0
		mov	_round_frame_mod2, 0
		mov	si, offset _players
		xor	di, di
		jmp	loc_A206
; ---------------------------------------------------------------------------

loc_A148:
		mov	byte ptr [di+4AD6h], 0
		les	bx, _resident
		add	bx, di
		mov	al, es:[bx+resident_t.RESIDENT_playchar_paletted]
		mov	[si+player_t.playchar_paletted], al
		mov	bx, word ptr _resident
		add	bx, di
		mov	al, es:[bx+resident_t.RESIDENT_is_cpu]
		mov	[si+player_t.is_cpu], al
		mov	[si+player_t.is_hit], 0
		mov	[si+player_t.PLAYER_unused_1], 0
		mov	[si+player_t.invincibility_time], ROUND_START_INVINCIBILITY_FRAMES
		mov	[si+player_t.is_hit], 0
		mov	[si+player_t.shot_mode], SM_1_PAIR
		mov	[si+player_t.halfhearts], HALFHEARTS_MAX
		mov	[si+player_t.knockback_time], 0
		mov	[si+player_t.move_lock_time], 0
		mov	[si+player_t.knockback_active], 0
		mov	[si+player_t.center.x], ((PLAYFIELD_W / 2) shl 4)
		mov	[si+player_t.center.y], ((PLAYFIELD_H - 32) shl 4)
		mov	[si+player_t.gauge_charged], 0
		mov	[si+player_t.shot_active], SA_ENABLED
		mov	[si+player_t.miss_damage_next], 1
		mov	[bp+@@i], 0
		jmp	short loc_A1BD
; ---------------------------------------------------------------------------

loc_A1A8:
		call	IRand
		and	al, 3
		shl	al, 6
		add	al, 3Fh	; '?'
		mov	bx, [bp+@@i]
		mov	[bx+si+player_t.cpu_charge_at_avail_ring], al
		inc	[bp+@@i]

loc_A1BD:
		cmp	[bp+@@i], CHARGE_AT_AVAIL_RING_SIZE
		jl	short loc_A1A8
		mov	[si+player_t.cpu_charge_at_avail_ring_p], 0
		mov	[si+player_t.bombs], 2
		mov	byte ptr [si+player_t.lose_anim_time], 0
		mov	byte ptr [si+player_t.hyper_active], 0
		mov	word ptr [si+player_t.cpu_frame], 0
		mov	byte ptr [si+player_t.gauge_attacks_fired], 0
		mov	byte ptr [si+player_t.boss_attacks_fired], 0
		mov	byte ptr [si+player_t.boss_attacks_reversed], 0
		mov	byte ptr [si+player_t.boss_panics_fired], 0
		mov	byte ptr [di+2D54h], 0
		mov	bx, di
		add	bx, bx
		mov	_playfield_fg_shift_x[bx], 0
		mov	_damage_all_enemies_on[di], 0
		mov	byte ptr [di+798h], 0
		inc	di
		add	si, size player_t

loc_A206:
		cmp	di, PLAYER_COUNT
		jl	loc_A148
		call	sub_13D9C
		pop	di
		pop	si
		leave
		retn

; ---------------------------------------------------------------------------
		db 0
off_A217	dw offset @@easy
		dw offset @@normal
		dw offset @@hard
		dw offset @@lunatic
sub_9EBF	endp

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_A21F	proc near
		push	bp
		mov	bp, sp
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 2
		call	grc_setclip pascal, large 0, ((RES_X - 1) shl 16) or (SPRITE16_RES_Y - 1)
		graph_accesspage 1
		call	grcg_fill
		graph_accesspage 0
		call	grcg_fill
		graph_showpage 1
		call	grcg_off
		inc	byte_207E3
		call	sub_9EBF
		call	farfp_20F28
		mov	_p1.hyper, offset hyper_standby
		mov	_p2.hyper, offset hyper_standby
		call	_snd_se_reset
		nopcall	sub_B8F7
		nopcall	sub_A38E
		nopcall	sub_BAE0
		pop	bp
		retn
sub_A21F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_A289	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_0]
		xor	cx, cx
		jmp	short loc_A2C6
; ---------------------------------------------------------------------------

loc_A294:
		mov	bx, si
		shl	bx, 3
		add	bx, cx
		mov	al, _score_lebcd_p1[bx]
		mov	dx, si
		shl	dx, 3
		les	bx, _resident
		add	bx, dx
		add	bx, cx
		mov	es:[bx+resident_t.score_last], al
		mov	ax, 1
		sub	ax, si
		shl	ax, 3
		mov	bx, word ptr _resident
		add	bx, ax
		add	bx, cx
		mov	es:[bx+resident_t.score_last], 0
		inc	cx

loc_A2C6:
		cmp	cx, SCORE_DIGITS
		jl	short loc_A294
		pop	si
		pop	bp
		retn	2
sub_A289	endp

include th03/main/playfield_fg_x.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_A2F2	proc far

arg_0		= word ptr  6
arg_2		= word ptr  8

		push	bp
		mov	bp, sp
		mov	bx, sp
		mov	dx, [bp+arg_0]
		or	dl, dl
		jz	short loc_A301
		mov	dx, 140h

loc_A301:
		mov	ax, [bp+arg_2]
		sub	ax, dx
		add	ax, 0FFF0h
		shl	ax, 4
		pop	bp
		retf	4
sub_A2F2	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_A310	proc far

arg_0		= word ptr  6
arg_2		= word ptr  8

		push	bp
		mov	bp, sp
		xor	ax, ax
		mov	cx, [bp+arg_2]
		mov	dx, [bp+arg_0]
		mov	bx, word_1F2EC
		cmp	cx, bx
		jle	short loc_A33F
		neg	bx
		add	bx, 1200h
		cmp	cx, bx
		jge	short loc_A33F
		mov	bx, word_1F2EE
		cmp	dx, bx
		jle	short loc_A33F
		neg	bx
		add	bx, 1700h
		cmp	dx, bx
		jl	short loc_A341

loc_A33F:
		mov	al, 1

loc_A341:
		pop	bp
		retf	4
sub_A310	endp

; ---------------------------------------------------------------------------
		nop
include th03/formats/cfg_lres.asm
		db 0

; =============== S U B	R O U T	I N E =======================================


sub_A378	proc far
		push	si
		push	di
		mov	ax, ds
		mov	es, ax
		assume es:_DATA
		mov	di, offset palette_1F2F4
		mov	si, offset Palettes
		mov	cx, size palette_t / 4
		rep movsd
		pop	di
		pop	si
		retf
sub_A378	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================


sub_A38E	proc far
		push	si
		push	di
		mov	ax, ds
		mov	es, ax
		mov	di, offset Palettes
		mov	si, offset palette_1F2F4
		mov	cx, size palette_t / 4
		rep movsd
		call	far ptr	palette_show
		pop	di
		pop	si
		retf
sub_A38E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_A3A8	proc far

arg_0		= byte ptr  6

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	ax, ds
		mov	es, ax
		xor	bx, bx
		mov	al, [bp+arg_0]
		or	al, al
		jz	short loc_A3BC
		mov	bl, 1 * size rgb_t

loc_A3BC:
		lea	di, Palettes[bx]
		lea	si, palette_1F2F4[bx]
		movsw
		movsb
		mov	_palette_changed, 1
		pop	di
		pop	si
		pop	bp
		retf	2
sub_A3A8	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_A3D2	proc far

arg_0		= byte ptr  6
arg_2		= byte ptr  8

		push	bp
		mov	bp, sp
		push	di
		mov	cx, size rgb_t
		xor	bx, bx
		mov	al, [bp+arg_0]
		or	al, al
		jz	short loc_A3E4
		mov	bl, 1 * size rgb_t

loc_A3E4:
		lea	di, Palettes[bx]
		mov	al, [bp+arg_2]

loc_A3EB:
		mov	[di], al
		inc	di
		loop	loc_A3EB
		mov	_palette_changed, 1
		pop	di
		pop	bp
		retf	4
sub_A3D2	endp

include th03/math/randring_fill.asm
RANDRING_NEXT_DEF_NOMOD 1, near

; =============== S U B	R O U T	I N E =======================================


sub_A438	proc near
		push	di
		mov	ax, ds
		mov	es, ax
		mov	di, 4BA0h
		mov	cx, 678h
		xor	eax, eax
		rep stosd
		pop	di
		retn
sub_A438	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_A44C	proc near

arg_0		= dword	ptr  4
arg_4		= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_4]
		call	super_entry_bfnt pascal, large [bp+arg_0]
		les	bx, [bp+arg_0]
		assume es:nothing
		mov	byte ptr es:[bx+2], 'e'
		mov	byte ptr es:[bx+3], 'x'
		mov	byte ptr es:[bx+5], 'm'
		mov	byte ptr es:[bx+6], 'r'
		mov	byte ptr es:[bx+7], 's'
		call	@mrs_load$qinxc pascal, si, word ptr [bp+arg_0+2], bx
		les	bx, [bp+arg_0]
		mov	byte ptr es:[bx+2], 'b'
		mov	byte ptr es:[bx+3], 'm'
		lea	ax, [si+2]
		call	@mrs_load$qinxc pascal, ax, word ptr [bp+arg_0+2], bx
		pop	si
		pop	bp
		retn	6
sub_A44C	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_A4A1	proc near

		push	bp
		mov	bp, sp
		call	@mrs_hflip$qi pascal, 1
		call	@mrs_hflip$qi pascal, 3
		call	respal_get_palettes
		call	far ptr	palette_show
		nopcall	sub_A378
		pop	bp
		retn
sub_A4A1	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_A4C3	proc near

var_C		= byte ptr -0Ch
var_B		= byte ptr -0Bh
arg_0		= word ptr  4
arg_2		= word ptr  6

		enter	0Ch, 0
		push	si
		push	di
		mov	di, [bp+arg_2]
		xor	si, si
		jmp	short loc_A4D8
; ---------------------------------------------------------------------------

loc_A4D0:
		mov	al, [si+640h]
		mov	[bp+si+var_C], al
		inc	si

loc_A4D8:
		cmp	si, 0Ch
		jl	short loc_A4D0
		mov	bx, di
		shl	bx, 7
		mov	al, _players[bx].playchar_paletted
		mov	ah, 0
		and	ax, 1
		sub	[bp+arg_0], ax
		cmp	[bp+arg_0], 0Ah
		jl	short loc_A50C
		mov	ax, [bp+arg_0]
		mov	bx, 10
		cwd
		idiv	bx
		add	al, [bp+var_C]
		mov	[bp+var_C], al
		mov	ax, [bp+arg_0]
		cwd
		idiv	bx
		mov	[bp+arg_0], dx

loc_A50C:
		mov	al, [bp+var_B]
		add	al, byte ptr [bp+arg_0]
		mov	[bp+var_B], al
		push	di
		push	ss
		lea	ax, [bp+var_C]
		push	ax
		call	sub_A44C
		pop	di
		pop	si
		leave
		retn	4
sub_A4C3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

set_callbacks_reimu	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_0]
		push	si
		push	1
		call	sub_A4C3
		or	si, si
		jnz	loc_A5E2
		setfarfp	p1_1FE6C, reimu_1A27E
		setfarfp	p1_1FE70, reimu_1A4E0
		setfarfp	p1_1FE74, reimu_1A5F9
		setfarfp	_p1.chargeshot_add, chargeshot_add_reimu
		setfarfp	_chargeshot_update_p1, chargeshot_update_reimu
		setfarfp	_chargeshot_render_p1, chargeshot_render_reimu
		setfarfp	p1_2029C, reimu_14CE3
		setfarfp	p1_202A4, reimu_14FEE
		setfarfp	p1_202AC, reimu_15006
		setfarfp	p1_1F32E, reimu_11033
		setfarfp	p1_1F336, reimu_113A9
		setfarfp	p1_205CE, reimu_1508C
		setfarfp	bomb_p1, reimu_bomb
		mov	_p1.hyper_func, offset hyper_reimu
		mov	_p1.hyper, offset hyper_standby
		jmp	loc_A68D
; ---------------------------------------------------------------------------

loc_A5E2:
		setfarfp	p2_1FE78, reimu_1A27E
		setfarfp	p2_1FE7C, reimu_1A4E0
		setfarfp	p2_1FE80, reimu_1A5F9
		setfarfp	_p2.chargeshot_add, chargeshot_add_reimu
		setfarfp	_chargeshot_update_p2, chargeshot_update_reimu
		setfarfp	_chargeshot_render_p2, chargeshot_render_reimu
		setfarfp	p2_202A0, reimu_14CE3
		setfarfp	p2_202A8, reimu_14FEE
		setfarfp	p2_202B0, reimu_15006
		setfarfp	p2_1F332, reimu_11033
		setfarfp	p2_1F33A, reimu_113A9
		setfarfp	p2_205D2, reimu_1508C
		setfarfp	bomb_p2, reimu_bomb
		mov	_p2.hyper_func, offset hyper_reimu
		mov	_p2.hyper, offset hyper_standby
		call	sub_A4A1

loc_A68D:
		setfarfp	farfp_20F20, sub_D092
		setfarfp	farfp_20F24, sub_D135
		setfarfp	farfp_20F28, sub_D05D
		push	si
		call	reimu_10BFE
		pop	si
		pop	bp
		retn	2
set_callbacks_reimu	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

set_callbacks_mima	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_0]
		push	si
		push	3
		call	sub_A4C3
		or	si, si
		jnz	loc_A77A
		setfarfp	p1_1FE6C, mima_1A62B
		setfarfp	p1_1FE70, mima_1A745
		setfarfp	p1_1FE74, mima_1A8D3
		setfarfp	_p1.chargeshot_add, chargeshot_add_mima
		setfarfp	_chargeshot_update_p1, chargeshot_update_mima
		setfarfp	_chargeshot_render_p1, chargeshot_render_mima
		setfarfp	p1_2029C, mima_15597
		setfarfp	p1_202A4, mima_158C5
		setfarfp	p1_202AC, mima_158DD
		setfarfp	p1_1F32E, mima_FED8
		setfarfp	p1_1F336, mima_10263
		setfarfp	p1_205CE, mima_17043
		setfarfp	bomb_p1, mima_bomb
		mov	_p1.hyper_func, offset hyper_mima
		mov	_p1.hyper, offset hyper_standby
		jmp	loc_A825
; ---------------------------------------------------------------------------

loc_A77A:
		setfarfp	p2_1FE78, mima_1A62B
		setfarfp	p2_1FE7C, mima_1A745
		setfarfp	p2_1FE80, mima_1A8D3
		setfarfp	_p2.chargeshot_add, chargeshot_add_mima
		setfarfp	_chargeshot_update_p2, chargeshot_update_mima
		setfarfp	_chargeshot_render_p2, chargeshot_render_mima
		setfarfp	p2_202A0, mima_15597
		setfarfp	p2_202A8, mima_158C5
		setfarfp	p2_202B0, mima_158DD
		setfarfp	p2_1F332, mima_FED8
		setfarfp	p2_1F33A, mima_10263
		setfarfp	p2_205D2, mima_17043
		setfarfp	bomb_p2, mima_bomb
		mov	_p2.hyper_func, offset hyper_mima
		mov	_p2.hyper, offset hyper_standby
		call	sub_A4A1

loc_A825:
		setfarfp	farfp_20F20, sub_D092
		setfarfp	farfp_20F24, sub_D135
		setfarfp	farfp_20F28, sub_D05D
		push	si
		call	mima_FB46
		pop	si
		pop	bp
		retn	2
set_callbacks_mima	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

set_callbacks_marisa	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_0]
		push	si
		push	5
		call	sub_A4C3
		or	si, si
		jnz	loc_A912
		setfarfp	p1_1FE6C, marisa_19ABC
		setfarfp	p1_1FE70, marisa_19C36
		setfarfp	p1_1FE74, marisa_19D31
		setfarfp	_p1.chargeshot_add, chargeshot_add_marisa
		setfarfp	_chargeshot_update_p1, chargeshot_update_marisa
		setfarfp	_chargeshot_render_p1, chargeshot_render_marisa
		setfarfp	p1_2029C, marisa_14487
		setfarfp	p1_202A4, marisa_14885
		setfarfp	p1_202AC, marisa_1489D
		setfarfp	p1_1F32E, marisa_F848
		setfarfp	p1_1F336, marisa_FAE8
		setfarfp	p1_205CE, sub_1501E
		setfarfp	bomb_p1, marisa_bomb
		mov	_p1.hyper_func, offset hyper_marisa
		mov	_p1.hyper, offset hyper_standby
		jmp	loc_A9BD
; ---------------------------------------------------------------------------

loc_A912:
		setfarfp	p2_1FE78, marisa_19ABC
		setfarfp	p2_1FE7C, marisa_19C36
		setfarfp	p2_1FE80, marisa_19D31
		setfarfp	_p2.chargeshot_add, chargeshot_add_marisa
		setfarfp	_chargeshot_update_p2, chargeshot_update_marisa
		setfarfp	_chargeshot_render_p2, chargeshot_render_marisa
		setfarfp	p2_202A0, marisa_14487
		setfarfp	p2_202A8, marisa_14885
		setfarfp	p2_202B0, marisa_1489D
		setfarfp	p2_1F332, marisa_F848
		setfarfp	p2_1F33A, marisa_FAE8
		setfarfp	p2_205D2, sub_1501E
		setfarfp	bomb_p2, marisa_bomb
		mov	_p2.hyper_func, offset hyper_marisa
		mov	_p2.hyper, offset hyper_standby
		call	sub_A4A1

loc_A9BD:
		setfarfp	farfp_20F20, sub_D2E8
		setfarfp	farfp_20F24, sub_D340
		setfarfp	farfp_20F28, sub_D05D
		push	si
		call	marisa_F5AF
		pop	si
		pop	bp
		retn	2
set_callbacks_marisa	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

set_callbacks_ellen	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_0]
		push	si
		push	7
		call	sub_A4C3
		or	si, si
		jnz	loc_AAAA
		setfarfp	p1_1FE6C, ellen_193EF
		setfarfp	p1_1FE70, ellen_1961D
		setfarfp	p1_1FE74, ellen_197F3
		setfarfp	_p1.chargeshot_add, chargeshot_add_ellen
		setfarfp	_chargeshot_update_p1, chargeshot_update_ellen
		setfarfp	_chargeshot_render_p1, chargeshot_render_ellen
		setfarfp	p1_2029C, ellen_1B903
		setfarfp	p1_202A4, ellen_1BC1D
		setfarfp	p1_202AC, ellen_1BC35
		setfarfp	p1_1F32E, ellen_116B6
		setfarfp	p1_1F336, ellen_11A01
		setfarfp	p1_205CE, ellen_185AB
		setfarfp	bomb_p1, ellen_bomb
		mov	_p1.hyper_func, offset hyper_ellen
		mov	_p1.hyper, offset hyper_standby
		jmp	loc_AB55
; ---------------------------------------------------------------------------

loc_AAAA:
		setfarfp	p2_1FE78, ellen_193EF
		setfarfp	p2_1FE7C, ellen_1961D
		setfarfp	p2_1FE80, ellen_197F3
		setfarfp	_p2.chargeshot_add, chargeshot_add_ellen
		setfarfp	_chargeshot_update_p2, chargeshot_update_ellen
		setfarfp	_chargeshot_render_p2, chargeshot_render_ellen
		setfarfp	p2_202A0, ellen_1B903
		setfarfp	p2_202A8, ellen_1BC1D
		setfarfp	p2_202B0, ellen_1BC35
		setfarfp	p2_1F332, ellen_116B6
		setfarfp	p2_1F33A, ellen_11A01
		setfarfp	p2_205D2, ellen_185AB
		setfarfp	bomb_p2, ellen_bomb
		mov	_p2.hyper_func, offset hyper_ellen
		mov	_p2.hyper, offset hyper_standby
		call	sub_A4A1

loc_AB55:
		setfarfp	farfp_20F20, sub_D2E8
		setfarfp	farfp_20F24, sub_D340
		setfarfp	farfp_20F28, sub_D05D
		push	si
		call	ellen_113E2
		pop	si
		pop	bp
		retn	2
set_callbacks_ellen	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

set_callbacks_kotohime	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_0]
		push	si
		push	9
		call	sub_A4C3
		or	si, si
		jnz	loc_AC42
		setfarfp	p1_1FE6C, kotohime_19D60
		setfarfp	p1_1FE70, kotohime_19FEF
		setfarfp	p1_1FE74, kotohime_1A14E
		setfarfp	_p1.chargeshot_add, chargeshot_add_kotohime
		setfarfp	_chargeshot_update_p1, chargeshot_update_kotohime
		setfarfp	_chargeshot_render_p1, chargeshot_render_kotohime
		setfarfp	p1_2029C, kotohime_1C22E
		setfarfp	p1_202A4, kotohime_1C3DA
		setfarfp	p1_202AC, kotohime_1C3F2
		setfarfp	p1_1F32E, kotohime_11E48
		setfarfp	p1_1F336, kotohime_12140
		setfarfp	p1_205CE, sub_1501E
		setfarfp	bomb_p1, kotohime_bomb
		mov	_p1.hyper_func, offset hyper_kotohime
		mov	_p1.hyper, offset hyper_standby
		jmp	loc_ACED
; ---------------------------------------------------------------------------

loc_AC42:
		setfarfp	p2_1FE78, kotohime_19D60
		setfarfp	p2_1FE7C, kotohime_19FEF
		setfarfp	p2_1FE80, kotohime_1A14E
		setfarfp	_p2.chargeshot_add, chargeshot_add_kotohime
		setfarfp	_chargeshot_update_p2, chargeshot_update_kotohime
		setfarfp	_chargeshot_render_p2, chargeshot_render_kotohime
		setfarfp	p2_202A0, kotohime_1C22E
		setfarfp	p2_202A8, kotohime_1C3DA
		setfarfp	p2_202B0, kotohime_1C3F2
		setfarfp	p2_1F332, kotohime_11E48
		setfarfp	p2_1F33A, kotohime_12140
		setfarfp	p2_205D2, sub_1501E
		setfarfp	bomb_p2, kotohime_bomb
		mov	_p2.hyper_func, offset hyper_kotohime
		mov	_p2.hyper, offset hyper_standby
		call	sub_A4A1

loc_ACED:
		setfarfp	farfp_20F20, sub_D2E8
		setfarfp	farfp_20F24, sub_D340
		setfarfp	farfp_20F28, sub_D05D
		push	si
		call	kotohime_11A6D
		pop	si
		pop	bp
		retn	2
set_callbacks_kotohime	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

set_callbacks_kana	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_0]
		push	si
		push	0Bh
		call	sub_A4C3
		or	si, si
		jnz	loc_ADDA
		setfarfp	p1_1FE6C, kana_19825
		setfarfp	p1_1FE70, kana_19999
		setfarfp	p1_1FE74, kana_19A8D
		setfarfp	_p1.chargeshot_add, chargeshot_add_kana
		setfarfp	_chargeshot_update_p1, chargeshot_update_kana
		setfarfp	_chargeshot_render_p1, chargeshot_render_kana
		setfarfp	p1_2029C, kana_1BE52
		setfarfp	p1_202A4, kana_1C128
		setfarfp	p1_202AC, kana_1C140
		setfarfp	p1_1F32E, kana_12FE8
		setfarfp	p1_1F336, kana_132FE
		setfarfp	p1_205CE, sub_1501E
		setfarfp	bomb_p1, kana_bomb
		mov	_p1.hyper_func, offset hyper_kana
		mov	_p1.hyper, offset hyper_standby
		jmp	loc_AE85
; ---------------------------------------------------------------------------

loc_ADDA:
		setfarfp	p2_1FE78, kana_19825
		setfarfp	p2_1FE7C, kana_19999
		setfarfp	p2_1FE80, kana_19A8D
		setfarfp	_p2.chargeshot_add, chargeshot_add_kana
		setfarfp	_chargeshot_update_p2, chargeshot_update_kana
		setfarfp	_chargeshot_render_p2, chargeshot_render_kana
		setfarfp	p2_202A0, kana_1BE52
		setfarfp	p2_202A8, kana_1C128
		setfarfp	p2_202B0, kana_1C140
		setfarfp	p2_1F332, kana_12FE8
		setfarfp	p2_1F33A, kana_132FE
		setfarfp	p2_205D2, sub_1501E
		setfarfp	bomb_p2, kana_bomb
		mov	_p2.hyper_func, offset hyper_kana
		mov	_p2.hyper, offset hyper_standby
		call	sub_A4A1

loc_AE85:
		setfarfp	farfp_20F20, sub_D2E8
		setfarfp	farfp_20F24, sub_D340
		setfarfp	farfp_20F28, sub_D05D
		push	si
		call	kana_12BFB
		pop	si
		pop	bp
		retn	2
set_callbacks_kana	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

set_callbacks_rikako	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_0]
		push	si
		push	0Dh
		call	sub_A4C3
		or	si, si
		jnz	loc_AF72
		setfarfp	p1_1FE6C, rikako_1AFA2
		setfarfp	p1_1FE70, rikako_1B105
		setfarfp	p1_1FE74, rikako_1B231
		setfarfp	_p1.chargeshot_add, chargeshot_add_rikako
		setfarfp	_chargeshot_update_p1, chargeshot_update_rikako
		setfarfp	_chargeshot_render_p1, chargeshot_render_rikako
		setfarfp	p1_2029C, rikako_1C66B
		setfarfp	p1_202A4, rikako_1C8DA
		setfarfp	p1_202AC, rikako_1C8F2
		setfarfp	p1_1F32E, rikako_13661
		setfarfp	p1_1F336, rikako_1398B
		setfarfp	p1_205CE, sub_1501E
		setfarfp	bomb_p1, rikako_bomb
		mov	_p1.hyper_func, offset hyper_rikako
		mov	_p1.hyper, offset hyper_standby
		jmp	loc_B01D
; ---------------------------------------------------------------------------

loc_AF72:
		setfarfp	p2_1FE78, rikako_1AFA2
		setfarfp	p2_1FE7C, rikako_1B105
		setfarfp	p2_1FE80, rikako_1B231
		setfarfp	_p2.chargeshot_add, chargeshot_add_rikako
		setfarfp	_chargeshot_update_p2, chargeshot_update_rikako
		setfarfp	_chargeshot_render_p2, chargeshot_render_rikako
		setfarfp	p2_202A0, rikako_1C66B
		setfarfp	p2_202A8, rikako_1C8DA
		setfarfp	p2_202B0, rikako_1C8F2
		setfarfp	p2_1F332, rikako_13661
		setfarfp	p2_1F33A, rikako_1398B
		setfarfp	p2_205D2, sub_1501E
		setfarfp	bomb_p2, rikako_bomb
		mov	_p2.hyper_func, offset hyper_rikako
		mov	_p2.hyper, offset hyper_standby
		call	sub_A4A1

loc_B01D:
		setfarfp	farfp_20F20, sub_D092
		setfarfp	farfp_20F24, sub_D135
		setfarfp	farfp_20F28, sub_D05D
		push	si
		call	rikako_1334D
		pop	si
		pop	bp
		retn	2
set_callbacks_rikako	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

set_callbacks_chiyuri	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_0]
		push	si
		push	0Fh
		call	sub_A4C3
		or	si, si
		jnz	loc_B10A
		setfarfp	p1_1FE6C, chiyuri_18FEA
		setfarfp	p1_1FE70, chiyuri_19260
		setfarfp	p1_1FE74, chiyuri_1938A
		setfarfp	_p1.chargeshot_add, chargeshot_add_chiyuri
		setfarfp	_chargeshot_update_p1, chargeshot_update_chiyuri
		setfarfp	_chargeshot_render_p1, chargeshot_render_chiyuri
		setfarfp	p1_2029C, chiyuri_1B3B0
		setfarfp	p1_202A4, chiyuri_1B623
		setfarfp	p1_202AC, chiyuri_1B63B
		setfarfp	p1_1F32E, chiyuri_126A8
		setfarfp	p1_1F336, chiyuri_12B99
		setfarfp	p1_205CE, sub_1501E
		setfarfp	bomb_p1, chiyuri_bomb
		mov	_p1.hyper_func, offset hyper_chiyuri
		mov	_p1.hyper, offset hyper_standby
		jmp	loc_B1B5
; ---------------------------------------------------------------------------

loc_B10A:
		setfarfp	p2_1FE78, chiyuri_18FEA
		setfarfp	p2_1FE7C, chiyuri_19260
		setfarfp	p2_1FE80, chiyuri_1938A
		setfarfp	_p2.chargeshot_add, chargeshot_add_chiyuri
		setfarfp	_chargeshot_update_p2, chargeshot_update_chiyuri
		setfarfp	_chargeshot_render_p2, chargeshot_render_chiyuri
		setfarfp	p2_202A0, chiyuri_1B3B0
		setfarfp	p2_202A8, chiyuri_1B623
		setfarfp	p2_202B0, chiyuri_1B63B
		setfarfp	p2_1F332, chiyuri_126A8
		setfarfp	p2_1F33A, chiyuri_12B99
		setfarfp	p2_205D2, sub_1501E
		setfarfp	bomb_p2, chiyuri_bomb
		mov	_p2.hyper_func, offset hyper_chiyuri
		mov	_p2.hyper, offset hyper_standby
		call	sub_A4A1

loc_B1B5:
		setfarfp	farfp_20F20, sub_D2E8
		setfarfp	farfp_20F24, sub_D340
		setfarfp	farfp_20F28, sub_D05D
		push	si
		call	chiyuri_1219D
		pop	si
		pop	bp
		retn	2
set_callbacks_chiyuri	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

set_callbacks_yumemi	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_0]
		push	si
		push	11h
		call	sub_A4C3
		or	si, si
		jnz	loc_B2A2
		setfarfp	p1_1FE6C, yumemi_1A902
		setfarfp	p1_1FE70, yumemi_1AE2E
		setfarfp	p1_1FE74, yumemi_1AF72
		setfarfp	_p1.chargeshot_add, chargeshot_add_yumemi
		setfarfp	_chargeshot_update_p1, chargeshot_update_yumemi
		setfarfp	_chargeshot_render_p1, chargeshot_render_yumemi
		setfarfp	p1_2029C, yumemi_16B0C
		setfarfp	p1_202A4, yumemi_16FC0
		setfarfp	p1_202AC, yumemi_16FD8
		setfarfp	p1_1F32E, yumemi_1070A
		setfarfp	p1_1F336, yumemi_10BAB
		setfarfp	p1_205CE, sub_1501E
		setfarfp	bomb_p1, yumemi_bomb
		mov	_p1.hyper_func, offset hyper_yumemi
		mov	_p1.hyper, offset hyper_standby
		jmp	loc_B34D
; ---------------------------------------------------------------------------

loc_B2A2:
		setfarfp	p2_1FE78, yumemi_1A902
		setfarfp	p2_1FE7C, yumemi_1AE2E
		setfarfp	p2_1FE80, yumemi_1AF72
		setfarfp	_p2.chargeshot_add, chargeshot_add_yumemi
		setfarfp	_chargeshot_update_p2, chargeshot_update_yumemi
		setfarfp	_chargeshot_render_p2, chargeshot_render_yumemi
		setfarfp	p2_202A0, yumemi_16B0C
		setfarfp	p2_202A8, yumemi_16FC0
		setfarfp	p2_202B0, yumemi_16FD8
		setfarfp	p2_1F332, yumemi_1070A
		setfarfp	p2_1F33A, yumemi_10BAB
		setfarfp	p2_205D2, sub_1501E
		setfarfp	bomb_p2, yumemi_bomb
		mov	_p2.hyper_func, offset hyper_yumemi
		mov	_p2.hyper, offset hyper_standby
		call	sub_A4A1

loc_B34D:
		setfarfp	farfp_20F20, sub_D2E8
		setfarfp	farfp_20F24, sub_D340
		setfarfp	farfp_20F28, sub_D05D
		push	si
		call	yumemi_102C8
		pop	si
		pop	bp
		retn	2
set_callbacks_yumemi	endp


; =============== S U B	R O U T	I N E =======================================


sub_B37C	proc near
		mov	ax, 0A828h

loc_B37F:
		push	di
		mov	di, bx
		mov	es, ax
		assume es:nothing
		xor	eax, eax
		not	eax

loc_B38A:
		mov	cx, 9
		rep stosd
		sub	di, 74h	; 't'
		jge	short loc_B38A
		pop	di
		retn
sub_B37C	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================


sub_B398	proc near
		mov	ax, 0ABC0h
		jmp	short loc_B37F
sub_B398	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================


sub_B39E	proc far
		call	sub_B37C
		retf
sub_B39E	endp


; =============== S U B	R O U T	I N E =======================================


sub_B3A2	proc near
		push	di
		push	si
		EGC_SETUP_COPY
		mov	dx, ds
		mov	di, 232h
		mov	si, 40D8h
		mov	ax, 0ABC0h
		mov	es, ax
		assume es:nothing
		mov	ds, ax
		assume ds:nothing
		nop

loc_B3DE:
		mov	cx, 12h

loc_B3E1:
		movsw
		mov	es:[di+26h], ax
		loop	loc_B3E1
		sub	si, 74h	; 't'
		sub	di, 74h	; 't'
		jge	short loc_B3DE
		mov	ds, dx
		assume ds:_DATA
		pop	si
		pop	di
		retn
sub_B3A2	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================


sub_B3F6	proc near
		push	di
		push	si
		mov	di, 0F0h
		mov	ax, 0ABCAh
		mov	es, ax
		assume es:nothing
		mov	si, 50h	; 'P'
		mov	ax, dx
		and	ax, 0Fh
		add	bx, ax
		shr	dx, 4
		shl	dx, 1
		add	di, dx
		mov	ax, bx
		and	bx, 0Fh
		shl	bx, 1
		shr	ax, 4
		jz	short loc_B446
		mov	dx, ax
		shl	ax, 1
		add	si, ax
		xor	ax, ax
		not	ax
		nop
		mov	cx, dx
		rep stosw
		sub	di, si
		mov	cx, dx
		rep stosw
		sub	di, si
		mov	cx, dx
		rep stosw
		sub	di, si
		mov	cx, dx
		rep stosw
		or	bx, bx
		jz	short loc_B450
		add	di, 0F0h

loc_B446:
		mov	ax, [bx+64Ch]

loc_B44A:
		stosw
		sub	di, 52h	; 'R'
		jge	short loc_B44A

loc_B450:
		pop	si
		pop	di
		retn
sub_B3F6	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

; int __stdcall	__far sub_B454(char *arg0)
sub_B454	proc far

_arg0		= dword	ptr  6

		push	bp
		mov	bp, sp
		freePISlotLarge	0
		call	super_free
		call	graph_hide
		call	text_clear
		call	gaiji_restore
		call	@mrs_free$qi pascal, 0
		call	@mrs_free$qi pascal, 1
		call	_game_exit
		pushd	0
		pushd	[bp+_arg0]	; arg0
		pushd	[bp+_arg0]	; path
		call	_execl
		add	sp, 0Ch
		pop	bp
		retf	4
sub_B454	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_B4A3	proc near
		push	bp
		mov	bp, sp
		pop	bp
		retn
sub_B4A3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_B4A8	proc near
		push	bp
		mov	bp, sp
		push	si
		cmp	byte_1FBC2, 0
		jnz	short loc_B4E3
		mov	word_1FBC4, 12Fh
		mov	word_1FBC6, 17Eh
		mov	word_1FBC8, 10h
		mov	word_1FBCA, 17Eh
		mov	word_1FBCC, 10h
		mov	word_1FBCE, 10h
		mov	word_1FBD0, 12Fh
		mov	word_1FBD2, 10h

loc_B4E3:
		call	grc_setclip pascal, (8 shl 16) or 0, (623 shl 16) or 191
		sub	word_1FBC4, 12h
		sub	word_1FBCA, 17h
		add	word_1FBCC, 12h
		add	word_1FBD2, 17h
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 2
		mov	trapezoid_hmask, 5555h
		xor	si, si
		jmp	short loc_B565
; ---------------------------------------------------------------------------

loc_B51D:
		lea	ax, [si+303]
		push	ax
		push	8
		lea	ax, [si+303]
		push	ax
		push	191
		mov	ax, word_1FBC4
		add	ax, si
		push	ax
		mov	ax, word_1FBC6
		cwd
		sub	ax, dx
		sar	ax, 1
		push	ax
		call	grcg_triangle
		lea	ax, [si+16]
		push	ax
		push	8
		lea	ax, [si+16]
		push	ax
		push	191
		mov	ax, word_1FBCC
		add	ax, si
		push	ax
		mov	ax, word_1FBCE
		cwd
		sub	ax, dx
		sar	ax, 1
		push	ax
		call	grcg_triangle
		add	si, 140h

loc_B565:
		cmp	si, 140h
		jle	short loc_B51D
		mov	trapezoid_hmask, 0AAAAh
		xor	si, si
		jmp	short loc_B5BD
; ---------------------------------------------------------------------------

loc_B575:
		lea	ax, [si+16]
		push	ax
		push	191
		lea	ax, [si+303]
		push	ax
		push	191
		mov	ax, word_1FBC8
		add	ax, si
		push	ax
		mov	ax, word_1FBCA
		cwd
		sub	ax, dx
		sar	ax, 1
		push	ax
		call	grcg_triangle
		lea	ax, [si+16]
		push	ax
		push	8
		lea	ax, [si+303]
		push	ax
		push	8
		mov	ax, word_1FBD0
		add	ax, si
		push	ax
		mov	ax, word_1FBD2
		cwd
		sub	ax, dx
		sar	ax, 1
		push	ax
		call	grcg_triangle
		add	si, 140h

loc_B5BD:
		cmp	si, 140h
		jle	short loc_B575
		inc	byte_1FBC2
		cmp	byte_1FBC2, 10h
		jb	short loc_B5EE
		mov	bx, 3932h
		nopcall	sub_B39E
		mov	bx, 395Ah
		nopcall	sub_B39E
		mov	byte_1FBC3, 1
		mov	byte_1FBC2, 0
		mov	fp_1FBC0, offset sub_B60A

loc_B5EE:
		mov	trapezoid_hmask, 0FFFFh
		call	grcg_off
		call	grc_setclip pascal, large 0, ((RES_X - 1) shl 16) or (SPRITE16_RES_Y - 1)
		pop	si
		pop	bp
		retn
sub_B4A8	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_B60A	proc near
		push	bp
		mov	bp, sp
		push	si
		cmp	byte_1FBC2, 0
		jnz	short loc_B645
		mov	word_1FBC4, 12Fh
		mov	word_1FBC6, 10h
		mov	word_1FBC8, 12Fh
		mov	word_1FBCA, 17Eh
		mov	word_1FBCC, 10h
		mov	word_1FBCE, 17Eh
		mov	word_1FBD0, 10h
		mov	word_1FBD2, 10h

loc_B645:
		call	grc_setclip pascal, (16 shl 16) or 0, (623 shl 16) or 191
		add	word_1FBC6, 17h
		sub	word_1FBC8, 12h
		sub	word_1FBCE, 17h
		add	word_1FBD0, 12h
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 2
		xor	si, si
		jmp	loc_B706
; ---------------------------------------------------------------------------

loc_B67A:
		lea	ax, [si+16]
		push	ax
		push	191
		lea	ax, [si+303]
		push	ax
		push	191
		mov	ax, word_1FBC4
		add	ax, si
		push	ax
		mov	ax, word_1FBC6
		cwd
		sub	ax, dx
		sar	ax, 1
		push	ax
		call	grcg_triangle
		lea	ax, [si+16]
		push	ax
		push	8
		lea	ax, [si+16]
		push	ax
		push	191
		mov	ax, word_1FBC8
		add	ax, si
		push	ax
		mov	ax, word_1FBCA
		cwd
		sub	ax, dx
		sar	ax, 1
		push	ax
		call	grcg_triangle
		lea	ax, [si+16]
		push	ax
		push	8
		lea	ax, [si+303]
		push	ax
		push	8
		mov	ax, word_1FBCC
		add	ax, si
		push	ax
		mov	ax, word_1FBCE
		cwd
		sub	ax, dx
		sar	ax, 1
		push	ax
		call	grcg_triangle
		lea	ax, [si+303]
		push	ax
		push	8
		lea	ax, [si+303]
		push	ax
		push	191
		mov	ax, word_1FBD0
		add	ax, si
		push	ax
		mov	ax, word_1FBD2
		cwd
		sub	ax, dx
		sar	ax, 1
		push	ax
		call	grcg_triangle
		add	si, 140h

loc_B706:
		cmp	si, 140h
		jle	loc_B67A
		inc	byte_1FBC2
		cmp	byte_1FBC2, 10h
		jb	short loc_B724
		mov	byte_1FBC2, 0
		mov	fp_1FBC0, offset sub_B4A3

loc_B724:
		call	grcg_off
		call	grc_setclip pascal, large 0, ((RES_X - 1) shl 16) or (SPRITE16_RES_Y - 1)
		pop	si
		pop	bp
		retn
sub_B60A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_B73A	proc far

@@pid		= word ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	di, [bp+arg_4]
		inc	byte_1FDE0
		cmp	byte_1FDE0, 0Ch
		jb	short loc_B752
		mov	byte_1FDE0, 0

loc_B752:
		mov	al, byte_1FDE0
		mov	ah, 0
		imul	ax, 6
		add	ax, 2832h
		mov	si, ax
		mov	byte ptr [si], 1
		mov	al, byte ptr [bp+@@pid]
		mov	[si+1],	al
		cmp	byte_1FDE1, 0
		jnz	short loc_B792
		mov	ax, word_20E32
		add	ax, ax
		push	ax
		call	randring_far_next16_mod
		add	ax, word_20E2E
		mov	di, ax
		mov	ax, word_20E34
		add	ax, ax
		push	ax
		call	randring_far_next16_mod
		add	ax, word_20E30
		mov	[bp+arg_2], ax

loc_B792:
		push	di
		push	[bp+@@pid]
		nopcall	playfield_fg_x_to_screen
		add	ax, -24
		mov	[si+2],	ax
		mov	ax, [bp+arg_2]
		sar	ax, 4
		add	ax, 0FFF8h
		mov	[si+4],	ax
		pop	di
		pop	si
		pop	bp
		retf	6
sub_B73A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_B7B3	proc far

@@pid		= word ptr  6
arg_2		= word ptr  8
@@x		= word ptr  0Ah

		push	bp
		mov	bp, sp
		push	si
		mov	si, 287Ah
		mov	byte ptr [si], 1
		mov	al, byte ptr [bp+@@pid]
		mov	[si+1],	al
		push	[bp+@@x]
		push	[bp+@@pid]
		nopcall	playfield_fg_x_to_screen
		add	ax, -24
		mov	[si+2],	ax
		mov	ax, [bp+arg_2]
		sar	ax, 4
		add	ax, 0FFF8h
		mov	[si+4],	ax
		pop	si
		pop	bp
		retf	6
sub_B7B3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_B7E5	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	si, 2832h
		xor	ax, ax
		jmp	short loc_B803
; ---------------------------------------------------------------------------

loc_B7F0:
		cmp	byte ptr [si], 0
		jz	short loc_B7FF
		inc	byte ptr [si]
		cmp	byte ptr [si], 10h
		jbe	short loc_B7FF
		mov	byte ptr [si], 0

loc_B7FF:
		inc	ax
		add	si, 6

loc_B803:
		cmp	ax, 0Dh
		jl	short loc_B7F0
		pop	si
		pop	bp
		retn
sub_B7E5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_B80B	proc near

@@sprite_offset		= word ptr -2

		enter	2, 0
		push	si
		push	di
		mov	si, 2832h
		mov	dx, 1
		mov	ah, SPRITE16_SET_MONO
		int	SPRITE16
		mov	dx, word_23AF6
		; Hack (and dx, 1)
		db 081h
		db 0e2h
		db 001h
		db 000h
		add	dx, 11
		mov	ah, SPRITE16_SET_COLOR
		int	SPRITE16
		mov	_sprite16_put_w, (48 / 16)
		mov	_sprite16_put_h, 24
		xor	di, di
		jmp	short loc_B88F
; ---------------------------------------------------------------------------

loc_B839:
		cmp	byte ptr [si], 0
		jz	short loc_B88B
		cmp	byte ptr [si+1], 0
		jnz	short loc_B852
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_B85E
; ---------------------------------------------------------------------------

loc_B852:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_B85E:
		mov	al, [si]
		mov	ah, 0
		dec	ax
		mov	bx, ax
		mov	ax, bx
		shr	ax, 2
		mov	bx, ax
		mov	ax, 2
		imul	bx
		mov	bx, ax
		mov	ax, bx
		add	ax, bx
		add	ax, bx
		add	ax, 1910h
		mov	[bp+@@sprite_offset], ax
		call	sprite16_put pascal, word ptr [si+2], word ptr [si+4], ax

loc_B88B:
		inc	di
		add	si, 6

loc_B88F:
		cmp	di, 0Ch
		jl	short loc_B839
		mov	dx, 15
		mov	ah, SPRITE16_SET_COLOR
		int	SPRITE16
		cmp	byte ptr [si], 0
		jz	short loc_B8ED
		cmp	byte ptr [si+1], 0
		jnz	short loc_B8B4
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_B8C0
; ---------------------------------------------------------------------------

loc_B8B4:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_B8C0:
		mov	al, [si]
		mov	ah, 0
		dec	ax
		mov	bx, ax
		mov	ax, bx
		shr	ax, 2
		mov	bx, ax
		mov	ax, 2
		imul	bx
		mov	bx, ax
		mov	ax, bx
		add	ax, bx
		add	ax, bx
		add	ax, 1910h
		mov	[bp+@@sprite_offset], ax
		call	sprite16_put pascal, word ptr [si+2], word ptr [si+4], ax

loc_B8ED:
		xor	dx, dx
		mov	ah, SPRITE16_SET_MONO
		int	SPRITE16
		pop	di
		pop	si
		leave
		retn
sub_B80B	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_B8F7	proc far
		push	bp
		mov	bp, sp
		call	text_fillca pascal, (' ' shl 16) + TX_BLACK + TX_REVERSE
		call	text_boxfilla pascal, (2 shl 16) + 1, (37 shl 16) + 24, TX_WHITE
		call	text_boxfilla pascal, (42 shl 16) + 1, (77 shl 16) + 24, TX_WHITE
		pop	bp
		retf
sub_B8F7	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_B92F	proc far

var_4		= word ptr -4
@@halfhearts		= word ptr -2
arg_0		= byte ptr  6

		enter	4, 0
		push	si
		push	di
		xor	di, di
		cmp	[bp+arg_0], 0
		jnz	short loc_B942
		mov	si, 0Fh
		jmp	short loc_B945
; ---------------------------------------------------------------------------

loc_B942:
		mov	si, 37h	; '7'

loc_B945:
		mov	[bp+var_4], 1
		mov	al, [bp+arg_0]
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	al, _players[bx].halfhearts
		cbw
		mov	[bp+@@halfhearts], ax
		jmp	short loc_B984
; ---------------------------------------------------------------------------

loc_B95E:
		mov	ax, [bp+@@halfhearts]
		sub	ax, di
		cmp	ax, 2
		jl	short loc_B970
		push	si
		push	[bp+var_4]
		push	5
		jmp	short loc_B976
; ---------------------------------------------------------------------------

loc_B970:
		push	si
		push	[bp+var_4]
		push	6

loc_B976:
		push	TX_WHITE
		call	gaiji_putca
		add	si, 2
		add	di, 2

loc_B984:
		cmp	di, [bp+@@halfhearts]
		jl	short loc_B95E
		jmp	short loc_B9A0
; ---------------------------------------------------------------------------

loc_B98B:
		call	gaiji_putca pascal, si, [bp+var_4], (4 shl 16) + TX_WHITE
		add	si, 2
		add	di, 2

loc_B9A0:
		cmp	di, 0Ah
		jl	short loc_B98B
		pop	di
		pop	si
		leave
		retf	2
sub_B92F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_B9AB	proc far

var_6		= word ptr -6
var_4		= word ptr -4
@@bombs		= word ptr -2
arg_0		= byte ptr  6

		enter	6, 0
		push	si
		push	di
		xor	di, di
		cmp	[bp+arg_0], 0
		jnz	short loc_B9C3
		mov	si, 24h	; '$'
		mov	[bp+var_6], 0FFFEh
		jmp	short loc_B9CB
; ---------------------------------------------------------------------------

loc_B9C3:
		mov	si, 2Ah	; '*'
		mov	[bp+var_6], 2

loc_B9CB:
		mov	[bp+var_4], 17h
		mov	al, [bp+arg_0]
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	al, _players[bx].bombs
		mov	ah, 0
		mov	[bp+@@bombs], ax
		jmp	short loc_B9F8
; ---------------------------------------------------------------------------

loc_B9E5:
		call	gaiji_putca pascal, si, [bp+var_4], (7 shl 16) + TX_WHITE
		add	si, [bp+var_6]
		inc	di

loc_B9F8:
		cmp	di, [bp+@@bombs]
		jl	short loc_B9E5
		call	gaiji_putca pascal, si, [bp+var_4], (0CFh shl 16) + TX_WHITE
		pop	di
		pop	si
		leave
		retf	2
sub_B9AB	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_BA12	proc near

@@rounds		= word ptr -2
arg_0		= byte ptr  4

		enter	2, 0
		push	si
		push	di
		xor	di, di
		cmp	[bp+arg_0], 0
		jnz	short loc_BA25
		mov	si, 2
		jmp	short loc_BA28
; ---------------------------------------------------------------------------

loc_BA25:
		mov	si, 2Ah	; '*'

loc_BA28:
		mov	al, [bp+arg_0]
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	al, _players[bx].rounds_won
		mov	ah, 0
		mov	[bp+@@rounds], ax
		jmp	short loc_BA50
; ---------------------------------------------------------------------------

loc_BA3D:
		call	gaiji_putca pascal, si, (1 shl 16) + 9, TX_WHITE
		add	si, 2
		inc	di

loc_BA50:
		cmp	di, [bp+@@rounds]
		jl	short loc_BA3D
		pop	di
		pop	si
		leave
		retn	2
sub_BA12	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_BA5B	proc near

@@lives		= word ptr -2

		enter	2, 0
		push	si
		push	di
		xor	si, si
		mov	di, 24h	; '$'
		les	bx, _resident
		assume es:nothing
		mov	al, es:[bx+resident_t.story_lives]
		mov	ah, 0
		mov	[bp+@@lives], ax
		jmp	short loc_BA88
; ---------------------------------------------------------------------------

loc_BA75:
		call	gaiji_putca pascal, di, (2 shl 16) + 2, TX_WHITE
		sub	di, 2
		inc	si

loc_BA88:
		cmp	si, [bp+@@lives]
		jl	short loc_BA75
		pop	di
		pop	si
		leave
		retn
sub_BA5B	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_BA91	proc far

arg_0		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	di, 2
		cmp	[bp+arg_0], 0
		jz	short loc_BAA2
		add	di, 28h	; '('

loc_BAA2:
		mov	bx, [bp+arg_0]
		mov	al, [bx+2D56h]
		mov	ah, 0
		mov	si, ax
		push	di
		push	24
		add	ax, 1Fh
		push	ax
		push	TX_GREEN
		call	gaiji_putca
		add	di, 22h	; '"'
		mov	al, byte_1F39E
		mov	ah, 0
		mov	si, ax
		cmp	si, 10h
		jl	short loc_BACC
		dec	si

loc_BACC:
		push	di
		push	24
		lea	ax, [si+20h]
		push	ax
		push	TX_RED
		call	gaiji_putca
		pop	di
		pop	si
		pop	bp
		retf	2
sub_BA91	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_BAE0	proc far
		push	bp
		mov	bp, sp
		push	si
		xor	si, si
		jmp	short loc_BAFC
; ---------------------------------------------------------------------------

loc_BAE8:
		push	si
		call	sub_B92F
		push	si
		call	sub_B9AB
		push	si
		call	sub_BA12
		push	si
		call	sub_BA91
		inc	si

loc_BAFC:
		cmp	si, 2
		jl	short loc_BAE8
		les	bx, _resident
		cmp	es:[bx+resident_t.game_mode], GM_STORY
		jnz	short loc_BB0F
		call	sub_BA5B

loc_BB0F:
		pop	si
		pop	bp
		retf
sub_BAE0	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_BB12	proc near

var_3		= byte ptr -3
var_2		= word ptr -2

		enter	4, 0
		push	si
		push	di
		cmp	byte_207E2, 1
		jnz	short loc_BB86
		mov	word_20CE8, 0
		mov	word_20CE4, 3284h
		mov	di, 0FEE0h
		mov	[bp+var_2], 54h	; 'T'
		xor	si, si
		jmp	short loc_BB58
; ---------------------------------------------------------------------------

loc_BB37:
		mov	bx, word_20CE4
		mov	[bx], di
		mov	ax, [bp+var_2]
		mov	[bx+2],	ax
		mov	word ptr [bx+4], 8
		mov	byte ptr [bx+7], 1
		inc	si
		add	word_20CE4, 0Ah
		inc	[bp+var_2]
		add	di, 8

loc_BB58:
		cmp	si, 10h
		jl	short loc_BB37
		mov	byte_20CE6, 0
		les	bx, _resident
		cmp	es:[bx+resident_t.game_mode], GM_STORY
		jnz	short loc_BB75
		mov	word_20CEA, 16h
		jmp	short loc_BB7B
; ---------------------------------------------------------------------------

loc_BB75:
		mov	word_20CEA, 1Ah

loc_BB7B:
		mov	byte_207E2, 2
		mov	x_20CEC, 0

loc_BB86:
		cmp	byte_20CE6, 0
		jnz	short loc_BBEC
		mov	word_20CE4, 3284h
		xor	si, si
		jmp	short loc_BBE4
; ---------------------------------------------------------------------------

loc_BB97:
		mov	bx, word_20CE4
		cmp	byte ptr [bx+7], 0
		jz	short loc_BBDE
		mov	bx, word_20CE4
		mov	ax, [bx+4]
		add	[bx], ax
		cmp	byte ptr [bx+7], 1
		jnz	short loc_BBBB
		cmp	word ptr [bx], 60h
		jl	short loc_BBDE
		mov	byte ptr [bx+7], 2
		jmp	short loc_BBDE
; ---------------------------------------------------------------------------

loc_BBBB:
		mov	bx, word_20CE4
		cmp	word ptr [bx], 40h
		jg	short loc_BBD7
		mov	word ptr [bx], 40h
		mov	byte ptr [bx+7], 0
		or	si, si
		jnz	short loc_BBDE
		mov	byte_20CE6, 1
		jmp	short loc_BBDE
; ---------------------------------------------------------------------------

loc_BBD7:
		mov	bx, word_20CE4
		dec	word ptr [bx+4]

loc_BBDE:
		inc	si
		add	word_20CE4, 0Ah

loc_BBE4:
		cmp	si, 10h
		jl	short loc_BB97
		jmp	loc_BDBE
; ---------------------------------------------------------------------------

loc_BBEC:
		cmp	byte_20CE6, 1
		jnz	short loc_BC07
		inc	word_20CE8
		cmp	word_20CE8, 56h	; 'V'
		jle	loc_BDBE
		inc	byte_20CE6
		jmp	loc_BDBE
; ---------------------------------------------------------------------------

loc_BC07:
		cmp	byte_20CE6, 2
		jnz	loc_BCDD
		mov	word_20CE4, 3284h
		mov	di, 600h
		xor	si, si
		jmp	short loc_BC6E
; ---------------------------------------------------------------------------

loc_BC1D:
		mov	bx, word_20CE4
		mov	[bx], di
		push	1FFh
		call	randring1_next16_and
		add	ax, 0A80h
		mov	bx, word_20CE4
		mov	[bx+2],	ax
		call	randring1_next16
		mov	bx, word_20CE4
		mov	[bx+6],	al
		call	IRand
		mov	bx, 3
		cwd
		idiv	bx
		mov	bx, word_20CE4
		mov	[bx+8],	dl
		call	IRand
		mov	bx, 3
		cwd
		idiv	bx
		mov	bx, word_20CE4
		mov	[bx+9],	dl
		mov	byte ptr [bx+7], 1
		inc	si
		add	word_20CE4, 0Ah
		add	di, 20h	; ' '

loc_BC6E:
		cmp	si, 40h
		jl	short loc_BC1D
		mov	di, 1A00h
		xor	si, si
		jmp	short loc_BCCB
; ---------------------------------------------------------------------------

loc_BC7A:
		mov	bx, word_20CE4
		mov	[bx], di
		push	1FFh
		call	randring1_next16_and
		add	ax, 0A80h
		mov	bx, word_20CE4
		mov	[bx+2],	ax
		call	randring1_next16
		mov	bx, word_20CE4
		mov	[bx+6],	al
		call	IRand
		mov	bx, 3
		cwd
		idiv	bx
		mov	bx, word_20CE4
		mov	[bx+8],	dl
		call	IRand
		mov	bx, 3
		cwd
		idiv	bx
		mov	bx, word_20CE4
		mov	[bx+9],	dl
		mov	byte ptr [bx+7], 1
		inc	si
		add	word_20CE4, 0Ah
		add	di, 20h	; ' '

loc_BCCB:
		cmp	si, 40h
		jl	short loc_BC7A
		inc	byte_20CE6
		mov	word_20CE8, 0
		jmp	loc_BDBE
; ---------------------------------------------------------------------------

loc_BCDD:
		cmp	byte_20CE6, 3
		jnz	loc_BDB9
		inc	word_20CE8
		cmp	word_20CE8, 40h
		jl	short loc_BCF5
		inc	byte_20CE6

loc_BCF5:
		mov	word_20CE4, 3284h
		xor	si, si
		jmp	loc_BDAF
; ---------------------------------------------------------------------------

loc_BD00:
		mov	bx, word_20CE4
		cmp	byte ptr [bx+7], 0
		jz	loc_BDA9
		mov	bx, word_20CE4
		mov	al, [bx+6]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, large (80 shl 16) or 0, _CosTable8[bx]
		mov	di, ax
		mov	bx, word_20CE4
		mov	al, [bx+6]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, large (80 shl 16) or 0, _SinTable8[bx]
		mov	[bp+var_2], ax
		mov	bx, word_20CE4
		add	[bx], di
		add	[bx+2],	ax
		cmp	word ptr [bx], 0
		jl	short loc_BD70
		cmp	word ptr [bx], 2700h
		jge	short loc_BD70
		cmp	word ptr [bx+2], 0
		jl	short loc_BD70
		cmp	word ptr [bx+2], 1800h
		jl	short loc_BD7A

loc_BD70:
		mov	bx, word_20CE4
		mov	byte ptr [bx+7], 0
		jmp	short loc_BDA9
; ---------------------------------------------------------------------------

loc_BD7A:
		cmp	word_20CE8, 20h	; ' '
		jge	short loc_BD8A
		mov	bx, word_20CE4
		mov	al, [bx+8]
		jmp	short loc_BD91
; ---------------------------------------------------------------------------

loc_BD8A:
		mov	bx, word_20CE4
		mov	al, [bx+9]

loc_BD91:
		mov	[bp+var_3], al
		dec	[bp+var_3]
		mov	bx, word_20CE4
		mov	al, [bx+6]
		mov	dl, [bp+var_3]
		shl	dl, 2
		add	al, dl
		mov	[bx+6],	al

loc_BDA9:
		inc	si
		add	word_20CE4, 0Ah

loc_BDAF:
		cmp	si, 80h
		jl	loc_BD00
		jmp	short loc_BDBE
; ---------------------------------------------------------------------------

loc_BDB9:
		mov	byte_207E2, 0

loc_BDBE:
		pop	di
		pop	si
		leave
		retn
sub_BB12	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_BDC2	proc near

arg_0		= word ptr  4
arg_2		= word ptr  6
arg_4		= word ptr  8
arg_6		= word ptr  0Ah

		push	bp
		mov	bp, sp
		push	si
		push	di
		push	ds
		mov	ax, 0A800h
		mov	es, ax
		assume es:nothing
		mov	cx, [bp+arg_6]
		; Hack (and cx, 7)
		db 081h
		db 0e1h
		db 007h
		db 000h
		mov	ax, [bp+arg_6]
		mov	bx, [bp+arg_4]
		sar	ax, 3
		shl	bx, 6
		add	ax, bx
		shr	bx, 2
		add	ax, bx
		mov	di, ax
		mov	bx, [bp+arg_2]
		shl	bx, 1
		add	bx, 11FCh
		mov	ax, [bx]
		mov	ds, ax
		mov	ax, [bp+arg_0]
		shl	ax, 2
		add	ax, 80h
		mov	si, ax
		mov	bx, 4

loc_BE04:
		cmp	[bp+arg_6], 0
		jl	short loc_BE1A
		cmp	[bp+arg_6], 270h
		jge	short loc_BE23
		xor	ah, ah
		mov	al, [si]
		ror	ax, cl
		mov	es:[di], ax

loc_BE1A:
		inc	si
		inc	di
		add	[bp+arg_6], 8
		dec	bx
		jnz	short loc_BE04

loc_BE23:
		pop	ds
		pop	di
		pop	si
		pop	bp
		retn	8
sub_BDC2	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_BE2A	proc near

arg_0		= word ptr  4
arg_2		= word ptr  6

		push	bp
		mov	bp, sp
		push	di
		mov	ax, [bp+arg_2]
		mov	bx, [bp+arg_0]
		sar	ax, 7
		shr	bx, 5
		shl	bx, 6
		add	ax, bx
		shr	bx, 2
		add	ax, bx
		mov	di, ax
		mov	cx, [bp+arg_2]
		shr	cx, 4
		; Hack (and cx, 7)
		db 081h
		db 0e1h
		db 007h
		db 000h
		mov	bx, 0C0h
		ror	bx, cl
		mov	es:[di], bx
		pop	di
		pop	bp
		retn	4
sub_BE2A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_BE5D	proc near
		push	bp
		mov	bp, sp
		push	si
		cmp	byte_207E2, 0
		jz	loc_C0D5
		cmp	byte_20CE6, 0
		jnz	loc_BF51
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 15
		mov	word_20CE4, 3284h
		xor	si, si
		jmp	loc_BF41
; ---------------------------------------------------------------------------

loc_BE89:
		mov	bx, word_20CE4
		push	word ptr [bx]
		push	word ptr [bx+2]
		push	word_20CEA
		push	si
		call	sub_BDC2
		mov	bx, word_20CE4
		mov	ax, [bx]
		add	ax, 20h	; ' '
		push	ax
		push	word ptr [bx+2]
		mov	ax, word_20CEA
		inc	ax
		push	ax
		push	si
		call	sub_BDC2
		mov	bx, word_20CE4
		mov	ax, [bx]
		add	ax, 40h
		push	ax
		push	word ptr [bx+2]
		mov	ax, word_20CEA
		add	ax, 2
		push	ax
		push	si
		call	sub_BDC2
		mov	bx, word_20CE4
		mov	ax, [bx]
		add	ax, 60h
		push	ax
		push	word ptr [bx+2]
		mov	ax, word_20CEA
		add	ax, 3
		push	ax
		push	si
		call	sub_BDC2
		mov	bx, word_20CE4
		mov	ax, 220h
		sub	ax, [bx]
		push	ax
		push	word ptr [bx+2]
		mov	ax, word_20CEA
		add	ax, 3
		push	ax
		push	si
		call	sub_BDC2
		mov	bx, word_20CE4
		mov	ax, 200h
		sub	ax, [bx]
		push	ax
		push	word ptr [bx+2]
		mov	ax, word_20CEA
		add	ax, 2
		push	ax
		push	si
		call	sub_BDC2
		mov	bx, word_20CE4
		mov	ax, 1E0h
		sub	ax, [bx]
		push	ax
		push	word ptr [bx+2]
		mov	ax, word_20CEA
		inc	ax
		push	ax
		push	si
		call	sub_BDC2
		mov	bx, word_20CE4
		mov	ax, 1C0h
		sub	ax, [bx]
		push	ax
		push	word ptr [bx+2]
		push	word_20CEA
		push	si
		call	sub_BDC2
		inc	si
		add	word_20CE4, 0Ah

loc_BF41:
		cmp	si, 10h
		jl	loc_BE89
		mov	ax, word_2087A
		mov	x_20CEC, ax
		jmp	loc_C0D0
; ---------------------------------------------------------------------------

loc_BF51:
		cmp	byte_20CE6, 1
		jnz	loc_C08D
		les	bx, _resident
		assume es:nothing
		cmp	es:[bx+resident_t.game_mode], GM_STORY
		jz	short loc_BF9B
		cmp	word_20CE8, 18h
		jl	short loc_BF92
		cmp	word_20CE8, 40h
		jge	short loc_BF92
		push	(208 shl 16) or 84
		mov	al, byte_207E3
		mov	ah, 0
		add	ax, 34
		push	ax
		call	super_put
		push	(544 shl 16) or 84
		mov	al, byte_207E3
		jmp	short loc_BFD0
; ---------------------------------------------------------------------------

loc_BF92:
		cmp	word_20CE8, 40h
		jnz	short loc_BFF0
		jmp	short loc_BFE4
; ---------------------------------------------------------------------------

loc_BF9B:
		cmp	word_20CE8, 18h
		jl	short loc_BFDD
		cmp	word_20CE8, 38h	; '8'
		jge	short loc_BFDD
		push	(208 shl 16) or 84
		les	bx, _resident
		mov	al, es:[bx+resident_t.story_stage]
		mov	ah, 0
		add	ax, 34
		push	ax
		call	super_put
		push	(544 shl 16) or 84
		les	bx, _resident
		mov	al, es:[bx+resident_t.story_stage]

loc_BFD0:
		mov	ah, 0
		add	ax, 34
		push	ax
		call	super_put
		jmp	short loc_BFF0
; ---------------------------------------------------------------------------

loc_BFDD:
		cmp	word_20CE8, 38h	; '8'
		jnz	short loc_BFF0

loc_BFE4:
		mov	x_20CEC, 96
		mov	word_20CEA, 30

loc_BFF0:
		call	super_put pascal, x_20CEC, 84, word_20CEA
		mov	ax, x_20CEC
		add	ax, 32
		push	ax
		push	84
		mov	ax, word_20CEA
		inc	ax
		push	ax
		call	super_put
		mov	ax, x_20CEC
		add	ax, 64
		push	ax
		push	84
		mov	ax, word_20CEA
		add	ax, 2
		push	ax
		call	super_put
		mov	ax, x_20CEC
		add	ax, 96
		push	ax
		push	84
		mov	ax, word_20CEA
		add	ax, 3
		push	ax
		call	super_put
		mov	ax, x_20CEC
		add	ax, 320
		call	super_put pascal, ax, 84, word_20CEA
		mov	ax, x_20CEC
		add	ax, 352
		push	ax
		push	84
		mov	ax, word_20CEA
		inc	ax
		push	ax
		call	super_put
		mov	ax, x_20CEC
		add	ax, 384
		push	ax
		push	84
		mov	ax, word_20CEA
		add	ax, 2
		push	ax
		call	super_put
		mov	ax, x_20CEC
		add	ax, 416
		push	ax
		push	84
		mov	ax, word_20CEA
		add	ax, 3
		push	ax
		call	super_put
		jmp	short loc_C0D5
; ---------------------------------------------------------------------------

loc_C08D:
		cmp	byte_20CE6, 3
		jnz	short loc_C0D5
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 15
		mov	ax, 0A800h
		mov	es, ax
		assume es:nothing
		mov	word_20CE4, 3284h
		xor	si, si
		jmp	short loc_C0CA
; ---------------------------------------------------------------------------

loc_C0AE:
		mov	bx, word_20CE4
		cmp	byte ptr [bx+7], 0
		jz	short loc_C0C4
		mov	bx, word_20CE4
		push	word ptr [bx]
		push	word ptr [bx+2]
		call	sub_BE2A

loc_C0C4:
		inc	si
		add	word_20CE4, 0Ah

loc_C0CA:
		cmp	si, 80h
		jl	short loc_C0AE

loc_C0D0:
		call	grcg_off

loc_C0D5:
		pop	si
		pop	bp
		retn
sub_BE5D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_C0D8	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_0]
		cmp	byte ptr [si+1Fh], 30h ; '0'
		jnz	short loc_C127
		push	word ptr [si]
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		push	ax
		nopcall	playfield_fg_x_to_screen
		add	ax, -24
		mov	word_20E3E, ax
		mov	ax, [si+2]
		sar	ax, 4
		add	ax, 0FFF8h
		mov	word_20E40, ax
		mov	byte_20E3C, 1
		call	snd_se_play pascal, 14
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, 1
		sub	bx, ax
		mov	_damage_all_enemies_on[bx], 1
		mov	word_20E42, 0
		jmp	short loc_C12C
; ---------------------------------------------------------------------------

loc_C127:
		add	word_20E42, 9

loc_C12C:
		mov	al, [si+1Fh]
		mov	ah, 0
		and	ax, 3
		cmp	ax, 2
		jge	short loc_C14A
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 6
		jmp	short loc_C159
; ---------------------------------------------------------------------------

loc_C14A:
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], -6

loc_C159:
		mov	byte_23AF9, 2
		dec	byte ptr [si+1Fh]
		cmp	byte ptr [si+1Fh], 0
		jnz	short loc_C1CD
		mov	word_20E3E, 0
		mov	word_20E40, 0
		mov	word_20E42, 0
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 0
		mov	byte ptr [si+1Fh], -1
		mov	PaletteTone, 100
		call	far ptr	palette_show
		mov	byte_20E3C, 2
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, 1
		sub	bx, ax
		shl	bx, 7
		inc	_players[bx].rounds_won
		les	bx, _resident
		assume es:nothing
		mov	al, 1
		sub	al, byte ptr word_23AF0
		mov	es:[bx+resident_t.pid_winner], al
		mov	word_23AF6, 0
		mov	al, 1
		sub	al, byte ptr word_23AF0
		push	ax
		call	sub_BA12
		jmp	short loc_C1E1
; ---------------------------------------------------------------------------

loc_C1CD:
		mov	ax, word_23AF6
		and	ax, 1
		imul	ax, 30
		add	ax, 100
		mov	PaletteTone, ax
		call	far ptr	palette_show

loc_C1E1:
		pop	si
		pop	bp
		retn	2
sub_C0D8	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_C1E6	proc near

@@top		= word ptr -4
@@left		= word ptr -2
arg_0		= byte ptr  4
arg_2		= byte ptr  6

		enter	4, 0
		mov	al, [bp+arg_2]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_20E3E, word_20E42, _CosTable8[bx]
		mov	dl, byte ptr word_23AF0
		mov	dh, 0
		add	dx, dx
		mov	bx, dx
		add	ax, _playfield_fg_shift_x[bx]
		mov	[bp+@@left], ax
		mov	al, [bp+arg_0]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_20E40, word_20E42, _SinTable8[bx]
		mov	[bp+@@top], ax
		call	sprite16_put pascal, [bp+@@left], ax, 34B4h
		leave
		retn	4
sub_C1E6	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_C248	proc near

var_1		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		cmp	byte ptr word_23AF0, 0
		jnz	short loc_C263
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_C26F
; ---------------------------------------------------------------------------

loc_C263:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_C26F:
		mov	_sprite16_put_w, (48 / 16)
		mov	_sprite16_put_h, 24
		xor	di, di
		mov	ax, word_20E42
		mov	bx, 4
		cwd
		idiv	bx
		jmp	short loc_C299
; ---------------------------------------------------------------------------

loc_C287:
		push	word ptr [bp-1]
		mov	al, [bp+var_1]
		add	al, 20h	; ' '
		push	ax
		call	sub_C1E6
		inc	di
		mov	al, [bp+var_1]
		add	al, 10h

loc_C299:
		mov	[bp+var_1], al
		cmp	di, 10h
		jl	short loc_C287
		xor	di, di
		mov	ax, word_20E42
		mov	bx, 4
		cwd
		idiv	bx
		mov	dl, 0
		sub	dl, al
		mov	[bp+var_1], dl
		jmp	short loc_C2CA
; ---------------------------------------------------------------------------

loc_C2B5:
		push	word ptr [bp+var_1]
		mov	al, [bp+var_1]
		add	al, 0E0h
		push	ax
		call	sub_C1E6
		inc	di
		mov	al, [bp+var_1]
		add	al, 10h
		mov	[bp+var_1], al

loc_C2CA:
		cmp	di, 10h
		jl	short loc_C2B5
		xor	di, di
		mov	ax, word_20E42
		mov	bx, 4
		cwd
		idiv	bx
		jmp	short loc_C2EB
; ---------------------------------------------------------------------------

loc_C2DC:
		push	word ptr [bp+var_1]
		push	word ptr [bp+var_1]
		call	sub_C1E6
		inc	di
		mov	al, [bp+var_1]
		add	al, 10h

loc_C2EB:
		mov	[bp+var_1], al
		cmp	di, 10h
		jl	short loc_C2DC
		pop	di
		pop	si
		leave
		retn	2
sub_C248	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_C2F9	proc near

var_2		= word ptr -2

		enter	2, 0
		push	si
		push	di
		mov	al, byte_20E3D
		mov	ah, 0
		imul	ax, PLAYFIELD_W_BORDERED
		add	ax, 96
		mov	si, ax
		call	super_put pascal, ax, large (40 shl 16) or 18
		lea	ax, [si+64]
		call	super_put pascal, ax, large (40 shl 16) or 19
		mov	al, byte_20E3D
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		imul	dx, PLAYFIELD_W_BORDERED
		add	dx, 96
		mov	si, dx
		mov	ax, word_23AF6
		and	ax, 1Fh
		mov	[bp+var_2], ax
		cmp	[bp+var_2], 10h
		jge	short loc_C34F
		add	ax, 32
		jmp	short loc_C355
; ---------------------------------------------------------------------------

loc_C34F:
		mov	ax, 64
		sub	ax, [bp+var_2]

loc_C355:
		mov	di, ax
		call	super_put pascal, si, di, 20
		lea	ax, [si+64]
		call	super_put pascal, ax, di, 21
		pop	di
		pop	si
		leave
		retn
sub_C2F9	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_C370	proc near

arg_0		= word ptr  4
arg_2		= word ptr  6
arg_4		= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	di, [bp+arg_4]
		mov	cx, [bp+arg_2]
		mov	si, [bp+arg_0]
		cmp	di, 0FF00h
		jge	short loc_C3C0
		cmp	cx, 0F00h
		jl	short loc_C39D
		cmp	si, 800h
		jl	short loc_C398
		mov	bx, word_20E4A
		mov	dx, [bx]
		jmp	short loc_C412
; ---------------------------------------------------------------------------

loc_C398:
		mov	dx, 4
		jmp	short loc_C412
; ---------------------------------------------------------------------------

loc_C39D:
		cmp	cx, 100h
		jl	short loc_C3AC
		mov	bx, word_20E4A
		mov	dx, [bx+2]
		jmp	short loc_C412
; ---------------------------------------------------------------------------

loc_C3AC:
		cmp	si, 800h
		jl	short loc_C3BB
		mov	bx, word_20E4A
		mov	dx, [bx+4]
		jmp	short loc_C412
; ---------------------------------------------------------------------------

loc_C3BB:
		mov	dx, 8
		jmp	short loc_C412
; ---------------------------------------------------------------------------

loc_C3C0:
		cmp	di, 200h
		jge	short loc_C3ED
		cmp	cx, 0F00h
		jl	short loc_C3D5
		mov	bx, word_20E4A
		mov	dx, [bx+6]
		jmp	short loc_C412
; ---------------------------------------------------------------------------

loc_C3D5:
		cmp	cx, 100h
		jl	short loc_C3E4
		mov	bx, word_20E4A
		mov	dx, [bx+8]
		jmp	short loc_C412
; ---------------------------------------------------------------------------

loc_C3E4:
		mov	bx, word_20E4A
		mov	dx, [bx+0Ah]
		jmp	short loc_C412
; ---------------------------------------------------------------------------

loc_C3ED:
		cmp	cx, 0F00h
		jl	short loc_C3FC
		mov	bx, word_20E4A
		mov	dx, [bx+0Ch]
		jmp	short loc_C412
; ---------------------------------------------------------------------------

loc_C3FC:
		cmp	cx, 100h
		jl	short loc_C40B
		mov	bx, word_20E4A
		mov	dx, [bx+0Eh]
		jmp	short loc_C412
; ---------------------------------------------------------------------------

loc_C40B:
		mov	bx, word_20E4A
		mov	dx, [bx+10h]

loc_C412:
		cmp	si, 1300h
		jl	short loc_C42B
		cmp	dx, 2
		jnz	short loc_C42B
		cmp	cx, 800h
		jl	short loc_C428
		mov	dx, 4
		jmp	short loc_C42B
; ---------------------------------------------------------------------------

loc_C428:
		mov	dx, 8

loc_C42B:
		mov	ax, dx
		pop	di
		pop	si
		pop	bp
		retn	6
sub_C370	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_C433	proc near

var_7		= byte ptr -7
var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2
arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		sub	sp, 8
		push	si
		push	di
		mov	si, [bp+arg_0]
		mov	ax, [si]
		mov	[bp+var_2], ax
		mov	ax, [si+2]
		mov	[bp+var_4], ax
		xor	di, di
		push	word_23AF0
		call	sub_16983
		mov	ax, word_2142E
		add	ax, 100h
		cmp	ax, [bp+var_2]
		jge	short loc_C464
		mov	ax, 1
		jmp	short loc_C466
; ---------------------------------------------------------------------------

loc_C464:
		xor	ax, ax

loc_C466:
		mov	[bp+var_7], al
		mov	ax, word_2142E
		add	ax, 0FF00h
		cmp	ax, [bp+var_2]
		jle	short loc_C479
		mov	ax, 1
		jmp	short loc_C47B
; ---------------------------------------------------------------------------

loc_C479:
		xor	ax, ax

loc_C47B:
		add	al, al
		or	[bp+var_7], al
		mov	ax, word_21430
		add	ax, 500h
		cmp	ax, [bp+var_4]
		jge	short loc_C490
		mov	ax, 1
		jmp	short loc_C492
; ---------------------------------------------------------------------------

loc_C490:
		xor	ax, ax

loc_C492:
		shl	al, 2
		or	[bp+var_7], al
		mov	ax, [bp+var_4]
		cmp	ax, word_21430
		jge	short loc_C4A6
		mov	ax, 1
		jmp	short loc_C4A8
; ---------------------------------------------------------------------------

loc_C4A6:
		xor	ax, ax

loc_C4A8:
		shl	al, 3
		or	[bp+var_7], al
		mov	al, [bp+var_7]
		mov	ah, 0
		dec	ax
		mov	bx, ax
		cmp	bx, 9
		ja	short loc_C4E8
		add	bx, bx
		jmp	cs:off_C536[bx]

loc_C4C2:
		mov	di, 4
		jmp	short loc_C4E8
; ---------------------------------------------------------------------------

loc_C4C7:
		mov	di, 8
		jmp	short loc_C4E8
; ---------------------------------------------------------------------------

loc_C4CC:
		mov	di, 1
		jmp	short loc_C4E8
; ---------------------------------------------------------------------------

loc_C4D1:
		mov	di, 2
		jmp	short loc_C4E8
; ---------------------------------------------------------------------------

loc_C4D6:
		mov	di, 5
		jmp	short loc_C4E8
; ---------------------------------------------------------------------------

loc_C4DB:
		mov	di, 6
		jmp	short loc_C4E8
; ---------------------------------------------------------------------------

loc_C4E0:
		mov	di, 9
		jmp	short loc_C4E8
; ---------------------------------------------------------------------------

loc_C4E5:
		mov	di, 0Ah

loc_C4E8:
		mov	[bp+var_7], 0
		call	randring1_next16
		mov	bx, 3
		xor	dx, dx
		div	bx
		mov	[bp+var_6], dx
		push	di
		call	sub_D71E
		cmp	al, 1
		jnz	short loc_C505
		push	si
		call	sub_D6D4

loc_C505:
		push	4
		call	sub_E0F7
		cmp	byte ptr [si+4], 0
		jz	short loc_C52F
		mov	byte ptr [si+4], 0
		inc	[bp+var_7]
		cmp	word ptr [si+18h], 500h
		ja	short loc_C52B
		call	randring1_next16
		test	al, 3
		jnz	short loc_C52B
		call	player_bomb pascal, si
		jmp	short loc_C52F
; ---------------------------------------------------------------------------

loc_C52B:
		mov	byte ptr [si+4], 1

loc_C52F:
		pop	di
		pop	si
		leave
		retn	2
sub_C433	endp

; ---------------------------------------------------------------------------
		db 0
off_C536	dw offset loc_C4C2
		dw offset loc_C4C7
		dw offset loc_C4E8
		dw offset loc_C4CC
		dw offset loc_C4D6
		dw offset loc_C4E0
		dw offset loc_C4E8
		dw offset loc_C4D1
		dw offset loc_C4DB
		dw offset loc_C4E5

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_C54A	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_0]
		mov	ax, [si+74h]
		cmp	ax, [si+6Eh]
		ja	short loc_C55F
		push	si
		call	sub_C568
		jmp	short loc_C563
; ---------------------------------------------------------------------------

loc_C55F:
		push	si
		call	sub_C433

loc_C563:
		pop	si
		pop	bp
		retn	2
sub_C54A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_C568	proc near

var_B		= byte ptr -0Bh
var_A		= byte ptr -0Ah
var_9		= byte ptr -9
var_8		= word ptr -8
var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2
arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		sub	sp, 0Ch
		push	si
		push	di
		mov	si, [bp+arg_0]
		mov	ax, [si]
		mov	[bp+var_6], ax
		mov	ax, [si+2]
		mov	[bp+var_8], ax
		test	byte ptr word_23AF6, 3
		jnz	short loc_C5AA
		mov	[bp+var_B], 20h	; ' '
		jmp	short loc_C5A1
; ---------------------------------------------------------------------------

loc_C58B:
		mov	al, [bp+var_B]
		cbw
		push	ax
		call	sub_E0F7
		cmp	byte ptr [si+4], 0
		jnz	short loc_C5AA
		mov	al, [bp+var_B]
		add	al, 10h
		mov	[bp+var_B], al

loc_C5A1:
		mov	al, [bp+var_B]
		cbw
		cmp	ax, 50h	; 'P'
		jle	short loc_C58B

loc_C5AA:
		cmp	byte ptr [si+4], 0
		jnz	loc_C658
		xor	di, di
		push	word_23AF0
		call	sub_16983
		mov	ax, word_2142E
		add	ax, 100h
		cmp	ax, [bp+var_6]
		jge	short loc_C5CD
		mov	ax, 1
		jmp	short loc_C5CF
; ---------------------------------------------------------------------------

loc_C5CD:
		xor	ax, ax

loc_C5CF:
		mov	[bp+var_9], al
		mov	ax, word_2142E
		add	ax, 0FF00h
		cmp	ax, [bp+var_6]
		jle	short loc_C5E2
		mov	ax, 1
		jmp	short loc_C5E4
; ---------------------------------------------------------------------------

loc_C5E2:
		xor	ax, ax

loc_C5E4:
		add	al, al
		or	[bp+var_9], al
		mov	ax, word_21430
		add	ax, 500h
		cmp	ax, [bp+var_8]
		jge	short loc_C5F9
		mov	ax, 1
		jmp	short loc_C5FB
; ---------------------------------------------------------------------------

loc_C5F9:
		xor	ax, ax

loc_C5FB:
		shl	al, 2
		or	[bp+var_9], al
		mov	ax, [bp+var_8]
		cmp	ax, word_21430
		jge	short loc_C60F
		mov	ax, 1
		jmp	short loc_C611
; ---------------------------------------------------------------------------

loc_C60F:
		xor	ax, ax

loc_C611:
		shl	al, 3
		or	[bp+var_9], al
		mov	al, [bp+var_9]
		mov	ah, 0
		dec	ax
		mov	bx, ax
		cmp	bx, 9
		ja	loc_C6BF
		add	bx, bx
		jmp	cs:off_C791[bx]

loc_C62D:
		mov	di, 4
		jmp	loc_C6BF
; ---------------------------------------------------------------------------

loc_C633:
		mov	di, 8
		jmp	loc_C6BF
; ---------------------------------------------------------------------------

loc_C639:
		mov	di, 1
		jmp	loc_C6BF
; ---------------------------------------------------------------------------

loc_C63F:
		mov	di, 2
		jmp	short loc_C6BF
; ---------------------------------------------------------------------------

loc_C644:
		mov	di, 5
		jmp	short loc_C6BF
; ---------------------------------------------------------------------------

loc_C649:
		mov	di, 6
		jmp	short loc_C6BF
; ---------------------------------------------------------------------------

loc_C64E:
		mov	di, 9
		jmp	short loc_C6BF
; ---------------------------------------------------------------------------

loc_C653:
		mov	di, 0Ah
		jmp	short loc_C6BF
; ---------------------------------------------------------------------------

loc_C658:
		mov	ax, word_20E44
		sub	ax, [bp+var_6]
		mov	[bp+var_2], ax
		mov	ax, word_20E46
		sub	ax, [bp+var_8]
		mov	[bp+var_4], ax
		mov	byte ptr [si+4], 0
		cmp	[bp+var_2], 0FF00h
		jg	short loc_C67B
		mov	[bp+var_9], 0
		jmp	short loc_C68C
; ---------------------------------------------------------------------------

loc_C67B:
		cmp	[bp+var_2], 100h
		jg	short loc_C688
		mov	[bp+var_9], 1
		jmp	short loc_C68C
; ---------------------------------------------------------------------------

loc_C688:
		mov	[bp+var_9], 2

loc_C68C:
		cmp	byte ptr [si+16h], 0
		jz	short loc_C6A3
		mov	al, [si+16h]
		mov	ah, 0
		mov	dx, ax
		add	dx, dx
		add	dx, ax
		add	dl, [bp+var_9]
		mov	[bp+var_9], dl

loc_C6A3:
		mov	al, [bp+var_9]
		mov	ah, 0
		imul	ax, 12h
		add	ax, 67Eh
		mov	word_20E4A, ax
		push	[bp+var_4]
		push	[bp+var_6]
		push	[bp+var_8]
		call	sub_C370
		mov	di, ax

loc_C6BF:
		mov	[bp+var_9], 0
		mov	[bp+var_B], 0

loc_C6C7:
		push	di
		call	sub_D71E
		cmp	al, 1
		jnz	short loc_C6D3
		push	si
		call	sub_D6D4

loc_C6D3:
		cmp	[bp+var_B], 0
		jnz	short loc_C6DD
		push	14h
		jmp	short loc_C6DF
; ---------------------------------------------------------------------------

loc_C6DD:
		push	4

loc_C6DF:
		call	sub_E0F7
		cmp	byte ptr [si+4], 0
		jz	loc_C78B
		mov	byte ptr [si+4], 0
		mov	ax, [bp+var_6]
		mov	[si], ax
		mov	ax, [bp+var_8]
		mov	[si+2],	ax
		inc	[bp+var_9]
		cmp	[bp+var_9], 9
		jnb	short loc_C735
		cmp	word_20E44, 500h
		jge	short loc_C70E
		mov	al, 0
		jmp	short loc_C71C
; ---------------------------------------------------------------------------

loc_C70E:
		cmp	word_20E44, 0B00h
		jge	short loc_C71A
		mov	al, 1
		jmp	short loc_C71C
; ---------------------------------------------------------------------------

loc_C71A:
		mov	al, 2

loc_C71C:
		mov	[bp+var_A], al
		mov	ah, 0
		imul	ax, 12h
		mov	dl, [bp+var_9]
		mov	dh, 0
		add	dx, dx
		add	ax, dx
		mov	bx, ax
		mov	di, [bx+756h]
		jmp	short loc_C6C7
; ---------------------------------------------------------------------------

loc_C735:
		mov	al, [bp+var_B]
		cbw
		cmp	ax, 9
		jge	short loc_C77A
		cmp	[bp+var_9], 0
		jnz	short loc_C75E
		inc	byte ptr [si+16h]
		cmp	byte ptr [si+16h], 2
		jb	short loc_C751
		mov	byte ptr [si+16h], 0

loc_C751:
		call	randring1_next16
		mov	bx, 3
		xor	dx, dx
		div	bx
		mov	[bp+var_A], dl

loc_C75E:
		mov	al, [bp+var_A]
		mov	ah, 0
		imul	ax, 12h
		push	ax
		mov	al, [bp+var_B]
		cbw
		add	ax, ax
		pop	bx
		add	bx, ax
		mov	di, [bx+756h]
		inc	[bp+var_B]
		jmp	loc_C6C7
; ---------------------------------------------------------------------------

loc_C77A:
		cmp	word ptr [si+18h], 400h
		ja	short loc_C787
		call	player_bomb pascal, si
		jmp	short loc_C78B
; ---------------------------------------------------------------------------

loc_C787:
		mov	byte ptr [si+4], 1

loc_C78B:
		pop	di
		pop	si
		leave
		retn	2
sub_C568	endp

; ---------------------------------------------------------------------------
off_C791	dw offset loc_C62D
		dw offset loc_C633
		dw offset loc_C6BF
		dw offset loc_C639
		dw offset loc_C644
		dw offset loc_C64E
		dw offset loc_C6BF
		dw offset loc_C63F
		dw offset loc_C649
		dw offset loc_C653

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_C7A5	proc near
		push	bp
		mov	bp, sp
		les	bx, _resident
		cmp	es:[bx+resident_t.RESIDENT_is_cpu][0], 0
		jz	short loc_C7C8
		cmp	es:[bx+resident_t.RESIDENT_is_cpu][1], 0
		jz	short loc_C7C8
		push	1
		call	palette_black_out

loc_C7C1:
		mov	byte_23B00, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_C7C8:
		call	_snd_se_reset
		call	snd_se_play pascal, 21
		call	_snd_se_update
		jmp	short loc_C7E7
; ---------------------------------------------------------------------------

loc_C7DB:
		call	_input_reset_sense_key_held
		push	1
		call	frame_delay

loc_C7E7:
		cmp	_input_sp, INPUT_NONE
		jnz	short loc_C7DB

loc_C7EE:
		call	_input_reset_sense_key_held
		test	_input_sp.hi, high INPUT_Q
		jnz	short loc_C7C1
		test	_input_sp.hi, high INPUT_CANCEL
		jnz	short loc_C816
		push	1
		call	frame_delay
		jmp	short loc_C7EE
; ---------------------------------------------------------------------------

loc_C80A:
		call	_input_reset_sense_key_held
		push	1
		call	frame_delay

loc_C816:
		cmp	_input_sp, INPUT_NONE
		jnz	short loc_C80A
		call	_snd_se_reset
		call	snd_se_play pascal, 21
		call	_snd_se_update
		pop	bp
		retn
sub_C7A5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_C830	proc near
		push	bp
		mov	bp, sp
		push	si
		call	egc_on
		call	sub_B3A2
		call	egc_off
		cmp	_p1.hyper_active, 0
		jz	short loc_C881
		test	byte ptr word_23AF6, 1
		jz	short loc_C881
		mov	ax, _p1.gauge_avail
		shr	ax, 10
		mov	si, ax
		cmp	si, 1
		jnz	short loc_C861
		mov	si, 8
		jmp	short loc_C86E
; ---------------------------------------------------------------------------

loc_C861:
		cmp	si, 2
		jnz	short loc_C86B
		mov	si, 0Ch
		jmp	short loc_C86E
; ---------------------------------------------------------------------------

loc_C86B:
		mov	si, 6

loc_C86E:
		call	grcg_setcolor pascal, GC_RMW, si
		mov	bx, 232h
		call	sub_B398
		GRCG_OFF_VIA_XOR ax

loc_C881:
		cmp	_p2.hyper_active, 0
		jz	short loc_C8C1
		test	byte ptr word_23AF6, 1
		jz	short loc_C8C1
		mov	ax, _p2.gauge_avail
		shr	ax, 10
		mov	si, ax
		cmp	si, 1
		jnz	short loc_C8A1
		mov	si, 8
		jmp	short loc_C8AE
; ---------------------------------------------------------------------------

loc_C8A1:
		cmp	si, 2
		jnz	short loc_C8AB
		mov	si, 0Ch
		jmp	short loc_C8AE
; ---------------------------------------------------------------------------

loc_C8AB:
		mov	si, 6

loc_C8AE:
		call	grcg_setcolor pascal, GC_RMW, si
		mov	bx, 25Ah
		call	sub_B398
		GRCG_OFF_VIA_XOR ax

loc_C8C1:
		pop	si
		pop	bp
		retn
sub_C830	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_C8C4	proc near

var_6		= word ptr -6
var_4		= word ptr -4
var_1		= byte ptr -1

		enter	6, 0
		push	si
		push	di
		mov	ax, _p1.gauge_charged
		shr	ax, 4
		mov	[bp+var_4], ax
		mov	ax, _p1.gauge_avail
		shr	ax, 4
		mov	si, ax
		mov	ax, _p2.gauge_charged
		shr	ax, 4
		mov	[bp+var_6], ax
		mov	ax, _p2.gauge_avail
		shr	ax, 4
		mov	di, ax
		sub	si, [bp+var_4]
		or	si, si
		jle	short loc_C921
		cmp	_p1.hyper_active, 0
		jz	short loc_C901
		test	byte ptr word_23AF6, 1
		jz	short loc_C909

loc_C901:
		push	(GC_RMW shl 16) + 9
		jmp	short loc_C90F
; ---------------------------------------------------------------------------

loc_C909:
		push	(GC_RMW shl 16) + 15

loc_C90F:
		call	grcg_setcolor
		mov	ax, [bp+var_4]
		add	ax, 20h	; ' '
		mov	dx, ax
		mov	bx, si
		call	sub_B3F6

loc_C921:
		sub	di, [bp+var_6]
		or	di, di
		jle	short loc_C956
		cmp	_p2.hyper_active, 0
		jz	short loc_C936
		test	byte ptr word_23AF6, 1
		jz	short loc_C93E

loc_C936:
		push	(GC_RMW shl 16) + 9
		jmp	short loc_C944
; ---------------------------------------------------------------------------

loc_C93E:
		push	(GC_RMW shl 16) + 15

loc_C944:
		call	grcg_setcolor
		mov	ax, [bp+var_6]
		add	ax, 160h
		mov	dx, ax
		mov	bx, di
		call	sub_B3F6

loc_C956:
		mov	cx, [bp+var_4]
		or	cx, cx
		jz	short loc_C9A6
		cmp	cx, 64
		jnb	short loc_C968
		mov	[bp+var_1], 0Fh
		jmp	short loc_C990
; ---------------------------------------------------------------------------

loc_C968:
		cmp	cx, 128
		jnb	short loc_C974
		mov	[bp+var_1], 0Ah
		jmp	short loc_C990
; ---------------------------------------------------------------------------

loc_C974:
		cmp	cx, 192
		jnb	short loc_C980
		mov	[bp+var_1], 8
		jmp	short loc_C990
; ---------------------------------------------------------------------------

loc_C980:
		cmp	cx, 255
		jnb	short loc_C98C
		mov	[bp+var_1], 6
		jmp	short loc_C990
; ---------------------------------------------------------------------------

loc_C98C:
		mov	[bp+var_1], 0Ch

loc_C990:
		push	GC_RMW
		mov	al, [bp+var_1]
		mov	ah, 0
		push	ax
		call	grcg_setcolor
		mov	dx, 20h	; ' '
		mov	bx, cx
		call	sub_B3F6

loc_C9A6:
		mov	cx, [bp+var_6]
		or	cx, cx
		jz	short loc_C9F6
		cmp	cx, 64
		jnb	short loc_C9B8
		mov	[bp+var_1], 0Fh
		jmp	short loc_C9E0
; ---------------------------------------------------------------------------

loc_C9B8:
		cmp	cx, 128
		jnb	short loc_C9C4
		mov	[bp+var_1], 0Ah
		jmp	short loc_C9E0
; ---------------------------------------------------------------------------

loc_C9C4:
		cmp	cx, 192
		jnb	short loc_C9D0
		mov	[bp+var_1], 8
		jmp	short loc_C9E0
; ---------------------------------------------------------------------------

loc_C9D0:
		cmp	cx, 255
		jnb	short loc_C9DC
		mov	[bp+var_1], 6
		jmp	short loc_C9E0
; ---------------------------------------------------------------------------

loc_C9DC:
		mov	[bp+var_1], 0Ch

loc_C9E0:
		push	GC_RMW
		mov	al, [bp+var_1]
		mov	ah, 0
		push	ax
		call	grcg_setcolor
		mov	dx, 160h
		mov	bx, cx
		call	sub_B3F6

loc_C9F6:
		GRCG_OFF_VIA_XOR ax
		pop	di
		pop	si
		leave
		retn
sub_C8C4	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_C9FE	proc far

@@mrs_slot		= byte ptr  6

		push	bp
		mov	bp, sp
		push	si
		mov	al, [bp+@@mrs_slot]
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+798h], 1
		jnz	short loc_CA37
		mov	si, PLAYFIELD_LEFT
		cmp	[bp+@@mrs_slot], 0
		jz	short loc_CA1D
		add	si, PLAYFIELD_W_BORDERED

loc_CA1D:
		push	si	; left
		push	PLAYFIELD_TOP	; top
		mov	al, [bp+@@mrs_slot]
		mov	ah, 0
		push	ax	; slot
		call	@mrs_put_8$qiuii
		mov	al, [bp+@@mrs_slot]
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+798h], 2

loc_CA37:
		pop	si
		pop	bp
		retf	2
sub_C9FE	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CA3C	proc far
		push	bp
		mov	bp, sp
		push	si
		cmp	byte_1DCF8, 2
		jz	short loc_CA4E
		cmp	byte_1DCF9, 2
		jnz	short loc_CAC8

loc_CA4E:
		call	_snd_se_reset
		call	snd_se_play pascal, 19
		call	_snd_se_update
		push	0
		nopcall	sub_BA91
		push	1
		nopcall	sub_BA91
		cmp	byte_1DCF8, 2
		jnz	short loc_CA81
		mov	byte_1DCF8, 3
		push	0
		push	0E1h
		call	sub_CACB

loc_CA81:
		cmp	byte_1DCF9, 2
		jnz	short loc_CA95
		mov	byte_1DCF9, 3
		push	1
		push	0E1h
		call	sub_CACB

loc_CA95:
		xor	si, si
		jmp	short loc_CAC3
; ---------------------------------------------------------------------------

loc_CA99:
		call	_input_reset_sense_key_held
		test	_input_sp.hi, high INPUT_CANCEL
		jz	short loc_CAA8
		call	sub_C7A5

loc_CAA8:
		push	1
		call	frame_delay
		mov	ax, si
		and	ax, 1
		imul	ax, 50
		add	ax, 100
		mov	PaletteTone, ax
		call	far ptr	palette_show
		inc	si

loc_CAC3:
		cmp	si, 1Bh
		jl	short loc_CA99

loc_CAC8:
		pop	si
		pop	bp
		retf
sub_CA3C	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CACB	proc near

arg_0		= word ptr  4
arg_2		= byte ptr  6

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	di, [bp+arg_0]
		mov	si, 4
		cmp	[bp+arg_2], 0
		jnz	short loc_CADF
		add	si, 28h	; '('

loc_CADF:
		call	gaiji_putsa pascal, si, 11, ds, offset gbWARNING_1, di
		call	gaiji_putsa pascal, si, 12, ds, offset gbWARNING_2, di
		call	gaiji_putsa pascal, si, 13, ds, offset gbWARNING_3, di
		add	si, 4
		call	gaiji_putsa pascal, si, 14, ds, offset gpYOU_ARE_FORCED_TO_EVADE_FROM, di
		mov	al, [bp+arg_2]
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+393Ch], 5
		jz	short loc_CB47
		lea	ax, [si+2]
		call	gaiji_putsa pascal, ax, 15, ds, offset gpGAUGE_ATTACK_LEVEL, di
		lea	ax, [si+13h]
		push	ax
		push	0Fh
		mov	al, [bp+arg_2]
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D56h]
		jmp	short loc_CB60
; ---------------------------------------------------------------------------

loc_CB47:
		lea	ax, [si+2]
		call	gaiji_putsa pascal, ax, 15, ds, offset gpBOSS_ATTACK_LEVEL, di
		lea	ax, [si+13h]
		push	ax
		push	0Fh
		mov	al, byte_1F39E

loc_CB60:
		mov	ah, 0
		add	ax, 1Fh
		push	ax
		push	TX_WHITE
		call	gaiji_putca
		call	gaiji_putsa pascal, si, 16, ds, offset gpYOUR_LIFE_IS_IN_PERIL_BE_CAREFUL, di
		pop	di
		pop	si
		pop	bp
		retn	4
sub_CACB	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CB81	proc far

var_3		= word ptr -3
arg_0		= word ptr  6

		enter	4, 0
		push	si
		push	di
		mov	al, 1
		sub	al, byte ptr [bp+arg_0]
		mov	byte ptr [bp+var_3], al
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+798h], 3
		jb	loc_CD15
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+798h], 3
		jnz	short loc_CBB9
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+3938h], 0

loc_CBB9:
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+798h], 21h	; '!'
		jnb	loc_CCA6
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+798h], 12h
		jnb	short loc_CBE6
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+3938h]
		add	al, 0Dh
		jmp	short loc_CBF3
; ---------------------------------------------------------------------------

loc_CBE6:
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+3938h]
		add	al, 0F3h

loc_CBF3:
		mov	dl, byte ptr [bp+arg_0]
		mov	dh, 0
		mov	bx, dx
		mov	[bx+3938h], al
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+798h]
		mov	si, 1
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		test	byte ptr [bx+798h], 1
		jz	short loc_CC4D
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+393Ch], 1
		jnz	short loc_CC2D
		mov	si, 0A1h
		jmp	short loc_CC43
; ---------------------------------------------------------------------------

loc_CC2D:
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+393Ch], 3
		jnz	short loc_CC40
		mov	si, 61h	; 'a'
		jmp	short loc_CC43
; ---------------------------------------------------------------------------

loc_CC40:
		mov	si, 41h	; 'A'

loc_CC43:
		push	[bp+var_3]
		nopcall	sub_A3A8
		jmp	short loc_CC9D
; ---------------------------------------------------------------------------

loc_CC4D:
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+393Ch], 1
		jz	short loc_CC78
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+393Ch], 3
		jnz	short loc_CC89
		mov	al, byte ptr [bp+var_3]
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].r, 120

loc_CC78:
		mov	al, byte ptr [bp+var_3]
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].b, 120
		jmp	short loc_CC98
; ---------------------------------------------------------------------------

loc_CC89:
		mov	al, byte ptr [bp+var_3]
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].r, 120

loc_CC98:
		mov	_palette_changed, 1

loc_CC9D:
		push	[bp+arg_0]
		push	si
		call	sub_CACB
		jmp	short loc_CD15
; ---------------------------------------------------------------------------

loc_CCA6:
		mov	[bp+var_3+1], 4
		cmp	byte ptr [bp+var_3], 1
		jnz	short loc_CCB5
		add	[bp+var_3+1], 28h ; '('

loc_CCB5:
		xor	di, di
		mov	si, 0Bh
		jmp	short loc_CCCE
; ---------------------------------------------------------------------------

loc_CCBC:
		call	text_putsa pascal, [bp+var_3+1], si, ds, offset asc_1DD5A, TX_WHITE
		inc	di
		inc	si

loc_CCCE:
		cmp	di, 6
		jb	short loc_CCBC
		push	[bp+var_3]
		nopcall	sub_A3A8
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+798h], 0
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+393Ch]
		mov	dl, byte ptr [bp+arg_0]
		mov	dh, 0
		mov	bx, dx
		mov	[bx+2D54h], al
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+3938h], 0
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+393Ah], 0

loc_CD15:
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jz	loc_CDB7
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+393Ah], 0
		jnz	short loc_CD67
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+3938h]
		add	al, 4
		mov	dl, byte ptr [bp+arg_0]
		mov	dh, 0
		mov	bx, dx
		mov	[bx+3938h], al
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+3938h], 90h
		jb	short loc_CD99
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+393Ah], 1
		jmp	short loc_CD99
; ---------------------------------------------------------------------------

loc_CD67:
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+3938h]
		add	al, -4
		mov	dl, byte ptr [bp+arg_0]
		mov	dh, 0
		mov	bx, dx
		mov	[bx+3938h], al
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+3938h], 0
		ja	short loc_CD99
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+393Ah], 0

loc_CD99:
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+3938h]
		mov	dl, byte ptr [bp+var_3]
		mov	dh, 0
		imul	dx, 3
		mov	bx, dx
		mov	Palettes[bx].r, al
		mov	_palette_changed, 1

loc_CDB7:
		pop	di
		pop	si
		leave
		retf	2
sub_CB81	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CDBD	proc far

@@pid		= word ptr  6
arg_2		= word ptr  8
@@x		= word ptr  0Ah

		push	bp
		mov	bp, sp
		push	si
		inc	byte_20F1E
		cmp	byte_20F1E, 0Ch
		jb	short loc_CDD1
		mov	byte_20F1E, 0

loc_CDD1:
		mov	al, byte_20F1E
		mov	ah, 0
		imul	ax, 0Ah
		add	ax, 3946h
		mov	si, ax
		mov	byte ptr [si], 1
		mov	byte ptr [si+1], 0
		push	[bp+@@x]
		push	[bp+@@pid]
		nopcall	playfield_fg_x_to_screen
		mov	[si+2],	ax
		mov	ax, [bp+arg_2]
		sar	ax, 4
		add	ax, 10h
		mov	[si+4],	ax
		mov	byte ptr [si+6], 8
		mov	byte ptr [si+7], 8
		pop	si
		pop	bp
		retf	6
sub_CDBD	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CE0C	proc far

@@pid		= word ptr  6
arg_2		= word ptr  8
@@x		= word ptr  0Ah

		push	bp
		mov	bp, sp
		push	si
		inc	byte_20F1E
		cmp	byte_20F1E, 0Ch
		jb	short loc_CE20
		mov	byte_20F1E, 0

loc_CE20:
		mov	al, byte_20F1E
		mov	ah, 0
		imul	ax, 0Ah
		add	ax, 3946h
		mov	si, ax
		mov	byte ptr [si], 1
		mov	byte ptr [si+1], 0
		push	[bp+@@x]
		push	[bp+@@pid]
		nopcall	playfield_fg_x_to_screen
		mov	[si+2],	ax
		mov	ax, [bp+arg_2]
		sar	ax, 4
		add	ax, 10h
		mov	[si+4],	ax
		mov	byte ptr [si+6], 88h
		mov	byte ptr [si+7], 0F8h
		pop	si
		pop	bp
		retf	6
sub_CE0C	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CE5B	proc far

@@pid		= word ptr  6
arg_2		= word ptr  8
@@x		= word ptr  0Ah

		push	bp
		mov	bp, sp
		push	si
		inc	byte_20F1E
		cmp	byte_20F1E, 0Ch
		jb	short loc_CE6F
		mov	byte_20F1E, 0

loc_CE6F:
		mov	al, byte_20F1E
		mov	ah, 0
		imul	ax, 0Ah
		add	ax, 3946h
		mov	si, ax
		mov	byte ptr [si], 2
		mov	byte ptr [si+1], 0
		push	[bp+@@x]
		push	[bp+@@pid]
		nopcall	playfield_fg_x_to_screen
		mov	[si+2],	ax
		mov	ax, [bp+arg_2]
		sar	ax, 4
		add	ax, 10h
		mov	[si+4],	ax
		mov	byte ptr [si+6], 0A2h
		mov	byte ptr [si+7], 0F6h
		call	randring_far_next16
		mov	[si+8],	al
		pop	si
		pop	bp
		retf	6
sub_CE5B	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CEB2	proc far
		push	bp
		mov	bp, sp
		push	si
		mov	si, 3946h
		xor	dx, dx
		jmp	short loc_CED8
; ---------------------------------------------------------------------------

loc_CEBD:
		cmp	byte ptr [si], 0
		jz	short loc_CED4
		inc	byte ptr [si+1]
		cmp	byte ptr [si+1], 10h
		jbe	short loc_CECE
		mov	byte ptr [si], 0

loc_CECE:
		mov	al, [si+7]
		add	[si+6],	al

loc_CED4:
		inc	dx
		add	si, 0Ah

loc_CED8:
		cmp	dx, 0Ch
		jl	short loc_CEBD
		pop	si
		pop	bp
		retf
sub_CEB2	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_CEE0	proc far

@@angle		= byte ptr -13h
var_12		= word ptr -12h
var_10		= word ptr -10h
var_E		= word ptr -0Eh
var_C		= word ptr -0Ch
var_A		= word ptr -0Ah
var_8		= word ptr -8
var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2

		enter	14h, 0
		push	si
		push	di
		mov	si, 3946h
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 13
		mov	[bp+var_2], 0
		jmp	loc_D013
; ---------------------------------------------------------------------------

loc_CEFC:
		cmp	byte ptr [si], 0
		jz	loc_D00D
		cmp	word ptr [si+2], 140h
		jge	short loc_CF15
		push	(16 shl 16) or 8
		push	303
		jmp	short loc_CF1E
; ---------------------------------------------------------------------------

loc_CF15:
		push	(336 shl 16) or 8
		push	623

loc_CF1E:
		push	191
		call	grc_setclip
		cmp	byte ptr [si], 1
		jnz	short loc_CF42
		push	word ptr [si+2]
		mov	ax, [si+4]
		sar	ax, 1
		push	ax
		mov	al, [si+6]
		mov	ah, 0
		push	ax
		call	grcg_circle
		jmp	loc_D00D
; ---------------------------------------------------------------------------

loc_CF42:
		mov	ax, [bp+var_2]
		mov	bx, 2
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_CF53
		mov	al, 8
		jmp	short loc_CF55
; ---------------------------------------------------------------------------

loc_CF53:
		mov	al, 0F8h

loc_CF55:
		add	al, [si+8]
		mov	[si+8],	al
		xor	di, di
		mov	al, [si+8]
		jmp	short loc_CFC1
; ---------------------------------------------------------------------------

loc_CF62:
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_CosTable8[bx]
		mov	al, [si+6]
		mov	ah, 0
		push	ax
		push	word ptr [si+2]
		call	_vector1_at
		add	sp, 6
		mov	bx, di
		add	bx, bx
		lea	dx, [bp+var_A]
		add	bx, dx
		mov	ss:[bx], ax
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_SinTable8[bx]
		mov	al, [si+6]
		mov	ah, 0
		push	ax
		push	word ptr [si+4]
		call	_vector1_at
		add	sp, 6
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	bx, di
		add	bx, bx
		lea	dx, [bp+var_12]
		add	bx, dx
		mov	ss:[bx], ax
		inc	di
		mov	al, [bp+@@angle]
		add	al, 40h

loc_CFC1:
		mov	[bp+@@angle], al
		cmp	di, 4
		jl	short loc_CF62
		call	grcg_line pascal, [bp+var_A], [bp+var_12], [bp+var_8], [bp+var_10]
		call	grcg_line pascal, [bp+var_8], [bp+var_10], [bp+var_6], [bp+var_E]
		call	grcg_line pascal, [bp+var_6], [bp+var_E], [bp+var_4], [bp+var_C]
		call	grcg_line pascal, [bp+var_4], [bp+var_C], [bp+var_A], [bp+var_12]

loc_D00D:
		inc	[bp+var_2]
		add	si, 0Ah

loc_D013:
		cmp	[bp+var_2], 0Ch
		jl	loc_CEFC
		GRCG_OFF_VIA_XOR ax
		call	grc_setclip pascal, large 0, ((RES_X - 1) shl 16) or (SPRITE16_RES_Y - 1)
		pop	di
		pop	si
		leave
		retf
sub_CEE0	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D031	proc near
		push	bp
		mov	bp, sp
		push	di
		mov	ax, [di]
		mov	bx, [di+2]
		sar	ax, 4
		mov	cx, ax
		sar	ax, 3
		; Hack (and bx, 0FFE0h)
		db 081h
		db 0e3h
		db 0e0h
		db 0ffh
		shl	bx, 1
		add	ax, bx
		shr	bx, 2
		add	bx, ax
		and	cl, 7
		mov	ax, 0C0h
		ror	ax, cl
		mov	es:[bx], ax
		pop	di
		pop	bp
		retn
sub_D031	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D05D	proc far
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	angle_2142C, 40h
		mov	si, 39CCh
		xor	di, di
		jmp	short loc_D089
; ---------------------------------------------------------------------------

loc_D06E:
		push	ds
		lea	ax, [si+4]
		push	ax
		push	ds
		lea	ax, [si+6]
		push	ax
		push	64
		mov	al, [si+8]
		mov	ah, 0
		push	ax
		call	vector2
		inc	di
		add	si, 10h

loc_D089:
		cmp	di, 50h	; 'P'
		jl	short loc_D06E
		pop	di
		pop	si
		pop	bp
		retf
sub_D05D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D092	proc far
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	angle_2142C, 40h
		mov	si, 39CCh
		xor	di, di
		jmp	short loc_D0F1
; ---------------------------------------------------------------------------

loc_D0A3:
		call	IRand
		mov	bx, (640 shl 4)
		cwd
		idiv	bx
		mov	[si], dx
		call	IRand
		mov	bx, (400 shl 4)
		cwd
		idiv	bx
		mov	[si+2],	dx
		mov	word ptr [si+4], 0
		mov	word ptr [si+6], 10h
		mov	byte ptr [si+8], 20h ; ' '
		mov	word ptr [si+0Ah], 210Eh
		call	IRand
		test	al, 1
		jz	short loc_D0DF
		add	word ptr [si+0Ah], 280h

loc_D0DF:
		call	IRand
		mov	bx, 4000
		cwd
		idiv	bx
		mov	[si+0Ch], dx
		inc	di
		add	si, 10h

loc_D0F1:
		cmp	di, 30h	; '0'
		jl	short loc_D0A3
		pop	di
		pop	si
		pop	bp
		retf
sub_D092	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D0FA	proc near
		push	bp
		mov	bp, sp
		push	di
		mov	ax, [di]
		add	ax, [di+4]
		cmp	ax, 80h
		jnb	short loc_D10D
		add	ax, 2700h
		jmp	short loc_D115
; ---------------------------------------------------------------------------

loc_D10D:
		cmp	ax, 2780h
		jbe	short loc_D115
		sub	ax, 2700h

loc_D115:
		mov	[di], ax
		mov	ax, [di+2]
		add	ax, [di+6]
		cmp	ax, 0E0h
		jnb	short loc_D127
		add	ax, 1720h
		jmp	short loc_D12F
; ---------------------------------------------------------------------------

loc_D127:
		cmp	ax, 1800h
		jbe	short loc_D12F
		sub	ax, 1720h

loc_D12F:
		mov	[di+2],	ax
		pop	di
		pop	bp
		retn
sub_D0FA	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D135	proc far
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	_sprite16_put_w, (16 / 16)
		mov	_sprite16_put_h, 3
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 10
		mov	ax, 0A800h
		mov	es, ax
		assume es:nothing
		mov	angle_2142C, 40h
		mov	di, 39CCh
		xor	si, si

loc_D16B:
		call	IRand
		and	ax, 1
		add	ax, [di+6]
		mov	[di+6],	ax
		mov	[di+8],	al
		call	sub_D0FA
		call	sub_D031
		add	di, 10h
		inc	si
		cmp	si, 18h
		jb	short loc_D16B
		call	grcg_off
		call	egc_on

loc_D195:
		call	IRand
		and	ax, 1
		add	ax, [di+6]
		mov	[di+6],	ax
		mov	[di+8],	al
		call	sub_D0FA
		mov	ax, [di]
		sar	ax, 4
		push	ax
		mov	ax, [di+2]
		sar	ax, 4
		push	ax
		push	word ptr [di+0Ah]
		call	sprite16_put
		add	di, 10h
		inc	si
		cmp	si, 30h	; '0'
		jb	short loc_D195
		cmp	_round_frame, 128
		jbe	short loc_D1DE
		setfarfp	farfp_20F24, sub_D1E7

loc_D1DE:
		call	egc_off
		pop	di
		pop	si
		pop	bp
		retf
sub_D135	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D1E7	proc far

var_3		= byte ptr -3
var_2		= word ptr -2

		enter	4, 0
		push	si
		push	di
		mov	ax, word_23AF6
		and	ax, 0FFFh
		mov	[bp+var_2], ax
		cmp	[bp+var_2], 400h
		jl	short loc_D24B
		cmp	[bp+var_2], 500h
		jge	short loc_D20C
		test	byte ptr [bp+var_2], 7
		jnz	short loc_D24F
		jmp	short loc_D23B
; ---------------------------------------------------------------------------

loc_D20C:
		cmp	[bp+var_2], 800h
		jl	short loc_D24B
		cmp	[bp+var_2], 900h
		jge	short loc_D222
		test	byte ptr [bp+var_2], 3
		jnz	short loc_D24F
		jmp	short loc_D241
; ---------------------------------------------------------------------------

loc_D222:
		cmp	[bp+var_2], 0C00h
		jl	short loc_D24B
		cmp	[bp+var_2], 0FE0h
		jge	short loc_D24B
		mov	ax, [bp+var_2]
		and	ax, 7Fh
		cmp	ax, 40h
		jge	short loc_D241

loc_D23B:
		inc	angle_2142C
		jmp	short loc_D245
; ---------------------------------------------------------------------------

loc_D241:
		dec	angle_2142C

loc_D245:
		mov	[bp+var_3], 1
		jmp	short loc_D24F
; ---------------------------------------------------------------------------

loc_D24B:
		mov	[bp+var_3], 0

loc_D24F:
		mov	di, 39CCh
		xor	si, si

loc_D254:
		call	sub_D0FA
		cmp	[bp+var_3], 0
		jz	short loc_D276
		lea	bx, [di+4]
		push	ds
		push	bx
		lea	bx, [di+6]
		push	ds
		push	bx
		mov	al, angle_2142C
		mov	ah, 0
		push	ax
		mov	al, [di+8]
		push	ax
		call	vector2

loc_D276:
		add	di, 10h
		inc	si
		cmp	si, 30h	; '0'
		jb	short loc_D254
		mov	_sprite16_put_w, (16 / 16)
		mov	_sprite16_put_h, 3
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 10
		mov	ax, 0A800h
		mov	es, ax
		mov	di, 39CCh
		xor	si, si

loc_D2AB:
		call	sub_D031
		add	di, 10h
		inc	si
		cmp	si, 18h
		jb	short loc_D2AB
		call	grcg_off
		call	egc_on

loc_D2C1:
		mov	ax, [di]
		sar	ax, 4
		push	ax
		mov	ax, [di+2]
		sar	ax, 4
		push	ax
		push	word ptr [di+0Ah]
		call	sprite16_put_noclip
		add	di, 10h
		inc	si
		cmp	si, 30h	; '0'
		jb	short loc_D2C1
		call	egc_off
		pop	di
		pop	si
		leave
		retf
sub_D1E7	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D2E8	proc far
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	angle_2142C, 40h
		mov	si, 39CCh
		xor	di, di
		jmp	short loc_D337
; ---------------------------------------------------------------------------

loc_D2F9:
		call	IRand
		mov	bx, (640 shl 4)
		cwd
		idiv	bx
		mov	[si], dx
		call	IRand
		mov	bx, (400 shl 4)
		cwd
		idiv	bx
		mov	[si+2],	dx
		mov	word ptr [si+4], 0
		mov	word ptr [si+6], 10h
		mov	byte ptr [si+8], 10h
		cmp	di, 28h	; '('
		jge	short loc_D32E
		mov	word ptr [si+0Ah], 233Eh
		jmp	short loc_D333
; ---------------------------------------------------------------------------

loc_D32E:
		mov	word ptr [si+0Ah], 20BEh

loc_D333:
		inc	di
		add	si, 10h

loc_D337:
		cmp	di, 32h	; '2'
		jl	short loc_D2F9
		pop	di
		pop	si
		pop	bp
		retf
sub_D2E8	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D340	proc far
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	_sprite16_put_w, (16 / 16)
		mov	_sprite16_put_h, 8
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 13
		mov	ax, 0A800h
		mov	es, ax
		mov	angle_2142C, 40h
		mov	di, 39CCh
		xor	si, si

loc_D376:
		call	IRand
		and	ax, 1
		add	ax, [di+6]
		mov	[di+6],	ax
		mov	[di+8],	al
		call	sub_D0FA
		call	sub_D031
		add	di, 10h
		inc	si
		cmp	si, 18h
		jb	short loc_D376
		call	grcg_off
		call	egc_on

loc_D3A0:
		xor	ax, ax
		cmp	si, 28h	; '('
		jnb	short loc_D3AF
		call	IRand
		and	ax, 1

loc_D3AF:
		add	ax, [di+6]
		mov	[di+6],	ax
		mov	[di+8],	al
		call	sub_D0FA
		mov	ax, [di]
		sar	ax, 4
		push	ax
		mov	ax, [di+2]
		sar	ax, 4
		push	ax
		push	word ptr [di+0Ah]
		call	sprite16_put_noclip
		add	di, 10h
		inc	si
		cmp	si, 32h	; '2'
		jb	short loc_D3A0
		cmp	_round_frame, 144
		jbe	short loc_D3F0
		setfarfp	farfp_20F24, sub_D3F9

loc_D3F0:
		call	egc_off
		pop	di
		pop	si
		pop	bp
		retf
sub_D340	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D3F9	proc far

var_3		= byte ptr -3
var_2		= word ptr -2

		enter	4, 0
		push	si
		push	di
		mov	ax, word_23AF6
		and	ax, 0FFFh
		mov	[bp+var_2], ax
		cmp	[bp+var_2], 400h
		jl	short loc_D45D
		cmp	[bp+var_2], 500h
		jge	short loc_D41E
		test	byte ptr [bp+var_2], 7
		jnz	short loc_D461
		jmp	short loc_D44D
; ---------------------------------------------------------------------------

loc_D41E:
		cmp	[bp+var_2], 800h
		jl	short loc_D45D
		cmp	[bp+var_2], 900h
		jge	short loc_D434
		test	byte ptr [bp+var_2], 3
		jnz	short loc_D461
		jmp	short loc_D453
; ---------------------------------------------------------------------------

loc_D434:
		cmp	[bp+var_2], 0C00h
		jl	short loc_D45D
		cmp	[bp+var_2], 0FE0h
		jge	short loc_D45D
		mov	ax, [bp+var_2]
		and	ax, 7Fh
		cmp	ax, 40h
		jge	short loc_D453

loc_D44D:
		inc	angle_2142C
		jmp	short loc_D457
; ---------------------------------------------------------------------------

loc_D453:
		dec	angle_2142C

loc_D457:
		mov	[bp+var_3], 1
		jmp	short loc_D461
; ---------------------------------------------------------------------------

loc_D45D:
		mov	[bp+var_3], 0

loc_D461:
		mov	di, 39CCh
		xor	si, si

loc_D466:
		call	sub_D0FA
		cmp	[bp+var_3], 0
		jz	short loc_D488
		lea	bx, [di+4]
		push	ds
		push	bx
		lea	bx, [di+6]
		push	ds
		push	bx
		mov	al, angle_2142C
		mov	ah, 0
		push	ax
		mov	al, [di+8]
		push	ax
		call	vector2

loc_D488:
		add	di, 10h
		inc	si
		cmp	si, 32h	; '2'
		jb	short loc_D466
		mov	_sprite16_put_w, (16 / 16)
		mov	_sprite16_put_h, 8
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 13
		mov	ax, 0A800h
		mov	es, ax
		mov	di, 39CCh
		xor	si, si

loc_D4BD:
		call	sub_D031
		add	di, 10h
		inc	si
		cmp	si, 18h
		jb	short loc_D4BD
		call	grcg_off
		call	egc_on

loc_D4D3:
		xor	dx, dx
		cmp	si, 28h	; '('
		jb	short loc_D4E6
		mov	dx, [bp+var_2]
		; Hack (and dx, 1Fh)
		db 081h
		db 0e2h
		db 01fh
		db 000h
		shr	dx, 3
		shl	dx, 1

loc_D4E6:
		mov	ax, [di]
		sar	ax, 4
		push	ax
		mov	ax, [di+2]
		sar	ax, 4
		push	ax
		add	dx, [di+0Ah]
		push	dx
		call	sprite16_put_noclip
		add	di, 10h
		inc	si
		cmp	si, 32h	; '2'
		jb	short loc_D4D3
		call	egc_off
		pop	di
		pop	si
		leave
		retf
sub_D3F9	endp


; =============== S U B	R O U T	I N E =======================================


sub_D50E	proc near
		push	si
		push	di
		mov	ah, 0
		mov	si, offset _sSCORE_FONT
		shl	ax, 3
		add	si, ax
		mov	ax, cx
		sar	ax, 3
		add	ax, 1E0h
		mov	di, ax

loc_D524:
		movsb
		sub	di, 51h	; 'Q'
		jnb	short loc_D524
		pop	di
		pop	si
		retn
sub_D50E	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================


sub_D52E	proc near
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 15
		mov	ax, 0A82Dh
		mov	es, ax
		assume es:nothing
		mov	cx, 220h
		mov	bx, offset _score_lebcd
		add	bx, (PLAYER_COUNT * SCORE_DIGITS) - 1
		mov	dh, (PLAYER_COUNT * SCORE_DIGITS)

loc_D549:
		xor	dl, dl

loc_D54B:
		mov	al, [bx]
		or	dl, al
		jz	short loc_D554
		call	sub_D50E

loc_D554:
		dec	bx
		add	cx, 8
		dec	dh
		jz	short loc_D56B
		cmp	dh, (1 * SCORE_DIGITS)
		jnz	short loc_D54B
		xor	ax, ax
		call	sub_D50E
		mov	cx, 0E0h
		jmp	short loc_D549
; ---------------------------------------------------------------------------

loc_D56B:
		mov	al, 80h
		call	sub_D50E
		call	grcg_off
		mov	al, _score_lebcd_p1[6]
		cmp	byte_220DC, al
		jnb	short locret_D5A0
		call	snd_se_play pascal, 8
		les	bx, _resident
		assume es:nothing
		inc	es:[bx+resident_t.story_lives]
		call	sub_BA5B
		inc	byte_220DC
		cmp	byte_220DC, 2
		jnz	short locret_D5A0
		mov	byte_220DC, -1

locret_D5A0:
		retn
sub_D52E	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================


sub_D5A2	proc far
		xor	ax, ax
		mov	bx, 3E2Eh
		mov	cx, 0Eh

loc_D5AA:
		mov	[bx], ax
		inc	bx
		loop	loc_D5AA
		retf
sub_D5A2	endp

include th03/main/player/score_add.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D608	proc far

arg_0		= byte ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah
arg_6		= word ptr  0Ch

		push	bp
		mov	bp, sp
		push	si
		push	di
		push	GC_RMW
		mov	al, [bp+arg_0]
		mov	ah, 0
		push	ax
		call	grcg_setcolor
		mov	ax, [bp+arg_4]
		mov	dx, ax
		shl	ax, 2
		add	ax, dx
		add	ax, 0A805h
		mov	es, ax
		mov	cx, [bp+arg_6]
		mov	si, offset _FIVE_DIGIT_POWERS_OF_10
		mov	di, [bp+arg_2]
		mov	bl, 0
		nop

loc_D636:
		mov	ax, di
		xor	dx, dx
		div	word ptr [si]
		mov	di, dx
		or	bl, al
		jz	short loc_D645
		call	sub_D50E

loc_D645:
		add	cx, 8
		add	si, 2
		cmp	word ptr [si], 1
		ja	short loc_D636
		mov	ax, di
		call	sub_D50E
		add	cx, 8
		xor	ax, ax
		call	sub_D50E
		call	grcg_off
		pop	di
		pop	si
		pop	bp
		retf	8
sub_D608	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D668	proc far

arg_0		= byte ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah
arg_6		= word ptr  0Ch

		push	bp
		mov	bp, sp
		push	si
		push	di
		push	GC_RMW
		mov	al, [bp+arg_0]
		mov	ah, 0
		push	ax
		call	grcg_setcolor
		mov	ax, [bp+arg_4]
		mov	dx, ax
		shl	ax, 2
		add	ax, dx
		add	ax, 0A805h
		mov	es, ax
		mov	cx, [bp+arg_6]
		mov	si, offset _FIVE_DIGIT_POWERS_OF_10
		mov	di, [bp+arg_2]
		mov	bl, 0
		nop

loc_D696:
		mov	ax, di
		xor	dx, dx
		div	word ptr [si]
		mov	di, dx
		or	bl, al
		jz	short loc_D6A5
		call	sub_D50E

loc_D6A5:
		add	cx, 8
		add	si, 2
		cmp	word ptr [si], 1
		ja	short loc_D696
		mov	ax, di
		or	bl, al
		jz	short loc_D6B9
		call	sub_D50E

loc_D6B9:
		pop	di
		pop	si
		pop	bp
		retf	8
sub_D668	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D6C0	proc far

arg_0		= byte ptr  6

		push	bp
		mov	bp, sp
		mov	al, [bp+arg_0]
		mov	ah, 3
		sub	ah, al
		mov	byte ptr cs:loc_D56B+1,	ah
		pop	bp
		retf	2
sub_D6C0	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D6D4	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_0]
		mov	dx, [si]
		mov	cx, [si+2]
		mov	al, byte_23AE6
		cbw
		add	dx, ax
		mov	al, byte_23AE7
		cbw
		add	cx, ax
		cmp	dx, 80h
		jge	short loc_D6F7
		mov	dx, 80h
		jmp	short loc_D700
; ---------------------------------------------------------------------------

loc_D6F7:
		cmp	dx, 1180h
		jle	short loc_D700
		mov	dx, 1180h

loc_D700:
		cmp	cx, 180h
		jge	short loc_D70B
		mov	cx, 180h
		jmp	short loc_D714
; ---------------------------------------------------------------------------

loc_D70B:
		cmp	cx, 1600h
		jle	short loc_D714
		mov	cx, 1600h

loc_D714:
		mov	[si], dx
		mov	[si+2],	cx
		pop	si
		pop	bp
		retn	2
sub_D6D4	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_D71E	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		mov	byte_23AE6, 0
		mov	byte_23AE7, 0
		mov	bx, [bp+arg_0]
		cmp	bx, 8
		jz	short loc_D79B
		ja	short loc_D743
		cmp	bx, 6
		ja	loc_D7CF
		add	bx, bx
		jmp	cs:off_D7E2[bx]
; ---------------------------------------------------------------------------

loc_D743:
		cmp	bx, 200h
		jz	short loc_D775
		ja	short loc_D75D
		cmp	bx, 9
		jz	short loc_D7A3
		cmp	bx, 0Ah
		jz	short loc_D78D
		cmp	bx, 100h
		jz	short loc_D7BD
		jmp	short loc_D7CF
; ---------------------------------------------------------------------------

loc_D75D:
		cmp	bx, 400h
		jz	short loc_D7A3
		cmp	bx, 800h
		jz	short loc_D78D
		jmp	short loc_D7CF
; ---------------------------------------------------------------------------

loc_D76B:
		mov	al, byte_23AE2
		neg	al
		mov	byte_23AE6, al
		jmp	short loc_D7D5
; ---------------------------------------------------------------------------

loc_D775:
		mov	al, byte_23AE4
		neg	al
		mov	byte_23AE6, al
		mov	al, byte_23AE5
		mov	byte_23AE7, al
		jmp	short loc_D7D5
; ---------------------------------------------------------------------------

loc_D785:
		mov	al, byte_23AE3
		mov	byte_23AE7, al
		jmp	short loc_D7D5
; ---------------------------------------------------------------------------

loc_D78D:
		mov	al, byte_23AE4
		mov	byte_23AE6, al
		mov	al, byte_23AE5
		mov	byte_23AE7, al
		jmp	short loc_D7D5
; ---------------------------------------------------------------------------

loc_D79B:
		mov	al, byte_23AE2
		mov	byte_23AE6, al
		jmp	short loc_D7D5
; ---------------------------------------------------------------------------

loc_D7A3:
		mov	al, byte_23AE4
		mov	byte_23AE6, al
		mov	al, byte_23AE5
		neg	al
		mov	byte_23AE7, al
		jmp	short loc_D7D5
; ---------------------------------------------------------------------------

loc_D7B3:
		mov	al, byte_23AE3
		neg	al
		mov	byte_23AE7, al
		jmp	short loc_D7D5
; ---------------------------------------------------------------------------

loc_D7BD:
		mov	al, byte_23AE4
		neg	al
		mov	byte_23AE6, al
		mov	al, byte_23AE5
		neg	al
		mov	byte_23AE7, al
		jmp	short loc_D7D5
; ---------------------------------------------------------------------------

loc_D7CF:
		mov	al, 0
		pop	bp
		retn	2
; ---------------------------------------------------------------------------

loc_D7D5:
		mov	al, 1
		pop	bp
		retn	2
; ---------------------------------------------------------------------------

loc_D7DB:
		mov	al, 2
		pop	bp
		retn	2
sub_D71E	endp

; ---------------------------------------------------------------------------
		db 0
off_D7E2	dw offset loc_D7DB
		dw offset loc_D7B3
		dw offset loc_D785
		dw offset loc_D7CF
		dw offset loc_D76B
		dw offset loc_D7BD
		dw offset loc_D775

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public HYPER_STANDBY
hyper_standby	proc near
		push	bp
		mov	bp, sp
		mov	bx, player_23AE8
		mov	[bx+player_t.shot_mode], SM_1_PAIR
		cmp	[bx+player_t.hyper_active], 0
		jz	short loc_D807
		mov	ax, [bx+player_t.hyper_func]
		mov	[bx+player_t.hyper], ax

loc_D807:
		pop	bp
		retn
hyper_standby	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public HYPER_REIMU
hyper_reimu	proc near
		push	bp
		mov	bp, sp
		mov	bx, player_23AE8
		cmp	[bx+player_t.hyper_active], 0
		jnz	short loc_D81D
		mov	[bx+player_t.hyper], offset hyper_standby
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_D81D:
		mov	bx, player_23AE8
		mov	[bx+player_t.shot_mode], SM_REIMU_HYPER
		mov	al, byte_23AE2
		add	al, 20h	; ' '
		mov	byte_23AE2, al
		mov	al, byte_23AE3
		add	al, 20h	; ' '
		mov	byte_23AE3, al
		mov	al, byte_23AE4
		add	al, 18h
		mov	byte_23AE4, al
		mov	al, byte_23AE5
		add	al, 18h
		mov	byte_23AE5, al
		pop	bp
		retn
hyper_reimu	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public HYPER_MIMA
hyper_mima	proc near
		push	bp
		mov	bp, sp
		mov	bx, player_23AE8
		cmp	[bx+player_t.hyper_active], 0
		jnz	short loc_D85B
		mov	[bx+player_t.hyper], offset hyper_standby
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_D85B:
		mov	bx, player_23AE8
		mov	[bx+player_t.shot_mode], SM_2_PAIRS
		mov	[bx+player_t.shot_active], SA_BLOCKED_FOR_THIS_FRAME
		mov	al, byte_23AE2
		add	al, 20h	; ' '
		mov	byte_23AE2, al
		mov	al, byte_23AE3
		add	al, 20h	; ' '
		mov	byte_23AE3, al
		mov	al, byte_23AE4
		add	al, 18h
		mov	byte_23AE4, al
		mov	al, byte_23AE5
		add	al, 18h
		mov	byte_23AE5, al
		pop	bp
		retn
hyper_mima	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public HYPER_MARISA
hyper_marisa	proc near
		push	bp
		mov	bp, sp
		mov	bx, player_23AE8
		cmp	[bx+player_t.hyper_active], 0
		jnz	short loc_D89D
		mov	[bx+player_t.hyper], offset hyper_standby
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_D89D:
		mov	bx, player_23AE8
		mov	[bx+player_t.shot_mode], SA_DISABLED
		call	sub_14340
		mov	al, byte_23AE2
		add	al, 0F0h
		mov	byte_23AE2, al
		mov	al, byte_23AE3
		add	al, 0F0h
		mov	byte_23AE3, al
		mov	al, byte_23AE4
		add	al, 0F4h
		mov	byte_23AE4, al
		mov	al, byte_23AE5
		add	al, 0F4h
		mov	byte_23AE5, al
		pop	bp
		retn
hyper_marisa	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public HYPER_ELLEN
hyper_ellen	proc near
		push	bp
		mov	bp, sp
		mov	bx, player_23AE8
		cmp	[bx+player_t.hyper_active], 0
		jnz	short loc_D8E0
		mov	[bx+player_t.hyper], offset hyper_standby
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_D8E0:
		mov	bx, player_23AE8
		mov	[bx+player_t.shot_mode], SM_1_PAIR
		test	byte ptr _round_frame, 3
		jnz	short loc_D8F9
		push	[bx+player_t.center.x]
		push	[bx+player_t.center.y]
		call	sub_1B6CA

loc_D8F9:
		pop	bp
		retn
hyper_ellen	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public HYPER_KOTOHIME
hyper_kotohime	proc near
		push	bp
		mov	bp, sp
		mov	bx, player_23AE8
		cmp	[bx+player_t.hyper_active], 0
		jnz	short loc_D90F
		mov	[bx+player_t.hyper], offset hyper_standby
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_D90F:
		mov	bx, player_23AE8
		mov	[bx+player_t.shot_mode], SM_4_PAIRS
		mov	al, byte_23AE2
		add	al, 20h	; ' '
		mov	byte_23AE2, al
		mov	al, byte_23AE3
		add	al, 20h	; ' '
		mov	byte_23AE3, al
		mov	al, byte_23AE4
		add	al, 18h
		mov	byte_23AE4, al
		mov	al, byte_23AE5
		add	al, 18h
		mov	byte_23AE5, al
		pop	bp
		retn
hyper_kotohime	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public HYPER_CHIYURI
hyper_chiyuri	proc near
		push	bp
		mov	bp, sp
		mov	bx, player_23AE8
		cmp	[bx+player_t.hyper_active], 0
		jnz	short loc_D94D
		mov	[bx+player_t.hyper], offset hyper_standby
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_D94D:
		mov	bx, player_23AE8
		mov	[bx+player_t.shot_mode], SM_4_PAIRS
		mov	al, byte_23AE2
		add	al, 20h	; ' '
		mov	byte_23AE2, al
		mov	al, byte_23AE3
		add	al, 20h	; ' '
		mov	byte_23AE3, al
		mov	al, byte_23AE4
		add	al, 18h
		mov	byte_23AE4, al
		mov	al, byte_23AE5
		add	al, 18h
		mov	byte_23AE5, al
		pop	bp
		retn
hyper_chiyuri	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public HYPER_YUMEMI
hyper_yumemi	proc near
		push	bp
		mov	bp, sp
		mov	bx, player_23AE8
		cmp	[bx+player_t.hyper_active], 0
		jnz	short loc_D98B
		mov	[bx+player_t.hyper], offset hyper_standby
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_D98B:
		mov	bx, player_23AE8
		mov	[bx+player_t.shot_mode], SM_4_PAIRS
		mov	al, byte_23AE2
		add	al, 20h	; ' '
		mov	byte_23AE2, al
		mov	al, byte_23AE3
		add	al, 20h	; ' '
		mov	byte_23AE3, al
		mov	al, byte_23AE4
		add	al, 18h
		mov	byte_23AE4, al
		mov	al, byte_23AE5
		add	al, 18h
		mov	byte_23AE5, al
		pop	bp
		retn
hyper_yumemi	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public HYPER_KANA
hyper_kana	proc near
		push	bp
		mov	bp, sp
		mov	bx, player_23AE8
		cmp	[bx+player_t.hyper_active], 0
		jnz	short loc_D9C9
		mov	[bx+player_t.hyper], offset hyper_standby
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_D9C9:
		mov	bx, player_23AE8
		mov	[bx+player_t.shot_mode], SM_4_PAIRS
		mov	al, byte_23AE2
		add	al, 20h	; ' '
		mov	byte_23AE2, al
		mov	al, byte_23AE3
		add	al, 20h	; ' '
		mov	byte_23AE3, al
		mov	al, byte_23AE4
		add	al, 18h
		mov	byte_23AE4, al
		mov	al, byte_23AE5
		add	al, 18h
		mov	byte_23AE5, al
		pop	bp
		retn
hyper_kana	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public HYPER_RIKAKO
hyper_rikako	proc near
		push	bp
		mov	bp, sp
		mov	bx, player_23AE8
		cmp	[bx+player_t.hyper_active], 0
		jnz	short loc_DA0C
		mov	[bx+player_t.hyper], offset hyper_standby
		call	sub_1C4B4
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_DA0C:
		mov	bx, player_23AE8
		cmp	[bx+player_t.gauge_avail], (250 shl 4)
		jbe	short loc_DA21
		call	rikako_1C497 pascal, word ptr [bx], word ptr [bx+2]

loc_DA21:
		mov	al, byte_23AE2
		add	al, 0F0h
		mov	byte_23AE2, al
		mov	al, byte_23AE3
		add	al, 0F0h
		mov	byte_23AE3, al
		mov	al, byte_23AE4
		add	al, 0F8h
		mov	byte_23AE4, al
		mov	al, byte_23AE5
		add	al, 0F8h
		mov	byte_23AE5, al
		pop	bp
		retn
hyper_rikako	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_DA43	proc near

var_6		= byte ptr -6
var_5		= byte ptr -5
var_4		= word ptr -4
var_2		= word ptr -2
arg_0		= word ptr  4
arg_2		= word ptr  6

		push	bp
		mov	bp, sp
		sub	sp, 6
		push	si
		push	di
		mov	di, [bp+arg_2]
		mov	si, [bp+arg_0]
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		shl	ax, 7
		add	ax, offset _players
		mov	player_23AE8, ax
		cmp	byte ptr [si+6], 0
		jz	short loc_DA68
		dec	byte ptr [si+6]

loc_DA68:
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		cmp	_damage_all_enemies_on[bx], 0
		jz	short loc_DA81
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		dec	_damage_all_enemies_on[bx]

loc_DA81:
		cmp	byte_20E3C, 2
		jz	loc_DE4F
		cmp	byte ptr [si+1Fh], 0
		jnz	loc_DE45
		mov	al, [si+9]
		mov	byte_23AE2, al
		mov	al, [si+0Ah]
		mov	byte_23AE3, al
		mov	al, [si+0Bh]
		mov	byte_23AE4, al
		mov	al, [si+0Ch]
		mov	byte_23AE5, al
		call	word ptr [si+64h]
		cmp	byte ptr [si+11h], 0
		jnz	loc_DBDC
		cmp	byte ptr [si+15h], 0
		jnz	short loc_DB0A
		mov	ax, di
		and	ax, 0F0Fh
		mov	[bp+var_4], ax
		mov	[bp+var_6], 1

loc_DAC7:
		push	[bp+var_4]
		call	sub_D71E
		mov	[bp+var_5], al
		cmp	[bp+var_5], 0
		jnz	short loc_DAEF
		cmp	[bp+var_6], 0
		jz	short loc_DAEF
		mov	ax, [si+20h]
		cmp	ax, [bp+var_4]
		jz	short loc_DAF9
		not	ax
		and	[bp+var_4], ax
		mov	[bp+var_6], 0
		jmp	short loc_DAC7
; ---------------------------------------------------------------------------

loc_DAEF:
		cmp	[bp+var_5], 1
		jnz	short loc_DAF9
		push	si
		call	sub_D6D4

loc_DAF9:
		cmp	[bp+var_6], 0
		jz	loc_DBDF
		mov	ax, [bp+var_4]
		mov	[si+20h], ax
		jmp	loc_DBDF
; ---------------------------------------------------------------------------

loc_DB0A:
		inc	word ptr [si+74h]
		push	si
		call	sub_C54A
		cmp	byte_20E48, 0
		jnz	short loc_DB1E
		mov	[bp+var_5], 6
		jmp	short loc_DB3C
; ---------------------------------------------------------------------------

loc_DB1E:
		cmp	byte_20E48, -1
		jnz	short loc_DB2B
		mov	[bp+var_5], 20h	; ' '
		jmp	short loc_DB3C
; ---------------------------------------------------------------------------

loc_DB2B:
		cmp	byte_20E48, -2
		jnz	short loc_DB38
		mov	[bp+var_5], 7
		jmp	short loc_DB3C
; ---------------------------------------------------------------------------

loc_DB38:
		mov	[bp+var_5], 0Ah

loc_DB3C:
		mov	al, [bp+var_5]
		mov	ah, 0
		push	ax
		mov	ax, word_23AF6
		xor	dx, dx
		pop	bx
		div	bx
		or	dx, dx
		jnz	short loc_DB5D
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+4B9Ch], 4
		mov	di, 20h	; ' '

loc_DB5D:
		mov	byte_20E48, 0
		cmp	byte ptr [si+4], 0
		jnz	short loc_DBC8
		cmp	byte ptr [si+1Dh], 0
		jnz	short loc_DB77
		mov	al, [si+7]
		cbw
		cmp	ax, 3
		jle	short loc_DBDF

loc_DB77:
		mov	al, [si+1Ch]
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+si+24h]
		mov	ah, 0
		mov	dx, [si+1Ah]
		shr	dx, 4
		cmp	ax, dx
		jb	short loc_DB94
		cmp	word ptr [si+1Ah], 0FF0h
		jnz	short loc_DBDF

loc_DB94:
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+4B9Ch], 0
		mov	di, 20h	; ' '
		mov	ax, [si+18h]
		cmp	ax, [si+1Ah]
		jb	short loc_DBDF
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+4B9Ch], 4
		xor	di, di
		inc	byte ptr [si+1Ch]
		cmp	byte ptr [si+1Ch], 40h
		jb	short loc_DBDF
		mov	byte ptr [si+1Ch], 0
		jmp	short loc_DBDF
; ---------------------------------------------------------------------------

loc_DBC8:
		mov	byte ptr [si+4], 0
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+4B9Ch], 4
		xor	di, di
		jmp	short loc_DBDF
; ---------------------------------------------------------------------------

loc_DBDC:
		dec	byte ptr [si+11h]

loc_DBDF:
		mov	[bp+var_5], 0
		cmp	byte ptr [si+14h], 0
		jz	short loc_DBFE
		push	si
		call	sub_DFE9
		mov	word ptr [si+18h], 0
		mov	word ptr [si+74h], 0
		mov	[bp+var_5], 1
		jmp	loc_DD3C
; ---------------------------------------------------------------------------

loc_DBFE:
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+4B9Ch], 2
		ja	short loc_DC54
		cmp	byte ptr [si+1Eh], 0
		jnz	short loc_DC54
		mov	ax, [si+18h]
		cmp	ax, [si+1Ah]
		jnb	short loc_DC47
		mov	al, [si+17h]
		mov	ah, 0
		add	[si+18h], ax
		mov	ax, [si+18h]
		cmp	ax, [si+1Ah]
		jbe	short loc_DC34
		mov	ax, [si+1Ah]
		mov	[si+18h], ax
		mov	byte ptr [si+23h], 0

loc_DC34:
		cmp	word ptr [si+18h], 180h
		jnz	loc_DD3C
		call	snd_se_play pascal, 9
		jmp	loc_DD3C
; ---------------------------------------------------------------------------

loc_DC47:
		inc	byte ptr [si+23h]
		cmp	byte ptr [si+23h], 80h
		jb	loc_DD3C
		jmp	short loc_DC64
; ---------------------------------------------------------------------------

loc_DC54:
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+4B9Ch], 4
		ja	loc_DD3C

loc_DC64:
		mov	ax, [si+18h]
		mov	[bp+var_2], ax
		cmp	[bp+var_2], 400h
		jl	loc_DD37
		push	word ptr [si]
		push	word ptr [si+2]
		call	dword ptr [si+68h]
		cmp	[bp+var_2], 800h
		jl	loc_DD2B
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+798h], 1
		cmp	[bp+var_2], 0FF0h
		jl	short loc_DCD3
		mov	al, byte_1DB9E
		cmp	al, byte ptr word_23AF0
		jz	short loc_DCDA
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+393Ch], 5
		mov	word ptr [si+1Ah], 400h
		cmp	byte_1F39E, 10h
		jnb	short loc_DCBC
		inc	byte_1F39E

loc_DCBC:
		add	word_21434, 2800h
		cmp	byte_1DB9E, -1
		jnz	short loc_DCCE
		inc	byte ptr [si+77h]
		jmp	short loc_DD2B
; ---------------------------------------------------------------------------

loc_DCCE:
		inc	byte ptr [si+78h]
		jmp	short loc_DD2B
; ---------------------------------------------------------------------------

loc_DCD3:
		cmp	[bp+var_2], 0C00h
		jl	short loc_DCFE

loc_DCDA:
		inc	byte ptr [si+76h]
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+393Ch], 3
		sub	word ptr [si+1Ah], 800h
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D56h], 10h
		jnb	short loc_DD2B
		jmp	short loc_DD20
; ---------------------------------------------------------------------------

loc_DCFE:
		inc	byte ptr [si+76h]
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+393Ch], 1
		sub	word ptr [si+1Ah], 400h
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D56h], 10h
		jnb	short loc_DD2B

loc_DD20:
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+2D56h]

loc_DD2B:
		mov	al, [si+6]
		add	al, 6
		mov	[si+6],	al
		mov	[bp+var_5], 1

loc_DD37:
		mov	word ptr [si+18h], 0

loc_DD3C:
		cmp	byte ptr [si+22h], 2
		jnz	short loc_DD44
		xor	di, di

loc_DD44:
		cmp	byte ptr [si+11h], 0
		jnz	short loc_DDAE
		cmp	byte ptr [si+22h], 0
		jz	short loc_DDAE
		test	di, 20h
		jnz	short loc_DD5C
		cmp	byte ptr [si+22h], 2
		jnz	short loc_DD7B

loc_DD5C:
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+4B9Ch], 2
		jbe	short loc_DD7B
		call	sub_E737
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+4B9Ch], 0
		jmp	short loc_DD9A
; ---------------------------------------------------------------------------

loc_DD7B:
		test	di, 20h
		jnz	short loc_DD9A
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+4B9Ch], 8
		jnb	short loc_DD9A
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+4B9Ch]

loc_DD9A:
		test	di, 10h
		jz	short loc_DDA4
		call	player_bomb pascal, si

loc_DDA4:
		cmp	byte ptr [si+22h], 2
		jnz	short loc_DDAE
		mov	byte ptr [si+22h], 1

loc_DDAE:
		cmp	byte ptr [si+1Eh], 0
		jz	short loc_DDCE
		cmp	word ptr [si+1Ah], 400h
		jbe	short loc_DDC1
		sub	word ptr [si+1Ah], 6
		jmp	short loc_DDCA
; ---------------------------------------------------------------------------

loc_DDC1:
		mov	byte ptr [si+1Eh], 0
		mov	word ptr [si+1Ah], 400h

loc_DDCA:
		mov	[bp+var_5], 1

loc_DDCE:
		cmp	byte_20E3C, 0
		jnz	short loc_DE4F
		cmp	[bp+var_5], 0
		jnz	short loc_DE4F
		push	4
		call	sub_E0F7
		cmp	byte ptr [si+4], 0
		jz	short loc_DE4F
		cmp	byte ptr [si+7], 0
		jz	short loc_DE3F
		push	word ptr [si]
		push	word ptr [si+2]
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		push	ax
		nopcall	sub_B7B3
		push	si
		call	sub_E1D5
		mov	dl, [si+7]
		sub	dl, al
		mov	[si+7],	dl
		mov	al, [si+7]
		cbw
		or	ax, ax
		jge	short loc_DE14
		mov	byte ptr [si+7], 0

loc_DE14:
		cmp	byte ptr [si+7], 0
		jnz	short loc_DE26
		mov	byte ptr [si+1Fh], 30h ; '0'
		mov	al, byte ptr word_23AF0
		mov	byte_20E3D, al
		jmp	short loc_DE36
; ---------------------------------------------------------------------------

loc_DE26:
		mov	byte ptr [si+14h], 1
		mov	byte ptr [si+10h], 40h
		mov	byte ptr [si+6], 6Eh ; 'n'
		mov	byte ptr [si+11h], 40h

loc_DE36:
		push	word_23AF0
		nopcall	sub_B92F

loc_DE3F:
		mov	byte ptr [si+4], 0
		jmp	short loc_DE4F
; ---------------------------------------------------------------------------

loc_DE45:
		cmp	byte ptr [si+1Fh], -1
		jz	short loc_DE4F
		push	si
		call	sub_C0D8

loc_DE4F:
		cmp	byte_23AE6, 0
		jnz	short loc_DE5C
		mov	byte ptr [si+0Eh], 0
		jmp	short loc_DE6E
; ---------------------------------------------------------------------------

loc_DE5C:
		mov	al, byte_23AE6
		cbw
		or	ax, ax
		jge	short loc_DE6A
		mov	byte ptr [si+0Eh], 1
		jmp	short loc_DE6E
; ---------------------------------------------------------------------------

loc_DE6A:
		mov	byte ptr [si+0Eh], 2

loc_DE6E:
		mov	byte ptr [si+0Fh], 0
		cmp	_page_back, 0
		jz	short loc_DE8F
		cmp	byte ptr [si+1Eh], 0
		jz	short loc_DE85
		mov	byte ptr [si+0Fh], 2
		jmp	short loc_DE8F
; ---------------------------------------------------------------------------

loc_DE85:
		cmp	byte ptr [si+6], 0
		jz	short loc_DE8F
		mov	byte ptr [si+0Fh], 1

loc_DE8F:
		pop	di
		pop	si
		leave
		retn	4
sub_DA43	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_DE95	proc near

@@top		= word ptr -4
@@left		= word ptr -2
arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		sub	sp, 4
		push	si
		push	di
		mov	si, [bp+arg_0]
		cmp	byte ptr [si+1Fh], 0
		jz	short loc_DEB2
		cmp	byte ptr [si+1Fh], -1
		jz	short loc_DF12
		push	si
		call	sub_C248
		jmp	short loc_DF12
; ---------------------------------------------------------------------------

loc_DEB2:
		cmp	byte ptr [si+0Fh], 0
		jnz	short loc_DF12
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 32
		push	word ptr [si]
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		push	ax
		nopcall	playfield_fg_x_to_screen
		add	ax, -16
		mov	[bp+@@left], ax
		mov	ax, [si+2]
		sar	ax, 4
		add	ax, -16
		mov	[bp+@@top], ax
		mov	al, [si+0Eh]
		mov	ah, 0
		shl	ax, 2
		add	ax, 2844h
		mov	di, ax
		cmp	byte ptr word_23AF0, 0
		jz	short loc_DF06
		add	di, 0A00h

loc_DF06:
		call	sprite16_put pascal, [bp+@@left], [bp+@@top], di

loc_DF12:
		pop	di
		pop	si
		leave
		retn	2
sub_DE95	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_DF18	proc near

@@y		= word ptr -4
@@x		= word ptr -2
arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		sub	sp, 4
		push	si
		push	di
		mov	si, [bp+arg_0]
		cmp	byte ptr [si+1Fh], 0
		jnz	loc_DFE3
		cmp	byte ptr [si+0Fh], 0
		jz	short loc_DF7D
		push	word ptr [si]
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		push	ax
		nopcall	playfield_fg_x_to_screen
		add	ax, -16
		mov	[bp+@@x], ax
		mov	ax, [si+2]
		sar	ax, 5
		add	ax, -8
		mov	[bp+@@y], ax
		mov	al, [si+0Fh]
		mov	ah, 0
		mov	di, ax
		cmp	byte ptr word_23AF0, 0
		jz	short loc_DF61
		add	di, 9

loc_DF61:
		mov	al, [si+0Eh]
		mov	ah, 0
		add	ax, ax
		add	di, ax
		mov	al, [si+0Eh]
		mov	ah, 0
		add	di, ax
		call	super_put pascal, [bp+@@x], [bp+@@y], di

loc_DF7D:
		cmp	word ptr [si+18h], 100h
		jb	short loc_DFE3
		cmp	word ptr [si+18h], 400h
		jnb	short loc_DF90
		mov	di, 2Ch	; ','
		jmp	short loc_DFAB
; ---------------------------------------------------------------------------

loc_DF90:
		cmp	word ptr [si+18h], 800h
		jnb	short loc_DF9C
		mov	di, 30h	; '0'
		jmp	short loc_DFAB
; ---------------------------------------------------------------------------

loc_DF9C:
		cmp	word ptr [si+18h], 0FF0h
		jnb	short loc_DFA8
		mov	di, 34h	; '4'
		jmp	short loc_DFAB
; ---------------------------------------------------------------------------

loc_DFA8:
		mov	di, 38h	; '8'

loc_DFAB:
		push	word ptr [si]
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		push	ax
		nopcall	playfield_fg_x_to_screen
		add	ax, -16
		mov	[bp+@@x], ax
		mov	ax, [si+2]
		sar	ax, 5
		add	ax, -15
		mov	[bp+@@y], ax
		mov	ax, word_23AF6
		shr	ax, 2
		and	ax, 3
		add	ax, di
		mov	di, ax
		call	super_put pascal, [bp+@@x], [bp+@@y], ax

loc_DFE3:
		pop	di
		pop	si
		leave
		retn	2
sub_DF18	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_DFE9	proc near

@@vector_y		= byte ptr -4
@@vector_x		= byte ptr -2
arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		sub	sp, 4
		push	si
		mov	si, [bp+arg_0]
		cmp	byte ptr [si+10h], 40h
		jnz	short loc_E036
		call	snd_se_play pascal, 2
		push	3Fh ; '?'
		call	randring1_next16_and
		mov	[si+12h], al
		cmp	word ptr [si], 900h
		jge	short loc_E01C
		cmp	word ptr [si+2], 0B80h
		jle	short loc_E032
		mov	al, [si+12h]
		add	al, 0C0h
		jmp	short loc_E02F
; ---------------------------------------------------------------------------

loc_E01C:
		cmp	word ptr [si+2], 0B80h
		jge	short loc_E02A
		mov	al, [si+12h]
		add	al, 40h
		jmp	short loc_E02F
; ---------------------------------------------------------------------------

loc_E02A:
		mov	al, [si+12h]
		add	al, 80h

loc_E02F:
		mov	[si+12h], al

loc_E032:
		mov	byte ptr [si+13h], 40h

loc_E036:
		cmp	byte ptr [si+10h], 20h ; ' '
		jbe	short loc_E06E
		mov	al, [si+13h]
		add	al, 0FEh
		mov	[si+13h], al
		push	ss
		lea	ax, [bp+@@vector_x]
		push	ax
		push	ss
		lea	ax, [bp+@@vector_y]
		push	ax
		push	word ptr [si+12h]
		mov	al, [si+13h]
		mov	ah, 0
		push	ax
		call	vector2
		mov	al, [bp+@@vector_x]
		mov	byte_23AE6, al
		mov	al, [bp+@@vector_y]
		mov	byte_23AE7, al
		push	si
		call	sub_D6D4
		jmp	short loc_E078
; ---------------------------------------------------------------------------

loc_E06E:
		cmp	byte ptr [si+10h], 0
		jnz	short loc_E078
		mov	byte ptr [si+14h], 0

loc_E078:
		dec	byte ptr [si+10h]
		pop	si
		leave
		retn	2
sub_DFE9	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public PLAYER_BOMB
player_bomb	proc near

@@player		= word ptr  4

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+@@player]
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_INACTIVE
		jnz	short @@ret
		cmp	[si+player_t.hyper_active], 0
		jnz	short @@ret
		cmp	[si+player_t.bombs], 0
		jz	short loc_E0BF
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		mov	_bomb_state[bx], BOMB_PREPARING
		dec	[si+player_t.bombs]
		mov	[si+player_t.invincibility_time], BOMB_FRAMES
		push	word_23AF0
		nopcall	sub_B9AB
		jmp	short loc_E0EF
; ---------------------------------------------------------------------------

loc_E0BF:
		cmp	[si+player_t.gauge_avail], GAUGE_MAX
		jb	short @@ret
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		mov	_damage_all_enemies_on[bx], 1
		call	snd_se_play pascal, 7
		mov	al, [si+player_t.playchar_paletted]
		mov	[si+player_t.hyper_active], al
		push	[si+player_t.center.x]
		push	[si+player_t.center.y]
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		push	ax
		nopcall	sub_CDBD

loc_E0EF:
		call	sub_E24B

@@ret:
		pop	si
		pop	bp
		retn	2
player_bomb	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_E0F7	proc near

var_3		= byte ptr -3
var_2		= word ptr -2
arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		sub	sp, 4
		push	si
		push	di
		mov	si, player_23AE8
		cmp	[si+player_t.invincibility_time], 0
		jnz	short loc_E10F
		cmp	[si+player_t.hyper_active], 0
		jz	short loc_E112

loc_E10F:
		jmp	loc_E1CF
; ---------------------------------------------------------------------------

loc_E112:
		mov	ax, [bp+arg_0]
		mov	bx, ax
		sar	ax, 1
		mov	dx, [si+player_t.center.x]
		sar	dx, 5
		sub	dx, ax
		mov	cx, [si+player_t.center.y]
		sar	cx, 5
		sub	cx, ax
		add	bx, cx
		cmp	cx, 0
		jge	short loc_E133
		xor	cx, cx
		jmp	short loc_E13C
; ---------------------------------------------------------------------------

loc_E133:
		cmp	bx, 0B8h
		jl	short loc_E13C
		mov	bx, 0B7h

loc_E13C:
		mov	[bp+var_3], bl
		mov	[bp+var_2], cx
		mov	cx, dx
		; Hack (and cx, 7)
		db 081h
		db 0e1h
		db 007h
		db 000h
		sar	dx, 3
		mov	di, [bp+arg_0]
		add	di, cx
		mov	ch, 11111111b
		shr	ch, cl
		mov	bx, di
		cmp	bx, 8
		jg	short loc_E163
		mov	bh, 11111111b
		mov	cl, bl
		shr	bh, cl
		xor	ch, bh

loc_E163:
		mov	al, dl
		mov	bl, 0B8h
		mul	bl
		mov	bx, 4BA0h
		add	bx, ax
		cmp	byte ptr word_23AF0, 1
		jnz	short loc_E179
		add	bx, 0CF0h

loc_E179:
		add	bx, [bp+var_2]
		mov	dh, [bp+var_3]
		mov	ax, [bp+var_2]

loc_E182:
		cmp	dl, 12h
		jge	short loc_E1CF
		or	dl, dl
		jl	short loc_E1B3
		mov	ah, al
		mov	cl, 0B8h

loc_E18F:
		test	[bx], ch
		jz	short loc_E1AA
		xor	dh, dh
		shl	dx, 8
		mov	word_20E44, dx
		mov	ah, 0
		shl	ax, 5
		mov	word_20E46, ax
		mov	[si+player_t.is_hit], 1
		jmp	short loc_E1CF
; ---------------------------------------------------------------------------

loc_E1AA:
		inc	bx
		dec	cl
		inc	ah
		cmp	ah, dh
		jb	short loc_E18F

loc_E1B3:
		inc	dl
		mov	ch, 0
		add	bx, cx
		sub	di, 8
		mov	ch, 11111111b
		cmp	di, 8
		jnb	short loc_E1CB
		mov	cx, di
		mov	ch, 11111111b
		shr	ch, cl
		not	ch

loc_E1CB:
		or	di, di
		jg	short loc_E182

loc_E1CF:
		pop	di
		pop	si
		leave
		retn	2
sub_E0F7	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_E1D5	proc near

var_2		= byte ptr -2
@@damage		= byte ptr -1
arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		sub	sp, 2
		push	si
		mov	si, [bp+arg_0]
		mov	al, 1
		sub	al, byte ptr word_23AF0
		mov	[bp+var_2], al
		cmp	byte ptr [si+15h], 0
		jnz	short loc_E1F3
		mov	al, [si+73h]
		jmp	short loc_E1FD
; ---------------------------------------------------------------------------

loc_E1F3:
		mov	al, [si+73h]
		mov	[bp+@@damage], al
		add	al, _cpu_hit_damage_additional

loc_E1FD:
		mov	[bp+@@damage], al
		mov	byte ptr [si+73h], 3
		mov	al, [bp+var_2]
		cbw
		shl	ax, 7
		mov	bx, ax
		cmp	_players[bx].miss_damage_next, 3
		jbe	short loc_E221
		mov	al, [bp+var_2]
		cbw
		shl	ax, 7
		mov	bx, ax
		dec	_players[bx].miss_damage_next

loc_E221:
		mov	al, [si+7]
		cbw
		push	ax
		mov	al, [bp+@@damage]
		cbw
		pop	dx
		sub	dx, ax
		jg	short loc_E240
		mov	al, [si+7]
		cbw
		cmp	ax, 1
		jle	short loc_E240
		mov	al, [si+7]
		dec	al
		mov	[bp+@@damage], al

loc_E240:
		call	sub_E24B
		mov	al, [bp+@@damage]
		pop	si
		leave
		retn	2
sub_E1D5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_E24B	proc near
		push	bp
		mov	bp, sp
		cmp	byte ptr word_23AF0, 0
		jnz	short loc_E264
		les	bx, _resident
		cmp	es:[bx+resident_t.skill], 0
		jbe	short loc_E264
		dec	es:[bx+resident_t.skill]

loc_E264:
		pop	bp
		retn
sub_E24B	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_E266	proc near
		push	bp
		mov	bp, sp
		graph_accesspage 1
		call	super_put pascal, (544 shl 16) or 328, 0
		call	super_put pascal, (576 shl 16) or 328, 3
		call	super_put pascal, (608 shl 16) or 328, 6
		call	super_put pascal, (544 shl 16) or 360, 9
		call	super_put pascal, (576 shl 16) or 360, 12
		call	super_put pascal, (608 shl 16) or 360, 15
		graph_accesspage 0
		call	super_put pascal, (544 shl 16) or 328, 0
		call	super_put pascal, (576 shl 16) or 328, 3
		call	super_put pascal, (608 shl 16) or 328, 6
		call	super_put pascal, (544 shl 16) or 360, 9
		call	super_put pascal, (576 shl 16) or 360, 12
		call	super_put pascal, (608 shl 16) or 360, 15
		pop	bp
		retn
sub_E266	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_E313	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	si, offset _shotpairs
		xor	ax, ax
		jmp	short loc_E326
; ---------------------------------------------------------------------------

loc_E31F:
		mov	[si+shotpair_t.flag], 0
		inc	ax
		add	si, size shotpair_t

loc_E326:
		cmp	ax, SHOTPAIR_COUNT
		jl	short loc_E31F
		mov	di, 3ED6h
		xor	ax, ax
		jmp	short loc_E339
; ---------------------------------------------------------------------------

loc_E332:
		mov	byte ptr [di], 0
		inc	ax
		add	di, 30h	; '0'

loc_E339:
		cmp	ax, 40h
		jl	short loc_E332
		mov	_round_frame, 0
		mov	word_23AF6, 0
		mov	byte_23AF9, 1
		mov	byte_23B00, 0
		pop	di
		pop	si
		pop	bp
		retn
sub_E313	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_E35B	proc near

arg_0		= word ptr  4
arg_2		= word ptr  6
arg_4		= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	di, [bp+arg_4]
		mov	si, [bp+arg_0]
		cmp	si, 10
		jl	short loc_E3CE
		cmp	si, 100
		jl	short loc_E39F
		lea	ax, [di+12h]
		push	ax
		mov	ax, [bp+arg_2]
		add	ax, 60h
		mov	bx, 16
		cwd
		idiv	bx
		push	ax
		mov	ax, si
		mov	bx, 100
		cwd
		idiv	bx
		add	ax, gb_0_
		push	ax
		push	TX_WHITE
		call	gaiji_putca
		mov	bx, 100
		mov	ax, si
		cwd
		idiv	bx
		mov	si, dx

loc_E39F:
		lea	ax, [di+14h]
		push	ax
		mov	ax, [bp+arg_2]
		add	ax, 60h
		mov	bx, 16
		cwd
		idiv	bx
		push	ax
		mov	ax, si
		mov	bx, 10
		cwd
		idiv	bx
		add	ax, gb_0_
		push	ax
		push	TX_WHITE
		call	gaiji_putca
		mov	bx, 10
		mov	ax, si
		cwd
		idiv	bx
		mov	si, dx

loc_E3CE:
		lea	ax, [di+16h]
		push	ax
		mov	ax, [bp+arg_2]
		add	ax, 60h
		mov	bx, 16
		cwd
		idiv	bx
		push	ax
		lea	ax, [si+gb_0_]
		push	ax
		push	TX_WHITE
		call	gaiji_putca
		pop	di
		pop	si
		pop	bp
		retn	6
sub_E35B	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_E3F2	proc near

var_6		= dword	ptr -6
@@pid		= word ptr -2

		enter	6, 0
		push	si
		push	di
		mov	al, byte_20E3D
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		mov	[bp+@@pid], dx
		mov	si, 4
		cmp	[bp+@@pid], 0
		jz	short loc_E411
		add	si, 28h	; '('

loc_E411:
		mov	ax, word_23AF6
		and	ax, 7
		cmp	ax, 1
		jnz	loc_E602
		call	text_putsa pascal, si, 8, ds, offset aMAX_COMBO, TX_WHITE
		call	text_putsa pascal, si, 10, ds, offset aGAUGE_ATTACK_TIMES, TX_WHITE
		call	text_putsa pascal, si, 12, ds, offset aBOSS_ATTACK_TIMES, TX_WHITE
		call	text_putsa pascal, si, 14, ds, offset aBOSS_REVERSAL_TIMES, TX_WHITE
		call	text_putsa pascal, si, 16, ds, offset aBOSS_PANIC_TIMES, TX_WHITE
		call	text_putsa pascal, si, 20, ds, offset aTOTAL, TX_WHITE
		les	bx, _resident
		cmp	es:[bx+resident_t.story_stage], 8
		jnb	short loc_E48C
		push	si
		push	6
		push	ds
		push	offset aWINNER_BONUS
		jmp	short loc_E4A2
; ---------------------------------------------------------------------------

loc_E48C:
		call	text_putsa pascal, si, 6, ds, offset aALL_CLEAR, TX_WHITE
		push	si
		push	18
		push	ds
		push	offset aPLAYER_REM

loc_E4A2:
		push	TX_WHITE
		call	text_putsa
		mov	ax, [bp+@@pid]
		shl	ax, 7
		add	ax, offset _players
		mov	di, ax
		cmp	word_23AF6, 1
		jnz	loc_E5AC
		mov	al, [di+player_t.combo_hits_max]
		mov	_win_combo_hits_max, al
		mov	al, [di+player_t.gauge_attacks_fired]
		mov	_win_gauge_attacks_fired, al
		mov	al, [di+player_t.boss_attacks_fired]
		mov	_win_boss_attacks_fired, al
		mov	al, [di+player_t.boss_attacks_reversed]
		mov	_win_boss_attacks_reversed, al
		mov	al, [di+player_t.boss_panics_fired]
		mov	_win_boss_panics_fired, al
		movzx	eax, _win_combo_hits_max
		imul	eax, 1000
		mov	score_23DF0, eax
		movzx	eax, _win_gauge_attacks_fired
		imul	eax, 10000
		add	score_23DF0, eax
		movzx	eax, _win_boss_attacks_fired
		imul	eax, 15000
		add	score_23DF0, eax
		movzx	eax, _win_boss_attacks_reversed
		imul	eax, 20000
		add	score_23DF0, eax
		movzx	eax, _win_boss_panics_fired
		imul	eax, 30000
		add	score_23DF0, eax
		les	bx, _resident
		cmp	es:[bx+resident_t.story_stage], 8
		jnz	short loc_E55E
		mov	al, es:[bx+resident_t.story_lives]
		mov	byte_23DF9, al
		movzx	eax, byte_23DF9
		imul	eax, 100000
		add	score_23DF0, eax
		mov	byte_220DC, -1

loc_E55E:
		mov	eax, score_23DF0
		mov	ebx, 192
		cdq
		idiv	ebx
		mov	[bp+var_6], eax
		cmp	[bp+var_6], 0FFFFh
		jbe	short loc_E583
		mov	score_23DEA, -1
		jmp	short loc_E589
; ---------------------------------------------------------------------------

loc_E583:
		mov	ax, word ptr [bp+var_6]
		mov	score_23DEA, ax

loc_E589:
		mov	eax, score_23DF0
		mov	[bp+var_6], eax
		mov	ebx, 10000
		cdq
		idiv	ebx
		mov	word_23DEC, dx
		mov	eax, [bp+var_6]
		cdq
		idiv	ebx
		mov	word_23DEE, ax

loc_E5AC:
		push	si
		push	20h ; ' '
		mov	al, _win_combo_hits_max
		mov	ah, 0
		push	ax
		call	sub_E35B
		push	si
		push	40h
		mov	al, _win_gauge_attacks_fired
		mov	ah, 0
		push	ax
		call	sub_E35B
		push	si
		push	60h
		mov	al, _win_boss_attacks_fired
		mov	ah, 0
		push	ax
		call	sub_E35B
		push	si
		push	80h
		mov	al, _win_boss_attacks_reversed
		mov	ah, 0
		push	ax
		call	sub_E35B
		push	si
		push	0A0h
		mov	al, _win_boss_panics_fired
		mov	ah, 0
		push	ax
		call	sub_E35B
		les	bx, _resident
		cmp	es:[bx+resident_t.story_stage], 8
		jnz	short loc_E602
		push	si
		push	0C0h
		mov	al, byte_23DF9
		mov	ah, 0
		push	ax
		call	sub_E35B

loc_E602:
		mov	ax, 8
		imul	si
		mov	si, ax
		lea	ax, [si+0D8h]
		push	ax
		push	4003E8h
		push	0Fh
		nopcall	sub_D608
		lea	ax, [si+0D8h]
		push	ax
		push	502710h
		push	0Fh
		nopcall	sub_D608
		lea	ax, [si+0D8h]
		push	ax
		push	603A98h
		push	0Fh
		nopcall	sub_D608
		lea	ax, [si+0D8h]
		push	ax
		push	704E20h
		push	0Fh
		nopcall	sub_D608
		lea	ax, [si+0D8h]
		push	ax
		push	807530h
		push	0Fh
		nopcall	sub_D608
		les	bx, _resident
		cmp	es:[bx+resident_t.story_stage], 8
		jnz	short loc_E692
		lea	ax, [si+0D0h]
		push	ax
		push	902710h
		push	0Fh
		nopcall	sub_D608
		lea	ax, [si+0D8h]
		push	ax
		push	900000h
		push	0Fh
		nopcall	sub_D608

loc_E692:
		cmp	word_23DEC, 0
		jz	short loc_E6A7
		lea	ax, [si+0D8h]
		push	ax
		push	0A0h
		push	word_23DEC
		jmp	short loc_E6D6
; ---------------------------------------------------------------------------

loc_E6A7:
		lea	ax, [si+0D8h]
		push	ax
		push	0A00000h
		push	0Ch
		nopcall	sub_D608
		lea	ax, [si+0C8h]
		push	ax
		push	0A00000h
		push	0Ch
		nopcall	sub_D608
		lea	ax, [si+0C0h]
		push	ax
		push	0A00000h

loc_E6D6:
		push	0Ch
		nopcall	sub_D608
		lea	ax, [si+0B8h]
		push	ax
		push	0A0h
		push	word_23DEE
		push	0Ch
		nopcall	sub_D668
		movzx	eax, score_23DEA
		cmp	eax, score_23DF0
		jge	short loc_E716
		push	score_23DEA
		push	[bp+@@pid]
		nopcall	score_add
		movzx	eax, score_23DEA
		sub	score_23DF0, eax
		jmp	short loc_E733
; ---------------------------------------------------------------------------

loc_E716:
		cmp	score_23DF0, 0
		jle	short loc_E733
		push	word ptr score_23DF0
		push	[bp+@@pid]
		nopcall	score_add
		mov	score_23DF0, 0

loc_E733:
		pop	di
		pop	si
		leave
		retn
sub_E3F2	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_E737	proc near

var_8		= word ptr -8
@@top		= word ptr -6
@@left		= word ptr -4
@@i		= word ptr -2

		enter	8, 0
		push	si
		push	di
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		shl	ax, 7
		add	ax, offset _players
		mov	si, ax
		mov	ax, [si+player_t.center.y]
		mov	[bp+@@top], ax
		cmp	[si+player_t.shot_mode], SM_NONE
		jz	loc_E83B
		cmp	[si+player_t.shot_mode], SM_4_PAIRS
		jnz	short loc_E76D
		mov	ax, [si+player_t.center.x]
		add	ax, (-64 shl 4)
		mov	[bp+@@left], ax
		mov	[bp+var_8], 0
		jmp	short loc_E7C0
; ---------------------------------------------------------------------------

loc_E76D:
		cmp	[si+player_t.shot_mode], SM_2_PAIRS
		jnz	short loc_E782
		mov	ax, [si+player_t.center.x]
		add	ax, (-32 shl 4)
		mov	[bp+@@left], ax
		mov	[bp+var_8], 2
		jmp	short loc_E7C0
; ---------------------------------------------------------------------------

loc_E782:
		cmp	[si+player_t.shot_mode], SM_1_PAIR
		jz	short loc_E7B3
		cmp	[si+player_t.shot_mode], SM_REIMU_HYPER
		jnz	short loc_E7C0
		mov	ax, [si+player_t.center.x]
		add	ax, (-24 shl 4)
		mov	[bp+@@left], ax
		sub	[bp+@@top], (1 shl 4)
		push	ax
		push	[bp+@@top]
		call	sub_14B0A
		add	[bp+@@left], (48 shl 4)
		push	[bp+@@left]
		push	[bp+@@top]
		call	sub_14B0A

loc_E7B3:
		mov	ax, [si+player_t.center.x]
		add	ax, (-16 shl 4)
		mov	[bp+@@left], ax
		mov	[bp+var_8], 3

loc_E7C0:
		mov	di, offset _shotpairs
		call	snd_se_play pascal, 1
		jmp	short loc_E7D4
; ---------------------------------------------------------------------------

loc_E7CC:
		add	[bp+@@left], (32 shl 4)
		inc	[bp+var_8]

loc_E7D4:
		cmp	[bp+@@left], (-32 shl 4)
		jle	short loc_E7CC
		mov	[bp+@@i], 0
		jmp	short loc_E835
; ---------------------------------------------------------------------------

loc_E7E2:
		cmp	[di+shotpair_t.flag], 0
		jnz	short loc_E82F
		mov	[di+shotpair_t.flag], 1
		mov	[di+shotpair_t.unused_1], 0
		mov	ax, [bp+@@left]
		mov	[di+shotpair_t.topleft.x], ax
		mov	ax, [bp+@@top]
		mov	[di+shotpair_t.topleft.y], ax
		mov	[di+shotpair_t.velocity_y], SHOT_VELOCITY
		cmp	byte ptr word_23AF0, 0
		jnz	short loc_E80A
		xor	ax, ax
		jmp	short loc_E80D
; ---------------------------------------------------------------------------

loc_E80A:
		mov	ax, SHOT_SO_PID

loc_E80D:
		mov	[di+shotpair_t.so_pid],	ax
		mov	[di+shotpair_t.so_anim], 0
		mov	al, byte ptr word_23AF0
		mov	[di+shotpair_t.pid], al
		inc	[bp+var_8]
		cmp	[bp+var_8], 4
		jge	short loc_E83B
		add	[bp+@@left], (32 shl 4)
		cmp	[bp+@@left], (PLAYFIELD_W shl 4)
		jge	short loc_E83B

loc_E82F:
		inc	[bp+@@i]
		add	di, size shotpair_t

loc_E835:
		cmp	[bp+@@i], SHOTPAIR_COUNT
		jl	short loc_E7E2

loc_E83B:
		pop	di
		pop	si
		leave
		retn
sub_E737	endp

	SHOTS_UPDATE procdesc pascal near
	SHOTS_RENDER procdesc pascal near
main_01_TEXT	ends

; ===========================================================================

; Segment type:	Pure code
SHARED	segment	word public 'CODE' use16
		assume cs:SHARED
		;org 8
		assume es:nothing, ss:nothing, ds:_DATA, fs:nothing, gs:nothing

include th01/hardware/vram_planes_set.asm
		db 0
include th02/snd/detmode.asm
include th02/snd/pmd_res.asm
include th03/math/vector2.asm
		nop
include th03/math/vector2_between_plus.asm
include th02/exit.asm
include th03/math/vector1_at.asm
include th02/hardware/frame_delay.asm
include th03/hardware/input_sense.asm
		nop
include th02/snd/se.asm
include th02/snd/kajaint.asm
include th02/initmain.asm
include th02/formats/pi_load.asm
include th03/hardware/input_modes.asm
include th03/hardware/input_wait.asm
		db 0
include th03/formats/hfliplut.asm
	extern @MRS_LOAD$QINXC:proc
	extern @MRS_FREE$QI:proc
	extern @MRS_PUT_8$QIUII:proc
	extern @MRS_PUT_NOALPHA_8$QIUIIC:proc
	extern @MRS_HFLIP$QI:proc
	SPRITE16_SPRITES_COMMIT procdesc pascal far
	SPRITE16_PUT procdesc pascal far \
		left:word, screen_top:word, sprite_offset:word
	SPRITE16_PUTX procdesc pascal far \
		left:word, screen_top:word, sprite_offset:word, func:word
	SPRITE16_PUT_NOCLIP procdesc pascal far \
		left:word, screen_top:word, sprite_offset:word
SHARED	ends

; ===========================================================================

; Segment type:	Pure code
main_03_TEXT	segment	byte public 'CODE' use16
		assume cs:main_03_TEXT
		;org 0Ah
		assume es:nothing, ss:nothing, ds:_DATA, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_F1FA	proc near

@@angle		= byte ptr -5
@@top		= word ptr -4
@@left		= word ptr -2
@@length		= word ptr  4
arg_2		= word ptr  6
arg_4		= word ptr  8

		enter	6, 0
		push	si
		push	di
		mov	di, [bp+arg_4]
		cmp	[bp+@@length], 1
		jnz	short loc_F210
		call	snd_se_play pascal, 16

loc_F210:
		push	di
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	playfield_fg_x_to_screen
		mov	di, ax
		mov	ax, [bp+arg_2]
		sar	ax, 4
		add	ax, 10h
		mov	[bp+arg_2], ax
		mov	ax, 8
		imul	[bp+@@length]
		mov	[bp+@@length], ax
		mov	al, byte ptr [bp+@@length]
		mov	[bp+@@angle], al
		cmp	_pid_current, 1
		jnz	short loc_F253
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_F25F
; ---------------------------------------------------------------------------

loc_F253:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_F25F:
		mov	_sprite16_put_w, (48 / 16)
		mov	_sprite16_put_h, 24
		xor	si, si
		jmp	short loc_F2C3
; ---------------------------------------------------------------------------

loc_F26E:
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, di, [bp+@@length], _CosTable8[bx]
		add	ax, -24
		mov	[bp+@@left], ax
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, [bp+arg_2], [bp+@@length], _SinTable8[bx]
		add	ax, -24
		mov	[bp+@@top], ax
		call	sprite16_put pascal, [bp+@@left], ax, 1930h
		inc	si
		mov	al, [bp+@@angle]
		add	al, 10h
		mov	[bp+@@angle], al

loc_F2C3:
		cmp	si, 10h
		jl	short loc_F26E
		mov	al, 0
		sub	al, byte ptr [bp+@@length]
		mov	[bp+@@angle], al
		xor	si, si
		jmp	short loc_F32F
; ---------------------------------------------------------------------------

loc_F2D4:
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_CosTable8[bx]
		mov	ax, [bp+@@length]
		add	ax, ax
		push	ax
		push	di
		call	_vector1_at
		add	sp, 6
		add	ax, -24
		mov	[bp+@@left], ax
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_SinTable8[bx]
		mov	ax, [bp+@@length]
		add	ax, ax
		push	ax
		push	[bp+arg_2]
		call	_vector1_at
		add	sp, 6
		add	ax, -24
		mov	[bp+@@top], ax
		call	sprite16_put pascal, [bp+@@left], ax, 1930h
		inc	si
		mov	al, [bp+@@angle]
		add	al, 20h
		mov	[bp+@@angle], al

loc_F32F:
		cmp	si, 8
		jl	short loc_F2D4
		cmp	[bp+@@length], 0C8h
		jl	short loc_F34E
		push	2560
		mov	al, 1
		sub	al, _pid_current
		push	ax
		call	score_add
		mov	al, 0
		jmp	short loc_F350
; ---------------------------------------------------------------------------

loc_F34E:
		mov	al, -1

loc_F350:
		pop	di
		pop	si
		leave
		retn	6
sub_F1FA	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_F356	proc near
		push	bp
		mov	bp, sp
		mov	ax, word_1F346
		add	word_1F33E, ax
		mov	ax, word_1F348
		add	word_1F340, ax
		inc	angle_1F350
		mov	al, angle_1F350
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, large (16 shl 16) or 0, _SinTable8[bx]
		mov	word_1F348, ax
		cmp	word_1F33E, 300h
		jg	short loc_F399
		mov	word_1F346, 20h	; ' '
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_F399:
		cmp	word_1F33E, 0F00h
		jl	short loc_F3A7
		mov	word_1F346, 0FFE0h

loc_F3A7:
		pop	bp
		retn
sub_F356	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_F3A9	proc near
		push	bp
		mov	bp, sp
		mov	ax, word_1F346
		add	word_1F33E, ax
		add	word_1F340, 20h	; ' '
		cmp	word_1F33E, 300h
		jg	short loc_F3C8
		mov	word_1F346, 20h	; ' '
		jmp	short loc_F3D6
; ---------------------------------------------------------------------------

loc_F3C8:
		cmp	word_1F33E, 0F00h
		jl	short loc_F3D6
		mov	word_1F346, 0FFE0h

loc_F3D6:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, 1
		sub	bx, ax
		add	bx, bx
		mov	word ptr [bx+1DCAh], 0
		cmp	word_1F340, 1A00h
		jl	short loc_F400
		mov	byte_1F34F, 0
		mov	byte_1DB9E, -1
		mov	word_21434, 1400h

loc_F400:
		pop	bp
		retn
sub_F3A9	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_F402	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 5
		jnz	loc_F4AE
		cmp	byte_1DB9E, -1
		jnz	short loc_F481
		mov	si, 1DFEh
		cmp	_pid_current, 1
		jnz	short loc_F42B
		add	si, 20h	; ' '

loc_F42B:
		mov	di, 1DDEh
		mov	ax, ds
		mov	es, ax
		assume es:_DATA
		mov	cx, 10h
		rep movsw
		push	7
		call	randring_far_next16_and
		inc	al
		mov	byte_1F352, al
		mov	word_1F3B0, 0
		mov	al, _pid_current
		mov	byte_1DB9E, al
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+2D54h], 0
		call	snd_se_play pascal, 18
		mov	al, 1
		sub	al, _pid_current
		push	ax
		call	sub_A3A8
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, 1
		sub	bx, ax
		add	bx, bx
		mov	word ptr [bx+1DCAh], 1
		mov	al, 1
		jmp	short loc_F4B0
; ---------------------------------------------------------------------------

loc_F481:
		cmp	byte_1F34F, -1
		jz	short loc_F4AE
		mov	byte_1F34F, -1
		mov	word_1F3B0, 0
		mov	al, 1
		sub	al, _pid_current
		push	ax
		call	sub_A3A8
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	word ptr [bx+1DCAh], 0

loc_F4AE:
		mov	al, 0

loc_F4B0:
		pop	di
		pop	si
		pop	bp
		retn
sub_F402	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_F4B4	proc far

@@pid_other		= byte ptr -1

		enter	2, 0
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		cmp	word_1F34A, 0
		jg	short locret_F510
		cmp	byte_1F34F, -1
		jz	short locret_F510
		mov	byte_1F34F, -1
		mov	word_1F3B0, 0
		push	word ptr [bp+@@pid_other]
		call	sub_A3A8
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 5
		jz	short loc_F4F6
		mov	word_21434, 1400h

loc_F4F6:
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	word ptr [bx+1DCAh], 0
		cmp	byte_1F39E, 10h
		jnb	short locret_F510
		inc	byte_1F39E

locret_F510:
		leave
		retf
sub_F4B4	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_F512	proc near
		push	bp
		mov	bp, sp
		cmp	byte_1F34F, 80h
		jz	short loc_F52B
		mov	ax, word_1F33E
		mov	word_1F326, ax
		mov	ax, word_1F340
		add	ax, 800h
		mov	word_1F328, ax

loc_F52B:
		pop	bp
		retn
sub_F512	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_F52D	proc near

var_1		= byte ptr -1

		enter	2, 0
		call	sub_F356
		cmp	word_1F3B0, 50h	; 'P'
		jb	short locret_F58A

loc_F53B:
		push	0Fh
		call	randring_far_next16_and
		mov	[bp+var_1], al
		mov	al, byte_1F324
		mov	ah, 0
		add	ax, 2
		mov	dl, [bp+var_1]
		mov	dh, 0
		cmp	ax, dx
		jl	short loc_F567
		mov	al, byte_1F324
		mov	ah, 0
		add	ax, 0FFFEh
		mov	dl, [bp+var_1]
		mov	dh, 0
		cmp	ax, dx
		jle	short loc_F53B

loc_F567:
		mov	al, [bp+var_1]
		mov	byte_1F324, al
		mov	word_1F3B0, 0
		add	al, 2
		mov	byte_1F34F, al
		inc	byte_1F351
		mov	al, byte_1F351
		cmp	al, byte_1F352
		jbe	short locret_F58A
		mov	byte_1F34F, 80h

locret_F58A:
		leave
		retn
sub_F52D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_F58C	proc near
		push	bp
		mov	bp, sp
		push	word_1F33E
		push	word_1F340
		push	word_1F3B0
		call	sub_F1FA
		mov	byte_1F34F, al
		cmp	byte_1F34F, 0
		jnz	short loc_F5AD
		mov	byte_1DB9E, -1

loc_F5AD:
		pop	bp
		retn
sub_F58C	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

marisa_F5AF	proc far

arg_0		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		mov	dx, [bp+arg_0]
		mov	ax, dx
		shl	ax, 5
		add	ax, 1DFEh
		mov	si, ax
		mov	word ptr [si], 900h
		mov	word ptr [si+2], 500h
		mov	word ptr [si+8], 0FFE0h
		mov	word ptr [si+0Ah], 0
		mov	byte ptr [si+12h], 0
		mov	byte ptr [si+10h], 0
		mov	byte ptr [si+11h], 0
		mov	word ptr [si+0Ch], 6Eh ; 'n'
		mov	byte ptr [si+13h], 0
		mov	word ptr [si+0Eh], 280h
		or	dx, dx
		jz	short loc_F5F5
		add	word ptr [si+0Eh], 28h ; '('

loc_F5F5:
		mov	byte ptr [si+15h], 0
		pop	si
		pop	bp
		retf	2
marisa_F5AF	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_F5FE	proc near
		push	bp
		mov	bp, sp
		mov	byte_1F353, 1
		cmp	word_1F3B0, 20h	; ' '
		jb	short loc_F683
		cmp	word_1F3B0, 20h	; ' '
		jnz	short loc_F619
		mov	byte_1FE50, 0

loc_F619:
		cmp	word_1F3B0, 50h	; 'P'
		jnb	short loc_F673
		test	byte ptr word_1F3B0, 3
		jnz	short loc_F683
		mov	al, byte_1FE50
		mov	angle_23E43, al
		mov	byte_23E45, 22h ; '"'
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		mov	al, byte_1F39F
		mov	byte_23E42, al
		mov	byte_23E4E, 2
		mov	al, 1
		sub	al, _pid_current
		mov	_pid_other, al
		call	sub_17730
		mov	al, byte_1F39F
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	byte_23E42, al
		call	sub_17730
		mov	al, byte_1FE50
		add	al, 7
		mov	byte_1FE50, al
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_F673:
		mov	byte_1F353, 0
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

loc_F683:
		pop	bp
		retn
sub_F5FE	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_F685	proc near

@@pid_other		= byte ptr -1

		enter	2, 0
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	byte_1F353, 1
		cmp	word_1F3B0, 38h	; '8'
		jb	locret_F72B
		cmp	word_1F3B0, 40h
		jnz	short loc_F6BA
		push	801700h
		push	word ptr [bp+@@pid_other]
		call	sub_19B06
		push	1180h
		jmp	short loc_F706
; ---------------------------------------------------------------------------

loc_F6BA:
		cmp	word_1F3B0, 50h	; 'P'
		jnz	short loc_F6D4
		push	3801700h
		push	word ptr [bp+@@pid_other]
		call	sub_19B06
		push	0E80h
		jmp	short loc_F706
; ---------------------------------------------------------------------------

loc_F6D4:
		cmp	word_1F3B0, 60h
		jnz	short loc_F6EE
		push	6801700h
		push	word ptr [bp+@@pid_other]
		call	sub_19B06
		push	0B80h
		jmp	short loc_F706
; ---------------------------------------------------------------------------

loc_F6EE:
		cmp	word_1F3B0, 70h	; 'p'
		jnz	short loc_F713
		push	9801700h
		push	word ptr [bp+@@pid_other]
		call	sub_19B06
		push	880h

loc_F706:
		push	1700h
		push	word ptr [bp+@@pid_other]
		call	sub_19B06
		leave
		retn
; ---------------------------------------------------------------------------

loc_F713:
		cmp	word_1F3B0, 84h
		jnz	short locret_F72B
		mov	byte_1F353, 0
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

locret_F72B:
		leave
		retn
sub_F685	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_F72D	proc near
		push	bp
		mov	bp, sp
		call	sub_F356
		test	byte ptr word_1F3B0, 1Fh
		jnz	short loc_F7A8
		call	randring_far_next16
		mov	angle_23E43, al
		mov	byte_23E45, 26h ; '&'
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		mov	al, 1
		sub	al, _pid_current
		mov	_pid_other, al
		cmp	byte_1F39E, 8
		jnb	short loc_F768
		mov	al, byte_1F3A0
		jmp	short loc_F795
; ---------------------------------------------------------------------------

loc_F768:
		mov	al, byte_1F3A2
		mov	byte_23E42, al
		mov	al, byte_1F3A3
		mov	byte_23E47, al
		mov	byte_23E4E, 2
		call	sub_17730
		mov	al, byte_1F3A3
		mov	ah, 0
		push	ax
		mov	ax, 256
		cwd
		pop	bx
		idiv	bx
		add	al, angle_23E43
		mov	angle_23E43, al
		mov	al, byte_1F3A4

loc_F795:
		mov	byte_23E47, al
		mov	al, byte_1F3A1
		mov	byte_23E42, al
		mov	byte_23E4E, 4
		call	sub_17730

loc_F7A8:
		cmp	word_1F3B0, 82h
		jb	short loc_F7BB
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

loc_F7BB:
		pop	bp
		retn
sub_F72D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_F7BD	proc near

@@pid_other		= byte ptr -1

		enter	2, 0
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	byte_1F353, 1
		cmp	word_1F3B0, 38h	; '8'
		jb	short locret_F846
		cmp	word_1F3B0, 40h
		jnz	short loc_F7F0
		push	2001700h
		push	word ptr [bp+@@pid_other]
		call	sub_19B06
		push	1000h
		jmp	short loc_F822
; ---------------------------------------------------------------------------

loc_F7F0:
		cmp	word_1F3B0, 50h	; 'P'
		jnz	short loc_F80A
		push	5001700h
		push	word ptr [bp+@@pid_other]
		call	sub_19B06
		push	0D00h
		jmp	short loc_F822
; ---------------------------------------------------------------------------

loc_F80A:
		cmp	word_1F3B0, 60h
		jnz	short loc_F82F
		push	8001700h
		push	word ptr [bp+@@pid_other]
		call	sub_19B06
		push	0A00h

loc_F822:
		push	1700h
		push	word ptr [bp+@@pid_other]
		call	sub_19B06
		leave
		retn
; ---------------------------------------------------------------------------

loc_F82F:
		cmp	word_1F3B0, 70h	; 'p'
		jnz	short locret_F846
		mov	byte_1F353, 0
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

locret_F846:
		leave
		retn
sub_F7BD	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

marisa_F848	proc far

var_4		= word ptr -4
@@pid_other		= byte ptr -1

		enter	4, 0
		call	sub_F402
		or	al, al
		jz	short loc_F887
		mov	al, byte_1F39E
		add	al, al
		add	al, 32h	; '2'
		mov	byte_1F39F, al
		mov	al, byte_1F39E
		add	al, al
		add	al, 18h
		mov	byte_1F3A0, al
		mov	al, byte_1F39E
		add	al, 20h	; ' '
		mov	byte_1F3A1, al
		mov	al, byte_1F39E
		add	al, 0Ah
		mov	byte_1F3A2, al
		mov	al, byte_1F39E
		add	al, 16h
		mov	byte_1F3A3, al
		mov	al, byte_1F39E
		add	al, 16h
		mov	byte_1F3A4, al

loc_F887:
		mov	al, _pid_current
		cmp	al, byte_1DB9E
		jnz	locret_F953	; jumptable 0000F8BF case 255
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		call	sub_F512
		inc	word_1F3B0
		mov	al, byte_1F34F
		mov	ah, 0
		mov	[bp+var_4], ax
		mov	cx, 14h		; switch 20 cases
		mov	bx, offset word_F956

loc_F8B0:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_4]
		jz	short loc_F8BF
		add	bx, 2
		loop	loc_F8B0
		jmp	short loc_F8F5	; default
; ---------------------------------------------------------------------------

loc_F8BF:
		jmp	word ptr cs:[bx+28h] ; switch jump

loc_F8C3:
		cmp	word_1F3B0, 64h	; 'd' ; jumptable 0000F8BF case 0
		jnz	locret_F953	; jumptable 0000F8BF case 255
		mov	word_1F3B0, 0
		mov	byte_1F34F, 1
		jmp	short loc_F8F5	; default
; ---------------------------------------------------------------------------

loc_F8D9:
		call	sub_F52D	; jumptable 0000F8BF case 1
		jmp	short loc_F8F5	; default
; ---------------------------------------------------------------------------

loc_F8DE:
		call	sub_F5FE	; jumptable 0000F8BF cases 2-5
		jmp	short loc_F8F5	; default
; ---------------------------------------------------------------------------

loc_F8E3:
		call	sub_F685	; jumptable 0000F8BF cases 8-10
		jmp	short loc_F8F5	; default
; ---------------------------------------------------------------------------

loc_F8E8:
		call	sub_F72D	; jumptable 0000F8BF cases 11-16
		jmp	short loc_F8F5	; default
; ---------------------------------------------------------------------------

loc_F8ED:
		call	sub_F7BD	; jumptable 0000F8BF cases 6,7,17
		jmp	short loc_F8F5	; default
; ---------------------------------------------------------------------------

loc_F8F2:
		call	sub_F3A9	; jumptable 0000F8BF case 128

loc_F8F5:
		mov	ax, word_1F33E	; default
		mov	word_220EE, ax
		mov	ax, word_1F340
		mov	word_220F0, ax
		mov	word_220F2, 1Ch
		mov	word_220F4, 1Ch
		mov	al, [bp+@@pid_other]
		mov	byte_220FA, al
		call	sub_13A6E
		mov	byte_20E2C, 1
		mov	word_20E32, 200h
		mov	word_20E34, 200h
		mov	al, [bp+@@pid_other]
		mov	pid_20E3A, al
		mov	ax, word_1F33E
		mov	word_20E2E, ax
		mov	ax, word_1F340
		mov	word_20E30, ax
		call	sub_158F5
		mov	byte_1F34E, al
		mov	ah, 0
		sub	word_1F34A, ax
		mov	byte_20E2C, 0
		nopcall	sub_F4B4

locret_F953:
		leave			; jumptable 0000F8BF case 255
		retf
marisa_F848	endp

; ---------------------------------------------------------------------------
		db 0
word_F956	dw	0,     1,     2,     3
		dw	4,     5,     6,     7 ; value table for switch	statement
		dw	8,     9,   0Ah,   0Bh
		dw    0Ch,   0Dh,   0Eh,   0Fh
		dw    10h,   11h,   80h,  0FFh
		dw offset loc_F8C3	; jump table for switch	statement
		dw offset loc_F8D9
		dw offset loc_F8DE
		dw offset loc_F8DE
		dw offset loc_F8DE
		dw offset loc_F8DE
		dw offset loc_F8ED
		dw offset loc_F8ED
		dw offset loc_F8E3
		dw offset loc_F8E3
		dw offset loc_F8E3
		dw offset loc_F8E8
		dw offset loc_F8E8
		dw offset loc_F8E8
		dw offset loc_F8E8
		dw offset loc_F8E8
		dw offset loc_F8E8
		dw offset loc_F8ED
		dw offset loc_F8F2
		dw offset locret_F953

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_F9A6	proc near

@@pid_other		= byte ptr -3
var_2		= word ptr -2

		enter	4, 0
		push	si
		push	di
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	_sprite16_put_w, (176 / 16)
		mov	_sprite16_put_h, 48
		push	word_1F33E
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -88
		mov	si, ax
		mov	ax, word_1F340
		sar	ax, 4
		add	ax, -32
		mov	di, ax
		call	sprite16_put pascal, si, ax, sprite_1F34C
		cmp	byte_1F34E, 0
		jz	short loc_FA0A
		mov	_sprite16_put_w, (48 / 16)
		mov	_sprite16_put_h, 40
		add	si, 40h
		add	di, 10h
		push	si
		push	di
		mov	ax, sprite_1F34C
		add	ax, 16h
		push	ax
		jmp	short loc_FA68
; ---------------------------------------------------------------------------

loc_FA0A:
		cmp	byte_1F353, 1
		jnz	short loc_FA6D
		mov	ax, word_23AF6
		and	ax, 3
		cmp	ax, 2
		jnb	short loc_FA49
		mov	_sprite16_put_w, (48 / 16)
		mov	_sprite16_put_h, 40
		add	si, 64
		add	di, 16
		push	si
		push	di
		mov	ax, sprite_1F34C
		add	ax, 1Ch
		push	ax
		call	sprite16_put
		sub	si, 32
		add	di, 32
		mov	ax, sprite_1F34C
		add	ax, 0F00h
		jmp	short loc_FA55
; ---------------------------------------------------------------------------

loc_FA49:
		add	si, 20h	; ' '
		add	di, 30h	; '0'
		mov	ax, sprite_1F34C
		add	ax, 1180h

loc_FA55:
		mov	[bp+var_2], ax
		mov	_sprite16_put_w, (112 / 16)
		mov	_sprite16_put_h, 8
		push	si
		push	di
		push	[bp+var_2]

loc_FA68:
		call	sprite16_put

loc_FA6D:
		pop	di
		pop	si
		leave
		retn
sub_F9A6	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_FA71	proc near

@@pid_other		= byte ptr -3
@@top		= word ptr -2
arg_0		= word ptr  4

		enter	4, 0
		push	si
		push	di
		mov	si, [bp+arg_0]
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	_sprite16_put_w, (176 / 16)
		mov	_sprite16_put_h, 48
		push	word_1F33E
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -88
		mov	di, ax
		mov	ax, word_1F340
		sar	ax, 4
		add	ax, -32
		mov	[bp+@@top], ax
		mov	ah, SPRITE16_SET_MASK
		mov	dx, 0AAAAh
		int	SPRITE16
		mov	ax, di
		sub	ax, si
		call	sprite16_put pascal, ax, [bp+@@top], sprite_1F34C
		mov	ah, SPRITE16_SET_MASK
		mov	dx, 5555h
		int	SPRITE16
		mov	ax, di
		add	ax, si
		call	sprite16_put pascal, ax, [bp+@@top], sprite_1F34C
		mov	ah, SPRITE16_SET_MASK
		mov	dx, 0FFFFh
		int	SPRITE16
		pop	di
		pop	si
		leave
		retn	2
sub_FA71	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

marisa_FAE8	proc far

@@pid_other		= byte ptr -1

		enter	2, 0
		mov	al, _pid_current
		cmp	al, byte_1DB9E
		jnz	short locret_FB44
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		cmp	[bp+@@pid_other], 0
		jnz	short loc_FB12
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_FB1E
; ---------------------------------------------------------------------------

loc_FB12:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_FB1E:
		cmp	byte_1F34F, 0
		jnz	short loc_FB35
		mov	ax, word_1F3B0
		add	ax, ax
		mov	dx, 0C8h
		sub	dx, ax
		push	dx
		call	sub_FA71
		leave
		retf
; ---------------------------------------------------------------------------

loc_FB35:
		cmp	byte_1F34F, -1
		jz	short loc_FB41
		call	sub_F9A6
		leave
		retf
; ---------------------------------------------------------------------------

loc_FB41:
		call	sub_F58C

locret_FB44:
		leave
		retf
marisa_FAE8	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

mima_FB46	proc far

arg_0		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		mov	dx, [bp+arg_0]
		mov	ax, dx
		shl	ax, 5
		add	ax, 1DFEh
		mov	si, ax
		mov	word ptr [si], 900h
		mov	word ptr [si+2], 500h
		mov	word ptr [si+8], 0FFE0h
		mov	word ptr [si+0Ah], 0
		mov	byte ptr [si+12h], 0
		mov	byte ptr [si+10h], 0
		mov	byte ptr [si+11h], 0
		mov	word ptr [si+0Ch], 6Eh ; 'n'
		mov	byte ptr [si+13h], 0
		mov	word ptr [si+0Eh], 28Ch
		or	dx, dx
		jz	short loc_FB8C
		add	word ptr [si+0Eh], 28h ; '('

loc_FB8C:
		mov	byte ptr [si+15h], 0
		pop	si
		pop	bp
		retf	2
mima_FB46	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_FB95	proc near
		push	bp
		mov	bp, sp
		cmp	word_1F3B0, 2
		jnb	short loc_FBB5
		mov	byte_1F353, 2
		mov	byte_1F354, 0
		mov	byte_20E28, 0
		mov	byte_20E29, 0C0h
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_FBB5:
		cmp	word_1F3B0, 20h	; ' '
		jb	loc_FC69
		test	byte ptr word_1F3B0, 1
		jnz	loc_FC51
		call	snd_se_play pascal, 3
		mov	al, byte_20E28
		mov	angle_23E43, al
		mov	byte_23E45, 22h ; '"'
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		mov	al, byte_1F39F
		mov	byte_23E42, al
		mov	byte_23E4E, 2
		mov	byte_23E50, 0
		call	sub_17730
		mov	byte_23E50, 1
		mov	al, byte_20E28
		add	al, 9
		mov	byte_20E28, al
		mov	al, byte_1F3A4
		mov	ah, 0
		cmp	ax, word_1F3B0
		jbe	short loc_FC49
		mov	ax, word_1F3B0
		mov	bx, 6
		xor	dx, dx
		div	bx
		or	dx, dx
		jnz	short loc_FC49
		mov	byte_23E4E, 1
		mov	byte_23E45, 0Fh
		mov	al, byte_1F3A3
		mov	byte_23E42, al
		mov	al, byte_20E29
		mov	angle_23E43, al
		call	sub_17730
		mov	al, 80h
		sub	al, byte_20E29
		mov	angle_23E43, al
		call	sub_17730

loc_FC49:
		mov	al, byte_20E29
		add	al, 3
		mov	byte_20E29, al

loc_FC51:
		cmp	word_1F3B0, 82h
		jbe	short loc_FC69
		mov	byte_1F353, 0
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

loc_FC69:
		pop	bp
		retn
sub_FB95	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_FC6B	proc near

@@pid_other		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		cmp	word_1F3B0, 10h
		jnz	short loc_FC88
		mov	byte_1F353, 5
		jmp	short loc_FC91
; ---------------------------------------------------------------------------

loc_FC88:
		cmp	word_1F3B0, 20h	; ' '
		jb	loc_FD6D

loc_FC91:
		mov	ax, word_1F33E
		add	ax, 180h
		mov	si, ax
		mov	ax, word_1F340
		add	ax, 0FE00h
		mov	di, ax
		cmp	word_1F3B0, 20h	; ' '
		jz	short loc_FCB6
		cmp	word_1F3B0, 24h	; '$'
		jz	short loc_FCB6
		cmp	word_1F3B0, 28h	; '('
		jnz	short loc_FCC6

loc_FCB6:
		push	si
		push	di
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		jmp	loc_FD6D
; ---------------------------------------------------------------------------

loc_FCC6:
		cmp	word_1F3B0, 30h	; '0'
		jbe	loc_FD6D
		test	byte ptr word_1F3B0, 3
		jnz	short loc_FD12
		mov	angle_23E43, 0
		mov	byte_23E45, 1Ch
		mov	word_23E3E, si
		mov	word_23E40, di
		mov	al, byte_1F3A0
		mov	byte_23E47, al
		mov	al, byte_1F3A1
		mov	byte_23E42, al
		mov	byte_23E4E, 2
		mov	byte_23E50, 0
		call	sub_17730
		mov	byte_23E4E, 1
		call	sub_17730
		mov	byte_23E50, 1

loc_FD12:
		cmp	word_1F3B0, 40h
		jnz	short loc_FD47
		call	randring_far_next16
		mov	angle_23E43, al
		mov	byte_23E45, 25h ; '%'
		mov	word_23E3E, si
		mov	word_23E40, di
		mov	byte_23E42, 20h ; ' '
		mov	byte_23E4E, 2
		mov	byte_23E50, 0
		call	sub_17730
		mov	byte_23E50, 1

loc_FD47:
		test	byte ptr word_1F3B0, 1
		jnz	short loc_FD55
		call	snd_se_play pascal, 3

loc_FD55:
		cmp	word_1F3B0, 80h
		jb	short loc_FD6D
		mov	byte_1F353, 0
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

loc_FD6D:
		pop	di
		pop	si
		leave
		retn
sub_FC6B	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_FD71	proc near

var_1		= byte ptr -1

		enter	2, 0
		mov	al, byte_1F3A2
		mov	ah, 0
		push	ax
		mov	ax, word_1F3B0
		xor	dx, dx
		pop	bx
		div	bx
		mov	[bp+var_1], dl
		call	sub_F356
		mov	byte_1F353, 5
		cmp	[bp+var_1], 1
		jz	short loc_FDAC
		mov	al, [bp+var_1]
		mov	ah, 0
		mov	dl, byte_1F3A2
		mov	dh, 0
		push	ax
		mov	ax, dx
		cwd
		sub	ax, dx
		sar	ax, 1
		pop	dx
		cmp	dx, ax
		jnz	short loc_FE11

loc_FDAC:
		mov	al, [bp+var_1]
		mov	ah, 0
		mov	dl, byte_1F3A2
		mov	dh, 0
		push	ax
		mov	ax, dx
		cwd
		sub	ax, dx
		sar	ax, 1
		pop	dx
		cmp	dx, ax
		jnz	short loc_FDCB
		mov	byte_23E45, 12h
		jmp	short loc_FDD0
; ---------------------------------------------------------------------------

loc_FDCB:
		mov	byte_23E45, 18h

loc_FDD0:
		call	snd_se_play pascal, 10
		mov	angle_23E43, 0
		mov	ax, word_1F33E
		add	ax, 180h
		mov	word_23E3E, ax
		mov	ax, word_1F340
		add	ax, 0FE00h
		mov	word_23E40, ax
		mov	byte_23E42, 58h ; 'X'
		mov	byte_23E4E, 2
		mov	byte_23E50, 0
		mov	byte_23E51, 1
		call	sub_17730
		mov	byte_23E51, 0
		mov	byte_23E50, 1

loc_FE11:
		cmp	word_1F3B0, 96h
		jb	short locret_FE29
		mov	byte_1F353, 0
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

locret_FE29:
		leave
		retn
sub_FD71	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_FE2B	proc near
		push	bp
		mov	bp, sp
		call	sub_F356
		cmp	word_1F3B0, 1
		jnz	short loc_FE54
		push	1
		call	randring_far_next16_and
		or	ax, ax
		jz	short loc_FE47
		mov	al, 7
		jmp	short loc_FE49
; ---------------------------------------------------------------------------

loc_FE47:
		mov	al, 0F9h

loc_FE49:
		mov	byte_20E2A, al
		call	randring_far_next16
		mov	angle_20E2B, al

loc_FE54:
		test	byte ptr word_1F3B0, 1
		jnz	short loc_FEC4
		mov	al, angle_20E2B
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F33E, (48 shl 4), _CosTable8[bx]
		mov	word_23E3E, ax
		mov	al, angle_20E2B
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F340, (48 shl 4), _SinTable8[bx]
		mov	word_23E40, ax
		mov	al, angle_20E2B
		add	al, 40h
		mov	angle_23E43, al
		mov	byte_23E4E, 4
		mov	byte_23E45, 21h ; '!'
		mov	al, byte_1F3A5
		mov	byte_23E42, al
		call	sub_17730
		call	snd_se_play pascal, 10
		mov	al, byte_20E2A
		add	angle_20E2B, al

loc_FEC4:
		cmp	word_1F3B0, 48h	; 'H'
		jb	short loc_FED6
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

loc_FED6:
		pop	bp
		retn
sub_FE2B	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

mima_FED8	proc far

var_4		= word ptr -4
@@pid_other		= byte ptr -1

		enter	4, 0
		call	sub_F402
		or	al, al
		jz	short loc_FF2B
		mov	al, byte_1F39E
		add	al, 20h	; ' '
		mov	byte_1F39F, al
		mov	al, byte_1F39E
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		add	al, 2
		mov	byte_1F3A0, al
		mov	al, byte_1F39E
		add	al, 20h	; ' '
		mov	byte_1F3A1, al
		mov	al, byte_1F39E
		add	al, al
		mov	dl, 40h
		sub	dl, al
		mov	byte_1F3A2, dl
		mov	al, byte_1F39E
		add	al, 28h	; '('
		mov	byte_1F3A3, al
		mov	al, byte_1F39E
		shl	al, 2
		add	al, 40h
		mov	byte_1F3A4, al
		mov	al, byte_1F39E
		add	al, 36h	; '6'
		mov	byte_1F3A5, al

loc_FF2B:
		mov	al, _pid_current
		cmp	al, byte_1DB9E
		jnz	locret_10000	; jumptable 0000FF6C case 255
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		call	sub_F512
		mov	al, 1
		sub	al, _pid_current
		mov	_pid_other, al
		inc	word_1F3B0
		mov	al, byte_1F34F
		mov	ah, 0
		mov	[bp+var_4], ax
		mov	cx, 14h		; switch 20 cases
		mov	bx, offset word_10003

loc_FF5D:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_4]
		jz	short loc_FF6C
		add	bx, 2
		loop	loc_FF5D
		jmp	short loc_FFA2	; default
; ---------------------------------------------------------------------------

loc_FF6C:
		jmp	word ptr cs:[bx+28h] ; switch jump

loc_FF70:
		cmp	word_1F3B0, 64h	; 'd' ; jumptable 0000FF6C case 0
		jnz	locret_10000	; jumptable 0000FF6C case 255
		mov	word_1F3B0, 0
		mov	byte_1F34F, 1
		jmp	short loc_FFA2	; default
; ---------------------------------------------------------------------------

loc_FF86:
		call	sub_F52D	; jumptable 0000FF6C case 1
		jmp	short loc_FFA2	; default
; ---------------------------------------------------------------------------

loc_FF8B:
		call	sub_FB95	; jumptable 0000FF6C cases 2-5
		jmp	short loc_FFA2	; default
; ---------------------------------------------------------------------------

loc_FF90:
		call	sub_FC6B	; jumptable 0000FF6C cases 6-10
		jmp	short loc_FFA2	; default
; ---------------------------------------------------------------------------

loc_FF95:
		call	sub_FD71	; jumptable 0000FF6C cases 11-13
		jmp	short loc_FFA2	; default
; ---------------------------------------------------------------------------

loc_FF9A:
		call	sub_FE2B	; jumptable 0000FF6C cases 14-17
		jmp	short loc_FFA2	; default
; ---------------------------------------------------------------------------

loc_FF9F:
		call	sub_F3A9	; jumptable 0000FF6C case 128

loc_FFA2:
		mov	ax, word_1F33E	; default
		mov	word_220EE, ax
		mov	ax, word_1F340
		mov	word_220F0, ax
		mov	word_220F2, 1Ch
		mov	word_220F4, 1Ch
		mov	al, [bp+@@pid_other]
		mov	byte_220FA, al
		call	sub_13A6E
		mov	byte_20E2C, 1
		mov	word_20E32, 200h
		mov	word_20E34, 200h
		mov	al, [bp+@@pid_other]
		mov	pid_20E3A, al
		mov	ax, word_1F33E
		mov	word_20E2E, ax
		mov	ax, word_1F340
		mov	word_20E30, ax
		call	sub_158F5
		mov	byte_1F34E, al
		mov	ah, 0
		sub	word_1F34A, ax
		mov	byte_20E2C, 0
		nopcall	sub_F4B4

locret_10000:
		leave			; jumptable 0000FF6C case 255
		retf
mima_FED8	endp

; ---------------------------------------------------------------------------
		db 0
word_10003	dw	0,     1,     2,     3
		dw	4,     5,     6,     7 ; value table for switch	statement
		dw	8,     9,   0Ah,   0Bh
		dw    0Ch,   0Dh,   0Eh,   0Fh
		dw    10h,   11h,   80h,  0FFh
		dw offset loc_FF70	; jump table for switch	statement
		dw offset loc_FF86
		dw offset loc_FF8B
		dw offset loc_FF8B
		dw offset loc_FF8B
		dw offset loc_FF8B
		dw offset loc_FF90
		dw offset loc_FF90
		dw offset loc_FF90
		dw offset loc_FF90
		dw offset loc_FF90
		dw offset loc_FF95
		dw offset loc_FF95
		dw offset loc_FF95
		dw offset loc_FF9A
		dw offset loc_FF9A
		dw offset loc_FF9A
		dw offset loc_FF9A
		dw offset loc_FF9F
		dw offset locret_10000

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10053	proc near

@@pid_other		= byte ptr -3
@@sprite_offset		= word ptr -2

		enter	4, 0
		push	si
		push	di
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	_sprite16_put_w, (144 / 16)
		mov	_sprite16_put_h, 56
		push	word_1F33E
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -72
		mov	si, ax
		mov	ax, word_1F340
		sar	ax, 4
		add	ax, -40
		mov	di, ax
		call	sprite16_put pascal, si, ax, sprite_1F34C
		cmp	byte_1F34E, 0
		jz	short loc_100B8
		mov	_sprite16_put_w, (64 / 16)
		mov	_sprite16_put_h, 40
		add	si, 32
		add	di, 16
		push	si
		push	di
		mov	ax, sprite_1F34C
		add	ax, 12h

loc_100B4:
		push	ax
		jmp	loc_1016A
; ---------------------------------------------------------------------------

loc_100B8:
		cmp	byte_1F353, 2
		jnz	short loc_10121

loc_100BF:
		mov	_sprite16_put_w, (16 / 16)
		mov	_sprite16_put_h, 8
		mov	ax, sprite_1F34C
		add	ax, 1Ah
		mov	[bp+@@sprite_offset], ax
		lea	ax, [si+48]
		push	ax
		lea	ax, [di+32]
		push	ax
		push	[bp+@@sprite_offset]
		call	sprite16_put
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 16
		add	si, 80
		mov	ax, sprite_1F34C
		add	ax, 0EF4h
		mov	[bp+@@sprite_offset], ax
		cmp	byte_1F354, 10h
		jb	short loc_10111
		add	[bp+@@sprite_offset], 4
		cmp	byte_1F354, 20h	; ' '
		jb	short loc_10111
		mov	byte_1F353, 3

loc_10111:
		call	sprite16_put pascal, si, di, [bp+@@sprite_offset]
		inc	byte_1F354
		jmp	short loc_10180
; ---------------------------------------------------------------------------

loc_10121:
		cmp	byte_1F353, 3
		jnz	short loc_10144
		mov	_sprite16_put_w, (80 / 16)
		mov	_sprite16_put_h, 24
		lea	ax, [si+20h]
		push	ax
		lea	ax, [di+10h]
		push	ax
		mov	ax, sprite_1F34C
		add	ax, 0C92h
		jmp	loc_100B4
; ---------------------------------------------------------------------------

loc_10144:
		cmp	byte_1F353, 4
		jnz	short loc_10171
		mov	_sprite16_put_w, (16 / 16)
		mov	_sprite16_put_h, 8
		mov	ax, sprite_1F34C
		add	ax, 1Ah
		mov	[bp+@@sprite_offset], ax
		lea	ax, [si+48]
		push	ax
		lea	ax, [di+32]
		push	ax
		push	[bp+@@sprite_offset]

loc_1016A:
		call	sprite16_put
		jmp	short loc_10180
; ---------------------------------------------------------------------------

loc_10171:
		cmp	byte_1F353, 5
		jnz	short loc_10180
		mov	byte_1F354, 0
		jmp	loc_100BF
; ---------------------------------------------------------------------------

loc_10180:
		pop	di
		pop	si
		leave
		retn
sub_10053	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10184	proc near

@@pid_other		= byte ptr -7
@@top		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2
@@angle		= byte ptr  4
arg_2		= word ptr  6

		enter	8, 0
		push	si
		push	di
		mov	si, [bp+arg_2]
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	_sprite16_put_w, (144 / 16)
		mov	_sprite16_put_h, 56
		push	word_1F33E
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -72
		mov	[bp+var_2], ax
		mov	ax, word_1F340
		sar	ax, 4
		add	ax, 0FFD8h
		mov	[bp+var_4], ax
		mov	ah, SPRITE16_SET_MASK
		mov	dx, 0AAAAh
		int	SPRITE16
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, [bp+var_2], si, _CosTable8[bx]
		mov	di, ax
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, [bp+var_4], si, _SinTable8[bx]
		mov	[bp+@@top], ax
		call	sprite16_put pascal, di, ax, sprite_1F34C
		mov	ah, SPRITE16_SET_MASK
		mov	dx, 5555h
		int	SPRITE16
		mov	al, [bp+@@angle]
		add	al, 80h
		mov	[bp+@@angle], al
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, [bp+var_2], si, _CosTable8[bx]
		mov	di, ax
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, [bp+var_4], si, _SinTable8[bx]
		mov	[bp+@@top], ax
		call	sprite16_put pascal, di, ax, sprite_1F34C
		mov	ah, SPRITE16_SET_MASK
		mov	dx, 0FFFFh
		int	SPRITE16
		pop	di
		pop	si
		leave
		retn	4
sub_10184	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

mima_10263	proc far

@@pid_other		= byte ptr -1

		enter	2, 0
		mov	al, _pid_current
		cmp	al, byte_1DB9E
		jnz	short locret_102C6
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		cmp	[bp+@@pid_other], 0
		jnz	short loc_1028D
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_10299
; ---------------------------------------------------------------------------

loc_1028D:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_10299:
		cmp	byte_1F34F, 0
		jnz	short loc_102B7
		mov	ax, word_1F3B0
		add	ax, ax
		mov	dx, 0C8h
		sub	dx, ax
		push	dx
		mov	ax, word_1F3B0
		imul	ax, 3
		push	ax
		call	sub_10184
		leave
		retf
; ---------------------------------------------------------------------------

loc_102B7:
		cmp	byte_1F34F, -1
		jz	short loc_102C3
		call	sub_10053
		leave
		retf
; ---------------------------------------------------------------------------

loc_102C3:
		call	sub_F58C

locret_102C6:
		leave
		retf
mima_10263	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

yumemi_102C8	proc far

arg_0		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		mov	dx, [bp+arg_0]
		mov	ax, dx
		shl	ax, 5
		add	ax, 1DFEh
		mov	si, ax
		mov	word ptr [si], 900h
		mov	word ptr [si+2], 500h
		mov	word ptr [si+8], 0FFE0h
		mov	word ptr [si+0Ah], 0
		mov	byte ptr [si+12h], 0
		mov	byte ptr [si+10h], 0
		mov	byte ptr [si+11h], 0
		mov	word ptr [si+0Ch], 82h
		mov	byte ptr [si+13h], 0
		mov	byte ptr [si+16h], 0
		mov	byte ptr [si+17h], 0
		mov	word ptr [si+18h], 0
		mov	word ptr [si+0Eh], 288h
		or	dx, dx
		jz	short loc_1031B
		add	word ptr [si+0Eh], 28h ; '('

loc_1031B:
		mov	byte ptr [si+15h], 0
		pop	si
		pop	bp
		retf	2
yumemi_102C8	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10324	proc near
		push	bp
		mov	bp, sp
		cmp	word_1F3B0, 1
		jnz	short loc_1035A
		mov	byte_1F353, 1
		call	randring_far_next16
		mov	byte_20E4E, al
		mov	byte_20E4C, 0
		mov	word_1F356, 100h
		push	1
		call	randring_far_next16_and
		or	ax, ax
		jnz	short loc_10355
		mov	al, 3
		jmp	short loc_10357
; ---------------------------------------------------------------------------

loc_10355:
		mov	al, 0FDh

loc_10357:
		mov	byte_20E4D, al

loc_1035A:
		cmp	word_1F3B0, 4
		jnb	short loc_10376
		push	word_20E50
		push	word_20E52
		mov	al, _pid_other
		mov	ah, 0
		push	ax
		call	sub_CE5B
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_10376:
		cmp	word_1F3B0, 20h	; ' '
		jb	loc_10403
		cmp	word_1F3B0, 20h	; ' '
		jnz	short loc_103A5
		push	word_20E50
		push	word_20E52
		mov	al, _pid_other
		mov	ah, 0
		push	ax
		call	sub_CDBD
		mov	byte_1F353, 2
		call	snd_se_play pascal, 5

loc_103A5:
		test	byte ptr word_1F3B0, 3
		jnz	short loc_103EC
		mov	byte_23E4E, 2
		mov	al, byte_20E4E
		mov	angle_23E43, al
		mov	byte_23E45, 26h ; '&'
		mov	ax, word_20E50
		mov	word_23E3E, ax
		mov	ax, word_20E52
		mov	word_23E40, ax
		mov	al, byte_1F39F
		add	al, byte_20E4C
		mov	byte_23E42, al
		mov	al, byte_1F3A0
		mov	byte_23E47, al
		call	sub_17730
		mov	al, byte_20E4D
		add	byte_20E4E, al
		mov	al, byte_20E4C
		add	al, 8
		mov	byte_20E4C, al

loc_103EC:
		cmp	word_1F3B0, 3Ch	; '<'
		jbe	short loc_10403
		mov	byte_1F353, 0
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

loc_10403:
		pop	bp
		retn
sub_10324	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10405	proc near
		push	bp
		mov	bp, sp
		cmp	word_1F3B0, 1
		jnz	short loc_10456
		mov	byte_1F353, 1
		mov	al, _pid_other
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	ax, _players[bx].center.x
		mov	point_1F342.x, ax
		mov	al, _pid_other
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	ax, _players[bx].center.y
		mov	point_1F342.y, ax
		sub	ax, word_20E52
		push	ax
		mov	ax, point_1F342.x
		sub	ax, word_20E50
		push	ax
		call	iatan2
		mov	byte_20E4E, al
		mov	word_1F356, 100h
		mov	byte_1F354, 20h	; ' '

loc_10456:
		cmp	word_1F3B0, 10h
		jnb	short loc_1047F
		mov	ax, word_1F3B0
		and	ax, 3
		cmp	ax, 1
		jnz	loc_1050D
		push	point_1F342.x
		push	point_1F342.y
		mov	al, _pid_other
		mov	ah, 0
		push	ax
		call	sub_CE5B
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_1047F:
		cmp	word_1F3B0, 20h	; ' '
		jb	loc_1050D
		cmp	word_1F3B0, 20h	; ' '
		jnz	short loc_104A7
		push	word_20E50
		push	word_20E52
		mov	al, _pid_other
		mov	ah, 0
		push	ax
		call	sub_CDBD
		mov	byte_1F353, 2

loc_104A7:
		test	byte ptr word_1F3B0, 1
		jnz	short loc_104F6
		call	snd_se_play pascal, 3
		mov	ax, word_20E50
		mov	word_23E3E, ax
		mov	ax, word_20E52
		mov	word_23E40, ax
		mov	al, byte_20E4E
		mov	angle_23E43, al
		push	1Fh
		call	randring_far_next16_and
		add	al, byte_1F3A1
		mov	byte_23E42, al
		push	1
		call	randring_far_next16_and
		inc	al
		mov	byte_23E4E, al
		push	5
		call	randring_far_next16_mod
		mov	bx, ax
		mov	al, [bx+792h]
		mov	byte_23E45, al
		call	sub_17730

loc_104F6:
		cmp	word_1F3B0, 60h
		jbe	short loc_1050D
		mov	byte_1F353, 0
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

loc_1050D:
		pop	bp
		retn
sub_10405	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1050F	proc near
		push	bp
		mov	bp, sp
		call	sub_F356
		mov	al, byte_1F3A2
		mov	ah, 0
		push	ax
		mov	ax, word_1F3B0
		xor	dx, dx
		pop	bx
		div	bx
		or	dx, dx
		jnz	short loc_105A1
		mov	byte_23E45, 20h ; ' '
		mov	byte_23E42, 20h ; ' '
		push	1
		call	randring_far_next16_and
		inc	al
		mov	byte_23E4E, al
		call	randring_far_next16
		mov	angle_23E43, al
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		add	ax, 0FE00h
		mov	word_23E40, ax
		call	sub_17730
		call	randring_far_next16
		mov	angle_23E43, al
		mov	ax, word_1F340
		add	ax, 200h
		mov	word_23E40, ax
		call	sub_17730
		call	randring_far_next16
		mov	angle_23E43, al
		mov	ax, word_1F33E
		add	ax, 0FE00h
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		call	sub_17730
		call	randring_far_next16
		mov	angle_23E43, al
		mov	ax, word_1F33E
		add	ax, 200h
		mov	word_23E3E, ax
		call	sub_17730

loc_105A1:
		cmp	word_1F3B0, 60h
		jb	short loc_105B3
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

loc_105B3:
		pop	bp
		retn
sub_1050F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_105B5	proc near
		push	bp
		mov	bp, sp
		cmp	byte_1F355, 0
		jnz	short loc_105E1
		cmp	word_1F33E, 380h
		jle	short loc_105D4
		cmp	word_1F33E, 0E80h
		jge	short loc_105D4
		call	sub_F356
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_105D4:
		mov	byte_1F355, 1
		mov	word_1F3B0, 0
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_105E1:
		mov	byte_1F354, 2
		mov	al, _pid_other
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	ax, _players[bx].center.x
		mov	point_1F342.x, ax
		mov	al, _pid_other
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	ax, _players[bx].center.y
		mov	point_1F342.y, ax
		cmp	word_1F3B0, 20h	; ' '
		jb	short loc_10667
		call	sub_F356
		call	sub_F356
		mov	ax, word_1F3B0
		and	ax, 0Fh
		cmp	ax, 0Fh
		jnz	short loc_10647
		mov	byte_1F353, 1
		push	point_1F342.x
		push	point_1F342.y
		mov	al, _pid_other
		mov	ah, 0
		push	ax
		call	sub_CE5B
		push	point_1F342.x
		push	point_1F342.y
		call	sub_1A95F
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_10647:
		mov	al, byte_1F3A3
		mov	ah, 0
		cmp	ax, word_1F3B0
		jnb	short loc_10667
		mov	byte_1F353, 0
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0
		mov	byte_1F355, 0

loc_10667:
		pop	bp
		retn
sub_105B5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10669	proc near
		push	bp
		mov	bp, sp
		push	si
		call	sub_F356
		mov	al, byte_1F3A4
		mov	ah, 0
		push	ax
		mov	ax, word_1F3B0
		xor	dx, dx
		pop	bx
		div	bx
		or	dx, dx
		jnz	short loc_106F5
		mov	byte_23E4E, 2
		cmp	word_1F3B0, 40h
		jnb	short loc_106B8
		mov	ax, word_20E50
		mov	word_23E3E, ax
		mov	ax, word_20E52
		mov	word_23E40, ax
		mov	angle_23E43, -40h
		mov	byte_23E42, 60h
		mov	byte_23E45, 16h
		call	sub_17730
		mov	byte_23E45, 10h
		call	sub_17730

loc_106B8:
		cmp	word_1F3B0, 20h	; ' '
		jb	short loc_106F5
		mov	byte_23E45, 0
		mov	byte_23E42, 24h ; '$'
		mov	word_23E40, 0
		xor	si, si
		jmp	short loc_106F0
; ---------------------------------------------------------------------------

loc_106D3:
		push	1200h
		call	randring_far_next16_mod
		mov	word_23E3E, ax
		push	3Fh ; '?'
		call	randring_far_next16_and
		add	al, 20h
		mov	angle_23E43, al
		call	sub_17730
		inc	si

loc_106F0:
		cmp	si, 0Ch
		jl	short loc_106D3

loc_106F5:
		cmp	word_1F3B0, 60h
		jb	short loc_10707
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

loc_10707:
		pop	si
		pop	bp
		retn
sub_10669	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

yumemi_1070A	proc far

var_4		= word ptr -4
@@pid_other		= byte ptr -1

		enter	4, 0
		call	sub_F402
		or	al, al
		jz	short loc_10761
		mov	al, byte_1F39E
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, 10h
		mov	byte_1F39F, al
		mov	al, byte_1F39E
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, 10h
		mov	byte_1F3A0, al
		mov	al, byte_1F39E
		add	al, 40h
		mov	byte_1F3A1, al
		mov	al, 12h
		sub	al, byte_1F39E
		mov	byte_1F3A2, al
		mov	al, byte_1F39E
		shl	al, 2
		add	al, 50h	; 'P'
		mov	byte_1F3A3, al
		mov	al, byte_1F39E
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	dl, 10h
		sub	dl, al
		mov	byte_1F3A4, dl

loc_10761:
		mov	al, _pid_current
		cmp	al, byte_1DB9E
		jnz	locret_10878	; jumptable 000107AE case 255
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	_pid_other, al
		call	sub_F512
		inc	word_1F3B0
		mov	ax, word_1F33E
		add	ax, 90h
		mov	word_20E50, ax
		mov	ax, word_1F340
		add	ax, 0FE80h
		mov	word_20E52, ax
		mov	al, byte_1F34F
		mov	ah, 0
		mov	[bp+var_4], ax
		mov	cx, 14h		; switch 20 cases
		mov	bx, offset word_1087A

loc_1079F:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_4]
		jz	short loc_107AE
		add	bx, 2
		loop	loc_1079F
		jmp	short loc_10803	; default
; ---------------------------------------------------------------------------

loc_107AE:
		jmp	word ptr cs:[bx+28h] ; switch jump

loc_107B2:
		cmp	word_1F3B0, 18h	; jumptable 000107AE case 0
		jz	short loc_107C0
		cmp	word_1F3B0, 48h	; 'H'
		jnz	short loc_107CC

loc_107C0:
		call	_snd_se_reset
		call	snd_se_play pascal, 5

loc_107CC:
		cmp	word_1F3B0, 60h
		jnz	locret_10878	; jumptable 000107AE case 255
		mov	word_1F3B0, 0
		mov	byte_1F34F, 1
		jmp	short loc_10803	; default
; ---------------------------------------------------------------------------

loc_107E2:
		call	sub_F52D	; jumptable 000107AE case 1
		jmp	short loc_10803	; default
; ---------------------------------------------------------------------------

loc_107E7:
		call	sub_10324	; jumptable 000107AE cases 2-4
		jmp	short loc_10803	; default
; ---------------------------------------------------------------------------

loc_107EC:
		call	sub_10405	; jumptable 000107AE cases 7-9
		jmp	short loc_10803	; default
; ---------------------------------------------------------------------------

loc_107F1:
		call	sub_1050F	; jumptable 000107AE cases 11-14
		jmp	short loc_10803	; default
; ---------------------------------------------------------------------------

loc_107F6:
		call	sub_105B5	; jumptable 000107AE cases 15-17
		jmp	short loc_10803	; default
; ---------------------------------------------------------------------------

loc_107FB:
		call	sub_10669	; jumptable 000107AE cases 5,6,10
		jmp	short loc_10803	; default
; ---------------------------------------------------------------------------

loc_10800:
		call	sub_F3A9	; jumptable 000107AE case 128

loc_10803:
		cmp	word_1F356, 0	; default
		jz	short loc_1080F
		sub	word_1F356, 8

loc_1080F:
		cmp	byte_1F354, 0
		jz	short loc_1081A
		dec	byte_1F354

loc_1081A:
		mov	ax, word_1F33E
		mov	word_220EE, ax
		mov	ax, word_1F340
		mov	word_220F0, ax
		mov	word_220F2, 1Ch
		mov	word_220F4, 1Ch
		mov	al, [bp+@@pid_other]
		mov	byte_220FA, al
		call	sub_13A6E
		mov	byte_20E2C, 1
		mov	word_20E32, 200h
		mov	word_20E34, 200h
		mov	al, [bp+@@pid_other]
		mov	pid_20E3A, al
		mov	ax, word_1F33E
		mov	word_20E2E, ax
		mov	ax, word_1F340
		mov	word_20E30, ax
		call	sub_158F5
		mov	byte_1F34E, al
		mov	ah, 0
		sub	word_1F34A, ax
		mov	byte_20E2C, 0
		nopcall	sub_F4B4

locret_10878:
		leave			; jumptable 000107AE case 255
		retf
yumemi_1070A	endp

; ---------------------------------------------------------------------------
word_1087A	dw	0,     1,     2,     3
		dw	4,     5,     6,     7 ; value table for switch	statement
		dw	8,     9,   0Ah,   0Bh
		dw    0Ch,   0Dh,   0Eh,   0Fh
		dw    10h,   11h,   80h,  0FFh
		dw offset loc_107B2	; jump table for switch	statement
		dw offset loc_107E2
		dw offset loc_107E7
		dw offset loc_107E7
		dw offset loc_107E7
		dw offset loc_107FB
		dw offset loc_107FB
		dw offset loc_107EC
		dw offset loc_107EC
		dw offset loc_107EC
		dw offset loc_107FB
		dw offset loc_107F1
		dw offset loc_107F1
		dw offset loc_107F1
		dw offset loc_107F1
		dw offset loc_107F6
		dw offset loc_107F6
		dw offset loc_107F6
		dw offset loc_10800
		dw offset locret_10878

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_108CA	proc near

@@pid_other		= byte ptr -7
var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2

		enter	8, 0
		push	si
		push	di
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	_sprite16_put_w, (112 / 16)
		mov	_sprite16_put_h, 56
		push	word_1F33E
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -56
		mov	si, ax
		mov	ax, word_1F340
		sar	ax, 4
		add	ax, -40
		mov	di, ax
		call	sprite16_put pascal, si, ax, sprite_1F34C
		cmp	byte_1F353, 0
		jz	short loc_1093C
		mov	_sprite16_put_w, (64 / 16)
		mov	_sprite16_put_h, 32
		mov	ax, sprite_1F34C
		add	ax, 0Eh
		mov	[bp+var_2], ax
		cmp	byte_1F353, 2
		jnz	short loc_10932
		add	[bp+var_2], 0A00h

loc_10932:
		lea	ax, [si+32]
		push	ax
		push	di
		push	[bp+var_2]
		jmp	short loc_1095A
; ---------------------------------------------------------------------------

loc_1093C:
		cmp	byte_1F34E, 0
		jz	short loc_1095F
		mov	_sprite16_put_w, (80 / 16)
		mov	_sprite16_put_h, 48
		add	si, 16
		push	si
		push	di
		mov	ax, sprite_1F34C
		add	ax, 16h
		push	ax

loc_1095A:
		call	sprite16_put

loc_1095F:
		cmp	word_1F356, 0
		jnz	short loc_1096F
		cmp	byte_1F354, 0
		jz	loc_10A13

loc_1096F:
		cmp	_pid_current, 0
		jz	short loc_10981
		push	100008h
		push	12Fh
		jmp	short loc_1098A
; ---------------------------------------------------------------------------

loc_10981:
		push	1500008h
		push	26Fh

loc_1098A:
		push	0BFh
		call	grc_setclip
		call	egc_off
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 10
		push	word_20E50
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	si, ax
		mov	ax, word_20E52
		sar	ax, 5
		add	ax, 8
		mov	di, ax
		cmp	byte_1F354, 0
		jnz	short loc_109D2
		call	grcg_circle pascal, si, ax, word_1F356
		jmp	short loc_109FB
; ---------------------------------------------------------------------------

loc_109D2:
		push	point_1F342.x
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	[bp+var_4], ax
		mov	ax, point_1F342.y
		sar	ax, 5
		add	ax, 8
		mov	[bp+var_6], ax
		call	grcg_line pascal, si, di, [bp+var_4], ax

loc_109FB:
		call	grcg_off
		call	egc_on
		call	grc_setclip pascal, large 0, ((RES_X - 1) shl 16) or (SPRITE16_RES_Y - 1)

loc_10A13:
		pop	di
		pop	si
		leave
		retn
sub_108CA	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10A17	proc near

var_4		= byte ptr -4
@@pid_other		= byte ptr -3
@@top		= word ptr -2

		enter	4, 0
		push	si
		push	di
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		xor	dx, dx
		mov	ah, SPRITE16_SET_OVERLAP
		int	SPRITE16
		mov	_sprite16_put_w, (112 / 16)
		mov	_sprite16_put_h, 56
		mov	ax, word_1F340
		sar	ax, 4
		add	ax, -40
		mov	[bp+@@top], ax
		cmp	word_1F3B0, 18h
		jnb	short loc_10A8D
		push	(-104 shl 4)
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	si, ax
		mov	ax, word_1F3B0
		shl	ax, 3
		shl	ax, 4
		sub	ax, (104 shl 4)
		push	ax
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	di, ax
		jmp	short loc_10A86
; ---------------------------------------------------------------------------

loc_10A76:
		call	sprite16_put pascal, si, [bp+@@top], sprite_1F34C
		add	si, 8

loc_10A86:
		cmp	si, di
		jle	short loc_10A76
		jmp	loc_10BA0
; ---------------------------------------------------------------------------

loc_10A8D:
		cmp	word_1F3B0, 30h	; '0'
		jnb	short loc_10ADE
		mov	al, byte ptr word_1F3B0
		sub	al, 18h
		mov	[bp+var_4], al
		mov	ah, 0
		shl	ax, 3
		shl	ax, 4
		add	ax, (-104 shl 4)
		push	ax
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	si, ax
		push	(88 shl 4)
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	di, ax
		jmp	short loc_10AD7
; ---------------------------------------------------------------------------

loc_10AC7:
		call	sprite16_put pascal, si, [bp+@@top], sprite_1F34C
		add	si, 8

loc_10AD7:
		cmp	si, di
		jle	short loc_10AC7
		jmp	loc_10BA0
; ---------------------------------------------------------------------------

loc_10ADE:
		cmp	word_1F3B0, 48h	; 'H'
		jnb	short loc_10B50
		mov	al, byte ptr word_1F3B0
		sub	al, 30h	; '0'
		mov	[bp+var_4], al
		push	(272 shl 4)
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	si, ax
		mov	al, [bp+var_4]
		mov	ah, 0
		shl	ax, 3
		shl	ax, 4
		mov	dx, (272 shl 4)
		sub	dx, ax
		push	dx
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	di, ax
		jmp	short loc_10B2D
; ---------------------------------------------------------------------------

loc_10B1D:
		call	sprite16_put pascal, si, [bp+@@top], sprite_1F34C
		sub	si, 8

loc_10B2D:
		cmp	si, di
		jge	short loc_10B1D
		push	(88 shl 4)
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	si, ax
		call	sprite16_put pascal, ax, [bp+@@top], sprite_1F34C
		jmp	short loc_10BA0
; ---------------------------------------------------------------------------

loc_10B50:
		cmp	word_1F3B0, 60h
		jnb	short loc_10BA0
		mov	al, byte ptr word_1F3B0
		sub	al, 48h	; 'H'
		mov	[bp+var_4], al
		mov	ah, 0
		shl	ax, 3
		shl	ax, 4
		mov	dx, 1100h
		sub	dx, ax
		push	dx
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	si, ax
		push	(88 shl 4)
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	di, ax
		jmp	short loc_10B9C
; ---------------------------------------------------------------------------

loc_10B8C:
		call	sprite16_put pascal, si, [bp+@@top], sprite_1F34C
		sub	si, 8

loc_10B9C:
		cmp	si, di
		jge	short loc_10B8C

loc_10BA0:
		mov	dx, OVERLAP_CLEAR
		mov	ah, SPRITE16_SET_OVERLAP
		int	SPRITE16
		pop	di
		pop	si
		leave
		retn
sub_10A17	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

yumemi_10BAB	proc far

@@pid_other		= byte ptr -1

		enter	2, 0
		mov	al, _pid_current
		cmp	al, byte_1DB9E
		jnz	short locret_10BFC
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		cmp	[bp+@@pid_other], 0
		jnz	short loc_10BD5
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_10BE1
; ---------------------------------------------------------------------------

loc_10BD5:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_10BE1:
		cmp	byte_1F34F, 0
		jnz	short loc_10BED
		call	sub_10A17
		leave
		retf
; ---------------------------------------------------------------------------

loc_10BED:
		cmp	byte_1F34F, -1
		jz	short loc_10BF9
		call	sub_108CA
		leave
		retf
; ---------------------------------------------------------------------------

loc_10BF9:
		call	sub_F58C

locret_10BFC:
		leave
		retf
yumemi_10BAB	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

reimu_10BFE	proc far

arg_0		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		mov	dx, [bp+arg_0]
		mov	ax, dx
		shl	ax, 5
		add	ax, 1DFEh
		mov	si, ax
		mov	word ptr [si], 900h
		mov	word ptr [si+2], 500h
		mov	word ptr [si+8], 0FFE0h
		mov	word ptr [si+0Ah], 0
		mov	byte ptr [si+12h], 0
		mov	byte ptr [si+10h], 0
		mov	byte ptr [si+11h], 0
		mov	word ptr [si+0Ch], 6Eh ; 'n'
		mov	byte ptr [si+13h], 0
		mov	byte ptr [si+15h], 0
		mov	word ptr [si+0Eh], 28Ch
		or	dx, dx
		jz	short loc_10C48
		add	word ptr [si+0Eh], 28h ; '('

loc_10C48:
		pop	si
		pop	bp
		retf	2
reimu_10BFE	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10C4D	proc near

@@angle		= byte ptr -1

		enter	2, 0
		cmp	word_1F3B0, 0
		jnz	short loc_10C76
		mov	ax, word_1F33E
		mov	point_1F342.x, ax
		mov	ax, word_1F340
		add	ax, 300h
		mov	point_1F342.y, ax
		push	1
		call	randring_far_next16_and
		mov	byte_23DC6, al
		mov	byte_23DC7, 10h

loc_10C76:
		mov	al, byte ptr word_1F3B0
		add	al, al
		mov	[bp+@@angle], al
		cmp	byte_23DC6, 0
		jz	short loc_10C8D
		mov	al, 0
		sub	al, [bp+@@angle]
		mov	[bp+@@angle], al

loc_10C8D:
		mov	al, byte_1F39F
		mov	ah, 0
		push	ax
		mov	ax, word_1F3B0
		xor	dx, dx
		pop	bx
		div	bx
		or	dx, dx
		jnz	loc_10D57
		mov	byte_23E4E, 4
		mov	byte_23E45, 0
		mov	al, 1
		sub	al, _pid_current
		mov	_pid_other, al
		mov	al, [bp+@@angle]
		add	al, al
		mov	angle_23E43, al
		mov	al, byte_23DC7
		mov	byte_23E42, al
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F33E, (32 shl 4), _CosTable8[bx]
		mov	word_23E3E, ax
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F340, (32 shl 4), _SinTable8[bx]
		mov	word_23E40, ax
		call	sub_17730
		mov	al, [bp+@@angle]
		add	al, al
		add	al, 80h
		mov	angle_23E43, al
		mov	al, [bp+@@angle]
		add	al, 80h
		mov	[bp+@@angle], al
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F33E, (32 shl 4), _CosTable8[bx]
		mov	word_23E3E, ax
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F340, (32 shl 4), _SinTable8[bx]
		mov	word_23E40, ax
		call	sub_17730

loc_10D57:
		test	byte ptr word_1F3B0, 1
		jnz	short loc_10D62
		inc	byte_23DC7

loc_10D62:
		mov	al, byte ptr word_1F3B0
		add	al, al
		mov	[bp+@@angle], al
		add	al, -40h
		mov	[bp+@@angle], al
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, point_1F342.y, (48 shl 4), _SinTable8[bx]
		mov	word_1F340, ax
		cmp	word_1F3B0, 80h
		jb	short locret_10D9E
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

locret_10D9E:
		leave
		retn
sub_10C4D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10DA0	proc near
		push	bp
		mov	bp, sp
		call	sub_F356
		mov	byte_23E4E, 2
		mov	al, byte_1F3A1
		mov	byte_23E42, al
		mov	al, 1
		sub	al, _pid_current
		mov	_pid_other, al
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		cmp	word_1F3B0, 40h
		jnb	short loc_10DEF
		cmp	_round_frame_mod16, 0
		jnz	short loc_10E14
		mov	angle_23E43, 20h
		mov	byte_23E45, 8
		call	sub_17730
		mov	angle_23E43, 60h

loc_10DE8:
		call	sub_17730
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_10DEF:
		cmp	word_1F3B0, 64h	; 'd'
		jnb	short loc_10E09
		cmp	_round_frame_mod16, 0
		jnz	short loc_10E14
		mov	byte_23E45, 15h
		mov	angle_23E43, 40h
		jmp	short loc_10DE8
; ---------------------------------------------------------------------------

loc_10E09:
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

loc_10E14:
		pop	bp
		retn
sub_10DA0	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10E16	proc near

@@angle		= byte ptr -1

		enter	2, 0
		push	si
		call	sub_F356
		cmp	word_1F3B0, 0
		jnz	short loc_10E32
		mov	byte_1F353, 1
		call	randring_far_next16
		mov	byte_23DC8, al

loc_10E32:
		cmp	word_1F3B0, 18h
		jnb	loc_10EBC
		xor	si, si
		jmp	short loc_10EA8
; ---------------------------------------------------------------------------

loc_10E3F:
		mov	ax, si
		shl	ax, 8
		mov	dl, byte_1F3A2
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		add	al, byte_23DC8
		mov	[bp+@@angle], al
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_CosTable8[bx]
		mov	ax, word_1F3B0
		shl	ax, 4
		add	ax, ax
		push	ax
		push	word_1F33E
		call	_vector1_at
		add	sp, 6
		mov	bx, si
		add	bx, bx
		mov	[bx+686Ah], ax
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_SinTable8[bx]
		mov	ax, word_1F3B0
		shl	ax, 4
		add	ax, ax
		push	ax
		push	word_1F340
		call	_vector1_at
		add	sp, 6
		mov	bx, si
		add	bx, bx
		mov	[bx+6876h], ax
		inc	si

loc_10EA8:
		mov	al, byte_1F3A2
		mov	ah, 0
		cmp	ax, si
		jg	short loc_10E3F
		mov	al, byte_23DC8
		add	al, 8
		mov	byte_23DC8, al
		jmp	loc_10FCE
; ---------------------------------------------------------------------------

loc_10EBC:
		cmp	word_1F3B0, 50h	; 'P'
		jnb	loc_10F7A
		xor	si, si
		jmp	short loc_10F26
; ---------------------------------------------------------------------------

loc_10EC9:
		mov	ax, si
		shl	ax, 8
		mov	dl, byte_1F3A2
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		add	al, byte_23DC8
		mov	[bp+@@angle], al
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F33E, (48 shl 4), _CosTable8[bx]
		mov	bx, si
		add	bx, bx
		mov	[bx+686Ah], ax
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F340, (48 shl 4), _SinTable8[bx]
		mov	bx, si
		add	bx, bx
		mov	[bx+6876h], ax
		inc	si

loc_10F26:
		mov	al, byte_1F3A2
		mov	ah, 0
		cmp	ax, si
		jg	short loc_10EC9
		mov	al, byte_23DC8
		add	al, 8
		mov	byte_23DC8, al
		cmp	_round_frame_mod16, 0
		jnz	loc_10FCE
		mov	byte_23E4E, 2
		mov	al, byte_1F3A3
		mov	byte_23E42, al
		mov	al, 1
		sub	al, _pid_current
		mov	_pid_other, al
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		call	randring_far_next16
		mov	angle_23E43, al
		mov	byte_23E45, 26h ; '&'
		mov	al, byte_1F3A4
		mov	byte_23E47, al
		call	sub_17730
		jmp	short loc_10FCE
; ---------------------------------------------------------------------------

loc_10F7A:
		cmp	word_1F3B0, 50h	; 'P'
		jnz	short loc_10FCE
		xor	si, si
		jmp	short loc_10FB5
; ---------------------------------------------------------------------------

loc_10F85:
		mov	ax, si
		shl	ax, 8
		mov	dl, byte_1F3A2
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		add	al, byte_23DC8
		mov	[bp+@@angle], al
		mov	bx, si
		add	bx, bx
		push	word ptr [bx+686Ah]
		mov	bx, si
		add	bx, bx
		push	word ptr [bx+6876h]
		push	word ptr [bp+@@angle]
		call	sub_1A2CE
		inc	si

loc_10FB5:
		mov	al, byte_1F3A2
		mov	ah, 0
		cmp	ax, si
		jg	short loc_10F85
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0
		mov	byte_1F353, 0

loc_10FCE:
		pop	si
		leave
		retn
sub_10E16	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_10FD1	proc near
		push	bp
		mov	bp, sp
		call	sub_F356
		cmp	word_1F3B0, 80h
		jnb	short loc_11026
		test	byte ptr word_1F3B0, 0Fh
		jnz	short loc_11031
		mov	byte_23E4E, 2
		mov	al, byte_1F3A1
		mov	byte_23E42, al
		mov	al, 1
		sub	al, _pid_current
		mov	_pid_other, al
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		mov	al, byte ptr word_1F3B0
		mov	angle_23E43, al
		mov	byte_23E45, 0Eh
		call	sub_17730
		mov	al, 78h
		sub	al, byte ptr word_1F3B0
		mov	angle_23E43, al
		call	sub_17730
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_11026:
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

loc_11031:
		pop	bp
		retn
sub_10FD1	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

reimu_11033	proc far

var_4		= word ptr -4
@@pid_other		= byte ptr -1

		enter	4, 0
		call	sub_F402
		or	al, al
		jz	short loc_11083
		mov	al, byte_1F39E
		mov	ah, 0
		mov	bx, 5
		cwd
		idiv	bx
		mov	dl, 5
		sub	dl, al
		mov	byte_1F39F, dl
		mov	al, byte_1F39E
		add	al, 18h
		mov	byte_1F3A0, al
		mov	al, byte_1F39E
		add	al, al
		add	al, 28h	; '('
		mov	byte_1F3A1, al
		mov	al, byte_1F39E
		mov	ah, 0
		mov	bx, 8
		cwd
		idiv	bx
		add	al, 4
		mov	byte_1F3A2, al
		mov	al, byte_1F39E
		add	al, 10h
		mov	byte_1F3A3, al
		mov	al, byte_1F39E
		add	al, 10h
		mov	byte_1F3A4, al

loc_11083:
		mov	al, _pid_current
		cmp	al, byte_1DB9E
		jnz	locret_11159	; jumptable 000110E0 case 255
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		call	sub_F512
		inc	word_1F3B0
		cmp	byte_1F34F, 0
		jnz	short loc_110B9
		cmp	word_1F3B0, 64h	; 'd'
		jnz	locret_11159	; jumptable 000110E0 case 255
		mov	word_1F3B0, 0
		mov	byte_1F34F, 1

loc_110B9:
		cmp	byte_1F34F, 1
		jnz	short loc_110C3
		call	sub_F52D

loc_110C3:
		mov	al, byte_1F34F
		mov	ah, 0
		mov	[bp+var_4], ax
		mov	cx, 12h		; switch 18 cases
		mov	bx, offset word_1115B

loc_110D1:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_4]
		jz	short loc_110E0
		add	bx, 2
		loop	loc_110D1
		jmp	short loc_110FB	; default
; ---------------------------------------------------------------------------

loc_110E0:
		jmp	word ptr cs:[bx+24h] ; switch jump

loc_110E4:
		call	sub_10C4D	; jumptable 000110E0 cases 2-6
		jmp	short loc_110FB	; default
; ---------------------------------------------------------------------------

loc_110E9:
		call	sub_10DA0	; jumptable 000110E0 cases 8-10,13
		jmp	short loc_110FB	; default
; ---------------------------------------------------------------------------

loc_110EE:
		call	sub_10E16	; jumptable 000110E0 cases 15-17
		jmp	short loc_110FB	; default
; ---------------------------------------------------------------------------

loc_110F3:
		call	sub_10FD1	; jumptable 000110E0 cases 7,11,12,14
		jmp	short loc_110FB	; default
; ---------------------------------------------------------------------------

loc_110F8:
		call	sub_F3A9	; jumptable 000110E0 case 128

loc_110FB:
		mov	ax, word_1F33E	; default
		mov	word_220EE, ax
		mov	ax, word_1F340
		mov	word_220F0, ax
		mov	word_220F2, 1Ch
		mov	word_220F4, 1Ch
		mov	al, [bp+@@pid_other]
		mov	byte_220FA, al
		call	sub_13A6E
		mov	byte_20E2C, 1
		mov	word_20E32, 200h
		mov	word_20E34, 200h
		mov	al, [bp+@@pid_other]
		mov	pid_20E3A, al
		mov	ax, word_1F33E
		mov	word_20E2E, ax
		mov	ax, word_1F340
		mov	word_20E30, ax
		call	sub_158F5
		mov	byte_1F34E, al
		mov	ah, 0
		sub	word_1F34A, ax
		mov	byte_20E2C, 0
		nopcall	sub_F4B4

locret_11159:
		leave			; jumptable 000110E0 case 255
		retf
reimu_11033	endp

; ---------------------------------------------------------------------------
word_1115B	dw	2,     3,     4,     5
		dw	6,     7,     8,     9 ; value table for switch	statement
		dw    0Ah,   0Bh,   0Ch,   0Dh
		dw    0Eh,   0Fh,   10h,   11h
		dw    80h,  0FFh
		dw offset loc_110E4	; jump table for switch	statement
		dw offset loc_110E4
		dw offset loc_110E4
		dw offset loc_110E4
		dw offset loc_110E4
		dw offset loc_110F3
		dw offset loc_110E9
		dw offset loc_110E9
		dw offset loc_110E9
		dw offset loc_110F3
		dw offset loc_110F3
		dw offset loc_110E9
		dw offset loc_110F3
		dw offset loc_110EE
		dw offset loc_110EE
		dw offset loc_110EE
		dw offset loc_110F8
		dw offset locret_11159

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_111A3	proc near

var_6		= byte ptr -6
@@pid_other		= byte ptr -5
@@top		= word ptr -4
@@left		= word ptr -2

		enter	6, 0
		push	si
		push	di
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	_sprite16_put_w, (96 / 16)
		mov	_sprite16_put_h, 48
		cmp	[bp+@@pid_other], 0
		jnz	short loc_111D1
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_111DD
; ---------------------------------------------------------------------------

loc_111D1:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_111DD:
		mov	si, sprite_1F34C
		cmp	byte_1F34E, 0
		jz	short loc_111EB
		add	si, 0Ch

loc_111EB:
		push	word_1F33E
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -48
		mov	[bp+@@left], ax
		mov	ax, word_1F340
		sar	ax, 4
		add	ax, -32
		mov	[bp+@@top], ax
		call	sprite16_put pascal, [bp+@@left], ax, si
		cmp	byte_1F353, 1
		jnz	loc_112A2
		mov	_sprite16_put_w, (48 / 16)
		mov	_sprite16_put_h, 24
		mov	ax, sprite_1F34C
		add	ax, 0FFF4h
		mov	si, ax
		mov	ax, word_1F3B0
		shr	ax, 2
		mov	[bp+var_6], al
		mov	ah, 0
		and	ax, 3
		cmp	ax, 1
		jnz	short loc_1124A
		add	si, 6
		jmp	short loc_11260
; ---------------------------------------------------------------------------

loc_1124A:
		test	[bp+var_6], 3
		jz	short loc_11260
		mov	al, [bp+var_6]
		mov	ah, 0
		and	ax, 1
		imul	ax, 6
		add	ax, 780h
		add	si, ax

loc_11260:
		xor	di, di
		jmp	short loc_11299
; ---------------------------------------------------------------------------

loc_11264:
		mov	bx, di
		add	bx, bx
		push	word ptr [bx+686Ah]
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -24
		mov	[bp+@@left], ax
		mov	bx, di
		add	bx, bx
		mov	ax, [bx+6876h]
		sar	ax, 4
		add	ax, -8
		mov	[bp+@@top], ax
		call	sprite16_put pascal, [bp+@@left], ax, si
		inc	di

loc_11299:
		mov	al, byte_1F3A2
		mov	ah, 0
		cmp	ax, di
		jg	short loc_11264

loc_112A2:
		pop	di
		pop	si
		leave
		retn
sub_111A3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_112A6	proc near

@@pid_other		= byte ptr -6
var_5		= byte ptr -5
var_4		= word ptr -4
@@top		= word ptr -2
arg_0		= word ptr  4
@@angle		= byte ptr  6

		enter	6, 0
		push	si
		push	di
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		cmp	_round_frame_mod2, 0
		jz	short loc_112C5
		cmp	word_1F3B0, 40h
		jb	loc_113A3

loc_112C5:
		mov	_sprite16_put_w, (48 / 16)
		mov	_sprite16_put_h, 24
		cmp	_pid_current, 0
		jz	short loc_112E5
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_112F1
; ---------------------------------------------------------------------------

loc_112E5:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_112F1:
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 280h
		mov	si, ax
		mov	ax, word_1F3B0
		shr	ax, 2
		mov	[bp+var_5], al
		mov	ah, 0
		and	ax, 3
		cmp	ax, 1
		jnz	short loc_11313
		add	si, 6
		jmp	short loc_11329
; ---------------------------------------------------------------------------

loc_11313:
		test	[bp+var_5], 3
		jz	short loc_11329
		mov	al, [bp+var_5]
		mov	ah, 0
		and	ax, 1
		imul	ax, 6
		add	ax, 780h
		add	si, ax

loc_11329:
		mov	[bp+var_4], 0
		jmp	short loc_1139D
; ---------------------------------------------------------------------------

loc_11330:
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F33E, [bp+arg_0], _CosTable8[bx]
		mov	di, ax
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F340, [bp+arg_0], _SinTable8[bx]
		mov	[bp+@@top], ax
		push	di
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -24
		mov	di, ax
		mov	ax, [bp+@@top]
		sar	ax, 4
		add	ax, -8
		mov	[bp+@@top], ax
		call	sprite16_put pascal, di, ax, si
		inc	[bp+var_4]
		mov	al, [bp+@@angle]
		add	al, 20h
		mov	[bp+@@angle], al

loc_1139D:
		cmp	[bp+var_4], 8
		jl	short loc_11330

loc_113A3:
		pop	di
		pop	si
		leave
		retn	4
sub_112A6	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

reimu_113A9	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		cmp	al, byte_1DB9E
		jnz	short loc_113E0
		cmp	byte_1F34F, 0
		jnz	short loc_113D1
		push	word_1F3B0
		mov	ax, word_1F3B0
		shl	ax, 5
		mov	dx, 0C80h
		sub	dx, ax
		push	dx
		call	sub_112A6
		pop	bp
		retf
; ---------------------------------------------------------------------------

loc_113D1:
		cmp	byte_1F34F, -1
		jz	short loc_113DD
		call	sub_111A3
		pop	bp
		retf
; ---------------------------------------------------------------------------

loc_113DD:
		call	sub_F58C

loc_113E0:
		pop	bp
		retf
reimu_113A9	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

ellen_113E2	proc far

arg_0		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		mov	dx, [bp+arg_0]
		mov	ax, dx
		shl	ax, 5
		add	ax, 1DFEh
		mov	si, ax
		mov	word ptr [si], 900h
		mov	word ptr [si+2], 500h
		mov	word ptr [si+8], 0FFE0h
		mov	word ptr [si+0Ah], 0
		mov	byte ptr [si+12h], 0
		mov	byte ptr [si+10h], 0
		mov	byte ptr [si+11h], 0
		mov	word ptr [si+0Ch], 64h ; 'd'
		mov	byte ptr [si+13h], 0
		mov	byte ptr [si+16h], 0
		mov	byte ptr [si+17h], 0
		mov	word ptr [si+0Eh], 780h
		or	dx, dx
		jz	short loc_11430
		add	word ptr [si+0Eh], 28h ; '('

loc_11430:
		mov	byte ptr [si+15h], 0
		pop	si
		pop	bp
		retf	2
ellen_113E2	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_11439	proc near

@@pid_other		= byte ptr -1

		enter	2, 0
		push	si
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		cmp	word_1F3B0, 10h
		jz	short loc_11455
		cmp	word_1F3B0, 14h
		jnz	short loc_1146B

loc_11455:
		push	word_1F33E
		push	word_1F340
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		jmp	loc_11544
; ---------------------------------------------------------------------------

loc_1146B:
		cmp	word_1F3B0, 18h
		jnz	short loc_1148D
		push	word_1F33E
		push	word_1F340
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		mov	byte_23DE2, 40h
		jmp	loc_11544
; ---------------------------------------------------------------------------

loc_1148D:
		cmp	word_1F3B0, 1Ch
		jb	loc_11544
		mov	al, byte_23DE2
		mov	angle_23E43, al
		mov	byte_23E45, 22h ; '"'
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		mov	al, byte_1F39F
		mov	byte_23E42, al
		mov	byte_23E4E, 2
		mov	al, [bp+@@pid_other]
		mov	_pid_other, al
		mov	word_23E4C, 8
		cmp	_pid_current, 0
		jz	short loc_114D1
		add	word_23E4C, 280h

loc_114D1:
		cmp	word_1F3B0, 24h	; '$'
		jnb	short loc_114E1
		test	byte ptr word_1F3B0, 1
		jnz	short loc_1152D
		jmp	short loc_11519
; ---------------------------------------------------------------------------

loc_114E1:
		cmp	word_1F3B0, 24h	; '$'
		jnz	short loc_1150B
		call	snd_se_play pascal, 3
		xor	si, si
		jmp	short loc_11504
; ---------------------------------------------------------------------------

loc_114F3:
		call	sub_17730
		mov	al, byte_23DE2
		add	al, 8
		mov	byte_23DE2, al
		mov	angle_23E43, al
		inc	si

loc_11504:
		cmp	si, 8
		jl	short loc_114F3
		jmp	short loc_1152D
; ---------------------------------------------------------------------------

loc_1150B:
		cmp	word_1F3B0, 2Ch	; ','
		ja	short loc_1152D
		test	byte ptr word_1F3B0, 1
		jnz	short loc_1152D

loc_11519:
		call	snd_se_play pascal, 3
		call	sub_17730
		mov	al, byte_23DE2
		add	al, 8
		mov	byte_23DE2, al

loc_1152D:
		cmp	word_1F3B0, 2Ch	; ','
		jb	short loc_11544
		mov	byte_1F353, 0
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

loc_11544:
		pop	si
		leave
		retn
sub_11439	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_11547	proc near

var_2		= byte ptr -2
@@pid_other		= byte ptr -1

		enter	2, 0
		push	si
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	al, byte_1F354
		add	al, 3
		mov	byte_1F354, al
		cmp	word_1F3B0, 20h	; ' '
		jb	loc_1161D
		cmp	word_1F3B0, 20h	; ' '
		jz	short loc_1157B
		cmp	word_1F3B0, 24h	; '$'
		jz	short loc_1157B
		cmp	word_1F3B0, 28h	; '('
		jnz	short loc_11591

loc_1157B:
		push	word_1F33E
		push	word_1F340
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		jmp	loc_1161D
; ---------------------------------------------------------------------------

loc_11591:
		cmp	word_1F3B0, 30h	; '0'
		jnz	short loc_115D2
		xor	si, si
		call	randring_far_next16
		jmp	short loc_115C4
; ---------------------------------------------------------------------------

loc_115A1:
		push	word_1F33E
		push	word_1F340
		push	word ptr [bp+var_2]
		push	2
		call	sub_194A9
		inc	si
		mov	al, byte_1F3A0
		mov	ah, 0
		push	ax
		mov	ax, 256
		cwd
		pop	bx
		idiv	bx
		add	al, [bp+var_2]

loc_115C4:
		mov	[bp+var_2], al
		mov	al, byte_1F3A0
		mov	ah, 0
		cmp	ax, si
		jg	short loc_115A1
		jmp	short loc_1161D
; ---------------------------------------------------------------------------

loc_115D2:
		cmp	word_1F3B0, 60h
		jnz	short loc_1161D
		xor	si, si
		call	randring_far_next16
		jmp	short loc_11606
; ---------------------------------------------------------------------------

loc_115E2:
		push	word_1F33E
		push	word_1F340
		push	word ptr [bp+var_2]
		push	0FEh
		call	sub_194A9
		inc	si
		mov	al, byte_1F3A0
		mov	ah, 0
		push	ax
		mov	ax, 256
		cwd
		pop	bx
		idiv	bx
		add	al, [bp+var_2]

loc_11606:
		mov	[bp+var_2], al
		mov	al, byte_1F3A0
		mov	ah, 0
		cmp	ax, si
		jg	short loc_115E2
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

loc_1161D:
		pop	si
		leave
		retn
sub_11547	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_11620	proc near
		push	bp
		mov	bp, sp
		call	sub_F356
		mov	al, byte_1F3A2
		mov	ah, 0
		push	ax
		mov	ax, word_1F3B0
		xor	dx, dx
		pop	bx
		div	bx
		cmp	dx, 1
		jnz	short loc_116A2
		call	snd_se_play pascal, 10
		mov	byte_23E45, 0Eh
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		mov	al, byte_23DE3
		mov	angle_23E43, al
		mov	al, byte_1F3A1
		mov	byte_23E42, al
		mov	byte_23E4E, 1
		mov	al, 1
		sub	al, _pid_current
		mov	_pid_other, al
		call	sub_17730
		mov	al, byte_23DE3
		add	al, 80h
		mov	angle_23E43, al
		call	sub_17730
		mov	al, byte_1F3A1
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	byte_23E42, al
		call	sub_17730
		mov	al, byte_23DE3
		mov	angle_23E43, al
		call	sub_17730
		mov	al, byte_23DE3
		add	al, 10h
		mov	byte_23DE3, al

loc_116A2:
		cmp	word_1F3B0, 60h
		jb	short loc_116B4
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

loc_116B4:
		pop	bp
		retn
sub_11620	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

ellen_116B6	proc far

var_4		= word ptr -4
@@pid_other		= byte ptr -1

		enter	4, 0
		call	sub_F402
		or	al, al
		jz	short loc_116F6
		mov	al, byte_1F39E
		add	al, al
		add	al, 32h	; '2'
		mov	byte_1F39F, al
		mov	al, byte_1F39E
		mov	ah, 0
		mov	bx, 10
		cwd
		idiv	bx
		add	al, 4
		mov	byte_1F3A0, al
		mov	al, byte_1F39E
		add	al, 30h	; '0'
		mov	byte_1F3A1, al
		mov	al, byte_1F39E
		mov	ah, 0
		mov	bx, 3
		cwd
		idiv	bx
		mov	dl, 10
		sub	dl, al
		mov	byte_1F3A2, dl

loc_116F6:
		mov	al, _pid_current
		cmp	al, byte_1DB9E
		jnz	locret_117C1	; jumptable 00011732 case 255
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		call	sub_F512
		inc	byte_1F354
		inc	word_1F3B0
		mov	al, byte_1F34F
		mov	ah, 0
		mov	[bp+var_4], ax
		mov	cx, 14h		; switch 20 cases
		mov	bx, offset word_117C4

loc_11723:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_4]
		jz	short loc_11732
		add	bx, 2
		loop	loc_11723
		jmp	short loc_11763	; default
; ---------------------------------------------------------------------------

loc_11732:
		jmp	word ptr cs:[bx+28h] ; switch jump

loc_11736:
		cmp	word_1F3B0, 64h	; 'd' ; jumptable 00011732 case 0
		jnz	locret_117C1	; jumptable 00011732 case 255
		mov	word_1F3B0, 0
		mov	byte_1F34F, 1
		jmp	short loc_11763	; default
; ---------------------------------------------------------------------------

loc_1174C:
		call	sub_F52D	; jumptable 00011732 case 1
		jmp	short loc_11763	; default
; ---------------------------------------------------------------------------

loc_11751:
		call	sub_11439	; jumptable 00011732 cases 2-5
		jmp	short loc_11763	; default
; ---------------------------------------------------------------------------

loc_11756:
		call	sub_11547	; jumptable 00011732 cases 6-10
		jmp	short loc_11763	; default
; ---------------------------------------------------------------------------

loc_1175B:
		call	sub_11620	; jumptable 00011732 cases 11-17
		jmp	short loc_11763	; default
; ---------------------------------------------------------------------------

loc_11760:
		call	sub_F3A9	; jumptable 00011732 case 128

loc_11763:
		mov	ax, word_1F33E	; default
		mov	word_220EE, ax
		mov	ax, word_1F340
		mov	word_220F0, ax
		mov	word_220F2, 14h
		mov	word_220F4, 18h
		mov	al, [bp+@@pid_other]
		mov	byte_220FA, al
		call	sub_13A6E
		mov	byte_20E2C, 1
		mov	word_20E32, 180h
		mov	word_20E34, 180h
		mov	al, [bp+@@pid_other]
		mov	pid_20E3A, al
		mov	ax, word_1F33E
		mov	word_20E2E, ax
		mov	ax, word_1F340
		mov	word_20E30, ax
		call	sub_158F5
		mov	byte_1F34E, al
		mov	ah, 0
		sub	word_1F34A, ax
		mov	byte_20E2C, 0
		nopcall	sub_F4B4

locret_117C1:
		leave			; jumptable 00011732 case 255
		retf
ellen_116B6	endp

; ---------------------------------------------------------------------------
		db 0
word_117C4	dw	0,     1,     2,     3
		dw	4,     5,     6,     7 ; value table for switch	statement
		dw	8,     9,   0Ah,   0Bh
		dw    0Ch,   0Dh,   0Eh,   0Fh
		dw    10h,   11h,   80h,  0FFh
		dw offset loc_11736	; jump table for switch	statement
		dw offset loc_1174C
		dw offset loc_11751
		dw offset loc_11751
		dw offset loc_11751
		dw offset loc_11751
		dw offset loc_11756
		dw offset loc_11756
		dw offset loc_11756
		dw offset loc_11756
		dw offset loc_11756
		dw offset loc_1175B
		dw offset loc_1175B
		dw offset loc_1175B
		dw offset loc_1175B
		dw offset loc_1175B
		dw offset loc_1175B
		dw offset loc_1175B
		dw offset loc_11760
		dw offset locret_117C1

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_11814	proc near

@@sprite_offset		= word ptr -6
@@top		= word ptr -4
@@left		= word ptr -2
arg_0		= word ptr  4

		enter	6, 0
		push	si
		mov	si, [bp+arg_0]
		mov	bx, si
		add	bx, bx
		mov	ax, [bx+8B2h]
		imul	ax, 28h
		add	ax, sprite_1F34C
		add	ax, 0FB10h
		mov	[bp+@@sprite_offset], ax
		mov	_sprite16_put_w, (96 / 16)
		mov	bx, si
		add	bx, bx
		mov	ax, [bx+8C4h]
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	_sprite16_put_h, ax
		push	word_1F33E
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	playfield_fg_x_to_screen
		add	ax, -48
		mov	[bp+@@left], ax
		mov	ax, word_1F340
		sar	ax, 4
		mov	bx, si
		add	bx, bx
		add	ax, [bx+8B2h]
		add	ax, -40
		mov	[bp+@@top], ax
		call	sprite16_put pascal, [bp+@@left], ax, [bp+@@sprite_offset]
		pop	si
		leave
		retn	2
sub_11814	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_11885	proc near

@@pid_other		= byte ptr -5
@@top		= word ptr -4
@@left		= word ptr -2

		enter	6, 0
		push	si
		push	di
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	_sprite16_put_w, (64 / 16)
		mov	_sprite16_put_h, 48
		push	word_1F33E
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -32
		mov	[bp+@@left], ax
		mov	ax, word_1F340
		sar	ax, 4
		add	ax, -32
		mov	[bp+@@top], ax
		mov	di, sprite_1F34C
		cmp	byte_1F34E, 0
		jz	short loc_118CB
		add	di, 8

loc_118CB:
		call	sprite16_put pascal, [bp+@@left], [bp+@@top], di
		mov	al, byte_1F354
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		mov	bx, 9
		cwd
		idiv	bx
		mov	si, dx
		push	dx
		call	sub_11814
		dec	si
		or	si, si
		jge	short loc_118F6
		mov	si, 8

loc_118F6:
		push	si
		call	sub_11814
		dec	si
		or	si, si
		jge	short loc_11902
		mov	si, 8

loc_11902:
		push	si
		call	sub_11814
		pop	di
		pop	si
		leave
		retn
sub_11885	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1190A	proc near

var_8		= word ptr -8
@@sprite_offset		= word ptr -6
@@pid_other		= word ptr -4
@@top		= word ptr -2
@@angle		= byte ptr  4
arg_2		= byte ptr  6
arg_4		= word ptr  8

		enter	8, 0
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		mov	[bp+@@pid_other], dx
		mov	al, [bp+arg_2]
		mov	ah, 0
		mov	bx, 9
		cwd
		idiv	bx
		mov	si, dx
		push	dx
		call	sub_11814
		dec	si
		or	si, si
		jge	short loc_11936
		mov	si, 8

loc_11936:
		push	si
		call	sub_11814
		dec	si
		or	si, si
		jge	short loc_11942
		mov	si, 8

loc_11942:
		push	si
		call	sub_11814
		cmp	_round_frame_mod2, 0
		jz	short loc_11956
		cmp	word_1F3B0, 40h
		jb	loc_119FB

loc_11956:
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 16
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 28Ch
		mov	[bp+@@sprite_offset], ax
		xor	si, si
		jmp	loc_119F4
; ---------------------------------------------------------------------------

loc_11971:
		mov	[bp+var_8], 0
		jmp	short loc_119E1
; ---------------------------------------------------------------------------

loc_11978:
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F33E, [bp+arg_4], _CosTable8[bx]
		mov	di, ax
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F340, [bp+arg_4], _SinTable8[bx]
		mov	[bp+@@top], ax
		call	playfield_fg_x_to_screen pascal, di, [bp+@@pid_other]
		add	ax, -16
		mov	di, ax
		mov	ax, [bp+@@top]
		sar	ax, 4
		mov	[bp+@@top], ax
		call	sprite16_put pascal, di, ax, [bp+@@sprite_offset]
		mov	al, [bp+@@angle]
		add	al, 20h
		mov	[bp+@@angle], al
		inc	[bp+var_8]

loc_119E1:
		cmp	[bp+var_8], 8
		jl	short loc_11978
		mov	al, [bp+@@angle]
		add	al, 3
		mov	[bp+@@angle], al
		sub	[bp+@@sprite_offset], 4
		inc	si

loc_119F4:
		cmp	si, 4
		jl	loc_11971

loc_119FB:
		pop	di
		pop	si
		leave
		retn	6
sub_1190A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

ellen_11A01	proc far

@@pid_other		= byte ptr -1

		enter	2, 0
		mov	al, _pid_current
		cmp	al, byte_1DB9E
		jnz	short locret_11A6B
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		cmp	[bp+@@pid_other], 0
		jnz	short loc_11A2B
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_11A37
; ---------------------------------------------------------------------------

loc_11A2B:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_11A37:
		cmp	byte_1F34F, 0
		jnz	short loc_11A5C
		mov	ax, word_1F3B0
		add	ax, ax
		mov	dx, 0C8h
		sub	dx, ax
		shl	dx, 4
		push	dx
		push	word_1F3B0
		mov	ax, word_1F3B0
		imul	ax, 3
		push	ax
		call	sub_1190A
		leave
		retf
; ---------------------------------------------------------------------------

loc_11A5C:
		cmp	byte_1F34F, -1
		jz	short loc_11A68
		call	sub_11885
		leave
		retf
; ---------------------------------------------------------------------------

loc_11A68:
		call	sub_F58C

locret_11A6B:
		leave
		retf
ellen_11A01	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kotohime_11A6D	proc far

arg_0		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		mov	dx, [bp+arg_0]
		mov	ax, dx
		shl	ax, 5
		add	ax, 1DFEh
		mov	si, ax
		mov	word ptr [si], 900h
		mov	word ptr [si+2], 500h
		mov	word ptr [si+8], 0FFE0h
		mov	word ptr [si+0Ah], 0
		mov	byte ptr [si+12h], 0
		mov	byte ptr [si+10h], 0
		mov	byte ptr [si+11h], 0
		mov	word ptr [si+0Ch], 6Eh ; 'n'
		mov	byte ptr [si+13h], 0
		mov	word ptr [si+18h], 0
		mov	word ptr [si+0Eh], 288h
		or	dx, dx
		jz	short loc_11AB8
		add	word ptr [si+0Eh], 28h ; '('

loc_11AB8:
		mov	byte ptr [si+15h], 0
		pop	si
		pop	bp
		retf	2
kotohime_11A6D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_11AC1	proc near

@@angle		= byte ptr -5
var_4		= word ptr -4
var_2		= word ptr -2
arg_0		= word ptr  4

		enter	6, 0
		push	si
		mov	byte_23E4E, 2
		xor	si, si
		jmp	short loc_11B43
; ---------------------------------------------------------------------------

loc_11ACF:
		cmp	[bp+arg_0], 0
		jz	short loc_11ADD
		call	randring_far_next16
		mov	angle_23E43, al

loc_11ADD:
		mov	ax, si
		shl	ax, 8
		mov	dl, byte_1F3A0
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		add	al, byte_1F355
		mov	[bp+@@angle], al
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F33E, word_1F356, _CosTable8[bx]
		mov	[bp+var_2], ax
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F340, word_1F356, _SinTable8[bx]
		mov	[bp+var_4], ax
		mov	ax, [bp+var_2]
		mov	word_23E3E, ax
		mov	ax, [bp+var_4]
		mov	word_23E40, ax
		call	sub_17730
		inc	si

loc_11B43:
		mov	al, byte_1F3A0
		mov	ah, 0
		cmp	ax, si
		jg	short loc_11ACF
		pop	si
		leave
		retn	2
sub_11AC1	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_11B51	proc near
		push	bp
		mov	bp, sp
		cmp	word_1F3B0, 1
		jnz	short loc_11B6B
		mov	byte_1F353, 1
		mov	word_1F356, 0
		mov	byte_1F354, 0

loc_11B6B:
		mov	al, byte_1F355
		add	al, 4
		mov	byte_1F355, al
		cmp	word_1F356, 400h
		jle	short loc_11BBC
		mov	byte_1F353, 2
		mov	al, byte_1F355
		add	al, 2
		mov	byte_1F355, al
		inc	byte_1F354
		cmp	byte_1F354, 40h
		jbe	short loc_11BC4
		mov	byte_23E45, 24h ; '$'
		mov	al, byte_1F39F
		mov	byte_23E42, al
		push	1
		call	sub_11AC1
		call	snd_se_play pascal, 3
		mov	byte_1F353, 0
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_11BBC:
		call	sub_F356
		add	word_1F356, 20h	; ' '

loc_11BC4:
		pop	bp
		retn
sub_11B51	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_11BC6	proc near
		push	bp
		mov	bp, sp
		cmp	word_1F3B0, 1
		jnz	short loc_11BE5
		mov	byte_1F353, 1
		mov	word_1F356, 0
		mov	byte_1F354, 0
		mov	byte_1F355, 0

loc_11BE5:
		mov	al, byte_1F355
		add	al, 0FEh
		mov	byte_1F355, al
		cmp	word_1F356, 400h
		jle	short loc_11C55
		mov	byte_1F353, 2
		add	word_1F356, 8
		mov	al, byte_1F355
		add	al, 2
		mov	byte_1F355, al
		inc	byte_1F354
		cmp	byte_1F354, 40h
		jbe	short loc_11C5D
		mov	byte_23E45, 5
		mov	angle_23E43, 0
		mov	al, byte_1F3A2
		mov	byte_23E42, al
		push	0
		call	sub_11AC1
		mov	byte_23E45, 18h
		mov	angle_23E43, 0
		mov	al, byte_1F3A1
		mov	byte_23E42, al
		push	0
		call	sub_11AC1
		call	snd_se_play pascal, 3
		mov	byte_1F353, 0
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_11C55:
		call	sub_F356
		add	word_1F356, 20h	; ' '

loc_11C5D:
		pop	bp
		retn
sub_11BC6	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_11C5F	proc near
		push	bp
		mov	bp, sp
		call	sub_F356
		mov	al, byte_1F3A4
		mov	ah, 0
		push	ax
		mov	ax, word_1F3B0
		xor	dx, dx
		pop	bx
		div	bx
		cmp	dx, 1
		jnz	loc_11D06
		call	snd_se_play pascal, 3
		mov	byte_23E4E, 1
		mov	al, byte ptr word_1F3B0
		mov	angle_23E43, al
		mov	al, byte_1F3A3
		mov	byte_23E42, al
		mov	byte_23E45, 26h ; '&'
		mov	byte_23E47, 4
		mov	ax, word_1F33E
		add	ax, 0FD00h
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		call	sub_17730
		mov	ax, word_1F33E
		add	ax, 0FE80h
		mov	word_23E3E, ax
		mov	ax, word_1F340
		add	ax, 0C0h
		mov	word_23E40, ax
		call	sub_17730
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		add	ax, 180h
		mov	word_23E40, ax
		call	sub_17730
		mov	ax, word_1F33E
		add	ax, 180h
		mov	word_23E3E, ax
		mov	ax, word_1F340
		add	ax, 0C0h
		mov	word_23E40, ax
		call	sub_17730
		mov	ax, word_1F33E
		add	ax, 300h
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		call	sub_17730

loc_11D06:
		cmp	word_1F3B0, 60h
		jb	short loc_11D18
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

loc_11D18:
		pop	bp
		retn
sub_11C5F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_11D1A	proc near

var_5		= byte ptr -5
var_4		= word ptr -4
var_2		= word ptr -2

		enter	6, 0
		push	si
		push	di
		cmp	word_1F3B0, 1
		jnz	short loc_11D37
		mov	byte_1F353, 1
		mov	word_1F356, 0
		mov	byte_1F354, 0

loc_11D37:
		mov	al, byte_1F355
		add	al, 0FCh
		mov	byte_1F355, al
		cmp	word_1F356, 400h
		jle	loc_11E3C
		mov	byte_1F353, 2
		add	word_1F356, 8
		mov	al, byte_1F355
		add	al, 0FEh
		mov	byte_1F355, al
		inc	byte_1F354
		cmp	byte_1F354, 40h
		jbe	loc_11E44
		mov	byte_23E45, 0
		mov	byte_23E4E, 2
		xor	di, di
		jmp	loc_11E18
; ---------------------------------------------------------------------------

loc_11D77:
		mov	ax, di
		shl	ax, 8
		mov	dl, byte_1F3A0
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		add	al, byte_1F355
		mov	[bp+var_5], al
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F33E, word_1F356, _CosTable8[bx]
		mov	[bp+var_2], ax
		mov	al, [bp+var_5]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F340, word_1F356, _SinTable8[bx]
		mov	[bp+var_4], ax
		mov	ax, [bp+var_2]
		mov	word_23E3E, ax
		mov	ax, [bp+var_4]
		mov	word_23E40, ax
		xor	si, si
		jmp	short loc_11E0E
; ---------------------------------------------------------------------------

loc_11DDB:
		mov	ax, si
		shl	ax, 7
		mov	dl, byte_1F3A5
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		add	al, [bp+var_5]
		add	al, 40h
		mov	angle_23E43, al
		mov	ax, si
		imul	ax, 30h
		mov	dl, byte_1F3A5
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		add	al, 10h
		mov	byte_23E42, al
		call	sub_17730
		inc	si

loc_11E0E:
		mov	al, byte_1F3A5
		mov	ah, 0
		cmp	ax, si
		jg	short loc_11DDB
		inc	di

loc_11E18:
		mov	al, byte_1F3A0
		mov	ah, 0
		cmp	ax, di
		jg	loc_11D77
		call	snd_se_play pascal, 3
		mov	byte_1F353, 0
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0
		jmp	short loc_11E44
; ---------------------------------------------------------------------------

loc_11E3C:
		call	sub_F356
		add	word_1F356, 20h	; ' '

loc_11E44:
		pop	di
		pop	si
		leave
		retn
sub_11D1A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kotohime_11E48	proc far

var_4		= word ptr -4
@@pid_other		= byte ptr -1

		enter	4, 0
		call	sub_F402
		or	al, al
		jz	short loc_11EC0
		mov	al, byte_1F39E
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, 10h
		mov	byte_1F39F, al
		mov	al, byte_1F39E
		mov	ah, 0
		mov	bx, 3
		cwd
		idiv	bx
		add	al, 6
		mov	byte_1F3A0, al
		mov	al, byte_1F39E
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, 10h
		mov	byte_1F3A1, al
		mov	al, byte_1F39E
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, 20h	; ' '
		mov	byte_1F3A2, al
		mov	al, byte_1F39E
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, 18h
		mov	byte_1F3A3, al
		mov	al, byte_1F39E
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	dl, 20h	; ' '
		sub	dl, al
		mov	byte_1F3A4, dl
		mov	al, byte_1F39E
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, 8
		mov	byte_1F3A5, al

loc_11EC0:
		mov	al, _pid_current
		cmp	al, byte_1DB9E
		jnz	locret_11F92	; jumptable 00011EFE case 255
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		call	sub_F512
		mov	al, [bp+@@pid_other]
		mov	_pid_other, al
		inc	word_1F3B0
		mov	al, byte_1F34F
		mov	ah, 0
		mov	[bp+var_4], ax
		mov	cx, 14h		; switch 20 cases
		mov	bx, offset word_11F94

loc_11EEF:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_4]
		jz	short loc_11EFE
		add	bx, 2
		loop	loc_11EEF
		jmp	short loc_11F34	; default
; ---------------------------------------------------------------------------

loc_11EFE:
		jmp	word ptr cs:[bx+28h] ; switch jump

loc_11F02:
		cmp	word_1F3B0, 64h	; 'd' ; jumptable 00011EFE case 0
		jnz	locret_11F92	; jumptable 00011EFE case 255
		mov	word_1F3B0, 0
		mov	byte_1F34F, 1
		jmp	short loc_11F34	; default
; ---------------------------------------------------------------------------

loc_11F18:
		call	sub_F52D	; jumptable 00011EFE case 1
		jmp	short loc_11F34	; default
; ---------------------------------------------------------------------------

loc_11F1D:
		call	sub_11B51	; jumptable 00011EFE cases 2-6
		jmp	short loc_11F34	; default
; ---------------------------------------------------------------------------

loc_11F22:
		call	sub_11BC6	; jumptable 00011EFE cases 7-9
		jmp	short loc_11F34	; default
; ---------------------------------------------------------------------------

loc_11F27:
		call	sub_11C5F	; jumptable 00011EFE cases 12-14
		jmp	short loc_11F34	; default
; ---------------------------------------------------------------------------

loc_11F2C:
		call	sub_11D1A	; jumptable 00011EFE cases 10,11,15-17
		jmp	short loc_11F34	; default
; ---------------------------------------------------------------------------

loc_11F31:
		call	sub_F3A9	; jumptable 00011EFE case 128

loc_11F34:
		mov	ax, word_1F33E	; default
		mov	word_220EE, ax
		mov	ax, word_1F340
		mov	word_220F0, ax
		mov	word_220F2, 20h	; ' '
		mov	word_220F4, 18h
		mov	al, [bp+@@pid_other]
		mov	byte_220FA, al
		call	sub_13A6E
		mov	byte_20E2C, 1
		mov	word_20E32, 200h
		mov	word_20E34, 200h
		mov	al, [bp+@@pid_other]
		mov	pid_20E3A, al
		mov	ax, word_1F33E
		mov	word_20E2E, ax
		mov	ax, word_1F340
		mov	word_20E30, ax
		call	sub_158F5
		mov	byte_1F34E, al
		mov	ah, 0
		sub	word_1F34A, ax
		mov	byte_20E2C, 0
		nopcall	sub_F4B4

locret_11F92:
		leave			; jumptable 00011EFE case 255
		retf
kotohime_11E48	endp

; ---------------------------------------------------------------------------
word_11F94	dw	0,     1,     2,     3
		dw	4,     5,     6,     7 ; value table for switch	statement
		dw	8,     9,   0Ah,   0Bh
		dw    0Ch,   0Dh,   0Eh,   0Fh
		dw    10h,   11h,   80h,  0FFh
		dw offset loc_11F02	; jump table for switch	statement
		dw offset loc_11F18
		dw offset loc_11F1D
		dw offset loc_11F1D
		dw offset loc_11F1D
		dw offset loc_11F1D
		dw offset loc_11F1D
		dw offset loc_11F22
		dw offset loc_11F22
		dw offset loc_11F22
		dw offset loc_11F2C
		dw offset loc_11F2C
		dw offset loc_11F27
		dw offset loc_11F27
		dw offset loc_11F27
		dw offset loc_11F2C
		dw offset loc_11F2C
		dw offset loc_11F2C
		dw offset loc_11F31
		dw offset locret_11F92

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_11FE4	proc near

@@angle		= byte ptr -7
var_6		= word ptr -6
@@sprite_offset		= word ptr -4
@@top		= word ptr -2
arg_0		= word ptr  4

		enter	8, 0
		push	si
		push	di
		mov	ax, word_1F356
		mov	[bp+var_6], ax
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 502h
		mov	[bp+@@sprite_offset], ax
		cmp	byte_1F353, 2
		jnz	short loc_12012
		mov	ax, word_1F3B0
		and	ax, 3
		cmp	ax, 2
		jnb	short loc_12012
		add	[bp+@@sprite_offset], 0A00h

loc_12012:
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 16
		xor	si, si
		jmp	short loc_12095
; ---------------------------------------------------------------------------

loc_12021:
		mov	ax, si
		shl	ax, 8
		cwd
		idiv	[bp+arg_0]
		add	al, byte_1F355
		mov	[bp+@@angle], al
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F33E, [bp+var_6], _CosTable8[bx]
		mov	di, ax
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F340, [bp+var_6], _SinTable8[bx]
		mov	[bp+@@top], ax
		push	di
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	playfield_fg_x_to_screen
		add	ax, -16
		mov	di, ax
		mov	ax, [bp+@@top]
		sar	ax, 4
		mov	[bp+@@top], ax
		call	sprite16_put pascal, di, ax, [bp+@@sprite_offset]
		inc	si

loc_12095:
		cmp	si, [bp+arg_0]
		jl	short loc_12021
		pop	di
		pop	si
		leave
		retn	2
sub_11FE4	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_120A0	proc near

@@top		= word ptr -4
@@left		= word ptr -2

		enter	4, 0
		push	si
		mov	_sprite16_put_w, (128 / 16)
		mov	_sprite16_put_h, 48
		push	word_1F33E
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	playfield_fg_x_to_screen
		add	ax, -64
		mov	[bp+@@left], ax
		mov	ax, word_1F340
		sar	ax, 4
		add	ax, -32
		mov	[bp+@@top], ax
		mov	si, sprite_1F34C
		cmp	byte_1F34E, 0
		jz	short loc_120E4
		add	si, 10h

loc_120E4:
		call	sprite16_put pascal, [bp+@@left], [bp+@@top], si
		cmp	byte_1F353, 0
		jz	short loc_12100
		mov	al, byte_1F3A0
		mov	ah, 0
		push	ax
		call	sub_11FE4

loc_12100:
		pop	si
		leave
		retn
sub_120A0	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12103	proc near

arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		cmp	_round_frame_mod2, 0
		jz	short loc_12114
		cmp	word_1F3B0, 40h
		jb	short loc_1213C

loc_12114:
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 16
		mov	byte_1F353, 1
		mov	al, byte_1F355
		add	al, 2
		mov	byte_1F355, al
		mov	ax, [bp+arg_0]
		mov	word_1F356, ax
		push	8
		call	sub_11FE4
		mov	byte_1F353, 0

loc_1213C:
		pop	bp
		retn	2
sub_12103	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kotohime_12140	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		cmp	al, byte_1DB9E
		jnz	short loc_1219B
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		jnz	short loc_12166
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_12172
; ---------------------------------------------------------------------------

loc_12166:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_12172:
		cmp	byte_1F34F, 0
		jnz	short loc_1218C
		mov	ax, word_1F3B0
		add	ax, ax
		mov	dx, 0C8h
		sub	dx, ax
		shl	dx, 4
		push	dx
		call	sub_12103
		pop	bp
		retf
; ---------------------------------------------------------------------------

loc_1218C:
		cmp	byte_1F34F, -1
		jz	short loc_12198
		call	sub_120A0
		pop	bp
		retf
; ---------------------------------------------------------------------------

loc_12198:
		call	sub_F58C

loc_1219B:
		pop	bp
		retf
kotohime_12140	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

chiyuri_1219D	proc far

arg_0		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		mov	dx, [bp+arg_0]
		mov	ax, dx
		shl	ax, 5
		add	ax, 1DFEh
		mov	si, ax
		mov	word ptr [si], 900h
		mov	word ptr [si+2], 500h
		mov	word ptr [si+8], 0FFE0h
		mov	word ptr [si+0Ah], 0
		mov	byte ptr [si+12h], 0
		mov	byte ptr [si+10h], 0
		mov	byte ptr [si+11h], 0
		mov	word ptr [si+0Ch], 8Ch
		mov	byte ptr [si+13h], 0
		mov	byte ptr [si+17h], 0
		mov	word ptr [si+18h], 0
		mov	word ptr [si+0Eh], 288h
		or	dx, dx
		jz	short loc_121EC
		add	word ptr [si+0Eh], 28h ; '('

loc_121EC:
		mov	byte ptr [si+15h], 0
		pop	si
		pop	bp
		retf	2
chiyuri_1219D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_121F5	proc near

@@pid_other		= byte ptr -1

		enter	2, 0
		mov	al, byte_1F3A0
		mov	ah, 0
		push	ax
		mov	ax, word_1F3B0
		xor	dx, dx
		pop	bx
		div	bx
		cmp	dx, 1
		jnz	locret_12353
		cmp	word_1F3B0, 1
		jnz	short loc_12282
		mov	byte_23DE4, 0E0h
		mov	byte_23DE5, 0
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	ax, word_1F33E
		add	ax, 0FC80h
		push	ax
		push	word_1F340
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE5B
		mov	ax, word_1F33E
		add	ax, 380h
		push	ax
		push	word_1F340
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE5B
		push	word_1F33E
		mov	ax, word_1F340
		add	ax, 0FC80h
		push	ax
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE5B
		push	word_1F33E
		mov	ax, word_1F340
		add	ax, 380h
		push	ax
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE5B
		jmp	short loc_1229A
; ---------------------------------------------------------------------------

loc_12282:
		cmp	word_1F3B0, 80h
		jb	short loc_1229A
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0
		mov	byte_1F353, 20h	; ' '

loc_1229A:
		mov	byte_23E4E, 1
		mov	byte_23E45, 0
		mov	al, byte_1F39F
		mov	byte_23E42, al
		cmp	byte_23DE5, 0
		jnz	short loc_122CC
		mov	al, byte_23DE4
		add	al, 8
		mov	byte_23DE4, al
		cmp	byte_23DE4, 20h	; ' '
		jnz	short loc_122E5
		mov	byte_23DE5, 1
		mov	byte_23DE4, 24h	; '$'
		jmp	short loc_122E5
; ---------------------------------------------------------------------------

loc_122CC:
		mov	al, byte_23DE4
		add	al, 0F8h
		mov	byte_23DE4, al
		cmp	byte_23DE4, 0E4h
		jnz	short loc_122E5
		mov	byte_23DE5, 0
		mov	byte_23DE4, 0E0h

loc_122E5:
		mov	ax, word_1F33E
		add	ax, 380h
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		mov	al, byte_23DE4
		mov	angle_23E43, al
		call	sub_17730
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		add	ax, 380h
		mov	word_23E40, ax
		mov	al, angle_23E43
		add	al, 40h
		mov	angle_23E43, al
		call	sub_17730
		mov	ax, word_1F33E
		add	ax, 0FC80h
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		mov	al, angle_23E43
		add	al, 40h
		mov	angle_23E43, al
		call	sub_17730
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		add	ax, 0FC80h
		mov	word_23E40, ax
		mov	al, angle_23E43
		add	al, 40h
		mov	angle_23E43, al
		call	sub_17730

locret_12353:
		leave
		retn
sub_121F5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12355	proc near
		push	bp
		mov	bp, sp
		mov	al, byte_1F3A2
		mov	ah, 0
		push	ax
		mov	ax, word_1F3B0
		xor	dx, dx
		pop	bx
		div	bx
		cmp	dx, 1
		jnz	loc_12423
		push	word_1F33E
		push	word_1F340
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	sub_CE5B
		cmp	word_1F3B0, 80h
		jb	short loc_1239D
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0
		mov	byte_1F353, 20h	; ' '

loc_1239D:
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		call	randring_far_next16
		mov	angle_23E43, al
		mov	byte_23E4E, 2
		mov	byte_23E45, 25h ; '%'
		mov	al, byte_1F3A1
		mov	byte_23E42, al
		call	sub_17730
		cmp	byte_1F39E, 8
		jb	short loc_12423
		mov	byte_23E4E, 1
		mov	byte_23E45, 23h ; '#'
		mov	al, byte_1F3A1
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		mov	byte_23E42, al
		mov	ax, word_1F33E
		add	ax, 380h
		mov	word_23E3E, ax
		call	sub_17730
		mov	ax, word_1F33E
		add	ax, 0FC80h
		mov	word_23E3E, ax
		call	sub_17730
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		add	ax, 380h
		mov	word_23E40, ax
		call	sub_17730
		mov	ax, word_1F340
		add	ax, 0FC80h
		mov	word_23E40, ax
		call	sub_17730

loc_12423:
		pop	bp
		retn
sub_12355	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12425	proc near
		push	bp
		mov	bp, sp
		test	byte ptr word_1F3B0, 7
		jnz	short loc_12447
		push	word_1F33E
		push	word_1F340
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	sub_CE5B

loc_12447:
		cmp	word_1F3B0, 30h	; '0'
		jnz	short loc_12496
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		call	randring_far_next16
		mov	angle_23E43, al
		mov	byte_23E4E, 2
		mov	byte_23E45, 26h ; '&'
		mov	byte_23E47, 30h	; '0'
		mov	al, byte_1F3A3
		mov	byte_23E42, al
		mov	byte_23E51, 1
		call	sub_17730
		mov	byte_23E51, 0
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0
		mov	byte_1F353, 20h	; ' '

loc_12496:
		pop	bp
		retn
sub_12425	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12498	proc near

@@pid_other		= byte ptr -1

		enter	2, 0
		push	si
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		cmp	word_1F3B0, 20h	; ' '
		jnz	loc_125B0
		mov	ax, word_1F33E
		add	ax, 0FC80h
		push	ax
		push	word_1F340
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE5B
		mov	ax, word_1F33E
		add	ax, 380h
		push	ax
		push	word_1F340
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE5B
		mov	ax, word_1F340
		mov	word_23E40, ax
		mov	byte_23E45, 0
		mov	byte_23E4E, 1
		mov	al, byte_1F3A4
		mov	byte_23E42, al
		xor	si, si
		jmp	short loc_12546
; ---------------------------------------------------------------------------

loc_124F5:
		mov	ax, si
		imul	ax, 70h
		mov	dl, byte_1F3A5
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		shl	ax, 4
		add	ax, word_1F33E
		add	ax, 0FC80h
		mov	word_23E3E, ax
		mov	ax, si
		shl	ax, 6
		mov	dl, byte_1F3A5
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		mov	dl, 60h
		sub	dl, al
		mov	angle_23E43, dl
		call	sub_17730
		mov	al, 0
		sub	al, angle_23E43
		mov	angle_23E43, al
		call	sub_17730
		mov	al, byte_23E42
		add	al, 2
		mov	byte_23E42, al
		inc	si

loc_12546:
		mov	al, byte_1F3A5
		mov	ah, 0
		cmp	ax, si
		jg	short loc_124F5
		xor	si, si
		jmp	short loc_125A4
; ---------------------------------------------------------------------------

loc_12553:
		mov	ax, si
		imul	ax, 70h
		mov	dl, byte_1F3A5
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		shl	ax, 4
		add	ax, word_1F33E
		add	ax, 0FC80h
		mov	word_23E3E, ax
		mov	ax, si
		shl	ax, 6
		mov	dl, byte_1F3A5
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		mov	dl, 60h
		sub	dl, al
		mov	angle_23E43, dl
		call	sub_17730
		mov	al, 0
		sub	al, angle_23E43
		mov	angle_23E43, al
		call	sub_17730
		mov	al, byte_23E42
		add	al, -2
		mov	byte_23E42, al
		inc	si

loc_125A4:
		mov	al, byte_1F3A5
		mov	ah, 0
		cmp	ax, si
		jg	short loc_12553
		jmp	loc_126A5
; ---------------------------------------------------------------------------

loc_125B0:
		cmp	word_1F3B0, 40h
		jnz	loc_126A5
		push	word_1F33E
		mov	ax, word_1F340
		add	ax, 0FC80h
		push	ax
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE5B
		push	word_1F33E
		mov	ax, word_1F340
		add	ax, 380h
		push	ax
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE5B
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	byte_23E4E, 1
		mov	byte_23E45, 22h ; '"'
		mov	al, byte_1F3A4
		mov	byte_23E42, al
		xor	si, si
		jmp	short loc_1263F
; ---------------------------------------------------------------------------

loc_125FF:
		mov	ax, si
		imul	ax, 70h
		mov	dl, byte_1F3A5
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		shl	ax, 4
		add	ax, word_1F340
		add	ax, 0FC80h
		mov	word_23E40, ax
		mov	ax, si
		shl	ax, 6
		mov	dl, byte_1F3A5
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		add	al, -20h
		mov	angle_23E43, al
		call	sub_17730
		mov	al, byte_23E42
		add	al, 2
		mov	byte_23E42, al
		inc	si

loc_1263F:
		mov	al, byte_1F3A5
		mov	ah, 0
		cmp	ax, si
		jg	short loc_125FF
		xor	si, si
		jmp	short loc_1268C
; ---------------------------------------------------------------------------

loc_1264C:
		mov	ax, si
		imul	ax, 70h
		mov	dl, byte_1F3A5
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		shl	ax, 4
		add	ax, word_1F340
		add	ax, 0FC80h
		mov	word_23E40, ax
		mov	ax, si
		shl	ax, 6
		mov	dl, byte_1F3A5
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		add	al, -20h
		mov	angle_23E43, al
		call	sub_17730
		mov	al, byte_23E42
		add	al, -2
		mov	byte_23E42, al
		inc	si

loc_1268C:
		mov	al, byte_1F3A5
		mov	ah, 0
		cmp	ax, si
		jg	short loc_1264C
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0
		mov	byte_1F353, 20h	; ' '

loc_126A5:
		pop	si
		leave
		retn
sub_12498	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

chiyuri_126A8	proc far

var_4		= word ptr -4
var_2		= byte ptr -2
@@pid_other		= byte ptr -1

		enter	4, 0
		call	sub_F402
		or	al, al
		jz	short loc_12700
		mov	al, byte_1F39E
		add	al, 30h	; '0'
		mov	byte_1F39F, al
		mov	al, byte_1F39E
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		mov	dl, 6
		sub	dl, al
		mov	byte_1F3A0, dl
		mov	al, byte_1F39E
		add	al, 34h	; '4'
		mov	byte_1F3A1, al
		mov	al, 20h	; ' '
		sub	al, byte_1F39E
		mov	byte_1F3A2, al
		mov	al, byte_1F39E
		add	al, al
		add	al, 38h	; '8'
		mov	byte_1F3A3, al
		mov	al, byte_1F39E
		add	al, 10h
		mov	byte_1F3A4, al
		mov	al, byte_1F39E
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, 0Ch
		mov	byte_1F3A5, al

loc_12700:
		mov	al, _pid_current
		cmp	al, byte_1DB9E
		jnz	locret_1290B
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		call	sub_F512
		mov	byte_23E50, 0
		mov	al, [bp+@@pid_other]
		mov	_pid_other, al
		inc	word_1F3B0
		mov	al, byte_1F34F
		mov	ah, 0
		mov	[bp+var_4], ax
		mov	cx, 14h		; switch 20 cases
		mov	bx, offset word_1290E

loc_12734:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_4]
		jz	short loc_12744
		add	bx, 2
		loop	loc_12734
		jmp	loc_12860	; default
; ---------------------------------------------------------------------------

loc_12744:
		jmp	word ptr cs:[bx+28h] ; switch jump

loc_12748:
		cmp	word_1F3B0, 60h ; jumptable 00012744 case 0
		jnz	short loc_12772
		mov	word_1F3B0, 0
		mov	byte_1F34F, 1
		push	(-1 and 255)
		push	word ptr [bp+@@pid_other]
		call	sub_A3D2
		mov	byte_1F355, 10h
		mov	byte_1F353, 10h
		jmp	loc_12860	; default
; ---------------------------------------------------------------------------

loc_12772:
		cmp	word_1F3B0, 50h	; 'P'
		jnz	loc_12859	; jumptable 00012744 case 255
		mov	ax, word_1F33E
		add	ax, 0FC80h
		push	ax
		push	word_1F340
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		mov	ax, word_1F33E
		add	ax, 380h
		push	ax
		push	word_1F340
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		push	word_1F33E
		mov	ax, word_1F340
		add	ax, 0FC80h
		push	ax
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		push	word_1F33E
		mov	ax, word_1F340
		add	ax, 380h
		push	ax
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		jmp	loc_12860	; default
; ---------------------------------------------------------------------------

loc_127D6:
		cmp	byte_1F353, 10h	; jumptable 00012744 case 1
		jnz	short loc_1280B
		push	5
		call	randring_far_next16_mod
		add	al, al
		mov	[bp+var_2], al
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	ax, [bx+8D6h]
		mov	word_1F33E, ax
		mov	al, [bp+var_2]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	ax, [bx+8D8h]
		mov	word_1F340, ax
		mov	byte_1F355, 10h

loc_1280B:
		cmp	word_1F3B0, 30h	; '0'
		jb	short loc_12860	; default
		mov	word_1F3B0, 0
		push	0Fh
		call	randring_far_next16_and
		add	al, 2
		mov	byte_1F34F, al
		inc	byte_1F351
		mov	al, byte_1F351
		cmp	al, byte_1F352
		jbe	short loc_12860	; default
		mov	byte_1F34F, 80h
		jmp	short loc_12860	; default
; ---------------------------------------------------------------------------

loc_12838:
		call	sub_121F5	; jumptable 00012744 cases 2-5
		jmp	short loc_12860	; default
; ---------------------------------------------------------------------------

loc_1283D:
		call	sub_12355	; jumptable 00012744 cases 6-9
		jmp	short loc_12860	; default
; ---------------------------------------------------------------------------

loc_12842:
		call	sub_12425	; jumptable 00012744 cases 10-13
		jmp	short loc_12860	; default
; ---------------------------------------------------------------------------

loc_12847:
		call	sub_12498	; jumptable 00012744 cases 14-17
		jmp	short loc_12860	; default
; ---------------------------------------------------------------------------

loc_1284C:
		call	sub_F3A9	; jumptable 00012744 case 128
		push	word ptr [bp+@@pid_other]
		call	sub_A3A8
		jmp	short loc_12860	; default
; ---------------------------------------------------------------------------

loc_12859:
		mov	byte_23E50, 1	; jumptable 00012744 case 255
		leave
		retf
; ---------------------------------------------------------------------------

loc_12860:
		mov	byte_23E50, 1	; default
		test	byte ptr word_23AF6, 3
		jnz	short loc_12871
		mov	ax, 1
		jmp	short loc_12873
; ---------------------------------------------------------------------------

loc_12871:
		xor	ax, ax

loc_12873:
		add	al, byte_1F354
		mov	byte_1F354, al
		and	byte_1F354, 3
		cmp	byte_1F355, 0
		jz	short loc_128A2
		dec	byte_1F355
		cmp	byte_1F355, 0
		jz	short loc_128A2
		mov	al, byte_1F355
		mov	ah, 0
		shl	ax, 4
		push	ax
		push	word ptr [bp+@@pid_other]
		call	sub_A3D2

loc_128A2:
		cmp	byte_1F353, 0
		jz	short loc_128AD
		dec	byte_1F353

loc_128AD:
		mov	ax, word_1F33E
		mov	word_220EE, ax
		mov	ax, word_1F340
		mov	word_220F0, ax
		mov	word_220F2, 20h	; ' '
		mov	word_220F4, 18h
		mov	al, [bp+@@pid_other]
		mov	byte_220FA, al
		call	sub_13A6E
		mov	byte_20E2C, 1
		mov	word_20E32, 200h
		mov	word_20E34, 200h
		mov	al, [bp+@@pid_other]
		mov	pid_20E3A, al
		mov	ax, word_1F33E
		mov	word_20E2E, ax
		mov	ax, word_1F340
		mov	word_20E30, ax
		call	sub_158F5
		mov	byte_1F34E, al
		mov	ah, 0
		sub	word_1F34A, ax
		mov	byte_20E2C, 0
		nopcall	sub_F4B4

locret_1290B:
		leave
		retf
chiyuri_126A8	endp

; ---------------------------------------------------------------------------
		db 0
word_1290E	dw	0,     1,     2,     3
		dw	4,     5,     6,     7 ; value table for switch	statement
		dw	8,     9,   0Ah,   0Bh
		dw    0Ch,   0Dh,   0Eh,   0Fh
		dw    10h,   11h,   80h,  0FFh
		dw offset loc_12748	; jump table for switch	statement
		dw offset loc_127D6
		dw offset loc_12838
		dw offset loc_12838
		dw offset loc_12838
		dw offset loc_12838
		dw offset loc_1283D
		dw offset loc_1283D
		dw offset loc_1283D
		dw offset loc_1283D
		dw offset loc_12842
		dw offset loc_12842
		dw offset loc_12842
		dw offset loc_12842
		dw offset loc_12847
		dw offset loc_12847
		dw offset loc_12847
		dw offset loc_12847
		dw offset loc_1284C
		dw offset loc_12859

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1295E	proc near

@@angle		= byte ptr -9
var_8		= word ptr -8
@@pid_other		= word ptr -6
@@sprite_offset		= word ptr -4
@@top		= word ptr -2

		enter	0Ah, 0
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		mov	[bp+@@pid_other], dx
		mov	ax, word_1F356
		shl	ax, 4
		mov	[bp+var_8], ax
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 16
		mov	ax, sprite_1F34C
		add	ax, 790h
		mov	[bp+@@sprite_offset], ax
		mov	al, byte_1F354
		mov	ah, 0
		shl	ax, 2
		add	[bp+@@sprite_offset], ax
		xor	si, si
		mov	al, byte_1F355
		jmp	short loc_12A04
; ---------------------------------------------------------------------------

loc_129A0:
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F33E, [bp+var_8], _CosTable8[bx]
		mov	di, ax
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F340, [bp+var_8], _SinTable8[bx]
		mov	[bp+@@top], ax
		call	playfield_fg_x_to_screen pascal, di, [bp+@@pid_other]
		add	ax, -16
		mov	di, ax
		mov	ax, [bp+@@top]
		sar	ax, 4
		mov	[bp+@@top], ax
		call	sprite16_put pascal, di, ax, [bp+@@sprite_offset]
		inc	si
		mov	al, [bp+@@angle]
		add	al, 10h

loc_12A04:
		mov	[bp+@@angle], al
		cmp	si, 10h
		jl	short loc_129A0
		pop	di
		pop	si
		leave
		retn
sub_1295E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12A10	proc near

@@top		= word ptr -2

		enter	2, 0
		push	si
		push	di
		cmp	byte_1F353, 0
		jnz	loc_12AA5
		mov	_sprite16_put_w, (128 / 16)
		mov	_sprite16_put_h, 64
		push	word_1F33E
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	playfield_fg_x_to_screen
		add	ax, -64
		mov	di, ax
		mov	ax, word_1F340
		sar	ax, 4
		add	ax, -48
		mov	[bp+@@top], ax
		mov	si, sprite_1F34C
		call	sprite16_put pascal, di, ax, si
		add	di, 48
		add	[bp+@@top], 32
		cmp	byte_1F34E, 0
		jz	short loc_12A7A
		mov	_sprite16_put_w, (48 / 16)
		mov	_sprite16_put_h, 40
		add	si, 778h
		jmp	short loc_12A99
; ---------------------------------------------------------------------------

loc_12A7A:
		cmp	byte_1F354, 0
		jz	short loc_12AD9
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 24
		mov	al, byte_1F354
		mov	ah, 0
		shl	ax, 2
		add	ax, 0Ch
		add	si, ax

loc_12A99:
		call	sprite16_put pascal, di, [bp+@@top], si
		jmp	short loc_12AD9
; ---------------------------------------------------------------------------

loc_12AA5:
		cmp	byte_1F353, 18h
		jnb	short loc_12AD0
		cmp	byte_1F353, 14h
		jnb	short loc_12AC5
		cmp	byte_1F353, 0Ch
		jb	short loc_12ABE
		push	2
		jmp	short loc_12AD6
; ---------------------------------------------------------------------------

loc_12ABE:
		cmp	byte_1F353, 8
		jb	short loc_12AC9

loc_12AC5:
		push	5
		jmp	short loc_12AD6
; ---------------------------------------------------------------------------

loc_12AC9:
		cmp	byte_1F353, 4
		jb	short loc_12AD4

loc_12AD0:
		push	6
		jmp	short loc_12AD6
; ---------------------------------------------------------------------------

loc_12AD4:
		push	0Fh

loc_12AD6:
		call	sub_12B38

loc_12AD9:
		pop	di
		pop	si
		leave
		retn
sub_12A10	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12ADD	proc near
		push	bp
		mov	bp, sp
		push	si
		cmp	_round_frame_mod2, 0
		jz	short loc_12AEF
		cmp	word_1F3B0, 40h
		jb	short loc_12B35

loc_12AEF:
		mov	si, word_1F3B0
		cmp	si, 20h	; ' '
		jge	short loc_12B02
		mov	ax, si
		shl	ax, 3
		mov	dx, 100h
		jmp	short loc_12B24
; ---------------------------------------------------------------------------

loc_12B02:
		cmp	si, 40h
		jge	short loc_12B1C
		mov	ax, si
		shl	ax, 3
		mov	dx, 200h
		sub	dx, ax
		mov	word_1F356, dx
		mov	al, byte_1F355
		add	al, 0FCh
		jmp	short loc_12B2F
; ---------------------------------------------------------------------------

loc_12B1C:
		mov	ax, si
		shl	ax, 3
		mov	dx, 300h

loc_12B24:
		sub	dx, ax
		mov	word_1F356, dx
		mov	al, byte_1F355
		add	al, 4

loc_12B2F:
		mov	byte_1F355, al
		call	sub_1295E

loc_12B35:
		pop	si
		pop	bp
		retn
sub_12ADD	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12B38	proc near

@@sprite_offset		= word ptr -6
@@top		= word ptr -4
@@left		= word ptr -2
@@col		= word ptr  4

		enter	6, 0
		mov	_sprite16_put_w, (128 / 16)
		mov	_sprite16_put_h, 64
		push	word_1F33E
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	playfield_fg_x_to_screen
		add	ax, -64
		mov	[bp+@@left], ax
		mov	ax, word_1F340
		sar	ax, 4
		add	ax, -48
		mov	[bp+@@top], ax
		mov	ax, sprite_1F34C
		mov	[bp+@@sprite_offset], ax
		mov	ah, SPRITE16_SET_MONO
		mov	dx, 1
		int	SPRITE16
		mov	ah, SPRITE16_SET_COLOR
		mov	dx, [bp+@@col]
		int	SPRITE16
		call	sprite16_put pascal, [bp+@@left], [bp+@@top], [bp+@@sprite_offset]
		mov	ah, SPRITE16_SET_MONO
		xor	dx, dx
		int	SPRITE16
		leave
		retn	2
sub_12B38	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

chiyuri_12B99	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		cmp	al, byte_1DB9E
		jnz	short loc_12BF9
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		jnz	short loc_12BBF
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_12BCB
; ---------------------------------------------------------------------------

loc_12BBF:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_12BCB:
		cmp	byte_1F34F, 0
		jnz	short loc_12BD7
		call	sub_12ADD
		pop	bp
		retf
; ---------------------------------------------------------------------------

loc_12BD7:
		cmp	byte_1F34F, -1
		jz	short loc_12BE3
		call	sub_12A10
		pop	bp
		retf
; ---------------------------------------------------------------------------

loc_12BE3:
		call	sub_F58C
		cmp	byte_1DB9E, -1
		jnz	short loc_12BF9
		mov	al, 1
		sub	al, _pid_current
		push	ax
		call	sub_A3A8

loc_12BF9:
		pop	bp
		retf
chiyuri_12B99	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kana_12BFB	proc far

arg_0		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		mov	dx, [bp+arg_0]
		mov	ax, dx
		shl	ax, 5
		add	ax, 1DFEh
		mov	si, ax
		mov	word ptr [si], 900h
		mov	word ptr [si+2], 500h
		mov	word ptr [si+8], 0FFE0h
		mov	word ptr [si+0Ah], 0
		mov	byte ptr [si+12h], 0
		mov	byte ptr [si+10h], 0
		mov	byte ptr [si+11h], 0
		mov	word ptr [si+0Ch], 64h ; 'd'
		mov	byte ptr [si+13h], 0
		mov	word ptr [si+18h], 0
		mov	word ptr [si+0Eh], 288h
		or	dx, dx
		jz	short loc_12C46
		add	word ptr [si+0Eh], 28h ; '('

loc_12C46:
		mov	byte ptr [si+15h], 0
		pop	si
		pop	bp
		retf	2
kana_12BFB	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12C4F	proc near
		push	bp
		mov	bp, sp
		cmp	word_1F3B0, 1
		jnz	short loc_12C60
		mov	byte_1F353, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_12C60:
		cmp	word_1F3B0, 10h
		jnz	short loc_12C8B
		mov	byte_1F354, 0
		mov	byte_1F353, 2
		push	word_1F33E
		push	word_1F340
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	sub_CE0C
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_12C8B:
		cmp	word_1F3B0, 28h	; '('
		jnz	loc_12D1E
		push	word_1F33E
		push	word_1F340
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	sub_CDBD
		push	word_1F33E
		push	word_1F340
		push	0E0h
		call	sub_19896
		push	word_1F33E
		push	word_1F340
		push	8
		call	sub_19896
		push	word_1F33E
		push	word_1F340
		push	78h ; 'x'
		call	sub_19896
		push	word_1F33E
		push	word_1F340
		push	0A0h
		call	sub_19896
		mov	byte_23E4E, 7
		mov	byte_23E45, 26h ; '&'
		mov	al, byte_1F39F
		mov	byte_23E47, al
		mov	byte_23E46, 80h
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		mov	byte_23E42, 30h ; '0'
		call	sub_17730
		call	snd_se_play pascal, 10
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_12D1E:
		cmp	word_1F3B0, 50h	; 'P'
		jbe	short loc_12D35
		mov	byte_1F353, 0
		mov	word_1F3B0, 0
		mov	byte_1F34F, 1

loc_12D35:
		pop	bp
		retn
sub_12C4F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12D37	proc near

@@pid_other		= byte ptr -1

		enter	2, 0
		push	si
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		cmp	word_1F3B0, 1
		jnz	short loc_12D54
		mov	byte_1F353, 1
		jmp	loc_12E75
; ---------------------------------------------------------------------------

loc_12D54:
		cmp	word_1F3B0, 10h
		jnz	short loc_12D7B
		mov	byte_1F354, 0
		mov	byte_1F353, 2
		push	word_1F33E
		push	word_1F340
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		jmp	loc_12E75
; ---------------------------------------------------------------------------

loc_12D7B:
		cmp	word_1F3B0, 28h	; '('
		jb	loc_12E5E
		cmp	word_1F3B0, 50h	; 'P'
		jnb	loc_12E5E
		mov	byte_23E4E, 2
		mov	byte_23E45, 26h ; '&'
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		cmp	word_1F3B0, 28h	; '('
		jnz	short loc_12DC5
		push	word_1F33E
		push	ax
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CDBD
		mov	byte_23E42, 10h
		mov	al, byte_1F3A0
		jmp	loc_12E4D
; ---------------------------------------------------------------------------

loc_12DC5:
		cmp	word_1F3B0, 40h
		jnz	short loc_12E2B
		push	word_1F33E
		push	word_1F340
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CDBD
		mov	byte_23E42, 28h ; '('
		mov	al, byte_1F3A1
		mov	byte_23E47, al
		call	sub_17730
		call	snd_se_play pascal, 10
		mov	byte_23E4E, 1
		mov	angle_23E43, 20h
		mov	byte_23E42, 10h
		mov	byte_23E45, 22h ; '"'
		xor	si, si
		jmp	short loc_12E24
; ---------------------------------------------------------------------------

loc_12E0E:
		call	sub_17730
		mov	al, angle_23E43
		add	al, 6
		mov	angle_23E43, al
		mov	al, byte_23E42
		add	al, 3
		mov	byte_23E42, al
		inc	si

loc_12E24:
		cmp	si, 10h
		jl	short loc_12E0E
		jmp	short loc_12E75
; ---------------------------------------------------------------------------

loc_12E2B:
		cmp	word_1F3B0, 48h	; 'H'
		jnz	short loc_12E75
		push	word_1F33E
		push	word_1F340
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CDBD
		mov	byte_23E42, 38h ; '8'
		mov	al, byte_1F3A2

loc_12E4D:
		mov	byte_23E47, al
		call	sub_17730
		call	snd_se_play pascal, 10
		jmp	short loc_12E75
; ---------------------------------------------------------------------------

loc_12E5E:
		cmp	word_1F3B0, 60h
		jbe	short loc_12E75
		mov	byte_1F353, 0
		mov	word_1F3B0, 0
		mov	byte_1F34F, 1

loc_12E75:
		pop	si
		leave
		retn
sub_12D37	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12E78	proc near

var_1		= byte ptr -1

		enter	2, 0
		call	sub_F356
		mov	al, byte_1F3A3
		mov	ah, 0
		push	ax
		mov	ax, word_1F3B0
		xor	dx, dx
		pop	bx
		div	bx
		or	dx, dx
		jnz	short loc_12EED
		push	1Fh
		call	randring_far_next16_and
		sub	al, 10h
		mov	[bp+var_1], al
		push	1
		call	randring_far_next16_and
		or	ax, ax
		jz	short loc_12EB0
		mov	al, 80h
		sub	al, [bp+var_1]
		mov	[bp+var_1], al

loc_12EB0:
		push	word_1F33E
		push	word_1F340
		push	word ptr [bp+var_1]
		call	sub_19896
		mov	byte_23E4E, 4
		mov	byte_23E45, 26h ; '&'
		mov	al, byte_1F3A4
		mov	byte_23E47, al
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		mov	byte_23E42, 30h ; '0'
		call	sub_17730
		call	snd_se_play pascal, 10

loc_12EED:
		cmp	word_1F3B0, 64h	; 'd'
		jbe	short locret_12F04
		mov	byte_1F353, 0
		mov	word_1F3B0, 0
		mov	byte_1F34F, 1

locret_12F04:
		leave
		retn
sub_12E78	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_12F06	proc near
		push	bp
		mov	bp, sp
		cmp	word_1F3B0, 1
		jnz	short loc_12F17
		mov	byte_1F353, 1
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_12F17:
		cmp	word_1F3B0, 10h
		jnz	short loc_12F77
		mov	byte_1F354, 0
		mov	byte_1F353, 2
		push	word_1F33E
		push	word_1F340
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	sub_CE0C
		mov	byte_23DE6, -40h
		push	3
		call	randring_far_next16_and
		mov	byte_23DE7, al
		cmp	byte_23DE7, 0
		jnz	short loc_12F5A
		mov	al, -3
		jmp	short loc_12F72
; ---------------------------------------------------------------------------

loc_12F5A:
		cmp	byte_23DE7, 1
		jnz	short loc_12F65
		mov	al, -1
		jmp	short loc_12F72
; ---------------------------------------------------------------------------

loc_12F65:
		cmp	byte_23DE7, 2
		jnz	short loc_12F70
		mov	al, 1
		jmp	short loc_12F72
; ---------------------------------------------------------------------------

loc_12F70:
		mov	al, 3

loc_12F72:
		mov	byte_23DE7, al
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_12F77:
		cmp	word_1F3B0, 20h	; ' '
		jb	short loc_12FCF
		cmp	word_1F3B0, 6Ch	; 'l'
		jnb	short loc_12FCF
		test	byte ptr word_1F3B0, 3
		jnz	short loc_12FBF
		mov	byte_23E4E, 2
		mov	byte_23E45, 26h ; '&'
		mov	byte_23E47, 5
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		mov	al, byte_1F3A5
		mov	byte_23E42, al
		mov	al, byte_23DE6
		mov	angle_23E43, al
		call	sub_17730
		call	snd_se_play pascal, 10

loc_12FBF:
		cmp	word_1F3B0, 40h
		jbe	short loc_12FE6
		mov	al, byte_23DE7
		add	byte_23DE6, al
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_12FCF:
		cmp	word_1F3B0, 70h	; 'p'
		jbe	short loc_12FE6
		mov	byte_1F353, 0
		mov	word_1F3B0, 0
		mov	byte_1F34F, 1

loc_12FE6:
		pop	bp
		retn
sub_12F06	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kana_12FE8	proc far

var_4		= word ptr -4
@@pid_other		= byte ptr -1

		enter	4, 0
		call	sub_F402
		or	al, al
		jz	short loc_1304F
		mov	al, byte_1F39E
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, 10h
		mov	byte_1F39F, al
		mov	al, byte_1F39E
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, 18h
		mov	byte_1F3A0, al
		mov	al, byte_1F39E
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, 10h
		mov	byte_1F3A1, al
		mov	al, byte_1F39E
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, 14h
		mov	byte_1F3A2, al
		mov	al, 20h	; ' '
		sub	al, byte_1F39E
		mov	byte_1F3A3, al
		mov	al, byte_1F39E
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, 18h
		mov	byte_1F3A4, al
		mov	al, byte_1F39E
		add	al, 40h
		mov	byte_1F3A5, al

loc_1304F:
		mov	al, _pid_current
		cmp	al, byte_1DB9E
		jnz	locret_13122	; jumptable 0001308A case 255
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	_pid_other, al
		call	sub_F512
		inc	word_1F3B0
		mov	al, byte_1F34F
		mov	ah, 0
		mov	[bp+var_4], ax
		mov	cx, 14h		; switch 20 cases
		mov	bx, offset word_13124

loc_1307B:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_4]
		jz	short loc_1308A
		add	bx, 2
		loop	loc_1307B
		jmp	short loc_130C0	; default
; ---------------------------------------------------------------------------

loc_1308A:
		jmp	word ptr cs:[bx+28h] ; switch jump

loc_1308E:
		cmp	word_1F3B0, 64h	; 'd' ; jumptable 0001308A case 0
		jnz	locret_13122	; jumptable 0001308A case 255
		mov	word_1F3B0, 0
		mov	byte_1F34F, 1
		jmp	short loc_130C0	; default
; ---------------------------------------------------------------------------

loc_130A4:
		call	sub_F52D	; jumptable 0001308A case 1
		jmp	short loc_130C0	; default
; ---------------------------------------------------------------------------

loc_130A9:
		call	sub_12C4F	; jumptable 0001308A cases 2-4
		jmp	short loc_130C0	; default
; ---------------------------------------------------------------------------

loc_130AE:
		call	sub_12D37	; jumptable 0001308A cases 7-12
		jmp	short loc_130C0	; default
; ---------------------------------------------------------------------------

loc_130B3:
		call	sub_12E78	; jumptable 0001308A cases 13-15
		jmp	short loc_130C0	; default
; ---------------------------------------------------------------------------

loc_130B8:
		call	sub_12F06	; jumptable 0001308A cases 5,6,16,17
		jmp	short loc_130C0	; default
; ---------------------------------------------------------------------------

loc_130BD:
		call	sub_F3A9	; jumptable 0001308A case 128

loc_130C0:
		inc	byte_1F354	; default
		mov	ax, word_1F33E
		mov	word_220EE, ax
		mov	ax, word_1F340
		mov	word_220F0, ax
		mov	word_220F2, 20h	; ' '
		mov	word_220F4, 18h
		mov	al, [bp+@@pid_other]
		mov	byte_220FA, al
		call	sub_13A6E
		mov	byte_20E2C, 1
		mov	word_20E32, 200h
		mov	word_20E34, 200h
		mov	al, [bp+@@pid_other]
		mov	pid_20E3A, al
		mov	ax, word_1F33E
		mov	word_20E2E, ax
		mov	ax, word_1F340
		mov	word_20E30, ax
		call	sub_158F5
		mov	byte_1F34E, al
		mov	ah, 0
		sub	word_1F34A, ax
		mov	byte_20E2C, 0
		nopcall	sub_F4B4

locret_13122:
		leave			; jumptable 0001308A case 255
		retf
kana_12FE8	endp

; ---------------------------------------------------------------------------
word_13124	dw	0,     1,     2,     3
		dw	4,     5,     6,     7 ; value table for switch	statement
		dw	8,     9,   0Ah,   0Bh
		dw    0Ch,   0Dh,   0Eh,   0Fh
		dw    10h,   11h,   80h,  0FFh
		dw offset loc_1308E	; jump table for switch	statement
		dw offset loc_130A4
		dw offset loc_130A9
		dw offset loc_130A9
		dw offset loc_130A9
		dw offset loc_130B8
		dw offset loc_130B8
		dw offset loc_130AE
		dw offset loc_130AE
		dw offset loc_130AE
		dw offset loc_130AE
		dw offset loc_130AE
		dw offset loc_130AE
		dw offset loc_130B3
		dw offset loc_130B3
		dw offset loc_130B3
		dw offset loc_130B8
		dw offset loc_130B8
		dw offset loc_130BD
		dw offset locret_13122

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13174	proc near

@@top		= word ptr -2

		enter	2, 0
		push	si
		push	di
		mov	_sprite16_put_w, (128 / 16)
		mov	_sprite16_put_h, 40
		push	word_1F33E
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	playfield_fg_x_to_screen
		add	ax, -64
		mov	di, ax
		mov	ax, word_1F340
		sar	ax, 4
		add	ax, -24
		mov	[bp+@@top], ax
		mov	si, sprite_1F34C
		cmp	byte_1F34E, 0
		jz	short loc_131B8
		add	si, 10h

loc_131B8:
		call	sprite16_put pascal, di, [bp+@@top], si
		mov	_sprite16_put_w, (64 / 16)
		mov	_sprite16_put_h, 32
		add	di, 32
		cmp	byte_1F353, 1
		jnz	short loc_131E4
		push	di
		push	[bp+@@top]
		mov	ax, sprite_1F34C
		add	ax, 0C80h
		push	ax
		jmp	short loc_1321A
; ---------------------------------------------------------------------------

loc_131E4:
		cmp	byte_1F353, 2
		jnz	short loc_1321F
		mov	ax, sprite_1F34C
		add	ax, 0C80h
		mov	si, ax
		cmp	byte_1F354, 8
		jb	short loc_13215
		cmp	byte_1F354, 10h
		jnb	short loc_13206
		add	si, 8
		jmp	short loc_13215
; ---------------------------------------------------------------------------

loc_13206:
		cmp	byte_1F354, 18h
		jnb	short loc_13212
		add	si, 10h
		jmp	short loc_13215
; ---------------------------------------------------------------------------

loc_13212:
		add	si, 18h

loc_13215:
		push	di
		push	[bp+@@top]
		push	si

loc_1321A:
		call	sprite16_put

loc_1321F:
		pop	di
		pop	si
		leave
		retn
sub_13174	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13223	proc near

@@angle		= byte ptr -7
var_6		= word ptr -6
@@sprite_offset		= word ptr -4
@@top		= word ptr -2

		enter	8, 0
		push	si
		push	di
		mov	ax, word_1F3B0
		add	ax, ax
		shl	ax, 4
		mov	dx, 0C80h
		sub	dx, ax
		mov	[bp+var_6], dx
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 16
		cmp	word_1F3B0, 20h	; ' '
		jnb	short loc_13254
		cmp	_round_frame_mod2, 0
		jnz	loc_132FA

loc_13254:
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 284h
		mov	[bp+@@sprite_offset], ax
		mov	ax, word_1F3B0
		shr	ax, 2
		and	ax, 3
		shl	ax, 5
		imul	ax, 28h
		add	ax, [bp+@@sprite_offset]
		mov	[bp+@@sprite_offset], ax
		mov	al, byte_1F355
		mov	[bp+@@angle], al
		mov	al, 0
		sub	al, [bp+@@angle]
		mov	[bp+@@angle], al
		xor	si, si
		jmp	short loc_132F5
; ---------------------------------------------------------------------------

loc_13286:
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F33E, [bp+var_6], _CosTable8[bx]
		mov	di, ax
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F340, [bp+var_6], _SinTable8[bx]
		mov	[bp+@@top], ax
		push	di
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	playfield_fg_x_to_screen
		add	ax, -16
		mov	di, ax
		mov	ax, [bp+@@top]
		sar	ax, 4
		mov	[bp+@@top], ax
		call	sprite16_put pascal, di, ax, [bp+@@sprite_offset]
		inc	si
		mov	al, [bp+@@angle]
		add	al, 10h
		mov	[bp+@@angle], al

loc_132F5:
		cmp	si, 10h
		jl	short loc_13286

loc_132FA:
		pop	di
		pop	si
		leave
		retn
sub_13223	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kana_132FE	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		cmp	al, byte_1DB9E
		jnz	short loc_1334B
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		jnz	short loc_13324
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_13330
; ---------------------------------------------------------------------------

loc_13324:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_13330:
		cmp	byte_1F34F, 0
		jnz	short loc_1333C
		call	sub_13223
		pop	bp
		retf
; ---------------------------------------------------------------------------

loc_1333C:
		cmp	byte_1F34F, -1
		jz	short loc_13348
		call	sub_13174
		pop	bp
		retf
; ---------------------------------------------------------------------------

loc_13348:
		call	sub_F58C

loc_1334B:
		pop	bp
		retf
kana_132FE	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

rikako_1334D	proc far

arg_0		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		mov	dx, [bp+arg_0]
		mov	ax, dx
		shl	ax, 5
		add	ax, 1DFEh
		mov	si, ax
		mov	word ptr [si], 900h
		mov	word ptr [si+2], 500h
		mov	word ptr [si+8], 0FFE0h
		mov	word ptr [si+0Ah], 0
		mov	byte ptr [si+12h], 0
		mov	byte ptr [si+10h], 0
		mov	byte ptr [si+11h], 0
		mov	word ptr [si+0Ch], 6Eh ; 'n'
		mov	byte ptr [si+13h], 0
		mov	byte ptr [si+1Ah], 4
		mov	word ptr [si+18h], 0
		mov	word ptr [si+0Eh], 286h
		or	dx, dx
		jz	short loc_1339C
		add	word ptr [si+0Eh], 28h ; '('

loc_1339C:
		mov	byte ptr [si+15h], 0
		pop	si
		pop	bp
		retf	2
rikako_1334D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_133A5	proc near

var_2		= byte ptr -2
@@angle		= byte ptr -1

		enter	2, 0
		push	si
		cmp	byte_1F358, 8
		jg	short loc_133BC
		test	byte ptr word_1F3B0, 7
		jnz	short loc_133BC
		inc	byte_1F358

loc_133BC:
		cmp	word_1F3B0, 10h
		jnz	short loc_133DE
		push	word_1F33E
		push	word_1F340
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	sub_CE0C
		jmp	loc_134A7
; ---------------------------------------------------------------------------

loc_133DE:
		cmp	word_1F3B0, 28h	; '('
		jnz	loc_13495
		push	word_1F33E
		push	word_1F340
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	sub_CDBD
		mov	byte_23E4E, 2
		mov	byte_23E45, 16h
		mov	byte_23E42, 1Ch
		push	1
		call	randring_far_next16_and
		or	ax, ax
		jz	short loc_1341D
		mov	al, 30h
		jmp	short loc_1341F
; ---------------------------------------------------------------------------

loc_1341D:
		mov	al, -30h

loc_1341F:
		mov	[bp+var_2], al
		xor	si, si
		jmp	short loc_13483
; ---------------------------------------------------------------------------

loc_13426:
		mov	ax, si
		shl	ax, 8
		mov	dl, byte_1F39F
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		mov	[bp+@@angle], al
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F33E, (48 shl 4), _CosTable8[bx]
		mov	word_23E3E, ax
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F340, (48 shl 4), _SinTable8[bx]
		mov	word_23E40, ax
		mov	al, [bp+@@angle]
		add	al, [bp+var_2]
		mov	angle_23E43, al
		call	sub_17730
		inc	si

loc_13483:
		mov	al, byte_1F39F
		mov	ah, 0
		cmp	ax, si
		jg	short loc_13426
		call	snd_se_play pascal, 5
		jmp	short loc_134A7
; ---------------------------------------------------------------------------

loc_13495:
		cmp	word_1F3B0, 50h	; 'P'
		jbe	short loc_134A7
		mov	word_1F3B0, 0
		mov	byte_1F34F, 1

loc_134A7:
		pop	si
		leave
		retn
sub_133A5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_134AA	proc near

var_1		= byte ptr -1

		enter	2, 0
		push	si
		cmp	byte_1F358, -8
		jl	short loc_134C1
		test	byte ptr word_1F3B0, 7
		jnz	short loc_134C1
		dec	byte_1F358

loc_134C1:
		cmp	word_1F3B0, 10h
		jnz	short loc_134E3
		push	word_1F33E
		push	word_1F340
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	sub_CE5B
		jmp	loc_135A1
; ---------------------------------------------------------------------------

loc_134E3:
		cmp	word_1F3B0, 28h	; '('
		jnz	short loc_1353F
		push	word_1F33E
		push	word_1F340
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	sub_CDBD
		call	randring_far_next16
		mov	[bp+var_1], al
		xor	si, si
		jmp	short loc_13532
; ---------------------------------------------------------------------------

loc_1350E:
		mov	ax, si
		shl	ax, 8
		mov	dl, byte_1F3A0
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		mov	[bp+var_1], al
		push	word_1F33E
		push	word_1F340
		push	word ptr [bp+var_1]
		call	sub_1B006
		inc	si

loc_13532:
		mov	al, byte_1F3A0
		mov	ah, 0
		cmp	ax, si
		jg	short loc_1350E
		push	5
		jmp	short loc_13588
; ---------------------------------------------------------------------------

loc_1353F:
		cmp	word_1F3B0, 40h
		jnz	short loc_1358F
		mov	byte_23E4E, 1
		mov	byte_23E45, 26h ; '&'
		mov	al, byte_1F3A1
		mov	byte_23E47, al
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		mov	byte_23E42, 20h ; ' '
		xor	si, si
		jmp	short loc_13581
; ---------------------------------------------------------------------------

loc_1356B:
		call	randring_far_next16
		mov	angle_23E43, al
		mov	al, byte_23E42
		add	al, 8
		mov	byte_23E42, al
		call	sub_17730
		inc	si

loc_13581:
		cmp	si, 4
		jl	short loc_1356B
		push	10

loc_13588:
		call	snd_se_play
		jmp	short loc_135A1
; ---------------------------------------------------------------------------

loc_1358F:
		cmp	word_1F3B0, 50h	; 'P'
		jbe	short loc_135A1
		mov	word_1F3B0, 0
		mov	byte_1F34F, 1

loc_135A1:
		pop	si
		leave
		retn
sub_134AA	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_135A4	proc near

var_1		= byte ptr -1

		enter	2, 0
		call	sub_F356
		cmp	byte_1F358, 2
		jz	short loc_135CD
		test	byte ptr word_1F3B0, 7
		jnz	short loc_135CD
		cmp	byte_1F358, 2
		jle	short loc_135C4
		mov	al, -1
		jmp	short loc_135C6
; ---------------------------------------------------------------------------

loc_135C4:
		mov	al, 1

loc_135C6:
		add	al, byte_1F358
		mov	byte_1F358, al

loc_135CD:
		mov	al, byte_1F3A2
		mov	ah, 0
		push	ax
		mov	ax, word_1F3B0
		xor	dx, dx
		pop	bx
		div	bx
		mov	[bp+var_1], dl
		cmp	[bp+var_1], 1
		jnz	short loc_135F8
		call	randring_far_next16
		mov	byte_23DE8, al
		push	1
		call	randring_far_next16_and
		inc	al
		mov	byte_23DE9, al

loc_135F8:
		mov	al, byte_23DE9
		mov	byte_23E4E, al
		mov	byte_23E45, 0Eh
		mov	ax, word_1F33E
		mov	word_23E3E, ax
		mov	ax, word_1F340
		mov	word_23E40, ax
		mov	al, byte_23DE8
		mov	angle_23E43, al
		mov	al, byte_1F3A3
		mov	byte_23E42, al
		cmp	[bp+var_1], 1
		jz	short loc_13633
		cmp	[bp+var_1], 5
		jz	short loc_13633
		cmp	[bp+var_1], 9
		jz	short loc_13633
		cmp	[bp+var_1], 0Dh
		jnz	short loc_1364C

loc_13633:
		call	snd_se_play pascal, 10
		call	sub_17730
		mov	al, byte_23DE8
		add	al, 80h
		mov	angle_23E43, al
		call	sub_17730

loc_1364C:
		cmp	word_1F3B0, 80h
		jb	short locret_1365F
		mov	byte_1F34F, 1
		mov	word_1F3B0, 0

locret_1365F:
		leave
		retn
sub_135A4	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

rikako_13661	proc far

var_4		= word ptr -4
@@pid_other		= byte ptr -1

		enter	4, 0
		call	sub_F402
		or	al, al
		jz	short loc_136AB
		mov	al, byte_1F39E
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, 10h
		mov	byte_1F39F, al
		mov	al, byte_1F39E
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		add	al, 8
		mov	byte_1F3A0, al
		mov	al, byte_1F39E
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, 1Ch
		mov	byte_1F3A1, al
		mov	al, 20h	; ' '
		sub	al, byte_1F39E
		mov	byte_1F3A2, al
		mov	al, byte_1F39E
		add	al, 40h
		mov	byte_1F3A3, al

loc_136AB:
		mov	al, _pid_current
		cmp	al, byte_1DB9E
		jnz	locret_1377C	; jumptable 000136E6 case 255
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	_pid_other, al
		call	sub_F512
		inc	word_1F3B0
		mov	al, byte_1F34F
		mov	ah, 0
		mov	[bp+var_4], ax
		mov	cx, 14h		; switch 20 cases
		mov	bx, offset word_1377F

loc_136D7:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_4]
		jz	short loc_136E6
		add	bx, 2
		loop	loc_136D7
		jmp	short loc_13717	; default
; ---------------------------------------------------------------------------

loc_136E6:
		jmp	word ptr cs:[bx+28h] ; switch jump

loc_136EA:
		cmp	word_1F3B0, 64h	; 'd' ; jumptable 000136E6 case 0
		jnz	locret_1377C	; jumptable 000136E6 case 255
		mov	word_1F3B0, 0
		mov	byte_1F34F, 1
		jmp	short loc_13717	; default
; ---------------------------------------------------------------------------

loc_13700:
		call	sub_F52D	; jumptable 000136E6 case 1
		jmp	short loc_13717	; default
; ---------------------------------------------------------------------------

loc_13705:
		call	sub_133A5	; jumptable 000136E6 cases 2-5
		jmp	short loc_13717	; default
; ---------------------------------------------------------------------------

loc_1370A:
		call	sub_134AA	; jumptable 000136E6 cases 7-12
		jmp	short loc_13717	; default
; ---------------------------------------------------------------------------

loc_1370F:
		call	sub_135A4	; jumptable 000136E6 cases 6,13-17
		jmp	short loc_13717	; default
; ---------------------------------------------------------------------------

loc_13714:
		call	sub_F3A9	; jumptable 000136E6 case 128

loc_13717:
		mov	al, byte_1F358	; default
		add	byte_1F354, al
		mov	ax, word_1F33E
		mov	word_220EE, ax
		mov	ax, word_1F340
		mov	word_220F0, ax
		mov	word_220F2, 20h	; ' '
		mov	word_220F4, 18h
		mov	al, [bp+@@pid_other]
		mov	byte_220FA, al
		call	sub_13A6E
		mov	byte_20E2C, 1
		mov	word_20E32, 200h
		mov	word_20E34, 200h
		mov	al, [bp+@@pid_other]
		mov	pid_20E3A, al
		mov	ax, word_1F33E
		mov	word_20E2E, ax
		mov	ax, word_1F340
		mov	word_20E30, ax
		call	sub_158F5
		mov	byte_1F34E, al
		mov	ah, 0
		sub	word_1F34A, ax
		mov	byte_20E2C, 0
		nopcall	sub_F4B4

locret_1377C:
		leave			; jumptable 000136E6 case 255
		retf
rikako_13661	endp

; ---------------------------------------------------------------------------
		db 0
word_1377F	dw	0,     1,     2,     3
		dw	4,     5,     6,     7 ; value table for switch	statement
		dw	8,     9,   0Ah,   0Bh
		dw    0Ch,   0Dh,   0Eh,   0Fh
		dw    10h,   11h,   80h,  0FFh
		dw offset loc_136EA	; jump table for switch	statement
		dw offset loc_13700
		dw offset loc_13705
		dw offset loc_13705
		dw offset loc_13705
		dw offset loc_13705
		dw offset loc_1370F
		dw offset loc_1370A
		dw offset loc_1370A
		dw offset loc_1370A
		dw offset loc_1370A
		dw offset loc_1370A
		dw offset loc_1370A
		dw offset loc_1370F
		dw offset loc_1370F
		dw offset loc_1370F
		dw offset loc_1370F
		dw offset loc_1370F
		dw offset loc_13714
		dw offset locret_1377C

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_137CF	proc near

@@angle		= byte ptr -9
var_8		= word ptr -8
var_6		= word ptr -6
@@top		= word ptr -4
@@left		= word ptr -2

		enter	0Ah, 0
		push	si
		push	di
		mov	_sprite16_put_w, (96 / 16)
		mov	_sprite16_put_h, 48
		push	word_1F33E
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	playfield_fg_x_to_screen
		add	ax, -48
		mov	[bp+@@left], ax
		mov	ax, word_1F340
		sar	ax, 4
		add	ax, -32
		mov	[bp+@@top], ax
		mov	si, sprite_1F34C
		cmp	byte_1F34E, 0
		jz	short loc_13814
		add	si, 0Ch

loc_13814:
		call	sprite16_put pascal, [bp+@@left], [bp+@@top], si
		mov	_sprite16_put_w, (16 / 16)
		mov	_sprite16_put_h, 8
		mov	al, byte_1F354
		mov	[bp+@@angle], al
		add	[bp+@@left], 40
		add	[bp+@@top], 40
		xor	di, di
		jmp	short loc_138AA
; ---------------------------------------------------------------------------

loc_1383D:
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, [bp+@@left], 48, _CosTable8[bx]
		mov	[bp+var_6], ax
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, [bp+@@top], 48, _SinTable8[bx]
		mov	[bp+var_8], ax
		test	di, 3
		jz	short loc_1388B
		mov	ax, di
		and	ax, 3
		add	ax, ax
		add	ax, 167Eh
		mov	si, ax
		jmp	short loc_1388E
; ---------------------------------------------------------------------------

loc_1388B:
		mov	si, 284h

loc_1388E:
		push	[bp+var_6]
		push	[bp+var_8]
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, si
		push	ax
		call	sprite16_put
		inc	di
		mov	al, [bp+@@angle]
		add	al, 20h
		mov	[bp+@@angle], al

loc_138AA:
		cmp	di, 8
		jl	short loc_1383D
		pop	di
		pop	si
		leave
		retn
sub_137CF	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_138B3	proc near

@@angle		= byte ptr -7
var_6		= word ptr -6
@@sprite_offset		= word ptr -4
@@top		= word ptr -2

		enter	8, 0
		push	si
		push	di
		mov	ax, word_1F3B0
		add	ax, ax
		shl	ax, 4
		mov	dx, 0C80h
		sub	dx, ax
		mov	[bp+var_6], dx
		mov	_sprite16_put_w, (48 / 16)
		mov	_sprite16_put_h, 24
		cmp	word_1F3B0, 40h
		jnb	short loc_138E4
		test	byte ptr word_23AF6, 1
		jnz	loc_13987

loc_138E4:
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 780h
		mov	[bp+@@sprite_offset], ax
		test	byte ptr word_1F3B0, 1
		jz	short loc_138FB
		add	[bp+@@sprite_offset], 780h

loc_138FB:
		mov	al, byte ptr word_1F3B0
		shl	al, 2
		mov	[bp+@@angle], al
		mov	al, 0
		sub	al, [bp+@@angle]
		mov	[bp+@@angle], al
		xor	si, si
		jmp	short loc_13982
; ---------------------------------------------------------------------------

loc_13910:
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F33E, [bp+var_6], _CosTable8[bx]
		mov	di, ax
		mov	al, [bp+@@angle]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, word_1F340, [bp+var_6], _SinTable8[bx]
		mov	[bp+@@top], ax
		push	di
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	playfield_fg_x_to_screen
		add	ax, -24
		mov	di, ax
		mov	ax, [bp+@@top]
		sar	ax, 4
		add	ax, -8
		mov	[bp+@@top], ax
		call	sprite16_put pascal, di, ax, [bp+@@sprite_offset]
		inc	si
		mov	al, [bp+@@angle]
		add	al, 10h
		mov	[bp+@@angle], al

loc_13982:
		cmp	si, 10h
		jl	short loc_13910

loc_13987:
		pop	di
		pop	si
		leave
		retn
sub_138B3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

rikako_1398B	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		cmp	al, byte_1DB9E
		jnz	short loc_139D8
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		jnz	short loc_139B1
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_139BD
; ---------------------------------------------------------------------------

loc_139B1:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_139BD:
		cmp	byte_1F34F, 0
		jnz	short loc_139C9
		call	sub_138B3
		pop	bp
		retf
; ---------------------------------------------------------------------------

loc_139C9:
		cmp	byte_1F34F, -1
		jz	short loc_139D5
		call	sub_137CF
		pop	bp
		retf
; ---------------------------------------------------------------------------

loc_139D5:
		call	sub_F58C

loc_139D8:
		pop	bp
		retf
rikako_1398B	endp

main_03_TEXT	ends

; ===========================================================================

; Segment type:	Pure code
main_04_TEXT	segment	byte public 'CODE' use16
		assume cs:main_04_TEXT
		;org 0Ah
		assume es:nothing, ss:nothing, ds:_DATA, fs:nothing, gs:nothing

RANDRING_NEXT_DEF 2, near
RANDRING_NEXT_DEF _far, far

; =============== S U B	R O U T	I N E =======================================


sub_13A6E	proc far
		mov	dx, word_220F0
		or	dx, dx
		js	locret_13B41
		cmp	dx, 1700h
		jge	locret_13B41
		xor	ax, ax
		cmp	byte_220FA, 0
		jz	short loc_13A8C
		mov	ax, 0CF0h

loc_13A8C:
		add	ax, 4BA0h
		mov	word ptr cs:loc_13AFC+2, ax
		sar	dx, 5
		mov	cx, word_220F4
		mov	ax, cx
		shr	ax, 1
		sub	dx, ax
		add	cx, dx
		or	dx, dx
		jns	short loc_13AA8
		xor	dx, dx

loc_13AA8:
		cmp	cx, 0B8h
		jb	short loc_13AB1
		mov	cx, 0B7h

loc_13AB1:
		add	word ptr cs:loc_13AFC+2, dx
		sub	cx, dx
		mov	word ptr cs:loc_13B18+1, cx
		mov	ax, 0B8h
		sub	ax, cx
		mov	word ptr cs:loc_13B2C+2, ax
		mov	ax, word_220EE
		sar	ax, 5
		mov	dx, word_220F2
		mov	bx, dx
		shr	bx, 1
		sub	ax, bx
		or	ax, ax
		jns	short loc_13AE3
		add	dx, ax
		cmp	dx, 0
		jle	short locret_13B41
		xor	ax, ax

loc_13AE3:
		mov	cx, ax
		shr	ax, 3
		and cx, 7
		mov	byte ptr cs:loc_13B04+2, cl
		add	dx, cx
		jmp	short $+2
		mov	cx, ax
		mov	ah, 0B8h
		mul	ah
		mov	bx, ax

loc_13AFC:
		add	bx, 1234h
		mov	ax, cx
		mov	ah, 11111111b

loc_13B04:
		shr	ah, 4
		cmp	dl, 8
		jge	short loc_13B14
		mov	ch, 11111111b
		mov	cl, dl
		shr	ch, cl
		xor	ah, ch

loc_13B14:
		cmp	al, 12h
		jnb	short locret_13B41

loc_13B18:
		mov	cx, 1234h

loc_13B1B:
		or	[bx], ah
		add	bx, 4
		sub	cx, 4
		jg	short loc_13B1B
		sub	dl, 8
		jle	short locret_13B41
		inc	al

loc_13B2C:
		add	cx, 1234h
		add	bx, cx
		mov	ah, 11111111b
		cmp	dl, 8
		jge	short loc_13B14
		mov	cl, dl
		shr	ah, cl
		not	ah
		jmp	short loc_13B14
; ---------------------------------------------------------------------------

locret_13B41:
		retf
sub_13A6E	endp


; =============== S U B	R O U T	I N E =======================================


sub_13B42	proc far
		mov	ax, word_220EE
		mov	dx, word_220F0
		or	ax, ax
		js	short locret_13B98
		cmp	ax, 1200h
		jge	short locret_13B98
		or	dx, dx
		js	short locret_13B98
		cmp	dx, 1700h
		jge	short locret_13B98
		xor	bx, bx
		cmp	byte_220FA, 0
		jz	short loc_13B68
		mov	bx, 0CF0h

loc_13B68:
		add	bx, 4BA0h
		sar	ax, 5
		sar	dx, 5
		mov	cx, ax
		sar	ax, 3
		and	cx, 7
		add	bx, dx
		mov	ah, 0B8h
		mul	ah
		add	bx, ax
		mov	ax, 0B8h
		sub	ax, dx
		mov	dx, ax
		mov	ah, 80h
		shr	ah, cl
		mov	cx, word_220F4
		nop

loc_13B92:
		or	[bx], ah
		inc	bx
		dec	dx
		loopne	loc_13B92

locret_13B98:
		retf
sub_13B42	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================


sub_13B9A	proc far
		push	si
		push	di
		mov	bx, 0B7h
		cmp	byte_220FA, 0
		jz	short loc_13BAA
		add	bx, 0CF0h

loc_13BAA:
		add	bx, 4BA0h
		mov	word ptr cs:loc_13BE9+1, bx
		mov	al, 11111111b
		mov	cx, word_220F2
		shr	al, cl
		not	al
		xor	ah, ah
		mov	word ptr cs:loc_13BEE+1, ax
		mov	ax, word_220F6
		sub	ax, word_220EE
		mov	word ptr cs:loc_13C02+1, ax
		jmp	short $+2
		mov	si, word_220F6
		mov	di, 5Bh	; '['
		nop

loc_13BD8:
		mov	ax, si
		shr	ax, 5
		mov	cx, ax
		and	cx, 7
		shr	ax, 3
		mov	ah, 0B8h
		mul	ah

loc_13BE9:
		mov	bx, 1234h
		add	bx, ax

loc_13BEE:
		mov	ax, 1234h
		ror	ax, cl
		or	[bx], al
		or	ah, ah
		jz	short loc_13BFF
		add	bx, 0B8h
		or	[bx], ah

loc_13BFF:
		dec	di
		jz	short loc_13C1A

loc_13C02:
		mov	ax, 1234h
		imul	di
		mov	cx, 5Ch
		idiv	cx
		mov	si, word_220EE
		add	si, ax
		sub	word ptr cs:loc_13BE9+1, 2
		jmp	short loc_13BD8
; ---------------------------------------------------------------------------

loc_13C1A:
		pop	di
		pop	si
		retf
sub_13B9A	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13C1E	proc near

arg_0		= word ptr  4
arg_2		= word ptr  6
arg_4		= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		mov	ax, [bp+arg_4]
		shl	ax, 4
		mov	si, ax
		mov	al, byte ptr [bp+arg_4]
		mov	byte_1F51C, al
		mov	byte_1F51D, 0
		jmp	short loc_13C52
; ---------------------------------------------------------------------------

loc_13C37:
		mov	bx, si
		add	bx, bx
		mov	es, word_1F554
		push	word ptr es:[bx]
		push	[bp+arg_2]
		push	[bp+arg_0]
		nopcall	sub_15EDB
		inc	byte_1F51D
		inc	si

loc_13C52:
		mov	bx, [bp+arg_4]
		mov	al, [bx+1FC4h]
		cmp	al, byte_1F51D
		ja	short loc_13C37
		pop	si
		pop	bp
		retn	6
sub_13C1E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13C64	proc near

var_1		= byte ptr -1
arg_0		= word ptr  4

		enter	2, 0
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+4AD6h], 0
		jnz	short locret_13CC3
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+1FFAh]
		mov	[bp+var_1], al
		mov	al, byte_23AF8
		mov	ah, 0
		mov	bx, 20h	; ' '
		cwd
		idiv	bx
		mov	byte_1F520, al
		mov	al, [bp+var_1]
		mov	ah, 0
		mov	es, word_1F556
		mov	bx, ax
		mov	al, es:[bx]
		mov	ah, 0
		push	ax
		push	[bp+arg_0]
		mov	al, [bp+var_1]
		mov	ah, 0
		mov	es, word_1F558
		mov	bx, ax
		mov	al, es:[bx]
		push	ax
		call	sub_13C1E
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+1FFAh]

locret_13CC3:
		leave
		retn	2
sub_13C64	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13CC7	proc far
		push	bp
		mov	bp, sp
		cmp	byte_207E2, 0
		jnz	short loc_13CDB
		push	0
		call	sub_13C64
		push	1
		call	sub_13C64

loc_13CDB:
		pop	bp
		retf
sub_13CC7	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13CDD	proc far

var_A		= word ptr -0Ah
var_8		= word ptr -8
var_6		= word ptr -6
var_4		= word ptr -4

		enter	0Ah, 0
		push	si
		push	di
		push	ds
		push	offset aEnedat_dat ; "ENEDAT.DAT"
		call	file_ropen
		push	ss
		lea	ax, [bp+var_4]
		push	ax
		push	4
		call	file_read
		push	[bp+var_4]
		call	hmem_allocbyte
		mov	word_1F51E, ax
		push	300h
		call	hmem_allocbyte
		mov	word_1F554, ax
		push	100h
		call	hmem_allocbyte
		mov	word_1F556, ax
		push	100h
		call	hmem_allocbyte
		mov	word_1F558, ax
		mov	ax, word_1F51E
		mov	word_1F522, ax
		push	ax
		push	0
		push	[bp+var_4]
		call	file_read
		call	file_close
		xor	si, si
		mov	[bp+var_A], 0

loc_13D41:
		mov	es, word_1F522
		mov	ax, es:[si]
		mov	[bp+var_6], ax
		cmp	[bp+var_6], 0
		jz	short loc_13D92
		mov	bx, [bp+var_A]
		mov	al, byte ptr [bp+var_6]
		mov	[bx+1FC4h], al
		add	si, 2
		xor	di, di
		jmp	short loc_13D88
; ---------------------------------------------------------------------------

loc_13D62:
		mov	es, word_1F522
		mov	al, es:[si]
		mov	ah, 0
		mov	[bp+var_8], ax
		inc	si
		mov	bx, [bp+var_A]
		shl	bx, 4
		add	bx, bx
		mov	es, word_1F554
		mov	ax, di
		add	ax, ax
		add	bx, ax
		mov	es:[bx], si
		add	si, [bp+var_8]
		inc	di

loc_13D88:
		cmp	di, [bp+var_6]
		jl	short loc_13D62
		inc	[bp+var_A]
		jmp	short loc_13D41
; ---------------------------------------------------------------------------

loc_13D92:
		mov	al, byte ptr [bp+var_A]
		mov	byte_1F55C, al
		pop	di
		pop	si
		leave
		retf
sub_13CDD	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13D9C	proc far

var_2		= byte ptr -2
var_1		= byte ptr -1

		enter	2, 0
		push	si
		xor	si, si
		jmp	short loc_13DDC
; ---------------------------------------------------------------------------

loc_13DA5:
		call	IRand
		mov	dl, byte_1F55C
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		mov	[bp+var_1], dl
		mov	al, [bp+var_1]
		cmp	al, [bp+var_2]
		jz	short loc_13DA5
		mov	es, word_1F556
		mov	es:[si], al
		mov	[bp+var_2], al
		call	IRand
		and	al, 1
		shl	al, 7
		mov	es, word_1F558
		mov	es:[si], al
		inc	si

loc_13DDC:
		cmp	si, 100h
		jl	short loc_13DA5
		mov	byte_1F55A, 0
		mov	byte_1F55B, 0
		mov	byte_22036, 0
		mov	byte_22037, 0
		pop	si
		leave
		retf
sub_13D9C	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13DF9	proc far
		push	bp
		mov	bp, sp
		push	word_1F522
		call	hmem_free
		push	word_1F554
		call	hmem_free
		push	word_1F556
		call	hmem_free
		push	word_1F558
		call	hmem_free
		pop	bp
		retf
sub_13DF9	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13E22	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	si, word_2203C
		mov	cx, [si+10h]
		mov	al, byte_1F520
		mov	ah, 0
		imul	cx
		mov	bx, 9
		cwd
		idiv	bx
		push	ax
		mov	ax, cx
		add	ax, ax
		mov	bx, 3
		cwd
		idiv	bx
		pop	dx
		add	dx, ax
		mov	cx, dx
		test	byte ptr [si+21h], 80h
		jz	short loc_13E55
		add	[si+2],	cx
		jmp	short loc_13E58
; ---------------------------------------------------------------------------

loc_13E55:
		sub	[si+2],	cx

loc_13E58:
		test	byte ptr [si+21h], 1
		jz	short loc_13E6C
		cmp	word ptr [si+2], 0FE00h
		jle	short loc_13EA0
		cmp	word ptr [si+2], 1400h
		jge	short loc_13EA0

loc_13E6C:
		mov	cx, [si+12h]
		mov	al, byte_1F520
		mov	ah, 0
		imul	cx
		mov	bx, 9
		cwd
		idiv	bx
		push	ax
		mov	ax, cx
		add	ax, ax
		mov	bx, 3
		cwd
		idiv	bx
		pop	dx
		add	dx, ax
		mov	cx, dx
		add	[si+4],	cx
		test	byte ptr [si+21h], 2
		jz	short loc_13E9C
		cmp	word ptr [si+4], 1900h
		jge	short loc_13EA0

loc_13E9C:
		mov	al, 0
		jmp	short loc_13EA5
; ---------------------------------------------------------------------------

loc_13EA0:
		mov	byte ptr [si], 0
		mov	al, 1

loc_13EA5:
		pop	si
		pop	bp
		retn
sub_13E22	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13EA8	proc near
		push	bp
		mov	bp, sp
		push	es
		push	ds
		mov	ax, word_2203C
		add	ax, 10h
		push	ax
		push	ds
		mov	ax, word_2203C
		add	ax, 12h
		push	ax
		mov	bx, word_2203C
		push	word ptr [bx+19h]
		mov	al, [bx+1Fh]
		mov	ah, 0
		push	ax
		call	vector2
		pop	es
		pop	bp
		retn
sub_13EA8	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13ED1	proc near
		push	bp
		mov	bp, sp
		mov	bx, word_2203C
		mov	al, [bx+1Ah]
		cbw
		shl	ax, 9
		mov	bx, 3
		cwd
		idiv	bx
		mov	cx, ax
		mov	al, byte_1F520
		mov	ah, 0
		imul	cx
		mov	bx, 9
		cwd
		idiv	bx
		add	cx, ax
		mov	bx, word_2203C
		add	[bx+18h], cx
		pop	bp
		retn
sub_13ED1	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13EFF	proc near

arg_0		= byte ptr  4

		push	bp
		mov	bp, sp
		mov	cl, [bp+arg_0]
		mov	al, cl
		mov	ah, 0
		mov	bx, ax
		mov	al, byte_23AF8
		mov	ah, 0
		imul	bx
		mov	bx, ax
		sar	bx, 7
		mov	al, cl
		mov	ah, 0
		add	bx, ax
		cmp	bx, 80h
		jl	short loc_13F26
		mov	bx, 7Fh

loc_13F26:
		mov	al, bl
		pop	bp
		retn	2
sub_13EFF	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_13F2C	proc near

var_E		= word ptr -0Eh
var_B		= byte ptr -0Bh
var_A		= byte ptr -0Ah
var_9		= byte ptr -9
var_8		= byte ptr -8
var_7		= byte ptr -7
var_6		= word ptr -6
@@player		= word ptr -4
var_2		= word ptr -2

		enter	0Eh, 0
		push	si
		push	di
		mov	di, word_2203C
		mov	al, [di+8]
		mov	[bp+var_B], al
		mov	ah, 0
		shl	ax, 7
		add	ax, offset _players
		mov	[bp+@@player], ax
		mov	es, word_1F51E
		mov	ax, [di+0Eh]
		mov	[bp+var_6], ax
		mov	ax, [di+0Ah]

loc_13F54:
		add	[bp+var_6], ax
		mov	bx, [bp+var_6]
		mov	al, es:[bx]
		mov	ah, 0
		mov	[bp+var_E], ax
		mov	cx, 10h		; switch 16 cases
		mov	bx, offset word_14290

loc_13F68:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_E]
		jz	short loc_13F78
		add	bx, 2
		loop	loc_13F68
		jmp	loc_1423E	; default
; ---------------------------------------------------------------------------

loc_13F78:
		jmp	word ptr cs:[bx+20h] ; switch jump

loc_13F7C:
		cmp	word ptr [di+0Ch], 0 ; jumptable 00013F78 cases	1,8,9
		jnz	short loc_13F9A
		mov	bx, [bp+var_6]
		mov	al, es:[bx+2]
		mov	[di+1Fh], al
		mov	al, es:[bx+1]
		mov	[di+19h], al
		mov	byte ptr [di+18h], 0
		call	sub_13EA8

loc_13F9A:
		call	sub_13E22
		or	al, al
		jnz	loc_14136	; jumptable 00013F78 case 0
		mov	bx, [bp+var_6]
		mov	al, es:[bx+3]
		mov	[bp+var_8], al
		mov	[bp+var_7], 4
		cmp	byte ptr es:[bx], 8
		jnz	short loc_13FD6
		mov	bx, [bp+@@player]
		mov	ax, [bx+player_t.center.y]
		add	ax, (-32 shl 4)
		cmp	[di+4],	ax
		jl	loc_1423E	; default
		mov	ax, [bx+player_t.center.y]
		add	ax, (32 shl 4)
		cmp	[di+4],	ax
		jg	loc_1423E	; default
		jmp	short loc_13FFC
; ---------------------------------------------------------------------------

loc_13FD6:
		mov	bx, [bp+var_6]
		cmp	byte ptr es:[bx], 9
		jnz	loc_1423E	; default
		mov	bx, [bp+@@player]
		mov	ax, [bx+player_t.center.x]
		add	ax, (-16 shl 4)
		cmp	[di+2],	ax
		jl	loc_1423E	; default
		mov	ax, [bx+player_t.center.x]
		add	ax, (16 shl 4)
		cmp	[di+2],	ax
		jg	loc_1423E	; default

loc_13FFC:
		mov	word ptr [di+0Ch], 0
		jmp	loc_14284
; ---------------------------------------------------------------------------

loc_14004:
		call	sub_13E22	; jumptable 00013F78 case 6
		or	al, al
		jnz	loc_14136	; jumptable 00013F78 case 0
		jmp	loc_140A8	; jumptable 00013F78 case 3
; ---------------------------------------------------------------------------

loc_14010:
		cmp	word ptr [di+0Ch], 0 ; jumptable 00013F78 case 7
		jnz	short loc_14023
		mov	bx, [bp+var_6]
		mov	al, es:[bx+1]
		mov	[di+1Fh], al
		call	sub_13EA8

loc_14023:
		call	sub_13E22
		or	al, al
		jnz	loc_14136	; jumptable 00013F78 case 0
		mov	bx, [bp+var_6]
		mov	al, es:[bx+2]
		mov	[bp+var_8], al
		mov	[bp+var_7], 3
		jmp	loc_1423E	; default
; ---------------------------------------------------------------------------

loc_1403D:
		cmp	word ptr [di+0Ch], 0 ; jumptable 00013F78 cases	2,10
		jnz	short loc_14058
		mov	bx, [bp+var_6]
		mov	al, es:[bx+1]
		mov	[di+19h], al
		mov	byte ptr [di+18h], 0
		mov	al, es:[bx+3]
		mov	[di+1Ah], al

loc_14058:
		mov	bx, [bp+var_6]
		mov	al, es:[bx+2]
		mov	[di+1Fh], al
		call	sub_13EA8
		mov	bx, [bp+var_6]
		cmp	byte ptr es:[bx], 0Ah
		jnz	short loc_1408B
		mov	al, es:[bx+4]
		cbw
		add	[di+10h], ax
		mov	al, es:[bx+5]
		cbw
		add	[di+12h], ax
		mov	al, es:[bx+6]
		mov	[bp+var_8], al
		mov	[bp+var_7], 7
		jmp	short loc_14099
; ---------------------------------------------------------------------------

loc_1408B:
		mov	bx, [bp+var_6]
		mov	al, es:[bx+4]
		mov	[bp+var_8], al
		mov	[bp+var_7], 5

loc_14099:
		call	sub_13E22
		or	al, al
		jnz	loc_14136	; jumptable 00013F78 case 0
		call	sub_13ED1
		jmp	loc_1423E	; default
; ---------------------------------------------------------------------------

loc_140A8:
		mov	bx, [bp+var_6]	; jumptable 00013F78 case 3
		mov	al, es:[bx+1]
		mov	[bp+var_8], al
		mov	[bp+var_7], 2
		jmp	loc_1423E	; default
; ---------------------------------------------------------------------------

loc_140B9:
		cmp	word ptr [di+0Ch], 0 ; jumptable 00013F78 cases	4,5
		jnz	short loc_140CE
		mov	word ptr [di+18h], 0
		mov	bx, [bp+var_6]
		mov	al, es:[bx+2]
		mov	[di+1Ah], al

loc_140CE:
		mov	bx, [bp+var_6]
		mov	al, es:[bx+1]
		mov	[bp+var_9], al
		movzx	eax, [bp+var_9]
		mov	dl, [di+19h]
		mov	dh, 0
		add	dx, dx
		mov	bx, dx
		movsx	edx, _CosTable8[bx]
		imul	eax, edx
		sar	eax, 8
		mov	[di+10h], ax
		mov	bx, [bp+var_6]
		mov	al, es:[bx+3]
		cbw
		mov	[di+12h], ax
		cmp	byte ptr es:[bx], 5
		jnz	short loc_1411B
		mov	al, [di+10h]
		mov	[bp+var_A], al
		mov	ax, [di+12h]
		mov	[di+10h], ax
		mov	al, [bp+var_A]
		cbw
		mov	[di+12h], ax

loc_1411B:
		call	sub_13E22
		or	al, al
		jnz	short loc_14136	; jumptable 00013F78 case 0
		call	sub_13ED1
		mov	bx, [bp+var_6]
		mov	al, es:[bx+4]
		mov	[bp+var_8], al
		mov	[bp+var_7], 5
		jmp	loc_1423E	; default
; ---------------------------------------------------------------------------

loc_14136:
		mov	byte ptr [di], 0 ; jumptable 00013F78 case 0
		mov	al, 1
		jmp	loc_1428B
; ---------------------------------------------------------------------------

loc_1413E:
		mov	byte ptr [di], 1 ; jumptable 00013F78 case 16
		mov	bx, [bp+var_6]
		mov	al, es:[bx+1]
		cbw
		mov	[bp+var_2], ax
		test	byte ptr [di+21h], 80h
		jz	short loc_1415A
		shl	ax, 7
		mov	[di+2],	ax
		jmp	short loc_14168
; ---------------------------------------------------------------------------

loc_1415A:
		mov	ax, [bp+var_2]
		shl	ax, 7
		mov	dx, 1200h
		sub	dx, ax
		mov	[di+2],	dx

loc_14168:
		mov	bx, [bp+var_6]
		mov	al, es:[bx+2]
		cbw
		mov	[bp+var_2], ax
		shl	ax, 7
		mov	[di+4],	ax
		mov	al, byte_1F520
		mov	ah, 0
		add	ax, [bp+var_6]
		mov	bx, ax
		mov	al, es:[bx+3]

loc_14187:
		mov	[di+6],	al
		mov	al, [di+6]
		shl	al, 4
		mov	[di+9],	al
		mov	al, byte_1F520
		mov	ah, 0
		add	ax, [bp+var_6]
		mov	bx, ax
		mov	al, es:[bx+7]
		mov	[di+7],	al
		mov	bx, [bp+var_6]
		cmp	byte ptr es:[bx+0Bh], 0
		jz	short loc_141B3
		mov	ax, 1
		jmp	short loc_141B5
; ---------------------------------------------------------------------------

loc_141B3:
		xor	ax, ax

loc_141B5:
		or	[di+21h], al
		mov	bx, [bp+var_6]
		cmp	byte ptr es:[bx+0Ch], 0
		jz	short loc_141C7
		mov	ax, 1
		jmp	short loc_141C9
; ---------------------------------------------------------------------------

loc_141C7:
		xor	ax, ax

loc_141C9:
		add	al, al
		or	[di+21h], al
		mov	[bp+var_7], 0Eh
		jmp	loc_14284
; ---------------------------------------------------------------------------

loc_141D5:
		or	byte ptr [di+21h], 1 ; jumptable 00013F78 case 130
		jmp	short loc_141DF
; ---------------------------------------------------------------------------

loc_141DB:
		or	byte ptr [di+21h], 2 ; jumptable 00013F78 case 131

loc_141DF:
		mov	[bp+var_7], 1
		jmp	loc_14284
; ---------------------------------------------------------------------------

loc_141E6:
		mov	al, [di+20h]	; jumptable 00013F78 case 128
		mov	ah, 0
		mov	bx, [bp+var_6]
		push	ax
		mov	al, es:[bx+2]
		cbw
		pop	dx
		cmp	dx, ax
		jl	short loc_141FB
		jmp	short loc_1421E
; ---------------------------------------------------------------------------

loc_141FB:
		inc	byte ptr [di+20h]
		mov	bx, [bp+var_6]
		mov	al, es:[bx+1]
		cbw
		mov	[di+0Ah], ax
		jmp	short loc_14236
; ---------------------------------------------------------------------------

loc_1420B:
		mov	al, [di+20h]	; jumptable 00013F78 case 129
		mov	ah, 0
		mov	bx, [bp+var_6]
		push	ax
		mov	al, es:[bx+2]
		cbw
		pop	dx
		cmp	dx, ax
		jl	short loc_14228

loc_1421E:
		mov	byte ptr [di+20h], 0
		mov	[bp+var_7], 3
		jmp	short loc_14284
; ---------------------------------------------------------------------------

loc_14228:
		inc	byte ptr [di+20h]
		mov	bx, [bp+var_6]
		mov	al, es:[bx+1]
		cbw

loc_14233:
		add	[di+0Ah], ax

loc_14236:
		mov	al, [bp+var_7]
		mov	ah, 0
		jmp	loc_13F54
; ---------------------------------------------------------------------------

loc_1423E:
		mov	al, [bp+var_8]	; default
		mov	ah, 0
		mov	[bp+var_2], ax
		cwd
		sub	ax, dx
		sar	ax, 1
		imul	ax, 3
		mov	dl, byte_1F520
		mov	dh, 0
		push	ax
		mov	ax, dx
		imul	[bp+var_2]
		mov	bx, 6
		cwd
		idiv	bx
		pop	dx
		sub	dx, ax
		mov	[bp+var_2], dx
		mov	ax, [di+0Ch]
		cmp	ax, [bp+var_2]
		jb	short loc_1427D
		mov	word ptr [di+0Ch], 0
		mov	al, [bp+var_7]
		mov	ah, 0
		add	[di+0Ah], ax
		jmp	short loc_14280
; ---------------------------------------------------------------------------

loc_1427D:
		inc	word ptr [di+0Ch]

loc_14280:
		mov	al, 0
		jmp	short loc_1428B
; ---------------------------------------------------------------------------

loc_14284:
		mov	al, [bp+var_7]
		mov	ah, 0
		jmp	short loc_14233
; ---------------------------------------------------------------------------

loc_1428B:
		pop	di
		pop	si
		leave
		retn
sub_13F2C	endp

; ---------------------------------------------------------------------------
		db 0
word_14290	dw	0,     1,     2,     3
		dw	4,     5,     6,     7 ; value table for switch	statement
		dw	8,     9,   0Ah,   10h
		dw    80h,   81h,   82h,   83h
		dw offset loc_14136	; jump table for switch	statement
		dw offset loc_13F7C
		dw offset loc_1403D
		dw offset loc_140A8
		dw offset loc_140B9
		dw offset loc_140B9
		dw offset loc_14004
		dw offset loc_14010
		dw offset loc_13F7C
		dw offset loc_13F7C
		dw offset loc_1403D
		dw offset loc_1413E
		dw offset loc_141E6
		dw offset loc_1420B
		dw offset loc_141D5
		dw offset loc_141DB

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_142D0	proc far
		push	bp
		mov	bp, sp
		mov	byte_1FDEA, 0
		mov	byte_1FE1C, 0
		pop	bp
		retf
sub_142D0	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_ADD_MARISA
chargeshot_add_marisa	proc far

@@center_y	= word ptr  6
@@center_x	= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		imul	ax, 32h
		add	ax, 288Ah
		mov	word_1FE4E, ax
		mov	bx, word_1FE4E
		mov	byte ptr [bx], 1
		mov	byte ptr [bx+1], 0
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	_players[bx].shot_active, SA_DISABLED
		xor	si, si
		jmp	short loc_1432F
; ---------------------------------------------------------------------------

loc_1430F:
		mov	bx, si
		add	bx, bx
		add	bx, word_1FE4E
		mov	ax, [bp+@@center_x]
		mov	[bx+2],	ax
		mov	bx, si
		add	bx, bx
		add	bx, word_1FE4E
		mov	ax, [bp+@@center_y]
		add	ax, 0FF00h
		mov	[bx+1Ah], ax
		inc	si

loc_1432F:
		cmp	si, 0Ch
		jl	short loc_1430F
		call	snd_se_play pascal, 6
		pop	si
		pop	bp
		retf	4
chargeshot_add_marisa	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_14340	proc far
		push	bp
		mov	bp, sp
		push	si
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		imul	ax, 32h
		add	ax, 288Ah
		mov	word_1FE4E, ax
		mov	bx, word_1FE4E
		cmp	byte ptr [bx], 0
		jnz	short loc_143A4
		mov	byte ptr [bx], 1
		xor	si, si
		jmp	short loc_14398
; ---------------------------------------------------------------------------

loc_14362:
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	ax, _players[bx].center.x
		mov	bx, si
		add	bx, bx
		add	bx, word_1FE4E
		mov	[bx+2],	ax
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	ax, _players[bx].center.y
		add	ax, (-16 shl 4)
		mov	bx, si
		add	bx, bx
		add	bx, word_1FE4E
		mov	[bx+1Ah], ax
		inc	si

loc_14398:
		cmp	si, 0Ch
		jl	short loc_14362
		call	snd_se_play pascal, 6

loc_143A4:
		mov	bx, word_1FE4E
		mov	byte ptr [bx+1], 10h
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	_players[bx].shot_active, SA_DISABLED
		pop	si
		pop	bp
		retf
sub_14340	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_UPDATE_MARISA
chargeshot_update_marisa	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 32h
		add	ax, 288Ah
		mov	word_1FE4E, ax
		mov	bx, word_1FE4E
		cmp	byte ptr [bx], 0
		jz	loc_14485
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	_players[bx].gauge_charged, 0
		mov	bx, word_1FE4E
		inc	byte ptr [bx+1]
		mov	dx, 0Bh
		jmp	short loc_14428
; ---------------------------------------------------------------------------

loc_143F6:
		mov	bx, dx
		dec	bx
		add	bx, bx
		add	bx, word_1FE4E
		mov	ax, [bx+2]
		mov	bx, dx
		add	bx, bx
		add	bx, word_1FE4E
		mov	[bx+2],	ax
		mov	bx, dx
		dec	bx
		add	bx, bx
		add	bx, word_1FE4E
		mov	ax, [bx+1Ah]
		add	ax, 18h
		mov	bx, dx
		add	bx, bx
		add	bx, word_1FE4E
		mov	[bx+1Ah], ax
		dec	dx

loc_14428:
		or	dx, dx
		jg	short loc_143F6
		mov	bx, word_1FE4E
		cmp	byte ptr [bx+1], 18h
		jnb	short loc_14465
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	ax, _players[bx].center.x
		mov	bx, word_1FE4E
		mov	[bx+2],	ax
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	ax, _players[bx].center.y
		add	ax, (-16 shl 4)
		mov	bx, word_1FE4E
		mov	[bx+1Ah], ax
		pop	bp
		retf
; ---------------------------------------------------------------------------

loc_14465:
		mov	bx, word_1FE4E
		cmp	byte ptr [bx+1], 24h ; '$'
		jbe	short loc_14485
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	_players[bx].shot_active, SA_ENABLED
		mov	bx, word_1FE4E
		mov	byte ptr [bx], 0

loc_14485:
		pop	bp
		retf
chargeshot_update_marisa	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

marisa_14487	proc far

var_1		= byte ptr -1

		enter	2, 0
		push	si
		mov	al, pid_20E3A
		mov	ah, 0
		imul	ax, 32h
		add	ax, 288Ah
		mov	word_1FE4E, ax
		mov	bx, word_1FE4E
		cmp	byte ptr [bx], 0
		jnz	short loc_144A7
		mov	al, 0
		jmp	short loc_1450E
; ---------------------------------------------------------------------------

loc_144A7:
		mov	[bp+var_1], 0
		xor	si, si
		jmp	short loc_14506
; ---------------------------------------------------------------------------

loc_144AF:
		mov	bx, si
		add	bx, bx
		add	bx, word_1FE4E
		mov	ax, [bx+2]
		cmp	ax, word_20E2E
		jl	short loc_14503
		mov	bx, si
		add	bx, bx
		add	bx, word_1FE4E
		cmp	ax, word_20E36
		jg	short loc_14503
		mov	bx, si
		add	bx, bx
		add	bx, word_1FE4E
		mov	ax, [bx+1Ah]
		cmp	ax, word_20E30
		jl	short loc_14503
		mov	bx, si
		add	bx, bx
		add	bx, word_1FE4E
		push	word ptr [bx+2]
		mov	ax, word_20E30
		add	ax, word_20E34
		push	ax
		mov	al, pid_20E3A
		mov	ah, 0
		push	ax
		call	sub_B73A
		mov	[bp+var_1], 1
		jmp	short loc_1450B
; ---------------------------------------------------------------------------

loc_14503:
		add	si, 4

loc_14506:
		cmp	si, 0Ch
		jl	short loc_144AF

loc_1450B:
		mov	al, [bp+var_1]

loc_1450E:
		pop	si
		leave
		retf
marisa_14487	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_RENDER_MARISA
chargeshot_render_marisa	proc far

var_4		= word ptr -4
var_2		= word ptr -2

		enter	4, 0
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 32h
		add	ax, 288Ah
		mov	word_1FE4E, ax
		mov	bx, word_1FE4E
		cmp	byte ptr [bx], 0
		jz	loc_146AB
		call	egc_off
		call	grcg_settile_1line pascal, GC_RMW, 0AA0055AAh
		mov	[bp+var_4], 0
		mov	si, 0Bh
		jmp	short loc_14594
; ---------------------------------------------------------------------------

loc_1454D:
		mov	bx, si
		add	bx, bx
		add	bx, word_1FE4E
		push	word ptr [bx+2]
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	di, ax
		mov	bx, si
		add	bx, bx
		add	bx, word_1FE4E
		mov	ax, [bx+1Ah]
		sar	ax, 5
		add	ax, 8
		mov	[bp+var_2], ax
		cmp	[bp+var_4], di
		jz	short loc_14590
		lea	ax, [di-2]
		push	ax
		push	8
		lea	ax, [di+1]
		push	ax
		push	[bp+var_2]
		call	grcg_boxfill

loc_14590:
		mov	[bp+var_4], di
		dec	si

loc_14594:
		cmp	si, 6
		jg	short loc_1454D
		call	grcg_settile_1line pascal, GC_RMW, 0FF00AA55h
		mov	[bp+var_4], 0
		mov	si, 6
		jmp	short loc_145F8
; ---------------------------------------------------------------------------

loc_145B1:
		mov	bx, si
		add	bx, bx
		add	bx, word_1FE4E
		push	word ptr [bx+2]
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	di, ax
		mov	bx, si
		add	bx, bx
		add	bx, word_1FE4E
		mov	ax, [bx+1Ah]
		sar	ax, 5
		add	ax, 8
		mov	[bp+var_2], ax
		cmp	[bp+var_4], di
		jz	short loc_145F4
		lea	ax, [di-2]
		push	ax
		push	8
		lea	ax, [di+1]
		push	ax
		push	[bp+var_2]
		call	grcg_boxfill

loc_145F4:
		mov	[bp+var_4], di
		dec	si

loc_145F8:
		cmp	si, 3
		jg	short loc_145B1
		call	grcg_settile_1line pascal, GC_RMW, 0FF55FF55h
		mov	[bp+var_4], 0
		mov	si, 3
		jmp	short loc_1465C
; ---------------------------------------------------------------------------

loc_14615:
		mov	bx, si
		add	bx, bx
		add	bx, word_1FE4E
		push	word ptr [bx+2]
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	di, ax
		mov	bx, si
		add	bx, bx
		add	bx, word_1FE4E
		mov	ax, [bx+1Ah]
		sar	ax, 5
		add	ax, 8
		mov	[bp+var_2], ax
		cmp	[bp+var_4], di
		jz	short loc_14658
		lea	ax, [di-2]
		push	ax
		push	8
		lea	ax, [di+1]
		push	ax
		push	[bp+var_2]
		call	grcg_boxfill

loc_14658:
		mov	[bp+var_4], di
		dec	si

loc_1465C:
		or	si, si
		jg	short loc_14615
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 15
		mov	bx, word_1FE4E
		push	word ptr [bx+2]
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	di, ax
		mov	bx, word_1FE4E
		mov	ax, [bx+1Ah]
		sar	ax, 5
		add	ax, 8
		mov	[bp+var_2], ax
		lea	ax, [di-2]
		push	ax
		push	8
		lea	ax, [di+1]
		push	ax
		push	[bp+var_2]
		call	grcg_boxfill
		call	grcg_off
		call	egc_on

loc_146AB:
		pop	di
		pop	si
		leave
		retf
chargeshot_render_marisa	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_146AF	proc near

var_2		= byte ptr -2
@@pid_other		= byte ptr -1
arg_0		= byte ptr  4

		enter	2, 0
		push	si
		mov	[bp+var_2], 1
		cmp	[bp+arg_0], 2
		jnz	short loc_146C6
		mov	al, [bp+var_2]
		add	al, 2
		mov	[bp+var_2], al

loc_146C6:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D54h]
		cmp	al, [bp+var_2]
		jnz	short loc_14723
		push	1Fh
		call	randring2_next16_and
		neg	ax
		shl	ax, 4
		mov	dl, _pid_current
		mov	dh, 0
		add	dx, dx
		mov	bx, dx
		mov	[bx+2884h], ax
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+2888h], 0
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+2D54h]
		mov	al, _pid_current
		mov	ah, 0
		mov	dl, 30h	; '0'
		mov	bx, ax
		sub	dl, [bx+2D56h]
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		mov	[bx+2D58h], dl
		jmp	loc_14880
; ---------------------------------------------------------------------------

loc_14723:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D54h]
		mov	ah, 0
		mov	dl, [bp+var_2]
		mov	dh, 0
		inc	dx
		cmp	ax, dx
		jnz	loc_14880
		mov	al, [bp+arg_0]
		mov	byte_23E4E, al
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	ax, [bx+2884h]
		mov	word_23E40, ax
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	_pid_other, al
		mov	byte_23E42, 38h ; '8'
		mov	byte_23E45, 0
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2888h]
		mov	ah, 0
		mov	bx, 18h
		cwd
		idiv	bx
		cmp	dx, 8
		jnz	short loc_14784
		push	0
		jmp	short loc_1479F
; ---------------------------------------------------------------------------

loc_14784:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2888h]
		mov	ah, 0
		mov	bx, 18h
		cwd
		idiv	bx
		cmp	dx, 14h
		jnz	short loc_147BA
		push	1200h

loc_1479F:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	word ptr [bx+2884h]
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		jmp	loc_14850
; ---------------------------------------------------------------------------

loc_147BA:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2888h]
		mov	ah, 0
		mov	bx, 18h
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_147F5
		mov	angle_23E43, 20h
		mov	word_23E3E, 0
		xor	si, si
		jmp	short loc_147EE
; ---------------------------------------------------------------------------

loc_147E0:
		nopcall	sub_17730
		mov	al, byte_23E42
		add	al, -6
		mov	byte_23E42, al
		inc	si

loc_147EE:
		cmp	si, 5
		jl	short loc_147E0
		jmp	short loc_1482F
; ---------------------------------------------------------------------------

loc_147F5:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2888h]
		mov	ah, 0
		mov	bx, 18h
		cwd
		idiv	bx
		cmp	dx, 0Ch
		jnz	short loc_14850
		mov	angle_23E43, 60h
		mov	word_23E3E, 1200h
		xor	si, si
		jmp	short loc_1482A
; ---------------------------------------------------------------------------

loc_1481C:
		nopcall	sub_17730
		mov	al, byte_23E42
		add	al, -6
		mov	byte_23E42, al
		inc	si

loc_1482A:
		cmp	si, 5
		jl	short loc_1481C

loc_1482F:
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		mov	al, [bx+2D58h]
		mov	ah, 0
		shl	ax, 4
		mov	dl, _pid_current
		mov	dh, 0
		add	dx, dx
		mov	bx, dx
		add	[bx+2884h], ax

loc_14850:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		cmp	word ptr [bx+2884h], 1700h
		jl	short loc_14875
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+2D54h], 0
		push	word ptr [bp+@@pid_other]
		call	sub_A3A8

loc_14875:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+2888h]

loc_14880:
		pop	si
		leave
		retn	2
sub_146AF	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

marisa_14885	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jz	short loc_1489B
		push	1
		call	sub_146AF

loc_1489B:
		pop	bp
		retf
marisa_14885	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

marisa_1489D	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jz	short loc_148B3
		push	2
		call	sub_146AF

loc_148B3:
		pop	bp
		retf
marisa_1489D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

marisa_bomb	proc far

var_2		= byte ptr -2
@@frame		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_INACTIVE
		jz	@@ret
		call	egc_off
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, _bomb_frame[bx]
		mov	[bp+@@frame], al
		cmp	[bp+@@frame], 64
		jnb	short loc_14914
		push	GC_RMW
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	grcg_setcolor
		mov	bx, 3932h
		cmp	_pid_current, 0
		jz	short loc_148FF
		add	bx, 28h	; '('

loc_148FF:
		call	sub_B39E
		call	grcg_off
		mov	al, [bp+@@frame]
		shl	al, 2
		mov	dl, 0
		jmp	loc_149E8
; ---------------------------------------------------------------------------

loc_14914:
		cmp	[bp+@@frame], 128
		jnb	loc_149D1
		test	[bp+@@frame], 1
		jz	short loc_14929
		call	snd_se_play pascal, 16

loc_14929:
		mov	al, [bp+@@frame]
		mov	ah, 0
		and	ax, 3
		cmp	ax, 2
		jge	short loc_1494A
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 4
		mov	si, 10h
		jmp	short loc_1495C
; ---------------------------------------------------------------------------

loc_1494A:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], -4
		mov	si, 8

loc_1495C:
		cmp	_pid_current, 0
		jz	short loc_14967
		add	si, PLAYFIELD_W_BORDERED

loc_14967:
		push	si	; left
		push	PLAYFIELD_TOP	; top
		mov	al, _pid_current
		mov	ah, 0
		add	ax, 2
		push	ax	; slot
		mov	al, _pid_current
		mov	ah, 0
		push	ax	; altered_colors
		call	@mrs_put_noalpha_8$qiuiic
		mov	al, [bp+@@frame]
		mov	ah, 0
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_14A1C
		push	1200h
		call	randring2_next16_mod
		mov	point_1FE52.x, ax
		push	1700h
		call	randring2_next16_mod
		mov	point_1FE52.y, ax
		push	point_1FE52.x
		push	ax
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	sub_CDBD
		push	point_1FE52.x
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	point_1FE52.x, ax
		mov	ax, point_1FE52.y
		sar	ax, 4
		add	ax, 16
		mov	point_1FE52.y, ax
		jmp	short loc_14A1C
; ---------------------------------------------------------------------------

loc_149D1:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 0
		mov	al, [bp+@@frame]
		shl	al, 3
		mov	dl, 255

loc_149E8:
		sub	dl, al
		mov	[bp+var_2], dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].r, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].g, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].b, dl
		mov	_palette_changed, 1

loc_14A1C:
		call	egc_on
		cmp	[bp+@@frame], 64
		jb	short @@ret
		cmp	[bp+@@frame], 128
		jnb	short @@ret
		mov	_sprite16_put_w, (48 / 16)
		mov	_sprite16_put_h, 24
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 0F16h
		mov	di, ax
		mov	al, [bp+@@frame]
		mov	ah, 0
		and	ax, 3
		cmp	ax, 2
		jge	short loc_14A5E
		add	di, 6

loc_14A5E:
		mov	ax, point_1FE52.x
		add	ax, -24
		push	ax
		mov	ax, point_1FE52.y
		add	ax, -24
		push	ax
		push	di
		call	sprite16_put

@@ret:
		pop	di
		pop	si
		leave
		retf
marisa_bomb	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_14A76	proc far
		push	bp
		mov	bp, sp
		mov	word_205CA, 2D6Ah
		xor	ax, ax
		jmp	short loc_14A90
; ---------------------------------------------------------------------------

loc_14A83:
		mov	bx, word_205CA
		mov	byte ptr [bx], 0
		inc	ax
		add	word_205CA, 20h	; ' '

loc_14A90:
		cmp	ax, 18h
		jl	short loc_14A83
		pop	bp
		retf
sub_14A76	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_ADD_REIMU
chargeshot_add_reimu	proc far

var_1		= byte ptr -1
@@center_y	= word ptr  6
@@center_x	= word ptr  8

		enter	2, 0
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		imul	ax, 180h
		add	ax, 2D6Ah
		mov	word_205CA, ax
		mov	[bp+var_1], 90h
		xor	cx, cx
		jmp	short loc_14AFC
; ---------------------------------------------------------------------------

loc_14AB2:
		mov	bx, word_205CA
		mov	byte ptr [bx], 1
		mov	byte ptr [bx+1], 0
		xor	dx, dx
		jmp	short loc_14ADE
; ---------------------------------------------------------------------------

loc_14AC1:
		mov	bx, dx
		add	bx, bx
		add	bx, word_205CA
		mov	ax, [bp+@@center_x]
		mov	[bx+2],	ax
		mov	bx, dx
		add	bx, bx
		add	bx, word_205CA
		mov	ax, [bp+@@center_y]
		mov	[bx+10h], ax
		inc	dx

loc_14ADE:
		cmp	dx, 7
		jl	short loc_14AC1
		mov	bx, word_205CA
		mov	al, [bp+var_1]
		mov	[bx+1Eh], al
		add	al, 20h	; ' '
		mov	[bp+var_1], al
		mov	byte ptr [bx+1Fh], 60h
		inc	cx
		add	word_205CA, 20h	; ' '

loc_14AFC:
		cmp	cx, 4
		jl	short loc_14AB2
		mov	byte_205CC, 1
		leave
		retf	4
chargeshot_add_reimu	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_14B0A	proc far

arg_0		= word ptr  6
arg_2		= word ptr  8

		push	bp
		mov	bp, sp
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		imul	ax, 180h
		add	ax, 2D6Ah
		mov	word_205CA, ax
		xor	cx, cx
		jmp	short loc_14B6E
; ---------------------------------------------------------------------------

loc_14B20:
		mov	bx, word_205CA
		cmp	byte ptr [bx], 0
		jnz	short loc_14B68
		mov	bx, word_205CA
		mov	byte ptr [bx], 2
		mov	byte ptr [bx+1], 0
		xor	dx, dx
		jmp	short loc_14B55
; ---------------------------------------------------------------------------

loc_14B38:
		mov	bx, dx
		add	bx, bx
		add	bx, word_205CA
		mov	ax, [bp+arg_2]
		mov	[bx+2],	ax
		mov	bx, dx
		add	bx, bx
		add	bx, word_205CA
		mov	ax, [bp+arg_0]
		mov	[bx+10h], ax
		inc	dx

loc_14B55:
		cmp	dx, 7
		jl	short loc_14B38
		mov	bx, word_205CA
		mov	byte ptr [bx+1Eh], 0C0h
		mov	byte ptr [bx+1Fh], 0C0h
		jmp	short loc_14B73
; ---------------------------------------------------------------------------

loc_14B68:
		inc	cx
		add	word_205CA, 20h	; ' '

loc_14B6E:
		cmp	cx, 0Ch
		jl	short loc_14B20

loc_14B73:
		mov	byte_205CC, 0
		pop	bp
		retf	4
sub_14B0A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_UPDATE_REIMU
chargeshot_update_reimu	proc far

@@vector_y		= word ptr -4
@@vector_x		= word ptr -2

		enter	4, 0
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 180h
		add	ax, 2D6Ah
		mov	word_205CA, ax
		mov	word_1F2EC, 0FE80h
		mov	word_1F2EE, 0FE80h
		xor	di, di
		jmp	loc_14C81
; ---------------------------------------------------------------------------

loc_14BA2:
		mov	bx, word_205CA
		cmp	byte ptr [bx], 0
		jz	loc_14C7B
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	_players[bx].gauge_charged, 0
		mov	si, 6
		jmp	short loc_14BF1
; ---------------------------------------------------------------------------

loc_14BC2:
		lea	bx, [si-1]
		add	bx, bx
		add	bx, word_205CA
		mov	ax, [bx+2]
		mov	bx, si
		add	bx, bx
		add	bx, word_205CA
		mov	[bx+2],	ax
		lea	bx, [si-1]
		add	bx, bx
		add	bx, word_205CA
		mov	ax, [bx+10h]
		mov	bx, si
		add	bx, bx
		add	bx, word_205CA
		mov	[bx+10h], ax
		dec	si

loc_14BF1:
		or	si, si
		jg	short loc_14BC2
		push	ss
		lea	ax, [bp+@@vector_x]
		push	ax
		push	ss
		lea	ax, [bp+@@vector_y]
		push	ax
		mov	bx, word_205CA
		push	word ptr [bx+1Eh]
		mov	al, [bx+1Fh]
		mov	ah, 0
		push	ax
		call	vector2
		mov	bx, word_205CA
		mov	ax, [bp+@@vector_x]
		add	[bx+2],	ax
		mov	ax, [bp+@@vector_y]
		add	[bx+10h], ax
		cmp	byte ptr [bx], 1
		jnz	short loc_14C5E
		cmp	byte ptr [bx+1Fh], 0
		jbe	short loc_14C36
		mov	al, [bx+1Fh]
		add	al, 0FCh
		mov	[bx+1Fh], al
		jmp	short loc_14C5E
; ---------------------------------------------------------------------------

loc_14C36:
		mov	bx, word_205CA
		cmp	byte ptr [bx+1], 40h
		jb	short loc_14C5E
		mov	byte ptr [bx], 2
		cmp	di, 2
		jge	short loc_14C4E
		mov	byte ptr [bx+1Eh], 0B0h	; ''
		jmp	short loc_14C56
; ---------------------------------------------------------------------------

loc_14C4E:
		mov	bx, word_205CA
		mov	byte ptr [bx+1Eh], 0D0h

loc_14C56:
		mov	bx, word_205CA
		mov	byte ptr [bx+1Fh], 0E0h

loc_14C5E:
		mov	bx, word_205CA
		inc	byte ptr [bx+1]
		push	word ptr [bx+0Eh]
		push	word ptr [bx+1Ch]
		call	sub_A310
		or	al, al
		jz	short loc_14C7B
		mov	bx, word_205CA
		mov	byte ptr [bx], 0

loc_14C7B:
		inc	di
		add	word_205CA, 20h	; ' '

loc_14C81:
		cmp	di, 0Ch
		jl	loc_14BA2
		pop	di
		pop	si
		leave
		retf
chargeshot_update_reimu	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_14C8C	proc near

@@sprite_offset		= word ptr -2
arg_0		= word ptr  4
@@top		= word ptr  6
arg_4		= word ptr  8

		enter	2, 0
		push	si
		push	di
		mov	di, [bp+arg_4]
		mov	si, [bp+arg_0]
		mov	ax, si
		add	ax, word_23AF6
		mov	si, ax
		and	si, 3
		mov	ax, si
		imul	ax, 6
		mov	dl, byte ptr word_23AF0
		mov	dh, 0
		add	ax, dx
		add	ax, 1180h
		mov	[bp+@@sprite_offset], ax
		push	di
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -24
		mov	di, ax
		mov	ax, [bp+@@top]
		sar	ax, 4
		add	ax, -8
		mov	[bp+@@top], ax
		call	sprite16_put pascal, di, ax, [bp+@@sprite_offset]
		pop	di
		pop	si
		leave
		retn	6
sub_14C8C	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

reimu_14CE3	proc far
		push	bp
		mov	bp, sp
		push	si
		cmp	byte_205CC, 0
		jz	short loc_14CF7
		test	byte ptr word_23AF6, 1
		jnz	loc_14D7E

loc_14CF7:
		mov	al, pid_20E3A
		mov	ah, 0
		imul	ax, 180h
		add	ax, 2D6Ah
		mov	word_205CA, ax
		xor	si, si
		jmp	short loc_14D79
; ---------------------------------------------------------------------------

loc_14D0A:
		mov	bx, word_205CA
		cmp	byte ptr [bx], 0
		jz	short loc_14D73
		mov	bx, word_205CA
		cmp	word ptr [bx+2], 0FF00h
		jle	short loc_14D73
		cmp	word ptr [bx+2], 1200h
		jge	short loc_14D73
		cmp	word ptr [bx+10h], 0FF00h
		jle	short loc_14D73
		mov	bx, word_205CA
		mov	ax, [bx+2]
		sub	ax, word_20E36
		cmp	ax, 140h
		jg	short loc_14D73
		mov	ax, word_20E2E
		sub	ax, [bx+2]
		cmp	ax, 140h
		jg	short loc_14D73
		mov	ax, [bx+10h]
		sub	ax, word_20E38
		cmp	ax, 140h
		jg	short loc_14D73
		mov	ax, word_20E30
		sub	ax, [bx+10h]
		cmp	ax, 140h
		jg	short loc_14D73
		push	word ptr [bx+2]
		push	word ptr [bx+10h]
		mov	al, pid_20E3A
		mov	ah, 0
		push	ax
		call	sub_B73A
		mov	al, 1
		jmp	short loc_14D80
; ---------------------------------------------------------------------------

loc_14D73:
		inc	si
		add	word_205CA, 20h	; ' '

loc_14D79:
		cmp	si, 6
		jl	short loc_14D0A

loc_14D7E:
		mov	al, 0

loc_14D80:
		pop	si
		pop	bp
		retf
reimu_14CE3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_RENDER_REIMU
chargeshot_render_reimu	proc far
		push	bp
		mov	bp, sp
		push	si
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 180h
		add	ax, 2D6Ah
		mov	word_205CA, ax
		cmp	_pid_current, 0
		jnz	short loc_14DAB
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_14DB7
; ---------------------------------------------------------------------------

loc_14DAB:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_14DB7:
		mov	_sprite16_put_w, (48 / 16)
		mov	_sprite16_put_h, 24
		xor	si, si
		jmp	short loc_14E33
; ---------------------------------------------------------------------------

loc_14DC6:
		mov	bx, word_205CA
		cmp	byte ptr [bx], 0
		jz	short loc_14E2D
		mov	dx, 1
		mov	ah, SPRITE16_SET_MONO
		int	SPRITE16
		mov	dx, 2
		mov	ah, SPRITE16_SET_COLOR
		int	SPRITE16
		mov	bx, word_205CA
		push	word ptr [bx+0Eh]
		push	word ptr [bx+1Ch]
		push	3
		call	sub_14C8C
		mov	dx, 5
		mov	ah, SPRITE16_SET_COLOR
		int	SPRITE16
		mov	bx, word_205CA
		push	word ptr [bx+0Ah]
		push	word ptr [bx+18h]
		push	2
		call	sub_14C8C
		mov	dx, 6
		mov	ah, SPRITE16_SET_COLOR
		int	SPRITE16
		mov	bx, word_205CA
		push	word ptr [bx+6]
		push	word ptr [bx+14h]
		push	1
		call	sub_14C8C
		xor	dx, dx
		mov	ah, SPRITE16_SET_MONO
		int	SPRITE16
		mov	bx, word_205CA
		push	word ptr [bx+2]
		push	word ptr [bx+10h]
		push	0
		call	sub_14C8C

loc_14E2D:
		inc	si
		add	word_205CA, 20h	; ' '

loc_14E33:
		cmp	si, 0Ch
		jl	short loc_14DC6
		pop	si
		pop	bp
		retf
chargeshot_render_reimu	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_14E3B	proc near

var_2		= byte ptr -2
@@pid_other		= byte ptr -1
arg_0		= byte ptr  4

		enter	2, 0
		mov	[bp+var_2], 1
		cmp	[bp+arg_0], 2
		jnz	short loc_14E51
		mov	al, [bp+var_2]
		add	al, 2
		mov	[bp+var_2], al

loc_14E51:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D54h]
		cmp	al, [bp+var_2]
		jnz	short loc_14EB3
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+2D68h], 0
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+2D54h]
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D56h]
		add	al, 20h	; ' '
		mov	dl, _pid_current
		mov	dh, 0
		shl	dx, 2
		mov	bx, dx
		mov	[bx+2D58h], al
		mov	al, _pid_current
		mov	ah, 0
		mov	dl, 20h	; ' '
		mov	bx, ax
		sub	dl, [bx+2D56h]
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		mov	[bx+2D59h], dl
		leave
		retn	2
; ---------------------------------------------------------------------------

loc_14EB3:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D54h]
		mov	ah, 0
		mov	dl, [bp+var_2]
		mov	dh, 0
		inc	dx
		cmp	ax, dx
		jnz	locret_14FEA
		mov	al, [bp+arg_0]
		mov	byte_23E4E, al
		mov	word_23E40, 80h
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	_pid_other, al
		mov	byte_23E42, 20h ; ' '
		mov	angle_23E43, 0
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D68h]
		mov	ah, 0
		mov	dl, _pid_current
		mov	dh, 0
		shl	dx, 2
		mov	bx, dx
		mov	dl, [bx+2D59h]
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		or	dx, dx
		jnz	short loc_14F52
		mov	byte_23E45, 18h
		mov	word_23E3E, 200h
		push	2000080h
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		nopcall	sub_17730
		mov	word_23E3E, 1000h
		push	10000080h
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		nopcall	sub_17730

loc_14F52:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D68h]
		mov	ah, 0
		mov	bx, 20h	; ' '
		cwd
		idiv	bx
		cmp	dx, 10h
		jnz	short loc_14FBD
		mov	byte_23E45, 26h ; '&'
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		mov	al, [bx+2D58h]
		mov	byte_23E47, al
		mov	byte_23E42, 32h ; '2'
		mov	word_23E3E, 400h
		push	4000080h
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		nopcall	sub_17730
		mov	word_23E3E, 0E00h
		push	0E000080h
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		nopcall	sub_17730

loc_14FBD:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D68h], 40h
		jbe	short loc_14FDF
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+2D54h], 0
		push	word ptr [bp+@@pid_other]
		call	sub_A3A8

loc_14FDF:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+2D68h]

locret_14FEA:
		leave
		retn	2
sub_14E3B	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

reimu_14FEE	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jz	short loc_15004
		push	1
		call	sub_14E3B

loc_15004:
		pop	bp
		retf
reimu_14FEE	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

reimu_15006	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jz	short loc_1501C
		push	2
		call	sub_14E3B

loc_1501C:
		pop	bp
		retf
reimu_15006	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1501E	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_INACTIVE
		jz	short @@ret
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_PREPARING
		jnz	short loc_1505C
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	_bomb_state[bx], BOMB_ACTIVE
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	_bomb_frame[bx], 0
		call	snd_se_play pascal, 18

loc_1505C:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	_bomb_frame[bx]
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_frame[bx], BOMB_FRAMES
		jb	short @@ret
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	_bomb_state[bx], BOMB_INACTIVE
		push	word ptr _pid_current
		call	sub_A3A8

@@ret:
		pop	bp
		retf
sub_1501E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

reimu_1508C	proc far
		push	bp
		mov	bp, sp
		push	si
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_INACTIVE
		jz	@@ret
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_PREPARING
		jnz	short loc_150ED
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	_bomb_state[bx], BOMB_ACTIVE
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	_bomb_frame[bx], 0
		xor	si, si
		jmp	short loc_150E1
; ---------------------------------------------------------------------------

loc_150CA:
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 8
		mov	dx, si
		shl	dx, 3
		add	ax, dx
		mov	bx, ax
		mov	byte ptr [bx+3080h], 0
		inc	si

loc_150E1:
		cmp	si, 20h	; ' '
		jl	short loc_150CA
		call	snd_se_play pascal, 18

loc_150ED:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	_bomb_frame[bx]
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 8
		add	ax, 3080h
		mov	word_207E0, ax
		xor	si, si
		jmp	short loc_15132
; ---------------------------------------------------------------------------

loc_1510A:
		mov	bx, word_207E0
		cmp	byte ptr [bx], 0
		jz	short loc_1512C
		mov	bx, word_207E0
		mov	ax, [bx+6]
		add	[bx+4],	ax
		cmp	word ptr [bx+4], 0FF80h
		jg	short loc_1512C
		mov	word ptr [bx+4], 1800h
		add	word ptr [bx+6], 8

loc_1512C:
		inc	si
		add	word_207E0, 8

loc_15132:
		cmp	si, 20h	; ' '
		jl	short loc_1510A
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_frame[bx], BOMB_FRAMES
		jb	short @@ret
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	_bomb_state[bx], BOMB_INACTIVE
		push	word ptr _pid_current
		call	sub_A3A8

@@ret:
		pop	si
		pop	bp
		retf
reimu_1508C	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1515D	proc near

@@sprite_offset		= word ptr -6
@@top		= word ptr -4
@@left		= word ptr -2

		enter	6, 0
		push	si
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 8
		add	ax, 3080h
		mov	word_207E0, ax
		mov	_sprite16_put_w, (16 / 16)
		mov	_sprite16_put_h, 8
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 18h
		mov	[bp+@@sprite_offset], ax
		xor	si, si
		jmp	short loc_151D9
; ---------------------------------------------------------------------------

loc_15196:
		mov	bx, word_207E0
		cmp	byte ptr [bx], 0
		jz	short loc_151D3
		mov	bx, word_207E0
		push	word ptr [bx+2]
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -8
		mov	[bp+@@left], ax
		mov	bx, word_207E0
		mov	ax, [bx+4]
		sar	ax, 4
		add	ax, 8
		mov	[bp+@@top], ax
		call	sprite16_put pascal, [bp+@@left], ax, [bp+@@sprite_offset]

loc_151D3:
		inc	si
		add	word_207E0, 8

loc_151D9:
		cmp	si, 20h	; ' '
		jl	short loc_15196
		pop	si
		leave
		retn
sub_1515D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

reimu_bomb	proc far

var_2		= byte ptr -2
@@frame		= byte ptr -1

		enter	2, 0
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_INACTIVE
		jz	@@ret
		call	egc_off
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, _bomb_frame[bx]
		mov	[bp+@@frame], al
		cmp	[bp+@@frame], 64
		jnb	loc_152C2
		push	GC_RMW
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	grcg_setcolor
		mov	bx, 3932h
		cmp	_pid_current, 0
		jz	short loc_1522B
		add	bx, 28h	; '('

loc_1522B:
		call	sub_B39E
		call	grcg_off
		cmp	[bp+@@frame], 32
		jnb	short loc_1527D
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 8
		mov	dl, [bp+@@frame]
		mov	dh, 0
		shl	dx, 3
		add	ax, dx
		add	ax, 3080h
		mov	word_207E0, ax
		mov	bx, word_207E0
		mov	byte ptr [bx], 1
		push	7Fh
		call	randring2_next16_and
		mov	dx, 0FFA0h
		sub	dx, ax
		mov	bx, word_207E0
		mov	[bx+6],	dx
		push	1200h
		call	randring2_next16_mod
		mov	bx, word_207E0
		mov	[bx+2],	ax
		mov	word ptr [bx+4], 1800h

loc_1527D:
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	dl, [bp+@@frame]
		shl	dl, 2
		mov	bx, ax
		mov	Palettes[bx].r, dl
		mov	al, [bp+@@frame]
		mov	ah, 0
		imul	ax, 3
		mov	dl, _pid_current
		mov	dh, 0
		imul	dx, size rgb_t
		mov	bx, dx
		mov	Palettes[bx].g, al
		mov	al, [bp+@@frame]
		mov	ah, 0
		imul	ax, 3
		mov	dl, _pid_current
		mov	dh, 0
		imul	dx, size rgb_t
		mov	bx, dx
		mov	Palettes[bx].b, al
		jmp	loc_153A6
; ---------------------------------------------------------------------------

loc_152C2:
		cmp	[bp+@@frame], 112
		jnb	loc_15360
		test	[bp+@@frame], 1
		jz	short loc_152D7
		call	snd_se_play pascal, 16

loc_152D7:
		cmp	[bp+@@frame], 96
		ja	short loc_15318
		mov	al, [bp+@@frame]
		mov	ah, 0
		and	ax, 1
		imul	ax, 80
		add	ax, 100
		mov	PaletteTone, ax
		mov	_palette_changed, 1
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, PLAYFIELD_W_BORDERED
		add	ax, PLAYFIELD_LEFT
		push	ax	; left
		push	PLAYFIELD_TOP	; top
		mov	al, _pid_current
		mov	ah, 0
		add	ax, 2
		push	ax	; slot
		mov	al, _pid_current
		mov	ah, 0
		push	ax	; altered_colors
		call	@mrs_put_noalpha_8$qiuiic
		jmp	short loc_15323
; ---------------------------------------------------------------------------

loc_15318:
		mov	PaletteTone, 100
		mov	_palette_changed, 1

loc_15323:
		mov	al, [bp+@@frame]
		mov	ah, 0
		mov	bx, 8
		cwd
		idiv	bx
		mov	[bp+var_2], dl
		mov	al, [bp+var_2]
		mov	ah, 0
		and	ax, 3
		cmp	ax, 2
		jge	short loc_1534F
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 4
		jmp	short loc_153AB
; ---------------------------------------------------------------------------

loc_1534F:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], -4
		jmp	short loc_153AB
; ---------------------------------------------------------------------------

loc_15360:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 0
		mov	al, [bp+@@frame]
		shl	al, 3
		mov	dl, 255
		sub	dl, al
		mov	[bp+var_2], dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].r, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].g, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].b, dl

loc_153A6:
		mov	_palette_changed, 1

loc_153AB:
		call	egc_on
		cmp	[bp+@@frame], 96
		jnb	short @@ret
		call	sub_1515D

@@ret:
		leave
		retf
reimu_bomb	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_153BB	proc far
		push	bp
		mov	bp, sp
		mov	word_20E22, 3796h
		xor	ax, ax
		jmp	short loc_153D5
; ---------------------------------------------------------------------------

loc_153C8:
		mov	bx, word_20E22
		mov	byte ptr [bx], 0
		inc	ax
		add	word_20E22, 0Ah

loc_153D5:
		cmp	ax, 1Eh
		jl	short loc_153C8
		pop	bp
		retf
sub_153BB	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_ADD_MIMA
chargeshot_add_mima	proc far

@@center_y	= word ptr  6
@@center_x	= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		imul	ax, 96h
		add	ax, 3796h
		mov	word_20E22, ax
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+38C4h], 1
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+38C6h], 0
		mov	bx, word_20E22
		mov	byte ptr [bx], 1
		xor	si, si
		jmp	short loc_15462
; ---------------------------------------------------------------------------

loc_15412:
		or	si, si
		jz	short loc_1541D
		mov	bx, word_20E22
		mov	byte ptr [bx], 0

loc_1541D:
		mov	bx, word_20E22
		mov	ax, [bp+@@center_x]
		mov	[bx+2],	ax
		mov	ax, [bp+@@center_y]
		mov	[bx+4],	ax
		push	ds
		mov	ax, word_20E22
		add	ax, 6
		push	ax
		push	ds
		mov	ax, word_20E22
		add	ax, 8
		push	ax
		mov	ax, si
		mov	bx, 6
		cwd
		idiv	bx
		mov	bx, dx
		mov	al, angles_1DBD8[bx]
		push	ax
		push	176
		call	vector2
		mov	bx, word_20E22
		mov	byte ptr [bx+1], 0
		inc	si
		add	word_20E22, 0Ah

loc_15462:
		cmp	si, 0Fh
		jl	short loc_15412
		pop	si
		pop	bp
		retf	4
chargeshot_add_mima	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1546C	proc near

arg_0		= byte ptr  4
arg_2		= byte ptr  6

		push	bp
		mov	bp, sp
		mov	al, [bp+arg_2]
		mov	ah, 0
		imul	ax, 96h
		mov	dl, [bp+arg_0]
		mov	dh, 0
		imul	dx, 0Ah
		add	ax, dx
		add	ax, 3796h
		mov	word_20E22, ax
		mov	bx, word_20E22
		mov	byte ptr [bx], 1
		mov	al, [bp+arg_2]
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	ax, _players[bx].center.x
		mov	bx, word_20E22
		mov	[bx+2],	ax
		mov	al, [bp+arg_2]
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	ax, _players[bx].center.y
		mov	bx, word_20E22
		mov	[bx+4],	ax
		call	snd_se_play pascal, 13
		pop	bp
		retn	4
sub_1546C	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_UPDATE_MIMA
chargeshot_update_mima	proc far

var_1		= byte ptr -1

		enter	2, 0
		push	si
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+38C4h], 0
		jz	loc_15594
		mov	word_1F2EC, 0FF00h
		mov	word_1F2EE, 0FF00h
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 96h
		add	ax, 3796h
		mov	word_20E22, ax
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+38C6h]
		inc	al
		mov	dl, _pid_current
		mov	dh, 0
		mov	bx, dx
		mov	[bx+38C6h], al
		mov	[bp+var_1], al
		xor	si, si
		jmp	short loc_1555A
; ---------------------------------------------------------------------------

loc_15514:
		mov	bx, word_20E22
		cmp	byte ptr [bx], 0
		jz	short loc_15554
		mov	bx, word_20E22
		mov	ax, [bx+6]
		add	[bx+2],	ax
		mov	ax, [bx+8]
		add	[bx+4],	ax
		push	word ptr [bx+2]
		push	word ptr [bx+4]
		call	sub_A310
		or	al, al
		jz	short loc_15554
		mov	bx, word_20E22
		mov	byte ptr [bx], 0
		cmp	si, 0Eh
		jnz	short loc_15554
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+38C4h], 0

loc_15554:
		inc	si
		add	word_20E22, 0Ah

loc_1555A:
		cmp	si, 0Fh
		jl	short loc_15514
		cmp	[bp+var_1], 3Ch	; '<'
		jnb	short loc_15584
		mov	al, [bp+var_1]
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_15584
		push	word ptr _pid_current
		mov	al, [bp+var_1]
		mov	ah, 0
		cwd
		idiv	bx
		push	ax
		call	sub_1546C

loc_15584:
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	_players[bx].gauge_charged, 0

loc_15594:
		pop	si
		leave
		retf
chargeshot_update_mima	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

mima_15597	proc far

var_1		= byte ptr -1

		enter	2, 0
		push	si
		mov	al, pid_20E3A
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+38C4h], 0
		jnz	short loc_155AE
		mov	al, 0
		jmp	short loc_15619
; ---------------------------------------------------------------------------

loc_155AE:
		mov	[bp+var_1], 0
		mov	al, pid_20E3A
		mov	ah, 0
		imul	ax, 96h
		add	ax, 3796h
		mov	word_20E22, ax
		xor	si, si
		jmp	short loc_15611
; ---------------------------------------------------------------------------

loc_155C5:
		mov	bx, word_20E22
		cmp	byte ptr [bx], 0
		jz	short loc_1560B
		mov	bx, word_20E22
		mov	ax, [bx+2]
		add	ax, 0FF00h
		cmp	ax, word_20E36
		jg	short loc_1560B
		mov	ax, [bx+2]
		add	ax, 100h
		cmp	ax, word_20E2E
		jl	short loc_1560B
		mov	ax, [bx+4]
		cmp	ax, word_20E30
		jl	short loc_1560B
		cmp	ax, word_20E38
		jg	short loc_1560B
		push	word ptr [bx+2]
		push	ax
		mov	al, pid_20E3A
		mov	ah, 0
		push	ax
		call	sub_B73A
		inc	[bp+var_1]

loc_1560B:
		inc	si
		add	word_20E22, 0Ah

loc_15611:
		cmp	si, 0Fh
		jl	short loc_155C5
		mov	al, [bp+var_1]

loc_15619:
		pop	si
		leave
		retf
mima_15597	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1561C	proc near

@@sprite_offset		= word ptr  4
arg_2		= word ptr  6
arg_4		= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	si, [bp+arg_4]
		mov	di, [bp+arg_2]
		push	si
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -16
		mov	si, ax
		mov	ax, di
		sar	ax, 4
		add	ax, 8
		mov	di, ax
		call	sprite16_put pascal, si, ax, [bp+@@sprite_offset]
		pop	di
		pop	si
		pop	bp
		retn	6
sub_1561C	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_RENDER_MIMA
chargeshot_render_mima	proc far

var_2		= word ptr -2

		enter	2, 0
		push	si
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+38C4h], 0
		jz	short loc_156DF
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 96h
		add	ax, 3796h
		mov	word_20E22, ax
		cmp	_pid_current, 0
		jnz	short loc_15689
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_15695
; ---------------------------------------------------------------------------

loc_15689:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_15695:
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 10h
		mov	[bp+var_2], ax
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 8
		xor	si, si
		jmp	short loc_156DA
; ---------------------------------------------------------------------------

loc_156AF:
		mov	bx, word_20E22
		cmp	byte ptr [bx], 0
		jz	short loc_156D4
		mov	bx, word_20E22
		push	word ptr [bx+2]
		push	word ptr [bx+4]
		mov	ax, si
		mov	bx, 3
		cwd
		idiv	bx
		shl	dx, 2
		add	dx, [bp+var_2]
		push	dx
		call	sub_1561C

loc_156D4:
		inc	si
		add	word_20E22, 0Ah

loc_156DA:
		cmp	si, 0Fh
		jl	short loc_156AF

loc_156DF:
		pop	si
		leave
		retf
chargeshot_render_mima	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_156E2	proc near

var_2		= byte ptr -2
@@pid_other		= byte ptr -1
arg_0		= word ptr  4

		enter	2, 0
		mov	[bp+var_2], 1
		cmp	[bp+arg_0], 2
		jnz	short loc_156F8
		mov	al, [bp+var_2]
		add	al, 2
		mov	[bp+var_2], al

loc_156F8:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D54h]
		cmp	al, [bp+var_2]
		jnz	short loc_15786
		push	1
		nopcall	randring_far_next16_and
		or	ax, ax
		jnz	short loc_15717
		mov	al, 0F9h
		jmp	short loc_15719
; ---------------------------------------------------------------------------

loc_15717:
		mov	al, 7

loc_15719:
		mov	dl, _pid_current
		mov	dh, 0
		mov	bx, dx
		mov	[bx+3792h], al
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+3790h], 40h
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+3794h], 0
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+2D54h]
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D56h]
		add	al, 26h	; '&'
		mov	dl, _pid_current
		mov	dh, 0
		shl	dx, 2
		mov	bx, dx
		mov	[bx+2D58h], al
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D56h]
		add	al, al
		add	al, 18h
		mov	dl, _pid_current
		mov	dh, 0
		shl	dx, 2
		mov	bx, dx
		mov	[bx+2D59h], al
		leave
		retn	2
; ---------------------------------------------------------------------------

loc_15786:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D54h]
		mov	ah, 0
		mov	dl, [bp+var_2]
		mov	dh, 0
		inc	dx
		cmp	ax, dx
		jnz	locret_158C1
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+3794h]
		mov	ah, 0
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_15894
		mov	al, byte ptr [bp+arg_0]
		mov	byte_23E4E, al
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+3792h], 7
		jbe	short loc_157DD
		mov	word_23E3E, 200h
		jmp	short loc_157E3
; ---------------------------------------------------------------------------

loc_157DD:
		mov	word_23E3E, 1000h

loc_157E3:
		mov	word_23E40, 100h
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		mov	al, [bx+2D59h]
		mov	byte_23E42, al
		mov	al, [bp+@@pid_other]
		mov	_pid_other, al
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+3790h]
		mov	angle_23E43, al
		mov	byte_23E50, 0
		mov	byte_23E45, 14h
		push	word_23E3E
		push	100h
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		nopcall	sub_17730
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+3794h]
		mov	ah, 0
		mov	bx, 10h
		cwd
		idiv	bx
		or	dx, dx
		jz	short loc_15878
		mov	byte_23E45, 26h ; '&'
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		mov	al, [bx+2D58h]
		mov	byte_23E47, al
		mov	byte_23E42, 36h ; '6'
		push	word_23E3E
		push	100h
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		nopcall	sub_17730

loc_15878:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+3792h]
		mov	dl, _pid_current
		mov	dh, 0
		mov	bx, dx
		add	[bx+3790h], al
		mov	byte_23E50, 1

loc_15894:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+3794h], 40h
		jbe	short loc_158B6
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+2D54h], 0
		push	word ptr [bp+@@pid_other]
		call	sub_A3A8

loc_158B6:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+3794h]

locret_158C1:
		leave
		retn	2
sub_156E2	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

mima_158C5	proc far

		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jz	short loc_158DB
		push	1
		call	sub_156E2

loc_158DB:
		pop	bp
		retf
mima_158C5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

mima_158DD	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jz	short loc_158F3
		push	2
		call	sub_156E2

loc_158F3:
		pop	bp
		retf
mima_158DD	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_158F5	proc far

var_5		= byte ptr -5
var_4		= word ptr -4
var_2		= word ptr -2

		push	bp
		mov	bp, sp
		sub	sp, 6
		push	si
		push	di
		mov	[bp+var_5], 0
		cmp	word_20E30, 0
		jl	short loc_1590F
		cmp	byte_20E3C, 2
		jnz	short loc_15914

loc_1590F:
		mov	al, 0
		jmp	loc_159FB
; ---------------------------------------------------------------------------

loc_15914:
		mov	byte_26356, 0
		mov	si, offset _shotpairs
		mov	ax, word_20E2E
		add	ax, word_20E32
		mov	word_20E36, ax
		mov	ax, word_20E30
		add	ax, word_20E34
		mov	word_20E38, ax
		mov	ax, word_20E2E
		sub	ax, word_20E32
		mov	word_20E2E, ax
		mov	ax, word_20E30
		sub	ax, word_20E34
		mov	word_20E30, ax
		mov	byte_1FDE1, 1
		mov	[bp+var_2], 0
		jmp	short loc_159B2
; ---------------------------------------------------------------------------

loc_15950:
		cmp	[si+shotpair_t.flag], 1
		jnz	short loc_159AC
		mov	al, [si+shotpair_t.pid]
		cmp	al, pid_20E3A
		jnz	short loc_159AC
		mov	ax, [si+shotpair_t.topleft.x]
		add	ax, (16 shl 4)
		mov	di, ax
		mov	ax, [si+shotpair_t.topleft.y]
		add	ax, (8 shl 4)
		mov	[bp+var_4], ax
		lea	ax, [di-(16 shl 4)]
		cmp	ax, word_20E36
		jg	short loc_159AC
		lea	ax, [di+(16 shl 4)]
		cmp	ax, word_20E2E
		jl	short loc_159AC
		mov	ax, [bp+var_4]
		cmp	ax, word_20E30
		jl	short loc_159AC
		cmp	ax, word_20E38
		jg	short loc_159AC
		mov	[si+shotpair_t.flag], 0
		mov	al, [bp+var_5]
		add	al, 2
		mov	[bp+var_5], al
		push	di
		push	[bp+var_4]
		mov	al, pid_20E3A
		mov	ah, 0
		push	ax
		call	sub_B73A

loc_159AC:
		inc	[bp+var_2]
		add	si, size shotpair_t

loc_159B2:
		cmp	[bp+var_2], SHOTPAIR_COUNT
		jl	short loc_15950
		mov	byte_1FDE1, 0
		cmp	byte_20E2C, 0
		jnz	short loc_159CC
		nopcall	sub_1670D
		add	[bp+var_5], al

loc_159CC:
		cmp	pid_20E3A, 0
		jnz	short loc_159D9
		call	p1_2029C
		jmp	short loc_159DD
; ---------------------------------------------------------------------------

loc_159D9:
		call	p2_202A0

loc_159DD:
		add	[bp+var_5], al
		mov	al, pid_20E3A
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_INACTIVE
		jz	short loc_159F8
		test	byte ptr word_23AF6, 1
		jnz	short loc_159F8
		inc	[bp+var_5]

loc_159F8:
		mov	al, [bp+var_5]

loc_159FB:
		pop	di
		pop	si
		leave
		retf
sub_158F5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

yumemi_bomb	proc far

var_14		= byte ptr -14h
var_10		= byte ptr -10h
@@frame		= byte ptr -0Fh
var_E		= word ptr -0Eh
var_C		= word ptr -0Ch
var_A		= word ptr -0Ah
var_8		= word ptr -8
var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2

		enter	10h, 0
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_INACTIVE
		jz	@@ret
		call	egc_off
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, _bomb_frame[bx]
		mov	[bp+@@frame], al
		cmp	[bp+@@frame], 64
		ja	loc_15BB9
		cmp	[bp+@@frame], 32
		jnb	short loc_15A4A
		mov	ah, 0
		imul	ax, 3
		mov	dx, 0E0h
		sub	dx, ax
		mov	di, dx
		push	(GC_RMW shl 16) + 8
		jmp	short loc_15A53
; ---------------------------------------------------------------------------

loc_15A4A:
		mov	di, 80h
		push	(GC_RMW shl 16) + 7

loc_15A53:
		call	grcg_setcolor
		cmp	_pid_current, 0
		jnz	short loc_15A77
		call	grc_setclip pascal, ( 16 shl 16) or 8, (303 shl 16) or 191
		mov	[bp+var_2], 10h
		jmp	short loc_15A8D
; ---------------------------------------------------------------------------

loc_15A77:
		call	grc_setclip pascal, (336 shl 16) or 8, (623 shl 16) or 191
		mov	[bp+var_2], 150h

loc_15A8D:
		xor	si, si
		jmp	short loc_15AE6
; ---------------------------------------------------------------------------

loc_15A91:
		mov	al, [si+78Ch]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, 144, di, _CosTable8[bx]
		add	ax, [bp+var_2]
		mov	bx, si
		add	bx, bx
		lea	dx, [bp+var_8]
		add	bx, dx
		mov	ss:[bx], ax
		mov	al, [si+78Ch]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, 200, di, _SinTable8[bx]
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	bx, si
		add	bx, bx
		lea	dx, [bp+var_E]
		add	bx, dx
		mov	ss:[bx], ax
		inc	si

loc_15AE6:
		cmp	si, 3
		jl	short loc_15A91
		call	grcg_triangle pascal, [bp+var_8], [bp+var_E], [bp+var_6], [bp+var_C], [bp+var_4], [bp+var_A]
		cmp	[bp+@@frame], 32
		jbe	loc_15B9A
		mov	al, [bp+@@frame]
		mov	ah, 0
		imul	ax, 3
		mov	dx, 320
		sub	dx, ax
		mov	di, dx
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 8
		mov	si, 3
		jmp	short loc_15B7E
; ---------------------------------------------------------------------------

loc_15B29:
		mov	al, [si+78Ch]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, 144, di, _CosTable8[bx]
		add	ax, [bp+var_2]
		mov	bx, si
		add	bx, bx
		lea	dx, [bp+var_E]
		add	bx, dx
		mov	ss:[bx], ax
		mov	al, [si+78Ch]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, 200, di, _SinTable8[bx]
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	bx, si
		add	bx, bx
		lea	dx, [bp+var_14]
		add	bx, dx
		mov	ss:[bx], ax
		inc	si

loc_15B7E:
		cmp	si, 6
		jl	short loc_15B29
		call	grcg_triangle pascal, [bp+var_8], [bp+var_E], [bp+var_6], [bp+var_C], [bp+var_4], [bp+var_A]

loc_15B9A:
		call	grc_setclip pascal, large 0, ((RES_X - 1) shl 16) or (SPRITE16_RES_Y - 1)
		call	grcg_off
		mov	al, [bp+@@frame]
		shl	al, 2
		mov	[bp+var_10], al
		jmp	loc_15C7E
; ---------------------------------------------------------------------------

loc_15BB9:
		cmp	[bp+@@frame], 144
		jnb	loc_15C57
		test	[bp+@@frame], 7
		jnz	short loc_15BEC
		call	snd_se_play pascal, 5
		mov	PaletteTone, 140
		call	far ptr	palette_show
		push	9000B80h
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	sub_CE5B
		jmp	short loc_15BF7
; ---------------------------------------------------------------------------

loc_15BEC:
		mov	PaletteTone, 60
		call	far ptr	palette_show

loc_15BF7:
		mov	al, [bp+@@frame]
		mov	ah, 0
		mov	bx, 8
		cwd
		idiv	bx
		mov	[bp+var_10], dl
		mov	al, [bp+var_10]
		mov	ah, 0
		and	ax, 3
		cmp	ax, 2
		jge	short loc_15C23
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 4
		jmp	short loc_15C32
; ---------------------------------------------------------------------------

loc_15C23:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], -4

loc_15C32:
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, PLAYFIELD_W_BORDERED
		add	ax, PLAYFIELD_LEFT
		push	ax	; left
		push	PLAYFIELD_TOP	; top
		mov	al, _pid_current
		mov	ah, 0
		add	ax, 2
		push	ax	; slot
		mov	al, _pid_current
		mov	ah, 0
		push	ax	; altered_colors
		call	@mrs_put_noalpha_8$qiuiic
		jmp	short loc_15CB0
; ---------------------------------------------------------------------------

loc_15C57:
		mov	PaletteTone, 100
		call	far ptr	palette_show
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 0
		mov	al, [bp+@@frame]
		shl	al, 3
		mov	dl, 255
		sub	dl, al
		mov	[bp+var_10], dl

loc_15C7E:
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	dl, [bp+var_10]
		mov	bx, ax
		mov	Palettes[bx].r, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].g, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].b, dl
		mov	_palette_changed, 1

loc_15CB0:
		call	egc_on

@@ret:
		pop	di
		pop	si
		leave
		retf
yumemi_bomb	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

combo_add	proc far

var_8		= word ptr -8
var_5		= byte ptr -5
@@bonus_total		= dword	ptr -4
@@bonus		= word ptr  6
@@pid		= byte ptr  8
@@hits		= byte ptr  0Ah

		enter	8, 0
		push	si
		push	di
		mov	cl, [bp+@@hits]
		mov	dx, [bp+@@bonus]
		mov	al, [bp+@@pid]
		mov	ah, 0
		shl	ax, 2
		add	ax, offset _combos
		mov	si, ax
		cmp	cl, COMBO_HIT_MIN
		jb	short @@ret
		mov	al, [bp+@@pid]
		mov	ah, 0
		shl	ax, 7
		add	ax, offset _players
		mov	di, ax
		movzx	eax, dx
		mov	[bp+@@bonus_total], eax
		movzx	eax, [si+combo_t.bonus]
		add	[bp+@@bonus_total], eax
		cmp	[bp+@@bonus_total], COMBO_BONUS_CAP
		jbe	short loc_15D04
		mov	dx, COMBO_BONUS_CAP
		jmp	short loc_15D07
; ---------------------------------------------------------------------------

loc_15D04:
		mov	dx, word ptr [bp+@@bonus_total]

loc_15D07:
		mov	[si+combo_t.bonus], dx
		mov	al, [di+player_t.combo_hits_max]
		mov	[bp+var_5], al
		cmp	[bp+var_5], cl
		jnb	short loc_15D18
		mov	[di+player_t.combo_hits_max], cl

loc_15D18:
		mov	ax, [di+player_t.combo_bonus_max]
		mov	[bp+var_8], ax
		cmp	[bp+var_8], dx
		jnb	short loc_15D26
		mov	[di+player_t.combo_bonus_max], dx

loc_15D26:
		cmp	cl, COMBO_HIT_CAP
		jbe	short loc_15D35
		mov	cl, COMBO_HIT_CAP
		cmp	dx, COMBO_BONUS_CAP
		jz	short loc_15D35
		mov	[si+combo_t.COMBO_time], COMBO_FRAMES

loc_15D35:
		cmp	[si+combo_t.hits], cl
		jb	short loc_15D3F
		cmp	[si+combo_t.COMBO_time], COMBO_HIT_RESET_FRAMES
		jnb	short @@ret

loc_15D3F:
		mov	[si+combo_t.hits], cl
		cmp	dx, COMBO_BONUS_CAP
		jz	short @@ret
		mov	[si+combo_t.COMBO_time], COMBO_FRAMES

@@ret:
		mov	ax, [si+combo_t.bonus]
		pop	di
		pop	si
		leave
		retf	6
combo_add	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

_combo_update_and_render	proc far

var_4		= byte ptr -4
var_3		= byte ptr -3
@@pid		= word ptr -2

		enter	4, 0
		push	si
		push	di
		mov	si, offset _combos
		mov	[bp+@@pid], 0
		jmp	@@player_more?
; ---------------------------------------------------------------------------

@@player_loop:
		cmp	[si+combo_t.COMBO_time], 0
		jz	@@player_next
		cmp	[si+combo_t.COMBO_time], COMBO_FRAMES
		jnz	loc_15E09
		mov	ax, [bp+@@pid]
		imul	ax, PLAYFIELD_VRAM_W_BORDERED
		mov	di, ax
		add	ax, 8
		call	gaiji_putsa pascal, ax, 2, ds, offset _gsHIT, TX_WHITE
		lea	ax, [di+4]
		call	gaiji_putsa pascal, ax, 3, ds, offset _gBONUS_FRAME, TX_WHITE
		mov	al, [si+combo_t.hits]
		mov	[bp+var_4], al
		cmp	[bp+var_4], 0Ah
		jb	short loc_15DDB
		mov	ah, 0
		mov	bx, 10
		cwd
		idiv	bx
		add	al, gb_0_
		mov	[bp+var_3], al
		lea	ax, [di+4]
		push	ax
		push	2
		mov	al, [bp+var_3]
		mov	ah, 0
		push	ax
		push	TX_WHITE
		call	gaiji_putca
		mov	al, [bp+var_4]
		mov	ah, 0
		mov	bx, 10
		cwd
		idiv	bx
		mov	[bp+var_4], dl
		jmp	short loc_15DED
; ---------------------------------------------------------------------------

loc_15DDB:
		lea	ax, [di+4]
		push	ax
		push	(2 shl 16) + 0CFh
		push	TX_WHITE
		call	gaiji_putca

loc_15DED:
		mov	al, [bp+var_4]
		add	al, gb_0_
		mov	[bp+var_3], al
		lea	ax, [di+6]
		push	ax
		push	2
		mov	al, [bp+var_3]
		mov	ah, 0
		push	ax
		push	TX_WHITE
		call	gaiji_putca

loc_15E09:
		dec	[si+combo_t.COMBO_time]
		cmp	[bp+@@pid], 0
		jnz	short loc_15E16
		mov	di, 28h	; '('
		jmp	short loc_15E19
; ---------------------------------------------------------------------------

loc_15E16:
		mov	di, 168h

loc_15E19:
		mov	[bp+var_3], 0Ch
		cmp	[si+combo_t.COMBO_time], COMBO_HIT_RESET_FRAMES
		jnb	short loc_15E27
		mov	ax, 1
		jmp	short loc_15E29
; ---------------------------------------------------------------------------

loc_15E27:
		xor	ax, ax

loc_15E29:
		push	ax
		mov	ax, word_23AF6
		and	ax, 3
		cmp	ax, 2
		jnb	short loc_15E3A
		mov	ax, 1
		jmp	short loc_15E3C
; ---------------------------------------------------------------------------

loc_15E3A:
		xor	ax, ax

loc_15E3C:
		pop	dx
		test	dx, ax
		jz	short loc_15E45
		mov	[bp+var_3], 8

loc_15E45:
		push	di
		push	18h
		push	[si+combo_t.bonus]
		push	word ptr [bp+var_3]
		call	sub_D608
		cmp	[si+combo_t.COMBO_time], 0
		jnz	short @@player_next
		mov	ax, [bp+@@pid]
		imul	ax, PLAYFIELD_VRAM_W_BORDERED
		mov	di, ax
		add	ax, 4
		call	text_puts pascal, ax, 2, ds, offset _aBONUS_FRAME_SPACES
		lea	ax, [di+4]
		call	text_puts pascal, ax, 3, ds, offset _aBONUS_FRAME_SPACES
		mov	[si+combo_t.hits], 0
		call	score_add pascal, [si+combo_t.bonus], [bp+@@pid]
		mov	[si+combo_t.bonus], 0

@@player_next:
		inc	[bp+@@pid]
		add	si, size combo_t

@@player_more?:
		cmp	[bp+@@pid], PLAYER_COUNT
		jl	@@player_loop
		pop	di
		pop	si
		leave
		retf
_combo_update_and_render	endp

include th03/main/player/gauge_avail_add.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_15EDB	proc far

arg_0		= byte ptr  6
arg_2		= byte ptr  8
arg_4		= word ptr  0Ah

		push	bp
		mov	bp, sp
		push	si
		mov	si, 3ED6h
		xor	dx, dx
		jmp	short loc_15F20
; ---------------------------------------------------------------------------

loc_15EE6:
		cmp	byte ptr [si], 0
		jnz	short loc_15F1C
		mov	byte ptr [si], 3
		mov	word ptr [si+0Ah], 0
		mov	word ptr [si+0Ch], 0
		mov	byte ptr [si+20h], 0
		mov	ax, [bp+arg_4]
		mov	[si+0Eh], ax
		mov	al, [bp+arg_2]
		mov	[si+8],	al
		mov	al, byte_1F51C
		mov	[si+1Dh], al
		mov	al, byte_1F51D
		mov	[si+1Eh], al
		mov	al, [bp+arg_0]
		mov	[si+21h], al
		jmp	short loc_15F25
; ---------------------------------------------------------------------------

loc_15F1C:
		inc	dx
		add	si, 30h	; '0'

loc_15F20:
		cmp	dx, 28h	; '('
		jl	short loc_15EE6

loc_15F25:
		pop	si
		pop	bp
		retf	6
sub_15EDB	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_15F2A	proc near

var_5		= byte ptr -5
@@top		= word ptr -4
@@left		= word ptr -2

		enter	6, 0
		push	si
		mov	bx, word_2203C
		mov	al, [bx+6]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	si, [bx+82Ch]
		mov	bx, word_2203C
		mov	al, [bx+7]
		mov	ah, 0
		mov	dl, [bx+6]
		mov	dh, 0
		imul	dx
		add	ax, ax
		sub	si, ax
		mov	al, [bx+9]
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	[bp+var_5], al
		push	word ptr [bx+2]
		mov	al, [bx+8]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	dl, [bp+var_5]
		mov	dh, 0
		sub	ax, dx
		mov	[bp+@@left], ax
		mov	bx, word_2203C
		mov	ax, [bx+4]
		sar	ax, 4
		add	ax, 16
		mov	dl, [bp+var_5]
		mov	dh, 0
		sub	ax, dx
		mov	[bp+@@top], ax
		call	sprite16_put pascal, [bp+@@left], ax, si
		pop	si
		leave
		retn
sub_15F2A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_15F9D	proc near
		push	bp
		mov	bp, sp
		mov	bx, word_2203C
		cmp	byte ptr [bx+1], 0Ah
		jnz	short loc_15FB6
		mov	byte ptr [bx], 0Ah
		call	snd_se_play pascal, 3
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_15FB6:
		mov	bx, word_2203C
		cmp	byte ptr [bx+1], 20h ; ' '
		jnz	short loc_15FC5
		mov	byte ptr [bx], 9
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_15FC5:
		mov	bx, word_2203C
		cmp	byte ptr [bx+1], 24h ; '$'
		jb	short loc_15FD2
		mov	byte ptr [bx], 0

loc_15FD2:
		pop	bp
		retn
sub_15F9D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_15FD4	proc near

@@top		= word ptr -6
@@left		= word ptr -4
var_1		= byte ptr -1

		enter	6, 0
		push	si
		push	di
		mov	bx, word_2203C
		cmp	byte ptr [bx+1], 0Ah
		jnb	short loc_15FF4
		mov	al, [bx+6]
		mov	ah, 0
		shl	ax, 3
		mov	bx, ax
		mov	di, [bx+82Eh]
		jmp	short loc_16044
; ---------------------------------------------------------------------------

loc_15FF4:
		mov	bx, word_2203C
		cmp	byte ptr [bx+1], 20h ; ' '
		jnb	short loc_1602C
		mov	al, [bx+1]
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		mov	[bp+var_1], al
		mov	bx, word_2203C
		mov	al, [bx+6]
		mov	ah, 0
		shl	ax, 3
		mov	dl, [bp+var_1]
		mov	dh, 0
		and	dx, 1
		add	dx, dx
		add	ax, dx
		mov	bx, ax
		mov	di, [bx+830h]
		jmp	short loc_16044
; ---------------------------------------------------------------------------

loc_1602C:
		mov	bx, word_2203C
		cmp	byte ptr [bx+1], 24h ; '$'
		jnb	short loc_16044
		mov	al, [bx+6]
		mov	ah, 0
		shl	ax, 3
		mov	bx, ax
		mov	di, [bx+834h]

loc_16044:
		mov	bx, word_2203C
		mov	al, [bx+9]
		mov	ah, 0
		add	ax, 16
		mov	si, ax
		mov	bx, 16
		cwd
		idiv	bx
		mov	_sprite16_put_w, al
		mov	ax, si
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	_sprite16_put_h, ax
		sar	si, 1
		mov	bx, word_2203C
		push	word ptr [bx+2]
		mov	al, [bx+8]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		sub	ax, si
		mov	[bp+@@left], ax
		mov	bx, word_2203C
		mov	ax, [bx+4]
		sar	ax, 4
		add	ax, 16
		sub	ax, si
		mov	[bp+@@top], ax
		call	sprite16_put pascal, [bp+@@left], ax, di
		pop	di
		pop	si
		leave
		retn
sub_15FD4	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1609E	proc far
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	word_2203C, 3ED6h
		mov	byte_22036, 0
		mov	byte_22037, 0
		xor	si, si
		jmp	short loc_16129
; ---------------------------------------------------------------------------

loc_160B7:
		mov	bx, word_2203C
		cmp	byte ptr [bx], 0
		jz	short loc_16123
		mov	bx, word_2203C
		inc	byte ptr [bx+1]
		cmp	byte ptr [bx], 9
		jb	short loc_160D1
		call	sub_15F9D
		jmp	short loc_16123
; ---------------------------------------------------------------------------

loc_160D1:
		call	sub_13F2C
		or	al, al
		jnz	short loc_16123
		mov	bx, word_2203C
		mov	al, [bx+8]
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+4AD6h]
		mov	bx, word_2203C
		cmp	byte ptr [bx], 1
		jnz	short loc_16123
		mov	al, [bx+9]
		mov	ah, 0
		imul	ax, 3
		mov	bx, 10h
		cwd
		idiv	bx
		mov	di, ax
		mov	bx, word_2203C
		mov	ax, [bx+2]
		mov	word_220EE, ax
		mov	ax, [bx+4]
		mov	word_220F0, ax
		mov	word_220F2, di
		mov	word_220F4, di
		mov	al, [bx+8]
		mov	byte_220FA, al
		nopcall	sub_13A6E

loc_16123:
		inc	si
		add	word_2203C, 30h	; '0'

loc_16129:
		cmp	si, 28h	; '('
		jl	short loc_160B7
		call	sub_164AD
		pop	di
		pop	si
		pop	bp
		retf
sub_1609E	endp

include th03/main/player/hitcombo.asm

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1615D	proc near

@@hitcombo		= byte ptr -5
@@hitcombo_slot		= byte ptr -4
@@pid		= byte ptr -3
@@bonus_total		= word ptr -2

		enter	6, 0
		push	si
		mov	bx, word_2203C
		cmp	word ptr [bx+4], 0
		jle	loc_164AA
		mov	bx, word_2203C
		cmp	byte ptr [bx+9], 10h
		jz	short loc_16184
		mov	al, [bx+9]
		mov	ah, 0
		imul	ax, 7
		mov	si, ax
		jmp	short loc_16187
; ---------------------------------------------------------------------------

loc_16184:
		mov	si, 0A0h

loc_16187:
		mov	bx, word_2203C
		mov	al, [bx+8]
		mov	[bp+@@pid], al
		mov	ah, 0
		mov	bx, ax
		cmp	_damage_all_enemies_on[bx], 0
		jz	short loc_16212
		mov	bx, word_2203C
		mov	byte ptr [bx+7], 0
		mov	byte ptr [bx], 9
		mov	al, [bp+@@pid]
		mov	ah, 0
		mov	bx, ax
		mov	al, _hitcombo_ring_p[bx]
		mov	[bp+@@hitcombo_slot], al
		mov	bx, word_2203C
		mov	[bx+1Ch], al
		mov	al, [bp+@@pid]
		mov	ah, 0
		shl	ax, 4
		mov	dl, [bp+@@hitcombo_slot]
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		mov	_hitcombo_ring[bx], 1
		mov	al, [bp+@@pid]
		mov	ah, 0
		shl	ax, 4
		mov	dl, [bp+@@hitcombo_slot]
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		mov	byte ptr [bx+4AFEh], 0
		mov	al, [bp+@@pid]
		mov	ah, 0
		mov	bx, ax
		inc	_hitcombo_ring_p[bx]
		mov	al, [bp+@@pid]
		mov	ah, 0
		mov	bx, ax
		cmp	_hitcombo_ring_p[bx], HITCOMBO_RING_SIZE
		jb	loc_164A2
		mov	al, [bp+@@pid]
		mov	ah, 0
		mov	bx, ax
		mov	_hitcombo_ring_p[bx], 0
		jmp	loc_164A2
; ---------------------------------------------------------------------------

loc_16212:
		mov	bx, word_2203C
		mov	ax, [bx+2]
		mov	word_20E2E, ax
		mov	ax, [bx+4]
		mov	word_20E30, ax
		mov	word_20E32, si
		mov	word_20E34, si
		mov	al, [bx+8]
		mov	pid_20E3A, al
		cmp	word_20E30, 0
		jl	loc_164AA
		nopcall	sub_158F5
		or	al, al
		jz	loc_164AA
		mov	bx, word_2203C
		cmp	byte ptr [bx+7], 0
		jz	short loc_16257
		cmp	byte_26356, 0
		jz	loc_1649B

loc_16257:
		mov	bx, word_2203C
		mov	byte ptr [bx], 9
		mov	byte_220C3, 1
		cmp	byte_2203B, 0
		jnz	short loc_162D5
		mov	al, [bp+@@pid]
		mov	ah, 0
		mov	bx, ax
		mov	al, _hitcombo_ring_p[bx]
		mov	[bp+@@hitcombo_slot], al
		mov	bx, word_2203C
		mov	[bx+1Ch], al
		mov	al, [bp+@@pid]
		mov	ah, 0
		shl	ax, 4
		mov	dl, [bp+@@hitcombo_slot]
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		mov	_hitcombo_ring[bx], 1
		mov	al, [bp+@@pid]
		mov	ah, 0
		shl	ax, 4
		mov	dl, [bp+@@hitcombo_slot]
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		mov	byte ptr [bx+4AFEh], 0
		mov	al, [bp+@@pid]
		mov	ah, 0
		mov	bx, ax
		inc	_hitcombo_ring_p[bx]
		mov	al, [bp+@@pid]
		mov	ah, 0
		mov	bx, ax
		cmp	_hitcombo_ring_p[bx], HITCOMBO_RING_SIZE
		jb	loc_16484
		mov	al, [bp+@@pid]
		mov	ah, 0
		mov	bx, ax
		mov	_hitcombo_ring_p[bx], 0
		jmp	loc_16484
; ---------------------------------------------------------------------------

loc_162D5:
		call	gauge_avail_add pascal, word ptr [bp+@@pid], 32
		mov	al, hitcombo_slot_220C2
		mov	[bp+@@hitcombo_slot], al
		mov	bx, word_2203C
		mov	[bx+1Ch], al
		mov	al, [bp+@@pid]
		mov	ah, 0
		shl	ax, 4
		mov	dl, [bp+@@hitcombo_slot]
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		mov	al, _hitcombo_ring[bx]
		mov	[bp+@@hitcombo], al
		cmp	[bp+@@hitcombo], 255
		jnb	short loc_1630B
		inc	[bp+@@hitcombo]

loc_1630B:
		mov	al, [bp+@@pid]
		mov	ah, 0
		shl	ax, 4
		mov	dl, [bp+@@hitcombo_slot]
		mov	dh, 0
		add	ax, dx
		mov	dl, [bp+@@hitcombo]
		mov	bx, ax
		mov	_hitcombo_ring[bx], dl
		push	word ptr [bp+@@pid]
		push	word ptr [bp+@@hitcombo_slot]
		mov	al, [bp+@@hitcombo]
		mov	ah, 0
		shl	ax, 4
		push	ax
		call	hitcombo_commit
		mov	[bp+@@bonus_total], ax
		push	ax
		push	word ptr [bp+@@pid]
		call	sub_165B5
		mov	bx, word_2203C
		mov	ax, [bx+2]
		mov	word_23E3E, ax
		mov	ax, [bx+4]
		mov	word_23E40, ax
		push	18h
		call	sub_13EFF
		mov	byte_23E42, al
		mov	angle_23E43, 0
		mov	al, [bp+@@pid]
		mov	_pid_other, al
		mov	al, byte_23AF8
		mov	ah, 0
		mov	bx, 20h	; ' '
		cwd
		idiv	bx
		mov	[bp+@@hitcombo_slot], al
		cmp	[bp+@@hitcombo], 2
		ja	short loc_1638E
		mov	al, [bp+@@pid]
		mov	ah, 0
		shl	ax, 4
		mov	dl, [bp+@@hitcombo_slot]
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		inc	byte ptr [bx+4B1Eh]
		jmp	loc_1646E
; ---------------------------------------------------------------------------

loc_1638E:
		mov	al, [bp+@@hitcombo]
		mov	ah, 0
		mov	dl, [bp+@@hitcombo_slot]
		mov	dh, 0
		mov	bx, 9
		sub	bx, dx
		cmp	ax, bx
		jg	short loc_163DA
		mov	byte_23E45, 1Dh
		nopcall	sub_17971
		mov	al, [bp+@@pid]
		mov	ah, 0
		shl	ax, 4
		mov	dl, [bp+@@hitcombo_slot]
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		mov	al, [bx+4B1Eh]
		add	al, 2
		mov	dl, [bp+@@pid]
		mov	dh, 0
		shl	dx, 4
		mov	bl, [bp+@@hitcombo_slot]
		mov	bh, 0
		add	dx, bx
		mov	bx, dx
		mov	[bx+4B1Eh], al
		jmp	loc_1646E
; ---------------------------------------------------------------------------

loc_163DA:
		mov	al, [bp+@@hitcombo]
		mov	ah, 0
		mov	dl, [bp+@@hitcombo_slot]
		mov	dh, 0
		add	dx, dx
		mov	bx, 0Eh
		sub	bx, dx
		cmp	ax, bx
		jg	short loc_1642D
		mov	al, [bp+@@pid]
		mov	ah, 0
		shl	ax, 4
		mov	dl, [bp+@@hitcombo_slot]
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		mov	al, [bx+4B1Eh]
		add	al, 3
		mov	dl, [bp+@@pid]
		mov	dh, 0
		shl	dx, 4
		mov	bl, [bp+@@hitcombo_slot]
		mov	bh, 0
		add	dx, bx
		mov	bx, dx
		mov	[bx+4B1Eh], al
		test	[bp+@@hitcombo], 1
		jnz	short loc_1646E
		mov	byte_23E45, 1Dh
		nopcall	sub_17971
		jmp	short loc_16459
; ---------------------------------------------------------------------------

loc_1642D:
		mov	al, [bp+@@pid]
		mov	ah, 0
		shl	ax, 4
		mov	dl, [bp+@@hitcombo_slot]
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		mov	al, [bx+4B1Eh]
		add	al, 4
		mov	dl, [bp+@@pid]
		mov	dh, 0
		shl	dx, 4
		mov	bl, [bp+@@hitcombo_slot]
		mov	bh, 0
		add	dx, bx
		mov	bx, dx
		mov	[bx+4B1Eh], al

loc_16459:
		mov	al, [bp+@@pid]
		mov	ah, 0
		shl	ax, 4
		mov	dl, [bp+@@hitcombo_slot]
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		inc	byte ptr [bx+4B3Eh]

loc_1646E:
		push	word ptr [bp+@@pid]
		mov	al, [bp+@@hitcombo_slot]
		mov	ah, 0
		push	ax
		call	sub_1816D
		push	word ptr [bp+@@pid]
		push	word_2203C
		call	sub_1654E

loc_16484:
		mov	bx, word_2203C
		mov	al, [bx+6]
		mov	ah, 0
		imul	ax, 10
		call	score_add pascal, ax, word ptr [bp+@@pid]
		jmp	short loc_164A2
; ---------------------------------------------------------------------------

loc_1649B:
		mov	bx, word_2203C
		dec	byte ptr [bx+7]

loc_164A2:
		mov	bx, word_2203C
		mov	byte ptr [bx+1], 0

loc_164AA:
		pop	si
		leave
		retn
sub_1615D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_164AD	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	byte_2203A, 0
		mov	word_2203C, 4626h
		mov	si, 27h	; '''
		jmp	short loc_164D3
; ---------------------------------------------------------------------------

loc_164C1:
		mov	bx, word_2203C
		cmp	byte ptr [bx], 1
		jnz	short loc_164CD
		call	sub_1615D

loc_164CD:
		dec	si
		sub	word_2203C, 30h	; '0'

loc_164D3:
		or	si, si
		jge	short loc_164C1
		pop	si
		pop	bp
		retn
sub_164AD	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_164DA	proc far
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	word_2203C, 3ED6h
		xor	di, di
		jmp	short loc_16545
; ---------------------------------------------------------------------------

loc_164E9:
		mov	si, word_2203C
		cmp	byte ptr [si], 0
		jz	short loc_1653F
		cmp	byte ptr [si], 3
		jz	short loc_1653F
		mov	al, [si+9]
		mov	ah, 0
		mov	bx, 10h
		cwd
		idiv	bx
		mov	_sprite16_put_w, al
		mov	al, [si+9]
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	_sprite16_put_h, ax
		cmp	byte ptr [si+8], 0
		jnz	short loc_16526
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_16532
; ---------------------------------------------------------------------------

loc_16526:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_16532:
		cmp	byte ptr [si], 1
		jnz	short loc_1653C
		call	sub_15F2A
		jmp	short loc_1653F
; ---------------------------------------------------------------------------

loc_1653C:
		call	sub_15FD4

loc_1653F:
		inc	di
		add	word_2203C, 30h	; '0'

loc_16545:
		cmp	di, 28h	; '('
		jl	short loc_164E9
		pop	di
		pop	si
		pop	bp
		retf
sub_164DA	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1654E	proc near

var_2		= word ptr -2
arg_0		= word ptr  4
arg_2		= byte ptr  6

		enter	2, 0
		mov	al, [bp+arg_2]
		mov	ah, 0
		shl	ax, 4
		mov	dl, hitcombo_slot_220C2
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		mov	al, [bx+4B1Eh]
		mov	ah, 0
		mov	dl, byte_23AF8
		mov	dh, 0
		mov	bx, 10h
		push	ax
		mov	ax, dx
		cwd
		idiv	bx
		mov	dx, 0Ch
		sub	dx, ax
		pop	ax
		cmp	ax, dx
		jl	short locret_165B1
		mov	al, [bp+arg_2]
		mov	ah, 0
		shl	ax, 4
		mov	dl, hitcombo_slot_220C2
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		mov	byte ptr [bx+4B1Eh], 0
		mov	ax, word_2203C
		mov	[bp+var_2], ax
		mov	ax, [bp+arg_0]
		mov	word_2203C, ax
		nopcall	sub_17DAE
		mov	ax, [bp+var_2]
		mov	word_2203C, ax

locret_165B1:
		leave
		retn	4
sub_1654E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_165B5	proc near

arg_0		= byte ptr  4
arg_2		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_2]
		mov	cl, [bp+arg_0]
		cmp	si, word_21434
		jb	loc_166FD
		mov	al, cl
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+798h], 0
		jnz	loc_16708
		cmp	byte_1DB9E, cl
		jz	loc_1667D
		mov	al, cl
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 5
		jz	loc_16708
		mov	al, cl
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+393Ch], 5
		mov	al, cl
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+798h], 1
		mov	al, cl
		mov	ah, 0
		shl	ax, 4
		mov	dl, hitcombo_slot_220C2
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		mov	byte ptr [bx+4AFEh], 0
		mov	al, cl
		mov	ah, 0
		shl	ax, 4
		mov	dl, hitcombo_slot_220C2
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		mov	byte ptr [bx+4B1Eh], 0
		mov	al, cl
		mov	ah, 0
		shl	ax, 4
		mov	dl, hitcombo_slot_220C2
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		mov	byte ptr [bx+4B3Eh], 0
		add	word_21434, 1400h
		cmp	byte_1F39E, 10h
		jnb	short loc_16656
		inc	byte_1F39E

loc_16656:
		cmp	byte_1DB9E, -1
		jnz	short loc_1666D
		mov	al, cl
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		inc	_players[bx].boss_attacks_fired
		jmp	loc_16708
; ---------------------------------------------------------------------------

loc_1666D:
		mov	al, cl
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		inc	_players[bx].boss_attacks_reversed
		jmp	loc_16708
; ---------------------------------------------------------------------------

loc_1667D:
		cmp	si, 7530h
		jb	loc_16708
		mov	al, cl
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+4AD8h], 0
		jnz	short loc_16708
		mov	al, cl
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jnz	short loc_16708
		mov	al, cl
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+393Ch], 3
		mov	al, cl
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+798h], 1
		mov	al, cl
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+4AD8h], 1
		mov	al, cl
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D56h]
		add	al, 3
		mov	dl, cl
		mov	dh, 0
		mov	bx, dx
		mov	[bx+2D56h], al
		mov	al, cl
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D56h], 10h
		jbe	short loc_166EE
		mov	al, cl
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+2D56h], 10h

loc_166EE:
		mov	al, cl
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		inc	_players[bx].boss_panics_fired
		jmp	short loc_16708
; ---------------------------------------------------------------------------

loc_166FD:
		mov	al, cl
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+4AD8h], 0

loc_16708:
		pop	si
		pop	bp
		retn	4
sub_165B5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1670D	proc far

var_E		= byte ptr -0Eh
@@hitcombo		= byte ptr -0Dh
var_C		= word ptr -0Ch
@@bonus		= word ptr -0Ah
var_8		= word ptr -8
var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2

		enter	0Eh, 0
		push	si
		push	di
		mov	[bp+var_C], 0
		cmp	byte_2203A, 1
		jnz	short loc_16725
		mov	[bp+var_E], 1
		jmp	short loc_16730
; ---------------------------------------------------------------------------

loc_16725:
		mov	al, byte_2203A
		mov	ah, 0
		imul	ax, 3
		mov	[bp+var_E], al

loc_16730:
		mov	si, 3ED6h
		mov	byte_2203B, 0
		mov	[bp+var_2], 0
		jmp	loc_16974
; ---------------------------------------------------------------------------

loc_16740:
		cmp	byte ptr [si], 9
		jb	loc_1696E
		cmp	byte_2203A, 0
		jnz	short loc_16769
		cmp	byte ptr [si], 9
		jz	loc_1696E
		mov	al, [si]
		mov	ah, 0
		mov	dl, [si+6]
		mov	dh, 0
		add	dx, dx
		add	dx, 0Ah
		cmp	ax, dx
		jge	loc_1696E

loc_16769:
		mov	al, [si+8]
		cmp	al, pid_20E3A
		jnz	loc_1696E
		test	byte ptr [si+1], 3
		jnz	loc_1696E
		mov	al, [si+9]
		mov	ah, 0
		imul	ax, 6
		mov	[bp+var_8], ax
		mov	ax, [si+2]
		sub	ax, [bp+var_8]
		mov	[bp+var_4], ax
		mov	ax, [si+4]
		sub	ax, [bp+var_8]
		mov	[bp+var_6], ax
		mov	ax, word_20E36
		cmp	ax, [bp+var_4]
		jl	loc_1696E
		mov	ax, word_20E38
		cmp	ax, [bp+var_6]
		jl	loc_1696E
		shl	[bp+var_8], 1
		mov	ax, [bp+var_8]
		add	[bp+var_4], ax
		add	[bp+var_6], ax
		mov	ax, word_20E2E
		cmp	ax, [bp+var_4]
		jg	loc_1696E
		mov	ax, word_20E30
		cmp	ax, [bp+var_6]
		jg	loc_1696E
		mov	al, [si+1Ch]
		mov	hitcombo_slot_220C2, al
		cmp	byte_2203A, 0
		jnz	short loc_167DF
		inc	byte ptr [si]
		jmp	loc_16966
; ---------------------------------------------------------------------------

loc_167DF:
		mov	al, pid_20E3A
		mov	ah, 0
		shl	ax, 4
		mov	dl, hitcombo_slot_220C2
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		mov	al, _hitcombo_ring[bx]
		mov	[bp+@@hitcombo], al
		cmp	[bp+@@hitcombo], 255
		jnb	short loc_16801
		inc	[bp+@@hitcombo]

loc_16801:
		mov	al, pid_20E3A
		mov	ah, 0
		shl	ax, 4
		mov	dl, hitcombo_slot_220C2
		mov	dh, 0
		add	ax, dx
		mov	dl, [bp+@@hitcombo]
		mov	bx, ax
		mov	_hitcombo_ring[bx], dl
		cmp	[bp+var_E], 1
		jnz	short loc_1682E
		mov	al, [bp+@@hitcombo]
		mov	ah, 0
		add	ax, ax
		mov	[bp+@@bonus], ax
		push	1
		jmp	short loc_1685C
; ---------------------------------------------------------------------------

loc_1682E:
		cmp	[bp+var_E], 6
		jnz	short loc_16846
		mov	al, [bp+@@hitcombo]
		mov	ah, 0
		shl	ax, 4
		add	ax, 100
		mov	[bp+@@bonus], ax
		push	40
		jmp	short loc_1685C
; ---------------------------------------------------------------------------

loc_16846:
		cmp	[bp+var_E], 9
		jnz	short loc_16865
		mov	al, [bp+@@hitcombo]
		mov	ah, 0
		shl	ax, 4
		add	ax, 444
		mov	[bp+@@bonus], ax
		push	80

loc_1685C:
		push	word ptr pid_20E3A
		call	score_add

loc_16865:
		mov	al, byte_23AF8
		mov	ah, 0
		add	[bp+@@bonus], ax
		cmp	byte_23AF8, 30h	; '0'
		ja	short loc_16879
		sar	[bp+@@bonus], 1
		jmp	short loc_16886
; ---------------------------------------------------------------------------

loc_16879:
		cmp	byte_23AF8, 60h
		jb	short loc_16886
		mov	ax, [bp+@@bonus]
		add	[bp+@@bonus], ax

loc_16886:
		mov	al, pid_20E3A
		mov	ah, 0
		shl	ax, 4
		mov	dl, hitcombo_slot_220C2
		mov	dh, 0
		add	ax, dx
		add	ax, 4AFEh
		mov	di, ax
		mov	al, [bp+var_E]
		add	[di], al
		mov	al, [di]
		mov	[bp+@@hitcombo], al
		mov	al, pid_20E3A
		mov	ah, 0
		shl	ax, 4
		mov	dl, hitcombo_slot_220C2
		mov	dh, 0
		add	ax, dx
		add	ax, 4B1Eh
		mov	di, ax
		cmp	[bp+var_E], 1
		jnz	short loc_168C8
		push	word ptr pid_20E3A
		push	4
		jmp	short loc_168D5
; ---------------------------------------------------------------------------

loc_168C8:
		push	word ptr pid_20E3A
		mov	al, [bp+var_E]
		mov	ah, 0
		imul	ax, 3
		push	ax

loc_168D5:
		call	gauge_avail_add
		cmp	[bp+@@hitcombo], 4
		jnb	short loc_168E4
		mov	al, [di]
		add	al, 2
		jmp	short loc_168EE
; ---------------------------------------------------------------------------

loc_168E4:
		cmp	[bp+@@hitcombo], 10
		jnb	short loc_168F2
		mov	al, [di]
		add	al, 5

loc_168EE:
		mov	[di], al
		jmp	short loc_16945
; ---------------------------------------------------------------------------

loc_168F2:
		cmp	[bp+@@hitcombo], 20
		jnb	short loc_16916
		mov	al, [di]
		add	al, 2
		mov	[di], al
		mov	al, pid_20E3A
		mov	ah, 0
		shl	ax, 4
		mov	dl, hitcombo_slot_220C2
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		inc	byte ptr [bx+4B3Eh]
		jmp	short loc_16945
; ---------------------------------------------------------------------------

loc_16916:
		mov	al, pid_20E3A
		mov	ah, 0
		shl	ax, 4
		mov	dl, hitcombo_slot_220C2
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		mov	al, [bx+4B3Eh]
		add	al, 2
		mov	dl, pid_20E3A
		mov	dh, 0
		shl	dx, 4
		mov	bl, hitcombo_slot_220C2
		mov	bh, 0
		add	dx, bx
		mov	bx, dx
		mov	[bx+4B3Eh], al

loc_16945:
		call	hitcombo_commit pascal, word ptr pid_20E3A, word ptr hitcombo_slot_220C2, [bp+@@bonus]
		mov	[bp+@@bonus], ax
		push	ax
		push	word ptr pid_20E3A
		call	sub_165B5
		push	word ptr pid_20E3A
		push	si
		call	sub_1654E

loc_16966:
		inc	[bp+var_C]
		mov	byte_2203B, 1

loc_1696E:
		inc	[bp+var_2]
		add	si, 30h	; '0'

loc_16974:
		cmp	[bp+var_2], 40h
		jl	loc_16740
		mov	al, byte ptr [bp+var_C]
		pop	di
		pop	si
		leave
		retf
sub_1670D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_16983	proc far

arg_0		= byte ptr  6

		push	bp
		mov	bp, sp
		push	si
		mov	dl, -1
		mov	al, [bp+arg_0]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		cmp	word ptr [bx+1DCAh], 0
		jz	short loc_169AD
		mov	byte_20E48, -2
		mov	ax, word_1F326
		mov	word_2142E, ax
		mov	ax, word_1F328
		mov	word_21430, ax
		jmp	loc_16A50
; ---------------------------------------------------------------------------

loc_169AD:
		mov	si, 3ED6h
		xor	cx, cx
		jmp	short loc_169EF
; ---------------------------------------------------------------------------

loc_169B4:
		cmp	byte ptr [si], 1
		jnz	short loc_169EB
		mov	al, [si+8]
		cmp	al, [bp+arg_0]
		jnz	short loc_169EB
		cmp	word ptr [si+2], 0
		jl	short loc_169EB
		cmp	word ptr [si+2], 1200h
		jg	short loc_169EB
		cmp	word ptr [si+4], 0
		jl	short loc_169EB
		cmp	word ptr [si+4], 1800h
		jg	short loc_169EB
		cmp	[si+1Eh], dl
		jnb	short loc_169EB
		mov	dl, [si+1Eh]
		mov	word_2203C, si
		or	dl, dl
		jz	short loc_169F4

loc_169EB:
		inc	cx
		add	si, 30h	; '0'

loc_169EF:
		cmp	cx, 28h	; '('
		jl	short loc_169B4

loc_169F4:
		cmp	dl, -1
		jnz	short loc_16A0C
		mov	word_2142E, 900h
		mov	word_21430, 12C0h
		mov	byte_20E48, -1
		jmp	short loc_16A50
; ---------------------------------------------------------------------------

loc_16A0C:
		mov	bx, word_2203C
		mov	ax, [bx+2]
		add	ax, 0FF00h
		mov	word_2142E, ax
		mov	ax, [bx+4]
		add	ax, 6E0h
		mov	word_21430, ax
		mov	byte_20E48, dl
		cmp	word_2142E, 0
		jle	short loc_16A44
		cmp	word_2142E, 1200h
		jge	short loc_16A44
		cmp	word_21430, 0
		jle	short loc_16A44
		cmp	word_21430, 1800h
		jl	short loc_16A50

loc_16A44:
		mov	word_2142E, 900h
		mov	word_21430, 12C0h

loc_16A50:
		pop	si
		pop	bp
		retf	2
sub_16983	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_16A55	proc far
		push	bp
		mov	bp, sp
		mov	byte_220E0, 0
		mov	byte_220E6, 0
		pop	bp
		retf
sub_16A55	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_ADD_YUMEMI
chargeshot_add_yumemi	proc far

@@center_y	= word ptr  6
@@center_x	= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		imul	ax, 6
		add	ax, 4B80h
		mov	si, ax
		mov	byte ptr [si], 1
		mov	byte ptr [si+1], 0
		mov	ax, [bp+@@center_x]
		mov	[si+2],	ax
		mov	ax, [bp+@@center_y]
		mov	[si+4],	ax
		pop	si
		pop	bp
		retf	4
chargeshot_add_yumemi	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_UPDATE_YUMEMI
chargeshot_update_yumemi	proc far

var_1		= byte ptr -1

		enter	2, 0
		push	si
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 6
		add	ax, 4B80h
		mov	si, ax
		cmp	byte ptr [si], 0
		jz	short loc_16B09
		mov	al, [si+1]
		inc	al
		mov	[si+1],	al
		mov	[bp+var_1], al
		cmp	byte ptr [si], 1
		jnz	short loc_16AD4
		sub	word ptr [si+4], 40h
		cmp	[bp+var_1], 40h
		jnb	short loc_16AC4
		cmp	word ptr [si+4], 0
		jg	short loc_16AF9

loc_16AC4:
		mov	byte ptr [si], 2
		mov	byte ptr [si+1], 0
		call	snd_se_play pascal, 7
		jmp	short loc_16AF9
; ---------------------------------------------------------------------------

loc_16AD4:
		cmp	[bp+var_1], 18h
		jb	short loc_16AF0
		mov	al, [bp+var_1]
		mov	ah, 0
		mov	bx, 2
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_16AF0
		call	snd_se_play pascal, 15

loc_16AF0:
		cmp	[bp+var_1], 40h
		jb	short loc_16AF9
		mov	byte ptr [si], 0

loc_16AF9:
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	_players[bx].gauge_charged, 0

loc_16B09:
		pop	si
		leave
		retf
chargeshot_update_yumemi	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

yumemi_16B0C	proc far
		push	bp
		mov	bp, sp
		push	si
		mov	al, pid_20E3A
		mov	ah, 0
		imul	ax, 6
		add	ax, 4B80h
		mov	si, ax
		cmp	byte ptr [si], 0
		jz	loc_16BB0
		cmp	byte ptr [si], 1
		jnz	short loc_16B69
		mov	ax, [si+2]
		add	ax, 0FF80h
		cmp	ax, word_20E36
		jg	short loc_16BB0
		mov	ax, [si+2]
		add	ax, 80h
		cmp	ax, word_20E2E
		jl	short loc_16BB0
		mov	ax, [si+4]
		add	ax, 0FF80h
		cmp	ax, word_20E38
		jg	short loc_16BB0
		mov	ax, [si+4]
		add	ax, 80h
		cmp	ax, word_20E30
		jl	short loc_16BB0
		mov	byte ptr [si], 2
		mov	byte ptr [si+1], 0
		call	snd_se_play pascal, 7
		jmp	short loc_16BB0
; ---------------------------------------------------------------------------

loc_16B69:
		mov	ax, [si+2]
		add	ax, 0FC80h
		cmp	ax, word_20E36
		jg	short loc_16BB0
		mov	ax, [si+2]
		add	ax, 380h
		cmp	ax, word_20E2E
		jl	short loc_16BB0
		mov	ax, [si+4]
		add	ax, 0FC80h
		cmp	ax, word_20E38
		jg	short loc_16BB0
		mov	ax, [si+4]
		add	ax, 380h
		cmp	ax, word_20E30
		jl	short loc_16BB0
		push	word_20E2E
		push	word_20E30
		mov	al, pid_20E3A
		mov	ah, 0
		push	ax
		call	sub_B73A
		mov	al, 1
		jmp	short loc_16BB2
; ---------------------------------------------------------------------------

loc_16BB0:
		mov	al, 0

loc_16BB2:
		pop	si
		pop	bp
		retf
yumemi_16B0C	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_16BB5	proc near

var_A		= byte ptr -0Ah
var_9		= byte ptr -9
var_8		= word ptr -8
var_6		= word ptr -6
var_4		= word ptr -4
@@top		= word ptr -2
arg_0		= byte ptr  4
@@length		= word ptr  6
@@sprite_offset		= word ptr  8

		enter	0Ah, 0
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 6
		add	ax, 4B80h
		mov	si, ax
		mov	al, [si+1]
		mov	[bp+var_9], al
		mov	ax, [si+2]
		add	ax, 0FF00h
		mov	[bp+var_6], ax
		mov	ax, [si+4]
		add	ax, 0FF00h
		mov	[bp+var_8], ax
		mov	[bp+var_4], 0
		mov	al, [bp+var_9]
		add	al, al
		jmp	short loc_16C56
; ---------------------------------------------------------------------------

loc_16BEC:
		mov	al, [bp+var_A]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, [bp+var_6], [bp+@@length], _CosTable8[bx]
		mov	di, ax
		mov	al, [bp+var_A]
		add	al, [bp+arg_0]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, [bp+var_8], [bp+@@length], _SinTable8[bx]
		mov	[bp+@@top], ax
		push	di
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	di, ax
		mov	ax, [bp+@@top]
		sar	ax, 4
		add	ax, 16
		mov	[bp+@@top], ax
		call	sprite16_put pascal, di, ax, [bp+@@sprite_offset]
		inc	[bp+var_4]
		mov	al, [bp+var_A]
		add	al, 10h

loc_16C56:
		mov	[bp+var_A], al
		cmp	[bp+var_4], 10h
		jl	short loc_16BEC
		pop	di
		pop	si
		leave
		retn	6
sub_16BB5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_RENDER_YUMEMI
chargeshot_render_yumemi	proc far

var_5		= byte ptr -5
@@top		= word ptr -4
@@left		= word ptr -2

		enter	6, 0
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 6
		add	ax, 4B80h
		mov	di, ax
		cmp	byte ptr [di], 0
		jz	loc_16DC4
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 16
		cmp	_pid_current, 0
		jnz	short loc_16C9F
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_16CAB
; ---------------------------------------------------------------------------

loc_16C9F:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_16CAB:
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 0C80h
		mov	si, ax
		mov	al, [di+1]
		mov	[bp+var_5], al
		test	[bp+var_5], 1
		jz	short loc_16CC4
		add	si, 4

loc_16CC4:
		cmp	byte ptr [di], 1
		jnz	short loc_16CF3
		push	word ptr [di+2]
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -16
		mov	[bp+@@left], ax
		mov	ax, [di+4]
		sar	ax, 4
		mov	[bp+@@top], ax
		call	sprite16_put pascal, [bp+@@left], ax, si
		jmp	loc_16DC4
; ---------------------------------------------------------------------------

loc_16CF3:
		add	si, 500h
		cmp	[bp+var_5], 8
		jnb	short loc_16D06
		push	si
		mov	al, [bp+var_5]
		mov	ah, 0
		jmp	loc_16DB8
; ---------------------------------------------------------------------------

loc_16D06:
		cmp	[bp+var_5], 10h
		jnb	short loc_16D21
		push	si
		mov	al, [bp+var_5]
		mov	ah, 0
		add	ax, 0FFF9h
		shl	ax, 3
		shl	ax, 4
		push	ax
		push	20h ; ' '
		jmp	loc_16DC1
; ---------------------------------------------------------------------------

loc_16D21:
		cmp	[bp+var_5], 18h
		jnb	short loc_16D32
		push	si
		mov	al, [bp+var_5]
		mov	ah, 0
		add	ax, 0FFF1h
		jmp	short loc_16D6C
; ---------------------------------------------------------------------------

loc_16D32:
		cmp	[bp+var_5], 20h	; ' '
		jnb	short loc_16D43
		push	si
		mov	al, [bp+var_5]
		mov	ah, 0
		add	ax, 0FFE8h
		jmp	short loc_16DB8
; ---------------------------------------------------------------------------

loc_16D43:
		cmp	[bp+var_5], 28h	; '('
		jnb	short loc_16D5D
		push	si
		mov	al, [bp+var_5]
		mov	ah, 0
		add	ax, 0FFE1h
		shl	ax, 3
		shl	ax, 4
		push	ax
		push	20h ; ' '
		jmp	short loc_16DC1
; ---------------------------------------------------------------------------

loc_16D5D:
		cmp	[bp+var_5], 30h	; '0'
		jnb	short loc_16D78
		push	si
		mov	al, [bp+var_5]
		mov	ah, 0
		add	ax, 0FFD9h

loc_16D6C:
		shl	ax, 3
		shl	ax, 4
		push	ax
		push	0E0h
		jmp	short loc_16DC1
; ---------------------------------------------------------------------------

loc_16D78:
		cmp	[bp+var_5], 40h
		jnb	short loc_16DC4
		cmp	[bp+var_5], 38h	; '8'
		jnb	short loc_16DAF
		push	si
		mov	al, [bp+var_5]
		mov	ah, 0
		add	ax, 0FFD1h
		shl	ax, 3
		shl	ax, 4
		push	ax
		push	20h ; ' '
		call	sub_16BB5
		push	si
		mov	al, [bp+var_5]
		mov	ah, 0
		add	ax, 0FFD1h
		shl	ax, 3
		shl	ax, 4
		push	ax
		push	0E0h
		call	sub_16BB5

loc_16DAF:
		push	si
		mov	al, [bp+var_5]
		mov	ah, 0
		add	ax, 0FFD0h

loc_16DB8:
		shl	ax, 3
		shl	ax, 4
		push	ax
		push	0

loc_16DC1:
		call	sub_16BB5

loc_16DC4:
		pop	di
		pop	si
		leave
		retf
chargeshot_render_yumemi	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_16DC8	proc near

var_4		= word ptr -4
var_2		= byte ptr -2
@@pid_other		= byte ptr -1
arg_0		= word ptr  4

		enter	4, 0
		push	si
		push	di
		mov	[bp+var_2], 1
		cmp	[bp+arg_0], 2
		jnz	short loc_16DE0
		mov	al, [bp+var_2]
		add	al, 2
		mov	[bp+var_2], al

loc_16DE0:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D54h]
		cmp	al, [bp+var_2]
		jnz	short loc_16E42
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+4B7Eh], 0
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+2D54h]
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D56h]
		add	al, 18h
		mov	dl, _pid_current
		mov	dh, 0
		shl	dx, 2
		mov	bx, dx
		mov	[bx+2D58h], al
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D56h]
		add	al, 20h	; ' '
		mov	dl, _pid_current
		mov	dh, 0
		shl	dx, 2
		mov	bx, dx
		mov	[bx+2D59h], al
		jmp	loc_16F9A
; ---------------------------------------------------------------------------

loc_16E42:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D54h]
		mov	ah, 0
		mov	dl, [bp+var_2]
		mov	dh, 0
		inc	dx
		cmp	ax, dx
		jnz	loc_16F9A
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+4B7Eh]
		mov	ah, 0
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_16F8F
		mov	al, byte ptr [bp+arg_0]
		mov	byte_23E4E, al
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		mov	al, [bx+2D59h]
		mov	byte_23E42, al
		mov	al, [bp+@@pid_other]
		mov	_pid_other, al
		mov	angle_23E43, 0
		mov	byte_23E45, 2Ch ; ','
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		mov	al, [bx+2D58h]
		mov	byte_23E47, al
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+4B7Eh]
		mov	ah, 0
		mov	[bp+var_4], ax
		mov	cx, 8		; switch 8 cases
		mov	bx, offset word_16FA0

loc_16ECB:
		mov	ax, cs:[bx]
		cmp	ax, [bp+var_4]
		jz	short loc_16EDB
		add	bx, 2
		loop	loc_16ECB
		jmp	loc_16F61	; default
; ---------------------------------------------------------------------------

loc_16EDB:
		jmp	word ptr cs:[bx+10h] ; switch jump

loc_16EDF:
		mov	si, 900h	; jumptable 00016EDB case 0
		mov	di, 200h
		jmp	short loc_16F61	; default
; ---------------------------------------------------------------------------

loc_16EE7:
		mov	si, 600h	; jumptable 00016EDB case 8
		mov	di, 500h
		jmp	short loc_16F61	; default
; ---------------------------------------------------------------------------

loc_16EEF:
		mov	si, 0C00h	; jumptable 00016EDB case 16
		mov	di, 500h
		mov	word_23E3E, 900h
		mov	word_23E40, 200h
		jmp	short loc_16F61	; default
; ---------------------------------------------------------------------------

loc_16F03:
		mov	si, 600h	; jumptable 00016EDB case 24
		mov	di, 380h
		mov	word_23E3E, 600h
		jmp	short loc_16F1D
; ---------------------------------------------------------------------------

loc_16F11:
		mov	si, 0C00h	; jumptable 00016EDB case 32
		mov	di, 380h
		mov	word_23E3E, 0C00h

loc_16F1D:
		mov	word_23E40, 500h
		jmp	short loc_16F61	; default
; ---------------------------------------------------------------------------

loc_16F25:
		mov	si, 900h	; jumptable 00016EDB case 40
		mov	di, 680h
		mov	word_23E3E, 600h

loc_16F31:
		mov	word_23E40, 380h
		jmp	short loc_16F61	; default
; ---------------------------------------------------------------------------

loc_16F39:
		mov	word_23E3E, 0C00h ; jumptable 00016EDB case 48
		jmp	short loc_16F31
; ---------------------------------------------------------------------------

loc_16F41:
		mov	word_23E3E, 900h ; jumptable 00016EDB case 56
		mov	word_23E40, 680h
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+2D54h], 0
		push	word ptr [bp+@@pid_other]
		call	sub_A3A8

loc_16F61:
		mov	al, _pid_current	; default
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+4B7Eh], 28h ; '('
		ja	short loc_16F7C
		push	si
		push	di
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE5B

loc_16F7C:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+4B7Eh], 10h
		jb	short loc_16F8F
		nopcall	sub_17730

loc_16F8F:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+4B7Eh]

loc_16F9A:
		pop	di
		pop	si
		leave
		retn	2
sub_16DC8	endp

; ---------------------------------------------------------------------------
word_16FA0	dw	0,     8,   10h,   18h
		dw    20h,   28h,   30h,   38h ; value table for switch	statement
		dw offset loc_16EDF	; jump table for switch	statement
		dw offset loc_16EE7
		dw offset loc_16EEF
		dw offset loc_16F03
		dw offset loc_16F11
		dw offset loc_16F25
		dw offset loc_16F39
		dw offset loc_16F41

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

yumemi_16FC0	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jz	short loc_16FD6
		push	1
		call	sub_16DC8

loc_16FD6:
		pop	bp
		retf
yumemi_16FC0	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

yumemi_16FD8	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jz	short loc_16FEE
		push	2
		call	sub_16DC8

loc_16FEE:
		pop	bp
		retf
yumemi_16FD8	endp


; =============== S U B	R O U T	I N E =======================================


sub_16FF0	proc near
		push	si
		push	di
		mov	si, ax
		sar	ax, 4
		shl	ax, 1
		shl	bx, 6
		add	ax, bx
		shr	bx, 2
		add	ax, bx
		mov	di, ax
		and	si, 0Fh
		shl	si, 4
		add	si, 9EAh
		add	si, dx
		cmp	ax, 8
		jl	short loc_1702A
		movsd
		add	di, 4Ch	; 'L'
		movsd
		add	di, 4Ch	; 'L'
		movsd
		add	di, 4Ch	; 'L'
		movsd
		jmp	short loc_17040
; ---------------------------------------------------------------------------
		nop

loc_1702A:
		movsw
		add	si, 2
		add	di, 4Eh	; 'N'
		movsw
		add	si, 2
		add	di, 4Eh	; 'N'
		movsw
		add	si, 2
		add	di, 4Eh	; 'N'
		movsw

loc_17040:
		pop	di
		pop	si
		retn
sub_16FF0	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

mima_17043	proc far
		push	bp
		mov	bp, sp
		push	si
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_INACTIVE
		jz	@@ret
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_PREPARING
		jnz	short loc_170A5
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	_bomb_state[bx], BOMB_ACTIVE
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	_bomb_frame[bx], 0
		xor	si, si
		jmp	short loc_17099
; ---------------------------------------------------------------------------

loc_17081:
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 5
		mov	dx, si
		shl	dx, 2
		add	ax, dx
		mov	bx, ax
		mov	word ptr [bx+689Ch], 0
		inc	si

loc_17099:
		cmp	si, 8
		jl	short loc_17081
		call	snd_se_play pascal, 18

loc_170A5:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	_bomb_frame[bx]
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, _bomb_frame[bx]
		mov	ah, 0
		mov	bx, 8
		cwd
		idiv	bx
		dec	ax
		mov	si, ax
		cmp	si, 8
		jge	short loc_17129
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, _bomb_frame[bx]
		mov	ah, 0
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_17129
		push	1200h
		call	randring2_next16_mod
		mov	dl, _pid_current
		mov	dh, 0
		shl	dx, 5
		mov	bx, si
		shl	bx, 2
		add	dx, bx
		mov	bx, dx
		mov	[bx+689Ah], ax
		mov	ax, si
		mov	bx, 3
		cwd
		idiv	bx
		add	ax, ax
		mov	dl, byte ptr word_23AF0
		mov	dh, 0
		add	ax, dx
		add	ax, 1Ch
		mov	dl, _pid_current
		mov	dh, 0
		shl	dx, 5
		mov	bx, si
		shl	bx, 2
		add	dx, bx
		mov	bx, dx
		mov	[bx+689Ch], ax

loc_17129:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_frame[bx], BOMB_FRAMES
		jb	short @@ret
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	_bomb_state[bx], BOMB_INACTIVE
		push	word ptr _pid_current
		call	sub_A3A8

@@ret:
		pop	si
		pop	bp
		retf
mima_17043	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1714F	proc near

@@x		= word ptr -2

		enter	2, 0
		push	si
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 5
		add	ax, 689Ah
		mov	word_23E3A, ax
		mov	_sprite16_put_w, (16 / 16)
		mov	_sprite16_put_h, 8
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT
		xor	si, si
		jmp	short loc_171B2
; ---------------------------------------------------------------------------

loc_1717D:
		mov	bx, word_23E3A
		cmp	word ptr [bx+2], 0
		jz	short loc_171B7
		mov	bx, word_23E3A
		push	word ptr [bx]
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	[bp+@@x], ax
		push	ax
		push	PLAYFIELD_TOP
		mov	bx, word_23E3A
		push	word ptr [bx+2]
		push	SPF_DOWNWARDS_COLUMN
		call	sprite16_putx
		inc	si
		add	word_23E3A, 4

loc_171B2:
		cmp	si, 8
		jl	short loc_1717D

loc_171B7:
		pop	si
		leave
		retn
sub_1714F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

mima_bomb	proc far

var_2		= byte ptr -2
@@frame		= byte ptr -1

		enter	2, 0
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_INACTIVE
		jz	@@ret
		call	egc_off
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, _bomb_frame[bx]
		mov	[bp+@@frame], al
		cmp	[bp+@@frame], 80
		ja	short loc_17255
		push	GC_RMW
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	grcg_setcolor
		mov	bx, 3932h
		cmp	_pid_current, 0
		jz	short loc_17202
		add	bx, 28h	; '('

loc_17202:
		call	sub_B39E
		call	grcg_off
		mov	al, [bp+@@frame]
		mov	ah, 0
		imul	ax, 3
		mov	dl, 0
		sub	dl, al
		mov	[bp+var_2], dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].r, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].g, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].b, dl
		mov	_palette_changed, 1
		call	egc_on
		call	sub_1714F
		jmp	loc_1737D
; ---------------------------------------------------------------------------

loc_17255:
		cmp	[bp+@@frame], 144
		jnb	loc_17332
		test	[bp+@@frame], 1
		jnz	short loc_1727B
		call	snd_se_play pascal, 16
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].r, 100
		jmp	short loc_1728A
; ---------------------------------------------------------------------------

loc_1727B:
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].r, 0

loc_1728A:
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].g, 0
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 3
		mov	bx, ax
		mov	Palettes[bx].b, 0
		mov	_palette_changed, 1
		mov	al, [bp+@@frame]
		mov	ah, 0
		mov	bx, 8
		cwd
		idiv	bx
		mov	[bp+var_2], dl
		cmp	[bp+var_2], 0
		jnz	short loc_172D2
		push	9000B80h
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	sub_CDBD

loc_172D2:
		mov	al, [bp+var_2]
		mov	ah, 0
		and	ax, 3
		cmp	ax, 2
		jge	short loc_172F0
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 4
		jmp	short loc_172FF
; ---------------------------------------------------------------------------

loc_172F0:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], -4

loc_172FF:
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, PLAYFIELD_W_BORDERED
		mov	dl, _pid_current
		mov	dh, 0
		add	dx, dx
		mov	bx, dx
		add	ax, _playfield_fg_shift_x[bx]
		add	ax, PLAYFIELD_LEFT
		push	ax	; left
		push	PLAYFIELD_TOP	; top
		mov	al, _pid_current
		mov	ah, 0
		add	ax, 2
		push	ax	; slot
		mov	al, _pid_current
		mov	ah, 0
		push	ax	; altered_colors
		call	@mrs_put_noalpha_8$qiuiic
		jmp	short loc_1737D
; ---------------------------------------------------------------------------

loc_17332:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 0
		mov	al, [bp+@@frame]
		shl	al, 3
		mov	dl, 255
		sub	dl, al
		mov	[bp+var_2], dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].r, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].g, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].b, dl
		mov	_palette_changed, 1

loc_1737D:
		call	egc_on

@@ret:
		leave
		retf
mima_bomb	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_17384	proc far
		push	bp
		mov	bp, sp
		xor	ax, ax
		jmp	short loc_17396
; ---------------------------------------------------------------------------

loc_1738B:
		mov	bx, ax
		imul	bx, 1Ah
		mov	byte ptr [bx+68F2h], 0
		inc	ax

loc_17396:
		cmp	ax, 140h
		jl	short loc_1738B
		mov	byte_26353, 0
		pop	bp
		retf
sub_17384	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_173A2	proc near

@@length		= byte ptr -9
var_8		= byte ptr -8
var_7		= byte ptr -7
@@center_y		= word ptr -6
@@center_x		= word ptr -4
var_2		= word ptr -2
arg_0		= word ptr  4

		push	bp
		mov	bp, sp
		sub	sp, 0Ah
		push	si
		push	di
		mov	si, [bp+arg_0]
		mov	[bp+var_2], 0
		xor	di, di
		mov	[bp+var_7], 0
		mov	[bp+var_8], 8
		mov	al, _pid_other
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	ax, _players[bx].center.x
		mov	[bp+@@center_x], ax
		mov	al, _pid_other
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	ax, _players[bx].center.y
		mov	[bp+@@center_y], ax
		mov	al, byte_23E42
		mov	[bp+@@length], al
		mov	al, byte_23E45
		mov	ah, 0
		mov	bx, ax
		cmp	bx, 2Ch	; ','
		ja	loc_1767D
		add	bx, bx
		jmp	cs:off_176D6[bx]

loc_173F9:
		add	[bp+var_2], 3

loc_173FD:
		add	[bp+var_2], 3

loc_17401:
		or	si, si
		jnz	short loc_17410
		mov	ax, [bp+var_2]
		add	ax, 3
		mov	[bp+var_2], ax
		jmp	short loc_17421
; ---------------------------------------------------------------------------

loc_17410:
		cmp	si, 1
		jnz	short loc_17421
		mov	ax, 0FFFDh
		sub	ax, [bp+var_2]
		mov	[bp+var_2], ax
		mov	di, 1

loc_17421:
		cmp	byte_23E45, 4
		ja	loc_1767D
		jmp	loc_176A8
; ---------------------------------------------------------------------------

loc_1742D:
		add	[bp+var_2], 8

loc_17431:
		add	[bp+var_2], 8

loc_17435:
		or	si, si
		jnz	short loc_17440
		mov	[bp+var_2], 0
		jmp	short loc_17461
; ---------------------------------------------------------------------------

loc_17440:
		cmp	si, 1
		jnz	short loc_17450
		mov	ax, [bp+var_2]
		add	ax, 8
		mov	[bp+var_2], ax
		jmp	short loc_17461
; ---------------------------------------------------------------------------

loc_17450:
		cmp	si, 2
		jnz	short loc_17461
		mov	ax, 0FFF8h
		sub	ax, [bp+var_2]
		mov	[bp+var_2], ax
		mov	di, 1

loc_17461:
		cmp	byte_23E45, 0Ah
		ja	loc_1767D
		jmp	loc_176A8
; ---------------------------------------------------------------------------

loc_1746D:
		add	[bp+var_2], 6

loc_17471:
		add	[bp+var_2], 6

loc_17475:
		or	si, si
		jnz	short loc_17484
		mov	ax, [bp+var_2]
		add	ax, 3
		mov	[bp+var_2], ax
		jmp	short loc_174C1
; ---------------------------------------------------------------------------

loc_17484:
		cmp	si, 1
		jnz	short loc_17494
		mov	ax, 0FFFDh
		sub	ax, [bp+var_2]
		mov	[bp+var_2], ax
		jmp	short loc_174C1
; ---------------------------------------------------------------------------

loc_17494:
		cmp	si, 2
		jnz	short loc_174A9
		mov	ax, [bp+var_2]
		add	ax, ax
		add	ax, [bp+var_2]
		add	ax, 9
		mov	[bp+var_2], ax
		jmp	short loc_174C1
; ---------------------------------------------------------------------------

loc_174A9:
		cmp	si, 3
		jnz	short loc_174C1
		mov	ax, [bp+var_2]
		add	ax, ax
		add	ax, [bp+var_2]
		mov	dx, 0FFF7h
		sub	dx, ax
		mov	[bp+var_2], dx
		mov	di, 1

loc_174C1:
		cmp	byte_23E45, 10h
		ja	loc_1767D
		jmp	loc_176A8
; ---------------------------------------------------------------------------

loc_174CD:
		add	[bp+var_2], 6

loc_174D1:
		add	[bp+var_2], 6

loc_174D5:
		or	si, si
		jnz	short loc_174E0
		mov	[bp+var_2], 0
		jmp	short loc_17527
; ---------------------------------------------------------------------------

loc_174E0:
		cmp	si, 1
		jnz	short loc_174F0
		mov	ax, [bp+var_2]
		add	ax, 6
		mov	[bp+var_2], ax
		jmp	short loc_17527
; ---------------------------------------------------------------------------

loc_174F0:
		cmp	si, 2
		jnz	short loc_17500
		mov	ax, 0FFFAh
		sub	ax, [bp+var_2]
		mov	[bp+var_2], ax
		jmp	short loc_17527
; ---------------------------------------------------------------------------

loc_17500:
		cmp	si, 3
		jnz	short loc_17512
		mov	ax, [bp+var_2]
		add	ax, ax
		add	ax, 0Ch
		mov	[bp+var_2], ax
		jmp	short loc_17527
; ---------------------------------------------------------------------------

loc_17512:
		cmp	si, 4
		jnz	short loc_17527
		mov	ax, [bp+var_2]
		add	ax, ax
		mov	dx, 0FFF4h
		sub	dx, ax
		mov	[bp+var_2], dx
		mov	di, 1

loc_17527:
		cmp	byte_23E45, 16h
		ja	loc_1767D
		jmp	loc_176A8
; ---------------------------------------------------------------------------

loc_17533:
		mov	[bp+var_7], 10h
		dec	[bp+var_8]

loc_1753A:
		mov	al, [bp+var_7]
		add	al, 8
		mov	[bp+var_7], al
		dec	[bp+var_8]

loc_17545:
		mov	al, [bp+var_7]
		add	al, 4
		mov	[bp+var_7], al
		dec	[bp+var_8]

loc_17550:
		mov	al, [bp+var_7]
		add	al, 2
		mov	[bp+var_7], al
		dec	[bp+var_8]

loc_1755B:
		mov	al, [bp+var_7]
		inc	al
		mov	[bp+var_7], al
		dec	[bp+var_8]
		mov	ax, si
		mov	cl, [bp+var_8]
		shl	ax, cl
		mov	[bp+var_2], ax
		mov	al, [bp+var_7]
		mov	ah, 0
		cmp	ax, si
		jg	loc_176A8
		mov	di, 1
		jmp	loc_176A8
; ---------------------------------------------------------------------------

loc_17581:
		mov	ax, si
		shl	ax, 8
		mov	dl, byte_23E47
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		mov	[bp+var_2], ax
		mov	al, byte_23E47
		mov	ah, 0
		dec	ax
		cmp	ax, si
		jg	loc_176A8
		jmp	loc_17628
; ---------------------------------------------------------------------------

loc_175A3:
		mov	[bp+var_7], 10h
		dec	[bp+var_8]

loc_175AA:
		mov	al, [bp+var_7]
		add	al, 8
		mov	[bp+var_7], al
		dec	[bp+var_8]

loc_175B5:
		mov	al, [bp+var_7]
		add	al, 4
		mov	[bp+var_7], al
		dec	[bp+var_8]

loc_175C0:
		mov	al, [bp+var_7]
		add	al, 2
		mov	[bp+var_7], al
		dec	[bp+var_8]

loc_175CB:
		mov	al, [bp+var_7]
		inc	al
		mov	[bp+var_7], al
		dec	[bp+var_8]
		mov	ax, si
		mov	cl, [bp+var_8]
		shl	ax, cl
		mov	[bp+var_2], ax
		mov	al, [bp+var_7]
		mov	ah, 0
		cmp	ax, si
		jg	loc_1767D
		jmp	loc_1767A
; ---------------------------------------------------------------------------

loc_175EE:
		mov	ax, si
		shl	ax, 8
		mov	dl, byte_23E47
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		mov	[bp+var_2], ax
		mov	al, byte_23E47
		mov	ah, 0
		dec	ax
		cmp	ax, si
		jg	short loc_1767D
		jmp	short loc_1767A
; ---------------------------------------------------------------------------

loc_1760D:
		or	si, si
		jnz	short loc_17619
		mov	[bp+var_2], 0
		jmp	loc_176A8
; ---------------------------------------------------------------------------

loc_17619:
		mov	al, angle_23E43
		mov	ah, 0
		add	ax, ax
		mov	dx, 80h
		sub	dx, ax
		mov	[bp+var_2], dx

loc_17628:
		mov	di, 1
		jmp	short loc_176A8
; ---------------------------------------------------------------------------

loc_1762D:
		call	randring2_next16
		mov	[bp+var_2], ax
		mov	di, 1
		jmp	short loc_176A8
; ---------------------------------------------------------------------------

loc_17638:
		call	randring2_next16
		mov	[bp+var_2], ax
		mov	al, byte_23E47
		mov	ah, 0
		cmp	ax, si
		jg	short loc_176A8
		jmp	short loc_17628
; ---------------------------------------------------------------------------

loc_17649:
		call	randring2_next16
		mov	[bp+var_2], ax
		push	1Fh
		call	randring2_next16_and
		add	al, [bp+@@length]
		mov	[bp+@@length], al
		mov	al, byte_23E47
		mov	ah, 0
		cmp	ax, si
		jg	short loc_176A8
		jmp	short loc_17628
; ---------------------------------------------------------------------------

loc_17665:
		push	1Fh
		call	randring2_next16_and
		mov	[bp+var_2], ax
		sub	[bp+var_2], 10h
		mov	al, byte_23E47
		mov	ah, 0
		cmp	ax, si
		jg	short loc_1767D

loc_1767A:
		mov	di, 1

loc_1767D:
		push	word_23E3E
		push	word_23E40
		push	[bp+@@center_x]
		push	[bp+@@center_y]
		mov	al, byte ptr [bp+var_2]
		add	al, angle_23E43
		push	ax
		push	ds
		push	offset point_23E48.x
		push	ds
		push	offset point_23E48.y
		mov	al, [bp+@@length]
		mov	ah, 0
		push	ax
		call	vector2_between_plus
		jmp	short loc_176C3
; ---------------------------------------------------------------------------

loc_176A8:
		push	ds
		push	offset point_23E48.x
		push	ds
		push	offset point_23E48.y
		mov	al, byte ptr [bp+var_2]
		add	al, angle_23E43
		push	ax
		mov	al, [bp+@@length]
		mov	ah, 0
		push	ax
		call	vector2

loc_176C3:
		mov	al, byte ptr [bp+var_2]
		add	al, angle_23E43
		mov	byte_26352, al
		mov	ax, di
		pop	di
		pop	si
		leave
		retn	2
sub_173A2	endp

; ---------------------------------------------------------------------------
		db 0
off_176D6	dw offset loc_17628
		dw offset loc_1767A
		dw offset loc_17401
		dw offset loc_173FD
		dw offset loc_173F9
		dw offset loc_17401
		dw offset loc_173FD
		dw offset loc_173F9
		dw offset loc_17435
		dw offset loc_17431
		dw offset loc_1742D
		dw offset loc_17435
		dw offset loc_17431
		dw offset loc_1742D
		dw offset loc_17475
		dw offset loc_17471
		dw offset loc_1746D
		dw offset loc_17475
		dw offset loc_17471
		dw offset loc_1746D
		dw offset loc_174D5
		dw offset loc_174D1
		dw offset loc_174CD
		dw offset loc_174D5
		dw offset loc_174D1
		dw offset loc_174CD
		dw offset loc_1762D
		dw offset loc_17638
		dw offset loc_17649
		dw offset loc_17665
		dw offset loc_1767D
		dw offset loc_1767D
		dw offset loc_17550
		dw offset loc_1755B
		dw offset loc_1760D
		dw offset loc_17545
		dw offset loc_1753A
		dw offset loc_17533
		dw offset loc_17581
		dw offset loc_175CB
		dw offset loc_175C0
		dw offset loc_175B5
		dw offset loc_175AA
		dw offset loc_175A3
		dw offset loc_175EE

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_17730	proc far

var_E		= byte ptr -0Eh
var_D		= byte ptr -0Dh
var_C		= byte ptr -0Ch
var_B		= byte ptr -0Bh
@@length		= word ptr -0Ah
var_8		= word ptr -8
var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2

		push	bp
		mov	bp, sp
		sub	sp, 0Eh
		push	si
		push	di
		mov	[bp+var_4], 0
		mov	[bp+var_C], 0
		cmp	word_23E40, 0FF80h
		jle	loc_1795E
		cmp	word_23E40, 1780h
		jge	loc_1795E
		cmp	word_23E3E, 0FF80h
		jle	loc_1795E
		cmp	word_23E3E, 1280h
		jge	loc_1795E
		mov	si, 68F2h
		mov	al, byte_23E4E
		mov	ah, 0
		sub	ax, 2
		mov	bx, ax
		cmp	bx, 6
		ja	short loc_177A9
		add	bx, bx
		jmp	cs:off_17963[bx]

loc_17780:
		mov	[bp+var_C], 1
		mov	[bp+var_D], 1
		jmp	short loc_177AF
; ---------------------------------------------------------------------------

loc_1778A:
		mov	[bp+var_C], 1

loc_1778E:
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 8
		mov	word_23E4C, ax

loc_17799:
		mov	[bp+var_D], 2
		jmp	short loc_177AF
; ---------------------------------------------------------------------------

loc_1779F:
		mov	[bp+var_C], 1
		mov	[bp+var_D], 2
		jmp	short loc_177AF
; ---------------------------------------------------------------------------

loc_177A9:
		mov	al, byte_23E4E
		mov	[bp+var_D], al

loc_177AF:
		mov	al, byte_23E42
		mov	[bp+var_E], al
		mov	al, byte_23E3C
		add	byte_23E42, al
		cmp	byte_23E42, 80h
		jbe	short loc_177CA
		mov	byte_23E42, 80h
		jmp	short loc_177D6
; ---------------------------------------------------------------------------

loc_177CA:
		cmp	byte_23E42, 10h
		jnb	short loc_177D6
		mov	byte_23E42, 10h

loc_177D6:
		mov	[bp+var_2], 0
		jmp	loc_1794F
; ---------------------------------------------------------------------------

loc_177DE:
		cmp	byte ptr [si], 0
		jnz	loc_17949
		mov	al, [bp+var_D]
		mov	[si], al
		mov	byte ptr [si+1], 0
		mov	ax, word_23E3E
		mov	[si+2],	ax
		mov	ax, word_23E40
		mov	[si+4],	ax
		mov	al, byte_23E45
		mov	[si+11h], al
		mov	al, _pid_other
		mov	[si+10h], al
		mov	ax, word_23E4C
		mov	[si+12h], ax
		mov	al, byte_23E50
		mov	[si+16h], al
		mov	al, byte_23E4F
		mov	[si+15h], al
		mov	al, byte_23E51
		mov	[si+17h], al
		cmp	byte_23E51, 0
		jz	short loc_1786C
		mov	al, byte_26353
		mov	ah, 0
		imul	ax, 18h
		add	ax, 8972h
		mov	[si+18h], ax
		inc	byte_26353
		cmp	byte_26353, 30h	; '0'
		jb	short loc_17843
		mov	byte_26353, 0

loc_17843:
		xor	di, di
		jmp	short loc_17867
; ---------------------------------------------------------------------------

loc_17847:
		mov	ax, di
		add	ax, ax
		add	ax, [si+18h]
		mov	dx, word_23E3E
		mov	bx, ax
		mov	[bx], dx
		mov	ax, di
		add	ax, ax
		add	ax, [si+18h]
		mov	dx, word_23E40
		mov	bx, ax
		mov	[bx+0Ch], dx
		inc	di

loc_17867:
		cmp	di, 6
		jl	short loc_17847

loc_1786C:
		cmp	[bp+var_C], 0
		jz	short loc_1787A
		mov	al, byte_23E46
		mov	[si+14h], al
		jmp	short loc_1787E
; ---------------------------------------------------------------------------

loc_1787A:
		mov	byte ptr [si+14h], 0

loc_1787E:
		cmp	[bp+var_D], 3
		jnz	loc_17914
		push	word_23E3E
		mov	al, _pid_other
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	[bp+var_8], ax
		push	1200h
		call	randring2_next16_mod
		mov	[bp+var_6], ax
		mov	[si+6],	ax
		push	ax
		mov	al, _pid_other
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	playfield_fg_x_to_screen
		mov	[bp+var_6], ax
		mov	al, byte_23AF8
		mov	ah, 0
		mov	bx, 3
		cwd
		idiv	bx
		add	ax, 46h	; 'F'
		mov	[bp+@@length], ax
		mov	ax, [bp+var_8]
		shl	ax, 4
		push	ax
		push	word ptr [si+4]
		mov	ax, [bp+var_6]
		shl	ax, 4
		push	ax
		call	randring2_next16_and pascal, 255
		push	ax
		push	0
		push	ds
		lea	ax, [si+0Ah]
		push	ax
		push	ds
		lea	ax, [si+0Ch]
		push	ax
		push	[bp+@@length]
		call	vector2_between_plus
		push	[bp+var_6]
		mov	al, _pid_other
		mov	ah, 0
		push	ax
		call	sub_A2F2
		mov	[si+8],	ax
		mov	al, angle_23E43
		mov	[si+0Fh], al
		mov	al, byte_23E42
		mov	[si+0Eh], al
		jmp	short loc_17958
; ---------------------------------------------------------------------------

loc_17914:
		push	[bp+var_4]
		call	sub_173A2
		mov	[bp+var_B], al
		mov	ax, point_23E48.x
		mov	[si+0Ah], ax
		mov	ax, point_23E48.y
		mov	[si+0Ch], ax
		mov	al, byte_26352
		mov	[si+0Fh], al
		mov	al, byte_23E42
		mov	[si+0Eh], al
		cmp	[bp+var_D], 4
		jnz	short loc_17940
		mov	word ptr [si+12h], 1942h

loc_17940:
		cmp	[bp+var_B], 0
		jnz	short loc_17958
		inc	[bp+var_4]

loc_17949:
		inc	[bp+var_2]
		add	si, 1Ah

loc_1794F:
		cmp	[bp+var_2], 140h
		jl	loc_177DE

loc_17958:
		mov	al, [bp+var_E]
		mov	byte_23E42, al

loc_1795E:
		pop	di
		pop	si
		leave
		retf
sub_17730	endp

; ---------------------------------------------------------------------------
		db 0
off_17963	dw offset loc_1778E
		dw offset loc_177A9
		dw offset loc_177A9
		dw offset loc_17799
		dw offset loc_17780
		dw offset loc_1778A
		dw offset loc_1779F

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_17971	proc far
		push	bp
		mov	bp, sp
		mov	byte_23E4E, 3
		call	sub_17730
		pop	bp
		retf
sub_17971	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1797F	proc far
		push	bp
		mov	bp, sp
		mov	angle_23E43, 0
		mov	byte_23E47, 0
		mov	byte_23E50, 1
		mov	byte_23E4F, 1
		mov	byte_23E51, 0
		pop	bp
		retf
sub_1797F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1799D	proc near
		push	bp
		mov	bp, sp
		push	si
		add	bx, [si+18h]
		mov	dx, [bx+8]
		mov	[bx+0Ah], dx
		cmp	dx, 0FF80h
		jle	short loc_179D1
		cmp	dx, word_26354
		jge	short loc_179D1
		mov	dx, [bx+6]
		mov	[bx+8],	dx
		mov	dx, [bx+4]
		mov	[bx+6],	dx
		mov	dx, [bx+2]
		mov	[bx+4],	dx
		mov	dx, [bx]
		mov	[bx+2],	dx
		mov	[bx], cx
		clc
		jmp	short loc_179D2
; ---------------------------------------------------------------------------

loc_179D1:
		stc

loc_179D2:
		pop	si
		pop	bp
		retn
sub_1799D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_179D5	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	al, [si]
		mov	byte_23E4E, al
		mov	ax, [si+2]
		mov	word_23E3E, ax
		mov	ax, [si+4]
		mov	word_23E40, ax
		mov	ax, [si+0Eh]
		mov	word ptr byte_23E42, ax
		mov	ax, [si+10h]
		mov	word ptr _pid_other, ax
		call	sub_17730
		pop	si
		pop	bp
		retn
sub_179D5	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_179FD	proc near
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	di, si
		mov	al, [di+14h]
		mov	ah, 0
		cmp	ax, 80h
		jnz	short loc_17A17
		cmp	word ptr [di+0Ch], 50h ; 'P'
		jge	short loc_17A17
		inc	word ptr [di+0Ch]

loc_17A17:
		pop	di
		pop	si
		pop	bp
		retn
sub_179FD	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_17A1B	proc far

var_1		= byte ptr -1

		push	bp
		mov	bp, sp
		sub	sp, 2
		push	si
		push	di
		mov	[bp+var_1], 0
		mov	word_220F4, 1
		mov	byte_2203A, 1
		mov	di, 141h
		mov	ax, 68F2h
		add	ax, 0FFE6h
		mov	si, ax

loc_17A3D:
		add	si, 1Ah
		dec	di
		mov	ax, di
		or	ax, ax
		jz	loc_17BCD
		cmp	byte ptr [si], 0
		jz	short loc_17A3D
		cmp	byte ptr [si], 5
		jnb	short loc_17A3D
		inc	[bp+var_1]
		inc	byte ptr [si+1]
		cmp	byte ptr [si], 4
		jnz	short loc_17A7A
		mov	al, [si+1]
		and	al, 3
		jnz	short loc_17A3D
		mov	ax, [si+12h]
		add	ax, 4
		cmp	ax, 194Eh
		jl	short loc_17A75
		mov	byte ptr [si], 1
		jmp	short loc_17A3D
; ---------------------------------------------------------------------------

loc_17A75:
		mov	[si+12h], ax
		jmp	short loc_17A3D
; ---------------------------------------------------------------------------

loc_17A7A:
		mov	ax, [si+2]
		mov	cx, ax
		add	ax, [si+0Ah]
		cmp	byte ptr [si], 3
		jz	short loc_17ADC
		mov	bh, 0
		mov	bl, [si+10h]
		add	bx, offset _bomb_state
		cmp	byte ptr [bx], 0
		jnz	short loc_17AD6
		mov	bh, 0
		mov	bl, [si+10h]
		add	bx, offset _damage_all_enemies_on
		cmp	byte ptr [bx], 0
		jnz	short loc_17AD6
		cmp	byte ptr [si+17h], 0
		jz	short loc_17ACC
		cmp	ax, 0FF80h
		jle	short loc_17AB5
		cmp	ax, 1280h
		jge	short loc_17ABA
		jmp	short loc_17ABD
; ---------------------------------------------------------------------------

loc_17AB5:
		mov	ax, 0FF80h
		jmp	short loc_17ABD
; ---------------------------------------------------------------------------

loc_17ABA:
		mov	ax, 1280h

loc_17ABD:
		mov	word_26354, 1280h
		xor	bx, bx
		call	sub_1799D
		jb	short loc_17AD6
		jmp	short loc_17AEF
; ---------------------------------------------------------------------------

loc_17ACC:
		cmp	ax, 0FF80h
		jle	short loc_17AD6
		cmp	ax, 1280h
		jl	short loc_17AEF

loc_17AD6:
		mov	byte ptr [si], 0
		jmp	loc_17A3D
; ---------------------------------------------------------------------------

loc_17ADC:
		mov	bl, [si+10h]
		or	bl, bl
		jnz	short loc_17AEA
		cmp	ax, [si+8]
		jl	short loc_17B15
		jmp	short loc_17AF1
; ---------------------------------------------------------------------------

loc_17AEA:
		cmp	ax, [si+8]
		jle	short loc_17AF1

loc_17AEF:
		jmp	short loc_17B15
; ---------------------------------------------------------------------------

loc_17AF1:
		mov	byte ptr [si], 4
		xor	byte ptr [si+10h], 1
		mov	dx, [si+6]
		mov	[si+2],	dx
		mov	word ptr [si+4], 20h ; ' '
		add	byte ptr [si+0Eh], 8
		mov	byte_23E47, 0
		call	sub_179D5
		mov	byte ptr [si], 0
		jmp	loc_17BCA
; ---------------------------------------------------------------------------

loc_17B15:
		mov	[si+2],	ax
		mov	ax, [si+4]
		mov	cx, ax
		add	ax, [si+0Ch]
		cmp	byte ptr [si+17h], 0
		jz	short loc_17B36
		mov	word_26354, 1780h
		mov	bx, 0Ch
		call	sub_1799D
		jb	short loc_17B40
		jmp	short loc_17B46
; ---------------------------------------------------------------------------

loc_17B36:
		cmp	ax, 0FF80h
		jle	short loc_17B40
		cmp	ax, 1780h
		jl	short loc_17B46

loc_17B40:
		mov	byte ptr [si], 0
		jmp	loc_17A3D
; ---------------------------------------------------------------------------

loc_17B46:
		mov	[si+4],	ax
		cmp	byte ptr [si+14h], 0
		jz	short loc_17B52
		call	sub_179FD

loc_17B52:
		cmp	byte ptr [si], 1
		jnz	short loc_17BA9
		mov	dx, [si+2]
		sub	dx, 60h
		sub	ax, 60h
		mov	word_20E2E, dx
		mov	word_20E30, ax
		add	dx, 0C0h
		add	ax, 0C0h
		mov	word_20E36, dx
		mov	word_20E38, ax
		mov	bl, [si+10h]
		mov	pid_20E3A, bl
		call	sub_1670D
		or	al, al
		jz	short loc_17BA9
		mov	bh, 0
		mov	bl, [si+10h]
		xor	bl, 1
		add	bx, 2D54h
		cmp	byte ptr [bx], 0
		jnz	short loc_17BA3
		mov	byte ptr [si], 3
		mov	byte ptr [si+11h], 1Dh
		mov	byte ptr [si+0Fh], 0
		call	sub_179D5

loc_17BA3:
		mov	byte ptr [si], 0
		jmp	loc_17A3D
; ---------------------------------------------------------------------------

loc_17BA9:
		cmp	byte ptr [si], 3
		jz	short loc_17BCA
		cmp	byte ptr [si+15h], 0
		jz	short loc_17BCA
		mov	ax, [si+2]
		mov	word_220EE, ax
		mov	ax, [si+4]
		mov	word_220F0, ax
		mov	al, [si+10h]
		mov	byte_220FA, al
		call	sub_13B42

loc_17BCA:
		jmp	loc_17A3D
; ---------------------------------------------------------------------------

loc_17BCD:
		pop	di
		pop	si
		leave
		retf
sub_17A1B	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_17BD1	proc far

var_D		= byte ptr -0Dh
var_C		= word ptr -0Ch
var_A		= word ptr -0Ah
@@sprite_offset		= word ptr -8
@@top		= word ptr -6
@@left		= word ptr -4
var_2		= word ptr -2

		push	bp
		mov	bp, sp
		sub	sp, 0Eh
		push	si
		push	di
		call	egc_on
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT
		mov	_sprite16_put_w, (16 / 16)
		mov	_sprite16_put_h, 8
		mov	[bp+var_C], 68F2h
		mov	[bp+var_D], 0
		mov	[bp+var_2], 0
		jmp	loc_17CD9
; ---------------------------------------------------------------------------

loc_17C06:
		mov	bx, [bp+var_C]
		cmp	byte ptr [bx], 2
		jnz	loc_17CC6
		mov	ax, [bx+12h]
		mov	[bp+@@sprite_offset], ax
		cmp	byte ptr [bx+17h], 0
		jz	short loc_17C7D
		add	[bp+@@sprite_offset], 6
		mov	[bp+var_A], 5
		jmp	short loc_17C77
; ---------------------------------------------------------------------------

loc_17C27:
		mov	ax, [bp+var_A]
		add	ax, ax
		mov	bx, [bp+var_C]
		add	ax, [bx+18h]
		mov	bx, ax
		push	word ptr [bx]
		mov	bx, [bp+var_C]
		mov	al, [bx+10h]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -8
		mov	[bp+@@left], ax
		mov	ax, [bp+var_A]
		add	ax, ax
		mov	bx, [bp+var_C]
		add	ax, [bx+18h]
		mov	bx, ax
		mov	ax, [bx+0Ch]
		sar	ax, 4
		add	ax, 8
		mov	[bp+@@top], ax
		call	sprite16_put_noclip pascal, [bp+@@left], ax, [bp+@@sprite_offset]
		sub	[bp+var_A], 2
		sub	[bp+@@sprite_offset], 2

loc_17C77:
		cmp	[bp+var_A], 0
		jg	short loc_17C27

loc_17C7D:
		mov	bx, [bp+var_C]
		push	word ptr [bx+2]
		mov	al, [bx+10h]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -8
		mov	[bp+@@left], ax
		mov	bx, [bp+var_C]
		mov	ax, [bx+4]
		sar	ax, 4
		add	ax, 8
		mov	[bp+@@top], ax
		cmp	byte ptr [bx+16h], 0
		jz	short loc_17CB6
		mov	al, [bx+1]
		mov	ah, 0
		and	ax, 3
		add	ax, ax
		add	[bp+@@sprite_offset], ax

loc_17CB6:
		call	sprite16_put_noclip pascal, [bp+@@left], [bp+@@top], [bp+@@sprite_offset]
		jmp	short loc_17CD2
; ---------------------------------------------------------------------------

loc_17CC6:
		mov	bx, [bp+var_C]
		cmp	byte ptr [bx], 4
		jnz	short loc_17CD2
		mov	[bp+var_D], 1

loc_17CD2:
		inc	[bp+var_2]
		add	[bp+var_C], 1Ah

loc_17CD9:
		cmp	[bp+var_2], 140h
		jl	loc_17C06
		cmp	[bp+var_D], 0
		jz	short loc_17D56
		mov	dx, 1
		mov	ah, SPRITE16_SET_MONO
		int	SPRITE16
		mov	dx, 15
		mov	ah, SPRITE16_SET_COLOR
		int	SPRITE16
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 16
		mov	[bp+var_C], 68F2h
		mov	[bp+var_2], 0
		jmp	short loc_17D48
; ---------------------------------------------------------------------------

loc_17D0D:
		mov	bx, [bp+var_C]
		cmp	byte ptr [bx], 4
		jnz	short loc_17D41
		push	word ptr [bx+2]
		mov	al, [bx+10h]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -16
		mov	[bp+@@left], ax
		mov	bx, [bp+var_C]
		mov	ax, [bx+4]
		sar	ax, 4
		mov	[bp+@@top], ax
		call	sprite16_put pascal, [bp+@@left], ax, word ptr [bx+12h]

loc_17D41:
		inc	[bp+var_2]
		add	[bp+var_C], 1Ah

loc_17D48:
		cmp	[bp+var_2], 140h
		jl	short loc_17D0D
		mov	dx, 0
		mov	ah, SPRITE16_SET_MONO
		int	SPRITE16

loc_17D56:
		call	egc_off
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 15
		mov	ax, 0A800h
		mov	es, ax
		assume es:nothing
		mov	si, 68F2h
		mov	di, 0

loc_17D71:
		test	byte ptr [si], 1
		jz	short loc_17D9C
		push	word ptr [si+2]
		mov	al, [si+10h]
		xor	ah, ah
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -4
		mov	bx, [si+4]
		sar	bx, 5
		add	bx, 6
		xor	dx, dx
		cmp	byte ptr [si], 1
		jz	short loc_17D99
		mov	dh, 1

loc_17D99:
		call	sub_16FF0

loc_17D9C:
		add	si, 1Ah
		inc	di
		cmp	di, 140h
		jb	short loc_17D71
		GRCG_OFF_VIA_XOR ax
		pop	di
		pop	si
		leave
		retf
sub_17BD1	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_17DAE	proc far

@@length		= byte ptr -8
@@pid		= byte ptr -7
var_6		= word ptr -6
var_4		= word ptr -4
@@x		= word ptr -2

		enter	8, 0
		push	si
		push	di
		mov	bx, word_2203C
		mov	di, [bx+2]
		mov	ax, [bx+4]
		mov	[bp+var_6], ax
		mov	si, 4656h
		mov	al, 1
		sub	al, [bx+8]
		mov	[bp+var_7], al
		mov	[bp+var_4], 0
		jmp	loc_17EEB
; ---------------------------------------------------------------------------

loc_17DD4:
		cmp	byte ptr [si], 0
		jnz	loc_17EE5
		mov	byte ptr [si], 2
		mov	[si+2],	di
		mov	ax, [bp+var_6]
		mov	[si+4],	ax
		mov	bx, word_2203C
		mov	al, [bx+8]
		mov	[si+8],	al
		push	1Fh
		call	randring2_next16_and
		mov	dl, byte_23AF8
		mov	dh, 0
		push	ax
		mov	ax, dx
		cwd
		sub	ax, dx
		sar	ax, 1
		pop	dx
		add	dl, al
		add	dl, 14h
		mov	[bp+@@length], dl
		cmp	[bp+@@length], 80h
		jbe	short loc_17E17
		mov	[bp+@@length], 80h

loc_17E17:
		mov	al, [bp+@@length]
		mov	[si+1Bh], al
		mov	al, byte_1E14C
		add	al, 2
		mov	[si+7],	al
		mov	al, byte_1E14C
		add	al, 2
		mov	[si+6],	al
		mov	byte ptr [si+9], 30h ; '0'
		mov	byte ptr [si+1Eh], 0
		cmp	byte_1E14C, 0
		jnz	short loc_17E40
		mov	al, 0
		jmp	short loc_17E45
; ---------------------------------------------------------------------------

loc_17E40:
		mov	al, byte_26358
		inc	al

loc_17E45:
		mov	[si+20h], al
		push	di
		mov	al, [bp+var_7]
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	playfield_fg_x_to_screen
		mov	[bp+@@x], ax
		mov	ax, word_23AF6
		and	ax, 1FFh
		cmp	ax, 100h
		jnb	short loc_17E6F
		push	1200h
		call	randring2_next16_mod
		jmp	short loc_17E83
; ---------------------------------------------------------------------------

loc_17E6F:
		push	1FFh
		call	randring2_next16_and
		mov	dl, [bp+var_7]
		mov	dh, 0
		shl	dx, 7
		mov	bx, dx
		add	ax, _players[bx].center.x

loc_17E83:
		mov	di, ax
		mov	[si+14h], di
		push	di
		mov	al, [bp+var_7]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	di, ax
		mov	al, byte_23AF8
		mov	ah, 0
		mov	bx, 3
		cwd
		idiv	bx
		add	al, 46h	; 'F'
		mov	[bp+@@length], al
		mov	ax, [bp+@@x]
		shl	ax, 4
		push	ax
		push	[bp+var_6]
		mov	ax, di
		shl	ax, 4
		push	ax
		push	0
		push	0
		push	ds
		lea	ax, [si+10h]
		push	ax
		push	ds
		lea	ax, [si+12h]
		push	ax
		mov	al, [bp+@@length]
		mov	ah, 0
		push	ax
		call	vector2_between_plus
		push	di
		mov	al, [bp+var_7]
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	sub_A2F2
		mov	[si+16h], ax
		jmp	short loc_17EF3
; ---------------------------------------------------------------------------

loc_17EE5:
		inc	[bp+var_4]
		add	si, 30h	; '0'

loc_17EEB:
		cmp	[bp+var_4], 18h
		jl	loc_17DD4

loc_17EF3:
		pop	di
		pop	si
		leave
		retf
sub_17DAE	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_17EF7	proc near

var_6		= byte ptr -6
var_5		= byte ptr -5
@@top		= word ptr -4
@@left		= word ptr -2

		enter	6, 0
		push	si
		push	di
		mov	si, word_2203C
		mov	al, [si+1]
		and	al, 7
		mov	[bp+var_6], al
		cmp	byte ptr [si], 1
		jnz	short loc_17F35
		mov	al, [si+6]
		mov	ah, 0
		shl	ax, 3
		add	ax, 18F0h
		mov	di, ax
		cmp	[bp+var_6], 3
		ja	short loc_17F24
		add	di, 4

loc_17F24:
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 16
		mov	[bp+var_5], 10h
		jmp	short loc_17F5A
; ---------------------------------------------------------------------------

loc_17F35:
		mov	al, [si+6]
		mov	ah, 0
		shl	ax, 2
		add	ax, 1DF8h
		mov	di, ax
		cmp	[bp+var_6], 3
		ja	short loc_17F4B
		add	di, 2

loc_17F4B:
		mov	_sprite16_put_w, (16 / 16)
		mov	_sprite16_put_h, 8
		mov	[bp+var_5], 8

loc_17F5A:
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT
		push	word ptr [si+2]
		mov	al, [si+8]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	dl, [bp+var_5]
		mov	dh, 0
		sub	ax, dx
		mov	[bp+@@left], ax
		mov	ax, [si+4]
		sar	ax, 4
		add	ax, 16
		mov	dl, [bp+var_5]
		mov	dh, 0
		sub	ax, dx
		mov	[bp+@@top], ax
		call	sprite16_put pascal, [bp+@@left], ax, di
		pop	di
		pop	si
		leave
		retn
sub_17EF7	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_17F9F	proc near
		push	bp
		mov	bp, sp
		mov	bx, word_2203C
		cmp	byte ptr [bx+1], 0Eh
		jnz	short loc_17FB1
		mov	byte ptr [bx], 0Ah
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_17FB1:
		mov	bx, word_2203C
		cmp	byte ptr [bx+1], 20h ; ' '
		jnz	short loc_17FC0
		mov	byte ptr [bx], 9
		pop	bp
		retn
; ---------------------------------------------------------------------------

loc_17FC0:
		mov	bx, word_2203C
		cmp	byte ptr [bx+1], 24h ; '$'
		jb	short loc_17FCD
		mov	byte ptr [bx], 0

loc_17FCD:
		pop	bp
		retn
sub_17F9F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_17FCF	proc near

@@top		= word ptr -6
@@left		= word ptr -4
var_1		= byte ptr -1

		enter	6, 0
		push	si
		mov	bx, word_2203C
		cmp	byte ptr [bx+1], 0Ch
		jnb	short loc_17FE4
		mov	si, word_1DDA6
		jmp	short loc_18019
; ---------------------------------------------------------------------------

loc_17FE4:
		mov	bx, word_2203C
		cmp	byte ptr [bx+1], 20h ; ' '
		jnb	short loc_1800B
		mov	al, [bx+1]
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		mov	[bp+var_1], al
		mov	ah, 0
		and	ax, 1
		add	ax, ax
		mov	bx, ax
		mov	si, [bx+848h]
		jmp	short loc_18019
; ---------------------------------------------------------------------------

loc_1800B:
		mov	bx, word_2203C
		cmp	byte ptr [bx+1], 24h ; '$'
		jnb	short loc_18019
		mov	si, word_1DDAC

loc_18019:
		mov	_sprite16_put_w, (64 / 16)
		mov	_sprite16_put_h, 32
		mov	bx, word_2203C
		push	word ptr [bx+2]
		mov	al, [bx+8]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -32
		mov	[bp+@@left], ax
		mov	bx, word_2203C
		mov	ax, [bx+4]
		sar	ax, 4
		add	ax, -8
		mov	[bp+@@top], ax
		call	sprite16_put pascal, [bp+@@left], ax, si
		pop	si
		leave
		retn
sub_17FCF	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_18059	proc far
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	word_220F2, 8
		mov	word_220F4, 8
		mov	word_2203C, 4656h
		xor	di, di
		jmp	loc_18162
; ---------------------------------------------------------------------------

loc_18075:
		mov	bx, word_2203C
		cmp	byte ptr [bx], 0
		jz	loc_1815C
		mov	bx, word_2203C
		inc	byte ptr [bx+1]
		cmp	byte ptr [bx], 9
		jb	short loc_18092
		call	sub_17F9F
		jmp	loc_1815C
; ---------------------------------------------------------------------------

loc_18092:
		mov	bx, word_2203C
		cmp	byte ptr [bx], 1
		jnz	short loc_18100
		mov	si, [bx+2]
		add	si, [bx+10h]
		mov	al, [bx+8]
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_INACTIVE
		jnz	short loc_180BB
		cmp	si, 0FF00h
		jle	short loc_180BB
		cmp	si, 1300h
		jl	short loc_180C5

loc_180BB:
		mov	bx, word_2203C
		mov	byte ptr [bx], 0
		jmp	loc_1815C
; ---------------------------------------------------------------------------

loc_180C5:
		mov	bx, word_2203C
		mov	[bx+2],	si
		mov	si, [bx+4]
		add	si, [bx+12h]
		cmp	si, 1800h
		jge	short loc_180BB
		mov	bx, word_2203C
		mov	[bx+4],	si
		cmp	byte ptr [bx], 1
		jnz	short loc_1815C
		mov	ax, [bx+2]
		mov	word_220EE, ax
		mov	ax, [bx+4]
		add	ax, 80h
		mov	word_220F0, ax
		mov	al, [bx+8]
		mov	byte_220FA, al
		nopcall	sub_13A6E
		jmp	short loc_1815C
; ---------------------------------------------------------------------------

loc_18100:
		mov	bx, word_2203C
		cmp	byte ptr [bx], 2
		jnz	short loc_1815C
		mov	si, [bx+2]
		add	si, [bx+10h]
		cmp	byte ptr [bx+8], 0
		jnz	short loc_18143
		cmp	[bx+16h], si
		jg	short loc_1814C

loc_1811A:
		mov	bx, word_2203C
		mov	ax, [bx+14h]
		mov	[bx+2],	ax
		mov	word ptr [bx+4], 0
		mov	word ptr [bx+10h], 0
		mov	al, [bx+1Bh]
		mov	ah, 0
		mov	[bx+12h], ax
		mov	byte ptr [bx], 1
		mov	al, 1
		sub	al, [bx+8]
		mov	[bx+8],	al
		jmp	short loc_1815C
; ---------------------------------------------------------------------------

loc_18143:
		mov	bx, word_2203C
		cmp	[bx+16h], si
		jge	short loc_1811A

loc_1814C:
		mov	bx, word_2203C
		mov	[bx+2],	si
		mov	si, [bx+4]
		add	si, [bx+12h]
		mov	[bx+4],	si

loc_1815C:
		inc	di
		add	word_2203C, 30h	; '0'

loc_18162:
		cmp	di, 18h
		jl	loc_18075
		pop	di
		pop	si
		pop	bp
		retf
sub_18059	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1816D	proc near

arg_0		= word ptr  4
arg_2		= word ptr  6

		push	bp
		mov	bp, sp
		push	si
		mov	si, [bp+arg_0]
		mov	al, byte ptr [bp+arg_2]
		mov	ah, 0
		shl	ax, 4
		mov	bx, ax
		mov	al, [bx+si+4B3Eh]
		mov	ah, 0
		mov	dl, byte_23AF8
		mov	dh, 0
		mov	bx, 20h	; ' '
		push	ax
		mov	ax, dx
		cwd
		idiv	bx
		mov	dx, 6
		sub	dx, ax
		pop	ax
		cmp	ax, dx
		jl	short loc_181BE
		mov	al, byte ptr [bp+arg_2]
		mov	ah, 0
		shl	ax, 4
		mov	bx, ax
		mov	byte ptr [bx+si+4B3Eh],	0
		mov	bx, word_2203C
		push	word ptr [bx+2]
		push	word ptr [bx+4]
		push	[bp+arg_2]
		call	sub_1A17E

loc_181BE:
		pop	si
		pop	bp
		retn	4
sub_1816D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_181C3	proc near

@@pid		= byte ptr -2
var_1		= byte ptr -1

		enter	2, 0
		push	si
		mov	word_20E32, 0C0h
		mov	word_20E34, 0A0h
		mov	word_2203C, 4AA6h
		mov	byte_1E14C, 1
		mov	si, 3Fh	; '?'
		jmp	loc_1836D
; ---------------------------------------------------------------------------

loc_181E5:
		mov	bx, word_2203C
		cmp	byte ptr [bx], 1
		jnz	loc_18367
		mov	bx, word_2203C
		mov	al, [bx+6]
		mov	byte_2203A, al
		mov	al, [bx+8]
		mov	[bp+@@pid], al
		mov	ax, [bx+2]
		mov	word_20E2E, ax
		mov	ax, [bx+4]
		add	ax, 30h	; '0'
		mov	word_20E30, ax
		mov	al, [bp+@@pid]
		mov	pid_20E3A, al
		nopcall	sub_158F5
		or	al, al
		jz	loc_18367
		mov	bx, word_2203C
		cmp	byte ptr [bx+7], 0
		jz	short loc_1823A
		cmp	byte_2203B, 0
		jnz	short loc_1823A
		cmp	byte_26356, 0
		jz	loc_18353

loc_1823A:
		mov	bx, word_2203C
		mov	al, [bx+20h]
		mov	byte_26358, al
		cmp	byte_2203B, 0
		jz	loc_182D6
		mov	byte ptr [bx], 9
		mov	al, hitcombo_slot_220C2
		mov	[bp+var_1], al
		mov	[bx+1Ch], al
		cmp	byte_2203A, 3
		jnz	short loc_18275
		mov	al, [bp+@@pid]
		mov	ah, 0
		shl	ax, 4
		mov	dl, [bp+var_1]
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		inc	byte ptr [bx+4B3Eh]

loc_18275:
		mov	al, [bp+@@pid]
		mov	ah, 0
		shl	ax, 4
		mov	dl, [bp+var_1]
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		mov	al, [bx+4B3Eh]
		mov	ah, 0
		mov	dl, byte_23AF8
		mov	dh, 0
		mov	bx, 20h	; ' '
		push	ax
		mov	ax, dx
		cwd
		idiv	bx
		mov	dx, 7
		sub	dx, ax
		pop	ax
		cmp	ax, dx
		jl	short loc_182CD
		mov	al, [bp+@@pid]
		mov	ah, 0
		shl	ax, 4
		mov	dl, [bp+var_1]
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		mov	byte ptr [bx+4B3Eh], 0
		mov	bx, word_2203C
		push	word ptr [bx+2]
		push	word ptr [bx+4]
		push	word ptr [bp+@@pid]
		call	sub_1A17E

loc_182CD:
		cmp	byte_26358, 4
		jnb	short loc_18345
		jmp	short loc_18341
; ---------------------------------------------------------------------------

loc_182D6:
		mov	al, [bp+@@pid]
		mov	ah, 0
		shl	ax, 4
		mov	dl, [bp+@@pid]
		mov	dh, 0
		mov	bx, dx
		mov	dl, _hitcombo_ring_p[bx]
		mov	dh, 0
		add	ax, dx
		mov	bx, ax
		mov	al, [bx+4B3Eh]
		add	al, byte_2203A
		add	al, -1
		mov	dl, [bp+@@pid]
		mov	dh, 0
		shl	dx, 4
		mov	bl, [bp+@@pid]
		mov	bh, 0
		mov	bl, _hitcombo_ring_p[bx]
		mov	bh, 0
		add	dx, bx
		mov	bx, dx
		mov	[bx+4B3Eh], al
		mov	bx, word_2203C
		mov	byte ptr [bx], 0
		push	word ptr [bp+@@pid]
		mov	al, [bp+@@pid]
		mov	ah, 0
		mov	bx, ax
		mov	al, _hitcombo_ring_p[bx]
		mov	ah, 0
		push	ax
		call	sub_1816D
		call	gauge_avail_add pascal, word ptr [bp+@@pid], 16
		call	score_add pascal, 50, word ptr [bp+@@pid]

loc_18341:
		call	sub_17DAE

loc_18345:
		push	word ptr [bp+@@pid]
		mov	al, [bp+var_1]
		mov	ah, 0
		push	ax
		call	sub_1816D
		jmp	short loc_1835A
; ---------------------------------------------------------------------------

loc_18353:
		mov	bx, word_2203C
		dec	byte ptr [bx+7]

loc_1835A:
		mov	byte_26357, 1
		mov	bx, word_2203C
		mov	byte ptr [bx+1], 0

loc_18367:
		dec	si
		sub	word_2203C, 30h	; '0'

loc_1836D:
		cmp	si, 28h	; '('
		jge	loc_181E5
		mov	byte_1E14C, 0
		pop	si
		leave
		retn
sub_181C3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1837C	proc far
		push	bp
		mov	bp, sp
		push	si
		call	sub_181C3
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT
		mov	word_2203C, 4656h
		xor	si, si
		jmp	short loc_183B9
; ---------------------------------------------------------------------------

loc_18399:
		mov	bx, word_2203C
		cmp	byte ptr [bx], 0
		jz	short loc_183B3
		mov	bx, word_2203C
		cmp	byte ptr [bx], 9
		jnb	short loc_183B0
		call	sub_17EF7
		jmp	short loc_183B3
; ---------------------------------------------------------------------------

loc_183B0:
		call	sub_17FCF

loc_183B3:
		inc	si
		add	word_2203C, 30h	; '0'

loc_183B9:
		cmp	si, 18h
		jl	short loc_18399
		pop	si
		pop	bp
		retf
sub_1837C	endp

main_04_TEXT	ends

; ===========================================================================

; Segment type:	Pure code
main_05_TEXT	segment	byte public 'CODE' use16
		assume cs:main_05_TEXT
		;org 1
		assume es:nothing, ss:nothing, ds:_DATA, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

chiyuri_bomb	proc far

var_2		= byte ptr -2
@@frame		= byte ptr -1

		enter	2, 0
		push	si
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_INACTIVE
		jz	@@ret
		call	egc_off
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, _bomb_frame[bx]
		mov	[bp+@@frame], al
		cmp	[bp+@@frame], 64
		jnb	short loc_18455
		push	GC_RMW
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	grcg_setcolor
		mov	bx, 3932h
		cmp	_pid_current, 0
		jz	short loc_1840A
		add	bx, 28h	; '('

loc_1840A:
		call	sub_B39E
		call	grcg_off
		mov	al, [bp+@@frame]
		shl	al, 2
		mov	dl, 255
		sub	dl, al
		mov	[bp+var_2], dl
		mov	al, [bp+var_2]
		mov	ah, 0
		push	ax
		push	word ptr _pid_current
		call	sub_A3D2
		mov	al, [bp+@@frame]
		mov	ah, 0
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_185A3
		push	9000B80h
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	sub_CE0C
		jmp	loc_185A3
; ---------------------------------------------------------------------------

loc_18455:
		cmp	[bp+@@frame], 144
		jnb	loc_1853F
		mov	_palette_changed, 1
		mov	al, [bp+@@frame]
		mov	ah, 0
		and	ax, 3
		cmp	ax, 2
		jge	short loc_1848B
		mov	PaletteTone, 60
		mov	_palette_changed, 1
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 4
		jmp	short loc_184A5
; ---------------------------------------------------------------------------

loc_1848B:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], -4
		mov	PaletteTone, 120
		mov	_palette_changed, 1

loc_184A5:
		mov	al, [bp+@@frame]
		mov	ah, 0
		mov	bx, 16
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_18518
		call	snd_se_play pascal, 10
		mov	al, [bp+@@frame]
		mov	ah, 0
		add	ax, -64
		add	ax, ax
		shl	ax, 4
		mov	si, ax
		mov	ax, 900h
		sub	ax, si
		push	ax
		push	0B80h
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	sub_CE5B
		lea	ax, [si+900h]
		push	ax
		push	0B80h
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	sub_CE5B
		push	900h
		mov	ax, 0B80h
		sub	ax, si
		push	ax
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	sub_CE5B
		push	900h
		lea	ax, [si+0B80h]
		push	ax
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	sub_CE5B

loc_18518:
		mov	si, PLAYFIELD_LEFT
		cmp	_pid_current, 0
		jz	short loc_18526
		add	si, PLAYFIELD_W_BORDERED

loc_18526:
		push	si	; left
		push	PLAYFIELD_TOP	; top
		mov	al, _pid_current
		mov	ah, 0
		add	ax, 2
		push	ax	; slot
		mov	al, _pid_current
		mov	ah, 0
		push	ax	; altered_colors
		call	@mrs_put_noalpha_8$qiuiic
		jmp	short loc_185A3
; ---------------------------------------------------------------------------

loc_1853F:
		mov	PaletteTone, 100
		mov	_palette_changed, 1
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 0
		mov	al, [bp+@@frame]
		shl	al, 3
		mov	dl, 255
		sub	dl, al
		mov	[bp+@@frame], dl
		mov	al, [bp+@@frame]
		add	al, al
		mov	[bp+var_2], al
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	dl, [bp+var_2]
		mov	bx, ax
		mov	Palettes[bx].r, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].g, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	dl, [bp+@@frame]
		mov	bx, ax
		mov	Palettes[bx].b, dl
		mov	_palette_changed, 1

loc_185A3:
		call	egc_on

@@ret:
		pop	si
		leave
		retf
chiyuri_bomb	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

ellen_185AB	proc far
		push	bp
		mov	bp, sp
		push	si
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_INACTIVE
		jz	@@ret
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_PREPARING
		jnz	short loc_1860D
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	_bomb_state[bx], BOMB_ACTIVE
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	_bomb_frame[bx], 0
		xor	si, si
		jmp	short loc_18601
; ---------------------------------------------------------------------------

loc_185E9:
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 6
		mov	dx, si
		shl	dx, 3
		add	ax, dx
		mov	bx, ax
		mov	word ptr [bx+25DEh], 4E1Fh
		inc	si

loc_18601:
		cmp	si, 8
		jl	short loc_185E9
		call	snd_se_play pascal, 17

loc_1860D:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	_bomb_frame[bx]
		mov	word_1F2EC, 0FE00h
		mov	word_1F2EE, 0FE00h
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 6
		add	ax, 25DEh
		mov	word_1FBBE, ax
		xor	si, si
		jmp	short loc_18698
; ---------------------------------------------------------------------------

loc_18636:
		mov	bx, word_1FBBE
		cmp	word ptr [bx], 270Fh
		jz	short loc_18667
		mov	bx, word_1FBBE
		cmp	word ptr [bx], 4E1Fh
		jz	short loc_18692
		mov	bx, word_1FBBE
		mov	ax, [bx+4]
		add	[bx], ax
		mov	ax, [bx+6]
		add	[bx+2],	ax
		push	word ptr [bx]
		push	word ptr [bx+2]
		call	sub_A310
		or	al, al
		jz	short loc_18692

loc_18667:
		mov	bx, word_1FBBE
		mov	word ptr [bx], 900h
		mov	word ptr [bx+2], 0B80h
		push	ds
		mov	ax, word_1FBBE
		add	ax, 4
		push	ax
		push	ds
		mov	ax, word_1FBBE
		add	ax, 6
		push	ax
		call	randring_far_next16
		push	ax
		push	224
		call	vector2

loc_18692:
		inc	si
		add	word_1FBBE, 8

loc_18698:
		cmp	si, 8
		jl	short loc_18636
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_frame[bx], BOMB_FRAMES
		jb	short @@ret
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	_bomb_state[bx], BOMB_INACTIVE
		push	word ptr _pid_current
		call	sub_A3A8

@@ret:
		pop	si
		pop	bp
		retf
ellen_185AB	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_186C3	proc near

@@sprite_offset		= word ptr -6
@@top		= word ptr -4
@@left		= word ptr -2

		enter	6, 0
		push	si
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 6
		add	ax, 25DEh
		mov	word_1FBBE, ax
		mov	_sprite16_put_w, (64 / 16)
		mov	_sprite16_put_h, 32
		cmp	_pid_current, 0
		jnz	short loc_186F6
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_18702
; ---------------------------------------------------------------------------

loc_186F6:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_18702:
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 29Ch
		mov	[bp+@@sprite_offset], ax
		xor	si, si
		jmp	short loc_1875E
; ---------------------------------------------------------------------------

loc_18711:
		mov	bx, word_1FBBE
		cmp	word ptr [bx], 4E1Fh
		jz	short loc_18758
		mov	bx, word_1FBBE
		cmp	word ptr [bx], 270Fh
		jz	short loc_18758
		mov	bx, word_1FBBE
		push	word ptr [bx]
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -32
		mov	[bp+@@left], ax
		mov	bx, word_1FBBE
		mov	ax, [bx+2]
		sar	ax, 4
		add	ax, -16
		mov	[bp+@@top], ax
		call	sprite16_put pascal, [bp+@@left], ax, [bp+@@sprite_offset]

loc_18758:
		inc	si
		add	word_1FBBE, 8

loc_1875E:
		cmp	si, 8
		jl	short loc_18711
		pop	si
		leave
		retn
sub_186C3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

ellen_bomb	proc far

var_4		= byte ptr -4
@@frame		= byte ptr -3
var_2		= word ptr -2

		enter	4, 0
		push	si
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_INACTIVE
		jz	@@ret
		call	egc_off
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, _bomb_frame[bx]
		mov	[bp+@@frame], al
		cmp	[bp+@@frame], 64
		jnb	short loc_18801
		push	GC_RMW
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	grcg_setcolor
		mov	bx, 3932h
		cmp	_pid_current, 0
		jz	short loc_187AF
		add	bx, 28h	; '('

loc_187AF:
		call	sub_B39E
		call	grcg_off
		mov	al, [bp+@@frame]
		add	al, al
		mov	[bp+var_4], al
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	dl, [bp+var_4]
		add	dl, dl
		mov	bx, ax
		mov	Palettes[bx].r, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	dl, [bp+var_4]
		mov	bx, ax
		mov	Palettes[bx].g, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].b, dl
		mov	_palette_changed, 1
		mov	word_1FB3C, 0
		jmp	loc_18964
; ---------------------------------------------------------------------------

loc_18801:
		cmp	[bp+@@frame], 128
		jnb	loc_18911
		test	[bp+@@frame], 1
		jz	short loc_18845
		call	snd_se_play pascal, 10
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].r, 255
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].g, 128
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].b, 128
		jmp	short loc_18872
; ---------------------------------------------------------------------------

loc_18845:
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].r, 0
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].g, 0
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].b, 32

loc_18872:
		mov	_palette_changed, 1
		mov	al, [bp+@@frame]
		mov	ah, 0
		and	ax, 3
		cmp	ax, 2
		jge	short loc_18895
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 4
		jmp	short loc_188A4
; ---------------------------------------------------------------------------

loc_18895:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], -4

loc_188A4:
		mov	si, PLAYFIELD_LEFT
		cmp	_pid_current, 0
		jz	short loc_188B2
		add	si, PLAYFIELD_W_BORDERED

loc_188B2:
		push	si	; left
		push	PLAYFIELD_TOP	; top
		mov	al, _pid_current
		mov	ah, 0
		add	ax, 2
		push	ax	; slot
		mov	al, _pid_current
		mov	ah, 0
		push	ax	; altered_colors
		call	@mrs_put_noalpha_8$qiuiic
		mov	al, [bp+@@frame]
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_18964
		push	9000B80h
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	sub_CDBD
		cmp	word_1FB3C, 8
		jge	short loc_18964
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 6
		mov	dx, word_1FB3C
		shl	dx, 3
		add	ax, dx
		mov	bx, ax
		mov	word ptr [bx+25DEh], 270Fh
		inc	word_1FB3C
		jmp	short loc_18964
; ---------------------------------------------------------------------------

loc_18911:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 0
		mov	al, [bp+@@frame]
		shl	al, 3
		mov	dl, 255
		sub	dl, al
		mov	[bp+var_4], dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		add	dl, dl
		and	dl, 255
		mov	bx, ax
		mov	Palettes[bx].r, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	dl, [bp+var_4]
		mov	bx, ax
		mov	Palettes[bx].g, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].b, dl
		mov	_palette_changed, 1

loc_18964:
		call	egc_on
		cmp	[bp+@@frame], 64
		jb	short @@ret
		cmp	[bp+@@frame], 128
		jnb	short @@ret
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	ax, _playfield_fg_shift_x[bx]
		mov	[bp+var_2], ax
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 0
		call	sub_186C3
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	dx, [bp+var_2]
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], dx

@@ret:
		pop	si
		leave
		retf
ellen_bomb	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kana_bomb	proc far

var_2		= byte ptr -2
@@frame		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_INACTIVE
		jz	@@ret
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, _bomb_frame[bx]
		mov	[bp+@@frame], al
		cmp	[bp+@@frame], 64
		jnb	short loc_18A10
		mov	al, 64
		sub	al, [bp+@@frame]
		mov	[bp+var_2], al
		mov	ah, 0
		push	ax
		push	word ptr _pid_current
		call	sub_A3D2
		mov	al, [bp+@@frame]
		mov	ah, 0
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_18A08
		push	9000B80h
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	sub_CE0C

loc_18A08:
		mov	angle_1FBD4, 0
		jmp	@@ret
; ---------------------------------------------------------------------------

loc_18A10:
		cmp	[bp+@@frame], 128
		jnb	loc_18B5B
		call	egc_off
		mov	al, [bp+@@frame]
		mov	ah, 0
		and	ax, 3
		cmp	ax, 2
		jge	short loc_18A4E
		call	snd_se_play pascal, 10
		push	160
		push	word ptr _pid_current
		call	sub_A3D2
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 4
		jmp	short loc_18A68
; ---------------------------------------------------------------------------

loc_18A4E:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], -4
		push	0
		push	word ptr _pid_current
		call	sub_A3D2

loc_18A68:
		mov	al, [bp+@@frame]
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_18B2F
		mov	al, angle_1FBD4
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, large (144 shl 16) or 144, _CosTable8[bx]
		mov	si, ax
		mov	al, angle_1FBD4
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, large (144 shl 16) or 184, _SinTable8[bx]
		mov	di, ax
		mov	ax, si
		shl	ax, 4
		push	ax
		mov	ax, di
		shl	ax, 4
		push	ax
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	sub_CDBD
		mov	al, 80h
		sub	al, angle_1FBD4
		mov	angle_1FBD4, al
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, large (144 shl 16) or 144, _CosTable8[bx]
		mov	si, ax
		mov	al, angle_1FBD4
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		call	_vector1_at c, large (144 shl 16) or 184, _SinTable8[bx]
		mov	di, ax
		mov	ax, si
		shl	ax, 4
		push	ax
		mov	ax, di
		shl	ax, 4
		push	ax
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	sub_CDBD
		mov	al, 80h
		sub	al, angle_1FBD4
		mov	angle_1FBD4, al
		add	al, 10h
		mov	angle_1FBD4, al

loc_18B2F:
		mov	si, PLAYFIELD_LEFT
		cmp	_pid_current, 0
		jz	short loc_18B3D
		add	si, PLAYFIELD_W_BORDERED

loc_18B3D:
		push	si	; left
		push	PLAYFIELD_TOP	; top
		mov	al, _pid_current
		mov	ah, 0
		add	ax, 2
		push	ax	; slot
		mov	al, _pid_current
		mov	ah, 0
		push	ax	; altered_colors
		call	@mrs_put_noalpha_8$qiuiic
		call	egc_on
		jmp	short @@ret
; ---------------------------------------------------------------------------

loc_18B5B:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 0
		mov	al, [bp+@@frame]
		shl	al, 3
		mov	dl, 255
		sub	dl, al
		mov	[bp+@@frame], dl

loc_18B77:
		mov	al, [bp+@@frame]
		add	al, al
		mov	[bp+var_2], al
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	dl, [bp+var_2]
		mov	bx, ax
		mov	Palettes[bx].r, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].g, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	dl, [bp+@@frame]
		mov	bx, ax
		mov	Palettes[bx].b, dl
		mov	_palette_changed, 1

@@ret:
		pop	di
		pop	si
		leave
		retf
kana_bomb	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kotohime_bomb	proc far

var_2		= byte ptr -2
@@frame		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_INACTIVE
		jz	@@ret
		call	egc_off
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, _bomb_frame[bx]
		mov	[bp+@@frame], al
		cmp	[bp+@@frame], 64
		jnb	loc_18C95
		push	GC_RMW
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	grcg_setcolor
		mov	bx, 3932h
		cmp	_pid_current, 0
		jz	short loc_18C04
		add	bx, 28h	; '('

loc_18C04:
		call	sub_B39E
		call	grcg_off
		mov	al, [bp+@@frame]
		mov	ah, 0
		imul	ax, 3
		mov	[bp+var_2], al
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	dl, [bp+var_2]
		add	dl, 64
		mov	bx, ax
		mov	Palettes[bx].r, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	dl, [bp+var_2]
		add	dl, 32
		mov	bx, ax
		mov	Palettes[bx].g, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	dl, [bp+var_2]
		mov	bx, ax
		mov	Palettes[bx].b, dl
		mov	_palette_changed, 1
		mov	al, [bp+@@frame]
		mov	ah, 0
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_18DBF
		mov	al, [bp+@@frame]
		mov	ah, 0
		imul	ax, 48h
		mov	dx, 11B8h
		sub	dx, ax
		mov	si, dx
		mov	al, [bp+@@frame]
		mov	ah, 0
		imul	ax, 5Ch
		add	ax, 5Ch
		mov	word_1FE56, ax
		push	dx
		push	ax
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	sub_CDBD
		jmp	loc_18DBF
; ---------------------------------------------------------------------------

loc_18C95:
		cmp	[bp+@@frame], 128
		jnb	loc_18D5B
		mov	_palette_changed, 1
		mov	al, [bp+@@frame]
		mov	ah, 0
		and	ax, 3
		cmp	ax, 2
		jge	short loc_18CD2
		call	snd_se_play pascal, 10
		mov	PaletteTone, 170
		mov	_palette_changed, 1
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 4
		jmp	short loc_18CEC
; ---------------------------------------------------------------------------

loc_18CD2:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], -4
		mov	PaletteTone, 100
		mov	_palette_changed, 1

loc_18CEC:
		mov	al, [bp+@@frame]
		mov	ah, 0
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_18D34
		xor	si, si
		mov	al, [bp+@@frame]
		mov	ah, 0
		mov	bx, 10h
		cwd
		idiv	bx
		mov	ax, dx
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	di, ax
		jmp	short loc_18D28
; ---------------------------------------------------------------------------

loc_18D13:
		push	si
		push	word_1FE56
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	sub_CDBD
		add	si, 600h
		inc	di

loc_18D28:
		cmp	si, 1200h
		jle	short loc_18D13
		sub	word_1FE56, 2E0h

loc_18D34:
		mov	si, PLAYFIELD_LEFT
		cmp	_pid_current, 0
		jz	short loc_18D42
		add	si, PLAYFIELD_W_BORDERED

loc_18D42:
		push	si	; left
		push	PLAYFIELD_TOP	; top
		mov	al, _pid_current
		mov	ah, 0
		add	ax, 2
		push	ax	; slot
		mov	al, _pid_current
		mov	ah, 0
		push	ax	; altered_colors
		call	@mrs_put_noalpha_8$qiuiic
		jmp	short loc_18DBF
; ---------------------------------------------------------------------------

loc_18D5B:
		mov	PaletteTone, 100
		mov	_palette_changed, 1
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 0
		mov	al, [bp+@@frame]
		shl	al, 3
		mov	dl, 255
		sub	dl, al
		mov	[bp+@@frame], dl
		mov	al, [bp+var_2]
		add	al, al
		mov	[bp+var_2], al
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	dl, [bp+var_2]
		mov	bx, ax
		mov	Palettes[bx].r, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].g, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	dl, [bp+@@frame]
		mov	bx, ax
		mov	Palettes[bx].b, dl
		mov	_palette_changed, 1

loc_18DBF:
		call	egc_on

@@ret:
		pop	di
		pop	si
		leave
		retf
kotohime_bomb	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

rikako_bomb	proc far

var_2		= byte ptr -2
@@frame		= byte ptr -1

		enter	2, 0
		push	si
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	_bomb_state[bx], BOMB_INACTIVE
		jz	@@ret
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, _bomb_frame[bx]
		mov	[bp+@@frame], al
		call	egc_off
		cmp	[bp+@@frame], 64
		jnb	short loc_18E39
		push	GC_RMW
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	grcg_setcolor
		mov	bx, 3932h
		cmp	_pid_current, 0
		jz	short loc_18E11
		add	bx, 28h	; '('

loc_18E11:
		call	sub_B39E
		call	grcg_off
		mov	al, [bp+@@frame]
		shl	al, 2
		mov	[bp+var_2], al
		mov	ah, 0
		push	ax
		push	word ptr _pid_current
		call	sub_A3D2
		mov	word_220EC, 0
		jmp	loc_18FE2
; ---------------------------------------------------------------------------

loc_18E39:
		cmp	[bp+@@frame], 128
		jnb	loc_18F89
		mov	al, [bp+@@frame]
		mov	ah, 0
		and	ax, 3
		cmp	ax, 2
		jge	short loc_18E5F
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 4
		jmp	short loc_18E6E
; ---------------------------------------------------------------------------

loc_18E5F:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], -4

loc_18E6E:
		mov	si, PLAYFIELD_LEFT
		cmp	_pid_current, 0
		jz	short loc_18E7C
		add	si, PLAYFIELD_W_BORDERED

loc_18E7C:
		push	si	; left
		push	PLAYFIELD_TOP	; top
		mov	al, _pid_current
		mov	ah, 0
		add	ax, 2
		push	ax	; slot
		mov	al, _pid_current
		mov	ah, 0
		push	ax	; altered_colors
		call	@mrs_put_noalpha_8$qiuiic
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 15
		mov	ax, 900h
		sub	ax, word_220EC
		push	ax
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	si, ax
		call	grcg_vline pascal, ax, (8 shl 16) or 192
		mov	ax, word_220EC
		add	ax, 900h
		push	ax
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	si, ax
		call	grcg_vline pascal, ax, (8 shl 16) or 192
		mov	ax, word_220EC
		add	ax, ax
		mov	dx, 900h
		sub	dx, ax
		push	dx
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	si, ax
		call	grcg_vline pascal, ax, (8 shl 16) or 192
		mov	ax, word_220EC
		add	ax, ax
		add	ax, 900h
		push	ax
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	si, ax
		call	grcg_vline pascal, ax, (8 shl 16) or 192
		add	word_220EC, 41h	; 'A'
		cmp	word_220EC, 480h
		jl	short loc_18F38
		mov	word_220EC, 0

loc_18F38:
		call	grcg_off
		mov	al, [bp+@@frame]
		mov	ah, 0
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_18F71
		push	3FFh
		call	randring_far_next16_and
		mov	si, ax
		jmp	short loc_18F6B
; ---------------------------------------------------------------------------

loc_18F58:
		push	si
		push	1700h
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	sub_CDBD
		add	si, 600h

loc_18F6B:
		cmp	si, 1200h
		jle	short loc_18F58

loc_18F71:
		mov	al, [bp+@@frame]
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_18FE2
		call	snd_se_play pascal, 5
		jmp	short loc_18FE2
; ---------------------------------------------------------------------------

loc_18F89:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	_playfield_fg_shift_x[bx], 0
		mov	al, [bp+@@frame]
		shl	al, 3
		mov	dl, 255
		sub	dl, al
		mov	[bp+@@frame], dl
		mov	al, [bp+@@frame]
		add	al, al
		mov	[bp+var_2], al
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	dl, [bp+var_2]
		mov	bx, ax
		mov	Palettes[bx].r, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	bx, ax
		mov	Palettes[bx].g, dl
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, size rgb_t
		mov	dl, [bp+@@frame]
		mov	bx, ax
		mov	Palettes[bx].b, dl
		mov	_palette_changed, 1

loc_18FE2:
		call	egc_on

@@ret:
		pop	si
		leave
		retf
rikako_bomb	endp

main_05_TEXT	ends

; ===========================================================================

; Segment type:	Pure code
main_06_TEXT	segment	byte public 'CODE' use16
		assume cs:main_06_TEXT
		;org 0Ah
		assume es:nothing, ss:nothing, ds:_DATA, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

chiyuri_18FEA	proc far

arg_0		= word ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		xor	di, di
		jmp	short loc_1904F
; ---------------------------------------------------------------------------

loc_19000:
		cmp	byte ptr [si], 0
		jnz	short loc_19049
		mov	word_2028A, si
		push	[bp+arg_4]
		push	[bp+arg_2]
		push	1140h
		call	randring_far_next16_mod
		add	ax, 60h
		push	ax
		push	0
		push	[bp+arg_0]
		push	50h ; 'P'
		call	sub_1A1ED
		add	word_2028A, 20h	; ' '
		push	[bp+arg_4]
		push	[bp+arg_2]
		push	1140h
		call	randring_far_next16_mod
		add	ax, 60h
		push	ax
		push	1780h
		push	[bp+arg_0]
		push	50h ; 'P'
		call	sub_1A1ED
		jmp	short loc_19054
; ---------------------------------------------------------------------------

loc_19049:
		add	di, 2
		add	si, 40h

loc_1904F:
		cmp	di, 10h
		jl	short loc_19000

loc_19054:
		pop	di
		pop	si
		pop	bp
		retf	6
chiyuri_18FEA	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1905A	proc near

var_A		= word ptr -0Ah
var_8		= word ptr -8
var_6		= word ptr -6
var_4		= word ptr -4
var_1		= byte ptr -1

		enter	0Ah, 0
		push	si
		push	di
		mov	si, word_2028A
		mov	al, [si+1]
		mov	[bp+var_1], al
		push	word ptr [si+2]
		mov	al, [si+10h]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	[bp+var_4], ax
		mov	ax, [si+4]
		sar	ax, 4
		add	ax, 10h
		mov	[bp+var_6], ax
		add	si, 20h	; ' '
		push	word ptr [si+2]
		mov	al, [si+10h]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	[bp+var_8], ax
		mov	ax, [si+4]
		sar	ax, 4
		add	ax, 10h
		mov	[bp+var_A], ax
		sub	si, 20h	; ' '
		cmp	byte ptr [si], 1
		jnz	loc_1920B
		call	egc_off
		cmp	[bp+var_1], 10h
		jb	loc_191E4
		cmp	[bp+var_1], 28h	; '('
		jnb	short loc_190CF
		mov	al, [bp+var_1]
		mov	ah, 0
		add	ax, 0FFF0h
		jmp	loc_19179
; ---------------------------------------------------------------------------

loc_190CF:
		cmp	[bp+var_1], 70h	; 'p'
		jnb	loc_19165
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 9
		push	8
		mov	ax, [bp+var_4]
		add	ax, -6
		push	ax
		mov	ax, [bp+var_4]
		add	ax, 6
		push	ax
		push	192
		mov	ax, [bp+var_8]
		add	ax, -6
		push	ax
		mov	ax, [bp+var_8]
		add	ax, 6
		push	ax
		call	grcg_trapezoid
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 10
		push	8
		mov	ax, [bp+var_4]
		add	ax, -3
		push	ax
		mov	ax, [bp+var_4]
		add	ax, 3
		push	ax
		push	192
		mov	ax, [bp+var_8]
		add	ax, -3
		push	ax
		mov	ax, [bp+var_8]
		add	ax, 3
		push	ax
		call	grcg_trapezoid
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 15
		push	8
		mov	ax, [bp+var_4]
		dec	ax
		push	ax
		mov	ax, [bp+var_4]
		inc	ax
		push	ax
		push	192
		mov	ax, [bp+var_8]
		dec	ax
		push	ax
		mov	ax, [bp+var_8]
		inc	ax
		push	ax
		call	grcg_trapezoid
		jmp	loc_191FF
; ---------------------------------------------------------------------------

loc_19165:
		cmp	[bp+var_1], 88h
		jnb	loc_191FF
		mov	al, [bp+var_1]
		mov	ah, 0
		push	ax
		mov	ax, 88h
		pop	dx
		sub	ax, dx

loc_19179:
		mov	bx, 4
		cwd
		idiv	bx
		mov	di, ax
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 9
		push	8
		mov	ax, [bp+var_4]
		sub	ax, di
		push	ax
		mov	ax, [bp+var_4]
		add	ax, di
		push	ax
		push	192
		mov	ax, [bp+var_8]
		sub	ax, di
		push	ax
		mov	ax, [bp+var_8]
		add	ax, di
		push	ax
		call	grcg_trapezoid
		mov	ax, di
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	di, ax
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 10
		push	8
		mov	ax, [bp+var_4]
		sub	ax, di
		push	ax
		mov	ax, [bp+var_4]
		add	ax, di
		push	ax
		push	192
		mov	ax, [bp+var_8]
		sub	ax, di
		push	ax
		mov	ax, [bp+var_8]
		add	ax, di
		push	ax
		call	grcg_trapezoid

loc_191E4:
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 15
		call	grcg_line pascal, [bp+var_4], 8, [bp+var_8], 192

loc_191FF:
		call	grcg_off
		call	egc_on
		jmp	short loc_1925C
; ---------------------------------------------------------------------------

loc_1920B:
		cmp	byte ptr [si], 2
		jnz	short loc_1921E
		push	[bp+var_4]
		push	[bp+var_6]
		push	word ptr [bp+var_1]
		call	sub_1A32A
		jmp	short loc_1922A
; ---------------------------------------------------------------------------

loc_1921E:
		push	[bp+var_4]
		push	[bp+var_6]
		push	word ptr [bp+var_1]
		call	sub_1A377

loc_1922A:
		add	word_2028A, 20h	; ' '
		add	si, 20h	; ' '
		mov	al, [si+1]
		mov	[bp+var_1], al
		cmp	byte ptr [si], 2
		jnz	short loc_1924B
		push	[bp+var_8]
		push	[bp+var_A]
		push	word ptr [bp+var_1]
		call	sub_1A32A
		jmp	short loc_19257
; ---------------------------------------------------------------------------

loc_1924B:
		push	[bp+var_8]
		push	[bp+var_A]
		push	word ptr [bp+var_1]
		call	sub_1A377

loc_19257:
		sub	word_2028A, 20h	; ' '

loc_1925C:
		pop	di
		pop	si
		leave
		retn
sub_1905A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

chiyuri_19260	proc far

@@pid_other		= byte ptr -3
var_2		= word ptr -2

		enter	4, 0
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	word_2028A, ax
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	word_220F2, 2
		mov	byte_220FA, al
		xor	di, di
		jmp	loc_1937F
; ---------------------------------------------------------------------------

loc_1928B:
		mov	bx, word_2028A
		cmp	byte ptr [bx], 0
		jz	short loc_1930C
		mov	si, word_2028A
		cmp	byte ptr [si], 1
		jnz	short loc_19313
		inc	byte ptr [si+1]
		cmp	byte ptr [si+1], 4
		jnz	short loc_192CC
		push	word ptr [si+2]
		push	0
		mov	al, [si+10h]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		add	si, 20h	; ' '
		push	word ptr [si+2]
		push	1700h
		mov	al, [si+10h]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		jmp	short loc_1930C
; ---------------------------------------------------------------------------

loc_192CC:
		cmp	byte ptr [si+1], 10h
		jnz	short loc_192DB
		call	snd_se_play pascal, 20
		jmp	short loc_1930C
; ---------------------------------------------------------------------------

loc_192DB:
		cmp	byte ptr [si+1], 28h ; '('
		jbe	short loc_192FD
		cmp	byte ptr [si+1], 70h ; 'p'
		jnb	short loc_192FD
		mov	ax, [si+2]
		mov	word_220EE, ax
		add	si, 20h	; ' '
		mov	ax, [si+2]
		mov	word_220F6, ax
		call	sub_13B9A
		jmp	short loc_1930C
; ---------------------------------------------------------------------------

loc_192FD:
		cmp	byte ptr [si+1], 88h
		jbe	short loc_1930C
		mov	byte ptr [si], 0
		add	si, 20h	; ' '
		mov	byte ptr [si], 0

loc_1930C:
		add	word_2028A, 20h	; ' '
		jmp	short loc_19377
; ---------------------------------------------------------------------------

loc_19313:
		mov	[bp+var_2], 0
		cmp	byte ptr [si], 2
		jnz	short loc_1932B
		call	sub_1A1A7
		or	al, al
		jz	short loc_1933D
		mov	word ptr [si+4], 0
		jmp	short loc_1933D
; ---------------------------------------------------------------------------

loc_1932B:
		cmp	byte ptr [si], 1Ch
		ja	short loc_19334
		inc	byte ptr [si]
		jmp	short loc_1933D
; ---------------------------------------------------------------------------

loc_19334:
		mov	byte ptr [si+1], 0
		mov	[bp+var_2], 1

loc_1933D:
		inc	byte ptr [si+1]
		add	si, 20h	; ' '
		add	word_2028A, 20h	; ' '
		cmp	byte ptr [si], 2
		jnz	short loc_1935B
		call	sub_1A1A7
		or	al, al
		jz	short loc_19374
		mov	word ptr [si+4], 1700h
		jmp	short loc_19374
; ---------------------------------------------------------------------------

loc_1935B:
		cmp	byte ptr [si], 1Ch
		ja	short loc_19364
		inc	byte ptr [si]
		jmp	short loc_19374
; ---------------------------------------------------------------------------

loc_19364:
		mov	byte ptr [si+1], 0
		cmp	[bp+var_2], 0
		jz	short loc_19374
		sub	si, 20h	; ' '
		mov	byte ptr [si], 1

loc_19374:
		inc	byte ptr [si+1]

loc_19377:
		add	di, 2
		add	word_2028A, 20h	; ' '

loc_1937F:
		cmp	di, 10h
		jl	loc_1928B
		pop	di
		pop	si
		leave
		retf
chiyuri_19260	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

chiyuri_1938A	proc far
		push	bp
		mov	bp, sp
		push	si
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	word_2028A, ax
		xor	si, si
		jmp	short loc_193B4
; ---------------------------------------------------------------------------

loc_193A0:
		mov	bx, word_2028A
		cmp	byte ptr [bx], 0
		jz	short loc_193AC
		call	sub_1905A

loc_193AC:
		add	si, 2
		add	word_2028A, 40h

loc_193B4:
		cmp	si, 10h
		jl	short loc_193A0
		pop	si
		pop	bp
		retf
chiyuri_1938A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_193BC	proc far
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	si, 230Ah
		mov	di, 2472h
		xor	dx, dx
		jmp	short loc_193E6
; ---------------------------------------------------------------------------

loc_193CB:
		mov	ax, dx
		shl	ax, 5
		add	ax, 292Ah
		mov	[si], ax
		mov	ax, dx
		shl	ax, 5
		add	ax, 2B2Ah
		mov	[di], ax
		inc	dx
		add	si, 1Eh
		add	di, 1Eh

loc_193E6:
		cmp	dx, 0Ch
		jl	short loc_193CB
		pop	di
		pop	si
		pop	bp
		retf
sub_193BC	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

ellen_193EF	proc far

var_7		= byte ptr -7
var_6		= byte ptr -6
var_5		= byte ptr -5
var_4		= word ptr -4
var_2		= word ptr -2
arg_0		= word ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah

		enter	8, 0
		push	si
		mov	[bp+var_5], 0
		push	0C80h
		call	randring_far_next16_mod
		add	ax, 2C0h
		mov	[bp+var_2], ax
		push	0C80h
		call	randring_far_next16_mod
		add	ax, 500h
		mov	[bp+var_4], ax
		push	1
		call	randring_far_next16_and
		or	ax, ax
		jnz	short loc_19423
		mov	al, -1
		jmp	short loc_19425
; ---------------------------------------------------------------------------

loc_19423:
		mov	al, 1

loc_19425:
		mov	[bp+var_6], al
		call	randring_far_next16
		mov	[bp+var_7], al
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		imul	ax, 168h
		add	ax, 230Ah
		mov	word_1FB3A, ax
		xor	si, si
		jmp	short loc_1949F
; ---------------------------------------------------------------------------

loc_19443:
		mov	bx, word_1FB3A
		mov	bx, [bx]
		cmp	byte ptr [bx], 0
		jnz	short loc_19499
		mov	bx, word_1FB3A
		mov	ax, [bx]
		mov	word_2028A, ax
		push	[bp+arg_4]
		push	[bp+arg_2]
		push	[bp+var_2]
		push	[bp+var_4]
		push	[bp+arg_0]
		push	46h ; 'F'
		call	sub_1A1ED
		mov	bx, word_2028A
		mov	word ptr [bx+14h], 0
		mov	al, [bp+var_6]
		mov	[bx+11h], al
		cmp	[bp+var_5], 0
		jnz	short loc_1948B
		mov	al, [bp+var_7]
		mov	[bx+12h], al
		inc	[bp+var_5]
		jmp	short loc_19499
; ---------------------------------------------------------------------------

loc_1948B:
		mov	al, [bp+var_7]
		add	al, 80h
		mov	bx, word_2028A
		mov	[bx+12h], al
		jmp	short loc_194A4
; ---------------------------------------------------------------------------

loc_19499:
		inc	si
		add	word_1FB3A, 1Eh

loc_1949F:
		cmp	si, 0Ch
		jl	short loc_19443

loc_194A4:
		pop	si
		leave
		retf	6
ellen_193EF	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_194A9	proc far

arg_0		= byte ptr  6
arg_2		= byte ptr  8
arg_4		= word ptr  0Ah
arg_6		= word ptr  0Ch

		push	bp
		mov	bp, sp
		push	si
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 168h
		add	ax, 230Ah
		mov	word_1FB3A, ax
		xor	dx, dx
		jmp	short loc_19506
; ---------------------------------------------------------------------------

loc_194C0:
		mov	bx, word_1FB3A
		mov	bx, [bx]
		cmp	byte ptr [bx], 0
		jnz	short loc_19500
		mov	bx, word_1FB3A
		mov	si, [bx]
		mov	byte ptr [si], 1
		mov	byte ptr [si+1], 0
		mov	ax, [bp+arg_6]
		mov	[si+2],	ax
		mov	ax, [bp+arg_4]
		mov	[si+4],	ax
		mov	word ptr [si+14h], 0
		mov	al, [bp+arg_0]
		mov	[si+11h], al
		mov	al, [bp+arg_2]
		mov	[si+12h], al
		mov	al, 1
		sub	al, _pid_current
		mov	[si+10h], al
		jmp	short loc_1950B
; ---------------------------------------------------------------------------

loc_19500:
		inc	dx
		add	word_1FB3A, 1Eh

loc_19506:
		cmp	dx, 0Ch
		jl	short loc_194C0

loc_1950B:
		pop	si
		pop	bp
		retf	8
sub_194A9	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_19510	proc near

var_9		= word ptr -9
@@left		= word ptr -8
@@top		= word ptr -6
var_4		= word ptr -4
@@x		= word ptr -2

		enter	0Ah, 0
		push	si
		push	di
		mov	bx, word_1FB3A
		mov	bx, [bx]
		push	word ptr [bx+2]
		mov	bx, word_1FB3A
		mov	bx, [bx]
		mov	al, [bx+10h]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	[bp+@@x], ax
		mov	bx, word_1FB3A
		mov	bx, [bx]
		mov	ax, [bx+4]
		sar	ax, 4
		add	ax, 10h
		mov	[bp+var_4], ax
		mov	bx, word_1FB3A
		mov	bx, [bx]
		cmp	byte ptr [bx+10h], 0
		jnz	short loc_1955F
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_1956B
; ---------------------------------------------------------------------------

loc_1955F:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_1956B:
		mov	bx, word_1FB3A
		mov	bx, [bx]
		mov	al, [bx+1]
		mov	byte ptr [bp+var_9], al
		mov	bx, word_1FB3A
		mov	bx, [bx]
		cmp	byte ptr [bx], 1
		jnz	short loc_195EF
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 16
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 28Ch
		mov	di, ax
		mov	si, 6
		jmp	short loc_195E9
; ---------------------------------------------------------------------------

loc_1959C:
		mov	bx, si
		add	bx, bx
		add	bx, word_1FB3A
		push	word ptr [bx+2]
		mov	bx, word_1FB3A
		mov	bx, [bx]
		mov	al, [bx+10h]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	[bp+@@left], ax
		mov	bx, si
		add	bx, bx
		add	bx, word_1FB3A
		mov	ax, [bx+10h]
		sar	ax, 4
		add	ax, 16
		mov	[bp+@@top], ax
		mov	ax, [bp+@@left]
		add	ax, -16
		push	ax
		mov	ax, [bp+@@top]
		add	ax, -16
		push	ax
		push	di
		call	sprite16_put
		sub	di, 4
		sub	si, 2

loc_195E9:
		or	si, si
		jge	short loc_1959C
		jmp	short loc_19619
; ---------------------------------------------------------------------------

loc_195EF:
		mov	bx, word_1FB3A
		mov	bx, [bx]
		cmp	byte ptr [bx], 2
		jnz	short loc_19608
		push	[bp+@@x]
		push	[bp+var_4]
		push	[bp+var_9]
		call	sub_1A32A
		jmp	short loc_19619
; ---------------------------------------------------------------------------

loc_19608:
		push	[bp+@@x]
		push	[bp+var_4]
		mov	bx, word_1FB3A
		mov	bx, [bx]
		push	word ptr [bx]
		call	sub_1A377

loc_19619:
		pop	di
		pop	si
		leave
		retn
sub_19510	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

ellen_1961D	proc far

@@pid_other		= byte ptr -5
var_4		= word ptr -4
var_2		= word ptr -2

		enter	6, 0
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 168h
		add	ax, 230Ah
		mov	di, ax
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	word_1F2EC, 0FE80h
		mov	word_1F2EE, 0FE80h
		mov	word_220F2, 6
		mov	word_220F4, 6
		mov	byte_220FA, al
		mov	[bp+var_2], 0
		jmp	loc_197E7
; ---------------------------------------------------------------------------

loc_1965D:
		mov	bx, [di]
		cmp	byte ptr [bx], 0
		jz	loc_197E1
		mov	bx, [di]
		cmp	byte ptr [bx], 1
		jnz	loc_19780
		mov	[bp+var_4], 6
		jmp	short loc_1969B
; ---------------------------------------------------------------------------

loc_19676:
		mov	bx, [bp+var_4]
		dec	bx
		add	bx, bx
		mov	ax, [bx+di+2]
		mov	bx, [bp+var_4]
		add	bx, bx
		mov	[bx+di+2], ax
		mov	bx, [bp+var_4]
		dec	bx
		add	bx, bx
		mov	ax, [bx+di+10h]
		mov	bx, [bp+var_4]
		add	bx, bx
		mov	[bx+di+10h], ax
		dec	[bp+var_4]

loc_1969B:
		cmp	[bp+var_4], 0
		jg	short loc_19676
		mov	bx, [di]
		cmp	word ptr [bx+14h], 0D00h
		jg	short loc_1970C
		mov	al, [bx+12h]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_CosTable8[bx]
		mov	bx, [di]
		push	word ptr [bx+14h]
		push	word ptr [bx+2]
		call	_vector1_at
		add	sp, 6
		mov	[di+2],	ax
		mov	bx, [di]
		mov	al, [bx+12h]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_SinTable8[bx]
		mov	bx, [di]
		push	word ptr [bx+14h]
		push	word ptr [bx+4]
		call	_vector1_at
		add	sp, 6
		mov	[di+10h], ax
		mov	ax, [di+2]
		sub	ax, [di+4]
		mov	bx, [di]
		mov	[bx+6],	ax
		mov	ax, [di+10h]
		sub	ax, [di+12h]
		mov	[bx+8],	ax
		add	word ptr [bx+14h], 18h
		mov	al, [bx+11h]
		add	[bx+12h], al
		jmp	short loc_19740
; ---------------------------------------------------------------------------

loc_1970C:
		push	word ptr [di+2]
		push	word ptr [di+10h]
		call	sub_A310
		or	al, al
		jz	short loc_19732
		push	word ptr [di+0Eh]
		push	word ptr [di+1Ch]
		call	sub_A310
		or	al, al
		jz	short loc_19732
		mov	bx, [di]
		mov	byte ptr [bx], 0
		jmp	loc_197E1
; ---------------------------------------------------------------------------

loc_19732:
		mov	bx, [di]
		mov	ax, [bx+6]
		add	[di+2],	ax
		mov	ax, [bx+8]
		add	[di+10h], ax

loc_19740:
		mov	byte_20E2C, 1
		mov	word_20E32, 100h
		mov	word_20E34, 100h
		mov	al, [bp+@@pid_other]
		mov	pid_20E3A, al
		mov	ax, [di+2]
		mov	word_20E2E, ax
		mov	ax, [di+10h]
		mov	word_20E30, ax
		call	sub_158F5
		mov	byte_20E2C, 0
		mov	ax, [di+2]
		mov	word_220EE, ax
		mov	ax, [di+10h]
		mov	word_220F0, ax
		call	sub_13A6E
		jmp	short loc_197DC
; ---------------------------------------------------------------------------

loc_19780:
		mov	bx, [di]
		cmp	byte ptr [bx], 2
		jnz	short loc_197BF
		mov	ax, [di]
		mov	word_2028A, ax
		call	sub_1A1A7
		or	al, al
		jz	short loc_197DC
		mov	[bp+var_4], 0

loc_19798:
		jmp	short loc_197B7
; ---------------------------------------------------------------------------

loc_1979A:
		mov	bx, [bp+var_4]
		add	bx, bx
		mov	si, word_2028A
		mov	ax, [si+2]
		mov	[bx+di+2], ax
		mov	bx, [bp+var_4]
		add	bx, bx
		mov	ax, [si+4]
		mov	[bx+di+10h], ax
		inc	[bp+var_4]

loc_197B7:
		cmp	[bp+var_4], 7
		jl	short loc_1979A
		jmp	short loc_197DC
; ---------------------------------------------------------------------------

loc_197BF:
		mov	bx, [di]
		cmp	byte ptr [bx], 1Ch
		ja	short loc_197CA
		inc	byte ptr [bx]
		jmp	short loc_197DC
; ---------------------------------------------------------------------------

loc_197CA:
		mov	bx, [di]
		mov	byte ptr [bx+1], 0
		mov	bx, [di]
		mov	byte ptr [bx], 1
		call	snd_se_play pascal, 10

loc_197DC:
		mov	bx, [di]
		inc	byte ptr [bx+1]

loc_197E1:
		inc	[bp+var_2]
		add	di, 1Eh

loc_197E7:
		cmp	[bp+var_2], 0Ch
		jl	loc_1965D
		pop	di
		pop	si
		leave
		retf
ellen_1961D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

ellen_197F3	proc far
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 168h
		add	ax, 230Ah
		mov	si, ax
		xor	di, di
		jmp	short loc_1981C
; ---------------------------------------------------------------------------

loc_1980A:
		mov	bx, [si]
		cmp	byte ptr [bx], 0
		jz	short loc_19818
		mov	word_1FB3A, si
		call	sub_19510

loc_19818:
		inc	di
		add	si, 1Eh

loc_1981C:
		cmp	di, 0Ch
		jl	short loc_1980A
		pop	di
		pop	si
		pop	bp
		retf
ellen_197F3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kana_19825	proc far

var_2		= word ptr -2
arg_0		= word ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah

		enter	2, 0
		push	si
		push	di
		push	1200h
		call	randring_far_next16_mod
		mov	[bp+var_2], ax
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		xor	di, di
		jmp	short loc_1988B
; ---------------------------------------------------------------------------

loc_19847:
		cmp	byte ptr [si], 0
		jnz	short loc_19887
		mov	word_2028A, si
		push	[bp+arg_4]
		push	[bp+arg_2]
		push	[bp+var_2]
		push	800h
		call	randring_far_next16_mod
		push	ax
		push	[bp+arg_0]
		push	5Ah ; 'Z'
		call	sub_1A1ED
		push	1Fh
		call	randring_far_next16_and
		sub	al, 0Fh
		mov	[si+12h], al
		cmp	[bp+var_2], 900h
		jl	short loc_19890
		mov	al, [si+12h]
		add	al, 80h
		mov	[si+12h], al
		jmp	short loc_19890
; ---------------------------------------------------------------------------

loc_19887:
		inc	di
		add	si, 20h	; ' '

loc_1988B:
		cmp	di, 8
		jl	short loc_19847

loc_19890:
		pop	di
		pop	si
		leave
		retf	6
kana_19825	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_19896	proc far

arg_0		= byte ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah

		push	bp
		mov	bp, sp
		push	si
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		xor	dx, dx
		jmp	short loc_198D3
; ---------------------------------------------------------------------------

loc_198AB:
		cmp	byte ptr [si], 0
		jnz	short loc_198CF
		mov	byte ptr [si], 1
		mov	ax, [bp+arg_4]
		mov	[si+2],	ax
		mov	ax, [bp+arg_2]
		mov	[si+4],	ax
		mov	al, [bp+arg_0]
		mov	[si+12h], al
		mov	byte ptr [si+13h], 8
		mov	byte ptr [si+1], 0
		jmp	short loc_198D8
; ---------------------------------------------------------------------------

loc_198CF:
		inc	dx
		add	si, 20h	; ' '

loc_198D3:
		cmp	dx, 8
		jl	short loc_198AB

loc_198D8:
		pop	si
		pop	bp
		retf	6
sub_19896	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_198DD	proc near

var_5		= word ptr -5
@@top		= word ptr -4
@@left		= word ptr -2

		enter	6, 0
		push	si
		push	di
		mov	si, word_2028A
		push	word ptr [si+2]
		mov	al, [si+10h]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	[bp+@@left], ax
		mov	ax, [si+4]
		sar	ax, 4
		add	ax, 10h
		mov	[bp+@@top], ax
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		jnz	short loc_1991E
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_1992A
; ---------------------------------------------------------------------------

loc_1991E:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_1992A:
		mov	al, [si+1]
		mov	byte ptr [bp+var_5], al
		cmp	byte ptr [si], 1
		jnz	short loc_19976
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 16
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 284h
		mov	di, ax
		mov	al, byte ptr [bp+var_5]
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		cwd
		idiv	bx
		shl	dx, 5
		imul	dx, 28h
		add	di, dx
		mov	ax, [bp+@@left]
		add	ax, -16
		push	ax
		mov	ax, [bp+@@top]
		add	ax, -16
		push	ax
		push	di
		call	sprite16_put
		jmp	short loc_19995
; ---------------------------------------------------------------------------

loc_19976:
		cmp	byte ptr [si], 2
		jnz	short loc_19989
		push	[bp+@@left]
		push	[bp+@@top]
		push	[bp+var_5]
		call	sub_1A32A
		jmp	short loc_19995
; ---------------------------------------------------------------------------

loc_19989:
		push	[bp+@@left]
		push	[bp+@@top]
		push	[bp+var_5]
		call	sub_1A377

loc_19995:
		pop	di
		pop	si
		leave
		retn
sub_198DD	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kana_19999	proc far

@@pid_other		= byte ptr -5
@@vector_y		= word ptr -4
@@vector_x		= word ptr -2

		enter	6, 0
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	word_1F2EC, 0FE80h
		mov	word_1F2EE, 0FE80h
		xor	di, di
		jmp	loc_19A82
; ---------------------------------------------------------------------------

loc_199C6:
		cmp	byte ptr [si], 0
		jz	loc_19A7E
		mov	word_2028A, si
		cmp	byte ptr [si], 1
		jnz	loc_19A5D
		push	ss
		lea	ax, [bp+@@vector_x]
		push	ax
		push	ss
		lea	ax, [bp+@@vector_y]
		push	ax
		push	word ptr [si+12h]
		mov	al, [si+13h]
		mov	ah, 0
		push	ax
		call	vector2
		inc	byte ptr [si+13h]
		mov	ax, [bp+@@vector_x]
		add	[si+2],	ax
		mov	ax, [bp+@@vector_y]
		add	[si+4],	ax
		mov	al, [si+1]
		mov	ah, 0
		mov	bx, 10h
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_19A49
		mov	byte_23E4E, 8
		mov	angle_23E43, 40h
		mov	byte_23E45, 0
		mov	byte_23E46, 80h
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 1680h
		mov	word_23E4C, ax
		mov	byte_23E42, 10h
		mov	ax, [si+2]
		mov	word_23E3E, ax
		mov	ax, [si+4]
		mov	word_23E40, ax
		mov	al, [bp+@@pid_other]
		mov	_pid_other, al
		call	sub_17730

loc_19A49:
		push	word ptr [si+2]
		push	word ptr [si+4]
		call	sub_A310
		or	al, al
		jz	short loc_19A7B
		mov	byte ptr [si], 0
		jmp	short loc_19A7E
; ---------------------------------------------------------------------------

loc_19A5D:
		cmp	byte ptr [si], 2
		jnz	short loc_19A67
		call	sub_1A1A7
		jmp	short loc_19A7B
; ---------------------------------------------------------------------------

loc_19A67:
		cmp	byte ptr [si], 1Ch
		ja	short loc_19A70
		inc	byte ptr [si]
		jmp	short loc_19A7B
; ---------------------------------------------------------------------------

loc_19A70:
		mov	byte ptr [si+1], 0
		mov	byte ptr [si], 1
		mov	byte ptr [si+13h], 8

loc_19A7B:
		inc	byte ptr [si+1]

loc_19A7E:
		inc	di
		add	si, 20h	; ' '

loc_19A82:
		cmp	di, 8
		jl	loc_199C6
		pop	di
		pop	si
		leave
		retf
kana_19999	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kana_19A8D	proc far
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		xor	di, di
		jmp	short loc_19AB3
; ---------------------------------------------------------------------------

loc_19AA3:
		cmp	byte ptr [si], 0
		jz	short loc_19AAF
		mov	word_2028A, si
		call	sub_198DD

loc_19AAF:
		inc	di
		add	si, 20h	; ' '

loc_19AB3:
		cmp	di, 8
		jl	short loc_19AA3
		pop	di
		pop	si
		pop	bp
		retf
kana_19A8D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

marisa_19ABC	proc far

arg_0		= word ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		xor	di, di
		jmp	short loc_19AFB
; ---------------------------------------------------------------------------

loc_19AD2:
		cmp	byte ptr [si], 0
		jnz	short loc_19AF7
		mov	word_2028A, si
		push	[bp+arg_4]
		push	[bp+arg_2]
		push	1200h
		call	randring_far_next16_mod
		push	ax
		push	1700h
		push	[bp+arg_0]
		push	6Eh ; 'n'
		call	sub_1A1ED
		jmp	short loc_19B00
; ---------------------------------------------------------------------------

loc_19AF7:
		inc	di
		add	si, 20h	; ' '

loc_19AFB:
		cmp	di, 0Eh
		jl	short loc_19AD2

loc_19B00:
		pop	di
		pop	si
		pop	bp
		retf	6
marisa_19ABC	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_19B06	proc far

arg_0		= byte ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah

		push	bp
		mov	bp, sp
		push	si
		mov	al, [bp+arg_0]
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		shl	dx, 9
		add	dx, 292Ah
		mov	si, dx
		xor	cx, cx
		jmp	short loc_19B45
; ---------------------------------------------------------------------------

loc_19B21:
		cmp	byte ptr [si], 0
		jnz	short loc_19B41
		mov	byte ptr [si], 3
		mov	byte ptr [si+1], 0
		mov	ax, [bp+arg_4]
		mov	[si+2],	ax
		mov	ax, [bp+arg_2]
		mov	[si+4],	ax
		mov	al, [bp+arg_0]
		mov	[si+10h], al
		jmp	short loc_19B4A
; ---------------------------------------------------------------------------

loc_19B41:
		inc	cx
		add	si, 20h	; ' '

loc_19B45:
		cmp	cx, 0Eh
		jl	short loc_19B21

loc_19B4A:
		pop	si
		pop	bp
		retf	6
sub_19B06	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_19B4F	proc near

var_5		= byte ptr -5
@@top		= word ptr -4
@@left		= word ptr -2

		enter	6, 0
		push	si
		push	di
		mov	si, word_2028A
		push	word ptr [si+2]
		mov	al, [si+10h]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	[bp+@@left], ax
		mov	ax, [si+4]
		sar	ax, 4
		add	ax, 16
		mov	[bp+@@top], ax
		cmp	_pid_current, 1
		jnz	short loc_19B8B
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_19B97
; ---------------------------------------------------------------------------

loc_19B8B:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_19B97:
		cmp	byte ptr [si], 1
		jnz	short loc_19C14
		mov	_sprite16_put_w, (16 / 16)
		mov	_sprite16_put_h, 8
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 1Ah
		mov	di, ax
		sub	[bp+@@left], 8
		sub	[bp+@@top], 8
		mov	al, [si+1]
		mov	[bp+var_5], al
		cmp	[bp+var_5], 30h	; '0'
		jnb	short loc_19BD6
		call	sprite16_put pascal, [bp+@@left], [bp+@@top], di

loc_19BD1:
		add	di, 2
		jmp	short loc_19C00
; ---------------------------------------------------------------------------

loc_19BD6:
		cmp	[bp+var_5], 60h
		jb	short loc_19BD1
		cmp	[bp+var_5], 66h	; 'f'
		jnb	short loc_19BE7
		add	di, 4
		jmp	short loc_19C00
; ---------------------------------------------------------------------------

loc_19BE7:
		cmp	[bp+var_5], 6Ch	; 'l'
		jnb	short loc_19BF2
		add	di, 6
		jmp	short loc_19C00
; ---------------------------------------------------------------------------

loc_19BF2:
		cmp	[bp+var_5], 72h	; 'r'
		jnb	short loc_19BFD
		add	di, 8
		jmp	short loc_19C00
; ---------------------------------------------------------------------------

loc_19BFD:
		add	di, 0Ah

loc_19C00:
		push	[bp+@@left]
		mov	ax, [bp+@@top]
		add	ax, 16
		push	ax
		push	di
		push	SPF_DOWNWARDS_COLUMN
		call	sprite16_putx
		jmp	short loc_19C32
; ---------------------------------------------------------------------------

loc_19C14:
		cmp	byte ptr [si], 2
		jnz	short loc_19C27
		push	[bp+@@left]
		push	[bp+@@top]
		push	word ptr [si+1]
		call	sub_1A32A
		jmp	short loc_19C32
; ---------------------------------------------------------------------------

loc_19C27:
		push	[bp+@@left]
		push	[bp+@@top]
		push	word ptr [si]
		call	sub_1A377

loc_19C32:
		pop	di
		pop	si
		leave
		retn
sub_19B4F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

marisa_19C36	proc far

var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2

		enter	6, 0
		push	si
		push	di
		mov	word_220F2, 2
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		mov	[bp+var_2], 0
		jmp	loc_19D25
; ---------------------------------------------------------------------------

loc_19C57:
		cmp	byte ptr [si], 0
		jz	loc_19D1F
		cmp	byte ptr [si], 1
		jnz	short loc_19CD8
		cmp	byte ptr [si+1], 30h ; '0'
		jnb	short loc_19C80
		sub	word ptr [si+4], 100h
		cmp	word ptr [si+4], 0FF00h
		jge	short loc_19C8C
		mov	byte ptr [si+1], 30h ; '0'
		mov	word ptr [si+4], 0FF00h
		jmp	short loc_19C8C
; ---------------------------------------------------------------------------

loc_19C80:
		cmp	byte ptr [si+1], 78h ; 'x'
		jb	short loc_19C8C
		mov	byte ptr [si], 0
		jmp	loc_19D1F
; ---------------------------------------------------------------------------

loc_19C8C:
		mov	ax, [si+2]
		mov	[bp+var_6], ax
		mov	di, [si+4]
		or	di, di
		jge	short loc_19C9B
		xor	di, di

loc_19C9B:
		mov	ax, 1700h
		sub	ax, di
		mov	[bp+var_4], ax
		cmp	byte ptr [si+1], 64h ; 'd'
		jnb	short loc_19D1C
		mov	ax, [bp+var_6]
		mov	word_220EE, ax
		mov	ax, [bp+var_4]
		cwd
		sub	ax, dx
		sar	ax, 1
		add	ax, di
		mov	word_220F0, ax
		mov	ax, [bp+var_4]
		mov	bx, 20h	; ' '
		cwd
		idiv	bx
		mov	word_220F4, ax
		mov	al, 1
		sub	al, _pid_current
		mov	byte_220FA, al
		call	sub_13A6E
		jmp	short loc_19D1C
; ---------------------------------------------------------------------------

loc_19CD8:
		cmp	byte ptr [si], 2
		jnz	short loc_19CEF
		mov	word_2028A, si
		call	sub_1A1A7
		or	al, al
		jz	short loc_19D1C
		mov	word ptr [si+4], 1700h
		jmp	short loc_19D1F
; ---------------------------------------------------------------------------

loc_19CEF:
		cmp	byte ptr [si], 1Ch
		ja	short loc_19D0E
		inc	byte ptr [si]
		cmp	byte ptr [si], 0Ch
		jnz	short loc_19D1C
		push	word ptr [si+2]
		push	1820h
		mov	al, [si+10h]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		jmp	short loc_19D1C
; ---------------------------------------------------------------------------

loc_19D0E:
		mov	byte ptr [si+1], 0
		mov	byte ptr [si], 1
		call	snd_se_play pascal, 20

loc_19D1C:
		inc	byte ptr [si+1]

loc_19D1F:
		inc	[bp+var_2]
		add	si, 20h	; ' '

loc_19D25:
		cmp	[bp+var_2], 0Eh
		jl	loc_19C57
		pop	di
		pop	si
		leave
		retf
marisa_19C36	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

marisa_19D31	proc far
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		xor	di, di
		jmp	short loc_19D57
; ---------------------------------------------------------------------------

loc_19D47:
		cmp	byte ptr [si], 0
		jz	short loc_19D53
		mov	word_2028A, si
		call	sub_19B4F

loc_19D53:
		inc	di
		add	si, 20h	; ' '

loc_19D57:
		cmp	di, 0Eh
		jl	short loc_19D47
		pop	di
		pop	si
		pop	bp
		retf
marisa_19D31	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kotohime_19D60	proc far

arg_0		= word ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		xor	di, di
		jmp	short loc_19DC8
; ---------------------------------------------------------------------------

loc_19D76:
		cmp	byte ptr [si], 0
		jnz	short loc_19DC4
		mov	word_2028A, si
		push	[bp+arg_4]
		push	[bp+arg_2]
		push	1200h
		call	randring_far_next16_mod
		push	ax
		push	400h
		call	randring_far_next16_mod
		push	ax
		push	[bp+arg_0]
		push	5Ah ; 'Z'
		call	sub_1A1ED
		push	0FFFh
		call	randring_far_next16_and
		add	ax, 600h
		mov	[si+0Eh], ax
		push	1Fh
		call	randring_far_next16_and
		add	ax, 10h
		mov	[si+14h], ax
		mov	byte ptr [si+12h], 0
		mov	byte ptr [si+11h], 0
		jmp	short loc_19DCD
; ---------------------------------------------------------------------------

loc_19DC4:
		inc	di
		add	si, 20h	; ' '

loc_19DC8:
		cmp	di, 8
		jl	short loc_19D76

loc_19DCD:
		pop	di
		pop	si
		pop	bp
		retf	6
kotohime_19D60	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_19DD3	proc far

arg_0		= word ptr  6
arg_2		= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 7
		add	ax, offset _players
		mov	di, ax
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 2A2Ah
		mov	si, ax
		cmp	byte ptr [si], 0
		jz	short loc_19DFA
		add	si, 20h	; ' '

loc_19DFA:
		mov	word_2028A, si
		push	[di+player_t.center.x]
		push	[di+player_t.center.y]
		push	[bp+arg_2]
		push	[bp+arg_0]
		push	word ptr _pid_current
		push	78h ; 'x'
		call	sub_1A1ED
		mov	word ptr [si+0Eh], 0C00h
		mov	word ptr [si+14h], 20h ; ' '
		mov	byte ptr [si+12h], 0
		mov	byte ptr [si+11h], 1
		pop	di
		pop	si
		pop	bp
		retf	4
sub_19DD3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_19E2A	proc near

var_5		= word ptr -5
@@x		= word ptr -2

		enter	6, 0
		push	si
		push	di
		mov	si, word_2028A
		push	word ptr [si+2]
		mov	al, [si+10h]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	[bp+@@x], ax
		mov	ax, [si+4]
		sar	ax, 4
		add	ax, 10h
		mov	[bp+var_4], ax
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT
		mov	al, [si+1]
		mov	byte ptr [bp+var_5], al
		cmp	byte ptr [si], 1
		jnz	short loc_19ED6
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 280h
		mov	di, ax
		mov	ax, [si+0Eh]
		sub	ax, [si+4]
		cmp	ax, 600h
		jg	short loc_19E91
		mov	al, byte ptr [bp+var_5]
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		cmp	dx, 2
		jge	short loc_19E91
		add	di, 0A00h

loc_19E91:
		cmp	byte ptr [si+11h], 0
		jnz	short loc_19EBC
		add	di, 282h
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 16
		mov	ax, [bp+@@x]
		add	ax, -16
		push	ax
		mov	ax, [bp+var_4]
		add	ax, -16

loc_19EB3:
		push	ax
		push	di
		call	sprite16_put
		jmp	short loc_19EF5
; ---------------------------------------------------------------------------

loc_19EBC:
		mov	_sprite16_put_w, (64 / 16)
		mov	_sprite16_put_h, 32
		mov	ax, [bp+@@x]
		add	ax, -32
		push	ax
		mov	ax, [bp+var_4]
		add	ax, -32
		jmp	short loc_19EB3
; ---------------------------------------------------------------------------

loc_19ED6:
		cmp	byte ptr [si], 2
		jnz	short loc_19EE9
		push	[bp+@@x]
		push	[bp+var_4]
		push	[bp+var_5]
		call	sub_1A32A
		jmp	short loc_19EF5
; ---------------------------------------------------------------------------

loc_19EE9:
		push	[bp+@@x]
		push	[bp+var_4]
		push	[bp+var_5]
		call	sub_1A377

loc_19EF5:
		pop	di
		pop	si
		leave
		retn
sub_19E2A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_19EF9	proc near
		push	bp
		mov	bp, sp
		call	snd_se_play pascal, 3
		mov	bx, word_2028A
		push	word ptr [bx+2]
		push	word ptr [bx+4]
		mov	al, _pid_current
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	sub_CDBD
		pop	bp
		retn
sub_19EF9	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_19F1F	proc near

var_1		= byte ptr -1

		enter	2, 0
		push	si
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		mov	al, [bx+2D5Ah]
		mov	byte_23E4E, al
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		mov	al, [bx+2D58h]
		mov	byte_23E47, al
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		cmp	byte ptr [bx+2D59h], 0
		jz	short loc_19F5D
		mov	[bp+var_1], 0F4h
		jmp	short loc_19F61
; ---------------------------------------------------------------------------

loc_19F5D:
		mov	[bp+var_1], 0Ch

loc_19F61:
		mov	byte_23E42, 10h
		xor	si, si
		jmp	short loc_19F7F
; ---------------------------------------------------------------------------

loc_19F6A:
		call	sub_17730
		mov	al, byte_23E42
		add	al, 2
		mov	byte_23E42, al
		mov	al, [bp+var_1]
		add	angle_23E43, al
		inc	si

loc_19F7F:
		cmp	si, 4
		jl	short loc_19F6A
		pop	si
		leave
		retn
sub_19F1F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_19F87	proc near

var_1		= byte ptr -1

		enter	2, 0
		push	si
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		mov	al, [bx+2D5Ah]
		mov	byte_23E4E, al
		mov	byte_23E42, 10h
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		mov	al, [bx+2D58h]
		mov	byte_23E47, al
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		cmp	byte ptr [bx+2D59h], 0
		jz	short loc_19FCA
		mov	[bp+var_1], 7
		jmp	short loc_19FCE
; ---------------------------------------------------------------------------

loc_19FCA:
		mov	[bp+var_1], 0F9h

loc_19FCE:
		xor	si, si
		jmp	short loc_19FE7
; ---------------------------------------------------------------------------

loc_19FD2:
		call	sub_17730
		mov	al, byte_23E42
		add	al, 2
		mov	byte_23E42, al
		mov	al, [bp+var_1]
		add	angle_23E43, al
		inc	si

loc_19FE7:
		cmp	si, 0Ah
		jl	short loc_19FD2
		pop	si
		leave
		retn
sub_19F87	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kotohime_19FEF	proc far

@@pid_other		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	word_2028A, ax
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	word_220F2, 6
		mov	word_220F4, 6
		mov	byte_220FA, al
		xor	di, di
		jmp	loc_1A143
; ---------------------------------------------------------------------------

loc_1A020:
		mov	bx, word_2028A
		cmp	byte ptr [bx], 0
		jz	loc_1A13D
		mov	si, word_2028A
		cmp	byte ptr [si], 1
		jnz	loc_1A120
		mov	ax, [si+4]
		cmp	ax, [si+0Eh]
		jl	loc_1A0DA
		cmp	byte ptr [si+12h], 4
		jnz	short loc_1A07A
		call	sub_19EF9
		cmp	byte ptr [si+11h], 0
		jz	loc_1A0D5
		mov	byte_23E42, 1Ch
		call	randring_far_next16
		mov	angle_23E43, al
		mov	byte_23E45, 26h ; '&'
		mov	al, [bp+@@pid_other]
		mov	_pid_other, al
		mov	ax, [si+2]
		mov	word_23E3E, ax
		mov	ax, [si+4]
		mov	word_23E40, ax
		call	sub_19F1F
		jmp	short loc_1A0D5
; ---------------------------------------------------------------------------

loc_1A07A:
		cmp	byte ptr [si+12h], 8
		jz	short loc_1A086
		cmp	byte ptr [si+12h], 0Ch
		jnz	short loc_1A08B

loc_1A086:
		call	sub_19EF9
		jmp	short loc_1A0D5
; ---------------------------------------------------------------------------

loc_1A08B:
		cmp	byte ptr [si+12h], 10h
		jnz	short loc_1A0D5
		call	sub_19EF9
		mov	byte_23E42, 18h
		call	randring_far_next16
		mov	angle_23E43, al
		mov	byte_23E45, 26h ; '&'
		mov	al, [bp+@@pid_other]
		mov	_pid_other, al
		mov	ax, [si+2]
		mov	word_23E3E, ax
		mov	ax, [si+4]
		mov	word_23E40, ax
		cmp	byte ptr [si+11h], 0
		jnz	short loc_1A0CF
		mov	byte_23E4E, 2
		mov	byte_23E47, 0Ah
		call	sub_17730
		jmp	short loc_1A0D2
; ---------------------------------------------------------------------------

loc_1A0CF:
		call	sub_19F87

loc_1A0D2:
		mov	byte ptr [si], 0

loc_1A0D5:
		inc	byte ptr [si+12h]
		jmp	short loc_1A13A
; ---------------------------------------------------------------------------

loc_1A0DA:
		mov	ax, [si+14h]
		add	[si+4],	ax
		mov	byte_20E2C, 1
		mov	word_20E32, 100h
		mov	word_20E34, 100h
		mov	al, [bp+@@pid_other]
		mov	pid_20E3A, al
		mov	ax, [si+2]
		mov	word_20E2E, ax
		mov	ax, [si+4]
		mov	word_20E30, ax
		call	sub_158F5
		mov	byte_20E2C, 0
		mov	ax, [si+2]
		mov	word_220EE, ax
		mov	ax, [si+4]
		mov	word_220F0, ax
		call	sub_13A6E
		jmp	short loc_1A13A
; ---------------------------------------------------------------------------

loc_1A120:
		cmp	byte ptr [si], 2
		jnz	short loc_1A12A
		call	sub_1A1A7
		jmp	short loc_1A13A
; ---------------------------------------------------------------------------

loc_1A12A:
		cmp	byte ptr [si], 1Ch
		ja	short loc_1A133
		inc	byte ptr [si]
		jmp	short loc_1A13A
; ---------------------------------------------------------------------------

loc_1A133:
		mov	byte ptr [si+1], 0
		mov	byte ptr [si], 1

loc_1A13A:
		inc	byte ptr [si+1]

loc_1A13D:
		inc	di
		add	word_2028A, 20h	; ' '

loc_1A143:
		cmp	di, 0Ah
		jl	loc_1A020
		pop	di
		pop	si
		leave
		retf
kotohime_19FEF	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kotohime_1A14E	proc far
		push	bp
		mov	bp, sp
		push	si
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	word_2028A, ax
		xor	si, si
		jmp	short loc_1A176
; ---------------------------------------------------------------------------

loc_1A164:
		mov	bx, word_2028A
		cmp	byte ptr [bx], 0
		jz	short loc_1A170
		call	sub_19E2A

loc_1A170:
		inc	si
		add	word_2028A, 20h	; ' '

loc_1A176:
		cmp	si, 0Ah
		jl	short loc_1A164
		pop	si
		pop	bp
		retf
kotohime_1A14E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A17E	proc far

arg_0		= byte ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	si, [bp+arg_4]
		mov	di, [bp+arg_2]
		cmp	[bp+arg_0], 0
		jnz	short loc_1A199
		push	si
		push	di
		push	0
		call	p1_1FE6C
		jmp	short loc_1A1A1
; ---------------------------------------------------------------------------

loc_1A199:
		push	si
		push	di
		push	1
		call	p2_1FE78

loc_1A1A1:
		pop	di
		pop	si
		pop	bp
		retf	6
sub_1A17E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A1A7	proc near
		push	bp
		mov	bp, sp
		push	si
		mov	si, word_2028A
		mov	dx, [si+2]
		add	dx, [si+6]
		mov	bx, word_2028A
		cmp	byte ptr [bx+10h], 0
		jnz	short loc_1A1DA
		cmp	[si+0Ch], dx
		jg	short loc_1A1DF

loc_1A1C4:
		mov	ax, [si+0Ah]
		mov	[si+2],	ax
		mov	byte ptr [si], 3
		mov	al, 1
		sub	al, _pid_current
		mov	[si+10h], al
		mov	al, 1
		jmp	short loc_1A1EA
; ---------------------------------------------------------------------------

loc_1A1DA:
		cmp	[si+0Ch], dx
		jge	short loc_1A1C4

loc_1A1DF:
		mov	[si+2],	dx
		mov	ax, [si+8]
		add	[si+4],	ax
		mov	al, 0

loc_1A1EA:
		pop	si
		pop	bp
		retn
sub_1A1A7	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A1ED	proc near

arg_0		= word ptr  4
arg_2		= byte ptr  6
@@y2		= word ptr  8
arg_6		= word ptr  0Ah
@@y1		= word ptr  0Ch
@@x		= word ptr  0Eh

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	di, [bp+arg_6]
		mov	si, word_2028A
		mov	byte ptr [si], 2
		mov	byte ptr [si+1], 0
		mov	ax, [bp+@@x]
		mov	[si+2],	ax
		mov	ax, [bp+@@y1]
		mov	[si+4],	ax
		mov	al, [bp+arg_2]
		mov	[si+10h], al
		push	[bp+@@x]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	[bp+@@x], ax
		mov	[si+0Ah], di
		push	di
		mov	al, [bp+arg_2]
		mov	ah, 0
		mov	dx, 1
		sub	dx, ax
		push	dx
		call	playfield_fg_x_to_screen
		mov	di, ax
		mov	ax, [bp+@@x]
		shl	ax, 4
		push	ax
		push	[bp+@@y1]
		mov	ax, di
		shl	ax, 4
		push	ax
		push	[bp+@@y2]
		push	0
		push	ds
		lea	ax, [si+6]
		push	ax
		push	ds
		lea	ax, [si+8]
		push	ax
		mov	al, byte_23AF8
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		add	ax, [bp+arg_0]
		push	ax
		call	vector2_between_plus
		push	di
		mov	al, [bp+arg_2]
		mov	ah, 0
		push	ax
		call	sub_A2F2
		mov	[si+0Ch], ax
		pop	di
		pop	si
		pop	bp
		retn	0Ch
sub_1A1ED	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

reimu_1A27E	proc far

arg_0		= word ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		xor	di, di
		jmp	short loc_1A2C3
; ---------------------------------------------------------------------------

loc_1A294:
		cmp	byte ptr [si], 0
		jnz	short loc_1A2BF
		mov	word_2028A, si
		push	[bp+arg_4]
		push	[bp+arg_2]
		push	1200h
		call	randring_far_next16_mod
		push	ax
		push	7FFh
		call	randring_far_next16_and
		push	ax
		push	[bp+arg_0]
		push	5Ah ; 'Z'
		call	sub_1A1ED
		jmp	short loc_1A2C8
; ---------------------------------------------------------------------------

loc_1A2BF:
		inc	di
		add	si, 20h	; ' '

loc_1A2C3:
		cmp	di, 8
		jl	short loc_1A294

loc_1A2C8:
		pop	di
		pop	si
		pop	bp
		retf	6
reimu_1A27E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A2CE	proc far

@@angle		= word ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		xor	di, di
		jmp	short loc_1A31F
; ---------------------------------------------------------------------------

loc_1A2E4:
		cmp	byte ptr [si], 0
		jnz	short loc_1A31B
		mov	byte ptr [si], 1
		mov	byte ptr [si+1], 0
		mov	ax, [bp+arg_4]
		mov	[si+2],	ax
		mov	ax, [bp+arg_2]
		mov	[si+4],	ax
		mov	al, 1
		sub	al, _pid_current
		mov	[si+10h], al
		push	ds
		lea	ax, [si+6]
		push	ax
		push	ds
		lea	ax, [si+8]
		push	ax
		push	[bp+@@angle]
		push	50h ; 'P'
		call	vector2
		jmp	short loc_1A324
; ---------------------------------------------------------------------------

loc_1A31B:
		inc	di
		add	si, 20h	; ' '

loc_1A31F:
		cmp	di, 8
		jl	short loc_1A2E4

loc_1A324:
		pop	di
		pop	si
		pop	bp
		retf	6
sub_1A2CE	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A32A	proc near

arg_0		= byte ptr  4
@@top		= word ptr  6
@@left		= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		test	[bp+arg_0], 1
		jnz	short loc_1A372
		mov	si, 1928h
		mov	al, [bp+arg_0]
		mov	ah, 0
		and	ax, 7
		cmp	ax, 3
		jg	short loc_1A347
		add	si, 4

loc_1A347:
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 16
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT
		mov	ax, [bp+@@left]
		add	ax, -16
		push	ax
		mov	ax, [bp+@@top]
		add	ax, -16
		push	ax
		push	si
		call	sprite16_put

loc_1A372:
		pop	si
		pop	bp
		retn	6
sub_1A32A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A377	proc near

arg_0		= byte ptr  4
@@top		= word ptr  6
@@left		= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT
		mov	_sprite16_put_w, (48 / 16)
		mov	_sprite16_put_h, 24
		mov	si, 1930h
		mov	al, [bp+arg_0]
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		mov	bx, 3
		cwd
		idiv	bx
		imul	dx, 6
		add	si, dx
		mov	ax, [bp+@@left]
		add	ax, -24
		push	ax
		mov	ax, [bp+@@top]
		add	ax, -24
		push	ax
		push	si
		call	sprite16_put
		pop	si
		pop	bp
		retn	6
sub_1A377	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A3C4	proc near

var_5		= byte ptr -5
@@top		= word ptr -4
@@left		= word ptr -2

		enter	6, 0
		push	si
		push	di
		mov	si, word_2028A
		push	word ptr [si+2]
		mov	al, [si+10h]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	[bp+@@left], ax
		mov	ax, [si+4]
		sar	ax, 4
		add	ax, 16
		mov	[bp+@@top], ax
		mov	_sprite16_put_w, (48 / 16)
		mov	_sprite16_put_h, 24
		cmp	_pid_current, 1
		jnz	short loc_1A40B
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_1A417
; ---------------------------------------------------------------------------

loc_1A40B:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_1A417:
		cmp	byte ptr [si], 1
		jnz	short loc_1A46F
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 280h
		mov	di, ax
		mov	al, [si+1]
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		mov	[bp+var_5], al
		mov	ah, 0
		and	ax, 3
		cmp	ax, 1
		jnz	short loc_1A443
		add	di, 6
		jmp	short loc_1A459
; ---------------------------------------------------------------------------

loc_1A443:
		test	[bp+var_5], 3
		jz	short loc_1A459
		mov	al, [bp+var_5]
		mov	ah, 0
		and	ax, 1
		imul	ax, 6
		add	ax, 780h
		add	di, ax

loc_1A459:
		mov	ax, [bp+@@left]
		add	ax, -24
		push	ax
		mov	ax, [bp+@@top]
		add	ax, -24
		push	ax
		push	di
		call	sprite16_put
		jmp	short loc_1A48D
; ---------------------------------------------------------------------------

loc_1A46F:
		cmp	byte ptr [si], 2
		jnz	short loc_1A482
		push	[bp+@@left]
		push	[bp+@@top]
		push	word ptr [si+1]
		call	sub_1A32A
		jmp	short loc_1A48D
; ---------------------------------------------------------------------------

loc_1A482:
		push	[bp+@@left]
		push	[bp+@@top]
		push	word ptr [si]
		call	sub_1A377

loc_1A48D:
		pop	di
		pop	si
		leave
		retn
sub_1A3C4	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A491	proc near

arg_0		= word ptr  4
arg_2		= word ptr  6

		push	bp
		mov	bp, sp
		mov	ax, [bp+arg_2]
		mov	word_220EE, ax
		mov	ax, [bp+arg_0]
		mov	word_220F0, ax
		mov	word_220F2, 8
		mov	word_220F4, 10h
		mov	al, 1
		sub	al, _pid_current
		mov	byte_220FA, al
		call	sub_13A6E
		sub	word_220EE, 0C0h
		mov	word_220F2, 4
		mov	word_220F4, 8
		call	sub_13A6E
		add	word_220EE, 180h
		call	sub_13A6E
		pop	bp
		retn	4
sub_1A491	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

reimu_1A4E0	proc far

@@angle		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		mov	byte_20E2C, 1
		mov	word_20E32, 100h
		mov	word_20E34, 100h
		mov	al, 1
		sub	al, _pid_current
		mov	pid_20E3A, al
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		xor	di, di
		jmp	loc_1A5E9
; ---------------------------------------------------------------------------

loc_1A512:
		cmp	byte ptr [si], 0
		jz	loc_1A5E5
		cmp	byte ptr [si], 1
		jnz	short loc_1A58A
		mov	ax, [si+6]
		add	[si+2],	ax
		cmp	word ptr [si+2], 0
		jle	short loc_1A531
		cmp	word ptr [si+2], 1200h
		jl	short loc_1A542

loc_1A531:
		mov	dx, 0FFFFh
		mov	ax, [si+6]
		imul	dx
		mov	[si+6],	ax
		mov	ax, [si+6]
		add	[si+2],	ax

loc_1A542:
		mov	ax, [si+8]
		add	[si+4],	ax
		cmp	word ptr [si+4], 0FE80h
		jge	short loc_1A55F
		mov	dx, 0FFFFh
		mov	ax, [si+8]
		imul	dx
		mov	[si+8],	ax
		mov	word ptr [si+4], 0FE80h

loc_1A55F:
		cmp	word ptr [si+4], 1700h
		jl	short loc_1A56B
		mov	byte ptr [si], 0
		jmp	short loc_1A5E5
; ---------------------------------------------------------------------------

loc_1A56B:
		inc	word ptr [si+8]
		mov	ax, [si+2]
		mov	word_20E2E, ax
		mov	ax, [si+4]
		mov	word_20E30, ax
		call	sub_158F5
		push	word ptr [si+2]
		push	word ptr [si+4]
		call	sub_1A491
		jmp	short loc_1A5E5
; ---------------------------------------------------------------------------

loc_1A58A:
		cmp	byte ptr [si], 2
		jnz	short loc_1A5D9
		mov	word_2028A, si
		call	sub_1A1A7
		or	al, al
		jz	short loc_1A5E5
		push	1Fh
		call	randring_far_next16_and
		mov	[bp+@@angle], al
		push	1
		call	randring_far_next16_and
		imul	ax, 60h
		add	al, [bp+@@angle]
		add	al, 80h
		mov	[bp+@@angle], al
		push	ds
		lea	ax, [si+6]
		push	ax
		push	ds
		lea	ax, [si+8]
		push	ax
		push	word ptr [bp+@@angle]
		mov	al, byte_23AF8
		mov	ah, 0
		mov	bx, 8
		cwd
		idiv	bx
		add	ax, 32h	; '2'
		push	ax
		call	vector2
		jmp	short loc_1A5E5
; ---------------------------------------------------------------------------

loc_1A5D9:
		cmp	byte ptr [si], 14h
		ja	short loc_1A5E2
		inc	byte ptr [si]
		jmp	short loc_1A5E5
; ---------------------------------------------------------------------------

loc_1A5E2:
		mov	byte ptr [si], 1

loc_1A5E5:
		inc	di
		add	si, 20h	; ' '

loc_1A5E9:
		cmp	di, 8
		jl	loc_1A512
		mov	byte_20E2C, 0
		pop	di
		pop	si
		leave
		retf
reimu_1A4E0	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

reimu_1A5F9	proc far
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		xor	di, di
		jmp	short loc_1A622
; ---------------------------------------------------------------------------

loc_1A60F:
		cmp	byte ptr [si], 0
		jz	short loc_1A61E
		mov	word_2028A, si
		call	sub_1A3C4
		inc	byte ptr [si+1]

loc_1A61E:
		inc	di
		add	si, 20h	; ' '

loc_1A622:
		cmp	di, 8
		jl	short loc_1A60F
		pop	di
		pop	si
		pop	bp
		retf
reimu_1A5F9	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

mima_1A62B	proc far

arg_0		= word ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		xor	di, di
		jmp	short loc_1A679
; ---------------------------------------------------------------------------

loc_1A641:
		cmp	byte ptr [si], 0
		jnz	short loc_1A675
		mov	word_2028A, si
		push	[bp+arg_4]
		push	[bp+arg_2]
		push	1200h
		call	randring_far_next16_mod
		push	ax
		push	1200h
		call	randring_far_next16_mod
		push	ax
		push	[bp+arg_0]
		push	5Ah ; 'Z'
		call	sub_1A1ED
		mov	word ptr [si+0Eh], 0
		mov	byte ptr [si+1], 3
		jmp	short loc_1A67E
; ---------------------------------------------------------------------------

loc_1A675:
		inc	di
		add	si, 20h	; ' '

loc_1A679:
		cmp	di, 6
		jl	short loc_1A641

loc_1A67E:
		pop	di
		pop	si
		pop	bp
		retf	6
mima_1A62B	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A684	proc near

var_5		= word ptr -5
@@top		= word ptr -4
@@left		= word ptr -2

		enter	6, 0
		push	si
		push	di
		mov	si, word_2028A
		push	word ptr [si+2]
		mov	al, [si+10h]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	[bp+@@left], ax
		mov	ax, [si+4]
		sar	ax, 4
		add	ax, 16
		mov	[bp+@@top], ax
		mov	_sprite16_put_w, (48 / 16)
		mov	_sprite16_put_h, 24
		cmp	_pid_current, 1
		jnz	short loc_1A6CB
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_1A6D7
; ---------------------------------------------------------------------------

loc_1A6CB:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_1A6D7:
		mov	al, [si+0Eh]
		mov	byte ptr [bp+var_5], al
		cmp	byte ptr [si], 1
		jnz	short loc_1A723
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 280h
		mov	di, ax
		cmp	byte ptr [si+1], 0
		jnz	short loc_1A6F8
		add	di, 786h
		jmp	short loc_1A70D
; ---------------------------------------------------------------------------

loc_1A6F8:
		cmp	byte ptr [si+1], 1
		jnz	short loc_1A704
		add	di, 780h
		jmp	short loc_1A70D
; ---------------------------------------------------------------------------

loc_1A704:
		cmp	byte ptr [si+1], 2
		jnz	short loc_1A70D
		add	di, 6

loc_1A70D:
		mov	ax, [bp+@@left]
		add	ax, -24
		push	ax
		mov	ax, [bp+@@top]
		add	ax, -24
		push	ax
		push	di
		call	sprite16_put
		jmp	short loc_1A741
; ---------------------------------------------------------------------------

loc_1A723:
		cmp	byte ptr [si], 2
		jnz	short loc_1A736
		push	[bp+@@left]
		push	[bp+@@top]
		push	[bp+var_5]
		call	sub_1A32A
		jmp	short loc_1A741
; ---------------------------------------------------------------------------

loc_1A736:
		push	[bp+@@left]
		push	[bp+@@top]
		push	word ptr [si]
		call	sub_1A377

loc_1A741:
		pop	di
		pop	si
		leave
		retn
sub_1A684	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

mima_1A745	proc far

@@pid_other		= byte ptr -7
var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2

		enter	8, 0
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	word_220F2, 8
		mov	word_220F4, 8
		mov	byte_220FA, al
		mov	[bp+var_2], 0
		jmp	loc_1A8C7
; ---------------------------------------------------------------------------

loc_1A778:
		cmp	byte ptr [si], 0
		jz	loc_1A8C1
		cmp	byte ptr [si], 1
		jnz	loc_1A87E
		mov	ax, [si+2]
		add	ax, [si+6]
		mov	di, ax
		mov	ax, [si+4]
		add	ax, [si+8]
		mov	[bp+var_4], ax
		or	di, di
		jle	short loc_1A7A1
		cmp	di, 1200h
		jl	short loc_1A7B4

loc_1A7A1:
		cmp	byte ptr [si+1], 0
		jz	short loc_1A7E2
		dec	byte ptr [si+1]
		mov	ax, [si+6]
		neg	ax
		mov	[si+6],	ax
		jmp	short loc_1A7D2
; ---------------------------------------------------------------------------

loc_1A7B4:
		cmp	[bp+var_4], 0
		jle	short loc_1A7C1
		cmp	[bp+var_4], 1700h
		jl	short loc_1A7E8

loc_1A7C1:
		cmp	byte ptr [si+1], 0
		jz	short loc_1A7E2
		dec	byte ptr [si+1]
		mov	ax, [si+8]
		neg	ax
		mov	[si+8],	ax

loc_1A7D2:
		push	word ptr [si+8]
		push	word ptr [si+6]
		call	iatan2
		mov	[si+12h], al
		jmp	short loc_1A7F1
; ---------------------------------------------------------------------------

loc_1A7E2:
		mov	byte ptr [si], 0
		jmp	loc_1A8C1
; ---------------------------------------------------------------------------

loc_1A7E8:
		mov	[si+2],	di
		mov	ax, [bp+var_4]
		mov	[si+4],	ax

loc_1A7F1:
		mov	ax, [si+0Eh]
		mov	[bp+var_6], ax
		cmp	[bp+var_6], 10h
		jl	short loc_1A81C
		cmp	[bp+var_6], 20h	; ' '
		jge	short loc_1A813
		mov	al, [si+13h]
		mov	dl, byte ptr [bp+var_6]
		and	dl, 1
		add	al, dl
		mov	[si+13h], al
		jmp	short loc_1A81C
; ---------------------------------------------------------------------------

loc_1A813:
		cmp	[bp+var_6], 50h	; 'P'
		jge	short loc_1A81C
		inc	byte ptr [si+13h]

loc_1A81C:
		cmp	[bp+var_6], 50h	; 'P'
		jge	short loc_1A83A
		push	ds
		lea	ax, [si+6]
		push	ax
		push	ds
		lea	ax, [si+8]
		push	ax
		push	word ptr [si+12h]
		mov	al, [si+13h]
		mov	ah, 0
		push	ax
		call	vector2

loc_1A83A:
		mov	byte_20E2C, 1
		mov	word_20E32, 100h
		mov	word_20E34, 100h
		mov	al, [bp+@@pid_other]
		mov	pid_20E3A, al
		mov	word_20E2E, di
		mov	ax, [bp+var_4]
		mov	word_20E30, ax
		call	sub_158F5
		or	al, al
		jz	short loc_1A868
		sub	word ptr [si+8], 8

loc_1A868:
		mov	byte_20E2C, 0
		mov	word_220EE, di
		mov	ax, [bp+var_4]
		mov	word_220F0, ax
		call	sub_13A6E
		jmp	short loc_1A8BE
; ---------------------------------------------------------------------------

loc_1A87E:
		cmp	byte ptr [si], 2
		jnz	short loc_1A8A6
		mov	word_2028A, si
		call	sub_1A1A7
		or	al, al
		jz	short loc_1A8BE
		call	randring_far_next16
		mov	[si+12h], al
		mov	byte ptr [si+13h], 0
		mov	word ptr [si+6], 0
		mov	word ptr [si+8], 0
		jmp	short loc_1A8C1
; ---------------------------------------------------------------------------

loc_1A8A6:
		cmp	byte ptr [si], 1Ch
		ja	short loc_1A8AF
		inc	byte ptr [si]
		jmp	short loc_1A8BE
; ---------------------------------------------------------------------------

loc_1A8AF:
		mov	word ptr [si+0Eh], 0
		mov	byte ptr [si], 1
		call	snd_se_play pascal, 10

loc_1A8BE:
		inc	word ptr [si+0Eh]

loc_1A8C1:
		inc	[bp+var_2]
		add	si, 20h	; ' '

loc_1A8C7:
		cmp	[bp+var_2], 6
		jl	loc_1A778
		pop	di
		pop	si
		leave
		retf
mima_1A745	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

mima_1A8D3	proc far
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		xor	di, di
		jmp	short loc_1A8F9
; ---------------------------------------------------------------------------

loc_1A8E9:
		cmp	byte ptr [si], 0
		jz	short loc_1A8F5
		mov	word_2028A, si
		call	sub_1A684

loc_1A8F5:
		inc	di
		add	si, 20h	; ' '

loc_1A8F9:
		cmp	di, 6
		jl	short loc_1A8E9
		pop	di
		pop	si
		pop	bp
		retf
mima_1A8D3	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

yumemi_1A902	proc far

arg_0		= word ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		xor	di, di
		jmp	short loc_1A954
; ---------------------------------------------------------------------------

loc_1A918:
		cmp	byte ptr [si], 0
		jnz	short loc_1A950
		mov	word_2028A, si
		push	[bp+arg_4]
		push	[bp+arg_2]
		push	1200h
		call	randring_far_next16_mod
		push	ax
		push	1000h
		call	randring_far_next16_mod
		add	ax, 600h
		push	ax
		push	[bp+arg_0]
		push	46h ; 'F'
		call	sub_1A1ED
		mov	word ptr [si+14h], 0
		mov	word ptr [si+0Eh], 60h
		jmp	short loc_1A959
; ---------------------------------------------------------------------------

loc_1A950:
		inc	di
		add	si, 20h	; ' '

loc_1A954:
		cmp	di, 8
		jl	short loc_1A918

loc_1A959:
		pop	di
		pop	si
		pop	bp
		retf	6
yumemi_1A902	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A95F	proc far

arg_0		= word ptr  6
arg_2		= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 2A2Ah
		mov	si, ax
		mov	dx, 8
		jmp	short loc_1A9A6
; ---------------------------------------------------------------------------

loc_1A975:
		cmp	byte ptr [si], 0
		jnz	short loc_1A9A2
		mov	byte ptr [si], 3
		mov	byte ptr [si+1], 0
		mov	ax, [bp+arg_2]
		mov	[si+2],	ax
		mov	ax, [bp+arg_0]
		mov	[si+4],	ax
		mov	al, 1
		sub	al, _pid_current
		mov	[si+10h], al
		mov	word ptr [si+14h], 0
		mov	word ptr [si+0Eh], 20h ; ' '
		jmp	short loc_1A9AB
; ---------------------------------------------------------------------------

loc_1A9A2:
		inc	dx
		add	si, 20h	; ' '

loc_1A9A6:
		cmp	dx, 10h
		jl	short loc_1A975

loc_1A9AB:
		pop	si
		pop	bp
		retf	4
sub_1A95F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1A9B0	proc near

var_A		= word ptr -0Ah
var_8		= byte ptr -8
var_7		= byte ptr -7
var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2

		enter	0Ah, 0
		push	si
		push	di
		mov	ax, word_2028A
		mov	[bp+var_A], ax
		mov	bx, [bp+var_A]
		push	word ptr [bx+2]
		mov	al, [bx+10h]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	di, ax
		mov	bx, [bp+var_A]
		mov	ax, [bx+4]
		sar	ax, 4
		add	ax, 10h
		mov	[bp+var_6], ax
		cmp	_pid_current, 1
		jnz	short loc_1A9F3
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_1A9FF
; ---------------------------------------------------------------------------

loc_1A9F3:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_1A9FF:
		mov	bx, [bp+var_A]
		cmp	byte ptr [bx], 1
		jnz	loc_1AE09
		cmp	_pid_current, 1
		jnz	short loc_1AA1B
		push	(16 shl 16) or 8
		push	303
		jmp	short loc_1AA24
; ---------------------------------------------------------------------------

loc_1AA1B:
		push	(336 shl 16) or 8
		push	623

loc_1AA24:
		push	191
		call	grc_setclip
		mov	bx, [bp+var_A]
		cmp	byte ptr [bx+1], 10h
		ja	loc_1AB7B
		call	egc_off
		call	grcg_setcolor pascal, (GC_RMW shl 16) + 6
		mov	bx, [bp+var_A]
		mov	al, [bx+1]
		mov	[bp+var_7], al
		mov	ax, [bp+var_6]
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	si, ax
		mov	al, [bp+var_7]
		cbw
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	[bp+var_8], al
		mov	al, [bp+var_7]
		cbw
		add	ax, di
		add	ax, 0FFE0h
		push	ax
		mov	al, [bp+var_7]
		cbw
		lea	dx, [di+20h]
		sub	dx, ax
		push	dx
		mov	al, [bp+var_8]
		cbw
		add	ax, si
		add	ax, 0FFD8h
		push	ax
		call	grcg_hline
		mov	al, [bp+var_7]
		cbw
		add	ax, di
		add	ax, 0FFE0h
		push	ax
		mov	al, [bp+var_7]
		cbw
		lea	dx, [di+20h]
		sub	dx, ax
		push	dx
		mov	al, [bp+var_8]
		cbw
		lea	dx, [si+34h]
		sub	dx, ax
		push	dx
		call	grcg_hline
		mov	al, [bp+var_7]
		cbw
		add	ax, di
		add	ax, 0FFE0h
		push	ax
		mov	al, [bp+var_8]
		cbw
		add	ax, si
		add	ax, 0FFD8h
		push	ax
		mov	al, [bp+var_8]
		cbw
		lea	dx, [si+34h]
		sub	dx, ax
		push	dx
		call	grcg_vline
		mov	al, [bp+var_7]
		cbw
		lea	dx, [di+20h]
		sub	dx, ax
		push	dx
		mov	al, [bp+var_8]
		cbw
		add	ax, si
		add	ax, 0FFD8h
		push	ax
		mov	al, [bp+var_8]
		cbw
		lea	dx, [si+34h]
		sub	dx, ax
		push	dx
		call	grcg_vline
		mov	al, [bp+var_7]
		cbw
		add	ax, di
		add	ax, 0FFB0h
		push	ax
		mov	al, [bp+var_7]
		cbw
		lea	dx, [di+50h]
		sub	dx, ax
		push	dx
		mov	al, [bp+var_8]
		cbw
		add	ax, si
		add	ax, 0FFF0h
		push	ax
		call	grcg_hline
		mov	al, [bp+var_7]
		cbw
		add	ax, di
		add	ax, 0FFB0h
		push	ax
		mov	al, [bp+var_7]
		cbw
		lea	dx, [di+50h]
		sub	dx, ax
		push	dx
		mov	al, [bp+var_8]
		cbw
		lea	dx, [si+10h]
		sub	dx, ax
		push	dx
		call	grcg_hline
		mov	al, [bp+var_7]
		cbw
		add	ax, di
		add	ax, 0FFB0h
		push	ax
		mov	al, [bp+var_8]
		cbw
		add	ax, si
		add	ax, 0FFF0h
		push	ax
		mov	al, [bp+var_8]
		cbw
		lea	dx, [si+10h]
		sub	dx, ax
		push	dx
		call	grcg_vline
		mov	al, [bp+var_7]
		cbw
		lea	dx, [di+50h]
		sub	dx, ax
		push	dx
		mov	al, [bp+var_8]
		cbw
		add	ax, si
		add	ax, 0FFF0h
		push	ax
		mov	al, [bp+var_8]
		cbw
		mov	dx, si
		add	dx, 10h
		jmp	loc_1ACCF
; ---------------------------------------------------------------------------

loc_1AB7B:
		call	egc_off
		mov	bx, [bp+var_A]
		mov	al, [bx+0Eh]
		add	al, 0F8h
		sub	al, [bx+1]
		mov	[bp+var_7], al
		cmp	[bp+var_7], 10h
		jle	short loc_1AB9C
		push	(GC_RMW shl 16) + 5
		jmp	short loc_1ABA2
; ---------------------------------------------------------------------------

loc_1AB9C:
		push	(GC_RMW shl 16) + 6

loc_1ABA2:
		call	grcg_setcolor
		mov	ax, [bp+var_6]
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	si, ax
		mov	al, [bp+var_7]
		cbw
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	[bp+var_8], al
		mov	al, [bp+var_7]
		cbw
		add	ax, di
		add	ax, 0FFF0h
		push	ax
		mov	al, [bp+var_7]
		cbw
		lea	dx, [di+10h]
		sub	dx, ax
		push	dx
		mov	al, [bp+var_8]
		cbw
		add	ax, si
		add	ax, 0FFE0h
		push	ax
		call	grcg_hline
		mov	al, [bp+var_7]
		cbw
		add	ax, di
		add	ax, 0FFF0h
		push	ax
		mov	al, [bp+var_7]
		cbw
		lea	dx, [di+10h]
		sub	dx, ax
		push	dx
		mov	al, [bp+var_8]
		cbw
		lea	dx, [si+2Ch]
		sub	dx, ax
		push	dx
		call	grcg_hline
		mov	al, [bp+var_7]
		cbw
		add	ax, di
		add	ax, 0FFF0h
		push	ax
		mov	al, [bp+var_8]
		cbw
		add	ax, si
		add	ax, 0FFE0h
		push	ax
		mov	al, [bp+var_8]
		cbw
		lea	dx, [si+2Ch]
		sub	dx, ax
		push	dx
		call	grcg_vline
		mov	al, [bp+var_7]
		cbw
		lea	dx, [di+10h]
		sub	dx, ax
		push	dx
		mov	al, [bp+var_8]
		cbw
		add	ax, si
		add	ax, 0FFE0h
		push	ax
		mov	al, [bp+var_8]
		cbw
		lea	dx, [si+2Ch]
		sub	dx, ax
		push	dx
		call	grcg_vline
		mov	al, [bp+var_7]
		cbw
		add	ax, di
		add	ax, 0FFC0h
		push	ax
		mov	al, [bp+var_7]
		cbw
		lea	dx, [di+40h]
		sub	dx, ax
		push	dx
		mov	al, [bp+var_8]
		cbw
		add	ax, si
		add	ax, 0FFF8h
		push	ax
		call	grcg_hline
		mov	al, [bp+var_7]
		cbw
		add	ax, di
		add	ax, 0FFC0h
		push	ax
		mov	al, [bp+var_7]
		cbw
		lea	dx, [di+40h]
		sub	dx, ax
		push	dx
		mov	al, [bp+var_8]
		cbw
		lea	dx, [si+8]
		sub	dx, ax
		push	dx
		call	grcg_hline
		mov	al, [bp+var_7]
		cbw
		add	ax, di
		add	ax, 0FFC0h
		push	ax
		mov	al, [bp+var_8]
		cbw
		add	ax, si
		add	ax, 0FFF8h
		push	ax
		mov	al, [bp+var_8]
		cbw
		lea	dx, [si+8]
		sub	dx, ax
		push	dx
		call	grcg_vline
		mov	al, [bp+var_7]
		cbw
		lea	dx, [di+40h]
		sub	dx, ax
		push	dx
		mov	al, [bp+var_8]
		cbw
		add	ax, si
		add	ax, 0FFF8h
		push	ax
		mov	al, [bp+var_8]
		cbw
		mov	dx, si
		add	dx, 8

loc_1ACCF:
		sub	dx, ax
		push	dx
		call	grcg_vline
		call	grcg_off
		call	egc_on
		call	grc_setclip pascal, large 0, ((RES_X - 1) shl 16) or (SPRITE16_RES_Y - 1)
		sub	di, 16
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 8
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 280h
		mov	[bp+var_2], ax
		mov	bx, [bp+var_A]
		mov	ax, [bp+var_6]
		sub	ax, [bx+14h]
		mov	si, ax
		push	di
		push	ax
		push	[bp+var_2]
		jmp	short loc_1AD23
; ---------------------------------------------------------------------------

loc_1AD1A:
		push	di
		push	si
		mov	ax, [bp+var_2]
		add	ax, 502h
		push	ax

loc_1AD23:
		call	sprite16_put
		add	si, 10h
		mov	ax, [bp+var_6]
		add	ax, 0FFF0h
		cmp	ax, si
		jg	short loc_1AD1A
		mov	bx, [bp+var_A]
		mov	ax, [bx+14h]
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	dx, [bx+14h]
		add	dx, [bp+var_6]
		add	ax, dx
		add	ax, 0FFF0h
		mov	si, ax
		push	di
		push	ax
		mov	ax, [bp+var_2]
		add	ax, 280h
		jmp	short loc_1AD5F
; ---------------------------------------------------------------------------

loc_1AD57:
		push	di
		push	si
		mov	ax, [bp+var_2]
		add	ax, 502h

loc_1AD5F:
		push	ax
		call	sprite16_put
		sub	si, 10h
		cmp	si, [bp+var_6]
		jg	short loc_1AD57
		mov	_sprite16_put_w, (16 / 16)
		mov	_sprite16_put_h, 16
		sub	[bp+var_6], 10h
		mov	bx, [bp+var_A]
		mov	ax, di
		sub	ax, [bx+14h]
		add	ax, 10h
		mov	[bp+var_4], ax
		push	ax
		push	[bp+var_6]
		push	[bp+var_2]
		jmp	short loc_1ADA0
; ---------------------------------------------------------------------------

loc_1AD93:
		push	[bp+var_4]
		push	[bp+var_6]
		mov	ax, [bp+var_2]
		add	ax, 500h
		push	ax

loc_1ADA0:
		call	sprite16_put
		add	[bp+var_4], 10h
		cmp	[bp+var_4], di
		jl	short loc_1AD93
		mov	bx, [bp+var_A]
		mov	ax, [bx+14h]
		add	ax, di
		mov	[bp+var_4], ax
		push	ax
		push	[bp+var_6]
		mov	ax, [bp+var_2]
		add	ax, 2
		jmp	short loc_1ADD1
; ---------------------------------------------------------------------------

loc_1ADC5:
		push	[bp+var_4]
		push	[bp+var_6]
		mov	ax, [bp+var_2]
		add	ax, 500h

loc_1ADD1:
		push	ax
		call	sprite16_put
		sub	[bp+var_4], 10h
		lea	ax, [di+16]
		cmp	ax, [bp+var_4]
		jl	short loc_1ADC5
		mov	bx, [bp+var_A]
		cmp	word ptr [bx+14h], 18h
		jle	short loc_1AE2A
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 16
		push	di
		push	[bp+var_6]
		mov	ax, [bp+var_2]
		add	ax, 4
		push	ax
		call	sprite16_put
		jmp	short loc_1AE2A
; ---------------------------------------------------------------------------

loc_1AE09:
		mov	bx, [bp+var_A]
		cmp	byte ptr [bx], 2
		jnz	short loc_1AE1D
		push	di
		push	[bp+var_6]
		push	word ptr [bx+1]
		call	sub_1A32A
		jmp	short loc_1AE2A
; ---------------------------------------------------------------------------

loc_1AE1D:
		push	di
		push	[bp+var_6]
		mov	bx, [bp+var_A]
		push	word ptr [bx+1]
		call	sub_1A377

loc_1AE2A:
		pop	di
		pop	si
		leave
		retn
sub_1A9B0	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

yumemi_1AE2E	proc far

@@pid_other		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	byte_220FA, al
		xor	di, di
		jmp	loc_1AF67
; ---------------------------------------------------------------------------

loc_1AE52:
		cmp	byte ptr [si], 0
		jz	loc_1AF63
		cmp	byte ptr [si], 1
		jnz	loc_1AF32
		cmp	byte ptr [si+1], 8
		ja	short loc_1AE6C
		add	word ptr [si+14h], 6
		jmp	short loc_1AE9D
; ---------------------------------------------------------------------------

loc_1AE6C:
		mov	al, [si+1]
		mov	ah, 0
		cmp	ax, [si+0Eh]
		jl	short loc_1AE8B
		mov	al, [si+1]
		mov	ah, 0
		mov	dx, [si+0Eh]
		add	dx, 8
		cmp	ax, dx
		jge	short loc_1AE8B
		sub	word ptr [si+14h], 6
		jmp	short loc_1AE9D
; ---------------------------------------------------------------------------

loc_1AE8B:
		mov	al, [si+1]
		mov	ah, 0
		mov	dx, [si+0Eh]
		add	dx, 8
		cmp	ax, dx
		jl	short loc_1AE9D
		mov	byte ptr [si], 0

loc_1AE9D:
		mov	byte_20E2C, 1
		mov	al, [bp+@@pid_other]
		mov	pid_20E3A, al
		mov	ax, [si+14h]
		shl	ax, 3
		mov	word_20E32, ax
		mov	word_20E34, 40h
		mov	ax, [si+2]
		mov	word_20E2E, ax
		mov	ax, [si+4]
		mov	word_20E30, ax
		call	sub_158F5
		mov	word_20E32, 40h
		mov	ax, [si+14h]
		shl	ax, 3
		mov	word_20E34, ax
		mov	ax, [si+2]
		mov	word_20E2E, ax
		mov	ax, [si+4]
		mov	word_20E30, ax
		call	sub_158F5
		mov	byte_20E2C, 0
		mov	ax, [si+14h]
		mov	word_220F2, ax
		mov	word_220F4, 8
		mov	ax, [si+2]
		mov	word_220EE, ax
		mov	ax, [si+4]
		mov	word_220F0, ax
		call	sub_13A6E
		mov	ax, [si+14h]
		shl	ax, 2
		add	ax, [si+4]
		mov	word_220F0, ax
		mov	word_220F2, 8
		mov	ax, [si+14h]
		mov	bx, 4
		cwd
		idiv	bx
		add	ax, [si+14h]
		mov	word_220F4, ax
		call	sub_13A6E
		jmp	short loc_1AF60
; ---------------------------------------------------------------------------

loc_1AF32:
		cmp	byte ptr [si], 2
		jnz	short loc_1AF44
		mov	word_2028A, si
		call	sub_1A1A7
		or	al, al
		jz	short loc_1AF60
		jmp	short loc_1AF63
; ---------------------------------------------------------------------------

loc_1AF44:
		cmp	byte ptr [si], 28h ; '('
		ja	short loc_1AF4D
		inc	byte ptr [si]
		jmp	short loc_1AF60
; ---------------------------------------------------------------------------

loc_1AF4D:
		mov	word ptr [si+14h], 10h
		mov	byte ptr [si+1], 0
		mov	byte ptr [si], 1
		call	snd_se_play pascal, 7

loc_1AF60:
		inc	byte ptr [si+1]

loc_1AF63:
		inc	di
		add	si, 20h	; ' '

loc_1AF67:
		cmp	di, 10h
		jl	loc_1AE52
		pop	di
		pop	si
		leave
		retf
yumemi_1AE2E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

yumemi_1AF72	proc far
		push	bp
		mov	bp, sp
		push	si
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	word_2028A, ax
		xor	si, si
		jmp	short loc_1AF9A
; ---------------------------------------------------------------------------

loc_1AF88:
		mov	bx, word_2028A
		cmp	byte ptr [bx], 0
		jz	short loc_1AF94
		call	sub_1A9B0

loc_1AF94:
		inc	si
		add	word_2028A, 20h	; ' '

loc_1AF9A:
		cmp	si, 10h
		jl	short loc_1AF88
		pop	si
		pop	bp
		retf
yumemi_1AF72	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

rikako_1AFA2	proc far

arg_0		= word ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	al, byte ptr [bp+arg_0]
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		xor	di, di
		jmp	short loc_1AFFB
; ---------------------------------------------------------------------------

loc_1AFB8:
		cmp	byte ptr [si], 0
		jnz	short loc_1AFF7
		mov	word_2028A, si
		push	[bp+arg_4]
		push	[bp+arg_2]
		push	1200h
		call	randring_far_next16_mod
		push	ax
		push	100h
		push	[bp+arg_0]
		push	64h ; 'd'
		call	sub_1A1ED
		push	1
		call	randring_far_next16_and
		mov	[si+17h], al
		mov	byte ptr [si+12h], 40h
		push	0Fh
		call	randring_far_next16_and
		add	al, 20h	; ' '
		mov	[si+13h], al
		jmp	short loc_1B000
; ---------------------------------------------------------------------------

loc_1AFF7:
		inc	di
		add	si, 20h	; ' '

loc_1AFFB:
		cmp	di, 8
		jl	short loc_1AFB8

loc_1B000:
		pop	di
		pop	si
		pop	bp
		retf	6
rikako_1AFA2	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1B006	proc far

arg_0		= byte ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah

		push	bp
		mov	bp, sp
		push	si
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		xor	dx, dx
		jmp	short loc_1B050
; ---------------------------------------------------------------------------

loc_1B01B:
		cmp	byte ptr [si], 0
		jnz	short loc_1B04C
		mov	byte ptr [si], 1
		mov	byte ptr [si+17h], 1
		mov	byte ptr [si+1], 40h
		mov	ax, [bp+arg_4]
		mov	[si+2],	ax
		mov	ax, [bp+arg_2]
		mov	[si+4],	ax
		mov	al, [bp+arg_0]
		mov	[si+12h], al
		mov	byte ptr [si+13h], 20h ; ' '
		mov	al, 1
		sub	al, _pid_current
		mov	[si+10h], al
		jmp	short loc_1B055
; ---------------------------------------------------------------------------

loc_1B04C:
		inc	dx
		add	si, 20h	; ' '

loc_1B050:
		cmp	dx, 0Eh
		jl	short loc_1B01B

loc_1B055:
		pop	si
		pop	bp
		retf	6
sub_1B006	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1B05A	proc near

var_5		= word ptr -5
var_4		= word ptr -4
@@screen_x		= word ptr -2

		enter	6, 0
		push	si
		push	di
		mov	si, word_2028A
		mov	_sprite16_put_w, (48 / 16)
		mov	_sprite16_put_h, 24
		push	word ptr [si+2]
		mov	al, [si+10h]
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		mov	[bp+@@screen_x], ax
		mov	ax, [si+4]
		sar	ax, 4
		add	ax, 10h
		mov	[bp+var_4], ax
		cmp	_pid_current, 0
		jz	short loc_1B0A1
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_1B0AD
; ---------------------------------------------------------------------------

loc_1B0A1:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_1B0AD:
		mov	al, [si+1]
		mov	byte ptr [bp+var_5], al
		cmp	byte ptr [si], 1
		jnz	short loc_1B0E2
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 780h
		mov	di, ax
		test	byte ptr [bp+var_5], 1
		jz	short loc_1B0CC
		add	di, 780h

loc_1B0CC:
		mov	ax, [bp+@@screen_x]
		add	ax, -24
		push	ax
		mov	ax, [bp+var_4]
		add	ax, -24
		push	ax
		push	di
		call	sprite16_put
		jmp	short loc_1B101
; ---------------------------------------------------------------------------

loc_1B0E2:
		cmp	byte ptr [si], 2
		jnz	short loc_1B0F5
		push	[bp+var_2]
		push	[bp+var_4]
		push	[bp+var_5]
		call	sub_1A32A
		jmp	short loc_1B101
; ---------------------------------------------------------------------------

loc_1B0F5:
		push	[bp+var_2]
		push	[bp+var_4]
		push	[bp+var_5]
		call	sub_1A377

loc_1B101:
		pop	di
		pop	si
		leave
		retn
sub_1B05A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

rikako_1B105	proc far

var_7		= byte ptr -7
var_6		= byte ptr -6
@@pid_other		= byte ptr -5
@@vector_y		= word ptr -4
@@vector_x		= word ptr -2

		enter	8, 0
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	word_1F2EC, 0FE00h
		mov	word_1F2EE, 0FE00h
		mov	byte_20E2C, 1
		mov	word_20E32, 100h
		mov	word_20E34, 100h
		mov	pid_20E3A, al
		xor	di, di
		jmp	loc_1B221
; ---------------------------------------------------------------------------

loc_1B146:
		cmp	byte ptr [si], 0
		jz	loc_1B21D
		cmp	byte ptr [si], 1
		jnz	loc_1B1FC
		push	ss
		lea	ax, [bp+@@vector_x]
		push	ax
		push	ss
		lea	ax, [bp+@@vector_y]
		push	ax
		push	word ptr [si+12h]
		mov	al, [si+13h]
		mov	ah, 0
		push	ax
		call	vector2
		mov	ax, [bp+@@vector_x]
		add	[si+2],	ax
		mov	ax, [bp+@@vector_y]
		add	[si+4],	ax
		cmp	byte ptr [si+17h], 0
		jnz	short loc_1B1CC
		cmp	byte ptr [si+1], 40h
		jb	short loc_1B1CC
		cmp	byte ptr [si+1], 50h ; 'P'
		ja	short loc_1B1CC
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	ax, _players[bx].center.y
		sub	ax, [si+4]
		push	ax
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	ax, _players[bx].center.x
		sub	ax, [si+2]
		push	ax
		call	iatan2
		mov	[bp+var_6], al
		inc	byte ptr [si+13h]
		sub	al, [si+12h]
		mov	[bp+var_7], al
		cbw
		mov	bx, 8
		cwd
		idiv	bx
		mov	[bp+var_7], al
		add	[si+12h], al

loc_1B1CC:
		push	word ptr [si+2]
		push	word ptr [si+4]
		call	sub_A310
		or	al, al
		jz	short loc_1B1E0
		mov	byte ptr [si], 0
		jmp	short loc_1B21D
; ---------------------------------------------------------------------------

loc_1B1E0:
		mov	ax, [si+2]
		mov	word_20E2E, ax
		mov	ax, [si+4]
		mov	word_20E30, ax
		call	sub_158F5
		push	word ptr [si+2]
		push	word ptr [si+4]
		call	sub_1A491
		jmp	short loc_1B21A
; ---------------------------------------------------------------------------

loc_1B1FC:
		cmp	byte ptr [si], 2
		jnz	short loc_1B20A
		mov	word_2028A, si
		call	sub_1A1A7
		jmp	short loc_1B21A
; ---------------------------------------------------------------------------

loc_1B20A:
		cmp	byte ptr [si], 1Ch
		ja	short loc_1B213
		inc	byte ptr [si]
		jmp	short loc_1B21A
; ---------------------------------------------------------------------------

loc_1B213:
		mov	byte ptr [si+1], 0
		mov	byte ptr [si], 1

loc_1B21A:
		inc	byte ptr [si+1]

loc_1B21D:
		inc	di
		add	si, 20h	; ' '

loc_1B221:
		cmp	di, 0Eh
		jl	loc_1B146
		mov	byte_20E2C, 0
		pop	di
		pop	si
		leave
		retf
rikako_1B105	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

rikako_1B231	proc far
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 9
		add	ax, 292Ah
		mov	si, ax
		xor	di, di
		jmp	short loc_1B257
; ---------------------------------------------------------------------------

loc_1B247:
		cmp	byte ptr [si], 0
		jz	short loc_1B253
		mov	word_2028A, si
		call	sub_1B05A

loc_1B253:
		inc	di
		add	si, 20h	; ' '

loc_1B257:
		cmp	di, 0Eh
		jl	short loc_1B247
		pop	di
		pop	si
		pop	bp
		retf
rikako_1B231	endp

main_06_TEXT	ends

; ===========================================================================

; Segment type:	Pure code
main_07_TEXT	segment	byte public 'CODE' use16
		assume cs:main_07_TEXT
		assume es:nothing, ss:nothing, ds:_DATA, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1B260	proc far
		push	bp
		mov	bp, sp
		push	si
		mov	si, 1F5Ah
		xor	ax, ax
		jmp	short loc_1B26F
; ---------------------------------------------------------------------------

loc_1B26B:
		mov	byte ptr [si], 0
		inc	ax

loc_1B26F:
		cmp	ax, 10h
		jl	short loc_1B26B
		pop	si
		pop	bp
		retf
sub_1B260	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_ADD_CHIYURI
chargeshot_add_chiyuri	proc far

@@center_y	= word ptr  6
@@center_x	= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		imul	ax, 30h
		add	ax, 1F5Ah
		mov	si, ax
		mov	byte ptr [si+1], 0
		mov	ax, [bp+@@center_x]
		mov	[si+2],	ax
		mov	ax, [bp+@@center_y]
		mov	[si+4],	ax
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	_players[bx].shot_active, SA_DISABLED
		xor	dx, dx
		jmp	short loc_1B2B8
; ---------------------------------------------------------------------------

loc_1B2AB:
		mov	al, dl
		shl	al, 2
		add	al, 2
		mov	[si], al
		inc	dx
		add	si, 6

loc_1B2B8:
		cmp	dx, 8
		jl	short loc_1B2AB
		pop	si
		pop	bp
		retf	4
chargeshot_add_chiyuri	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_UPDATE_CHIYURI
chargeshot_update_chiyuri	proc far
		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 30h
		add	ax, 1F84h
		mov	si, ax
		cmp	byte ptr [si], 0
		jz	loc_1B35B
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	_players[bx].gauge_charged, 0
		xor	di, di
		jmp	short loc_1B356
; ---------------------------------------------------------------------------

loc_1B2EF:
		cmp	byte ptr [si], 0
		jz	short loc_1B35B
		cmp	byte ptr [si], 1
		jz	short loc_1B32B
		dec	byte ptr [si]
		cmp	byte ptr [si], 1
		jnz	short loc_1B34F
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	ax, _players[bx].center.x
		mov	[si+2],	ax
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	ax, _players[bx].center.y
		mov	[si+4],	ax
		call	snd_se_play pascal, 15
		jmp	short loc_1B34F
; ---------------------------------------------------------------------------

loc_1B32B:
		sub	word ptr [si+4], 0E0h
		cmp	word ptr [si+4], 0FD00h
		jge	short loc_1B34F
		or	di, di
		jnz	short loc_1B34A
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	_players[bx].shot_active, SA_ENABLED

loc_1B34A:
		mov	byte ptr [si], 0
		jmp	short loc_1B352
; ---------------------------------------------------------------------------

loc_1B34F:
		inc	byte ptr [si+1]

loc_1B352:
		inc	di
		sub	si, 6

loc_1B356:
		cmp	di, 8
		jl	short loc_1B2EF

loc_1B35B:
		pop	di
		pop	si
		pop	bp
		retf
chargeshot_update_chiyuri	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1B35F	proc near

@@top		= word ptr -4
@@left		= word ptr -2

		enter	4, 0
		push	si
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 280h
		mov	si, ax
		mov	bx, word_1F51A
		test	byte ptr [bx+1], 1
		jz	short loc_1B37B
		add	si, 4

loc_1B37B:
		mov	bx, word_1F51A
		push	word ptr [bx+2]
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -16
		mov	[bp+@@left], ax
		mov	bx, word_1F51A
		mov	ax, [bx+4]
		sar	ax, 4
		add	ax, -8
		mov	[bp+@@top], ax
		call	sprite16_put pascal, [bp+@@left], ax, si
		pop	si
		leave
		retn
sub_1B35F	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

chiyuri_1B3B0	proc far

var_1		= byte ptr -1

		enter	2, 0
		push	si
		push	di
		mov	al, pid_20E3A
		mov	ah, 0
		imul	ax, 30h
		add	ax, 1F84h
		mov	si, ax
		xor	di, di
		mov	[bp+var_1], 0
		jmp	short loc_1B41B
; ---------------------------------------------------------------------------

loc_1B3CB:
		cmp	byte ptr [si], 0
		jz	short loc_1B420
		cmp	byte ptr [si], 1
		jnz	short loc_1B417
		mov	ax, [si+2]
		sub	ax, word_20E36
		cmp	ax, 0E0h
		jg	short loc_1B417
		mov	ax, word_20E2E
		sub	ax, [si+2]
		cmp	ax, 0E0h
		jg	short loc_1B417
		mov	ax, [si+4]
		sub	ax, word_20E38
		cmp	ax, 200h
		jg	short loc_1B417
		mov	ax, word_20E30
		sub	ax, [si+4]
		cmp	ax, 0FF00h
		jg	short loc_1B417
		push	word ptr [si+2]
		push	word ptr [si+4]
		mov	al, pid_20E3A
		mov	ah, 0
		push	ax
		call	sub_B73A
		inc	[bp+var_1]

loc_1B417:
		inc	di
		sub	si, 6

loc_1B41B:
		cmp	di, 8
		jl	short loc_1B3CB

loc_1B420:
		mov	al, [bp+var_1]
		pop	di
		pop	si
		leave
		retf
chiyuri_1B3B0	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_RENDER_CHIYURI
chargeshot_render_chiyuri	proc far
		push	bp
		mov	bp, sp
		push	si
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 30h
		add	ax, 1F84h
		mov	word_1F51A, ax
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 24
		cmp	_pid_current, 0
		jnz	short loc_1B459
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_1B465
; ---------------------------------------------------------------------------

loc_1B459:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_1B465:
		xor	si, si
		jmp	short loc_1B484
; ---------------------------------------------------------------------------

loc_1B469:
		mov	bx, word_1F51A
		cmp	byte ptr [bx], 0
		jz	short loc_1B489
		mov	bx, word_1F51A
		cmp	byte ptr [bx], 1
		jnz	short loc_1B47E
		call	sub_1B35F

loc_1B47E:
		inc	si
		sub	word_1F51A, 6

loc_1B484:
		cmp	si, 8
		jl	short loc_1B469

loc_1B489:
		pop	si
		pop	bp
		retf
chargeshot_render_chiyuri	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1B48C	proc near

var_2		= byte ptr -2
@@pid_other		= byte ptr -1
arg_0		= byte ptr  4

		enter	2, 0
		push	si
		mov	[bp+var_2], 1
		cmp	[bp+arg_0], 2
		jnz	short loc_1B4A3
		mov	al, [bp+var_2]
		add	al, 2
		mov	[bp+var_2], al

loc_1B4A3:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D54h]
		cmp	al, [bp+var_2]
		jnz	short loc_1B502
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+1F58h], 0
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+2D54h]
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D56h]
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		shl	al, 4
		add	al, 20h	; ' '
		mov	dl, _pid_current
		mov	dh, 0
		shl	dx, 2
		mov	bx, dx
		mov	[bx+2D58h], al
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	word ptr [bx+1F54h], 0FE80h
		jmp	loc_1B61E
; ---------------------------------------------------------------------------

loc_1B502:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D54h]
		mov	ah, 0
		mov	dl, [bp+var_2]
		mov	dh, 0
		inc	dx
		cmp	ax, dx
		jnz	loc_1B61E
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	si, [bx+1F54h]
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+1F58h]
		mov	ah, 0
		mov	bx, 10h
		cwd
		idiv	bx
		or	dx, dx
		jnz	short loc_1B57C
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		add	word ptr [bx+1F54h], 180h
		add	si, 180h
		push	si
		push	0
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		mov	ax, 1200h
		sub	ax, si
		push	ax
		push	0
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C

loc_1B57C:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		test	byte ptr [bx+1F58h], 1
		jz	short loc_1B5E3
		mov	al, [bp+arg_0]
		mov	byte_23E4E, al
		mov	al, [bp+@@pid_other]
		mov	_pid_other, al
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+1F58h]
		mov	ah, 0
		mov	bx, 10h
		cwd
		idiv	bx
		shl	dl, 2
		add	dl, 18h
		mov	byte_23E42, dl
		mov	byte_23E45, 1
		mov	angle_23E43, 0
		mov	word_23E40, 0
		mov	word_23E3E, si
		mov	byte_23E50, 0
		call	sub_17730
		mov	ax, 1200h
		sub	ax, si
		mov	word_23E3E, ax
		call	sub_17730
		mov	byte_23E50, 1

loc_1B5E3:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+1F58h]
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+1F58h]
		mov	dl, _pid_current
		mov	dh, 0
		shl	dx, 2
		mov	bx, dx
		cmp	al, [bx+2D58h]
		jb	short loc_1B61E
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+2D54h], 0
		push	word ptr [bp+@@pid_other]
		call	sub_A3A8

loc_1B61E:
		pop	si
		leave
		retn	2
sub_1B48C	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

chiyuri_1B623	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jz	short loc_1B639
		push	1
		call	sub_1B48C

loc_1B639:
		pop	bp
		retf
chiyuri_1B623	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

chiyuri_1B63B	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jz	short loc_1B651
		push	2
		call	sub_1B48C

loc_1B651:
		pop	bp
		retf
chiyuri_1B63B	endp

main_07_TEXT	ends

; ===========================================================================

; Segment type:	Pure code
main_08_TEXT	segment	byte public 'CODE' use16
		assume cs:main_08_TEXT
		;org 3
		assume es:nothing, ss:nothing, ds:_DATA, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1B653	proc far
		push	bp
		mov	bp, sp
		mov	word_1F868, 2008h
		xor	ax, ax
		jmp	short loc_1B66D
; ---------------------------------------------------------------------------

loc_1B660:
		mov	bx, word_1F868
		mov	byte ptr [bx], 0
		inc	ax
		add	word_1F868, 0Ch

loc_1B66D:
		cmp	ax, 40h
		jl	short loc_1B660
		pop	bp
		retf
sub_1B653	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_ADD_ELLEN
chargeshot_add_ellen	proc far

var_2		= word ptr -2
@@center_y	= word ptr  6
@@center_x	= word ptr  8

		enter	2, 0
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		imul	ax, 180h
		add	ax, 2008h
		mov	word_1F868, ax
		mov	[bp+var_2], 0
		jmp	short loc_1B6C0
; ---------------------------------------------------------------------------

loc_1B68E:
		mov	bx, word_1F868
		mov	al, byte ptr [bp+var_2]
		mov	[bx], al
		mov	byte ptr [bx+1], 0
		mov	ax, [bp+@@center_x]
		mov	[bx+4],	ax
		mov	ax, [bp+@@center_y]
		mov	[bx+6],	ax
		call	randring_far_next16
		mov	bx, word_1F868
		mov	[bx+2],	al
		mov	byte ptr [bx+3], 50h ; 'P'
		add	[bp+var_2], 2
		add	word_1F868, 0Ch

loc_1B6C0:
		cmp	[bp+var_2], 40h
		jl	short loc_1B68E
		leave
		retf	4
chargeshot_add_ellen	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1B6CA	proc far

arg_0		= word ptr  6
arg_2		= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		imul	ax, 180h
		add	ax, 2008h
		mov	word_1F868, ax
		xor	si, si
		jmp	short loc_1B719
; ---------------------------------------------------------------------------

loc_1B6E1:
		mov	bx, word_1F868
		cmp	byte ptr [bx], 0
		jnz	short loc_1B713
		mov	bx, word_1F868
		mov	byte ptr [bx], 1
		mov	byte ptr [bx+1], 0
		mov	ax, [bp+arg_2]
		mov	[bx+4],	ax
		mov	ax, [bp+arg_0]
		mov	[bx+6],	ax
		call	randring_far_next16
		mov	bx, word_1F868
		mov	[bx+2],	al
		mov	byte ptr [bx+3], 50h ; 'P'
		jmp	short loc_1B71E
; ---------------------------------------------------------------------------

loc_1B713:
		inc	si
		add	word_1F868, 0Ch

loc_1B719:
		cmp	si, 20h	; ' '
		jl	short loc_1B6E1

loc_1B71E:
		pop	si
		pop	bp
		retf	4
sub_1B6CA	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_UPDATE_ELLEN
chargeshot_update_ellen	proc far

@@length		= byte ptr -9
var_8		= word ptr -8
var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2

		enter	0Ah, 0
		push	si
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 180h
		add	ax, 2008h
		mov	word_1F868, ax
		xor	si, si
		jmp	short loc_1B74A
; ---------------------------------------------------------------------------

loc_1B73B:
		mov	bx, word_1F868
		cmp	byte ptr [bx], 0
		jnz	short loc_1B752
		inc	si
		add	word_1F868, 0Ch

loc_1B74A:
		cmp	si, 20h	; ' '
		jl	short loc_1B73B
		jmp	loc_1B8A3
; ---------------------------------------------------------------------------

loc_1B752:
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 180h
		add	ax, 2008h
		mov	word_1F868, ax
		push	word ptr _pid_current
		call	sub_16983
		mov	ax, word_2142E
		mov	[bp+var_2], ax
		mov	ax, word_21430
		add	ax, 0F920h
		mov	[bp+var_4], ax
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	_players[bx].gauge_charged, 0
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	ax, _players[bx].center.x
		mov	[bp+var_6], ax
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	ax, _players[bx].center.y
		mov	[bp+var_8], ax
		mov	word_1F2EC, 0FF80h
		mov	word_1F2EE, 0FF80h
		xor	si, si
		jmp	loc_1B89C
; ---------------------------------------------------------------------------

loc_1B7BC:
		mov	bx, word_1F868
		cmp	byte ptr [bx], 0
		jz	loc_1B896
		mov	bx, word_1F868
		cmp	byte ptr [bx], 1
		jnz	loc_1B871
		mov	ax, [bx+8]
		add	[bx+4],	ax
		mov	ax, [bx+0Ah]
		add	[bx+6],	ax
		cmp	byte ptr [bx+1], 0
		jnz	short loc_1B855
		mov	al, [bx+3]
		add	al, -2
		mov	[bp+@@length], al
		push	ds
		mov	ax, word_1F868
		add	ax, 8
		push	ax
		push	ds
		mov	ax, word_1F868
		add	ax, 10
		push	ax
		push	word ptr [bx+2]
		mov	al, [bp+@@length]
		mov	ah, 0
		push	ax
		call	vector2
		mov	bx, word_1F868
		mov	al, [bp+@@length]
		mov	[bx+3],	al
		cmp	[bp+@@length], 0
		jnz	short loc_1B896
		mov	byte ptr [bx+1], 1
		mov	ax, [bp+var_4]
		sub	ax, [bx+6]
		push	ax
		mov	ax, [bp+var_2]
		sub	ax, [bx+4]
		push	ax
		call	iatan2
		mov	bx, word_1F868
		mov	[bx+2],	al
		push	ds
		mov	ax, word_1F868
		add	ax, 8
		push	ax
		push	ds
		mov	ax, word_1F868
		add	ax, 10
		push	ax
		push	word ptr [bx+2]
		push	160
		call	vector2
		jmp	short loc_1B896
; ---------------------------------------------------------------------------

loc_1B855:
		mov	bx, word_1F868
		push	word ptr [bx+4]
		push	word ptr [bx+6]
		call	sub_A310
		or	al, al
		jz	short loc_1B896
		mov	bx, word_1F868
		mov	byte ptr [bx], 0
		jmp	short loc_1B896
; ---------------------------------------------------------------------------

loc_1B871:
		mov	bx, word_1F868
		mov	al, [bx]
		add	al, -1
		mov	[bx], al
		cmp	al, 1
		jnz	short loc_1B886
		call	snd_se_play pascal, 1

loc_1B886:
		mov	bx, word_1F868
		mov	ax, [bp+var_6]
		mov	[bx+4],	ax
		mov	ax, [bp+var_8]
		mov	[bx+6],	ax

loc_1B896:
		inc	si
		add	word_1F868, 0Ch

loc_1B89C:
		cmp	si, 20h	; ' '
		jl	loc_1B7BC

loc_1B8A3:
		pop	si
		leave
		retf
chargeshot_update_ellen	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1B8A6	proc near

var_3		= byte ptr -3
@@sprite_offset		= word ptr -2
arg_0		= word ptr  4
arg_2		= word ptr  6

		enter	4, 0
		push	si
		push	di
		mov	si, [bp+arg_2]
		mov	di, [bp+arg_0]
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 10h
		mov	[bp+@@sprite_offset], ax
		mov	bx, word_1F868
		mov	al, [bx+2]
		add	al, 10h
		mov	[bp+var_3], al
		shr	[bp+var_3], 5
		shl	[bp+var_3], 1
		mov	al, [bp+var_3]
		mov	ah, 0
		add	[bp+@@sprite_offset], ax
		push	si
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -8
		mov	si, ax
		mov	ax, di
		sar	ax, 4
		add	ax, 8
		mov	di, ax
		call	sprite16_put pascal, si, ax, [bp+@@sprite_offset]
		pop	di
		pop	si
		leave
		retn	4
sub_1B8A6	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

ellen_1B903	proc far

var_1		= byte ptr -1

		enter	2, 0
		push	si
		mov	[bp+var_1], 0
		mov	al, pid_20E3A
		mov	ah, 0
		imul	ax, 180h
		add	ax, 2008h
		mov	word_1F868, ax
		xor	si, si
		jmp	short loc_1B96E
; ---------------------------------------------------------------------------

loc_1B91F:
		mov	bx, word_1F868
		cmp	byte ptr [bx], 1
		jnz	short loc_1B968
		mov	bx, word_1F868
		mov	ax, [bx+4]
		cmp	ax, word_20E2E
		jl	short loc_1B968
		cmp	ax, word_20E36
		jg	short loc_1B968
		mov	ax, [bx+6]
		cmp	ax, word_20E30
		jl	short loc_1B968
		cmp	ax, word_20E38
		jg	short loc_1B968
		push	word ptr [bx+4]
		push	ax
		mov	al, pid_20E3A
		mov	ah, 0
		push	ax
		call	sub_B73A
		mov	bx, word_1F868
		mov	byte ptr [bx], 0
		mov	al, [bp+var_1]
		add	al, 2
		mov	[bp+var_1], al

loc_1B968:
		inc	si
		add	word_1F868, 0Ch

loc_1B96E:
		cmp	si, 20h	; ' '
		jl	short loc_1B91F
		mov	al, [bp+var_1]
		pop	si
		leave
		retf
ellen_1B903	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_RENDER_ELLEN
chargeshot_render_ellen	proc far
		push	bp
		mov	bp, sp
		push	si
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 180h
		add	ax, 2008h
		mov	word_1F868, ax
		mov	_sprite16_put_w, (16 / 16)
		mov	_sprite16_put_h, 8
		cmp	_pid_current, 0
		jnz	short loc_1B9AC
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_1B9B8
; ---------------------------------------------------------------------------

loc_1B9AC:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_1B9B8:
		xor	si, si
		jmp	short loc_1B9D8
; ---------------------------------------------------------------------------

loc_1B9BC:
		mov	bx, word_1F868
		cmp	byte ptr [bx], 1
		jnz	short loc_1B9D2
		mov	bx, word_1F868
		push	word ptr [bx+4]
		push	word ptr [bx+6]
		call	sub_1B8A6

loc_1B9D2:
		inc	si
		add	word_1F868, 0Ch

loc_1B9D8:
		cmp	si, 20h	; ' '
		jl	short loc_1B9BC
		pop	si
		pop	bp
		retf
chargeshot_render_ellen	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1B9E0	proc near

var_2		= byte ptr -2
@@pid_other		= byte ptr -1
arg_0		= byte ptr  4

		enter	2, 0
		mov	[bp+var_2], 1
		cmp	[bp+arg_0], 2
		jnz	short loc_1B9F6
		mov	al, [bp+var_2]
		add	al, 2
		mov	[bp+var_2], al

loc_1B9F6:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D54h]
		cmp	al, [bp+var_2]
		jnz	short loc_1BA77
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+2006h], 0
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+2D54h]
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	word ptr [bx+1FFEh], 900h
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	word ptr [bx+2002h], 0
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D56h]
		add	al, 0Eh
		mov	dl, _pid_current
		mov	dh, 0
		shl	dx, 2
		mov	bx, dx
		mov	[bx+2D58h], al
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D56h]
		add	al, 1Ch
		mov	dl, _pid_current
		mov	dh, 0
		shl	dx, 2
		mov	bx, dx
		mov	[bx+2D59h], al
		leave
		retn	2
; ---------------------------------------------------------------------------

loc_1BA77:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D54h]
		mov	ah, 0
		mov	dl, [bp+var_2]
		mov	dh, 0
		inc	dx
		cmp	ax, dx
		jnz	locret_1BC19
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2006h]
		mov	ah, 0
		mov	bx, 8
		cwd
		idiv	bx
		or	dx, dx
		jnz	loc_1BC0E
		mov	al, [bp+arg_0]
		mov	byte_23E4E, al
		mov	word_23E40, 80h
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	_pid_other, al
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		cmp	word ptr [bx+1FFEh], 0
		jle	loc_1BB55
		mov	angle_23E43, 0
		mov	byte_23E42, 38h ; '8'
		mov	byte_23E45, 2Ch ; ','
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		mov	al, [bx+2D58h]
		mov	byte_23E47, al
		mov	word_23E40, 0
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	ax, [bx+1FFEh]
		mov	word_23E3E, ax
		push	ax
		push	0
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		call	sub_17730
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	dx, 1200h
		mov	bx, ax
		sub	dx, [bx+1FFEh]
		mov	word_23E3E, dx
		push	dx
		push	0
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		call	sub_17730
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		sub	word ptr [bx+1FFEh], 180h
		jmp	loc_1BC0E
; ---------------------------------------------------------------------------

loc_1BB55:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		cmp	word ptr [bx+2002h], 900h
		jge	loc_1BBFA
		call	randring_far_next16
		mov	angle_23E43, al
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		mov	al, [bx+2D59h]
		mov	byte_23E42, al
		mov	byte_23E45, 24h ; '$'
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	ax, [bx+2002h]
		mov	word_23E40, ax
		mov	word_23E3E, 0
		push	0
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	word ptr [bx+2002h]
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		call	sub_17730
		mov	word_23E3E, 1200h
		push	1200h
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	word ptr [bx+2002h]
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		call	sub_17730
		call	randring_far_next16
		mov	angle_23E43, al
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		add	word ptr [bx+2002h], 180h
		jmp	short loc_1BC0E
; ---------------------------------------------------------------------------

loc_1BBFA:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+2D54h], 0
		push	word ptr [bp+@@pid_other]
		call	sub_A3A8

loc_1BC0E:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+2006h]

locret_1BC19:
		leave
		retn	2
sub_1B9E0	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

ellen_1BC1D	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jz	short loc_1BC33
		push	1
		call	sub_1B9E0

loc_1BC33:
		pop	bp
		retf
ellen_1BC1D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

ellen_1BC35	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jz	short loc_1BC4B
		push	2
		call	sub_1B9E0

loc_1BC4B:
		pop	bp
		retf
ellen_1BC35	endp

main_08_TEXT	ends

; ===========================================================================

; Segment type:	Pure code
main_09_TEXT	segment	byte public 'CODE' use16
		assume cs:main_09_TEXT
		;org 0Dh
		assume es:nothing, ss:nothing, ds:_DATA, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1BC4D	proc far
		push	bp
		mov	bp, sp
		mov	byte_1FD8E, 0
		mov	byte_1FD8F, 0
		pop	bp
		retf
sub_1BC4D	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_ADD_KANA
chargeshot_add_kana	proc far

@@center_y	= word ptr  6
@@center_x	= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+282Eh], 1
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+2830h], 0
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		imul	ax, 0D8h
		add	ax, 267Ch
		mov	si, ax
		xor	cx, cx
		jmp	short loc_1BCAF
; ---------------------------------------------------------------------------

loc_1BC8A:
		xor	dx, dx
		jmp	short loc_1BCA2
; ---------------------------------------------------------------------------

loc_1BC8E:
		mov	bx, dx
		add	bx, bx
		mov	ax, [bp+@@center_x]
		mov	[bx+si], ax
		mov	bx, dx
		add	bx, bx
		mov	ax, [bp+@@center_y]
		mov	[bx+si+1Ah], ax
		inc	dx

loc_1BCA2:
		cmp	dx, 0Ch
		jle	short loc_1BC8E
		mov	byte ptr [si+35h], 30h ; '0'
		inc	cx
		add	si, 36h	; '6'

loc_1BCAF:
		cmp	cx, 4
		jl	short loc_1BC8A
		sub	si, 36h	; '6'
		mov	byte ptr [si+34h], 0F0h
		sub	si, 36h	; '6'
		mov	byte ptr [si+34h], 0C8h
		sub	si, 36h	; '6'
		mov	byte ptr [si+34h], 0B8h
		sub	si, 36h	; '6'
		mov	byte ptr [si+34h], 90h
		pop	si
		pop	bp
		retf	4
chargeshot_add_kana	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_UPDATE_KANA
chargeshot_update_kana	proc far

var_7		= byte ptr -7
var_6		= word ptr -6
@@vector_y		= word ptr -4
@@vector_x		= word ptr -2

		enter	8, 0
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+282Eh], 0
		jz	loc_1BDF4
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	_players[bx].gauge_charged, 0
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+282Eh]
		mov	[bp+var_7], al
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 0D8h
		add	ax, 267Ch
		mov	si, ax
		xor	di, di
		jmp	short loc_1BD7B
; ---------------------------------------------------------------------------

loc_1BD1B:
		push	ss
		lea	ax, [bp+@@vector_x]
		push	ax
		push	ss
		lea	ax, [bp+@@vector_y]
		push	ax
		push	word ptr [si+34h]
		mov	al, [si+35h]
		mov	ah, 0
		push	ax
		call	vector2
		mov	[bp+var_6], 0Ch
		jmp	short loc_1BD5D
; ---------------------------------------------------------------------------

loc_1BD3A:
		mov	bx, [bp+var_6]
		dec	bx
		add	bx, bx
		mov	ax, [bx+si]
		mov	bx, [bp+var_6]
		add	bx, bx
		mov	[bx+si], ax
		mov	bx, [bp+var_6]
		dec	bx
		add	bx, bx
		mov	ax, [bx+si+1Ah]
		mov	bx, [bp+var_6]
		add	bx, bx
		mov	[bx+si+1Ah], ax
		dec	[bp+var_6]

loc_1BD5D:
		cmp	[bp+var_6], 0
		jg	short loc_1BD3A
		mov	ax, [bp+@@vector_x]
		add	[si], ax
		mov	ax, [bp+@@vector_y]
		add	[si+1Ah], ax
		cmp	[bp+var_7], 1
		jnz	short loc_1BD77
		dec	byte ptr [si+35h]

loc_1BD77:
		inc	di
		add	si, 36h	; '6'

loc_1BD7B:
		cmp	di, 4
		jl	short loc_1BD1B
		cmp	[bp+var_7], 1
		jnz	short loc_1BDC8
		sub	si, 36h	; '6'
		mov	al, [si+34h]
		add	al, 0FEh
		mov	[si+34h], al
		sub	si, 0A2h
		mov	al, [si+34h]
		add	al, 2
		mov	[si+34h], al
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2830h], 28h ; '('
		jbe	short loc_1BDC8
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+282Eh], 2
		xor	di, di
		jmp	short loc_1BDC3
; ---------------------------------------------------------------------------

loc_1BDBB:
		mov	byte ptr [si+35h], 80h
		inc	di
		add	si, 36h	; '6'

loc_1BDC3:
		cmp	di, 4
		jl	short loc_1BDBB

loc_1BDC8:
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 0D8h
		add	ax, 267Ch
		mov	si, ax
		cmp	word ptr [si+32h], 0FF00h
		jg	short loc_1BDE9
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+282Eh], 0

loc_1BDE9:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+2830h]

loc_1BDF4:
		pop	di
		pop	si
		leave
		retf
chargeshot_update_kana	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1BDF8	proc near

@@top		= word ptr -4
@@left		= word ptr -2

		enter	4, 0
		push	si
		push	di
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 1180h
		mov	di, ax
		mov	si, 0Ch
		jmp	short loc_1BE4A
; ---------------------------------------------------------------------------

loc_1BE0D:
		mov	bx, si
		add	bx, bx
		add	bx, word_1FD8C
		push	word ptr [bx]
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -16
		mov	[bp+@@left], ax
		mov	bx, si
		add	bx, bx
		add	bx, word_1FD8C
		mov	ax, [bx+1Ah]
		sar	ax, 4
		mov	[bp+@@top], ax
		call	sprite16_put pascal, [bp+@@left], ax, di
		sub	si, 4
		sub	di, 500h

loc_1BE4A:
		or	si, si
		jge	short loc_1BE0D
		pop	di
		pop	si
		leave
		retn
sub_1BDF8	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kana_1BE52	proc far

var_2		= word ptr -2

		enter	2, 0
		push	si
		push	di
		mov	al, pid_20E3A
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+282Eh], 0
		jz	loc_1BEED
		mov	al, pid_20E3A
		mov	ah, 0
		imul	ax, 0D8h
		add	ax, 267Ch
		mov	di, ax
		mov	[bp+var_2], 0
		jmp	short loc_1BEE7
; ---------------------------------------------------------------------------

loc_1BE7D:
		xor	si, si
		jmp	short loc_1BEDC
; ---------------------------------------------------------------------------

loc_1BE81:
		mov	bx, si
		add	bx, bx
		mov	ax, [bx+di]
		sub	ax, word_20E36
		cmp	ax, 0C0h
		jg	short loc_1BED9
		mov	bx, si
		add	bx, bx
		mov	ax, word_20E2E
		sub	ax, [bx+di]
		cmp	ax, 0C0h
		jg	short loc_1BED9
		mov	bx, si
		add	bx, bx
		mov	ax, [bx+di+1Ah]
		sub	ax, word_20E38
		cmp	ax, 0C0h
		jg	short loc_1BED9
		mov	bx, si
		add	bx, bx
		mov	ax, word_20E30
		sub	ax, [bx+di+1Ah]
		cmp	ax, 0C0h
		jg	short loc_1BED9
		mov	bx, si
		add	bx, bx
		push	word ptr [bx+di]
		mov	bx, si
		add	bx, bx
		push	word ptr [bx+di+1Ah]
		mov	al, pid_20E3A
		mov	ah, 0
		push	ax
		call	sub_B73A
		mov	al, 1
		jmp	short loc_1BEEF
; ---------------------------------------------------------------------------

loc_1BED9:
		add	si, 4

loc_1BEDC:
		cmp	si, 0Ch
		jle	short loc_1BE81
		inc	[bp+var_2]
		add	di, 36h	; '6'

loc_1BEE7:
		cmp	[bp+var_2], 4
		jl	short loc_1BE7D

loc_1BEED:
		mov	al, 0

loc_1BEEF:
		pop	di
		pop	si
		leave
		retf
kana_1BE52	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_RENDER_KANA
chargeshot_render_kana	proc far
		push	bp
		mov	bp, sp
		push	si
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+282Eh], 0
		jz	short loc_1BF5F
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 0D8h
		add	ax, 267Ch
		mov	word_1FD8C, ax
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 16
		cmp	_pid_current, 0
		jnz	short loc_1BF34
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_1BF40
; ---------------------------------------------------------------------------

loc_1BF34:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_1BF40:
		xor	dx, dx
		mov	ah, SPRITE16_SET_OVERLAP
		int	SPRITE16
		xor	si, si
		jmp	short loc_1BF53
; ---------------------------------------------------------------------------

loc_1BF4A:
		call	sub_1BDF8
		inc	si
		add	word_1FD8C, 36h	; '6'

loc_1BF53:
		cmp	si, 4
		jl	short loc_1BF4A
		mov	dx, OVERLAP_CLEAR
		mov	ah, SPRITE16_SET_OVERLAP
		int	SPRITE16

loc_1BF5F:
		pop	si
		pop	bp
		retf
chargeshot_render_kana	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1BF62	proc near

var_2		= byte ptr -2
@@pid_other		= byte ptr -1
arg_0		= byte ptr  4

		enter	2, 0
		mov	[bp+var_2], 1
		cmp	[bp+arg_0], 2
		jnz	short loc_1BF78
		mov	al, [bp+var_2]
		add	al, 2
		mov	[bp+var_2], al

loc_1BF78:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D54h]
		cmp	al, [bp+var_2]
		jnz	short loc_1BFF3
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+267Ah], 0
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+2D54h]
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	word ptr [bx+2676h], 0
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D56h]
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		mov	dl, 8
		sub	dl, al
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		mov	[bx+2D58h], dl
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D56h]
		add	al, 30h	; '0'
		mov	dl, _pid_current
		mov	dh, 0
		shl	dx, 2
		mov	bx, dx
		mov	[bx+2D59h], al
		leave
		retn	2
; ---------------------------------------------------------------------------

loc_1BFF3:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D54h]
		mov	ah, 0
		mov	dl, [bp+var_2]
		mov	dh, 0
		inc	dx
		cmp	ax, dx
		jnz	locret_1C124
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+267Ah]
		mov	ah, 0
		mov	dl, _pid_current
		mov	dh, 0
		shl	dx, 2
		mov	bx, dx
		mov	dl, [bx+2D58h]
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		or	dx, dx
		jnz	loc_1C0BB
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	al, [bp+arg_0]
		mov	byte_23E4E, al
		mov	al, [bp+@@pid_other]
		mov	_pid_other, al
		mov	word_23E40, 0
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	ax, [bx+2676h]
		mov	word_23E3E, ax
		mov	byte_23E45, 0
		mov	angle_23E43, 40h
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		mov	al, [bx+2D59h]
		mov	byte_23E42, al
		call	sub_17730
		push	word_23E3E
		push	0
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	dx, 1200h
		mov	bx, ax
		sub	dx, [bx+2676h]
		mov	word_23E3E, dx
		call	sub_17730
		push	word_23E3E
		push	0
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C

loc_1C0BB:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+267Ah]
		mov	ah, 0
		mov	bx, 40h
		cwd
		idiv	bx
		cmp	dx, 20h	; ' '
		jge	short loc_1C0E4
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		add	word ptr [bx+2676h], 80h
		jmp	short loc_1C0F3
; ---------------------------------------------------------------------------

loc_1C0E4:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		sub	word ptr [bx+2676h], 80h

loc_1C0F3:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+267Ah], 80h
		jb	short loc_1C119
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+2D54h], 0
		mov	al, 1
		sub	al, _pid_current
		push	ax
		call	sub_A3A8

loc_1C119:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+267Ah]

locret_1C124:
		leave
		retn	2
sub_1BF62	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kana_1C128	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jz	short loc_1C13E
		push	1
		call	sub_1BF62

loc_1C13E:
		pop	bp
		retf
kana_1C128	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kana_1C140	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jz	short loc_1C156
		push	2
		call	sub_1BF62

loc_1C156:
		pop	bp
		retf
kana_1C140	endp

main_09_TEXT	ends

; ===========================================================================

; Segment type:	Pure code
main_10_TEXT	segment	byte public 'CODE' use16
		assume cs:main_10_TEXT
		;org 8
		assume es:nothing, ss:nothing, ds:_DATA, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1C158	proc far
		push	bp
		mov	bp, sp
		mov	byte_1FE5A, 0
		mov	byte_1FE62, 0
		pop	bp
		retf
sub_1C158	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_ADD_KOTOHIME
chargeshot_add_kotohime	proc far

@@center_y	= word ptr  6
@@center_x	= word ptr  8

		push	bp
		mov	bp, sp
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		shl	ax, 3
		add	ax, 28FAh
		mov	word_1FE6A, ax
		mov	bx, word_1FE6A
		mov	byte ptr [bx], 1
		mov	byte ptr [bx+1], 0
		mov	ax, [bp+@@center_x]
		mov	[bx+2],	ax
		mov	ax, [bp+@@center_y]
		mov	[bx+4],	ax
		mov	word ptr [bx+6], 0FFF0h
		call	snd_se_play pascal, 6
		pop	bp
		retf	4
chargeshot_add_kotohime	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_UPDATE_KOTOHIME
chargeshot_update_kotohime	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 3
		add	ax, 28FAh
		mov	word_1FE6A, ax
		mov	bx, word_1FE6A
		cmp	byte ptr [bx], 0
		jz	short loc_1C1E7
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 7
		mov	bx, ax
		mov	_players[bx].gauge_charged, 0
		mov	bx, word_1FE6A
		mov	ax, [bx+6]
		add	[bx+4],	ax
		cmp	word ptr [bx+4], 0FF00h
		jg	short loc_1C1DF
		mov	byte ptr [bx], 0
		pop	bp
		retf
; ---------------------------------------------------------------------------

loc_1C1DF:
		mov	bx, word_1FE6A
		sub	word ptr [bx+6], 2

loc_1C1E7:
		pop	bp
		retf
chargeshot_update_kotohime	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1C1E9	proc near

@@sprite_offset		= word ptr -6
@@top		= word ptr -4
@@left		= word ptr -2

		enter	6, 0
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 1188h
		mov	[bp+@@sprite_offset], ax
		mov	bx, word_1FE6A
		push	word ptr [bx+2]
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -48
		mov	[bp+@@left], ax
		mov	bx, word_1FE6A
		mov	ax, [bx+4]
		sar	ax, 4
		add	ax, 8
		mov	[bp+@@top], ax
		call	sprite16_put pascal, [bp+@@left], ax, [bp+@@sprite_offset]
		leave
		retn
sub_1C1E9	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kotohime_1C22E	proc far
		push	bp
		mov	bp, sp
		mov	al, pid_20E3A
		mov	ah, 0
		shl	ax, 3
		add	ax, 28FAh
		mov	word_1FE6A, ax
		mov	bx, word_1FE6A
		cmp	byte ptr [bx], 0
		jz	short loc_1C291
		mov	bx, word_1FE6A
		mov	ax, [bx+2]
		sub	ax, word_20E36
		cmp	ax, 280h
		jg	short loc_1C291
		mov	ax, word_20E2E
		sub	ax, [bx+2]
		cmp	ax, 280h
		jg	short loc_1C291
		mov	ax, [bx+4]
		cmp	ax, word_20E30
		jl	short loc_1C291
		cmp	ax, word_20E38
		jg	short loc_1C291
		mov	byte_26356, 1
		mov	ax, word_20E2E
		add	ax, word_20E32
		push	ax
		push	word ptr [bx+4]
		mov	al, pid_20E3A
		mov	ah, 0
		push	ax
		call	sub_B73A
		mov	al, 3
		pop	bp
		retf
; ---------------------------------------------------------------------------

loc_1C291:
		mov	al, 0
		pop	bp
		retf
kotohime_1C22E	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_RENDER_KOTOHIME
chargeshot_render_kotohime	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 3
		add	ax, 28FAh
		mov	word_1FE6A, ax
		mov	bx, word_1FE6A
		cmp	byte ptr [bx], 0
		jz	short loc_1C2DE
		mov	_sprite16_put_w, (96 / 16)
		mov	_sprite16_put_h, 16
		cmp	_pid_current, 0
		jnz	short loc_1C2CF
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_1C2DB
; ---------------------------------------------------------------------------

loc_1C2CF:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_1C2DB:
		call	sub_1C1E9

loc_1C2DE:
		pop	bp
		retf
chargeshot_render_kotohime	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1C2E0	proc near

var_1		= byte ptr -1
arg_0		= byte ptr  4

		enter	2, 0
		mov	[bp+var_1], 1
		cmp	[bp+arg_0], 2
		jnz	short loc_1C2F6
		mov	al, [bp+var_1]
		add	al, 2
		mov	[bp+var_1], al

loc_1C2F6:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D54h]
		cmp	al, [bp+var_1]
		jnz	short loc_1C36B
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+28F8h], 0
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+2D54h]
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D56h]
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		add	al, 4
		mov	dl, _pid_current
		mov	dh, 0
		shl	dx, 2
		mov	bx, dx
		mov	[bx+2D58h], al
		push	1
		call	randring_far_next16_and
		mov	dl, _pid_current
		mov	dh, 0
		shl	dx, 2
		mov	bx, dx
		mov	[bx+2D59h], al
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	dl, [bp+arg_0]
		mov	bx, ax
		mov	[bx+2D5Ah], dl
		leave
		retn	2
; ---------------------------------------------------------------------------

loc_1C36B:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D54h]
		mov	ah, 0
		mov	dl, [bp+var_1]
		mov	dh, 0
		inc	dx
		cmp	ax, dx
		jnz	short locret_1C3D6
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+28F8h], 0
		jnz	short loc_1C3A5
		push	0A00h
		call	randring_far_next16_mod
		add	ax, 400h
		push	ax
		push	0
		call	sub_19DD3
		jmp	short loc_1C3CB
; ---------------------------------------------------------------------------

loc_1C3A5:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+28F8h], 80h
		jb	short loc_1C3CB
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+2D54h], 0
		mov	al, 1
		sub	al, _pid_current
		push	ax
		call	sub_A3A8

loc_1C3CB:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+28F8h]

locret_1C3D6:
		leave
		retn	2
sub_1C2E0	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kotohime_1C3DA	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jz	short loc_1C3F0
		push	1
		call	sub_1C2E0

loc_1C3F0:
		pop	bp
		retf
kotohime_1C3DA	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

kotohime_1C3F2	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jz	short loc_1C408
		push	2
		call	sub_1C2E0

loc_1C408:
		pop	bp
		retf
kotohime_1C3F2	endp

main_10_TEXT	ends

; ===========================================================================

; Segment type:	Pure code
main_11_TEXT	segment	byte public 'CODE' use16
		assume cs:main_11_TEXT
		;org 0Ah
		assume es:nothing, ss:nothing, ds:_DATA, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1C40A	proc far
		push	bp
		mov	bp, sp
		mov	byte_20E88, 0
		mov	byte_20E89, 0
		pop	bp
		retf
sub_1C40A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_ADD_RIKAKO
chargeshot_add_rikako	proc far

@@center_y	= word ptr  6
@@center_x	= word ptr  8

		push	bp
		mov	bp, sp
		push	si
		push	di
		mov	di, [bp+@@center_x]
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+3928h], 1
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+392Ah], 0
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	word ptr [bx+392Ch], 80h
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		imul	ax, 18h
		add	ax, 38F6h
		mov	si, ax
		xor	cx, cx
		jmp	short loc_1C46F
; ---------------------------------------------------------------------------

loc_1C459:
		mov	[si], di
		mov	ax, [bp+@@center_y]
		mov	[si+2],	ax
		mov	al, cl
		shl	al, 6
		add	al, 20h	; ' '
		mov	[si+4],	al
		inc	cx
		add	si, 6

loc_1C46F:
		cmp	cx, 4
		jl	short loc_1C459
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	[bx+3930h], di
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, ax
		mov	dx, [bp+@@center_y]
		mov	bx, ax
		mov	[bx+3934h], dx
		pop	di
		pop	si
		pop	bp
		retf	4
chargeshot_add_rikako	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

rikako_1C497	proc far

@@center_y	= word ptr  6
@@center_x	= word ptr  8

		push	bp
		mov	bp, sp
		call	chargeshot_add_rikako pascal, [bp+@@center_x], [bp+@@center_y]
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+3928h], 2
		pop	bp
		retf	4
rikako_1C497	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1C4B4	proc far
		push	bp
		mov	bp, sp
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+3928h], 0
		pop	bp
		retf
sub_1C4B4	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_UPDATE_RIKAKO
chargeshot_update_rikako	proc far

var_5		= byte ptr -5
@@player		= word ptr -4
var_2		= word ptr -2

		enter	6, 0
		push	si
		push	di
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+3928h], 0
		jz	loc_1C626
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 7
		add	ax, offset _players
		mov	[bp+@@player], ax
		mov	bx, [bp+@@player]
		mov	word ptr [bx+18h], 0
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+392Ah]
		mov	[bp+var_5], al
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	di, [bx+392Ch]
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 18h
		add	ax, 38F6h
		mov	si, ax
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+3928h], 1
		jnz	short loc_1C537
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		sub	word ptr [bx+3934h], 20h ; ' '
		jmp	short loc_1C55C
; ---------------------------------------------------------------------------

loc_1C537:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, [bp+@@player]
		mov	dx, [bx+player_t.center.x]
		mov	bx, ax
		mov	[bx+3930h], dx
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, [bp+@@player]
		mov	dx, [bx+player_t.center.y]
		mov	bx, ax
		mov	[bx+3934h], dx

loc_1C55C:
		mov	[bp+var_2], 0
		jmp	short loc_1C5C6
; ---------------------------------------------------------------------------

loc_1C563:
		mov	al, [si+4]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_CosTable8[bx]
		push	di
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	word ptr [bx+3930h]
		call	_vector1_at
		add	sp, 6
		mov	[si], ax
		mov	al, [si+4]
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	_SinTable8[bx]
		push	di
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		push	word ptr [bx+3934h]
		call	_vector1_at
		add	sp, 6
		mov	[si+2],	ax
		test	byte ptr [bp+var_2], 1
		jz	short loc_1C5B8
		mov	al, 8
		jmp	short loc_1C5BA
; ---------------------------------------------------------------------------

loc_1C5B8:
		mov	al, 0F8h

loc_1C5BA:
		add	al, [si+4]
		mov	[si+4],	al
		inc	[bp+var_2]
		add	si, 6

loc_1C5C6:
		cmp	[bp+var_2], 4
		jl	short loc_1C563
		cmp	[bp+var_5], 20h	; ' '
		jnb	short loc_1C5D7
		add	di, 20h	; ' '
		jmp	short loc_1C60E
; ---------------------------------------------------------------------------

loc_1C5D7:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+3928h], 1
		jnz	short loc_1C602
		cmp	[bp+var_5], 80h
		jbe	short loc_1C60E
		add	di, 60h
		cmp	[bp+var_5], 90h
		jbe	short loc_1C60E
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+3928h], 0
		jmp	short loc_1C60E
; ---------------------------------------------------------------------------

loc_1C602:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+392Ah], 20h ; ' '

loc_1C60E:
		mov	al, _pid_current
		mov	ah, 0
		add	ax, ax
		mov	bx, ax
		mov	[bx+392Ch], di
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+392Ah]

loc_1C626:
		pop	di
		pop	si
		leave
		retf
chargeshot_update_rikako	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1C62A	proc near

@@sprite_offset		= word ptr -6
@@top		= word ptr -4
@@left		= word ptr -2

		enter	6, 0
		mov	al, byte ptr word_23AF0
		mov	ah, 0
		add	ax, 280h
		mov	[bp+@@sprite_offset], ax
		mov	bx, word_20E86
		push	word ptr [bx]
		mov	al, _pid_current
		mov	ah, 0
		push	ax
		call	playfield_fg_x_to_screen
		add	ax, -16
		mov	[bp+@@left], ax
		mov	bx, word_20E86
		mov	ax, [bx+2]
		sar	ax, 4
		mov	[bp+@@top], ax
		call	sprite16_put pascal, [bp+@@left], ax, [bp+@@sprite_offset]
		leave
		retn
sub_1C62A	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

rikako_1C66B	proc far

var_2		= word ptr -2

		enter	2, 0
		push	si
		push	di
		mov	al, pid_20E3A
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+3928h], 0
		jnz	short loc_1C683
		mov	al, 0
		jmp	short loc_1C6E4
; ---------------------------------------------------------------------------

loc_1C683:
		mov	[bp+var_2], 0
		mov	al, pid_20E3A
		mov	ah, 0
		imul	ax, 18h
		add	ax, 38F6h
		mov	si, ax
		xor	di, di
		jmp	short loc_1C6DC
; ---------------------------------------------------------------------------

loc_1C699:
		mov	ax, [si]
		sub	ax, word_20E36
		cmp	ax, 0C0h
		jg	short loc_1C6D8
		mov	ax, word_20E2E
		sub	ax, [si]
		cmp	ax, 0C0h
		jg	short loc_1C6D8
		mov	ax, [si+2]
		sub	ax, word_20E38
		cmp	ax, 0C0h
		jg	short loc_1C6D8
		mov	ax, word_20E30
		sub	ax, [si+2]
		cmp	ax, 0C0h
		jg	short loc_1C6D8
		push	word ptr [si]
		push	word ptr [si+2]
		mov	al, pid_20E3A
		mov	ah, 0
		push	ax
		call	sub_B73A
		inc	[bp+var_2]

loc_1C6D8:
		inc	di
		add	si, 6

loc_1C6DC:
		cmp	di, 4
		jl	short loc_1C699
		mov	al, byte ptr [bp+var_2]

loc_1C6E4:
		pop	di
		pop	si
		leave
		retf
rikako_1C66B	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame
public CHARGESHOT_RENDER_RIKAKO
chargeshot_render_rikako	proc far
		push	bp
		mov	bp, sp
		push	si
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+3928h], 0
		jz	short loc_1C746
		mov	al, _pid_current
		mov	ah, 0
		imul	ax, 18h
		add	ax, 38F6h
		mov	word_20E86, ax
		mov	_sprite16_put_w, (32 / 16)
		mov	_sprite16_put_h, 16
		cmp	_pid_current, 0
		jnz	short loc_1C728
		mov	_sprite16_clip_left, PLAYFIELD1_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD1_CLIP_RIGHT
		jmp	short loc_1C734
; ---------------------------------------------------------------------------

loc_1C728:
		mov	_sprite16_clip_left, PLAYFIELD2_CLIP_LEFT
		mov	_sprite16_clip_right, PLAYFIELD2_CLIP_RIGHT

loc_1C734:
		xor	si, si
		jmp	short loc_1C741
; ---------------------------------------------------------------------------

loc_1C738:
		call	sub_1C62A
		inc	si
		add	word_20E86, 6

loc_1C741:
		cmp	si, 4
		jl	short loc_1C738

loc_1C746:
		pop	si
		pop	bp
		retf
chargeshot_render_rikako	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

sub_1C749	proc near

var_2		= byte ptr -2
@@pid_other		= byte ptr -1
arg_0		= byte ptr  4

		enter	2, 0
		mov	[bp+var_2], 1
		cmp	[bp+arg_0], 2
		jnz	short loc_1C75F
		mov	al, [bp+var_2]
		add	al, 2
		mov	[bp+var_2], al

loc_1C75F:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D54h]
		cmp	al, [bp+var_2]
		jnz	short loc_1C7CA
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+38F4h], 0
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+2D54h]
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D56h]
		mov	ah, 0
		cwd
		sub	ax, dx
		sar	ax, 1
		mov	dl, 10h
		sub	dl, al
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		mov	[bx+2D58h], dl
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D56h]
		add	al, 30h	; '0'
		mov	dl, _pid_current
		mov	dh, 0
		shl	dx, 2
		mov	bx, dx
		mov	[bx+2D59h], al
		leave
		retn	2
; ---------------------------------------------------------------------------

loc_1C7CA:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+2D54h]
		mov	ah, 0
		mov	dl, [bp+var_2]
		mov	dh, 0
		inc	dx
		cmp	ax, dx
		jnz	locret_1C8D6
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+38F4h]
		mov	ah, 0
		mov	dl, _pid_current
		mov	dh, 0
		shl	dx, 2
		mov	bx, dx
		mov	dl, [bx+2D58h]
		mov	dh, 0
		push	dx
		cwd
		pop	bx
		idiv	bx
		or	dx, dx
		jnz	loc_1C8A5
		mov	al, 1
		sub	al, _pid_current
		mov	[bp+@@pid_other], al
		mov	al, [bp+arg_0]
		mov	byte_23E4E, al
		mov	al, [bp+@@pid_other]
		mov	_pid_other, al
		mov	word_23E40, 0
		mov	byte_23E45, 1
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	al, [bx+38F4h]
		mov	ah, 0
		mov	bx, 4
		cwd
		idiv	bx
		mov	dl, 20h	; ' '
		sub	dl, al
		mov	angle_23E43, dl
		mov	al, _pid_current
		mov	ah, 0
		shl	ax, 2
		mov	bx, ax
		mov	al, [bx+2D59h]
		mov	byte_23E42, al
		mov	word_23E3E, 0
		call	sub_17730
		mov	word_23E3E, 1200h
		call	sub_17730
		mov	al, angle_23E43
		neg	al
		mov	angle_23E43, al
		call	sub_17730
		mov	word_23E3E, 0
		call	sub_17730
		pushd	0
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C
		push	12000000h
		mov	al, [bp+@@pid_other]
		mov	ah, 0
		push	ax
		call	sub_CE0C

loc_1C8A5:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+38F4h], 80h
		jb	short loc_1C8CB
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		mov	byte ptr [bx+2D54h], 0
		mov	al, 1
		sub	al, _pid_current
		push	ax
		call	sub_A3A8

loc_1C8CB:
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		inc	byte ptr [bx+38F4h]

locret_1C8D6:
		leave
		retn	2
sub_1C749	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

rikako_1C8DA	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jz	short loc_1C8F0
		push	1
		call	sub_1C749

loc_1C8F0:
		pop	bp
		retf
rikako_1C8DA	endp


; =============== S U B	R O U T	I N E =======================================

; Attributes: bp-based frame

rikako_1C8F2	proc far
		push	bp
		mov	bp, sp
		mov	al, _pid_current
		mov	ah, 0
		mov	bx, ax
		cmp	byte ptr [bx+2D54h], 0
		jz	short loc_1C908
		push	2
		call	sub_1C749

loc_1C908:
		pop	bp
		retf
rikako_1C8F2	endp

main_11_TEXT	ends

	.data

		db  64h	; d
		db    0
		db  32h	; 2
		db    0
		db  14h
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db 0C8h
		db    0
		db  64h	; d
		db    0
		db  32h	; 2
		db    0
		db  14h
		db    0
		db    0
		db    0
		db    0
		db    0
		db  2Ch	; ,
		db    1
		db 0C8h
		db    0
		db  64h	; d
		db    0
		db  32h	; 2
		db    0
		db  0Ah
		db    0
		db    0
		db    0
		db  90h
		db    1
		db  2Ch	; ,
		db    1
		db 0C8h
		db    0
		db  64h	; d
		db    0
		db  32h	; 2
		db    0
		db  0Ah
		db    0
		db 0F4h
		db    1
		db  90h
		db    1
		db 0FAh
		db    0
		db  96h
		db    0
		db  46h	; F
		db    0
		db  14h
		db    0
		db  58h	; X
		db    2
		db 0F4h
		db    1
		db  2Ch	; ,
		db    1
		db 0C8h
		db    0
		db  64h	; d
		db    0
		db  32h	; 2
		db    0
		db 0E8h
		db    3
		db 0BCh
		db    2
		db 0F4h
		db    1
		db  2Ch	; ,
		db    1
		db 0C8h
		db    0
		db  64h	; d
		db    0
		db 0DCh
		db    5
		db  20h
		db    3
		db  58h	; X
		db    2
		db  2Ch	; ,
		db    1
		db 0C8h
		db    0
		db  64h	; d
		db    0
		db 0FAh
		db 0FFh
		db 0DCh
		db    5
		db 0E8h
		db    3
		db  20h
		db    3
		db 0BCh
		db    2
		db 0F4h
		db    1
		db 0FAh
		db 0FFh
		db 0D0h
		db    7
		db    8
		db    7
		db  14h
		db    5
		db 0E8h
		db    3
		db 0BCh
		db    2
include th03/main/chars/speeds[data].asm
aCOul		db '2.dat',0
aGameft_bft	db 'GAMEFT.bft',0
aOp		db 'op',0
; char arg0[]
arg0		db 'mainl',0
aLose_bf2	db 'lose.bf2',0
aRound_bf2	db 'round.bf2',0
aZikicw_bf2	db 'zikicw.bf2',0
include libs/master.lib/atan8[data].asm
include libs/master.lib/bfnt_id[data].asm
include libs/master.lib/clip[data].asm
include libs/master.lib/edges[data].asm
include libs/master.lib/fil[data].asm
include libs/master.lib/dos_ropen[data].asm
include libs/master.lib/gaiji_backup[data].asm
include libs/master.lib/gaiji_entry_bfnt[data].asm
include libs/master.lib/grp[data].asm
include libs/master.lib/js[data].asm
include libs/master.lib/pal[data].asm
include libs/master.lib/pf[data].asm
include libs/master.lib/rand[data].asm
include libs/master.lib/sin8[data].asm
include libs/master.lib/tx[data].asm
include libs/master.lib/vs[data].asm
include libs/master.lib/wordmask[data].asm
include libs/master.lib/mem[data].asm
include libs/master.lib/super_entry_bfnt[data].asm
include libs/master.lib/superpa[data].asm
_snd_active	db 0
		db 0
include libs/master.lib/respal_exist[data].asm
include libs/master.lib/draw_trapezoid[data].asm
include th03/snd/se_state[data].asm
include th02/formats/pfopen[data].asm
include th03/snd/se_priority[data].asm
include th03/formats/cfg_lres[data].asm
		db 0
byte_1DB9E	db 0FFh
		db 0
a00ch_bf2	db '00ch.bf2',0
		db 0
		db    0
		db    0
		db 0FFh
		db 0FFh
		db  80h
		db    0
		db 0C0h
		db    0
		db 0E0h
		db    0
		db 0F0h
		db    0
		db 0F8h
		db    0
		db 0FCh
		db    0
		db 0FEh
		db    0
		db 0FFh
		db    0
		db 0FFh
		db  80h
		db 0FFh
		db 0C0h
		db 0FFh
		db 0E0h
		db 0FFh
		db 0F0h
		db 0FFh
		db 0F8h
		db 0FFh
		db 0FCh
		db 0FFh
		db 0FEh
aEnedat_dat	db 'ENEDAT.DAT',0
		db 0
angles_1DBD8	db 192, 182, 202, 192, 176, 208
		db    0
		db    4
		db    8
		db    0
		db    0
		db    8
		db    1
		db    0
		db    8
		db    0
		db    8
		db    0
		db    0
		db    1
		db    0
		db    4
		db    0
		db    4
		db    4
		db    0
		db    4
		db    0
		db    0
		db    1
		db    2
		db    0
		db    2
		db    0
		db    2
		db    0
		db    0
		db    1
		db    1
		db    0
		db    0
		db    4
		db    4
		db    0
		db    4
		db    0
		db    0
		db    1
		db    4
		db    0
		db    4
		db    0
		db    0
		db    1
		db    0
		db    1
		db    4
		db    0
		db    0
		db    1
		db    0
		db    2
		db    0
		db    2
		db    8
		db    0
		db    2
		db    0
		db    0
		db    8
		db    0
		db    8
		db    4
		db    0
		db    8
		db    0
		db    8
		db    0
		db    0
		db    2
		db    0
		db    2
		db    0
		db    8
		db    1
		db    0
		db    0
		db    2
		db    1
		db    0
		db    1
		db    0
		db    4
		db    0
		db    8
		db    0
		db    4
		db    0
		db    0
		db    2
		db    2
		db    0
		db    0
		db    2
		db    0
		db    1
		db    0
		db    4
		db    0
		db    1
		db    4
		db    0
		db    1
		db    0
		db    1
		db    0
		db    0
		db    4
		db    2
		db    0
		db    0
		db    1
		db    0
		db    4
		db    0
		db    4
		db    1
		db    0
		db    0
		db    8
		db    1
		db    0
		db    0
		db    1
		db    8
		db    0
		db    8
		db    0
		db    0
		db    1
		db    0
		db    4
		db    0
		db    8
		db    4
		db    0
		db    8
		db    0
		db    1
		db    0
		db    0
		db    2
		db    0
		db    8
		db    0
		db    8
		db    0
		db    1
		db    0
		db    2
		db    1
		db    0
		db    1
		db    0
		db    0
		db    4
		db    0
		db    4
		db    2
		db    0
		db    0
		db    8
		db    8
		db    0
		db    2
		db    0
		db    0
		db    8
		db    0
		db    8
		db    4
		db    0
		db    8
		db    0
		db    8
		db    0
		db    0
		db    2
		db    0
		db    2
		db    0
		db    8
		db    2
		db    0
		db    0
		db    2
		db    2
		db    0
		db    2
		db    0
		db    4
		db    0
		db    8
		db    0
		db    4
		db    0
		db    0
		db    2
		db    2
		db    0
		db    0
		db    2
		db    0
		db    1
		db    0
		db    4
		db    0
		db    1
		db    4
		db    0
		db    1
		db    0
		db    8
		db    0
		db    0
		db    8
		db    2
		db    0
		db    0
		db    0
		db    0
		db    4
		db    0
		db    2
		db    0
		db    1
		db    4
		db    0
		db    1
		db    0
		db    4
		db    0
		db    8
		db    0
		db    2
		db    0
		db    0
		db    2
		db    0
		db    8
		db    0
		db    0
		db    0
		db    1
		db    0
		db    4
		db    1
		db    0
		db    4
		db    0
		db    0
		db    2
		db    2
		db    0
		db    0
		db    0
		db    0
		db    1
		db    0
		db    8
		db    0
		db    4
		db    8
		db    0
		db    1
		db    0
		db 0C0h
		db  15h
		db  6Bh	; k
		db  40h
		db 0EBh
		db  95h
		db    8
		db  0Eh
		db    2
		db  14h
		db    0
		db    0
byte_1DCF8	db 0
byte_1DCF9	db 0
gbWARNING_1	db 50h,	51h, 52h, 53h, 54h, 55h, 56h, 57h, 58h, 59h, 5Ah
		db 5Bh,	5Ch, 5Dh, 5Eh, 5Fh, 0
gbWARNING_2	db 60h,	61h, 62h, 63h, 64h, 65h, 66h, 67h, 68h, 69h, 6Ah
		db 6Bh,	6Ch, 6Dh, 6Eh, 6Fh, 0
gbWARNING_3	db 70h,	71h, 72h, 73h, 74h, 75h, 76h, 77h, 78h, 79h, 7Ah
		db 7Bh,	7Ch, 7Dh, 7Eh, 7Fh, 0
gpYOU_ARE_FORCED_TO_EVADE_FROM db 82h, 83h, 84h, 85h, 86h, 87h, 88h
		db 89h, 8Ah, 8Bh, 8Ch, 0
gpGAUGE_ATTACK_LEVEL db 0C7h, 0C8h, 0C9h, 0CAh, 0CBh, 0CCh, 0CDh, 0CEh,	0
gpBOSS_ATTACK_LEVEL db 0D0h, 0D1h, 0D2h, 0CAh, 0CBh, 0CCh, 0CDh, 0CEh, 0
gpYOUR_LIFE_IS_IN_PERIL_BE_CAREFUL db 8Dh, 8Eh, 8Fh, 92h, 93h, 94h, 95h
		db 96h, 97h, 98h, 99h, 9Ah, 9Bh, 9Ch, 0
asc_1DD5A	db '                                ',0
		db 0
include th03/main/player/combo[data].asm
		db 0
		db  86h
		db  20h
		db  0Ch
		db  23h	; #
		db 0A2h
		db  20h
		db  18h
		db  28h	; (
		db  20h
		db  28h	; (
		db  24h	; $
		db  28h	; (
		db  20h
		db  2Dh	; -
		db  24h	; $
		db  2Dh	; -
		db 0A8h	; 
		db  20h
		db  28h	; (
		db  28h	; (
		db 0A8h	; 
		db  2Fh	; /
		db 0AEh
		db  34h	; 4
word_1DDA6	dw 20AEh
		db 0AEh
		db  2Ah	; *
		db 0B6h
		db  20h
word_1DDAC	dw 2AB6h
		db    0
		db  32h	; 2
		db  0Ah
		db  32h	; 2
		db  14h
		db  32h	; 2
		db  1Eh
		db  32h	; 2
include th03/main/player/hitcombo[data].asm
include th03/sprites/score.asp
include th03/main/5_powers_of_10[data].asm
		db  6Ch	; l
		db    0
		db  60h
		db    0
		db  50h	; P
		db    0
		db  40h
		db    0
		db  30h	; 0
		db    0
		db  20h
		db    0
		db  10h
		db    0
		db    8
		db    0
		db    4
		db    0
		db    2
		db    0
		db    8
		db    0
		db  10h
		db    0
		db  10h
		db    0
		db  10h
		db    0
		db  10h
		db    0
		db  10h
		db    0
		db    8
		db    0
		db    2
		db    0
		db    0
		db    3
		db    0
		db    7
		db    0
		db    6
		db    0
		db    6
		db    0
		db    9
		db    0
		db    5
		db    0
		db  0Ch
		db    0
		db    6
		db    0
		db  0Fh
		db    0
		db    7
aMAX_COMBO	db 'l`w@b@@@~',0
aGAUGE_ATTACK_TIMES	db 'Q[WA^bN@@@~',0
aBOSS_ATTACK_TIMES	db '{XA^bN@@@@~',0
aBOSS_REVERSAL_TIMES	db '{Xo[T@@@~',0
aBOSS_PANIC_TIMES	db '{XpjbN@@@@~',0
aTOTAL	db '@@@sns`k@@@@@',0
aWINNER_BONUS	db '@@vhmmdq@anmtr@@',0
aALL_CLEAR	db '@@@`kk@bkd`qII@@',0
aPLAYER_REM	db 'cl@@@@@@@@~',0
		db 0
		db '<',0
		db    0
		db    0
		db 0FFh
		db    0
		db    0
		db    0
		db 0FFh
		db    0
		db    0
		db    0
		db  3Ch	; <
		db    0
		db    0
		db    0
		db  1Eh
		db    0
		db    0
		db    0
		db  7Fh
		db  80h
		db    0
		db    0
		db  7Fh
		db  80h
		db    0
		db    0
		db  1Eh
		db    0
		db    0
		db    0
		db  0Fh
		db    0
		db    0
		db    0
		db  3Fh	; ?
		db 0C0h
		db    0
		db    0
		db  3Fh	; ?
		db 0C0h
		db    0
		db    0
		db  0Fh
		db    0
		db    0
		db    0
		db    7
		db  80h
		db    0
		db    0
		db  1Fh
		db 0E0h
		db    0
		db    0
		db  1Fh
		db 0E0h
		db    0
		db    0
		db    7
		db  80h
		db    0
		db    0
		db    3
		db 0C0h
		db    0
		db    0
		db  0Fh
		db 0F0h
		db    0
		db    0
		db  0Fh
		db 0F0h
		db    0
		db    0
		db    3
		db 0C0h
		db    0
		db    0
		db    1
		db 0E0h
		db    0
		db    0
		db    7
		db 0F8h
		db    0
		db    0
		db    7
		db 0F8h
		db    0
		db    0
		db    1
		db 0E0h
		db    0
		db    0
		db    0
		db 0F0h
		db    0
		db    0
		db    3
		db 0FCh
		db    0
		db    0
		db    3
		db 0FCh
		db    0
		db    0
		db    0
		db 0F0h
		db    0
		db    0
		db    0
		db  78h	; x
		db    0
		db    0
		db    1
		db 0FEh
		db    0
		db    0
		db    1
		db 0FEh
		db    0
		db    0
		db    0
		db  78h	; x
		db    0
		db    0
		db    0
		db  3Ch	; <
		db    0
		db    0
		db    0
		db 0FFh
		db    0
		db    0
		db    0
		db 0FFh
		db    0
		db    0
		db    0
		db  3Ch	; <
		db    0
		db    0
		db    0
		db  1Eh
		db    0
		db    0
		db    0
		db  7Fh
		db  80h
		db    0
		db    0
		db  7Fh
		db  80h
		db    0
		db    0
		db  1Eh
		db    0
		db    0
		db    0
		db  0Fh
		db    0
		db    0
		db    0
		db  3Fh	; ?
		db 0C0h
		db    0
		db    0
		db  3Fh	; ?
		db 0C0h
		db    0
		db    0
		db  0Fh
		db    0
		db    0
		db    0
		db    7
		db  80h
		db    0
		db    0
		db  1Fh
		db 0E0h
		db    0
		db    0
		db  1Fh
		db 0E0h
		db    0
		db    0
		db    7
		db  80h
		db    0
		db    0
		db    3
		db 0C0h
		db    0
		db    0
		db  0Fh
		db 0F0h
		db    0
		db    0
		db  0Fh
		db 0F0h
		db    0
		db    0
		db    3
		db 0C0h
		db    0
		db    0
		db    1
		db 0E0h
		db    0
		db    0
		db    7
		db 0F8h
		db    0
		db    0
		db    7
		db 0F8h
		db    0
		db    0
		db    1
		db 0E0h
		db    0
		db    0
		db    0
		db 0F0h
		db    0
		db    0
		db    3
		db 0FCh
		db    0
		db    0
		db    3
		db 0FCh
		db    0
		db    0
		db    0
		db 0F0h
		db    0
		db    0
		db    0
		db  78h	; x
		db    0
		db    0
		db    1
		db 0FEh
		db    0
		db    0
		db    1
		db 0FEh
		db    0
		db    0
		db    0
		db  78h	; x
		db    0
		db  18h
		db    0
		db    0
		db    0
		db  81h
		db    0
		db    0
		db    0
		db  81h
		db    0
		db    0
		db    0
		db  18h
		db    0
		db    0
		db    0
		db  0Ch
		db    0
		db    0
		db    0
		db  40h
		db  80h
		db    0
		db    0
		db  40h
		db  80h
		db    0
		db    0
		db  0Ch
		db    0
		db    0
		db    0
		db    6
		db    0
		db    0
		db    0
		db  20h
		db  40h
		db    0
		db    0
		db  20h
		db  40h
		db    0
		db    0
		db    6
		db    0
		db    0
		db    0
		db    3
		db    0
		db    0
		db    0
		db  10h
		db  20h
		db    0
		db    0
		db  10h
		db  20h
		db    0
		db    0
		db    3
		db    0
		db    0
		db    0
		db    1
		db  80h
		db    0
		db    0
		db    8
		db  10h
		db    0
		db    0
		db    8
		db  10h
		db    0
		db    0
		db    1
		db  80h
		db    0
		db    0
		db    0
		db 0C0h
		db    0
		db    0
		db    4
		db    8
		db    0
		db    0
		db    4
		db    8
		db    0
		db    0
		db    0
		db 0C0h
		db    0
		db    0
		db    0
		db  60h
		db    0
		db    0
		db    2
		db    4
		db    0
		db    0
		db    1
		db    4
		db    0
		db    0
		db    0
		db  60h
		db    0
		db    0
		db    0
		db  30h	; 0
		db    0
		db    0
		db    1
		db    2
		db    0
		db    0
		db    1
		db    2
		db    0
		db    0
		db    0
		db  30h	; 0
		db    0
		db    0
		db    0
		db  18h
		db    0
		db    0
		db    0
		db  81h
		db    0
		db    0
		db    0
		db  81h
		db    0
		db    0
		db    0
		db  18h
		db    0
		db    0
		db    0
		db  0Ch
		db    0
		db    0
		db    0
		db  40h
		db  80h
		db    0
		db    0
		db  40h
		db  80h
		db    0
		db    0
		db  0Ch
		db    0
		db    0
		db    0
		db    6
		db    0
		db    0
		db    0
		db  20h
		db  40h
		db    0
		db    0
		db  20h
		db  40h
		db    0
		db    0
		db    6
		db    0
		db    0
		db    0
		db    3
		db    0
		db    0
		db    0
		db  10h
		db  20h
		db    0
		db    0
		db  10h
		db  20h
		db    0
		db    0
		db    3
		db    0
		db    0
		db    0
		db    1
		db  80h
		db    0
		db    0
		db    8
		db  10h
		db    0
		db    0
		db    8
		db  10h
		db    0
		db    0
		db    1
		db  80h
		db    0
		db    0
		db    0
		db 0C0h
		db    0
		db    0
		db    4
		db    8
		db    0
		db    0
		db    4
		db    8
		db    0
		db    0
		db    0
		db 0C0h
		db    0
		db    0
		db    0
		db  60h
		db    0
		db    0
		db    2
		db    4
		db    0
		db    0
		db    1
		db    4
		db    0
		db    0
		db    0
		db  60h
		db    0
		db    0
		db    0
		db  30h	; 0
		db    0
		db    0
		db    1
		db    2
		db    0
		db    0
		db    1
		db    2
		db    0
		db    0
		db    0
		db  30h	; 0
		db    0
		db    1
		db    0
byte_1E14C	db 0
		db 0

	.data?

include th03/hardware/input_modes[bss].asm
include th03/main/demo[bss].asm
word_1E6E8	dw ?
fp_1E6EA	dw ?
include libs/master.lib/clip[bss].asm
include libs/master.lib/fil[bss].asm
include libs/master.lib/grcg_circle[bss].asm
include libs/master.lib/grcg_triangle[bss].asm
include libs/master.lib/js[bss].asm
include libs/master.lib/pal[bss].asm
include libs/master.lib/vs[bss].asm
include libs/master.lib/vsync[bss].asm
include libs/master.lib/mem[bss].asm
include libs/master.lib/superpa[bss].asm
include th01/hardware/vram_planes[bss].asm
include th02/snd/snd[bss].asm
include libs/master.lib/pfint21[bss].asm
include th03/hardware/input[bss].asm
include th02/formats/pi_slots[bss].asm
include th03/formats/hfliplut[bss].asm
MRS_SLOT_COUNT = 8
public _mrs_images
_mrs_images	dd MRS_SLOT_COUNT dup(?)
include th03/sprite16[bss].asm
word_1F2EC	dw ?
word_1F2EE	dw ?
public _resident
_resident	dd ?
palette_1F2F4	palette_t <?>
byte_1F324	db ?
		db ?
word_1F326	dw ?
word_1F328	dw ?
word_1F32A	dw ?
word_1F32C	dw ?
p1_1F32E	dd ?
p2_1F332	dd ?
p1_1F336	dd ?
p2_1F33A	dd ?
word_1F33E	dw ?
word_1F340	dw ?
point_1F342	Point <?>
word_1F346	dw ?
word_1F348	dw ?
word_1F34A	dw ?
sprite_1F34C	dw ?
byte_1F34E	db ?
byte_1F34F	db ?
angle_1F350	db ?
byte_1F351	db ?
byte_1F352	db ?
byte_1F353	db ?
byte_1F354	db ?
byte_1F355	db ?
word_1F356	dw ?
byte_1F358	db ?
		db 69 dup(?)
byte_1F39E	db ?
byte_1F39F	db ?
byte_1F3A0	db ?
byte_1F3A1	db ?
byte_1F3A2	db ?
byte_1F3A3	db ?
byte_1F3A4	db ?
byte_1F3A5	db ?
		db 10 dup(?)
word_1F3B0	dw ?
include th02/math/randring[bss].asm
		db 102 dup(?)
word_1F51A	dw ?
byte_1F51C	db ?
byte_1F51D	db ?
word_1F51E	dw ?
byte_1F520	db ?
		db ?
word_1F522	dw ?
		db 48 dup(?)
word_1F554	dw ?
word_1F556	dw ?
word_1F558	dw ?
byte_1F55A	db ?
byte_1F55B	db ?
byte_1F55C	db ?
		db 779 dup(?)
word_1F868	dw ?
		db 720 dup(?)
word_1FB3A	dw ?
word_1FB3C	dw ?
		db 128 dup(?)
word_1FBBE	dw ?
fp_1FBC0	dw ?
byte_1FBC2	db ?
byte_1FBC3	db ?
word_1FBC4	dw ?
word_1FBC6	dw ?
word_1FBC8	dw ?
word_1FBCA	dw ?
word_1FBCC	dw ?
word_1FBCE	dw ?
word_1FBD0	dw ?
word_1FBD2	dw ?
angle_1FBD4	db ?
		db 439 dup(?)
word_1FD8C	dw ?
byte_1FD8E	db ?
byte_1FD8F	db ?
		db 80 dup(?)
byte_1FDE0	db ?
byte_1FDE1	db ?
		db 8 dup(?)
byte_1FDEA	db ?
		db 49 dup(?)
byte_1FE1C	db ?
		db 49 dup(?)
word_1FE4E	dw ?
byte_1FE50	db ?
		db ?
point_1FE52	Point <?>
word_1FE56	dw ?
		db 2 dup(?)
byte_1FE5A	db ?
		db 7 dup(?)
byte_1FE62	db ?
		db 7 dup(?)
word_1FE6A	dw ?
p1_1FE6C	dd ?
p1_1FE70	dd ?
p1_1FE74	dd ?
p2_1FE78	dd ?
p2_1FE7C	dd ?
p2_1FE80	dd ?
		db 4 dup(?)
public _pid_current
_pid_current	db ?
	evendata
		db 1024 dup(?)
word_2028A	dw ?
include th03/main/player/chargeshot[bss].asm
p1_2029C	dd ?
p2_202A0	dd ?
p1_202A4	dd ?
p2_202A8	dd ?
p1_202AC	dd ?
p2_202B0	dd ?
		db 2 dup(?)
byte_202B6	db ?
byte_202B7	db ?
		db 786 dup(?)
word_205CA	dw ?
byte_205CC	db ?
		db ?
p1_205CE	dd ?
p2_205D2	dd ?
bomb_p1	dd ?
bomb_p2	dd ?
public _bomb_frame
_bomb_frame	db PLAYER_COUNT dup(?)
		db 512 dup(?)
word_207E0	dw ?
byte_207E2	db ?
byte_207E3	db ?
		db 150 dup(?)
word_2087A	dw ?
		db 1128 dup(?)
word_20CE4	dw ?
byte_20CE6	db ?
		db ?
word_20CE8	dw ?
word_20CEA	dw ?
x_20CEC	dw ?
		db 308 dup(?)
word_20E22	dw ?
		db 4 dup(?)
byte_20E28	db ?
byte_20E29	db ?
byte_20E2A	db ?
angle_20E2B	db ?
byte_20E2C	db ?
		db ?
word_20E2E	dw ?
word_20E30	dw ?
word_20E32	dw ?
word_20E34	dw ?
word_20E36	dw ?
word_20E38	dw ?
pid_20E3A	db ?
	evendata
byte_20E3C	db ?
byte_20E3D	db ?
word_20E3E	dw ?
word_20E40	dw ?
word_20E42	dw ?
word_20E44	dw ?
word_20E46	dw ?
byte_20E48	db ?
		db ?
word_20E4A	dw ?
byte_20E4C	db ?
byte_20E4D	db ?
byte_20E4E	db ?
		db ?
word_20E50	dw ?
word_20E52	dw ?
		db 50 dup(?)
word_20E86	dw ?
byte_20E88	db ?
byte_20E89	db ?
		db 20 dup(?)
include th03/main/player/combo[bss].asm
		db 120 dup(?)
byte_20F1E	db ?
		db ?
farfp_20F20	dd ?
farfp_20F24	dd ?
farfp_20F28	dd ?
		db 1280 dup(?)
angle_2142C	db ?
		db ?
word_2142E	dw ?
word_21430	dw ?
		db 2 dup(?)
word_21434	dw ?
		db 298 dup(?)
word_21560	dw ?
word_21562	dw ?
dword_21564	dd ?
word_21568	dw ?
word_2156A	dw ?
		db 256 dup(?)
byte_2166C	db ?
		db ?
word_2166E	dw ?
word_21670	dw ?
byte_21672	db ?
byte_21673	db ?
		db 2498 dup(?)
byte_22036	db ?
byte_22037	db ?
		db 2 dup(?)
byte_2203A	db ?
byte_2203B	db ?
word_2203C	dw ?
include th03/main/player/hitcombo[bss].asm
		db 100 dup(?)
hitcombo_slot_220C2	db ?
byte_220C3	db ?
include th03/main/player/score[bss].asm
byte_220DC	db ?
		db 3 dup(?)
byte_220E0	db ?
		db 5 dup(?)
byte_220E6	db ?
		db 5 dup(?)
word_220EC	dw ?
word_220EE	dw ?
word_220F0	dw ?
word_220F2	dw ?
word_220F4	dw ?
word_220F6	dw ?
		db 2 dup(?)
byte_220FA	db ?
		db 6629 dup(?)
public _bomb_state
_bomb_state	db PLAYER_COUNT dup(?)
byte_23AE2	db ?
byte_23AE3	db ?
byte_23AE4	db ?
byte_23AE5	db ?
byte_23AE6	db ?
byte_23AE7	db ?
player_23AE8	dw ?
public _cpu_hit_damage_additional, _damage_all_enemies_on
_cpu_hit_damage_additional	db ?
_damage_all_enemies_on	db PLAYFIELD_COUNT dup(?)
		db ?
include th02/hardware/pages[bss].asm
word_23AF0	dw ?
public _round_frame
_round_frame	dd ?
word_23AF6	dw ?
byte_23AF8	db ?
byte_23AF9	db ?
byte_23AFA	db ?
		db ?
include th03/main/playfield_fg_x[bss].asm
byte_23B00	db ?
include th03/hardware/palette_changed[bss].asm
include th03/main/frame_mod[bss].asm
include th03/main/player/players[bss].asm
include th03/main/player/shots[bss].asm
byte_23DC6	db ?
byte_23DC7	db ?
byte_23DC8	db ?
		db 25 dup(?)
byte_23DE2	db ?
byte_23DE3	db ?
byte_23DE4	db ?
byte_23DE5	db ?
byte_23DE6	db ?
byte_23DE7	db ?
byte_23DE8	db ?
byte_23DE9	db ?
score_23DEA	dw ?
word_23DEC	dw ?
word_23DEE	dw ?
score_23DF0	dd ?
include th03/main/player/win[bss].asm
byte_23DF9	db ?
		db 64 dup(?)
word_23E3A	dw ?
byte_23E3C	db ?
		db ?
word_23E3E	dw ?
word_23E40	dw ?
byte_23E42	db ?
angle_23E43	db ?
public _pid_other
_pid_other	db ?
byte_23E45	db ?
byte_23E46	db ?
byte_23E47	db ?
point_23E48	Point <?>
word_23E4C	dw ?
byte_23E4E	db ?
byte_23E4F	db ?
byte_23E50	db ?
byte_23E51	db ?
		db 9472 dup(?)
byte_26352	db ?
byte_26353	db ?
word_26354	dw ?
byte_26356	db ?
byte_26357	db ?
byte_26358	db ?
		db    ?	;

		end
